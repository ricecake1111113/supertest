var mh=Object.defineProperty;var ca=Object.getOwnPropertySymbols,uh=Object.getPrototypeOf,bh=Object.prototype.hasOwnProperty,Zh=Object.prototype.propertyIsEnumerable,Gh=Reflect.get;var da=(i,V,g)=>V in i?mh(i,V,{enumerable:!0,configurable:!0,writable:!0,value:g}):i[V]=g,an=(i,V)=>{for(var g in V||(V={}))bh.call(V,g)&&da(i,g,V[g]);if(ca)for(var g of ca(V))Zh.call(V,g)&&da(i,g,V[g]);return i};var ph=(i,V)=>()=>(V||i((V={exports:{}}).exports,V),V.exports);var xi=(i,V,g)=>Gh(uh(i),g,V);var SV=(i,V,g)=>new Promise((I,e)=>{var t=s=>{try{A(g.next(s))}catch(a){e(a)}},C=s=>{try{A(g.throw(s))}catch(a){e(a)}},A=s=>s.done?I(s.value):Promise.resolve(s.value).then(t,C);A((g=g.apply(i,V)).next())});var V2=ph(dh=>{const qh=function(){const V=document.createElement("link").relList;if(V&&V.supports&&V.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))I(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const C of t.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&I(C)}).observe(document,{childList:!0,subtree:!0});function g(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function I(e){if(e.ep)return;e.ep=!0;const t=g(e);fetch(e.href,t)}};qh();var OI=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Bh(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function ki(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ts={exports:{}},Cs={exports:{}},xI={},ag={};ag.__esModule=!0;ag.extend=yc;ag.indexOf=Yh;ag.escapeExpression=wh;ag.isEmpty=Hh;ag.createFrame=fh;ag.blockParams=Sh;ag.appendContextPath=Fh;var Wh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},yh=/[&<>"'`=]/g,Xh=/[&<>"'`=]/;function Rh(i){return Wh[i]}function yc(i){for(var V=1;V<arguments.length;V++)for(var g in arguments[V])Object.prototype.hasOwnProperty.call(arguments[V],g)&&(i[g]=arguments[V][g]);return i}var $s=Object.prototype.toString;ag.toString=$s;var is=function(V){return typeof V=="function"};is(/x/)&&(ag.isFunction=is=function(i){return typeof i=="function"&&$s.call(i)==="[object Function]"});ag.isFunction=is;var Xc=Array.isArray||function(i){return i&&typeof i=="object"?$s.call(i)==="[object Array]":!1};ag.isArray=Xc;function Yh(i,V){for(var g=0,I=i.length;g<I;g++)if(i[g]===V)return g;return-1}function wh(i){if(typeof i!="string"){if(i&&i.toHTML)return i.toHTML();if(i==null)return"";if(!i)return i+"";i=""+i}return Xh.test(i)?i.replace(yh,Rh):i}function Hh(i){return!i&&i!==0?!0:!!(Xc(i)&&i.length===0)}function fh(i){var V=yc({},i);return V._parent=i,V}function Sh(i,V){return i.path=V,i}function Fh(i,V){return(i?i+".":"")+V}var qI={exports:{}};(function(i,V){V.__esModule=!0;var g=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function I(e,t){var C=t&&t.loc,A=void 0,s=void 0,a=void 0,o=void 0;C&&(A=C.start.line,s=C.end.line,a=C.start.column,o=C.end.column,e+=" - "+A+":"+a);for(var n=Error.prototype.constructor.call(this,e),l=0;l<g.length;l++)this[g[l]]=n[g[l]];Error.captureStackTrace&&Error.captureStackTrace(this,I);try{C&&(this.lineNumber=A,this.endLineNumber=s,Object.defineProperty?(Object.defineProperty(this,"column",{value:a,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:o,enumerable:!0})):(this.column=a,this.endColumn=o))}catch(c){}}I.prototype=new Error,V.default=I,i.exports=V.default})(qI,qI.exports);var fi={},As={exports:{}};(function(i,V){V.__esModule=!0;var g=ag;V.default=function(I){I.registerHelper("blockHelperMissing",function(e,t){var C=t.inverse,A=t.fn;if(e===!0)return A(this);if(e===!1||e==null)return C(this);if(g.isArray(e))return e.length>0?(t.ids&&(t.ids=[t.name]),I.helpers.each(e,t)):C(this);if(t.data&&t.ids){var s=g.createFrame(t.data);s.contextPath=g.appendContextPath(t.data.contextPath,t.name),t={data:s}}return A(e,t)})},i.exports=V.default})(As,As.exports);var ns={exports:{}};(function(i,V){V.__esModule=!0;function g(C){return C&&C.__esModule?C:{default:C}}var I=ag,e=qI.exports,t=g(e);V.default=function(C){C.registerHelper("each",function(A,s){if(!s)throw new t.default("Must pass iterator to #each");var a=s.fn,o=s.inverse,n=0,l="",c=void 0,d=void 0;s.data&&s.ids&&(d=I.appendContextPath(s.data.contextPath,s.ids[0])+"."),I.isFunction(A)&&(A=A.call(this)),s.data&&(c=I.createFrame(s.data));function h(Z,p,G){c&&(c.key=Z,c.index=p,c.first=p===0,c.last=!!G,d&&(c.contextPath=d+Z)),l=l+a(A[Z],{data:c,blockParams:I.blockParams([A[Z],Z],[d+Z,null])})}if(A&&typeof A=="object")if(I.isArray(A))for(var m=A.length;n<m;n++)n in A&&h(n,n,n===A.length-1);else if(OI.Symbol&&A[OI.Symbol.iterator]){for(var r=[],u=A[OI.Symbol.iterator](),b=u.next();!b.done;b=u.next())r.push(b.value);A=r;for(var m=A.length;n<m;n++)h(n,n,n===A.length-1)}else(function(){var Z=void 0;Object.keys(A).forEach(function(p){Z!==void 0&&h(Z,n-1),Z=p,n++}),Z!==void 0&&h(Z,n-1,!0)})();return n===0&&(l=o(this)),l})},i.exports=V.default})(ns,ns.exports);var ss={exports:{}};(function(i,V){V.__esModule=!0;function g(t){return t&&t.__esModule?t:{default:t}}var I=qI.exports,e=g(I);V.default=function(t){t.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new e.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},i.exports=V.default})(ss,ss.exports);var ls={exports:{}};(function(i,V){V.__esModule=!0;function g(C){return C&&C.__esModule?C:{default:C}}var I=ag,e=qI.exports,t=g(e);V.default=function(C){C.registerHelper("if",function(A,s){if(arguments.length!=2)throw new t.default("#if requires exactly one argument");return I.isFunction(A)&&(A=A.call(this)),!s.hash.includeZero&&!A||I.isEmpty(A)?s.inverse(this):s.fn(this)}),C.registerHelper("unless",function(A,s){if(arguments.length!=2)throw new t.default("#unless requires exactly one argument");return C.helpers.if.call(this,A,{fn:s.inverse,inverse:s.fn,hash:s.hash})})},i.exports=V.default})(ls,ls.exports);var as={exports:{}};(function(i,V){V.__esModule=!0,V.default=function(g){g.registerHelper("log",function(){for(var I=[void 0],e=arguments[arguments.length-1],t=0;t<arguments.length-1;t++)I.push(arguments[t]);var C=1;e.hash.level!=null?C=e.hash.level:e.data&&e.data.level!=null&&(C=e.data.level),I[0]=C,g.log.apply(g,I)})},i.exports=V.default})(as,as.exports);var os={exports:{}};(function(i,V){V.__esModule=!0,V.default=function(g){g.registerHelper("lookup",function(I,e,t){return I&&t.lookupProperty(I,e)})},i.exports=V.default})(os,os.exports);var cs={exports:{}};(function(i,V){V.__esModule=!0;function g(C){return C&&C.__esModule?C:{default:C}}var I=ag,e=qI.exports,t=g(e);V.default=function(C){C.registerHelper("with",function(A,s){if(arguments.length!=2)throw new t.default("#with requires exactly one argument");I.isFunction(A)&&(A=A.call(this));var a=s.fn;if(I.isEmpty(A))return s.inverse(this);var o=s.data;return s.data&&s.ids&&(o=I.createFrame(s.data),o.contextPath=I.appendContextPath(s.data.contextPath,s.ids[0])),a(A,{data:o,blockParams:I.blockParams([A],[o&&o.contextPath])})})},i.exports=V.default})(cs,cs.exports);fi.__esModule=!0;fi.registerDefaultHelpers=jh;fi.moveHelperToHooks=Ph;function Rt(i){return i&&i.__esModule?i:{default:i}}var vh=As.exports,Nh=Rt(vh),Kh=ns.exports,Jh=Rt(Kh),Mh=ss.exports,xh=Rt(Mh),kh=ls.exports,zh=Rt(kh),Th=as.exports,Lh=Rt(Th),Uh=os.exports,Dh=Rt(Uh),Eh=cs.exports,Qh=Rt(Eh);function jh(i){Nh.default(i),Jh.default(i),xh.default(i),zh.default(i),Lh.default(i),Dh.default(i),Qh.default(i)}function Ph(i,V,g){i.helpers[V]&&(i.hooks[V]=i.helpers[V],g||delete i.helpers[V])}var Vl={},ds={exports:{}};(function(i,V){V.__esModule=!0;var g=ag;V.default=function(I){I.registerDecorator("inline",function(e,t,C,A){var s=e;return t.partials||(t.partials={},s=function(a,o){var n=C.partials;C.partials=g.extend({},n,t.partials);var l=e(a,o);return C.partials=n,l}),t.partials[A.args[0]]=A.fn,s})},i.exports=V.default})(ds,ds.exports);Vl.__esModule=!0;Vl.registerDefaultDecorators=Vm;function Oh(i){return i&&i.__esModule?i:{default:i}}var _h=ds.exports,$h=Oh(_h);function Vm(i){$h.default(i)}var yA={exports:{}};(function(i,V){V.__esModule=!0;var g=ag,I={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(t){if(typeof t=="string"){var C=g.indexOf(I.methodMap,t.toLowerCase());C>=0?t=C:t=parseInt(t,10)}return t},log:function(t){if(t=I.lookupLevel(t),typeof console!="undefined"&&I.lookupLevel(I.level)<=t){var C=I.methodMap[t];console[C]||(C="log");for(var A=arguments.length,s=Array(A>1?A-1:0),a=1;a<A;a++)s[a-1]=arguments[a];console[C].apply(console,s)}}};V.default=I,i.exports=V.default})(yA,yA.exports);var yC={},gl={};gl.__esModule=!0;gl.createNewLookupObject=Im;var gm=ag;function Im(){for(var i=arguments.length,V=Array(i),g=0;g<i;g++)V[g]=arguments[g];return gm.extend.apply(void 0,[Object.create(null)].concat(V))}yC.__esModule=!0;yC.createProtoAccessControl=im;yC.resultIsAllowed=Am;yC.resetLoggedProperties=sm;function em(i){if(i&&i.__esModule)return i;var V={};if(i!=null)for(var g in i)Object.prototype.hasOwnProperty.call(i,g)&&(V[g]=i[g]);return V.default=i,V}var ra=gl,tm=yA.exports,Cm=em(tm),XA=Object.create(null);function im(i){var V=Object.create(null);V.constructor=!1,V.__defineGetter__=!1,V.__defineSetter__=!1,V.__lookupGetter__=!1;var g=Object.create(null);return g.__proto__=!1,{properties:{whitelist:ra.createNewLookupObject(g,i.allowedProtoProperties),defaultValue:i.allowProtoPropertiesByDefault},methods:{whitelist:ra.createNewLookupObject(V,i.allowedProtoMethods),defaultValue:i.allowProtoMethodsByDefault}}}function Am(i,V,g){return ha(typeof i=="function"?V.methods:V.properties,g)}function ha(i,V){return i.whitelist[V]!==void 0?i.whitelist[V]===!0:i.defaultValue!==void 0?i.defaultValue:(nm(V),!1)}function nm(i){XA[i]!==!0&&(XA[i]=!0,Cm.log("error",'Handlebars: Access has been denied to resolve the property "'+i+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function sm(){Object.keys(XA).forEach(function(i){delete XA[i]})}xI.__esModule=!0;xI.HandlebarsEnvironment=rs;function Rc(i){return i&&i.__esModule?i:{default:i}}var mt=ag,lm=qI.exports,on=Rc(lm),am=fi,om=Vl,cm=yA.exports,RA=Rc(cm),dm=yC,rm="4.7.7";xI.VERSION=rm;var hm=8;xI.COMPILER_REVISION=hm;var mm=7;xI.LAST_COMPATIBLE_COMPILER_REVISION=mm;var um={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};xI.REVISION_CHANGES=um;var cn="[object Object]";function rs(i,V,g){this.helpers=i||{},this.partials=V||{},this.decorators=g||{},am.registerDefaultHelpers(this),om.registerDefaultDecorators(this)}rs.prototype={constructor:rs,logger:RA.default,log:RA.default.log,registerHelper:function(V,g){if(mt.toString.call(V)===cn){if(g)throw new on.default("Arg not supported with multiple helpers");mt.extend(this.helpers,V)}else this.helpers[V]=g},unregisterHelper:function(V){delete this.helpers[V]},registerPartial:function(V,g){if(mt.toString.call(V)===cn)mt.extend(this.partials,V);else{if(typeof g=="undefined")throw new on.default('Attempting to register a partial called "'+V+'" as undefined');this.partials[V]=g}},unregisterPartial:function(V){delete this.partials[V]},registerDecorator:function(V,g){if(mt.toString.call(V)===cn){if(g)throw new on.default("Arg not supported with multiple decorators");mt.extend(this.decorators,V)}else this.decorators[V]=g},unregisterDecorator:function(V){delete this.decorators[V]},resetLoggedPropertyAccesses:function(){dm.resetLoggedProperties()}};var bm=RA.default.log;xI.log=bm;xI.createFrame=mt.createFrame;xI.logger=RA.default;var hs={exports:{}};(function(i,V){V.__esModule=!0;function g(I){this.string=I}g.prototype.toString=g.prototype.toHTML=function(){return""+this.string},V.default=g,i.exports=V.default})(hs,hs.exports);var Ct={},Il={};Il.__esModule=!0;Il.wrapHelper=Zm;function Zm(i,V){if(typeof i!="function")return i;var g=function(){var e=arguments[arguments.length-1];return arguments[arguments.length-1]=V(e),i.apply(this,arguments)};return g}Ct.__esModule=!0;Ct.checkRevision=ym;Ct.template=Xm;Ct.wrapProgram=GA;Ct.resolvePartial=Rm;Ct.invokePartial=Ym;Ct.noop=Yc;function Gm(i){return i&&i.__esModule?i:{default:i}}function pm(i){if(i&&i.__esModule)return i;var V={};if(i!=null)for(var g in i)Object.prototype.hasOwnProperty.call(i,g)&&(V[g]=i[g]);return V.default=i,V}var qm=ag,Ze=pm(qm),Bm=qI.exports,Ge=Gm(Bm),pe=xI,ma=fi,Wm=Il,ua=yC;function ym(i){var V=i&&i[0]||1,g=pe.COMPILER_REVISION;if(!(V>=pe.LAST_COMPATIBLE_COMPILER_REVISION&&V<=pe.COMPILER_REVISION))if(V<pe.LAST_COMPATIBLE_COMPILER_REVISION){var I=pe.REVISION_CHANGES[g],e=pe.REVISION_CHANGES[V];throw new Ge.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+I+") or downgrade your runtime to an older version ("+e+").")}else throw new Ge.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+i[1]+").")}function Xm(i,V){if(!V)throw new Ge.default("No environment passed to template");if(!i||!i.main)throw new Ge.default("Unknown template object: "+typeof i);i.main.decorator=i.main_d,V.VM.checkRevision(i.compiler);var g=i.compiler&&i.compiler[0]===7;function I(C,A,s){s.hash&&(A=Ze.extend({},A,s.hash),s.ids&&(s.ids[0]=!0)),C=V.VM.resolvePartial.call(this,C,A,s);var a=Ze.extend({},s,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),o=V.VM.invokePartial.call(this,C,A,a);if(o==null&&V.compile&&(s.partials[s.name]=V.compile(C,i.compilerOptions,V),o=s.partials[s.name](A,a)),o!=null){if(s.indent){for(var n=o.split(`
`),l=0,c=n.length;l<c&&!(!n[l]&&l+1===c);l++)n[l]=s.indent+n[l];o=n.join(`
`)}return o}else throw new Ge.default("The partial "+s.name+" could not be compiled when running in runtime-only mode")}var e={strict:function(A,s,a){if(!A||!(s in A))throw new Ge.default('"'+s+'" not defined in '+A,{loc:a});return e.lookupProperty(A,s)},lookupProperty:function(A,s){var a=A[s];if(a==null||Object.prototype.hasOwnProperty.call(A,s)||ua.resultIsAllowed(a,e.protoAccessControl,s))return a},lookup:function(A,s){for(var a=A.length,o=0;o<a;o++){var n=A[o]&&e.lookupProperty(A[o],s);if(n!=null)return A[o][s]}},lambda:function(A,s){return typeof A=="function"?A.call(s):A},escapeExpression:Ze.escapeExpression,invokePartial:I,fn:function(A){var s=i[A];return s.decorator=i[A+"_d"],s},programs:[],program:function(A,s,a,o,n){var l=this.programs[A],c=this.fn(A);return s||n||o||a?l=GA(this,A,c,s,a,o,n):l||(l=this.programs[A]=GA(this,A,c)),l},data:function(A,s){for(;A&&s--;)A=A._parent;return A},mergeIfNeeded:function(A,s){var a=A||s;return A&&s&&A!==s&&(a=Ze.extend({},s,A)),a},nullContext:Object.seal({}),noop:V.VM.noop,compilerInfo:i.compiler};function t(C){var A=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],s=A.data;t._setup(A),!A.partial&&i.useData&&(s=wm(C,s));var a=void 0,o=i.useBlockParams?[]:void 0;i.useDepths&&(A.depths?a=C!=A.depths[0]?[C].concat(A.depths):A.depths:a=[C]);function n(l){return""+i.main(e,l,e.helpers,e.partials,s,o,a)}return n=wc(i.main,n,e,A.depths||[],s,o),n(C,A)}return t.isTop=!0,t._setup=function(C){if(C.partial)e.protoAccessControl=C.protoAccessControl,e.helpers=C.helpers,e.partials=C.partials,e.decorators=C.decorators,e.hooks=C.hooks;else{var A=Ze.extend({},V.helpers,C.helpers);Hm(A,e),e.helpers=A,i.usePartial&&(e.partials=e.mergeIfNeeded(C.partials,V.partials)),(i.usePartial||i.useDecorators)&&(e.decorators=Ze.extend({},V.decorators,C.decorators)),e.hooks={},e.protoAccessControl=ua.createProtoAccessControl(C);var s=C.allowCallsToHelperMissing||g;ma.moveHelperToHooks(e,"helperMissing",s),ma.moveHelperToHooks(e,"blockHelperMissing",s)}},t._child=function(C,A,s,a){if(i.useBlockParams&&!s)throw new Ge.default("must pass block params");if(i.useDepths&&!a)throw new Ge.default("must pass parent depths");return GA(e,C,i[C],A,0,s,a)},t}function GA(i,V,g,I,e,t,C){function A(s){var a=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],o=C;return C&&s!=C[0]&&!(s===i.nullContext&&C[0]===null)&&(o=[s].concat(C)),g(i,s,i.helpers,i.partials,a.data||I,t&&[a.blockParams].concat(t),o)}return A=wc(g,A,i,C,I,t),A.program=V,A.depth=C?C.length:0,A.blockParams=e||0,A}function Rm(i,V,g){return i?!i.call&&!g.name&&(g.name=i,i=g.partials[i]):g.name==="@partial-block"?i=g.data["partial-block"]:i=g.partials[g.name],i}function Ym(i,V,g){var I=g.data&&g.data["partial-block"];g.partial=!0,g.ids&&(g.data.contextPath=g.ids[0]||g.data.contextPath);var e=void 0;if(g.fn&&g.fn!==Yc&&function(){g.data=pe.createFrame(g.data);var t=g.fn;e=g.data["partial-block"]=function(A){var s=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return s.data=pe.createFrame(s.data),s.data["partial-block"]=I,t(A,s)},t.partials&&(g.partials=Ze.extend({},g.partials,t.partials))}(),i===void 0&&e&&(i=e),i===void 0)throw new Ge.default("The partial "+g.name+" could not be found");if(i instanceof Function)return i(V,g)}function Yc(){return""}function wm(i,V){return(!V||!("root"in V))&&(V=V?pe.createFrame(V):{},V.root=i),V}function wc(i,V,g,I,e,t){if(i.decorator){var C={};V=i.decorator(V,C,g,I&&I[0],e,t,I),Ze.extend(V,C)}return V}function Hm(i,V){Object.keys(i).forEach(function(g){var I=i[g];i[g]=fm(I,V)})}function fm(i,V){var g=V.lookupProperty;return Wm.wrapHelper(i,function(I){return Ze.extend({lookupProperty:g},I)})}var YA={exports:{}};(function(i,V){V.__esModule=!0,V.default=function(g){var I=typeof OI!="undefined"?OI:window,e=I.Handlebars;g.noConflict=function(){return I.Handlebars===g&&(I.Handlebars=e),g}},i.exports=V.default})(YA,YA.exports);(function(i,V){V.__esModule=!0;function g(u){return u&&u.__esModule?u:{default:u}}function I(u){if(u&&u.__esModule)return u;var b={};if(u!=null)for(var Z in u)Object.prototype.hasOwnProperty.call(u,Z)&&(b[Z]=u[Z]);return b.default=u,b}var e=xI,t=I(e),C=hs.exports,A=g(C),s=qI.exports,a=g(s),o=ag,n=I(o),l=Ct,c=I(l),d=YA.exports,h=g(d);function m(){var u=new t.HandlebarsEnvironment;return n.extend(u,t),u.SafeString=A.default,u.Exception=a.default,u.Utils=n,u.escapeExpression=n.escapeExpression,u.VM=c,u.template=function(b){return c.template(b,u)},u}var r=m();r.create=m,h.default(r),r.default=r,V.default=r,i.exports=V.default})(Cs,Cs.exports);var wA={exports:{}};(function(i,V){V.__esModule=!0;var g={helpers:{helperExpression:function(e){return e.type==="SubExpression"||(e.type==="MustacheStatement"||e.type==="BlockStatement")&&!!(e.params&&e.params.length||e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return e.parts.length===1&&!g.helpers.scopedId(e)&&!e.depth}}};V.default=g,i.exports=V.default})(wA,wA.exports);var Si={},ms={exports:{}};(function(i,V){V.__esModule=!0;var g=function(){var I={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(A,s,a,o,n,l,c){var d=l.length-1;switch(n){case 1:return l[d-1];case 2:this.$=o.prepareProgram(l[d]);break;case 3:this.$=l[d];break;case 4:this.$=l[d];break;case 5:this.$=l[d];break;case 6:this.$=l[d];break;case 7:this.$=l[d];break;case 8:this.$=l[d];break;case 9:this.$={type:"CommentStatement",value:o.stripComment(l[d]),strip:o.stripFlags(l[d],l[d]),loc:o.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:l[d],value:l[d],loc:o.locInfo(this._$)};break;case 11:this.$=o.prepareRawBlock(l[d-2],l[d-1],l[d],this._$);break;case 12:this.$={path:l[d-3],params:l[d-2],hash:l[d-1]};break;case 13:this.$=o.prepareBlock(l[d-3],l[d-2],l[d-1],l[d],!1,this._$);break;case 14:this.$=o.prepareBlock(l[d-3],l[d-2],l[d-1],l[d],!0,this._$);break;case 15:this.$={open:l[d-5],path:l[d-4],params:l[d-3],hash:l[d-2],blockParams:l[d-1],strip:o.stripFlags(l[d-5],l[d])};break;case 16:this.$={path:l[d-4],params:l[d-3],hash:l[d-2],blockParams:l[d-1],strip:o.stripFlags(l[d-5],l[d])};break;case 17:this.$={path:l[d-4],params:l[d-3],hash:l[d-2],blockParams:l[d-1],strip:o.stripFlags(l[d-5],l[d])};break;case 18:this.$={strip:o.stripFlags(l[d-1],l[d-1]),program:l[d]};break;case 19:var h=o.prepareBlock(l[d-2],l[d-1],l[d],l[d],!1,this._$),m=o.prepareProgram([h],l[d-1].loc);m.chained=!0,this.$={strip:l[d-2].strip,program:m,chain:!0};break;case 20:this.$=l[d];break;case 21:this.$={path:l[d-1],strip:o.stripFlags(l[d-2],l[d])};break;case 22:this.$=o.prepareMustache(l[d-3],l[d-2],l[d-1],l[d-4],o.stripFlags(l[d-4],l[d]),this._$);break;case 23:this.$=o.prepareMustache(l[d-3],l[d-2],l[d-1],l[d-4],o.stripFlags(l[d-4],l[d]),this._$);break;case 24:this.$={type:"PartialStatement",name:l[d-3],params:l[d-2],hash:l[d-1],indent:"",strip:o.stripFlags(l[d-4],l[d]),loc:o.locInfo(this._$)};break;case 25:this.$=o.preparePartialBlock(l[d-2],l[d-1],l[d],this._$);break;case 26:this.$={path:l[d-3],params:l[d-2],hash:l[d-1],strip:o.stripFlags(l[d-4],l[d])};break;case 27:this.$=l[d];break;case 28:this.$=l[d];break;case 29:this.$={type:"SubExpression",path:l[d-3],params:l[d-2],hash:l[d-1],loc:o.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:l[d],loc:o.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:o.id(l[d-2]),value:l[d],loc:o.locInfo(this._$)};break;case 32:this.$=o.id(l[d-1]);break;case 33:this.$=l[d];break;case 34:this.$=l[d];break;case 35:this.$={type:"StringLiteral",value:l[d],original:l[d],loc:o.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(l[d]),original:Number(l[d]),loc:o.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:l[d]==="true",original:l[d]==="true",loc:o.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:o.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:o.locInfo(this._$)};break;case 40:this.$=l[d];break;case 41:this.$=l[d];break;case 42:this.$=o.preparePath(!0,l[d],this._$);break;case 43:this.$=o.preparePath(!1,l[d],this._$);break;case 44:l[d-2].push({part:o.id(l[d]),original:l[d],separator:l[d-1]}),this.$=l[d-2];break;case 45:this.$=[{part:o.id(l[d]),original:l[d]}];break;case 46:this.$=[];break;case 47:l[d-1].push(l[d]);break;case 48:this.$=[];break;case 49:l[d-1].push(l[d]);break;case 50:this.$=[];break;case 51:l[d-1].push(l[d]);break;case 58:this.$=[];break;case 59:l[d-1].push(l[d]);break;case 64:this.$=[];break;case 65:l[d-1].push(l[d]);break;case 70:this.$=[];break;case 71:l[d-1].push(l[d]);break;case 78:this.$=[];break;case 79:l[d-1].push(l[d]);break;case 82:this.$=[];break;case 83:l[d-1].push(l[d]);break;case 86:this.$=[];break;case 87:l[d-1].push(l[d]);break;case 90:this.$=[];break;case 91:l[d-1].push(l[d]);break;case 94:this.$=[];break;case 95:l[d-1].push(l[d]);break;case 98:this.$=[l[d]];break;case 99:l[d-1].push(l[d]);break;case 100:this.$=[l[d]];break;case 101:l[d-1].push(l[d]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(A,s){throw new Error(A)},parse:function(A){var s=this,a=[0],o=[null],n=[],l=this.table,c="",d=0,h=0;this.lexer.setInput(A),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var m=this.lexer.yylloc;n.push(m);var r=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function u(){var R;return R=s.lexer.lex()||1,typeof R!="number"&&(R=s.symbols_[R]||R),R}for(var b,Z,p,G,X={},W,y,Y,f;;){if(Z=a[a.length-1],this.defaultActions[Z]?p=this.defaultActions[Z]:((b===null||typeof b=="undefined")&&(b=u()),p=l[Z]&&l[Z][b]),typeof p=="undefined"||!p.length||!p[0]){var L="";{f=[];for(W in l[Z])this.terminals_[W]&&W>2&&f.push("'"+this.terminals_[W]+"'");this.lexer.showPosition?L="Parse error on line "+(d+1)+`:
`+this.lexer.showPosition()+`
Expecting `+f.join(", ")+", got '"+(this.terminals_[b]||b)+"'":L="Parse error on line "+(d+1)+": Unexpected "+(b==1?"end of input":"'"+(this.terminals_[b]||b)+"'"),this.parseError(L,{text:this.lexer.match,token:this.terminals_[b]||b,line:this.lexer.yylineno,loc:m,expected:f})}}if(p[0]instanceof Array&&p.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Z+", token: "+b);switch(p[0]){case 1:a.push(b),o.push(this.lexer.yytext),n.push(this.lexer.yylloc),a.push(p[1]),b=null,h=this.lexer.yyleng,c=this.lexer.yytext,d=this.lexer.yylineno,m=this.lexer.yylloc;break;case 2:if(y=this.productions_[p[1]][1],X.$=o[o.length-y],X._$={first_line:n[n.length-(y||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(y||1)].first_column,last_column:n[n.length-1].last_column},r&&(X._$.range=[n[n.length-(y||1)].range[0],n[n.length-1].range[1]]),G=this.performAction.call(X,c,h,d,this.yy,p[1],o,n),typeof G!="undefined")return G;y&&(a=a.slice(0,-1*y*2),o=o.slice(0,-1*y),n=n.slice(0,-1*y)),a.push(this.productions_[p[1]][0]),o.push(X.$),n.push(X._$),Y=l[a[a.length-2]][a[a.length-1]],a.push(Y);break;case 3:return!0}}return!0}},e=function(){var C={EOF:1,parseError:function(s,a){if(this.yy.parser)this.yy.parser.parseError(s,a);else throw new Error(s)},setInput:function(s){return this._input=s,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var s=this._input[0];this.yytext+=s,this.yyleng++,this.offset++,this.match+=s,this.matched+=s;var a=s.match(/(?:\r\n?|\n).*/g);return a?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),s},unput:function(s){var a=s.length,o=s.split(/(?:\r\n?|\n)/g);this._input=s+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-a-1),this.offset-=a;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),o.length-1&&(this.yylineno-=o.length-1);var l=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:o?(o.length===n.length?this.yylloc.first_column:0)+n[n.length-o.length].length-o[0].length:this.yylloc.first_column-a},this.options.ranges&&(this.yylloc.range=[l[0],l[0]+this.yyleng-a]),this},more:function(){return this._more=!0,this},less:function(s){this.unput(this.match.slice(s))},pastInput:function(){var s=this.matched.substr(0,this.matched.length-this.match.length);return(s.length>20?"...":"")+s.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var s=this.match;return s.length<20&&(s+=this._input.substr(0,20-s.length)),(s.substr(0,20)+(s.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var s=this.pastInput(),a=new Array(s.length+1).join("-");return s+this.upcomingInput()+`
`+a+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var s,a,o,n,l;this._more||(this.yytext="",this.match="");for(var c=this._currentRules(),d=0;d<c.length&&(o=this._input.match(this.rules[c[d]]),!(o&&(!a||o[0].length>a[0].length)&&(a=o,n=d,!this.options.flex)));d++);return a?(l=a[0].match(/(?:\r\n?|\n).*/g),l&&(this.yylineno+=l.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:l?l[l.length-1].length-l[l.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length},this.yytext+=a[0],this.match+=a[0],this.matches=a,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(a[0].length),this.matched+=a[0],s=this.performAction.call(this,this.yy,this,c[n],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),s||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var s=this.next();return typeof s!="undefined"?s:this.lex()},begin:function(s){this.conditionStack.push(s)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(s){this.begin(s)}};return C.options={},C.performAction=function(s,a,o,n){function l(c,d){return a.yytext=a.yytext.substring(c,a.yyleng-d+c)}switch(o){case 0:if(a.yytext.slice(-2)==="\\\\"?(l(0,1),this.begin("mu")):a.yytext.slice(-1)==="\\"?(l(0,1),this.begin("emu")):this.begin("mu"),a.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(l(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(a.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return a.yytext=l(1,2).replace(/\\"/g,'"'),80;case 32:return a.yytext=l(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return a.yytext=a.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},C.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],C.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},C}();I.lexer=e;function t(){this.yy={}}return t.prototype=I,I.Parser=t,new t}();V.default=g,i.exports=V.default})(ms,ms.exports);var us={exports:{}},HA={exports:{}};(function(i,V){V.__esModule=!0;function g(a){return a&&a.__esModule?a:{default:a}}var I=qI.exports,e=g(I);function t(){this.parents=[]}t.prototype={constructor:t,mutating:!1,acceptKey:function(o,n){var l=this.accept(o[n]);if(this.mutating){if(l&&!t.prototype[l.type])throw new e.default('Unexpected node type "'+l.type+'" found when accepting '+n+" on "+o.type);o[n]=l}},acceptRequired:function(o,n){if(this.acceptKey(o,n),!o[n])throw new e.default(o.type+" requires "+n)},acceptArray:function(o){for(var n=0,l=o.length;n<l;n++)this.acceptKey(o,n),o[n]||(o.splice(n,1),n--,l--)},accept:function(o){if(!!o){if(!this[o.type])throw new e.default("Unknown type: "+o.type,o);this.current&&this.parents.unshift(this.current),this.current=o;var n=this[o.type](o);if(this.current=this.parents.shift(),!this.mutating||n)return n;if(n!==!1)return o}},Program:function(o){this.acceptArray(o.body)},MustacheStatement:C,Decorator:C,BlockStatement:A,DecoratorBlock:A,PartialStatement:s,PartialBlockStatement:function(o){s.call(this,o),this.acceptKey(o,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:C,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(o){this.acceptArray(o.pairs)},HashPair:function(o){this.acceptRequired(o,"value")}};function C(a){this.acceptRequired(a,"path"),this.acceptArray(a.params),this.acceptKey(a,"hash")}function A(a){C.call(this,a),this.acceptKey(a,"program"),this.acceptKey(a,"inverse")}function s(a){this.acceptRequired(a,"name"),this.acceptArray(a.params),this.acceptKey(a,"hash")}V.default=t,i.exports=V.default})(HA,HA.exports);(function(i,V){V.__esModule=!0;function g(o){return o&&o.__esModule?o:{default:o}}var I=HA.exports,e=g(I);function t(){var o=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=o}t.prototype=new e.default,t.prototype.Program=function(o){var n=!this.options.ignoreStandalone,l=!this.isRootSeen;this.isRootSeen=!0;for(var c=o.body,d=0,h=c.length;d<h;d++){var m=c[d],r=this.accept(m);if(!!r){var u=C(c,d,l),b=A(c,d,l),Z=r.openStandalone&&u,p=r.closeStandalone&&b,G=r.inlineStandalone&&u&&b;r.close&&s(c,d,!0),r.open&&a(c,d,!0),n&&G&&(s(c,d),a(c,d)&&m.type==="PartialStatement"&&(m.indent=/([ \t]+$)/.exec(c[d-1].original)[1])),n&&Z&&(s((m.program||m.inverse).body),a(c,d)),n&&p&&(s(c,d),a((m.inverse||m.program).body))}}return o},t.prototype.BlockStatement=t.prototype.DecoratorBlock=t.prototype.PartialBlockStatement=function(o){this.accept(o.program),this.accept(o.inverse);var n=o.program||o.inverse,l=o.program&&o.inverse,c=l,d=l;if(l&&l.chained)for(c=l.body[0].program;d.chained;)d=d.body[d.body.length-1].program;var h={open:o.openStrip.open,close:o.closeStrip.close,openStandalone:A(n.body),closeStandalone:C((c||n).body)};if(o.openStrip.close&&s(n.body,null,!0),l){var m=o.inverseStrip;m.open&&a(n.body,null,!0),m.close&&s(c.body,null,!0),o.closeStrip.open&&a(d.body,null,!0),!this.options.ignoreStandalone&&C(n.body)&&A(c.body)&&(a(n.body),s(c.body))}else o.closeStrip.open&&a(n.body,null,!0);return h},t.prototype.Decorator=t.prototype.MustacheStatement=function(o){return o.strip},t.prototype.PartialStatement=t.prototype.CommentStatement=function(o){var n=o.strip||{};return{inlineStandalone:!0,open:n.open,close:n.close}};function C(o,n,l){n===void 0&&(n=o.length);var c=o[n-1],d=o[n-2];if(!c)return l;if(c.type==="ContentStatement")return(d||!l?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(c.original)}function A(o,n,l){n===void 0&&(n=-1);var c=o[n+1],d=o[n+2];if(!c)return l;if(c.type==="ContentStatement")return(d||!l?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(c.original)}function s(o,n,l){var c=o[n==null?0:n+1];if(!(!c||c.type!=="ContentStatement"||!l&&c.rightStripped)){var d=c.value;c.value=c.value.replace(l?/^\s+/:/^[ \t]*\r?\n?/,""),c.rightStripped=c.value!==d}}function a(o,n,l){var c=o[n==null?o.length-1:n-1];if(!(!c||c.type!=="ContentStatement"||!l&&c.leftStripped)){var d=c.value;return c.value=c.value.replace(l?/\s+$/:/[ \t]+$/,""),c.leftStripped=c.value!==d,c.leftStripped}}V.default=t,i.exports=V.default})(us,us.exports);var kI={};kI.__esModule=!0;kI.SourceLocation=vm;kI.id=Nm;kI.stripFlags=Km;kI.stripComment=Jm;kI.preparePath=Mm;kI.prepareMustache=xm;kI.prepareRawBlock=km;kI.prepareBlock=zm;kI.prepareProgram=Tm;kI.preparePartialBlock=Lm;function Sm(i){return i&&i.__esModule?i:{default:i}}var Fm=qI.exports,el=Sm(Fm);function tl(i,V){if(V=V.path?V.path.original:V,i.path.original!==V){var g={loc:i.path.loc};throw new el.default(i.path.original+" doesn't match "+V,g)}}function vm(i,V){this.source=i,this.start={line:V.first_line,column:V.first_column},this.end={line:V.last_line,column:V.last_column}}function Nm(i){return/^\[.*\]$/.test(i)?i.substring(1,i.length-1):i}function Km(i,V){return{open:i.charAt(2)==="~",close:V.charAt(V.length-3)==="~"}}function Jm(i){return i.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function Mm(i,V,g){g=this.locInfo(g);for(var I=i?"@":"",e=[],t=0,C=0,A=V.length;C<A;C++){var s=V[C].part,a=V[C].original!==s;if(I+=(V[C].separator||"")+s,!a&&(s===".."||s==="."||s==="this")){if(e.length>0)throw new el.default("Invalid path: "+I,{loc:g});s===".."&&t++}else e.push(s)}return{type:"PathExpression",data:i,depth:t,parts:e,original:I,loc:g}}function xm(i,V,g,I,e,t){var C=I.charAt(3)||I.charAt(2),A=C!=="{"&&C!=="&",s=/\*/.test(I);return{type:s?"Decorator":"MustacheStatement",path:i,params:V,hash:g,escaped:A,strip:e,loc:this.locInfo(t)}}function km(i,V,g,I){tl(i,g),I=this.locInfo(I);var e={type:"Program",body:V,strip:{},loc:I};return{type:"BlockStatement",path:i.path,params:i.params,hash:i.hash,program:e,openStrip:{},inverseStrip:{},closeStrip:{},loc:I}}function zm(i,V,g,I,e,t){I&&I.path&&tl(i,I);var C=/\*/.test(i.open);V.blockParams=i.blockParams;var A=void 0,s=void 0;if(g){if(C)throw new el.default("Unexpected inverse block on decorator",g);g.chain&&(g.program.body[0].closeStrip=I.strip),s=g.strip,A=g.program}return e&&(e=A,A=V,V=e),{type:C?"DecoratorBlock":"BlockStatement",path:i.path,params:i.params,hash:i.hash,program:V,inverse:A,openStrip:i.strip,inverseStrip:s,closeStrip:I&&I.strip,loc:this.locInfo(t)}}function Tm(i,V){if(!V&&i.length){var g=i[0].loc,I=i[i.length-1].loc;g&&I&&(V={source:g.source,start:{line:g.start.line,column:g.start.column},end:{line:I.end.line,column:I.end.column}})}return{type:"Program",body:i,strip:{},loc:V}}function Lm(i,V,g,I){return tl(i,g),{type:"PartialBlockStatement",name:i.path,params:i.params,hash:i.hash,program:V,openStrip:i.strip,closeStrip:g&&g.strip,loc:this.locInfo(I)}}Si.__esModule=!0;Si.parseWithoutProcessing=fc;Si.parse=_m;function Um(i){if(i&&i.__esModule)return i;var V={};if(i!=null)for(var g in i)Object.prototype.hasOwnProperty.call(i,g)&&(V[g]=i[g]);return V.default=i,V}function Hc(i){return i&&i.__esModule?i:{default:i}}var Dm=ms.exports,bs=Hc(Dm),Em=us.exports,Qm=Hc(Em),jm=kI,Pm=Um(jm),Om=ag;Si.parser=bs.default;var pA={};Om.extend(pA,Pm);function fc(i,V){if(i.type==="Program")return i;bs.default.yy=pA,pA.locInfo=function(I){return new pA.SourceLocation(V&&V.srcName,I)};var g=bs.default.parse(i);return g}function _m(i,V){var g=fc(i,V),I=new Qm.default(V);return I.accept(g)}var Fi={};Fi.__esModule=!0;Fi.Compiler=Zs;Fi.precompile=Iu;Fi.compile=eu;function Sc(i){return i&&i.__esModule?i:{default:i}}var $m=qI.exports,Ii=Sc($m),di=ag,Vu=wA.exports,KC=Sc(Vu),gu=[].slice;function Zs(){}Zs.prototype={compiler:Zs,equals:function(V){var g=this.opcodes.length;if(V.opcodes.length!==g)return!1;for(var I=0;I<g;I++){var e=this.opcodes[I],t=V.opcodes[I];if(e.opcode!==t.opcode||!Fc(e.args,t.args))return!1}g=this.children.length;for(var I=0;I<g;I++)if(!this.children[I].equals(V.children[I]))return!1;return!0},guid:0,compile:function(V,g){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=g,this.stringParams=g.stringParams,this.trackIds=g.trackIds,g.blockParams=g.blockParams||[],g.knownHelpers=di.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},g.knownHelpers),this.accept(V)},compileProgram:function(V){var g=new this.compiler,I=g.compile(V,this.options),e=this.guid++;return this.usePartial=this.usePartial||I.usePartial,this.children[e]=I,this.useDepths=this.useDepths||I.useDepths,e},accept:function(V){if(!this[V.type])throw new Ii.default("Unknown type: "+V.type,V);this.sourceNode.unshift(V);var g=this[V.type](V);return this.sourceNode.shift(),g},Program:function(V){this.options.blockParams.unshift(V.blockParams);for(var g=V.body,I=g.length,e=0;e<I;e++)this.accept(g[e]);return this.options.blockParams.shift(),this.isSimple=I===1,this.blockParams=V.blockParams?V.blockParams.length:0,this},BlockStatement:function(V){ba(V);var g=V.program,I=V.inverse;g=g&&this.compileProgram(g),I=I&&this.compileProgram(I);var e=this.classifySexpr(V);e==="helper"?this.helperSexpr(V,g,I):e==="simple"?(this.simpleSexpr(V),this.opcode("pushProgram",g),this.opcode("pushProgram",I),this.opcode("emptyHash"),this.opcode("blockValue",V.path.original)):(this.ambiguousSexpr(V,g,I),this.opcode("pushProgram",g),this.opcode("pushProgram",I),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(V){var g=V.program&&this.compileProgram(V.program),I=this.setupFullMustacheParams(V,g,void 0),e=V.path;this.useDecorators=!0,this.opcode("registerDecorator",I.length,e.original)},PartialStatement:function(V){this.usePartial=!0;var g=V.program;g&&(g=this.compileProgram(V.program));var I=V.params;if(I.length>1)throw new Ii.default("Unsupported number of partial arguments: "+I.length,V);I.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):I.push({type:"PathExpression",parts:[],depth:0}));var e=V.name.original,t=V.name.type==="SubExpression";t&&this.accept(V.name),this.setupFullMustacheParams(V,g,void 0,!0);var C=V.indent||"";this.options.preventIndent&&C&&(this.opcode("appendContent",C),C=""),this.opcode("invokePartial",t,e,C),this.opcode("append")},PartialBlockStatement:function(V){this.PartialStatement(V)},MustacheStatement:function(V){this.SubExpression(V),V.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(V){this.DecoratorBlock(V)},ContentStatement:function(V){V.value&&this.opcode("appendContent",V.value)},CommentStatement:function(){},SubExpression:function(V){ba(V);var g=this.classifySexpr(V);g==="simple"?this.simpleSexpr(V):g==="helper"?this.helperSexpr(V):this.ambiguousSexpr(V)},ambiguousSexpr:function(V,g,I){var e=V.path,t=e.parts[0],C=g!=null||I!=null;this.opcode("getContext",e.depth),this.opcode("pushProgram",g),this.opcode("pushProgram",I),e.strict=!0,this.accept(e),this.opcode("invokeAmbiguous",t,C)},simpleSexpr:function(V){var g=V.path;g.strict=!0,this.accept(g),this.opcode("resolvePossibleLambda")},helperSexpr:function(V,g,I){var e=this.setupFullMustacheParams(V,g,I),t=V.path,C=t.parts[0];if(this.options.knownHelpers[C])this.opcode("invokeKnownHelper",e.length,C);else{if(this.options.knownHelpersOnly)throw new Ii.default("You specified knownHelpersOnly, but used the unknown helper "+C,V);t.strict=!0,t.falsy=!0,this.accept(t),this.opcode("invokeHelper",e.length,t.original,KC.default.helpers.simpleId(t))}},PathExpression:function(V){this.addDepth(V.depth),this.opcode("getContext",V.depth);var g=V.parts[0],I=KC.default.helpers.scopedId(V),e=!V.depth&&!I&&this.blockParamIndex(g);e?this.opcode("lookupBlockParam",e,V.parts):g?V.data?(this.options.data=!0,this.opcode("lookupData",V.depth,V.parts,V.strict)):this.opcode("lookupOnContext",V.parts,V.falsy,V.strict,I):this.opcode("pushContext")},StringLiteral:function(V){this.opcode("pushString",V.value)},NumberLiteral:function(V){this.opcode("pushLiteral",V.value)},BooleanLiteral:function(V){this.opcode("pushLiteral",V.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(V){var g=V.pairs,I=0,e=g.length;for(this.opcode("pushHash");I<e;I++)this.pushParam(g[I].value);for(;I--;)this.opcode("assignToHash",g[I].key);this.opcode("popHash")},opcode:function(V){this.opcodes.push({opcode:V,args:gu.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(V){!V||(this.useDepths=!0)},classifySexpr:function(V){var g=KC.default.helpers.simpleId(V.path),I=g&&!!this.blockParamIndex(V.path.parts[0]),e=!I&&KC.default.helpers.helperExpression(V),t=!I&&(e||g);if(t&&!e){var C=V.path.parts[0],A=this.options;A.knownHelpers[C]?e=!0:A.knownHelpersOnly&&(t=!1)}return e?"helper":t?"ambiguous":"simple"},pushParams:function(V){for(var g=0,I=V.length;g<I;g++)this.pushParam(V[g])},pushParam:function(V){var g=V.value!=null?V.value:V.original||"";if(this.stringParams)g.replace&&(g=g.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),V.depth&&this.addDepth(V.depth),this.opcode("getContext",V.depth||0),this.opcode("pushStringParam",g,V.type),V.type==="SubExpression"&&this.accept(V);else{if(this.trackIds){var I=void 0;if(V.parts&&!KC.default.helpers.scopedId(V)&&!V.depth&&(I=this.blockParamIndex(V.parts[0])),I){var e=V.parts.slice(1).join(".");this.opcode("pushId","BlockParam",I,e)}else g=V.original||g,g.replace&&(g=g.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",V.type,g)}this.accept(V)}},setupFullMustacheParams:function(V,g,I,e){var t=V.params;return this.pushParams(t),this.opcode("pushProgram",g),this.opcode("pushProgram",I),V.hash?this.accept(V.hash):this.opcode("emptyHash",e),t},blockParamIndex:function(V){for(var g=0,I=this.options.blockParams.length;g<I;g++){var e=this.options.blockParams[g],t=e&&di.indexOf(e,V);if(e&&t>=0)return[g,t]}}};function Iu(i,V,g){if(i==null||typeof i!="string"&&i.type!=="Program")throw new Ii.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+i);V=V||{},"data"in V||(V.data=!0),V.compat&&(V.useDepths=!0);var I=g.parse(i,V),e=new g.Compiler().compile(I,V);return new g.JavaScriptCompiler().compile(e,V)}function eu(i,V,g){if(V===void 0&&(V={}),i==null||typeof i!="string"&&i.type!=="Program")throw new Ii.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+i);V=di.extend({},V),"data"in V||(V.data=!0),V.compat&&(V.useDepths=!0);var I=void 0;function e(){var C=g.parse(i,V),A=new g.Compiler().compile(C,V),s=new g.JavaScriptCompiler().compile(A,V,void 0,!0);return g.template(s)}function t(C,A){return I||(I=e()),I.call(this,C,A)}return t._setup=function(C){return I||(I=e()),I._setup(C)},t._child=function(C,A,s,a){return I||(I=e()),I._child(C,A,s,a)},t}function Fc(i,V){if(i===V)return!0;if(di.isArray(i)&&di.isArray(V)&&i.length===V.length){for(var g=0;g<i.length;g++)if(!Fc(i[g],V[g]))return!1;return!0}}function ba(i){if(!i.path.parts){var V=i.path;i.path={type:"PathExpression",data:!1,depth:0,parts:[V.original+""],original:V.original+"",loc:V.loc}}}var Gs={exports:{}},ps={exports:{}};(function(i,V){V.__esModule=!0;var g=ag,I=void 0;try{var e=require("source-map");I=e.SourceNode}catch(A){}I||(I=function(A,s,a,o){this.src="",o&&this.add(o)},I.prototype={add:function(s){g.isArray(s)&&(s=s.join("")),this.src+=s},prepend:function(s){g.isArray(s)&&(s=s.join("")),this.src=s+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function t(A,s,a){if(g.isArray(A)){for(var o=[],n=0,l=A.length;n<l;n++)o.push(s.wrap(A[n],a));return o}else if(typeof A=="boolean"||typeof A=="number")return A+"";return A}function C(A){this.srcFile=A,this.source=[]}C.prototype={isEmpty:function(){return!this.source.length},prepend:function(s,a){this.source.unshift(this.wrap(s,a))},push:function(s,a){this.source.push(this.wrap(s,a))},merge:function(){var s=this.empty();return this.each(function(a){s.add(["  ",a,`
`])}),s},each:function(s){for(var a=0,o=this.source.length;a<o;a++)s(this.source[a])},empty:function(){var s=this.currentLocation||{start:{}};return new I(s.start.line,s.start.column,this.srcFile)},wrap:function(s){var a=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return s instanceof I?s:(s=t(s,this,a),new I(a.start.line,a.start.column,this.srcFile,s))},functionCall:function(s,a,o){return o=this.generateList(o),this.wrap([s,a?"."+a+"(":"(",o,")"])},quotedString:function(s){return'"'+(s+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(s){var a=this,o=[];Object.keys(s).forEach(function(l){var c=t(s[l],a);c!=="undefined"&&o.push([a.quotedString(l),":",c])});var n=this.generateList(o);return n.prepend("{"),n.add("}"),n},generateList:function(s){for(var a=this.empty(),o=0,n=s.length;o<n;o++)o&&a.add(","),a.add(t(s[o],this));return a},generateArray:function(s){var a=this.generateList(s);return a.prepend("["),a.add("]"),a}},V.default=C,i.exports=V.default})(ps,ps.exports);(function(i,V){V.__esModule=!0;function g(l){return l&&l.__esModule?l:{default:l}}var I=xI,e=qI.exports,t=g(e),C=ag,A=ps.exports,s=g(A);function a(l){this.value=l}function o(){}o.prototype={nameLookup:function(c,d){return this.internalNameLookup(c,d)},depthedLookup:function(c){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(c),")"]},compilerInfo:function(){var c=I.COMPILER_REVISION,d=I.REVISION_CHANGES[c];return[c,d]},appendToBuffer:function(c,d,h){return C.isArray(c)||(c=[c]),c=this.source.wrap(c,d),this.environment.isSimple?["return ",c,";"]:h?["buffer += ",c,";"]:(c.appendToBuffer=!0,c)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(c,d){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",c,",",JSON.stringify(d),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(c,d,h,m){this.environment=c,this.options=d,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!m,this.name=this.environment.name,this.isChild=!!h,this.context=h||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(c,d),this.useDepths=this.useDepths||c.useDepths||c.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||c.useBlockParams;var r=c.opcodes,u=void 0,b=void 0,Z=void 0,p=void 0;for(Z=0,p=r.length;Z<p;Z++)u=r[Z],this.source.currentLocation=u.loc,b=b||u.loc,this[u.opcode].apply(this,u.args);if(this.source.currentLocation=b,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new t.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),m?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var G=this.createFunctionContext(m);if(this.isChild)return G;var X={compiler:this.compilerInfo(),main:G};this.decorators&&(X.main_d=this.decorators,X.useDecorators=!0);var W=this.context,y=W.programs,Y=W.decorators;for(Z=0,p=y.length;Z<p;Z++)y[Z]&&(X[Z]=y[Z],Y[Z]&&(X[Z+"_d"]=Y[Z],X.useDecorators=!0));return this.environment.usePartial&&(X.usePartial=!0),this.options.data&&(X.useData=!0),this.useDepths&&(X.useDepths=!0),this.useBlockParams&&(X.useBlockParams=!0),this.options.compat&&(X.compat=!0),m?X.compilerOptions=this.options:(X.compiler=JSON.stringify(X.compiler),this.source.currentLocation={start:{line:1,column:0}},X=this.objectLiteral(X),d.srcName?(X=X.toStringWithSourceMap({file:d.destName}),X.map=X.map&&X.map.toString()):X=X.toString()),X},preamble:function(){this.lastContext=0,this.source=new s.default(this.options.srcName),this.decorators=new s.default(this.options.srcName)},createFunctionContext:function(c){var d=this,h="",m=this.stackVars.concat(this.registers.list);m.length>0&&(h+=", "+m.join(", "));var r=0;Object.keys(this.aliases).forEach(function(Z){var p=d.aliases[Z];p.children&&p.referenceCount>1&&(h+=", alias"+ ++r+"="+Z,p.children[0]="alias"+r)}),this.lookupPropertyFunctionIsUsed&&(h+=", "+this.lookupPropertyFunctionVarDeclaration());var u=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&u.push("blockParams"),this.useDepths&&u.push("depths");var b=this.mergeSource(h);return c?(u.push(b),Function.apply(this,u)):this.source.wrap(["function(",u.join(","),`) {
  `,b,"}"])},mergeSource:function(c){var d=this.environment.isSimple,h=!this.forceBuffer,m=void 0,r=void 0,u=void 0,b=void 0;return this.source.each(function(Z){Z.appendToBuffer?(u?Z.prepend("  + "):u=Z,b=Z):(u&&(r?u.prepend("buffer += "):m=!0,b.add(";"),u=b=void 0),r=!0,d||(h=!1))}),h?u?(u.prepend("return "),b.add(";")):r||this.source.push('return "";'):(c+=", buffer = "+(m?"":this.initializeBuffer()),u?(u.prepend("return buffer + "),b.add(";")):this.source.push("return buffer;")),c&&this.source.prepend("var "+c.substring(2)+(m?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(c){var d=this.aliasable("container.hooks.blockHelperMissing"),h=[this.contextName(0)];this.setupHelperArgs(c,0,h);var m=this.popStack();h.splice(1,0,m),this.push(this.source.functionCall(d,"call",h))},ambiguousBlockValue:function(){var c=this.aliasable("container.hooks.blockHelperMissing"),d=[this.contextName(0)];this.setupHelperArgs("",0,d,!0),this.flushInline();var h=this.topStack();d.splice(1,0,h),this.pushSource(["if (!",this.lastHelper,") { ",h," = ",this.source.functionCall(c,"call",d),"}"])},appendContent:function(c){this.pendingContent?c=this.pendingContent+c:this.pendingLocation=this.source.currentLocation,this.pendingContent=c},append:function(){if(this.isInline())this.replaceStack(function(d){return[" != null ? ",d,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var c=this.popStack();this.pushSource(["if (",c," != null) { ",this.appendToBuffer(c,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(c){this.lastContext=c},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(c,d,h,m){var r=0;!m&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(c[r++])):this.pushContext(),this.resolvePath("context",c,r,d,h)},lookupBlockParam:function(c,d){this.useBlockParams=!0,this.push(["blockParams[",c[0],"][",c[1],"]"]),this.resolvePath("context",d,1)},lookupData:function(c,d,h){c?this.pushStackLiteral("container.data(data, "+c+")"):this.pushStackLiteral("data"),this.resolvePath("data",d,0,!0,h)},resolvePath:function(c,d,h,m,r){var u=this;if(this.options.strict||this.options.assumeObjects){this.push(n(this.options.strict&&r,this,d,c));return}for(var b=d.length;h<b;h++)this.replaceStack(function(Z){var p=u.nameLookup(Z,d[h],c);return m?[" && ",p]:[" != null ? ",p," : ",Z]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(c,d){this.pushContext(),this.pushString(d),d!=="SubExpression"&&(typeof c=="string"?this.pushString(c):this.pushStackLiteral(c))},emptyHash:function(c){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(c?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var c=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(c.ids)),this.stringParams&&(this.push(this.objectLiteral(c.contexts)),this.push(this.objectLiteral(c.types))),this.push(this.objectLiteral(c.values))},pushString:function(c){this.pushStackLiteral(this.quotedString(c))},pushLiteral:function(c){this.pushStackLiteral(c)},pushProgram:function(c){c!=null?this.pushStackLiteral(this.programExpression(c)):this.pushStackLiteral(null)},registerDecorator:function(c,d){var h=this.nameLookup("decorators",d,"decorator"),m=this.setupHelperArgs(d,c);this.decorators.push(["fn = ",this.decorators.functionCall(h,"",["fn","props","container",m])," || fn;"])},invokeHelper:function(c,d,h){var m=this.popStack(),r=this.setupHelper(c,d),u=[];h&&u.push(r.name),u.push(m),this.options.strict||u.push(this.aliasable("container.hooks.helperMissing"));var b=["(",this.itemsSeparatedBy(u,"||"),")"],Z=this.source.functionCall(b,"call",r.callParams);this.push(Z)},itemsSeparatedBy:function(c,d){var h=[];h.push(c[0]);for(var m=1;m<c.length;m++)h.push(d,c[m]);return h},invokeKnownHelper:function(c,d){var h=this.setupHelper(c,d);this.push(this.source.functionCall(h.name,"call",h.callParams))},invokeAmbiguous:function(c,d){this.useRegister("helper");var h=this.popStack();this.emptyHash();var m=this.setupHelper(0,c,d),r=this.lastHelper=this.nameLookup("helpers",c,"helper"),u=["(","(helper = ",r," || ",h,")"];this.options.strict||(u[0]="(helper = ",u.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",u,m.paramsInit?["),(",m.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",m.callParams)," : helper))"])},invokePartial:function(c,d,h){var m=[],r=this.setupParams(d,1,m);c&&(d=this.popStack(),delete r.name),h&&(r.indent=JSON.stringify(h)),r.helpers="helpers",r.partials="partials",r.decorators="container.decorators",c?m.unshift(d):m.unshift(this.nameLookup("partials",d,"partial")),this.options.compat&&(r.depths="depths"),r=this.objectLiteral(r),m.push(r),this.push(this.source.functionCall("container.invokePartial","",m))},assignToHash:function(c){var d=this.popStack(),h=void 0,m=void 0,r=void 0;this.trackIds&&(r=this.popStack()),this.stringParams&&(m=this.popStack(),h=this.popStack());var u=this.hash;h&&(u.contexts[c]=h),m&&(u.types[c]=m),r&&(u.ids[c]=r),u.values[c]=d},pushId:function(c,d,h){c==="BlockParam"?this.pushStackLiteral("blockParams["+d[0]+"].path["+d[1]+"]"+(h?" + "+JSON.stringify("."+h):"")):c==="PathExpression"?this.pushString(d):c==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:o,compileChildren:function(c,d){for(var h=c.children,m=void 0,r=void 0,u=0,b=h.length;u<b;u++){m=h[u],r=new this.compiler;var Z=this.matchExistingProgram(m);if(Z==null){this.context.programs.push("");var p=this.context.programs.length;m.index=p,m.name="program"+p,this.context.programs[p]=r.compile(m,d,this.context,!this.precompile),this.context.decorators[p]=r.decorators,this.context.environments[p]=m,this.useDepths=this.useDepths||r.useDepths,this.useBlockParams=this.useBlockParams||r.useBlockParams,m.useDepths=this.useDepths,m.useBlockParams=this.useBlockParams}else m.index=Z.index,m.name="program"+Z.index,this.useDepths=this.useDepths||Z.useDepths,this.useBlockParams=this.useBlockParams||Z.useBlockParams}},matchExistingProgram:function(c){for(var d=0,h=this.context.environments.length;d<h;d++){var m=this.context.environments[d];if(m&&m.equals(c))return m}},programExpression:function(c){var d=this.environment.children[c],h=[d.index,"data",d.blockParams];return(this.useBlockParams||this.useDepths)&&h.push("blockParams"),this.useDepths&&h.push("depths"),"container.program("+h.join(", ")+")"},useRegister:function(c){this.registers[c]||(this.registers[c]=!0,this.registers.list.push(c))},push:function(c){return c instanceof a||(c=this.source.wrap(c)),this.inlineStack.push(c),c},pushStackLiteral:function(c){this.push(new a(c))},pushSource:function(c){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),c&&this.source.push(c)},replaceStack:function(c){var d=["("],h=void 0,m=void 0,r=void 0;if(!this.isInline())throw new t.default("replaceStack on non-inline");var u=this.popStack(!0);if(u instanceof a)h=[u.value],d=["(",h],r=!0;else{m=!0;var b=this.incrStack();d=["((",this.push(b)," = ",u,")"],h=this.topStack()}var Z=c.call(this,h);r||this.popStack(),m&&this.stackSlot--,this.push(d.concat(Z,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var c=this.inlineStack;this.inlineStack=[];for(var d=0,h=c.length;d<h;d++){var m=c[d];if(m instanceof a)this.compileStack.push(m);else{var r=this.incrStack();this.pushSource([r," = ",m,";"]),this.compileStack.push(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(c){var d=this.isInline(),h=(d?this.inlineStack:this.compileStack).pop();if(!c&&h instanceof a)return h.value;if(!d){if(!this.stackSlot)throw new t.default("Invalid stack pop");this.stackSlot--}return h},topStack:function(){var c=this.isInline()?this.inlineStack:this.compileStack,d=c[c.length-1];return d instanceof a?d.value:d},contextName:function(c){return this.useDepths&&c?"depths["+c+"]":"depth"+c},quotedString:function(c){return this.source.quotedString(c)},objectLiteral:function(c){return this.source.objectLiteral(c)},aliasable:function(c){var d=this.aliases[c];return d?(d.referenceCount++,d):(d=this.aliases[c]=this.source.wrap(c),d.aliasable=!0,d.referenceCount=1,d)},setupHelper:function(c,d,h){var m=[],r=this.setupHelperArgs(d,c,m,h),u=this.nameLookup("helpers",d,"helper"),b=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:m,paramsInit:r,name:u,callParams:[b].concat(m)}},setupParams:function(c,d,h){var m={},r=[],u=[],b=[],Z=!h,p=void 0;Z&&(h=[]),m.name=this.quotedString(c),m.hash=this.popStack(),this.trackIds&&(m.hashIds=this.popStack()),this.stringParams&&(m.hashTypes=this.popStack(),m.hashContexts=this.popStack());var G=this.popStack(),X=this.popStack();(X||G)&&(m.fn=X||"container.noop",m.inverse=G||"container.noop");for(var W=d;W--;)p=this.popStack(),h[W]=p,this.trackIds&&(b[W]=this.popStack()),this.stringParams&&(u[W]=this.popStack(),r[W]=this.popStack());return Z&&(m.args=this.source.generateArray(h)),this.trackIds&&(m.ids=this.source.generateArray(b)),this.stringParams&&(m.types=this.source.generateArray(u),m.contexts=this.source.generateArray(r)),this.options.data&&(m.data="data"),this.useBlockParams&&(m.blockParams="blockParams"),m},setupHelperArgs:function(c,d,h,m){var r=this.setupParams(c,d,h);return r.loc=JSON.stringify(this.source.currentLocation),r=this.objectLiteral(r),m?(this.useRegister("options"),h.push("options"),["options=",r]):h?(h.push(r),""):r}},function(){for(var l="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),c=o.RESERVED_WORDS={},d=0,h=l.length;d<h;d++)c[l[d]]=!0}(),o.isValidJavaScriptVariableName=function(l){return!o.RESERVED_WORDS[l]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(l)};function n(l,c,d,h){var m=c.popStack(),r=0,u=d.length;for(l&&u--;r<u;r++)m=c.nameLookup(m,d[r],h);return l?[c.aliasable("container.strict"),"(",m,", ",c.quotedString(d[r]),", ",JSON.stringify(c.source.currentLocation)," )"]:m}V.default=o,i.exports=V.default})(Gs,Gs.exports);(function(i,V){V.__esModule=!0;function g(u){return u&&u.__esModule?u:{default:u}}var I=Cs.exports,e=g(I),t=wA.exports,C=g(t),A=Si,s=Fi,a=Gs.exports,o=g(a),n=HA.exports,l=g(n),c=YA.exports,d=g(c),h=e.default.create;function m(){var u=h();return u.compile=function(b,Z){return s.compile(b,Z,u)},u.precompile=function(b,Z){return s.precompile(b,Z,u)},u.AST=C.default,u.Compiler=s.Compiler,u.JavaScriptCompiler=o.default,u.Parser=A.parser,u.parse=A.parse,u.parseWithoutProcessing=A.parseWithoutProcessing,u}var r=m();r.create=m,d.default(r),r.Visitor=l.default,r.default=r,V.default=r,i.exports=V.default})(ts,ts.exports);var vc=Bh(ts.exports);const Za={add:function(i,V){return parseInt(i)+V},"if-equals":function(i,V,g){return i==V?g.fn(this):g.inverse(this)},"if-not-equals":function(i,V,g){return i!==V?g.fn(this):g.inverse(this)},stringify:function(i){return JSON.stringify(i)},repeat:function(i,V){let g="";for(let I=0,e=i;I<e;I++)g+=V.fn(I+1);return g}};for(const i in Za)vc.registerHelper(i,Za[i]);for(const i in data.partials){const V=i.replace("./",""),g=data.partials[V],I=new Uint8Array(g.data),e=new TextDecoder().decode(I);vc.registerPartial(V,e)}/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Nc="130",tu=0,Ga=1,Cu=2,Kc=1,iu=2,_C=3,rC=0,wg=1,yt=2,Jc=1,ei=0,ti=1,pa=2,qa=3,Ba=4,Au=5,IC=100,nu=101,su=102,Wa=103,ya=104,lu=200,au=201,ou=202,cu=203,Mc=204,xc=205,du=206,ru=207,hu=208,mu=209,uu=210,bu=0,Zu=1,Gu=2,qs=3,pu=4,qu=5,Bu=6,Wu=7,EA=0,yu=1,Xu=2,nC=0,Ru=1,Yu=2,wu=3,Hu=4,fu=5,kc=300,Cl=301,il=302,Xa=303,Ra=304,Al=306,nl=307,Vt=1e3,lI=1001,fA=1002,Lg=1003,Bs=1004,Ws=1005,Sg=1006,zc=1007,XC=1008,ys=1008,SA=1009,Su=1010,Fu=1011,FA=1012,vu=1013,qA=1014,ze=1015,sC=1016,Nu=1017,Ku=1018,Ju=1019,Ci=1020,Mu=1021,je=1022,NI=1023,xu=1024,ku=1025,lC=1026,ri=1027,zu=1028,Tu=1029,Lu=1030,Uu=1031,Du=1032,Eu=1033,Ya=33776,wa=33777,Ha=33778,fa=33779,Sa=35840,Fa=35841,va=35842,Na=35843,Qu=36196,Ka=37492,Ja=37496,ju=37808,Pu=37809,Ou=37810,_u=37811,$u=37812,Vb=37813,gb=37814,Ib=37815,eb=37816,tb=37817,Cb=37818,ib=37819,Ab=37820,nb=37821,sb=36492,lb=37840,ab=37841,ob=37842,cb=37843,db=37844,rb=37845,hb=37846,mb=37847,ub=37848,bb=37849,Zb=37850,Gb=37851,pb=37852,qb=37853,Bb=2200,Wb=2201,yb=2202,hi=2300,hC=2301,dn=2302,eC=2400,tC=2401,vA=2402,sl=2500,Tc=2501,Xb=0,Rb=1,Lc=2,vi=3e3,NA=3001,Yb=3007,wb=3002,Hb=3003,fb=3004,Sb=3005,Fb=3006,vb=3200,Nb=3201,Yt=0,Kb=1,rn=7680,Jb=7681,Ma=517,Mb=519,mi=35044,KA=35048,xa="300 es";class wt{addEventListener(V,g){this._listeners===void 0&&(this._listeners={});const I=this._listeners;I[V]===void 0&&(I[V]=[]),I[V].indexOf(g)===-1&&I[V].push(g)}hasEventListener(V,g){if(this._listeners===void 0)return!1;const I=this._listeners;return I[V]!==void 0&&I[V].indexOf(g)!==-1}removeEventListener(V,g){if(this._listeners===void 0)return;const e=this._listeners[V];if(e!==void 0){const t=e.indexOf(g);t!==-1&&e.splice(t,1)}}dispatchEvent(V){if(this._listeners===void 0)return;const I=this._listeners[V.type];if(I!==void 0){V.target=this;const e=I.slice(0);for(let t=0,C=e.length;t<C;t++)e[t].call(this,V);V.target=null}}}const Tg=[];for(let i=0;i<256;i++)Tg[i]=(i<16?"0":"")+i.toString(16);let zi=1234567;const ii=Math.PI/180,ui=180/Math.PI;function KI(){const i=Math.random()*4294967295|0,V=Math.random()*4294967295|0,g=Math.random()*4294967295|0,I=Math.random()*4294967295|0;return(Tg[i&255]+Tg[i>>8&255]+Tg[i>>16&255]+Tg[i>>24&255]+"-"+Tg[V&255]+Tg[V>>8&255]+"-"+Tg[V>>16&15|64]+Tg[V>>24&255]+"-"+Tg[g&63|128]+Tg[g>>8&255]+"-"+Tg[g>>16&255]+Tg[g>>24&255]+Tg[I&255]+Tg[I>>8&255]+Tg[I>>16&255]+Tg[I>>24&255]).toUpperCase()}function eI(i,V,g){return Math.max(V,Math.min(g,i))}function ll(i,V){return(i%V+V)%V}function xb(i,V,g,I,e){return I+(i-V)*(e-I)/(g-V)}function kb(i,V,g){return i!==V?(g-i)/(V-i):0}function Ai(i,V,g){return(1-g)*i+g*V}function zb(i,V,g,I){return Ai(i,V,1-Math.exp(-g*I))}function Tb(i,V=1){return V-Math.abs(ll(i,V*2)-V)}function Lb(i,V,g){return i<=V?0:i>=g?1:(i=(i-V)/(g-V),i*i*(3-2*i))}function Ub(i,V,g){return i<=V?0:i>=g?1:(i=(i-V)/(g-V),i*i*i*(i*(i*6-15)+10))}function Db(i,V){return i+Math.floor(Math.random()*(V-i+1))}function Eb(i,V){return i+Math.random()*(V-i)}function Qb(i){return i*(.5-Math.random())}function jb(i){return i!==void 0&&(zi=i%2147483647),zi=zi*16807%2147483647,(zi-1)/2147483646}function Pb(i){return i*ii}function Ob(i){return i*ui}function Xs(i){return(i&i-1)===0&&i!==0}function Uc(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Dc(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function _b(i,V,g,I,e){const t=Math.cos,C=Math.sin,A=t(g/2),s=C(g/2),a=t((V+I)/2),o=C((V+I)/2),n=t((V-I)/2),l=C((V-I)/2),c=t((I-V)/2),d=C((I-V)/2);switch(e){case"XYX":i.set(A*o,s*n,s*l,A*a);break;case"YZY":i.set(s*l,A*o,s*n,A*a);break;case"ZXZ":i.set(s*n,s*l,A*o,A*a);break;case"XZX":i.set(A*o,s*d,s*c,A*a);break;case"YXY":i.set(s*c,A*o,s*d,A*a);break;case"ZYZ":i.set(s*d,s*c,A*o,A*a);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+e)}}var Ec=Object.freeze({__proto__:null,DEG2RAD:ii,RAD2DEG:ui,generateUUID:KI,clamp:eI,euclideanModulo:ll,mapLinear:xb,inverseLerp:kb,lerp:Ai,damp:zb,pingpong:Tb,smoothstep:Lb,smootherstep:Ub,randInt:Db,randFloat:Eb,randFloatSpread:Qb,seededRandom:jb,degToRad:Pb,radToDeg:Ob,isPowerOfTwo:Xs,ceilPowerOfTwo:Uc,floorPowerOfTwo:Dc,setQuaternionFromProperEuler:_b});class dV{constructor(V=0,g=0){this.x=V,this.y=g}get width(){return this.x}set width(V){this.x=V}get height(){return this.y}set height(V){this.y=V}set(V,g){return this.x=V,this.y=g,this}setScalar(V){return this.x=V,this.y=V,this}setX(V){return this.x=V,this}setY(V){return this.y=V,this}setComponent(V,g){switch(V){case 0:this.x=g;break;case 1:this.y=g;break;default:throw new Error("index is out of range: "+V)}return this}getComponent(V){switch(V){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+V)}}clone(){return new this.constructor(this.x,this.y)}copy(V){return this.x=V.x,this.y=V.y,this}add(V,g){return g!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(V,g)):(this.x+=V.x,this.y+=V.y,this)}addScalar(V){return this.x+=V,this.y+=V,this}addVectors(V,g){return this.x=V.x+g.x,this.y=V.y+g.y,this}addScaledVector(V,g){return this.x+=V.x*g,this.y+=V.y*g,this}sub(V,g){return g!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(V,g)):(this.x-=V.x,this.y-=V.y,this)}subScalar(V){return this.x-=V,this.y-=V,this}subVectors(V,g){return this.x=V.x-g.x,this.y=V.y-g.y,this}multiply(V){return this.x*=V.x,this.y*=V.y,this}multiplyScalar(V){return this.x*=V,this.y*=V,this}divide(V){return this.x/=V.x,this.y/=V.y,this}divideScalar(V){return this.multiplyScalar(1/V)}applyMatrix3(V){const g=this.x,I=this.y,e=V.elements;return this.x=e[0]*g+e[3]*I+e[6],this.y=e[1]*g+e[4]*I+e[7],this}min(V){return this.x=Math.min(this.x,V.x),this.y=Math.min(this.y,V.y),this}max(V){return this.x=Math.max(this.x,V.x),this.y=Math.max(this.y,V.y),this}clamp(V,g){return this.x=Math.max(V.x,Math.min(g.x,this.x)),this.y=Math.max(V.y,Math.min(g.y,this.y)),this}clampScalar(V,g){return this.x=Math.max(V,Math.min(g,this.x)),this.y=Math.max(V,Math.min(g,this.y)),this}clampLength(V,g){const I=this.length();return this.divideScalar(I||1).multiplyScalar(Math.max(V,Math.min(g,I)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(V){return this.x*V.x+this.y*V.y}cross(V){return this.x*V.y-this.y*V.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(V){return Math.sqrt(this.distanceToSquared(V))}distanceToSquared(V){const g=this.x-V.x,I=this.y-V.y;return g*g+I*I}manhattanDistanceTo(V){return Math.abs(this.x-V.x)+Math.abs(this.y-V.y)}setLength(V){return this.normalize().multiplyScalar(V)}lerp(V,g){return this.x+=(V.x-this.x)*g,this.y+=(V.y-this.y)*g,this}lerpVectors(V,g,I){return this.x=V.x+(g.x-V.x)*I,this.y=V.y+(g.y-V.y)*I,this}equals(V){return V.x===this.x&&V.y===this.y}fromArray(V,g=0){return this.x=V[g],this.y=V[g+1],this}toArray(V=[],g=0){return V[g]=this.x,V[g+1]=this.y,V}fromBufferAttribute(V,g,I){return I!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=V.getX(g),this.y=V.getY(g),this}rotateAround(V,g){const I=Math.cos(g),e=Math.sin(g),t=this.x-V.x,C=this.y-V.y;return this.x=t*I-C*e+V.x,this.y=t*e+C*I+V.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}dV.prototype.isVector2=!0;class Dg{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(V,g,I,e,t,C,A,s,a){const o=this.elements;return o[0]=V,o[1]=e,o[2]=A,o[3]=g,o[4]=t,o[5]=s,o[6]=I,o[7]=C,o[8]=a,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(V){const g=this.elements,I=V.elements;return g[0]=I[0],g[1]=I[1],g[2]=I[2],g[3]=I[3],g[4]=I[4],g[5]=I[5],g[6]=I[6],g[7]=I[7],g[8]=I[8],this}extractBasis(V,g,I){return V.setFromMatrix3Column(this,0),g.setFromMatrix3Column(this,1),I.setFromMatrix3Column(this,2),this}setFromMatrix4(V){const g=V.elements;return this.set(g[0],g[4],g[8],g[1],g[5],g[9],g[2],g[6],g[10]),this}multiply(V){return this.multiplyMatrices(this,V)}premultiply(V){return this.multiplyMatrices(V,this)}multiplyMatrices(V,g){const I=V.elements,e=g.elements,t=this.elements,C=I[0],A=I[3],s=I[6],a=I[1],o=I[4],n=I[7],l=I[2],c=I[5],d=I[8],h=e[0],m=e[3],r=e[6],u=e[1],b=e[4],Z=e[7],p=e[2],G=e[5],X=e[8];return t[0]=C*h+A*u+s*p,t[3]=C*m+A*b+s*G,t[6]=C*r+A*Z+s*X,t[1]=a*h+o*u+n*p,t[4]=a*m+o*b+n*G,t[7]=a*r+o*Z+n*X,t[2]=l*h+c*u+d*p,t[5]=l*m+c*b+d*G,t[8]=l*r+c*Z+d*X,this}multiplyScalar(V){const g=this.elements;return g[0]*=V,g[3]*=V,g[6]*=V,g[1]*=V,g[4]*=V,g[7]*=V,g[2]*=V,g[5]*=V,g[8]*=V,this}determinant(){const V=this.elements,g=V[0],I=V[1],e=V[2],t=V[3],C=V[4],A=V[5],s=V[6],a=V[7],o=V[8];return g*C*o-g*A*a-I*t*o+I*A*s+e*t*a-e*C*s}invert(){const V=this.elements,g=V[0],I=V[1],e=V[2],t=V[3],C=V[4],A=V[5],s=V[6],a=V[7],o=V[8],n=o*C-A*a,l=A*s-o*t,c=a*t-C*s,d=g*n+I*l+e*c;if(d===0)return this.set(0,0,0,0,0,0,0,0,0);const h=1/d;return V[0]=n*h,V[1]=(e*a-o*I)*h,V[2]=(A*I-e*C)*h,V[3]=l*h,V[4]=(o*g-e*s)*h,V[5]=(e*t-A*g)*h,V[6]=c*h,V[7]=(I*s-a*g)*h,V[8]=(C*g-I*t)*h,this}transpose(){let V;const g=this.elements;return V=g[1],g[1]=g[3],g[3]=V,V=g[2],g[2]=g[6],g[6]=V,V=g[5],g[5]=g[7],g[7]=V,this}getNormalMatrix(V){return this.setFromMatrix4(V).invert().transpose()}transposeIntoArray(V){const g=this.elements;return V[0]=g[0],V[1]=g[3],V[2]=g[6],V[3]=g[1],V[4]=g[4],V[5]=g[7],V[6]=g[2],V[7]=g[5],V[8]=g[8],this}setUvTransform(V,g,I,e,t,C,A){const s=Math.cos(t),a=Math.sin(t);return this.set(I*s,I*a,-I*(s*C+a*A)+C+V,-e*a,e*s,-e*(-a*C+s*A)+A+g,0,0,1),this}scale(V,g){const I=this.elements;return I[0]*=V,I[3]*=V,I[6]*=V,I[1]*=g,I[4]*=g,I[7]*=g,this}rotate(V){const g=Math.cos(V),I=Math.sin(V),e=this.elements,t=e[0],C=e[3],A=e[6],s=e[1],a=e[4],o=e[7];return e[0]=g*t+I*s,e[3]=g*C+I*a,e[6]=g*A+I*o,e[1]=-I*t+g*s,e[4]=-I*C+g*a,e[7]=-I*A+g*o,this}translate(V,g){const I=this.elements;return I[0]+=V*I[2],I[3]+=V*I[5],I[6]+=V*I[8],I[1]+=g*I[2],I[4]+=g*I[5],I[7]+=g*I[8],this}equals(V){const g=this.elements,I=V.elements;for(let e=0;e<9;e++)if(g[e]!==I[e])return!1;return!0}fromArray(V,g=0){for(let I=0;I<9;I++)this.elements[I]=V[I+g];return this}toArray(V=[],g=0){const I=this.elements;return V[g]=I[0],V[g+1]=I[1],V[g+2]=I[2],V[g+3]=I[3],V[g+4]=I[4],V[g+5]=I[5],V[g+6]=I[6],V[g+7]=I[7],V[g+8]=I[8],V}clone(){return new this.constructor().fromArray(this.elements)}}Dg.prototype.isMatrix3=!0;let Kt;class RC{static getDataURL(V){if(/^data:/i.test(V.src)||typeof HTMLCanvasElement=="undefined")return V.src;let g;if(V instanceof HTMLCanvasElement)g=V;else{Kt===void 0&&(Kt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Kt.width=V.width,Kt.height=V.height;const I=Kt.getContext("2d");V instanceof ImageData?I.putImageData(V,0,0):I.drawImage(V,0,0,V.width,V.height),g=Kt}return g.width>2048||g.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",V),g.toDataURL("image/jpeg",.6)):g.toDataURL("image/png")}}let $b=0;class Mg extends wt{constructor(V=Mg.DEFAULT_IMAGE,g=Mg.DEFAULT_MAPPING,I=lI,e=lI,t=Sg,C=XC,A=NI,s=SA,a=1,o=vi){super(),Object.defineProperty(this,"id",{value:$b++}),this.uuid=KI(),this.name="",this.image=V,this.mipmaps=[],this.mapping=g,this.wrapS=I,this.wrapT=e,this.magFilter=t,this.minFilter=C,this.anisotropy=a,this.format=A,this.internalFormat=null,this.type=s,this.offset=new dV(0,0),this.repeat=new dV(1,1),this.center=new dV(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dg,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=o,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(V){return this.name=V.name,this.image=V.image,this.mipmaps=V.mipmaps.slice(0),this.mapping=V.mapping,this.wrapS=V.wrapS,this.wrapT=V.wrapT,this.magFilter=V.magFilter,this.minFilter=V.minFilter,this.anisotropy=V.anisotropy,this.format=V.format,this.internalFormat=V.internalFormat,this.type=V.type,this.offset.copy(V.offset),this.repeat.copy(V.repeat),this.center.copy(V.center),this.rotation=V.rotation,this.matrixAutoUpdate=V.matrixAutoUpdate,this.matrix.copy(V.matrix),this.generateMipmaps=V.generateMipmaps,this.premultiplyAlpha=V.premultiplyAlpha,this.flipY=V.flipY,this.unpackAlignment=V.unpackAlignment,this.encoding=V.encoding,this}toJSON(V){const g=V===void 0||typeof V=="string";if(!g&&V.textures[this.uuid]!==void 0)return V.textures[this.uuid];const I={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const e=this.image;if(e.uuid===void 0&&(e.uuid=KI()),!g&&V.images[e.uuid]===void 0){let t;if(Array.isArray(e)){t=[];for(let C=0,A=e.length;C<A;C++)e[C].isDataTexture?t.push(hn(e[C].image)):t.push(hn(e[C]))}else t=hn(e);V.images[e.uuid]={uuid:e.uuid,url:t}}I.image=e.uuid}return g||(V.textures[this.uuid]=I),I}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(V){if(this.mapping!==kc)return V;if(V.applyMatrix3(this.matrix),V.x<0||V.x>1)switch(this.wrapS){case Vt:V.x=V.x-Math.floor(V.x);break;case lI:V.x=V.x<0?0:1;break;case fA:Math.abs(Math.floor(V.x)%2)===1?V.x=Math.ceil(V.x)-V.x:V.x=V.x-Math.floor(V.x);break}if(V.y<0||V.y>1)switch(this.wrapT){case Vt:V.y=V.y-Math.floor(V.y);break;case lI:V.y=V.y<0?0:1;break;case fA:Math.abs(Math.floor(V.y)%2)===1?V.y=Math.ceil(V.y)-V.y:V.y=V.y-Math.floor(V.y);break}return this.flipY&&(V.y=1-V.y),V}set needsUpdate(V){V===!0&&this.version++}}Mg.DEFAULT_IMAGE=void 0;Mg.DEFAULT_MAPPING=kc;Mg.prototype.isTexture=!0;function hn(i){return typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&i instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap?RC.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class eg{constructor(V=0,g=0,I=0,e=1){this.x=V,this.y=g,this.z=I,this.w=e}get width(){return this.z}set width(V){this.z=V}get height(){return this.w}set height(V){this.w=V}set(V,g,I,e){return this.x=V,this.y=g,this.z=I,this.w=e,this}setScalar(V){return this.x=V,this.y=V,this.z=V,this.w=V,this}setX(V){return this.x=V,this}setY(V){return this.y=V,this}setZ(V){return this.z=V,this}setW(V){return this.w=V,this}setComponent(V,g){switch(V){case 0:this.x=g;break;case 1:this.y=g;break;case 2:this.z=g;break;case 3:this.w=g;break;default:throw new Error("index is out of range: "+V)}return this}getComponent(V){switch(V){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+V)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(V){return this.x=V.x,this.y=V.y,this.z=V.z,this.w=V.w!==void 0?V.w:1,this}add(V,g){return g!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(V,g)):(this.x+=V.x,this.y+=V.y,this.z+=V.z,this.w+=V.w,this)}addScalar(V){return this.x+=V,this.y+=V,this.z+=V,this.w+=V,this}addVectors(V,g){return this.x=V.x+g.x,this.y=V.y+g.y,this.z=V.z+g.z,this.w=V.w+g.w,this}addScaledVector(V,g){return this.x+=V.x*g,this.y+=V.y*g,this.z+=V.z*g,this.w+=V.w*g,this}sub(V,g){return g!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(V,g)):(this.x-=V.x,this.y-=V.y,this.z-=V.z,this.w-=V.w,this)}subScalar(V){return this.x-=V,this.y-=V,this.z-=V,this.w-=V,this}subVectors(V,g){return this.x=V.x-g.x,this.y=V.y-g.y,this.z=V.z-g.z,this.w=V.w-g.w,this}multiply(V){return this.x*=V.x,this.y*=V.y,this.z*=V.z,this.w*=V.w,this}multiplyScalar(V){return this.x*=V,this.y*=V,this.z*=V,this.w*=V,this}applyMatrix4(V){const g=this.x,I=this.y,e=this.z,t=this.w,C=V.elements;return this.x=C[0]*g+C[4]*I+C[8]*e+C[12]*t,this.y=C[1]*g+C[5]*I+C[9]*e+C[13]*t,this.z=C[2]*g+C[6]*I+C[10]*e+C[14]*t,this.w=C[3]*g+C[7]*I+C[11]*e+C[15]*t,this}divideScalar(V){return this.multiplyScalar(1/V)}setAxisAngleFromQuaternion(V){this.w=2*Math.acos(V.w);const g=Math.sqrt(1-V.w*V.w);return g<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=V.x/g,this.y=V.y/g,this.z=V.z/g),this}setAxisAngleFromRotationMatrix(V){let g,I,e,t;const s=V.elements,a=s[0],o=s[4],n=s[8],l=s[1],c=s[5],d=s[9],h=s[2],m=s[6],r=s[10];if(Math.abs(o-l)<.01&&Math.abs(n-h)<.01&&Math.abs(d-m)<.01){if(Math.abs(o+l)<.1&&Math.abs(n+h)<.1&&Math.abs(d+m)<.1&&Math.abs(a+c+r-3)<.1)return this.set(1,0,0,0),this;g=Math.PI;const b=(a+1)/2,Z=(c+1)/2,p=(r+1)/2,G=(o+l)/4,X=(n+h)/4,W=(d+m)/4;return b>Z&&b>p?b<.01?(I=0,e=.707106781,t=.707106781):(I=Math.sqrt(b),e=G/I,t=X/I):Z>p?Z<.01?(I=.707106781,e=0,t=.707106781):(e=Math.sqrt(Z),I=G/e,t=W/e):p<.01?(I=.707106781,e=.707106781,t=0):(t=Math.sqrt(p),I=X/t,e=W/t),this.set(I,e,t,g),this}let u=Math.sqrt((m-d)*(m-d)+(n-h)*(n-h)+(l-o)*(l-o));return Math.abs(u)<.001&&(u=1),this.x=(m-d)/u,this.y=(n-h)/u,this.z=(l-o)/u,this.w=Math.acos((a+c+r-1)/2),this}min(V){return this.x=Math.min(this.x,V.x),this.y=Math.min(this.y,V.y),this.z=Math.min(this.z,V.z),this.w=Math.min(this.w,V.w),this}max(V){return this.x=Math.max(this.x,V.x),this.y=Math.max(this.y,V.y),this.z=Math.max(this.z,V.z),this.w=Math.max(this.w,V.w),this}clamp(V,g){return this.x=Math.max(V.x,Math.min(g.x,this.x)),this.y=Math.max(V.y,Math.min(g.y,this.y)),this.z=Math.max(V.z,Math.min(g.z,this.z)),this.w=Math.max(V.w,Math.min(g.w,this.w)),this}clampScalar(V,g){return this.x=Math.max(V,Math.min(g,this.x)),this.y=Math.max(V,Math.min(g,this.y)),this.z=Math.max(V,Math.min(g,this.z)),this.w=Math.max(V,Math.min(g,this.w)),this}clampLength(V,g){const I=this.length();return this.divideScalar(I||1).multiplyScalar(Math.max(V,Math.min(g,I)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(V){return this.x*V.x+this.y*V.y+this.z*V.z+this.w*V.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(V){return this.normalize().multiplyScalar(V)}lerp(V,g){return this.x+=(V.x-this.x)*g,this.y+=(V.y-this.y)*g,this.z+=(V.z-this.z)*g,this.w+=(V.w-this.w)*g,this}lerpVectors(V,g,I){return this.x=V.x+(g.x-V.x)*I,this.y=V.y+(g.y-V.y)*I,this.z=V.z+(g.z-V.z)*I,this.w=V.w+(g.w-V.w)*I,this}equals(V){return V.x===this.x&&V.y===this.y&&V.z===this.z&&V.w===this.w}fromArray(V,g=0){return this.x=V[g],this.y=V[g+1],this.z=V[g+2],this.w=V[g+3],this}toArray(V=[],g=0){return V[g]=this.x,V[g+1]=this.y,V[g+2]=this.z,V[g+3]=this.w,V}fromBufferAttribute(V,g,I){return I!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=V.getX(g),this.y=V.getY(g),this.z=V.getZ(g),this.w=V.getW(g),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}eg.prototype.isVector4=!0;class Ie extends wt{constructor(V,g,I={}){super(),this.width=V,this.height=g,this.depth=1,this.scissor=new eg(0,0,V,g),this.scissorTest=!1,this.viewport=new eg(0,0,V,g),this.texture=new Mg(void 0,I.mapping,I.wrapS,I.wrapT,I.magFilter,I.minFilter,I.format,I.type,I.anisotropy,I.encoding),this.texture.image={width:V,height:g,depth:1},this.texture.generateMipmaps=I.generateMipmaps!==void 0?I.generateMipmaps:!1,this.texture.minFilter=I.minFilter!==void 0?I.minFilter:Sg,this.depthBuffer=I.depthBuffer!==void 0?I.depthBuffer:!0,this.stencilBuffer=I.stencilBuffer!==void 0?I.stencilBuffer:!1,this.depthTexture=I.depthTexture!==void 0?I.depthTexture:null}setTexture(V){V.image={width:this.width,height:this.height,depth:this.depth},this.texture=V}setSize(V,g,I=1){(this.width!==V||this.height!==g||this.depth!==I)&&(this.width=V,this.height=g,this.depth=I,this.texture.image.width=V,this.texture.image.height=g,this.texture.image.depth=I,this.dispose()),this.viewport.set(0,0,V,g),this.scissor.set(0,0,V,g)}clone(){return new this.constructor().copy(this)}copy(V){return this.width=V.width,this.height=V.height,this.depth=V.depth,this.viewport.copy(V.viewport),this.texture=V.texture.clone(),this.texture.image=an({},this.texture.image),this.depthBuffer=V.depthBuffer,this.stencilBuffer=V.stencilBuffer,this.depthTexture=V.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ie.prototype.isWebGLRenderTarget=!0;class VZ extends Ie{constructor(V,g,I){super(V,g);const e=this.texture;this.texture=[];for(let t=0;t<I;t++)this.texture[t]=e.clone()}setSize(V,g,I=1){if(this.width!==V||this.height!==g||this.depth!==I){this.width=V,this.height=g,this.depth=I;for(let e=0,t=this.texture.length;e<t;e++)this.texture[e].image.width=V,this.texture[e].image.height=g,this.texture[e].image.depth=I;this.dispose()}return this.viewport.set(0,0,V,g),this.scissor.set(0,0,V,g),this}copy(V){this.dispose(),this.width=V.width,this.height=V.height,this.depth=V.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=V.depthBuffer,this.stencilBuffer=V.stencilBuffer,this.depthTexture=V.depthTexture,this.texture.length=0;for(let g=0,I=V.texture.length;g<I;g++)this.texture[g]=V.texture[g].clone();return this}}VZ.prototype.isWebGLMultipleRenderTargets=!0;class Qc extends Ie{constructor(V,g,I){super(V,g,I),this.samples=4}copy(V){return super.copy.call(this,V),this.samples=V.samples,this}}Qc.prototype.isWebGLMultisampleRenderTarget=!0;class Rg{constructor(V=0,g=0,I=0,e=1){this._x=V,this._y=g,this._z=I,this._w=e}static slerp(V,g,I,e){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),I.slerpQuaternions(V,g,e)}static slerpFlat(V,g,I,e,t,C,A){let s=I[e+0],a=I[e+1],o=I[e+2],n=I[e+3];const l=t[C+0],c=t[C+1],d=t[C+2],h=t[C+3];if(A===0){V[g+0]=s,V[g+1]=a,V[g+2]=o,V[g+3]=n;return}if(A===1){V[g+0]=l,V[g+1]=c,V[g+2]=d,V[g+3]=h;return}if(n!==h||s!==l||a!==c||o!==d){let m=1-A;const r=s*l+a*c+o*d+n*h,u=r>=0?1:-1,b=1-r*r;if(b>Number.EPSILON){const p=Math.sqrt(b),G=Math.atan2(p,r*u);m=Math.sin(m*G)/p,A=Math.sin(A*G)/p}const Z=A*u;if(s=s*m+l*Z,a=a*m+c*Z,o=o*m+d*Z,n=n*m+h*Z,m===1-A){const p=1/Math.sqrt(s*s+a*a+o*o+n*n);s*=p,a*=p,o*=p,n*=p}}V[g]=s,V[g+1]=a,V[g+2]=o,V[g+3]=n}static multiplyQuaternionsFlat(V,g,I,e,t,C){const A=I[e],s=I[e+1],a=I[e+2],o=I[e+3],n=t[C],l=t[C+1],c=t[C+2],d=t[C+3];return V[g]=A*d+o*n+s*c-a*l,V[g+1]=s*d+o*l+a*n-A*c,V[g+2]=a*d+o*c+A*l-s*n,V[g+3]=o*d-A*n-s*l-a*c,V}get x(){return this._x}set x(V){this._x=V,this._onChangeCallback()}get y(){return this._y}set y(V){this._y=V,this._onChangeCallback()}get z(){return this._z}set z(V){this._z=V,this._onChangeCallback()}get w(){return this._w}set w(V){this._w=V,this._onChangeCallback()}set(V,g,I,e){return this._x=V,this._y=g,this._z=I,this._w=e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(V){return this._x=V.x,this._y=V.y,this._z=V.z,this._w=V.w,this._onChangeCallback(),this}setFromEuler(V,g){if(!(V&&V.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const I=V._x,e=V._y,t=V._z,C=V._order,A=Math.cos,s=Math.sin,a=A(I/2),o=A(e/2),n=A(t/2),l=s(I/2),c=s(e/2),d=s(t/2);switch(C){case"XYZ":this._x=l*o*n+a*c*d,this._y=a*c*n-l*o*d,this._z=a*o*d+l*c*n,this._w=a*o*n-l*c*d;break;case"YXZ":this._x=l*o*n+a*c*d,this._y=a*c*n-l*o*d,this._z=a*o*d-l*c*n,this._w=a*o*n+l*c*d;break;case"ZXY":this._x=l*o*n-a*c*d,this._y=a*c*n+l*o*d,this._z=a*o*d+l*c*n,this._w=a*o*n-l*c*d;break;case"ZYX":this._x=l*o*n-a*c*d,this._y=a*c*n+l*o*d,this._z=a*o*d-l*c*n,this._w=a*o*n+l*c*d;break;case"YZX":this._x=l*o*n+a*c*d,this._y=a*c*n+l*o*d,this._z=a*o*d-l*c*n,this._w=a*o*n-l*c*d;break;case"XZY":this._x=l*o*n-a*c*d,this._y=a*c*n-l*o*d,this._z=a*o*d+l*c*n,this._w=a*o*n+l*c*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+C)}return g!==!1&&this._onChangeCallback(),this}setFromAxisAngle(V,g){const I=g/2,e=Math.sin(I);return this._x=V.x*e,this._y=V.y*e,this._z=V.z*e,this._w=Math.cos(I),this._onChangeCallback(),this}setFromRotationMatrix(V){const g=V.elements,I=g[0],e=g[4],t=g[8],C=g[1],A=g[5],s=g[9],a=g[2],o=g[6],n=g[10],l=I+A+n;if(l>0){const c=.5/Math.sqrt(l+1);this._w=.25/c,this._x=(o-s)*c,this._y=(t-a)*c,this._z=(C-e)*c}else if(I>A&&I>n){const c=2*Math.sqrt(1+I-A-n);this._w=(o-s)/c,this._x=.25*c,this._y=(e+C)/c,this._z=(t+a)/c}else if(A>n){const c=2*Math.sqrt(1+A-I-n);this._w=(t-a)/c,this._x=(e+C)/c,this._y=.25*c,this._z=(s+o)/c}else{const c=2*Math.sqrt(1+n-I-A);this._w=(C-e)/c,this._x=(t+a)/c,this._y=(s+o)/c,this._z=.25*c}return this._onChangeCallback(),this}setFromUnitVectors(V,g){let I=V.dot(g)+1;return I<Number.EPSILON?(I=0,Math.abs(V.x)>Math.abs(V.z)?(this._x=-V.y,this._y=V.x,this._z=0,this._w=I):(this._x=0,this._y=-V.z,this._z=V.y,this._w=I)):(this._x=V.y*g.z-V.z*g.y,this._y=V.z*g.x-V.x*g.z,this._z=V.x*g.y-V.y*g.x,this._w=I),this.normalize()}angleTo(V){return 2*Math.acos(Math.abs(eI(this.dot(V),-1,1)))}rotateTowards(V,g){const I=this.angleTo(V);if(I===0)return this;const e=Math.min(1,g/I);return this.slerp(V,e),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(V){return this._x*V._x+this._y*V._y+this._z*V._z+this._w*V._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let V=this.length();return V===0?(this._x=0,this._y=0,this._z=0,this._w=1):(V=1/V,this._x=this._x*V,this._y=this._y*V,this._z=this._z*V,this._w=this._w*V),this._onChangeCallback(),this}multiply(V,g){return g!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(V,g)):this.multiplyQuaternions(this,V)}premultiply(V){return this.multiplyQuaternions(V,this)}multiplyQuaternions(V,g){const I=V._x,e=V._y,t=V._z,C=V._w,A=g._x,s=g._y,a=g._z,o=g._w;return this._x=I*o+C*A+e*a-t*s,this._y=e*o+C*s+t*A-I*a,this._z=t*o+C*a+I*s-e*A,this._w=C*o-I*A-e*s-t*a,this._onChangeCallback(),this}slerp(V,g){if(g===0)return this;if(g===1)return this.copy(V);const I=this._x,e=this._y,t=this._z,C=this._w;let A=C*V._w+I*V._x+e*V._y+t*V._z;if(A<0?(this._w=-V._w,this._x=-V._x,this._y=-V._y,this._z=-V._z,A=-A):this.copy(V),A>=1)return this._w=C,this._x=I,this._y=e,this._z=t,this;const s=1-A*A;if(s<=Number.EPSILON){const c=1-g;return this._w=c*C+g*this._w,this._x=c*I+g*this._x,this._y=c*e+g*this._y,this._z=c*t+g*this._z,this.normalize(),this._onChangeCallback(),this}const a=Math.sqrt(s),o=Math.atan2(a,A),n=Math.sin((1-g)*o)/a,l=Math.sin(g*o)/a;return this._w=C*n+this._w*l,this._x=I*n+this._x*l,this._y=e*n+this._y*l,this._z=t*n+this._z*l,this._onChangeCallback(),this}slerpQuaternions(V,g,I){this.copy(V).slerp(g,I)}equals(V){return V._x===this._x&&V._y===this._y&&V._z===this._z&&V._w===this._w}fromArray(V,g=0){return this._x=V[g],this._y=V[g+1],this._z=V[g+2],this._w=V[g+3],this._onChangeCallback(),this}toArray(V=[],g=0){return V[g]=this._x,V[g+1]=this._y,V[g+2]=this._z,V[g+3]=this._w,V}fromBufferAttribute(V,g){return this._x=V.getX(g),this._y=V.getY(g),this._z=V.getZ(g),this._w=V.getW(g),this}_onChange(V){return this._onChangeCallback=V,this}_onChangeCallback(){}}Rg.prototype.isQuaternion=!0;class S{constructor(V=0,g=0,I=0){this.x=V,this.y=g,this.z=I}set(V,g,I){return I===void 0&&(I=this.z),this.x=V,this.y=g,this.z=I,this}setScalar(V){return this.x=V,this.y=V,this.z=V,this}setX(V){return this.x=V,this}setY(V){return this.y=V,this}setZ(V){return this.z=V,this}setComponent(V,g){switch(V){case 0:this.x=g;break;case 1:this.y=g;break;case 2:this.z=g;break;default:throw new Error("index is out of range: "+V)}return this}getComponent(V){switch(V){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+V)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(V){return this.x=V.x,this.y=V.y,this.z=V.z,this}add(V,g){return g!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(V,g)):(this.x+=V.x,this.y+=V.y,this.z+=V.z,this)}addScalar(V){return this.x+=V,this.y+=V,this.z+=V,this}addVectors(V,g){return this.x=V.x+g.x,this.y=V.y+g.y,this.z=V.z+g.z,this}addScaledVector(V,g){return this.x+=V.x*g,this.y+=V.y*g,this.z+=V.z*g,this}sub(V,g){return g!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(V,g)):(this.x-=V.x,this.y-=V.y,this.z-=V.z,this)}subScalar(V){return this.x-=V,this.y-=V,this.z-=V,this}subVectors(V,g){return this.x=V.x-g.x,this.y=V.y-g.y,this.z=V.z-g.z,this}multiply(V,g){return g!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(V,g)):(this.x*=V.x,this.y*=V.y,this.z*=V.z,this)}multiplyScalar(V){return this.x*=V,this.y*=V,this.z*=V,this}multiplyVectors(V,g){return this.x=V.x*g.x,this.y=V.y*g.y,this.z=V.z*g.z,this}applyEuler(V){return V&&V.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ka.setFromEuler(V))}applyAxisAngle(V,g){return this.applyQuaternion(ka.setFromAxisAngle(V,g))}applyMatrix3(V){const g=this.x,I=this.y,e=this.z,t=V.elements;return this.x=t[0]*g+t[3]*I+t[6]*e,this.y=t[1]*g+t[4]*I+t[7]*e,this.z=t[2]*g+t[5]*I+t[8]*e,this}applyNormalMatrix(V){return this.applyMatrix3(V).normalize()}applyMatrix4(V){const g=this.x,I=this.y,e=this.z,t=V.elements,C=1/(t[3]*g+t[7]*I+t[11]*e+t[15]);return this.x=(t[0]*g+t[4]*I+t[8]*e+t[12])*C,this.y=(t[1]*g+t[5]*I+t[9]*e+t[13])*C,this.z=(t[2]*g+t[6]*I+t[10]*e+t[14])*C,this}applyQuaternion(V){const g=this.x,I=this.y,e=this.z,t=V.x,C=V.y,A=V.z,s=V.w,a=s*g+C*e-A*I,o=s*I+A*g-t*e,n=s*e+t*I-C*g,l=-t*g-C*I-A*e;return this.x=a*s+l*-t+o*-A-n*-C,this.y=o*s+l*-C+n*-t-a*-A,this.z=n*s+l*-A+a*-C-o*-t,this}project(V){return this.applyMatrix4(V.matrixWorldInverse).applyMatrix4(V.projectionMatrix)}unproject(V){return this.applyMatrix4(V.projectionMatrixInverse).applyMatrix4(V.matrixWorld)}transformDirection(V){const g=this.x,I=this.y,e=this.z,t=V.elements;return this.x=t[0]*g+t[4]*I+t[8]*e,this.y=t[1]*g+t[5]*I+t[9]*e,this.z=t[2]*g+t[6]*I+t[10]*e,this.normalize()}divide(V){return this.x/=V.x,this.y/=V.y,this.z/=V.z,this}divideScalar(V){return this.multiplyScalar(1/V)}min(V){return this.x=Math.min(this.x,V.x),this.y=Math.min(this.y,V.y),this.z=Math.min(this.z,V.z),this}max(V){return this.x=Math.max(this.x,V.x),this.y=Math.max(this.y,V.y),this.z=Math.max(this.z,V.z),this}clamp(V,g){return this.x=Math.max(V.x,Math.min(g.x,this.x)),this.y=Math.max(V.y,Math.min(g.y,this.y)),this.z=Math.max(V.z,Math.min(g.z,this.z)),this}clampScalar(V,g){return this.x=Math.max(V,Math.min(g,this.x)),this.y=Math.max(V,Math.min(g,this.y)),this.z=Math.max(V,Math.min(g,this.z)),this}clampLength(V,g){const I=this.length();return this.divideScalar(I||1).multiplyScalar(Math.max(V,Math.min(g,I)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(V){return this.x*V.x+this.y*V.y+this.z*V.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(V){return this.normalize().multiplyScalar(V)}lerp(V,g){return this.x+=(V.x-this.x)*g,this.y+=(V.y-this.y)*g,this.z+=(V.z-this.z)*g,this}lerpVectors(V,g,I){return this.x=V.x+(g.x-V.x)*I,this.y=V.y+(g.y-V.y)*I,this.z=V.z+(g.z-V.z)*I,this}cross(V,g){return g!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(V,g)):this.crossVectors(this,V)}crossVectors(V,g){const I=V.x,e=V.y,t=V.z,C=g.x,A=g.y,s=g.z;return this.x=e*s-t*A,this.y=t*C-I*s,this.z=I*A-e*C,this}projectOnVector(V){const g=V.lengthSq();if(g===0)return this.set(0,0,0);const I=V.dot(this)/g;return this.copy(V).multiplyScalar(I)}projectOnPlane(V){return mn.copy(this).projectOnVector(V),this.sub(mn)}reflect(V){return this.sub(mn.copy(V).multiplyScalar(2*this.dot(V)))}angleTo(V){const g=Math.sqrt(this.lengthSq()*V.lengthSq());if(g===0)return Math.PI/2;const I=this.dot(V)/g;return Math.acos(eI(I,-1,1))}distanceTo(V){return Math.sqrt(this.distanceToSquared(V))}distanceToSquared(V){const g=this.x-V.x,I=this.y-V.y,e=this.z-V.z;return g*g+I*I+e*e}manhattanDistanceTo(V){return Math.abs(this.x-V.x)+Math.abs(this.y-V.y)+Math.abs(this.z-V.z)}setFromSpherical(V){return this.setFromSphericalCoords(V.radius,V.phi,V.theta)}setFromSphericalCoords(V,g,I){const e=Math.sin(g)*V;return this.x=e*Math.sin(I),this.y=Math.cos(g)*V,this.z=e*Math.cos(I),this}setFromCylindrical(V){return this.setFromCylindricalCoords(V.radius,V.theta,V.y)}setFromCylindricalCoords(V,g,I){return this.x=V*Math.sin(g),this.y=I,this.z=V*Math.cos(g),this}setFromMatrixPosition(V){const g=V.elements;return this.x=g[12],this.y=g[13],this.z=g[14],this}setFromMatrixScale(V){const g=this.setFromMatrixColumn(V,0).length(),I=this.setFromMatrixColumn(V,1).length(),e=this.setFromMatrixColumn(V,2).length();return this.x=g,this.y=I,this.z=e,this}setFromMatrixColumn(V,g){return this.fromArray(V.elements,g*4)}setFromMatrix3Column(V,g){return this.fromArray(V.elements,g*3)}equals(V){return V.x===this.x&&V.y===this.y&&V.z===this.z}fromArray(V,g=0){return this.x=V[g],this.y=V[g+1],this.z=V[g+2],this}toArray(V=[],g=0){return V[g]=this.x,V[g+1]=this.y,V[g+2]=this.z,V}fromBufferAttribute(V,g,I){return I!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=V.getX(g),this.y=V.getY(g),this.z=V.getZ(g),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}S.prototype.isVector3=!0;const mn=new S,ka=new Rg;class pg{constructor(V=new S(1/0,1/0,1/0),g=new S(-1/0,-1/0,-1/0)){this.min=V,this.max=g}set(V,g){return this.min.copy(V),this.max.copy(g),this}setFromArray(V){let g=1/0,I=1/0,e=1/0,t=-1/0,C=-1/0,A=-1/0;for(let s=0,a=V.length;s<a;s+=3){const o=V[s],n=V[s+1],l=V[s+2];o<g&&(g=o),n<I&&(I=n),l<e&&(e=l),o>t&&(t=o),n>C&&(C=n),l>A&&(A=l)}return this.min.set(g,I,e),this.max.set(t,C,A),this}setFromBufferAttribute(V){let g=1/0,I=1/0,e=1/0,t=-1/0,C=-1/0,A=-1/0;for(let s=0,a=V.count;s<a;s++){const o=V.getX(s),n=V.getY(s),l=V.getZ(s);o<g&&(g=o),n<I&&(I=n),l<e&&(e=l),o>t&&(t=o),n>C&&(C=n),l>A&&(A=l)}return this.min.set(g,I,e),this.max.set(t,C,A),this}setFromPoints(V){this.makeEmpty();for(let g=0,I=V.length;g<I;g++)this.expandByPoint(V[g]);return this}setFromCenterAndSize(V,g){const I=JC.copy(g).multiplyScalar(.5);return this.min.copy(V).sub(I),this.max.copy(V).add(I),this}setFromObject(V){return this.makeEmpty(),this.expandByObject(V)}clone(){return new this.constructor().copy(this)}copy(V){return this.min.copy(V.min),this.max.copy(V.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(V){return this.isEmpty()?V.set(0,0,0):V.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(V){return this.isEmpty()?V.set(0,0,0):V.subVectors(this.max,this.min)}expandByPoint(V){return this.min.min(V),this.max.max(V),this}expandByVector(V){return this.min.sub(V),this.max.add(V),this}expandByScalar(V){return this.min.addScalar(-V),this.max.addScalar(V),this}expandByObject(V){V.updateWorldMatrix(!1,!1);const g=V.geometry;g!==void 0&&(g.boundingBox===null&&g.computeBoundingBox(),un.copy(g.boundingBox),un.applyMatrix4(V.matrixWorld),this.union(un));const I=V.children;for(let e=0,t=I.length;e<t;e++)this.expandByObject(I[e]);return this}containsPoint(V){return!(V.x<this.min.x||V.x>this.max.x||V.y<this.min.y||V.y>this.max.y||V.z<this.min.z||V.z>this.max.z)}containsBox(V){return this.min.x<=V.min.x&&V.max.x<=this.max.x&&this.min.y<=V.min.y&&V.max.y<=this.max.y&&this.min.z<=V.min.z&&V.max.z<=this.max.z}getParameter(V,g){return g.set((V.x-this.min.x)/(this.max.x-this.min.x),(V.y-this.min.y)/(this.max.y-this.min.y),(V.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(V){return!(V.max.x<this.min.x||V.min.x>this.max.x||V.max.y<this.min.y||V.min.y>this.max.y||V.max.z<this.min.z||V.min.z>this.max.z)}intersectsSphere(V){return this.clampPoint(V.center,JC),JC.distanceToSquared(V.center)<=V.radius*V.radius}intersectsPlane(V){let g,I;return V.normal.x>0?(g=V.normal.x*this.min.x,I=V.normal.x*this.max.x):(g=V.normal.x*this.max.x,I=V.normal.x*this.min.x),V.normal.y>0?(g+=V.normal.y*this.min.y,I+=V.normal.y*this.max.y):(g+=V.normal.y*this.max.y,I+=V.normal.y*this.min.y),V.normal.z>0?(g+=V.normal.z*this.min.z,I+=V.normal.z*this.max.z):(g+=V.normal.z*this.max.z,I+=V.normal.z*this.min.z),g<=-V.constant&&I>=-V.constant}intersectsTriangle(V){if(this.isEmpty())return!1;this.getCenter(MC),Ti.subVectors(this.max,MC),Jt.subVectors(V.a,MC),Mt.subVectors(V.b,MC),xt.subVectors(V.c,MC),fe.subVectors(Mt,Jt),Se.subVectors(xt,Mt),st.subVectors(Jt,xt);let g=[0,-fe.z,fe.y,0,-Se.z,Se.y,0,-st.z,st.y,fe.z,0,-fe.x,Se.z,0,-Se.x,st.z,0,-st.x,-fe.y,fe.x,0,-Se.y,Se.x,0,-st.y,st.x,0];return!bn(g,Jt,Mt,xt,Ti)||(g=[1,0,0,0,1,0,0,0,1],!bn(g,Jt,Mt,xt,Ti))?!1:(Li.crossVectors(fe,Se),g=[Li.x,Li.y,Li.z],bn(g,Jt,Mt,xt,Ti))}clampPoint(V,g){return g.copy(V).clamp(this.min,this.max)}distanceToPoint(V){return JC.copy(V).clamp(this.min,this.max).sub(V).length()}getBoundingSphere(V){return this.getCenter(V.center),V.radius=this.getSize(JC).length()*.5,V}intersect(V){return this.min.max(V.min),this.max.min(V.max),this.isEmpty()&&this.makeEmpty(),this}union(V){return this.min.min(V.min),this.max.max(V.max),this}applyMatrix4(V){return this.isEmpty()?this:(oe[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(V),oe[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(V),oe[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(V),oe[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(V),oe[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(V),oe[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(V),oe[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(V),oe[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(V),this.setFromPoints(oe),this)}translate(V){return this.min.add(V),this.max.add(V),this}equals(V){return V.min.equals(this.min)&&V.max.equals(this.max)}}pg.prototype.isBox3=!0;const oe=[new S,new S,new S,new S,new S,new S,new S,new S],JC=new S,un=new pg,Jt=new S,Mt=new S,xt=new S,fe=new S,Se=new S,st=new S,MC=new S,Ti=new S,Li=new S,lt=new S;function bn(i,V,g,I,e){for(let t=0,C=i.length-3;t<=C;t+=3){lt.fromArray(i,t);const A=e.x*Math.abs(lt.x)+e.y*Math.abs(lt.y)+e.z*Math.abs(lt.z),s=V.dot(lt),a=g.dot(lt),o=I.dot(lt);if(Math.max(-Math.max(s,a,o),Math.min(s,a,o))>A)return!1}return!0}const gZ=new pg,za=new S,Zn=new S,Gn=new S;class XI{constructor(V=new S,g=-1){this.center=V,this.radius=g}set(V,g){return this.center.copy(V),this.radius=g,this}setFromPoints(V,g){const I=this.center;g!==void 0?I.copy(g):gZ.setFromPoints(V).getCenter(I);let e=0;for(let t=0,C=V.length;t<C;t++)e=Math.max(e,I.distanceToSquared(V[t]));return this.radius=Math.sqrt(e),this}copy(V){return this.center.copy(V.center),this.radius=V.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(V){return V.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(V){return V.distanceTo(this.center)-this.radius}intersectsSphere(V){const g=this.radius+V.radius;return V.center.distanceToSquared(this.center)<=g*g}intersectsBox(V){return V.intersectsSphere(this)}intersectsPlane(V){return Math.abs(V.distanceToPoint(this.center))<=this.radius}clampPoint(V,g){const I=this.center.distanceToSquared(V);return g.copy(V),I>this.radius*this.radius&&(g.sub(this.center).normalize(),g.multiplyScalar(this.radius).add(this.center)),g}getBoundingBox(V){return this.isEmpty()?(V.makeEmpty(),V):(V.set(this.center,this.center),V.expandByScalar(this.radius),V)}applyMatrix4(V){return this.center.applyMatrix4(V),this.radius=this.radius*V.getMaxScaleOnAxis(),this}translate(V){return this.center.add(V),this}expandByPoint(V){Gn.subVectors(V,this.center);const g=Gn.lengthSq();if(g>this.radius*this.radius){const I=Math.sqrt(g),e=(I-this.radius)*.5;this.center.add(Gn.multiplyScalar(e/I)),this.radius+=e}return this}union(V){return Zn.subVectors(V.center,this.center).normalize().multiplyScalar(V.radius),this.expandByPoint(za.copy(V.center).add(Zn)),this.expandByPoint(za.copy(V.center).sub(Zn)),this}equals(V){return V.center.equals(this.center)&&V.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ce=new S,pn=new S,Ui=new S,Fe=new S,qn=new S,Di=new S,Bn=new S;class Ht{constructor(V=new S,g=new S(0,0,-1)){this.origin=V,this.direction=g}set(V,g){return this.origin.copy(V),this.direction.copy(g),this}copy(V){return this.origin.copy(V.origin),this.direction.copy(V.direction),this}at(V,g){return g.copy(this.direction).multiplyScalar(V).add(this.origin)}lookAt(V){return this.direction.copy(V).sub(this.origin).normalize(),this}recast(V){return this.origin.copy(this.at(V,ce)),this}closestPointToPoint(V,g){g.subVectors(V,this.origin);const I=g.dot(this.direction);return I<0?g.copy(this.origin):g.copy(this.direction).multiplyScalar(I).add(this.origin)}distanceToPoint(V){return Math.sqrt(this.distanceSqToPoint(V))}distanceSqToPoint(V){const g=ce.subVectors(V,this.origin).dot(this.direction);return g<0?this.origin.distanceToSquared(V):(ce.copy(this.direction).multiplyScalar(g).add(this.origin),ce.distanceToSquared(V))}distanceSqToSegment(V,g,I,e){pn.copy(V).add(g).multiplyScalar(.5),Ui.copy(g).sub(V).normalize(),Fe.copy(this.origin).sub(pn);const t=V.distanceTo(g)*.5,C=-this.direction.dot(Ui),A=Fe.dot(this.direction),s=-Fe.dot(Ui),a=Fe.lengthSq(),o=Math.abs(1-C*C);let n,l,c,d;if(o>0)if(n=C*s-A,l=C*A-s,d=t*o,n>=0)if(l>=-d)if(l<=d){const h=1/o;n*=h,l*=h,c=n*(n+C*l+2*A)+l*(C*n+l+2*s)+a}else l=t,n=Math.max(0,-(C*l+A)),c=-n*n+l*(l+2*s)+a;else l=-t,n=Math.max(0,-(C*l+A)),c=-n*n+l*(l+2*s)+a;else l<=-d?(n=Math.max(0,-(-C*t+A)),l=n>0?-t:Math.min(Math.max(-t,-s),t),c=-n*n+l*(l+2*s)+a):l<=d?(n=0,l=Math.min(Math.max(-t,-s),t),c=l*(l+2*s)+a):(n=Math.max(0,-(C*t+A)),l=n>0?t:Math.min(Math.max(-t,-s),t),c=-n*n+l*(l+2*s)+a);else l=C>0?-t:t,n=Math.max(0,-(C*l+A)),c=-n*n+l*(l+2*s)+a;return I&&I.copy(this.direction).multiplyScalar(n).add(this.origin),e&&e.copy(Ui).multiplyScalar(l).add(pn),c}intersectSphere(V,g){ce.subVectors(V.center,this.origin);const I=ce.dot(this.direction),e=ce.dot(ce)-I*I,t=V.radius*V.radius;if(e>t)return null;const C=Math.sqrt(t-e),A=I-C,s=I+C;return A<0&&s<0?null:A<0?this.at(s,g):this.at(A,g)}intersectsSphere(V){return this.distanceSqToPoint(V.center)<=V.radius*V.radius}distanceToPlane(V){const g=V.normal.dot(this.direction);if(g===0)return V.distanceToPoint(this.origin)===0?0:null;const I=-(this.origin.dot(V.normal)+V.constant)/g;return I>=0?I:null}intersectPlane(V,g){const I=this.distanceToPlane(V);return I===null?null:this.at(I,g)}intersectsPlane(V){const g=V.distanceToPoint(this.origin);return g===0||V.normal.dot(this.direction)*g<0}intersectBox(V,g){let I,e,t,C,A,s;const a=1/this.direction.x,o=1/this.direction.y,n=1/this.direction.z,l=this.origin;return a>=0?(I=(V.min.x-l.x)*a,e=(V.max.x-l.x)*a):(I=(V.max.x-l.x)*a,e=(V.min.x-l.x)*a),o>=0?(t=(V.min.y-l.y)*o,C=(V.max.y-l.y)*o):(t=(V.max.y-l.y)*o,C=(V.min.y-l.y)*o),I>C||t>e||((t>I||I!==I)&&(I=t),(C<e||e!==e)&&(e=C),n>=0?(A=(V.min.z-l.z)*n,s=(V.max.z-l.z)*n):(A=(V.max.z-l.z)*n,s=(V.min.z-l.z)*n),I>s||A>e)||((A>I||I!==I)&&(I=A),(s<e||e!==e)&&(e=s),e<0)?null:this.at(I>=0?I:e,g)}intersectsBox(V){return this.intersectBox(V,ce)!==null}intersectTriangle(V,g,I,e,t){qn.subVectors(g,V),Di.subVectors(I,V),Bn.crossVectors(qn,Di);let C=this.direction.dot(Bn),A;if(C>0){if(e)return null;A=1}else if(C<0)A=-1,C=-C;else return null;Fe.subVectors(this.origin,V);const s=A*this.direction.dot(Di.crossVectors(Fe,Di));if(s<0)return null;const a=A*this.direction.dot(qn.cross(Fe));if(a<0||s+a>C)return null;const o=-A*Fe.dot(Bn);return o<0?null:this.at(o/C,t)}applyMatrix4(V){return this.origin.applyMatrix4(V),this.direction.transformDirection(V),this}equals(V){return V.origin.equals(this.origin)&&V.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class JV{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(V,g,I,e,t,C,A,s,a,o,n,l,c,d,h,m){const r=this.elements;return r[0]=V,r[4]=g,r[8]=I,r[12]=e,r[1]=t,r[5]=C,r[9]=A,r[13]=s,r[2]=a,r[6]=o,r[10]=n,r[14]=l,r[3]=c,r[7]=d,r[11]=h,r[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new JV().fromArray(this.elements)}copy(V){const g=this.elements,I=V.elements;return g[0]=I[0],g[1]=I[1],g[2]=I[2],g[3]=I[3],g[4]=I[4],g[5]=I[5],g[6]=I[6],g[7]=I[7],g[8]=I[8],g[9]=I[9],g[10]=I[10],g[11]=I[11],g[12]=I[12],g[13]=I[13],g[14]=I[14],g[15]=I[15],this}copyPosition(V){const g=this.elements,I=V.elements;return g[12]=I[12],g[13]=I[13],g[14]=I[14],this}setFromMatrix3(V){const g=V.elements;return this.set(g[0],g[3],g[6],0,g[1],g[4],g[7],0,g[2],g[5],g[8],0,0,0,0,1),this}extractBasis(V,g,I){return V.setFromMatrixColumn(this,0),g.setFromMatrixColumn(this,1),I.setFromMatrixColumn(this,2),this}makeBasis(V,g,I){return this.set(V.x,g.x,I.x,0,V.y,g.y,I.y,0,V.z,g.z,I.z,0,0,0,0,1),this}extractRotation(V){const g=this.elements,I=V.elements,e=1/kt.setFromMatrixColumn(V,0).length(),t=1/kt.setFromMatrixColumn(V,1).length(),C=1/kt.setFromMatrixColumn(V,2).length();return g[0]=I[0]*e,g[1]=I[1]*e,g[2]=I[2]*e,g[3]=0,g[4]=I[4]*t,g[5]=I[5]*t,g[6]=I[6]*t,g[7]=0,g[8]=I[8]*C,g[9]=I[9]*C,g[10]=I[10]*C,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromEuler(V){V&&V.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const g=this.elements,I=V.x,e=V.y,t=V.z,C=Math.cos(I),A=Math.sin(I),s=Math.cos(e),a=Math.sin(e),o=Math.cos(t),n=Math.sin(t);if(V.order==="XYZ"){const l=C*o,c=C*n,d=A*o,h=A*n;g[0]=s*o,g[4]=-s*n,g[8]=a,g[1]=c+d*a,g[5]=l-h*a,g[9]=-A*s,g[2]=h-l*a,g[6]=d+c*a,g[10]=C*s}else if(V.order==="YXZ"){const l=s*o,c=s*n,d=a*o,h=a*n;g[0]=l+h*A,g[4]=d*A-c,g[8]=C*a,g[1]=C*n,g[5]=C*o,g[9]=-A,g[2]=c*A-d,g[6]=h+l*A,g[10]=C*s}else if(V.order==="ZXY"){const l=s*o,c=s*n,d=a*o,h=a*n;g[0]=l-h*A,g[4]=-C*n,g[8]=d+c*A,g[1]=c+d*A,g[5]=C*o,g[9]=h-l*A,g[2]=-C*a,g[6]=A,g[10]=C*s}else if(V.order==="ZYX"){const l=C*o,c=C*n,d=A*o,h=A*n;g[0]=s*o,g[4]=d*a-c,g[8]=l*a+h,g[1]=s*n,g[5]=h*a+l,g[9]=c*a-d,g[2]=-a,g[6]=A*s,g[10]=C*s}else if(V.order==="YZX"){const l=C*s,c=C*a,d=A*s,h=A*a;g[0]=s*o,g[4]=h-l*n,g[8]=d*n+c,g[1]=n,g[5]=C*o,g[9]=-A*o,g[2]=-a*o,g[6]=c*n+d,g[10]=l-h*n}else if(V.order==="XZY"){const l=C*s,c=C*a,d=A*s,h=A*a;g[0]=s*o,g[4]=-n,g[8]=a*o,g[1]=l*n+h,g[5]=C*o,g[9]=c*n-d,g[2]=d*n-c,g[6]=A*o,g[10]=h*n+l}return g[3]=0,g[7]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromQuaternion(V){return this.compose(IZ,V,eZ)}lookAt(V,g,I){const e=this.elements;return mI.subVectors(V,g),mI.lengthSq()===0&&(mI.z=1),mI.normalize(),ve.crossVectors(I,mI),ve.lengthSq()===0&&(Math.abs(I.z)===1?mI.x+=1e-4:mI.z+=1e-4,mI.normalize(),ve.crossVectors(I,mI)),ve.normalize(),Ei.crossVectors(mI,ve),e[0]=ve.x,e[4]=Ei.x,e[8]=mI.x,e[1]=ve.y,e[5]=Ei.y,e[9]=mI.y,e[2]=ve.z,e[6]=Ei.z,e[10]=mI.z,this}multiply(V,g){return g!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(V,g)):this.multiplyMatrices(this,V)}premultiply(V){return this.multiplyMatrices(V,this)}multiplyMatrices(V,g){const I=V.elements,e=g.elements,t=this.elements,C=I[0],A=I[4],s=I[8],a=I[12],o=I[1],n=I[5],l=I[9],c=I[13],d=I[2],h=I[6],m=I[10],r=I[14],u=I[3],b=I[7],Z=I[11],p=I[15],G=e[0],X=e[4],W=e[8],y=e[12],Y=e[1],f=e[5],L=e[9],R=e[13],J=e[2],H=e[6],N=e[10],v=e[14],T=e[3],D=e[7],$=e[11],M=e[15];return t[0]=C*G+A*Y+s*J+a*T,t[4]=C*X+A*f+s*H+a*D,t[8]=C*W+A*L+s*N+a*$,t[12]=C*y+A*R+s*v+a*M,t[1]=o*G+n*Y+l*J+c*T,t[5]=o*X+n*f+l*H+c*D,t[9]=o*W+n*L+l*N+c*$,t[13]=o*y+n*R+l*v+c*M,t[2]=d*G+h*Y+m*J+r*T,t[6]=d*X+h*f+m*H+r*D,t[10]=d*W+h*L+m*N+r*$,t[14]=d*y+h*R+m*v+r*M,t[3]=u*G+b*Y+Z*J+p*T,t[7]=u*X+b*f+Z*H+p*D,t[11]=u*W+b*L+Z*N+p*$,t[15]=u*y+b*R+Z*v+p*M,this}multiplyScalar(V){const g=this.elements;return g[0]*=V,g[4]*=V,g[8]*=V,g[12]*=V,g[1]*=V,g[5]*=V,g[9]*=V,g[13]*=V,g[2]*=V,g[6]*=V,g[10]*=V,g[14]*=V,g[3]*=V,g[7]*=V,g[11]*=V,g[15]*=V,this}determinant(){const V=this.elements,g=V[0],I=V[4],e=V[8],t=V[12],C=V[1],A=V[5],s=V[9],a=V[13],o=V[2],n=V[6],l=V[10],c=V[14],d=V[3],h=V[7],m=V[11],r=V[15];return d*(+t*s*n-e*a*n-t*A*l+I*a*l+e*A*c-I*s*c)+h*(+g*s*c-g*a*l+t*C*l-e*C*c+e*a*o-t*s*o)+m*(+g*a*n-g*A*c-t*C*n+I*C*c+t*A*o-I*a*o)+r*(-e*A*o-g*s*n+g*A*l+e*C*n-I*C*l+I*s*o)}transpose(){const V=this.elements;let g;return g=V[1],V[1]=V[4],V[4]=g,g=V[2],V[2]=V[8],V[8]=g,g=V[6],V[6]=V[9],V[9]=g,g=V[3],V[3]=V[12],V[12]=g,g=V[7],V[7]=V[13],V[13]=g,g=V[11],V[11]=V[14],V[14]=g,this}setPosition(V,g,I){const e=this.elements;return V.isVector3?(e[12]=V.x,e[13]=V.y,e[14]=V.z):(e[12]=V,e[13]=g,e[14]=I),this}invert(){const V=this.elements,g=V[0],I=V[1],e=V[2],t=V[3],C=V[4],A=V[5],s=V[6],a=V[7],o=V[8],n=V[9],l=V[10],c=V[11],d=V[12],h=V[13],m=V[14],r=V[15],u=n*m*a-h*l*a+h*s*c-A*m*c-n*s*r+A*l*r,b=d*l*a-o*m*a-d*s*c+C*m*c+o*s*r-C*l*r,Z=o*h*a-d*n*a+d*A*c-C*h*c-o*A*r+C*n*r,p=d*n*s-o*h*s-d*A*l+C*h*l+o*A*m-C*n*m,G=g*u+I*b+e*Z+t*p;if(G===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const X=1/G;return V[0]=u*X,V[1]=(h*l*t-n*m*t-h*e*c+I*m*c+n*e*r-I*l*r)*X,V[2]=(A*m*t-h*s*t+h*e*a-I*m*a-A*e*r+I*s*r)*X,V[3]=(n*s*t-A*l*t-n*e*a+I*l*a+A*e*c-I*s*c)*X,V[4]=b*X,V[5]=(o*m*t-d*l*t+d*e*c-g*m*c-o*e*r+g*l*r)*X,V[6]=(d*s*t-C*m*t-d*e*a+g*m*a+C*e*r-g*s*r)*X,V[7]=(C*l*t-o*s*t+o*e*a-g*l*a-C*e*c+g*s*c)*X,V[8]=Z*X,V[9]=(d*n*t-o*h*t-d*I*c+g*h*c+o*I*r-g*n*r)*X,V[10]=(C*h*t-d*A*t+d*I*a-g*h*a-C*I*r+g*A*r)*X,V[11]=(o*A*t-C*n*t-o*I*a+g*n*a+C*I*c-g*A*c)*X,V[12]=p*X,V[13]=(o*h*e-d*n*e+d*I*l-g*h*l-o*I*m+g*n*m)*X,V[14]=(d*A*e-C*h*e-d*I*s+g*h*s+C*I*m-g*A*m)*X,V[15]=(C*n*e-o*A*e+o*I*s-g*n*s-C*I*l+g*A*l)*X,this}scale(V){const g=this.elements,I=V.x,e=V.y,t=V.z;return g[0]*=I,g[4]*=e,g[8]*=t,g[1]*=I,g[5]*=e,g[9]*=t,g[2]*=I,g[6]*=e,g[10]*=t,g[3]*=I,g[7]*=e,g[11]*=t,this}getMaxScaleOnAxis(){const V=this.elements,g=V[0]*V[0]+V[1]*V[1]+V[2]*V[2],I=V[4]*V[4]+V[5]*V[5]+V[6]*V[6],e=V[8]*V[8]+V[9]*V[9]+V[10]*V[10];return Math.sqrt(Math.max(g,I,e))}makeTranslation(V,g,I){return this.set(1,0,0,V,0,1,0,g,0,0,1,I,0,0,0,1),this}makeRotationX(V){const g=Math.cos(V),I=Math.sin(V);return this.set(1,0,0,0,0,g,-I,0,0,I,g,0,0,0,0,1),this}makeRotationY(V){const g=Math.cos(V),I=Math.sin(V);return this.set(g,0,I,0,0,1,0,0,-I,0,g,0,0,0,0,1),this}makeRotationZ(V){const g=Math.cos(V),I=Math.sin(V);return this.set(g,-I,0,0,I,g,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(V,g){const I=Math.cos(g),e=Math.sin(g),t=1-I,C=V.x,A=V.y,s=V.z,a=t*C,o=t*A;return this.set(a*C+I,a*A-e*s,a*s+e*A,0,a*A+e*s,o*A+I,o*s-e*C,0,a*s-e*A,o*s+e*C,t*s*s+I,0,0,0,0,1),this}makeScale(V,g,I){return this.set(V,0,0,0,0,g,0,0,0,0,I,0,0,0,0,1),this}makeShear(V,g,I,e,t,C){return this.set(1,I,t,0,V,1,C,0,g,e,1,0,0,0,0,1),this}compose(V,g,I){const e=this.elements,t=g._x,C=g._y,A=g._z,s=g._w,a=t+t,o=C+C,n=A+A,l=t*a,c=t*o,d=t*n,h=C*o,m=C*n,r=A*n,u=s*a,b=s*o,Z=s*n,p=I.x,G=I.y,X=I.z;return e[0]=(1-(h+r))*p,e[1]=(c+Z)*p,e[2]=(d-b)*p,e[3]=0,e[4]=(c-Z)*G,e[5]=(1-(l+r))*G,e[6]=(m+u)*G,e[7]=0,e[8]=(d+b)*X,e[9]=(m-u)*X,e[10]=(1-(l+h))*X,e[11]=0,e[12]=V.x,e[13]=V.y,e[14]=V.z,e[15]=1,this}decompose(V,g,I){const e=this.elements;let t=kt.set(e[0],e[1],e[2]).length();const C=kt.set(e[4],e[5],e[6]).length(),A=kt.set(e[8],e[9],e[10]).length();this.determinant()<0&&(t=-t),V.x=e[12],V.y=e[13],V.z=e[14],zI.copy(this);const a=1/t,o=1/C,n=1/A;return zI.elements[0]*=a,zI.elements[1]*=a,zI.elements[2]*=a,zI.elements[4]*=o,zI.elements[5]*=o,zI.elements[6]*=o,zI.elements[8]*=n,zI.elements[9]*=n,zI.elements[10]*=n,g.setFromRotationMatrix(zI),I.x=t,I.y=C,I.z=A,this}makePerspective(V,g,I,e,t,C){C===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const A=this.elements,s=2*t/(g-V),a=2*t/(I-e),o=(g+V)/(g-V),n=(I+e)/(I-e),l=-(C+t)/(C-t),c=-2*C*t/(C-t);return A[0]=s,A[4]=0,A[8]=o,A[12]=0,A[1]=0,A[5]=a,A[9]=n,A[13]=0,A[2]=0,A[6]=0,A[10]=l,A[14]=c,A[3]=0,A[7]=0,A[11]=-1,A[15]=0,this}makeOrthographic(V,g,I,e,t,C){const A=this.elements,s=1/(g-V),a=1/(I-e),o=1/(C-t),n=(g+V)*s,l=(I+e)*a,c=(C+t)*o;return A[0]=2*s,A[4]=0,A[8]=0,A[12]=-n,A[1]=0,A[5]=2*a,A[9]=0,A[13]=-l,A[2]=0,A[6]=0,A[10]=-2*o,A[14]=-c,A[3]=0,A[7]=0,A[11]=0,A[15]=1,this}equals(V){const g=this.elements,I=V.elements;for(let e=0;e<16;e++)if(g[e]!==I[e])return!1;return!0}fromArray(V,g=0){for(let I=0;I<16;I++)this.elements[I]=V[I+g];return this}toArray(V=[],g=0){const I=this.elements;return V[g]=I[0],V[g+1]=I[1],V[g+2]=I[2],V[g+3]=I[3],V[g+4]=I[4],V[g+5]=I[5],V[g+6]=I[6],V[g+7]=I[7],V[g+8]=I[8],V[g+9]=I[9],V[g+10]=I[10],V[g+11]=I[11],V[g+12]=I[12],V[g+13]=I[13],V[g+14]=I[14],V[g+15]=I[15],V}}JV.prototype.isMatrix4=!0;const kt=new S,zI=new JV,IZ=new S(0,0,0),eZ=new S(1,1,1),ve=new S,Ei=new S,mI=new S,Ta=new JV,La=new Rg;class ee{constructor(V=0,g=0,I=0,e=ee.DefaultOrder){this._x=V,this._y=g,this._z=I,this._order=e}get x(){return this._x}set x(V){this._x=V,this._onChangeCallback()}get y(){return this._y}set y(V){this._y=V,this._onChangeCallback()}get z(){return this._z}set z(V){this._z=V,this._onChangeCallback()}get order(){return this._order}set order(V){this._order=V,this._onChangeCallback()}set(V,g,I,e=this._order){return this._x=V,this._y=g,this._z=I,this._order=e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(V){return this._x=V._x,this._y=V._y,this._z=V._z,this._order=V._order,this._onChangeCallback(),this}setFromRotationMatrix(V,g=this._order,I=!0){const e=V.elements,t=e[0],C=e[4],A=e[8],s=e[1],a=e[5],o=e[9],n=e[2],l=e[6],c=e[10];switch(g){case"XYZ":this._y=Math.asin(eI(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(-o,c),this._z=Math.atan2(-C,t)):(this._x=Math.atan2(l,a),this._z=0);break;case"YXZ":this._x=Math.asin(-eI(o,-1,1)),Math.abs(o)<.9999999?(this._y=Math.atan2(A,c),this._z=Math.atan2(s,a)):(this._y=Math.atan2(-n,t),this._z=0);break;case"ZXY":this._x=Math.asin(eI(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(-n,c),this._z=Math.atan2(-C,a)):(this._y=0,this._z=Math.atan2(s,t));break;case"ZYX":this._y=Math.asin(-eI(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(l,c),this._z=Math.atan2(s,t)):(this._x=0,this._z=Math.atan2(-C,a));break;case"YZX":this._z=Math.asin(eI(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-o,a),this._y=Math.atan2(-n,t)):(this._x=0,this._y=Math.atan2(A,c));break;case"XZY":this._z=Math.asin(-eI(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(l,a),this._y=Math.atan2(A,t)):(this._x=Math.atan2(-o,c),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+g)}return this._order=g,I===!0&&this._onChangeCallback(),this}setFromQuaternion(V,g,I){return Ta.makeRotationFromQuaternion(V),this.setFromRotationMatrix(Ta,g,I)}setFromVector3(V,g=this._order){return this.set(V.x,V.y,V.z,g)}reorder(V){return La.setFromEuler(this),this.setFromQuaternion(La,V)}equals(V){return V._x===this._x&&V._y===this._y&&V._z===this._z&&V._order===this._order}fromArray(V){return this._x=V[0],this._y=V[1],this._z=V[2],V[3]!==void 0&&(this._order=V[3]),this._onChangeCallback(),this}toArray(V=[],g=0){return V[g]=this._x,V[g+1]=this._y,V[g+2]=this._z,V[g+3]=this._order,V}toVector3(V){return V?V.set(this._x,this._y,this._z):new S(this._x,this._y,this._z)}_onChange(V){return this._onChangeCallback=V,this}_onChangeCallback(){}}ee.prototype.isEuler=!0;ee.DefaultOrder="XYZ";ee.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class jc{constructor(){this.mask=1}set(V){this.mask=1<<V|0}enable(V){this.mask|=1<<V|0}enableAll(){this.mask=-1}toggle(V){this.mask^=1<<V|0}disable(V){this.mask&=~(1<<V|0)}disableAll(){this.mask=0}test(V){return(this.mask&V.mask)!==0}}let tZ=0;const Ua=new S,zt=new Rg,de=new JV,Qi=new S,xC=new S,CZ=new S,iZ=new Rg,Da=new S(1,0,0),Ea=new S(0,1,0),Qa=new S(0,0,1),AZ={type:"added"},ja={type:"removed"};class UV extends wt{constructor(){super(),Object.defineProperty(this,"id",{value:tZ++}),this.uuid=KI(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=UV.DefaultUp.clone();const V=new S,g=new ee,I=new Rg,e=new S(1,1,1);function t(){I.setFromEuler(g,!1)}function C(){g.setFromQuaternion(I,void 0,!1)}g._onChange(t),I._onChange(C),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:V},rotation:{configurable:!0,enumerable:!0,value:g},quaternion:{configurable:!0,enumerable:!0,value:I},scale:{configurable:!0,enumerable:!0,value:e},modelViewMatrix:{value:new JV},normalMatrix:{value:new Dg}}),this.matrix=new JV,this.matrixWorld=new JV,this.matrixAutoUpdate=UV.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new jc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(V){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(V),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(V){return this.quaternion.premultiply(V),this}setRotationFromAxisAngle(V,g){this.quaternion.setFromAxisAngle(V,g)}setRotationFromEuler(V){this.quaternion.setFromEuler(V,!0)}setRotationFromMatrix(V){this.quaternion.setFromRotationMatrix(V)}setRotationFromQuaternion(V){this.quaternion.copy(V)}rotateOnAxis(V,g){return zt.setFromAxisAngle(V,g),this.quaternion.multiply(zt),this}rotateOnWorldAxis(V,g){return zt.setFromAxisAngle(V,g),this.quaternion.premultiply(zt),this}rotateX(V){return this.rotateOnAxis(Da,V)}rotateY(V){return this.rotateOnAxis(Ea,V)}rotateZ(V){return this.rotateOnAxis(Qa,V)}translateOnAxis(V,g){return Ua.copy(V).applyQuaternion(this.quaternion),this.position.add(Ua.multiplyScalar(g)),this}translateX(V){return this.translateOnAxis(Da,V)}translateY(V){return this.translateOnAxis(Ea,V)}translateZ(V){return this.translateOnAxis(Qa,V)}localToWorld(V){return V.applyMatrix4(this.matrixWorld)}worldToLocal(V){return V.applyMatrix4(de.copy(this.matrixWorld).invert())}lookAt(V,g,I){V.isVector3?Qi.copy(V):Qi.set(V,g,I);const e=this.parent;this.updateWorldMatrix(!0,!1),xC.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?de.lookAt(xC,Qi,this.up):de.lookAt(Qi,xC,this.up),this.quaternion.setFromRotationMatrix(de),e&&(de.extractRotation(e.matrixWorld),zt.setFromRotationMatrix(de),this.quaternion.premultiply(zt.invert()))}add(V){if(arguments.length>1){for(let g=0;g<arguments.length;g++)this.add(arguments[g]);return this}return V===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",V),this):(V&&V.isObject3D?(V.parent!==null&&V.parent.remove(V),V.parent=this,this.children.push(V),V.dispatchEvent(AZ)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",V),this)}remove(V){if(arguments.length>1){for(let I=0;I<arguments.length;I++)this.remove(arguments[I]);return this}const g=this.children.indexOf(V);return g!==-1&&(V.parent=null,this.children.splice(g,1),V.dispatchEvent(ja)),this}removeFromParent(){const V=this.parent;return V!==null&&V.remove(this),this}clear(){for(let V=0;V<this.children.length;V++){const g=this.children[V];g.parent=null,g.dispatchEvent(ja)}return this.children.length=0,this}attach(V){return this.updateWorldMatrix(!0,!1),de.copy(this.matrixWorld).invert(),V.parent!==null&&(V.parent.updateWorldMatrix(!0,!1),de.multiply(V.parent.matrixWorld)),V.applyMatrix4(de),this.add(V),V.updateWorldMatrix(!1,!0),this}getObjectById(V){return this.getObjectByProperty("id",V)}getObjectByName(V){return this.getObjectByProperty("name",V)}getObjectByProperty(V,g){if(this[V]===g)return this;for(let I=0,e=this.children.length;I<e;I++){const C=this.children[I].getObjectByProperty(V,g);if(C!==void 0)return C}}getWorldPosition(V){return this.updateWorldMatrix(!0,!1),V.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(V){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xC,V,CZ),V}getWorldScale(V){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xC,iZ,V),V}getWorldDirection(V){this.updateWorldMatrix(!0,!1);const g=this.matrixWorld.elements;return V.set(g[8],g[9],g[10]).normalize()}raycast(){}traverse(V){V(this);const g=this.children;for(let I=0,e=g.length;I<e;I++)g[I].traverse(V)}traverseVisible(V){if(this.visible===!1)return;V(this);const g=this.children;for(let I=0,e=g.length;I<e;I++)g[I].traverseVisible(V)}traverseAncestors(V){const g=this.parent;g!==null&&(V(g),g.traverseAncestors(V))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(V){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||V)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,V=!0);const g=this.children;for(let I=0,e=g.length;I<e;I++)g[I].updateMatrixWorld(V)}updateWorldMatrix(V,g){const I=this.parent;if(V===!0&&I!==null&&I.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),g===!0){const e=this.children;for(let t=0,C=e.length;t<C;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(V){const g=V===void 0||typeof V=="string",I={};g&&(V={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},I.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const e={};e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.castShadow===!0&&(e.castShadow=!0),this.receiveShadow===!0&&(e.receiveShadow=!0),this.visible===!1&&(e.visible=!1),this.frustumCulled===!1&&(e.frustumCulled=!1),this.renderOrder!==0&&(e.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(e.userData=this.userData),e.layers=this.layers.mask,e.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(e.matrixAutoUpdate=!1),this.isInstancedMesh&&(e.type="InstancedMesh",e.count=this.count,e.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(e.instanceColor=this.instanceColor.toJSON()));function t(A,s){return A[s.uuid]===void 0&&(A[s.uuid]=s.toJSON(V)),s.uuid}if(this.isScene)this.background&&(this.background.isColor?e.background=this.background.toJSON():this.background.isTexture&&(e.background=this.background.toJSON(V).uuid)),this.environment&&this.environment.isTexture&&(e.environment=this.environment.toJSON(V).uuid);else if(this.isMesh||this.isLine||this.isPoints){e.geometry=t(V.geometries,this.geometry);const A=this.geometry.parameters;if(A!==void 0&&A.shapes!==void 0){const s=A.shapes;if(Array.isArray(s))for(let a=0,o=s.length;a<o;a++){const n=s[a];t(V.shapes,n)}else t(V.shapes,s)}}if(this.isSkinnedMesh&&(e.bindMode=this.bindMode,e.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(t(V.skeletons,this.skeleton),e.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const A=[];for(let s=0,a=this.material.length;s<a;s++)A.push(t(V.materials,this.material[s]));e.material=A}else e.material=t(V.materials,this.material);if(this.children.length>0){e.children=[];for(let A=0;A<this.children.length;A++)e.children.push(this.children[A].toJSON(V).object)}if(this.animations.length>0){e.animations=[];for(let A=0;A<this.animations.length;A++){const s=this.animations[A];e.animations.push(t(V.animations,s))}}if(g){const A=C(V.geometries),s=C(V.materials),a=C(V.textures),o=C(V.images),n=C(V.shapes),l=C(V.skeletons),c=C(V.animations);A.length>0&&(I.geometries=A),s.length>0&&(I.materials=s),a.length>0&&(I.textures=a),o.length>0&&(I.images=o),n.length>0&&(I.shapes=n),l.length>0&&(I.skeletons=l),c.length>0&&(I.animations=c)}return I.object=e,I;function C(A){const s=[];for(const a in A){const o=A[a];delete o.metadata,s.push(o)}return s}}clone(V){return new this.constructor().copy(this,V)}copy(V,g=!0){if(this.name=V.name,this.up.copy(V.up),this.position.copy(V.position),this.rotation.order=V.rotation.order,this.quaternion.copy(V.quaternion),this.scale.copy(V.scale),this.matrix.copy(V.matrix),this.matrixWorld.copy(V.matrixWorld),this.matrixAutoUpdate=V.matrixAutoUpdate,this.matrixWorldNeedsUpdate=V.matrixWorldNeedsUpdate,this.layers.mask=V.layers.mask,this.visible=V.visible,this.castShadow=V.castShadow,this.receiveShadow=V.receiveShadow,this.frustumCulled=V.frustumCulled,this.renderOrder=V.renderOrder,this.userData=JSON.parse(JSON.stringify(V.userData)),g===!0)for(let I=0;I<V.children.length;I++){const e=V.children[I];this.add(e.clone())}return this}}UV.DefaultUp=new S(0,1,0);UV.DefaultMatrixAutoUpdate=!0;UV.prototype.isObject3D=!0;const TI=new S,re=new S,Wn=new S,he=new S,Tt=new S,Lt=new S,Pa=new S,yn=new S,Xn=new S,Rn=new S;class Xg{constructor(V=new S,g=new S,I=new S){this.a=V,this.b=g,this.c=I}static getNormal(V,g,I,e){e.subVectors(I,g),TI.subVectors(V,g),e.cross(TI);const t=e.lengthSq();return t>0?e.multiplyScalar(1/Math.sqrt(t)):e.set(0,0,0)}static getBarycoord(V,g,I,e,t){TI.subVectors(e,g),re.subVectors(I,g),Wn.subVectors(V,g);const C=TI.dot(TI),A=TI.dot(re),s=TI.dot(Wn),a=re.dot(re),o=re.dot(Wn),n=C*a-A*A;if(n===0)return t.set(-2,-1,-1);const l=1/n,c=(a*s-A*o)*l,d=(C*o-A*s)*l;return t.set(1-c-d,d,c)}static containsPoint(V,g,I,e){return this.getBarycoord(V,g,I,e,he),he.x>=0&&he.y>=0&&he.x+he.y<=1}static getUV(V,g,I,e,t,C,A,s){return this.getBarycoord(V,g,I,e,he),s.set(0,0),s.addScaledVector(t,he.x),s.addScaledVector(C,he.y),s.addScaledVector(A,he.z),s}static isFrontFacing(V,g,I,e){return TI.subVectors(I,g),re.subVectors(V,g),TI.cross(re).dot(e)<0}set(V,g,I){return this.a.copy(V),this.b.copy(g),this.c.copy(I),this}setFromPointsAndIndices(V,g,I,e){return this.a.copy(V[g]),this.b.copy(V[I]),this.c.copy(V[e]),this}clone(){return new this.constructor().copy(this)}copy(V){return this.a.copy(V.a),this.b.copy(V.b),this.c.copy(V.c),this}getArea(){return TI.subVectors(this.c,this.b),re.subVectors(this.a,this.b),TI.cross(re).length()*.5}getMidpoint(V){return V.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(V){return Xg.getNormal(this.a,this.b,this.c,V)}getPlane(V){return V.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(V,g){return Xg.getBarycoord(V,this.a,this.b,this.c,g)}getUV(V,g,I,e,t){return Xg.getUV(V,this.a,this.b,this.c,g,I,e,t)}containsPoint(V){return Xg.containsPoint(V,this.a,this.b,this.c)}isFrontFacing(V){return Xg.isFrontFacing(this.a,this.b,this.c,V)}intersectsBox(V){return V.intersectsTriangle(this)}closestPointToPoint(V,g){const I=this.a,e=this.b,t=this.c;let C,A;Tt.subVectors(e,I),Lt.subVectors(t,I),yn.subVectors(V,I);const s=Tt.dot(yn),a=Lt.dot(yn);if(s<=0&&a<=0)return g.copy(I);Xn.subVectors(V,e);const o=Tt.dot(Xn),n=Lt.dot(Xn);if(o>=0&&n<=o)return g.copy(e);const l=s*n-o*a;if(l<=0&&s>=0&&o<=0)return C=s/(s-o),g.copy(I).addScaledVector(Tt,C);Rn.subVectors(V,t);const c=Tt.dot(Rn),d=Lt.dot(Rn);if(d>=0&&c<=d)return g.copy(t);const h=c*a-s*d;if(h<=0&&a>=0&&d<=0)return A=a/(a-d),g.copy(I).addScaledVector(Lt,A);const m=o*d-c*n;if(m<=0&&n-o>=0&&c-d>=0)return Pa.subVectors(t,e),A=(n-o)/(n-o+(c-d)),g.copy(e).addScaledVector(Pa,A);const r=1/(m+h+l);return C=h*r,A=l*r,g.copy(I).addScaledVector(Tt,C).addScaledVector(Lt,A)}equals(V){return V.a.equals(this.a)&&V.b.equals(this.b)&&V.c.equals(this.c)}}let nZ=0;class xg extends wt{constructor(){super(),Object.defineProperty(this,"id",{value:nZ++}),this.uuid=KI(),this.name="",this.type="Material",this.fog=!0,this.blending=ti,this.side=rC,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Mc,this.blendDst=xc,this.blendEquation=IC,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=qs,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Mb,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=rn,this.stencilZFail=rn,this.stencilZPass=rn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(V){if(V!==void 0)for(const g in V){const I=V[g];if(I===void 0){console.warn("THREE.Material: '"+g+"' parameter is undefined.");continue}if(g==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=I===Jc;continue}const e=this[g];if(e===void 0){console.warn("THREE."+this.type+": '"+g+"' is not a property of this material.");continue}e&&e.isColor?e.set(I):e&&e.isVector3&&I&&I.isVector3?e.copy(I):this[g]=I}}toJSON(V){const g=V===void 0||typeof V=="string";g&&(V={textures:{},images:{}});const I={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};I.uuid=this.uuid,I.type=this.type,this.name!==""&&(I.name=this.name),this.color&&this.color.isColor&&(I.color=this.color.getHex()),this.roughness!==void 0&&(I.roughness=this.roughness),this.metalness!==void 0&&(I.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(I.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(I.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(I.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(I.specular=this.specular.getHex()),this.shininess!==void 0&&(I.shininess=this.shininess),this.clearcoat!==void 0&&(I.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(I.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(I.clearcoatMap=this.clearcoatMap.toJSON(V).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(I.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(V).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(I.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(V).uuid,I.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(I.map=this.map.toJSON(V).uuid),this.matcap&&this.matcap.isTexture&&(I.matcap=this.matcap.toJSON(V).uuid),this.alphaMap&&this.alphaMap.isTexture&&(I.alphaMap=this.alphaMap.toJSON(V).uuid),this.lightMap&&this.lightMap.isTexture&&(I.lightMap=this.lightMap.toJSON(V).uuid,I.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(I.aoMap=this.aoMap.toJSON(V).uuid,I.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(I.bumpMap=this.bumpMap.toJSON(V).uuid,I.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(I.normalMap=this.normalMap.toJSON(V).uuid,I.normalMapType=this.normalMapType,I.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(I.displacementMap=this.displacementMap.toJSON(V).uuid,I.displacementScale=this.displacementScale,I.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(I.roughnessMap=this.roughnessMap.toJSON(V).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(I.metalnessMap=this.metalnessMap.toJSON(V).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(I.emissiveMap=this.emissiveMap.toJSON(V).uuid),this.specularMap&&this.specularMap.isTexture&&(I.specularMap=this.specularMap.toJSON(V).uuid),this.envMap&&this.envMap.isTexture&&(I.envMap=this.envMap.toJSON(V).uuid,this.combine!==void 0&&(I.combine=this.combine)),this.envMapIntensity!==void 0&&(I.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(I.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(I.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(I.gradientMap=this.gradientMap.toJSON(V).uuid),this.transmission!==void 0&&(I.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(I.transmissionMap=this.transmissionMap.toJSON(V).uuid),this.thickness!==void 0&&(I.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(I.thicknessMap=this.thicknessMap.toJSON(V).uuid),this.attenuationDistance!==void 0&&(I.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(I.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(I.size=this.size),this.shadowSide!==null&&(I.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(I.sizeAttenuation=this.sizeAttenuation),this.blending!==ti&&(I.blending=this.blending),this.side!==rC&&(I.side=this.side),this.vertexColors&&(I.vertexColors=!0),this.opacity<1&&(I.opacity=this.opacity),this.transparent===!0&&(I.transparent=this.transparent),I.depthFunc=this.depthFunc,I.depthTest=this.depthTest,I.depthWrite=this.depthWrite,I.colorWrite=this.colorWrite,I.stencilWrite=this.stencilWrite,I.stencilWriteMask=this.stencilWriteMask,I.stencilFunc=this.stencilFunc,I.stencilRef=this.stencilRef,I.stencilFuncMask=this.stencilFuncMask,I.stencilFail=this.stencilFail,I.stencilZFail=this.stencilZFail,I.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(I.rotation=this.rotation),this.polygonOffset===!0&&(I.polygonOffset=!0),this.polygonOffsetFactor!==0&&(I.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(I.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(I.linewidth=this.linewidth),this.dashSize!==void 0&&(I.dashSize=this.dashSize),this.gapSize!==void 0&&(I.gapSize=this.gapSize),this.scale!==void 0&&(I.scale=this.scale),this.dithering===!0&&(I.dithering=!0),this.alphaTest>0&&(I.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(I.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(I.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(I.wireframe=this.wireframe),this.wireframeLinewidth>1&&(I.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(I.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(I.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(I.morphTargets=!0),this.morphNormals===!0&&(I.morphNormals=!0),this.flatShading===!0&&(I.flatShading=this.flatShading),this.visible===!1&&(I.visible=!1),this.toneMapped===!1&&(I.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(I.userData=this.userData);function e(t){const C=[];for(const A in t){const s=t[A];delete s.metadata,C.push(s)}return C}if(g){const t=e(V.textures),C=e(V.images);t.length>0&&(I.textures=t),C.length>0&&(I.images=C)}return I}clone(){return new this.constructor().copy(this)}copy(V){this.name=V.name,this.fog=V.fog,this.blending=V.blending,this.side=V.side,this.vertexColors=V.vertexColors,this.opacity=V.opacity,this.transparent=V.transparent,this.blendSrc=V.blendSrc,this.blendDst=V.blendDst,this.blendEquation=V.blendEquation,this.blendSrcAlpha=V.blendSrcAlpha,this.blendDstAlpha=V.blendDstAlpha,this.blendEquationAlpha=V.blendEquationAlpha,this.depthFunc=V.depthFunc,this.depthTest=V.depthTest,this.depthWrite=V.depthWrite,this.stencilWriteMask=V.stencilWriteMask,this.stencilFunc=V.stencilFunc,this.stencilRef=V.stencilRef,this.stencilFuncMask=V.stencilFuncMask,this.stencilFail=V.stencilFail,this.stencilZFail=V.stencilZFail,this.stencilZPass=V.stencilZPass,this.stencilWrite=V.stencilWrite;const g=V.clippingPlanes;let I=null;if(g!==null){const e=g.length;I=new Array(e);for(let t=0;t!==e;++t)I[t]=g[t].clone()}return this.clippingPlanes=I,this.clipIntersection=V.clipIntersection,this.clipShadows=V.clipShadows,this.shadowSide=V.shadowSide,this.colorWrite=V.colorWrite,this.precision=V.precision,this.polygonOffset=V.polygonOffset,this.polygonOffsetFactor=V.polygonOffsetFactor,this.polygonOffsetUnits=V.polygonOffsetUnits,this.dithering=V.dithering,this.alphaTest=V.alphaTest,this.alphaToCoverage=V.alphaToCoverage,this.premultipliedAlpha=V.premultipliedAlpha,this.visible=V.visible,this.toneMapped=V.toneMapped,this.userData=JSON.parse(JSON.stringify(V.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(V){V===!0&&this.version++}}xg.prototype.isMaterial=!0;const Pc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},LI={h:0,s:0,l:0},ji={h:0,s:0,l:0};function Yn(i,V,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?i+(V-i)*6*g:g<1/2?V:g<2/3?i+(V-i)*6*(2/3-g):i}function wn(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Hn(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}class NV{constructor(V,g,I){return g===void 0&&I===void 0?this.set(V):this.setRGB(V,g,I)}set(V){return V&&V.isColor?this.copy(V):typeof V=="number"?this.setHex(V):typeof V=="string"&&this.setStyle(V),this}setScalar(V){return this.r=V,this.g=V,this.b=V,this}setHex(V){return V=Math.floor(V),this.r=(V>>16&255)/255,this.g=(V>>8&255)/255,this.b=(V&255)/255,this}setRGB(V,g,I){return this.r=V,this.g=g,this.b=I,this}setHSL(V,g,I){if(V=ll(V,1),g=eI(g,0,1),I=eI(I,0,1),g===0)this.r=this.g=this.b=I;else{const e=I<=.5?I*(1+g):I+g-I*g,t=2*I-e;this.r=Yn(t,e,V+1/3),this.g=Yn(t,e,V),this.b=Yn(t,e,V-1/3)}return this}setStyle(V){function g(e){e!==void 0&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+V+" will be ignored.")}let I;if(I=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(V)){let e;const t=I[1],C=I[2];switch(t){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(C))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,g(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(C))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,g(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(C)){const A=parseFloat(e[1])/360,s=parseInt(e[2],10)/100,a=parseInt(e[3],10)/100;return g(e[4]),this.setHSL(A,s,a)}break}}else if(I=/^\#([A-Fa-f\d]+)$/.exec(V)){const e=I[1],t=e.length;if(t===3)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(t===6)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return V&&V.length>0?this.setColorName(V):this}setColorName(V){const g=Pc[V.toLowerCase()];return g!==void 0?this.setHex(g):console.warn("THREE.Color: Unknown color "+V),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(V){return this.r=V.r,this.g=V.g,this.b=V.b,this}copyGammaToLinear(V,g=2){return this.r=Math.pow(V.r,g),this.g=Math.pow(V.g,g),this.b=Math.pow(V.b,g),this}copyLinearToGamma(V,g=2){const I=g>0?1/g:1;return this.r=Math.pow(V.r,I),this.g=Math.pow(V.g,I),this.b=Math.pow(V.b,I),this}convertGammaToLinear(V){return this.copyGammaToLinear(this,V),this}convertLinearToGamma(V){return this.copyLinearToGamma(this,V),this}copySRGBToLinear(V){return this.r=wn(V.r),this.g=wn(V.g),this.b=wn(V.b),this}copyLinearToSRGB(V){return this.r=Hn(V.r),this.g=Hn(V.g),this.b=Hn(V.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(V){const g=this.r,I=this.g,e=this.b,t=Math.max(g,I,e),C=Math.min(g,I,e);let A,s;const a=(C+t)/2;if(C===t)A=0,s=0;else{const o=t-C;switch(s=a<=.5?o/(t+C):o/(2-t-C),t){case g:A=(I-e)/o+(I<e?6:0);break;case I:A=(e-g)/o+2;break;case e:A=(g-I)/o+4;break}A/=6}return V.h=A,V.s=s,V.l=a,V}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(V,g,I){return this.getHSL(LI),LI.h+=V,LI.s+=g,LI.l+=I,this.setHSL(LI.h,LI.s,LI.l),this}add(V){return this.r+=V.r,this.g+=V.g,this.b+=V.b,this}addColors(V,g){return this.r=V.r+g.r,this.g=V.g+g.g,this.b=V.b+g.b,this}addScalar(V){return this.r+=V,this.g+=V,this.b+=V,this}sub(V){return this.r=Math.max(0,this.r-V.r),this.g=Math.max(0,this.g-V.g),this.b=Math.max(0,this.b-V.b),this}multiply(V){return this.r*=V.r,this.g*=V.g,this.b*=V.b,this}multiplyScalar(V){return this.r*=V,this.g*=V,this.b*=V,this}lerp(V,g){return this.r+=(V.r-this.r)*g,this.g+=(V.g-this.g)*g,this.b+=(V.b-this.b)*g,this}lerpColors(V,g,I){return this.r=V.r+(g.r-V.r)*I,this.g=V.g+(g.g-V.g)*I,this.b=V.b+(g.b-V.b)*I,this}lerpHSL(V,g){this.getHSL(LI),V.getHSL(ji);const I=Ai(LI.h,ji.h,g),e=Ai(LI.s,ji.s,g),t=Ai(LI.l,ji.l,g);return this.setHSL(I,e,t),this}equals(V){return V.r===this.r&&V.g===this.g&&V.b===this.b}fromArray(V,g=0){return this.r=V[g],this.g=V[g+1],this.b=V[g+2],this}toArray(V=[],g=0){return V[g]=this.r,V[g+1]=this.g,V[g+2]=this.b,V}fromBufferAttribute(V,g){return this.r=V.getX(g),this.g=V.getY(g),this.b=V.getZ(g),V.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}NV.NAMES=Pc;NV.prototype.isColor=!0;NV.prototype.r=1;NV.prototype.g=1;NV.prototype.b=1;class EI extends xg{constructor(V){super(),this.type="MeshBasicMaterial",this.color=new NV(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=EA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(V)}copy(V){return super.copy(V),this.color.copy(V.color),this.map=V.map,this.lightMap=V.lightMap,this.lightMapIntensity=V.lightMapIntensity,this.aoMap=V.aoMap,this.aoMapIntensity=V.aoMapIntensity,this.specularMap=V.specularMap,this.alphaMap=V.alphaMap,this.envMap=V.envMap,this.combine=V.combine,this.reflectivity=V.reflectivity,this.refractionRatio=V.refractionRatio,this.wireframe=V.wireframe,this.wireframeLinewidth=V.wireframeLinewidth,this.wireframeLinecap=V.wireframeLinecap,this.wireframeLinejoin=V.wireframeLinejoin,this.morphTargets=V.morphTargets,this}}EI.prototype.isMeshBasicMaterial=!0;const lg=new S,Pi=new dV;class qg{constructor(V,g,I){if(Array.isArray(V))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=V,this.itemSize=g,this.count=V!==void 0?V.length/g:0,this.normalized=I===!0,this.usage=mi,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(V){V===!0&&this.version++}setUsage(V){return this.usage=V,this}copy(V){return this.name=V.name,this.array=new V.array.constructor(V.array),this.itemSize=V.itemSize,this.count=V.count,this.normalized=V.normalized,this.usage=V.usage,this}copyAt(V,g,I){V*=this.itemSize,I*=g.itemSize;for(let e=0,t=this.itemSize;e<t;e++)this.array[V+e]=g.array[I+e];return this}copyArray(V){return this.array.set(V),this}copyColorsArray(V){const g=this.array;let I=0;for(let e=0,t=V.length;e<t;e++){let C=V[e];C===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",e),C=new NV),g[I++]=C.r,g[I++]=C.g,g[I++]=C.b}return this}copyVector2sArray(V){const g=this.array;let I=0;for(let e=0,t=V.length;e<t;e++){let C=V[e];C===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",e),C=new dV),g[I++]=C.x,g[I++]=C.y}return this}copyVector3sArray(V){const g=this.array;let I=0;for(let e=0,t=V.length;e<t;e++){let C=V[e];C===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",e),C=new S),g[I++]=C.x,g[I++]=C.y,g[I++]=C.z}return this}copyVector4sArray(V){const g=this.array;let I=0;for(let e=0,t=V.length;e<t;e++){let C=V[e];C===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",e),C=new eg),g[I++]=C.x,g[I++]=C.y,g[I++]=C.z,g[I++]=C.w}return this}applyMatrix3(V){if(this.itemSize===2)for(let g=0,I=this.count;g<I;g++)Pi.fromBufferAttribute(this,g),Pi.applyMatrix3(V),this.setXY(g,Pi.x,Pi.y);else if(this.itemSize===3)for(let g=0,I=this.count;g<I;g++)lg.fromBufferAttribute(this,g),lg.applyMatrix3(V),this.setXYZ(g,lg.x,lg.y,lg.z);return this}applyMatrix4(V){for(let g=0,I=this.count;g<I;g++)lg.x=this.getX(g),lg.y=this.getY(g),lg.z=this.getZ(g),lg.applyMatrix4(V),this.setXYZ(g,lg.x,lg.y,lg.z);return this}applyNormalMatrix(V){for(let g=0,I=this.count;g<I;g++)lg.x=this.getX(g),lg.y=this.getY(g),lg.z=this.getZ(g),lg.applyNormalMatrix(V),this.setXYZ(g,lg.x,lg.y,lg.z);return this}transformDirection(V){for(let g=0,I=this.count;g<I;g++)lg.x=this.getX(g),lg.y=this.getY(g),lg.z=this.getZ(g),lg.transformDirection(V),this.setXYZ(g,lg.x,lg.y,lg.z);return this}set(V,g=0){return this.array.set(V,g),this}getX(V){return this.array[V*this.itemSize]}setX(V,g){return this.array[V*this.itemSize]=g,this}getY(V){return this.array[V*this.itemSize+1]}setY(V,g){return this.array[V*this.itemSize+1]=g,this}getZ(V){return this.array[V*this.itemSize+2]}setZ(V,g){return this.array[V*this.itemSize+2]=g,this}getW(V){return this.array[V*this.itemSize+3]}setW(V,g){return this.array[V*this.itemSize+3]=g,this}setXY(V,g,I){return V*=this.itemSize,this.array[V+0]=g,this.array[V+1]=I,this}setXYZ(V,g,I,e){return V*=this.itemSize,this.array[V+0]=g,this.array[V+1]=I,this.array[V+2]=e,this}setXYZW(V,g,I,e,t){return V*=this.itemSize,this.array[V+0]=g,this.array[V+1]=I,this.array[V+2]=e,this.array[V+3]=t,this}onUpload(V){return this.onUploadCallback=V,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const V={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(V.name=this.name),this.usage!==mi&&(V.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(V.updateRange=this.updateRange),V}}qg.prototype.isBufferAttribute=!0;class Oc extends qg{constructor(V,g,I){super(new Uint16Array(V),g,I)}}class _c extends qg{constructor(V,g,I){super(new Uint32Array(V),g,I)}}class sZ extends qg{constructor(V,g,I){super(new Uint16Array(V),g,I)}}sZ.prototype.isFloat16BufferAttribute=!0;class hg extends qg{constructor(V,g,I){super(new Float32Array(V),g,I)}}function $c(i){if(i.length===0)return-1/0;let V=i[0];for(let g=1,I=i.length;g<I;++g)i[g]>V&&(V=i[g]);return V}let lZ=0;const HI=new JV,fn=new UV,Ut=new S,uI=new pg,kC=new pg,Ng=new S;class $V extends wt{constructor(){super(),Object.defineProperty(this,"id",{value:lZ++}),this.uuid=KI(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(V){return Array.isArray(V)?this.index=new($c(V)>65535?_c:Oc)(V,1):this.index=V,this}getAttribute(V){return this.attributes[V]}setAttribute(V,g){return this.attributes[V]=g,this}deleteAttribute(V){return delete this.attributes[V],this}hasAttribute(V){return this.attributes[V]!==void 0}addGroup(V,g,I=0){this.groups.push({start:V,count:g,materialIndex:I})}clearGroups(){this.groups=[]}setDrawRange(V,g){this.drawRange.start=V,this.drawRange.count=g}applyMatrix4(V){const g=this.attributes.position;g!==void 0&&(g.applyMatrix4(V),g.needsUpdate=!0);const I=this.attributes.normal;if(I!==void 0){const t=new Dg().getNormalMatrix(V);I.applyNormalMatrix(t),I.needsUpdate=!0}const e=this.attributes.tangent;return e!==void 0&&(e.transformDirection(V),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(V){return HI.makeRotationFromQuaternion(V),this.applyMatrix4(HI),this}rotateX(V){return HI.makeRotationX(V),this.applyMatrix4(HI),this}rotateY(V){return HI.makeRotationY(V),this.applyMatrix4(HI),this}rotateZ(V){return HI.makeRotationZ(V),this.applyMatrix4(HI),this}translate(V,g,I){return HI.makeTranslation(V,g,I),this.applyMatrix4(HI),this}scale(V,g,I){return HI.makeScale(V,g,I),this.applyMatrix4(HI),this}lookAt(V){return fn.lookAt(V),fn.updateMatrix(),this.applyMatrix4(fn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ut).negate(),this.translate(Ut.x,Ut.y,Ut.z),this}setFromPoints(V){const g=[];for(let I=0,e=V.length;I<e;I++){const t=V[I];g.push(t.x,t.y,t.z||0)}return this.setAttribute("position",new hg(g,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new pg);const V=this.attributes.position,g=this.morphAttributes.position;if(V&&V.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));return}if(V!==void 0){if(this.boundingBox.setFromBufferAttribute(V),g)for(let I=0,e=g.length;I<e;I++){const t=g[I];uI.setFromBufferAttribute(t),this.morphTargetsRelative?(Ng.addVectors(this.boundingBox.min,uI.min),this.boundingBox.expandByPoint(Ng),Ng.addVectors(this.boundingBox.max,uI.max),this.boundingBox.expandByPoint(Ng)):(this.boundingBox.expandByPoint(uI.min),this.boundingBox.expandByPoint(uI.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new XI);const V=this.attributes.position,g=this.morphAttributes.position;if(V&&V.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new S,1/0);return}if(V){const I=this.boundingSphere.center;if(uI.setFromBufferAttribute(V),g)for(let t=0,C=g.length;t<C;t++){const A=g[t];kC.setFromBufferAttribute(A),this.morphTargetsRelative?(Ng.addVectors(uI.min,kC.min),uI.expandByPoint(Ng),Ng.addVectors(uI.max,kC.max),uI.expandByPoint(Ng)):(uI.expandByPoint(kC.min),uI.expandByPoint(kC.max))}uI.getCenter(I);let e=0;for(let t=0,C=V.count;t<C;t++)Ng.fromBufferAttribute(V,t),e=Math.max(e,I.distanceToSquared(Ng));if(g)for(let t=0,C=g.length;t<C;t++){const A=g[t],s=this.morphTargetsRelative;for(let a=0,o=A.count;a<o;a++)Ng.fromBufferAttribute(A,a),s&&(Ut.fromBufferAttribute(V,a),Ng.add(Ut)),e=Math.max(e,I.distanceToSquared(Ng))}this.boundingSphere.radius=Math.sqrt(e),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const V=this.index,g=this.attributes;if(V===null||g.position===void 0||g.normal===void 0||g.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const I=V.array,e=g.position.array,t=g.normal.array,C=g.uv.array,A=e.length/3;g.tangent===void 0&&this.setAttribute("tangent",new qg(new Float32Array(4*A),4));const s=g.tangent.array,a=[],o=[];for(let Y=0;Y<A;Y++)a[Y]=new S,o[Y]=new S;const n=new S,l=new S,c=new S,d=new dV,h=new dV,m=new dV,r=new S,u=new S;function b(Y,f,L){n.fromArray(e,Y*3),l.fromArray(e,f*3),c.fromArray(e,L*3),d.fromArray(C,Y*2),h.fromArray(C,f*2),m.fromArray(C,L*2),l.sub(n),c.sub(n),h.sub(d),m.sub(d);const R=1/(h.x*m.y-m.x*h.y);!isFinite(R)||(r.copy(l).multiplyScalar(m.y).addScaledVector(c,-h.y).multiplyScalar(R),u.copy(c).multiplyScalar(h.x).addScaledVector(l,-m.x).multiplyScalar(R),a[Y].add(r),a[f].add(r),a[L].add(r),o[Y].add(u),o[f].add(u),o[L].add(u))}let Z=this.groups;Z.length===0&&(Z=[{start:0,count:I.length}]);for(let Y=0,f=Z.length;Y<f;++Y){const L=Z[Y],R=L.start,J=L.count;for(let H=R,N=R+J;H<N;H+=3)b(I[H+0],I[H+1],I[H+2])}const p=new S,G=new S,X=new S,W=new S;function y(Y){X.fromArray(t,Y*3),W.copy(X);const f=a[Y];p.copy(f),p.sub(X.multiplyScalar(X.dot(f))).normalize(),G.crossVectors(W,f);const R=G.dot(o[Y])<0?-1:1;s[Y*4]=p.x,s[Y*4+1]=p.y,s[Y*4+2]=p.z,s[Y*4+3]=R}for(let Y=0,f=Z.length;Y<f;++Y){const L=Z[Y],R=L.start,J=L.count;for(let H=R,N=R+J;H<N;H+=3)y(I[H+0]),y(I[H+1]),y(I[H+2])}}computeVertexNormals(){const V=this.index,g=this.getAttribute("position");if(g!==void 0){let I=this.getAttribute("normal");if(I===void 0)I=new qg(new Float32Array(g.count*3),3),this.setAttribute("normal",I);else for(let l=0,c=I.count;l<c;l++)I.setXYZ(l,0,0,0);const e=new S,t=new S,C=new S,A=new S,s=new S,a=new S,o=new S,n=new S;if(V)for(let l=0,c=V.count;l<c;l+=3){const d=V.getX(l+0),h=V.getX(l+1),m=V.getX(l+2);e.fromBufferAttribute(g,d),t.fromBufferAttribute(g,h),C.fromBufferAttribute(g,m),o.subVectors(C,t),n.subVectors(e,t),o.cross(n),A.fromBufferAttribute(I,d),s.fromBufferAttribute(I,h),a.fromBufferAttribute(I,m),A.add(o),s.add(o),a.add(o),I.setXYZ(d,A.x,A.y,A.z),I.setXYZ(h,s.x,s.y,s.z),I.setXYZ(m,a.x,a.y,a.z)}else for(let l=0,c=g.count;l<c;l+=3)e.fromBufferAttribute(g,l+0),t.fromBufferAttribute(g,l+1),C.fromBufferAttribute(g,l+2),o.subVectors(C,t),n.subVectors(e,t),o.cross(n),I.setXYZ(l+0,o.x,o.y,o.z),I.setXYZ(l+1,o.x,o.y,o.z),I.setXYZ(l+2,o.x,o.y,o.z);this.normalizeNormals(),I.needsUpdate=!0}}merge(V,g){if(!(V&&V.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",V);return}g===void 0&&(g=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const I=this.attributes;for(const e in I){if(V.attributes[e]===void 0)continue;const C=I[e].array,A=V.attributes[e],s=A.array,a=A.itemSize*g,o=Math.min(s.length,C.length-a);for(let n=0,l=a;n<o;n++,l++)C[l]=s[n]}return this}normalizeNormals(){const V=this.attributes.normal;for(let g=0,I=V.count;g<I;g++)Ng.fromBufferAttribute(V,g),Ng.normalize(),V.setXYZ(g,Ng.x,Ng.y,Ng.z)}toNonIndexed(){function V(A,s){const a=A.array,o=A.itemSize,n=A.normalized,l=new a.constructor(s.length*o);let c=0,d=0;for(let h=0,m=s.length;h<m;h++){A.isInterleavedBufferAttribute?c=s[h]*A.data.stride+A.offset:c=s[h]*o;for(let r=0;r<o;r++)l[d++]=a[c++]}return new qg(l,o,n)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const g=new $V,I=this.index.array,e=this.attributes;for(const A in e){const s=e[A],a=V(s,I);g.setAttribute(A,a)}const t=this.morphAttributes;for(const A in t){const s=[],a=t[A];for(let o=0,n=a.length;o<n;o++){const l=a[o],c=V(l,I);s.push(c)}g.morphAttributes[A]=s}g.morphTargetsRelative=this.morphTargetsRelative;const C=this.groups;for(let A=0,s=C.length;A<s;A++){const a=C[A];g.addGroup(a.start,a.count,a.materialIndex)}return g}toJSON(){const V={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(V.uuid=this.uuid,V.type=this.type,this.name!==""&&(V.name=this.name),Object.keys(this.userData).length>0&&(V.userData=this.userData),this.parameters!==void 0){const s=this.parameters;for(const a in s)s[a]!==void 0&&(V[a]=s[a]);return V}V.data={attributes:{}};const g=this.index;g!==null&&(V.data.index={type:g.array.constructor.name,array:Array.prototype.slice.call(g.array)});const I=this.attributes;for(const s in I){const a=I[s];V.data.attributes[s]=a.toJSON(V.data)}const e={};let t=!1;for(const s in this.morphAttributes){const a=this.morphAttributes[s],o=[];for(let n=0,l=a.length;n<l;n++){const c=a[n];o.push(c.toJSON(V.data))}o.length>0&&(e[s]=o,t=!0)}t&&(V.data.morphAttributes=e,V.data.morphTargetsRelative=this.morphTargetsRelative);const C=this.groups;C.length>0&&(V.data.groups=JSON.parse(JSON.stringify(C)));const A=this.boundingSphere;return A!==null&&(V.data.boundingSphere={center:A.center.toArray(),radius:A.radius}),V}clone(){return new $V().copy(this)}copy(V){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const g={};this.name=V.name;const I=V.index;I!==null&&this.setIndex(I.clone(g));const e=V.attributes;for(const a in e){const o=e[a];this.setAttribute(a,o.clone(g))}const t=V.morphAttributes;for(const a in t){const o=[],n=t[a];for(let l=0,c=n.length;l<c;l++)o.push(n[l].clone(g));this.morphAttributes[a]=o}this.morphTargetsRelative=V.morphTargetsRelative;const C=V.groups;for(let a=0,o=C.length;a<o;a++){const n=C[a];this.addGroup(n.start,n.count,n.materialIndex)}const A=V.boundingBox;A!==null&&(this.boundingBox=A.clone());const s=V.boundingSphere;return s!==null&&(this.boundingSphere=s.clone()),this.drawRange.start=V.drawRange.start,this.drawRange.count=V.drawRange.count,this.userData=V.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}$V.prototype.isBufferGeometry=!0;const Oa=new JV,Dt=new Ht,Sn=new XI,Ne=new S,Ke=new S,Je=new S,Fn=new S,vn=new S,Nn=new S,Oi=new S,_i=new S,$i=new S,VA=new dV,gA=new dV,IA=new dV,Kn=new S,eA=new S;class og extends UV{constructor(V=new $V,g=new EI){super(),this.type="Mesh",this.geometry=V,this.material=g,this.updateMorphTargets()}copy(V){return super.copy(V),V.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=V.morphTargetInfluences.slice()),V.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},V.morphTargetDictionary)),this.material=V.material,this.geometry=V.geometry,this}updateMorphTargets(){const V=this.geometry;if(V.isBufferGeometry){const g=V.morphAttributes,I=Object.keys(g);if(I.length>0){const e=g[I[0]];if(e!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,C=e.length;t<C;t++){const A=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[A]=t}}}}else{const g=V.morphTargets;g!==void 0&&g.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(V,g){const I=this.geometry,e=this.material,t=this.matrixWorld;if(e===void 0||(I.boundingSphere===null&&I.computeBoundingSphere(),Sn.copy(I.boundingSphere),Sn.applyMatrix4(t),V.ray.intersectsSphere(Sn)===!1)||(Oa.copy(t).invert(),Dt.copy(V.ray).applyMatrix4(Oa),I.boundingBox!==null&&Dt.intersectsBox(I.boundingBox)===!1))return;let C;if(I.isBufferGeometry){const A=I.index,s=I.attributes.position,a=I.morphAttributes.position,o=I.morphTargetsRelative,n=I.attributes.uv,l=I.attributes.uv2,c=I.groups,d=I.drawRange;if(A!==null)if(Array.isArray(e))for(let h=0,m=c.length;h<m;h++){const r=c[h],u=e[r.materialIndex],b=Math.max(r.start,d.start),Z=Math.min(r.start+r.count,d.start+d.count);for(let p=b,G=Z;p<G;p+=3){const X=A.getX(p),W=A.getX(p+1),y=A.getX(p+2);C=tA(this,u,V,Dt,s,a,o,n,l,X,W,y),C&&(C.faceIndex=Math.floor(p/3),C.face.materialIndex=r.materialIndex,g.push(C))}}else{const h=Math.max(0,d.start),m=Math.min(A.count,d.start+d.count);for(let r=h,u=m;r<u;r+=3){const b=A.getX(r),Z=A.getX(r+1),p=A.getX(r+2);C=tA(this,e,V,Dt,s,a,o,n,l,b,Z,p),C&&(C.faceIndex=Math.floor(r/3),g.push(C))}}else if(s!==void 0)if(Array.isArray(e))for(let h=0,m=c.length;h<m;h++){const r=c[h],u=e[r.materialIndex],b=Math.max(r.start,d.start),Z=Math.min(r.start+r.count,d.start+d.count);for(let p=b,G=Z;p<G;p+=3){const X=p,W=p+1,y=p+2;C=tA(this,u,V,Dt,s,a,o,n,l,X,W,y),C&&(C.faceIndex=Math.floor(p/3),C.face.materialIndex=r.materialIndex,g.push(C))}}else{const h=Math.max(0,d.start),m=Math.min(s.count,d.start+d.count);for(let r=h,u=m;r<u;r+=3){const b=r,Z=r+1,p=r+2;C=tA(this,e,V,Dt,s,a,o,n,l,b,Z,p),C&&(C.faceIndex=Math.floor(r/3),g.push(C))}}}else I.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}og.prototype.isMesh=!0;function aZ(i,V,g,I,e,t,C,A){let s;if(V.side===wg?s=I.intersectTriangle(C,t,e,!0,A):s=I.intersectTriangle(e,t,C,V.side!==yt,A),s===null)return null;eA.copy(A),eA.applyMatrix4(i.matrixWorld);const a=g.ray.origin.distanceTo(eA);return a<g.near||a>g.far?null:{distance:a,point:eA.clone(),object:i}}function tA(i,V,g,I,e,t,C,A,s,a,o,n){Ne.fromBufferAttribute(e,a),Ke.fromBufferAttribute(e,o),Je.fromBufferAttribute(e,n);const l=i.morphTargetInfluences;if(V.morphTargets&&t&&l){Oi.set(0,0,0),_i.set(0,0,0),$i.set(0,0,0);for(let d=0,h=t.length;d<h;d++){const m=l[d],r=t[d];m!==0&&(Fn.fromBufferAttribute(r,a),vn.fromBufferAttribute(r,o),Nn.fromBufferAttribute(r,n),C?(Oi.addScaledVector(Fn,m),_i.addScaledVector(vn,m),$i.addScaledVector(Nn,m)):(Oi.addScaledVector(Fn.sub(Ne),m),_i.addScaledVector(vn.sub(Ke),m),$i.addScaledVector(Nn.sub(Je),m)))}Ne.add(Oi),Ke.add(_i),Je.add($i)}i.isSkinnedMesh&&(i.boneTransform(a,Ne),i.boneTransform(o,Ke),i.boneTransform(n,Je));const c=aZ(i,V,g,I,Ne,Ke,Je,Kn);if(c){A&&(VA.fromBufferAttribute(A,a),gA.fromBufferAttribute(A,o),IA.fromBufferAttribute(A,n),c.uv=Xg.getUV(Kn,Ne,Ke,Je,VA,gA,IA,new dV)),s&&(VA.fromBufferAttribute(s,a),gA.fromBufferAttribute(s,o),IA.fromBufferAttribute(s,n),c.uv2=Xg.getUV(Kn,Ne,Ke,Je,VA,gA,IA,new dV));const d={a,b:o,c:n,normal:new S,materialIndex:0};Xg.getNormal(Ne,Ke,Je,d.normal),c.face=d}return c}class ft extends $V{constructor(V=1,g=1,I=1,e=1,t=1,C=1){super(),this.type="BoxGeometry",this.parameters={width:V,height:g,depth:I,widthSegments:e,heightSegments:t,depthSegments:C};const A=this;e=Math.floor(e),t=Math.floor(t),C=Math.floor(C);const s=[],a=[],o=[],n=[];let l=0,c=0;d("z","y","x",-1,-1,I,g,V,C,t,0),d("z","y","x",1,-1,I,g,-V,C,t,1),d("x","z","y",1,1,V,I,g,e,C,2),d("x","z","y",1,-1,V,I,-g,e,C,3),d("x","y","z",1,-1,V,g,I,e,t,4),d("x","y","z",-1,-1,V,g,-I,e,t,5),this.setIndex(s),this.setAttribute("position",new hg(a,3)),this.setAttribute("normal",new hg(o,3)),this.setAttribute("uv",new hg(n,2));function d(h,m,r,u,b,Z,p,G,X,W,y){const Y=Z/X,f=p/W,L=Z/2,R=p/2,J=G/2,H=X+1,N=W+1;let v=0,T=0;const D=new S;for(let $=0;$<N;$++){const M=$*f-R;for(let _=0;_<H;_++){const x=_*Y-L;D[h]=x*u,D[m]=M*b,D[r]=J,a.push(D.x,D.y,D.z),D[h]=0,D[m]=0,D[r]=G>0?1:-1,o.push(D.x,D.y,D.z),n.push(_/X),n.push(1-$/W),v+=1}}for(let $=0;$<W;$++)for(let M=0;M<X;M++){const _=l+M+H*$,x=l+M+H*($+1),z=l+(M+1)+H*($+1),F=l+(M+1)+H*$;s.push(_,x,F),s.push(x,z,F),T+=6}A.addGroup(c,T,y),c+=T,l+=v}}static fromJSON(V){return new ft(V.width,V.height,V.depth,V.widthSegments,V.heightSegments,V.depthSegments)}}function mC(i){const V={};for(const g in i){V[g]={};for(const I in i[g]){const e=i[g][I];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture||e.isQuaternion)?V[g][I]=e.clone():Array.isArray(e)?V[g][I]=e.slice():V[g][I]=e}}return V}function Qg(i){const V={};for(let g=0;g<i.length;g++){const I=mC(i[g]);for(const e in I)V[e]=I[e]}return V}const St={clone:mC,merge:Qg};var oZ=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,cZ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Xe extends xg{constructor(V){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=oZ,this.fragmentShader=cZ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,V!==void 0&&(V.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(V))}copy(V){return super.copy(V),this.fragmentShader=V.fragmentShader,this.vertexShader=V.vertexShader,this.uniforms=mC(V.uniforms),this.defines=Object.assign({},V.defines),this.wireframe=V.wireframe,this.wireframeLinewidth=V.wireframeLinewidth,this.lights=V.lights,this.clipping=V.clipping,this.morphTargets=V.morphTargets,this.morphNormals=V.morphNormals,this.extensions=Object.assign({},V.extensions),this.glslVersion=V.glslVersion,this}toJSON(V){const g=super.toJSON(V);g.glslVersion=this.glslVersion,g.uniforms={};for(const e in this.uniforms){const C=this.uniforms[e].value;C&&C.isTexture?g.uniforms[e]={type:"t",value:C.toJSON(V).uuid}:C&&C.isColor?g.uniforms[e]={type:"c",value:C.getHex()}:C&&C.isVector2?g.uniforms[e]={type:"v2",value:C.toArray()}:C&&C.isVector3?g.uniforms[e]={type:"v3",value:C.toArray()}:C&&C.isVector4?g.uniforms[e]={type:"v4",value:C.toArray()}:C&&C.isMatrix3?g.uniforms[e]={type:"m3",value:C.toArray()}:C&&C.isMatrix4?g.uniforms[e]={type:"m4",value:C.toArray()}:g.uniforms[e]={value:C}}Object.keys(this.defines).length>0&&(g.defines=this.defines),g.vertexShader=this.vertexShader,g.fragmentShader=this.fragmentShader;const I={};for(const e in this.extensions)this.extensions[e]===!0&&(I[e]=!0);return Object.keys(I).length>0&&(g.extensions=I),g}}Xe.prototype.isShaderMaterial=!0;class al extends UV{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new JV,this.projectionMatrix=new JV,this.projectionMatrixInverse=new JV}copy(V,g){return super.copy(V,g),this.matrixWorldInverse.copy(V.matrixWorldInverse),this.projectionMatrix.copy(V.projectionMatrix),this.projectionMatrixInverse.copy(V.projectionMatrixInverse),this}getWorldDirection(V){this.updateWorldMatrix(!0,!1);const g=this.matrixWorld.elements;return V.set(-g[8],-g[9],-g[10]).normalize()}updateMatrixWorld(V){super.updateMatrixWorld(V),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(V,g){super.updateWorldMatrix(V,g),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}al.prototype.isCamera=!0;class jg extends al{constructor(V=50,g=1,I=.1,e=2e3){super(),this.type="PerspectiveCamera",this.fov=V,this.zoom=1,this.near=I,this.far=e,this.focus=10,this.aspect=g,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(V,g){return super.copy(V,g),this.fov=V.fov,this.zoom=V.zoom,this.near=V.near,this.far=V.far,this.focus=V.focus,this.aspect=V.aspect,this.view=V.view===null?null:Object.assign({},V.view),this.filmGauge=V.filmGauge,this.filmOffset=V.filmOffset,this}setFocalLength(V){const g=.5*this.getFilmHeight()/V;this.fov=ui*2*Math.atan(g),this.updateProjectionMatrix()}getFocalLength(){const V=Math.tan(ii*.5*this.fov);return .5*this.getFilmHeight()/V}getEffectiveFOV(){return ui*2*Math.atan(Math.tan(ii*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(V,g,I,e,t,C){this.aspect=V/g,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=V,this.view.fullHeight=g,this.view.offsetX=I,this.view.offsetY=e,this.view.width=t,this.view.height=C,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const V=this.near;let g=V*Math.tan(ii*.5*this.fov)/this.zoom,I=2*g,e=this.aspect*I,t=-.5*e;const C=this.view;if(this.view!==null&&this.view.enabled){const s=C.fullWidth,a=C.fullHeight;t+=C.offsetX*e/s,g-=C.offsetY*I/a,e*=C.width/s,I*=C.height/a}const A=this.filmOffset;A!==0&&(t+=V*A/this.getFilmWidth()),this.projectionMatrix.makePerspective(t,t+e,g,g-I,V,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(V){const g=super.toJSON(V);return g.object.fov=this.fov,g.object.zoom=this.zoom,g.object.near=this.near,g.object.far=this.far,g.object.focus=this.focus,g.object.aspect=this.aspect,this.view!==null&&(g.object.view=Object.assign({},this.view)),g.object.filmGauge=this.filmGauge,g.object.filmOffset=this.filmOffset,g}}jg.prototype.isPerspectiveCamera=!0;const Et=90,Qt=1;class ol extends UV{constructor(V,g,I){if(super(),this.type="CubeCamera",I.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=I;const e=new jg(Et,Qt,V,g);e.layers=this.layers,e.up.set(0,-1,0),e.lookAt(new S(1,0,0)),this.add(e);const t=new jg(Et,Qt,V,g);t.layers=this.layers,t.up.set(0,-1,0),t.lookAt(new S(-1,0,0)),this.add(t);const C=new jg(Et,Qt,V,g);C.layers=this.layers,C.up.set(0,0,1),C.lookAt(new S(0,1,0)),this.add(C);const A=new jg(Et,Qt,V,g);A.layers=this.layers,A.up.set(0,0,-1),A.lookAt(new S(0,-1,0)),this.add(A);const s=new jg(Et,Qt,V,g);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new S(0,0,1)),this.add(s);const a=new jg(Et,Qt,V,g);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new S(0,0,-1)),this.add(a)}update(V,g){this.parent===null&&this.updateMatrixWorld();const I=this.renderTarget,[e,t,C,A,s,a]=this.children,o=V.xr.enabled,n=V.getRenderTarget();V.xr.enabled=!1;const l=I.texture.generateMipmaps;I.texture.generateMipmaps=!1,V.setRenderTarget(I,0),V.render(g,e),V.setRenderTarget(I,1),V.render(g,t),V.setRenderTarget(I,2),V.render(g,C),V.setRenderTarget(I,3),V.render(g,A),V.setRenderTarget(I,4),V.render(g,s),I.texture.generateMipmaps=l,V.setRenderTarget(I,5),V.render(g,a),V.setRenderTarget(n),V.xr.enabled=o}}class Ni extends Mg{constructor(V,g,I,e,t,C,A,s,a,o){V=V!==void 0?V:[],g=g!==void 0?g:Cl,A=A!==void 0?A:je,super(V,g,I,e,t,C,A,s,a,o),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(V){this.image=V}}Ni.prototype.isCubeTexture=!0;class Vd extends Ie{constructor(V,g,I){Number.isInteger(g)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),g=I),super(V,V,g),g=g||{},this.texture=new Ni(void 0,g.mapping,g.wrapS,g.wrapT,g.magFilter,g.minFilter,g.format,g.type,g.anisotropy,g.encoding),this.texture.generateMipmaps=g.generateMipmaps!==void 0?g.generateMipmaps:!1,this.texture.minFilter=g.minFilter!==void 0?g.minFilter:Sg,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(V,g){this.texture.type=g.type,this.texture.format=NI,this.texture.encoding=g.encoding,this.texture.generateMipmaps=g.generateMipmaps,this.texture.minFilter=g.minFilter,this.texture.magFilter=g.magFilter;const I={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},e=new ft(5,5,5),t=new Xe({name:"CubemapFromEquirect",uniforms:mC(I.uniforms),vertexShader:I.vertexShader,fragmentShader:I.fragmentShader,side:wg,blending:ei});t.uniforms.tEquirect.value=g;const C=new og(e,t),A=g.minFilter;return g.minFilter===XC&&(g.minFilter=Sg),new ol(1,10,this).update(V,C),g.minFilter=A,C.geometry.dispose(),C.material.dispose(),this}clear(V,g,I,e){const t=V.getRenderTarget();for(let C=0;C<6;C++)V.setRenderTarget(this,C),V.clear(g,I,e);V.setRenderTarget(t)}}Vd.prototype.isWebGLCubeRenderTarget=!0;const Jn=new S,dZ=new S,rZ=new Dg;class qe{constructor(V=new S(1,0,0),g=0){this.normal=V,this.constant=g}set(V,g){return this.normal.copy(V),this.constant=g,this}setComponents(V,g,I,e){return this.normal.set(V,g,I),this.constant=e,this}setFromNormalAndCoplanarPoint(V,g){return this.normal.copy(V),this.constant=-g.dot(this.normal),this}setFromCoplanarPoints(V,g,I){const e=Jn.subVectors(I,g).cross(dZ.subVectors(V,g)).normalize();return this.setFromNormalAndCoplanarPoint(e,V),this}copy(V){return this.normal.copy(V.normal),this.constant=V.constant,this}normalize(){const V=1/this.normal.length();return this.normal.multiplyScalar(V),this.constant*=V,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(V){return this.normal.dot(V)+this.constant}distanceToSphere(V){return this.distanceToPoint(V.center)-V.radius}projectPoint(V,g){return g.copy(this.normal).multiplyScalar(-this.distanceToPoint(V)).add(V)}intersectLine(V,g){const I=V.delta(Jn),e=this.normal.dot(I);if(e===0)return this.distanceToPoint(V.start)===0?g.copy(V.start):null;const t=-(V.start.dot(this.normal)+this.constant)/e;return t<0||t>1?null:g.copy(I).multiplyScalar(t).add(V.start)}intersectsLine(V){const g=this.distanceToPoint(V.start),I=this.distanceToPoint(V.end);return g<0&&I>0||I<0&&g>0}intersectsBox(V){return V.intersectsPlane(this)}intersectsSphere(V){return V.intersectsPlane(this)}coplanarPoint(V){return V.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(V,g){const I=g||rZ.getNormalMatrix(V),e=this.coplanarPoint(Jn).applyMatrix4(V),t=this.normal.applyMatrix3(I).normalize();return this.constant=-e.dot(t),this}translate(V){return this.constant-=V.dot(this.normal),this}equals(V){return V.normal.equals(this.normal)&&V.constant===this.constant}clone(){return new this.constructor().copy(this)}}qe.prototype.isPlane=!0;const jt=new XI,CA=new S;class Ki{constructor(V=new qe,g=new qe,I=new qe,e=new qe,t=new qe,C=new qe){this.planes=[V,g,I,e,t,C]}set(V,g,I,e,t,C){const A=this.planes;return A[0].copy(V),A[1].copy(g),A[2].copy(I),A[3].copy(e),A[4].copy(t),A[5].copy(C),this}copy(V){const g=this.planes;for(let I=0;I<6;I++)g[I].copy(V.planes[I]);return this}setFromProjectionMatrix(V){const g=this.planes,I=V.elements,e=I[0],t=I[1],C=I[2],A=I[3],s=I[4],a=I[5],o=I[6],n=I[7],l=I[8],c=I[9],d=I[10],h=I[11],m=I[12],r=I[13],u=I[14],b=I[15];return g[0].setComponents(A-e,n-s,h-l,b-m).normalize(),g[1].setComponents(A+e,n+s,h+l,b+m).normalize(),g[2].setComponents(A+t,n+a,h+c,b+r).normalize(),g[3].setComponents(A-t,n-a,h-c,b-r).normalize(),g[4].setComponents(A-C,n-o,h-d,b-u).normalize(),g[5].setComponents(A+C,n+o,h+d,b+u).normalize(),this}intersectsObject(V){const g=V.geometry;return g.boundingSphere===null&&g.computeBoundingSphere(),jt.copy(g.boundingSphere).applyMatrix4(V.matrixWorld),this.intersectsSphere(jt)}intersectsSprite(V){return jt.center.set(0,0,0),jt.radius=.7071067811865476,jt.applyMatrix4(V.matrixWorld),this.intersectsSphere(jt)}intersectsSphere(V){const g=this.planes,I=V.center,e=-V.radius;for(let t=0;t<6;t++)if(g[t].distanceToPoint(I)<e)return!1;return!0}intersectsBox(V){const g=this.planes;for(let I=0;I<6;I++){const e=g[I];if(CA.x=e.normal.x>0?V.max.x:V.min.x,CA.y=e.normal.y>0?V.max.y:V.min.y,CA.z=e.normal.z>0?V.max.z:V.min.z,e.distanceToPoint(CA)<0)return!1}return!0}containsPoint(V){const g=this.planes;for(let I=0;I<6;I++)if(g[I].distanceToPoint(V)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function gd(){let i=null,V=!1,g=null,I=null;function e(t,C){g(t,C),I=i.requestAnimationFrame(e)}return{start:function(){V!==!0&&g!==null&&(I=i.requestAnimationFrame(e),V=!0)},stop:function(){i.cancelAnimationFrame(I),V=!1},setAnimationLoop:function(t){g=t},setContext:function(t){i=t}}}function hZ(i,V){const g=V.isWebGL2,I=new WeakMap;function e(a,o){const n=a.array,l=a.usage,c=i.createBuffer();i.bindBuffer(o,c),i.bufferData(o,n,l),a.onUploadCallback();let d=5126;return n instanceof Float32Array?d=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?a.isFloat16BufferAttribute?g?d=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):d=5123:n instanceof Int16Array?d=5122:n instanceof Uint32Array?d=5125:n instanceof Int32Array?d=5124:n instanceof Int8Array?d=5120:(n instanceof Uint8Array||n instanceof Uint8ClampedArray)&&(d=5121),{buffer:c,type:d,bytesPerElement:n.BYTES_PER_ELEMENT,version:a.version}}function t(a,o,n){const l=o.array,c=o.updateRange;i.bindBuffer(n,a),c.count===-1?i.bufferSubData(n,0,l):(g?i.bufferSubData(n,c.offset*l.BYTES_PER_ELEMENT,l,c.offset,c.count):i.bufferSubData(n,c.offset*l.BYTES_PER_ELEMENT,l.subarray(c.offset,c.offset+c.count)),c.count=-1)}function C(a){return a.isInterleavedBufferAttribute&&(a=a.data),I.get(a)}function A(a){a.isInterleavedBufferAttribute&&(a=a.data);const o=I.get(a);o&&(i.deleteBuffer(o.buffer),I.delete(a))}function s(a,o){if(a.isGLBufferAttribute){const l=I.get(a);(!l||l.version<a.version)&&I.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}a.isInterleavedBufferAttribute&&(a=a.data);const n=I.get(a);n===void 0?I.set(a,e(a,o)):n.version<a.version&&(t(n.buffer,a,o),n.version=a.version)}return{get:C,remove:A,update:s}}class Ft extends $V{constructor(V=1,g=1,I=1,e=1){super(),this.type="PlaneGeometry",this.parameters={width:V,height:g,widthSegments:I,heightSegments:e};const t=V/2,C=g/2,A=Math.floor(I),s=Math.floor(e),a=A+1,o=s+1,n=V/A,l=g/s,c=[],d=[],h=[],m=[];for(let r=0;r<o;r++){const u=r*l-C;for(let b=0;b<a;b++){const Z=b*n-t;d.push(Z,-u,0),h.push(0,0,1),m.push(b/A),m.push(1-r/s)}}for(let r=0;r<s;r++)for(let u=0;u<A;u++){const b=u+a*r,Z=u+a*(r+1),p=u+1+a*(r+1),G=u+1+a*r;c.push(b,Z,G),c.push(Z,p,G)}this.setIndex(c),this.setAttribute("position",new hg(d,3)),this.setAttribute("normal",new hg(h,3)),this.setAttribute("uv",new hg(m,2))}static fromJSON(V){return new Ft(V.width,V.height,V.widthSegments,V.heightSegments)}}var mZ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,uZ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,bZ=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,ZZ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,GZ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,pZ="vec3 transformed = vec3( position );",qZ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,BZ=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotVH ) {
	float fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,WZ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,yZ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,XZ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,RZ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,YZ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,wZ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,HZ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,fZ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,SZ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,FZ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,vZ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,NZ=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,KZ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,JZ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,MZ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,xZ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,kZ="gl_FragColor = linearToOutputTexel( gl_FragColor );",zZ=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,TZ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,LZ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,UZ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,DZ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,EZ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,QZ=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,jZ=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,PZ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,OZ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,_Z=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,$Z=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,VG=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,gG=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,IG=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,eG=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,tG=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,CG=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,iG=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,AG=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,nG=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,sG=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lG=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,aG=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,oG=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,cG=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,dG=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,rG=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,hG=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,mG=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,uG=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,bG=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,ZG=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,GG=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,pG=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,qG=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,BG=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,WG=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,yG=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,XG=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,RG=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,YG=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,wG=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,HG=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,fG=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,SG=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,FG=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,vG=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,NG=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,KG=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,JG=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,MG=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,xG=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,kG=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,zG=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,TG=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,LG=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,UG=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,DG=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,EG=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,QG=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,jG=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,PG=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,OG=`#ifdef USE_TRANSMISSION
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSNMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition.xyz / vWorldPosition.w;
	vec3 v = normalize( cameraPosition - pos );
	float ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );
	vec3 transmission = transmissionFactor * getIBLVolumeRefraction(
		normal, v, roughnessFactor, material.diffuseColor, totalSpecular,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );
#endif`,_G=`#ifdef USE_TRANSMISSION
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec4 vWorldPosition;
	vec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {
		vec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);
		vec3 modelScale;
		modelScale.x = length(vec3(modelMatrix[0].xyz));
		modelScale.y = length(vec3(modelMatrix[1].xyz));
		modelScale.z = length(vec3(modelMatrix[2].xyz));
		return normalize(refractionVector) * thickness * modelScale;
	}
	float applyIorToRoughness(float roughness, float ior) {
		return roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);
	}
	vec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {
		float framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);
		return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;
	}
	vec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {
		if (attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;
			vec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);			return transmittance * radiance;
		}
	}
	vec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance) {
		vec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);
		vec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);
		return (1.0 - specularColor) * attenuatedColor * baseColor;
	}
#endif`,$G=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,V0=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,g0=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,I0=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,e0=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,t0=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,C0=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,i0=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,A0=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,n0=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,s0=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,l0=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,a0=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,o0=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,c0=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,d0=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,r0=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,h0=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,m0=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,u0=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,b0=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Z0=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,G0=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,p0=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,q0=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,B0=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,W0=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,y0=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,X0=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,R0=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform vec3 attenuationColor;
	uniform float attenuationDistance;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <transmission_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Y0=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#ifdef USE_TRANSMISSION
	varying vec4 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition;
#endif
}`,w0=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,H0=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,f0=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,S0=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,F0=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,v0=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,N0=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,K0=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const QV={alphamap_fragment:mZ,alphamap_pars_fragment:uZ,alphatest_fragment:bZ,aomap_fragment:ZZ,aomap_pars_fragment:GZ,begin_vertex:pZ,beginnormal_vertex:qZ,bsdfs:BZ,bumpmap_pars_fragment:WZ,clipping_planes_fragment:yZ,clipping_planes_pars_fragment:XZ,clipping_planes_pars_vertex:RZ,clipping_planes_vertex:YZ,color_fragment:wZ,color_pars_fragment:HZ,color_pars_vertex:fZ,color_vertex:SZ,common:FZ,cube_uv_reflection_fragment:vZ,defaultnormal_vertex:NZ,displacementmap_pars_vertex:KZ,displacementmap_vertex:JZ,emissivemap_fragment:MZ,emissivemap_pars_fragment:xZ,encodings_fragment:kZ,encodings_pars_fragment:zZ,envmap_fragment:TZ,envmap_common_pars_fragment:LZ,envmap_pars_fragment:UZ,envmap_pars_vertex:DZ,envmap_physical_pars_fragment:eG,envmap_vertex:EZ,fog_vertex:QZ,fog_pars_vertex:jZ,fog_fragment:PZ,fog_pars_fragment:OZ,gradientmap_pars_fragment:_Z,lightmap_fragment:$Z,lightmap_pars_fragment:VG,lights_lambert_vertex:gG,lights_pars_begin:IG,lights_toon_fragment:tG,lights_toon_pars_fragment:CG,lights_phong_fragment:iG,lights_phong_pars_fragment:AG,lights_physical_fragment:nG,lights_physical_pars_fragment:sG,lights_fragment_begin:lG,lights_fragment_maps:aG,lights_fragment_end:oG,logdepthbuf_fragment:cG,logdepthbuf_pars_fragment:dG,logdepthbuf_pars_vertex:rG,logdepthbuf_vertex:hG,map_fragment:mG,map_pars_fragment:uG,map_particle_fragment:bG,map_particle_pars_fragment:ZG,metalnessmap_fragment:GG,metalnessmap_pars_fragment:pG,morphnormal_vertex:qG,morphtarget_pars_vertex:BG,morphtarget_vertex:WG,normal_fragment_begin:yG,normal_fragment_maps:XG,normalmap_pars_fragment:RG,clearcoat_normal_fragment_begin:YG,clearcoat_normal_fragment_maps:wG,clearcoat_pars_fragment:HG,packing:fG,premultiplied_alpha_fragment:SG,project_vertex:FG,dithering_fragment:vG,dithering_pars_fragment:NG,roughnessmap_fragment:KG,roughnessmap_pars_fragment:JG,shadowmap_pars_fragment:MG,shadowmap_pars_vertex:xG,shadowmap_vertex:kG,shadowmask_pars_fragment:zG,skinbase_vertex:TG,skinning_pars_vertex:LG,skinning_vertex:UG,skinnormal_vertex:DG,specularmap_fragment:EG,specularmap_pars_fragment:QG,tonemapping_fragment:jG,tonemapping_pars_fragment:PG,transmission_fragment:OG,transmission_pars_fragment:_G,uv_pars_fragment:$G,uv_pars_vertex:V0,uv_vertex:g0,uv2_pars_fragment:I0,uv2_pars_vertex:e0,uv2_vertex:t0,worldpos_vertex:C0,background_frag:i0,background_vert:A0,cube_frag:n0,cube_vert:s0,depth_frag:l0,depth_vert:a0,distanceRGBA_frag:o0,distanceRGBA_vert:c0,equirect_frag:d0,equirect_vert:r0,linedashed_frag:h0,linedashed_vert:m0,meshbasic_frag:u0,meshbasic_vert:b0,meshlambert_frag:Z0,meshlambert_vert:G0,meshmatcap_frag:p0,meshmatcap_vert:q0,meshtoon_frag:B0,meshtoon_vert:W0,meshphong_frag:y0,meshphong_vert:X0,meshphysical_frag:R0,meshphysical_vert:Y0,normal_frag:w0,normal_vert:H0,points_frag:f0,points_vert:S0,shadow_frag:F0,shadow_vert:v0,sprite_frag:N0,sprite_vert:K0},FV={common:{diffuse:{value:new NV(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Dg},uv2Transform:{value:new Dg},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new dV(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new NV(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new NV(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Dg}},sprite:{diffuse:{value:new NV(16777215)},opacity:{value:1},center:{value:new dV(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Dg}}},tI={basic:{uniforms:Qg([FV.common,FV.specularmap,FV.envmap,FV.aomap,FV.lightmap,FV.fog]),vertexShader:QV.meshbasic_vert,fragmentShader:QV.meshbasic_frag},lambert:{uniforms:Qg([FV.common,FV.specularmap,FV.envmap,FV.aomap,FV.lightmap,FV.emissivemap,FV.fog,FV.lights,{emissive:{value:new NV(0)}}]),vertexShader:QV.meshlambert_vert,fragmentShader:QV.meshlambert_frag},phong:{uniforms:Qg([FV.common,FV.specularmap,FV.envmap,FV.aomap,FV.lightmap,FV.emissivemap,FV.bumpmap,FV.normalmap,FV.displacementmap,FV.fog,FV.lights,{emissive:{value:new NV(0)},specular:{value:new NV(1118481)},shininess:{value:30}}]),vertexShader:QV.meshphong_vert,fragmentShader:QV.meshphong_frag},standard:{uniforms:Qg([FV.common,FV.envmap,FV.aomap,FV.lightmap,FV.emissivemap,FV.bumpmap,FV.normalmap,FV.displacementmap,FV.roughnessmap,FV.metalnessmap,FV.fog,FV.lights,{emissive:{value:new NV(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:QV.meshphysical_vert,fragmentShader:QV.meshphysical_frag},toon:{uniforms:Qg([FV.common,FV.aomap,FV.lightmap,FV.emissivemap,FV.bumpmap,FV.normalmap,FV.displacementmap,FV.gradientmap,FV.fog,FV.lights,{emissive:{value:new NV(0)}}]),vertexShader:QV.meshtoon_vert,fragmentShader:QV.meshtoon_frag},matcap:{uniforms:Qg([FV.common,FV.bumpmap,FV.normalmap,FV.displacementmap,FV.fog,{matcap:{value:null}}]),vertexShader:QV.meshmatcap_vert,fragmentShader:QV.meshmatcap_frag},points:{uniforms:Qg([FV.points,FV.fog]),vertexShader:QV.points_vert,fragmentShader:QV.points_frag},dashed:{uniforms:Qg([FV.common,FV.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:QV.linedashed_vert,fragmentShader:QV.linedashed_frag},depth:{uniforms:Qg([FV.common,FV.displacementmap]),vertexShader:QV.depth_vert,fragmentShader:QV.depth_frag},normal:{uniforms:Qg([FV.common,FV.bumpmap,FV.normalmap,FV.displacementmap,{opacity:{value:1}}]),vertexShader:QV.normal_vert,fragmentShader:QV.normal_frag},sprite:{uniforms:Qg([FV.sprite,FV.fog]),vertexShader:QV.sprite_vert,fragmentShader:QV.sprite_frag},background:{uniforms:{uvTransform:{value:new Dg},t2D:{value:null}},vertexShader:QV.background_vert,fragmentShader:QV.background_frag},cube:{uniforms:Qg([FV.envmap,{opacity:{value:1}}]),vertexShader:QV.cube_vert,fragmentShader:QV.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:QV.equirect_vert,fragmentShader:QV.equirect_frag},distanceRGBA:{uniforms:Qg([FV.common,FV.displacementmap,{referencePosition:{value:new S},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:QV.distanceRGBA_vert,fragmentShader:QV.distanceRGBA_frag},shadow:{uniforms:Qg([FV.lights,FV.fog,{color:{value:new NV(0)},opacity:{value:1}}]),vertexShader:QV.shadow_vert,fragmentShader:QV.shadow_frag}};tI.physical={uniforms:Qg([tI.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new dV(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new NV(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new dV},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new NV(0)}}]),vertexShader:QV.meshphysical_vert,fragmentShader:QV.meshphysical_frag};function J0(i,V,g,I,e){const t=new NV(0);let C=0,A,s,a=null,o=0,n=null;function l(d,h){let m=!1,r=h.isScene===!0?h.background:null;r&&r.isTexture&&(r=V.get(r));const u=i.xr,b=u.getSession&&u.getSession();b&&b.environmentBlendMode==="additive"&&(r=null),r===null?c(t,C):r&&r.isColor&&(c(r,1),m=!0),(i.autoClear||m)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),r&&(r.isCubeTexture||r.mapping===Al)?(s===void 0&&(s=new og(new ft(1,1,1),new Xe({name:"BackgroundCubeMaterial",uniforms:mC(tI.cube.uniforms),vertexShader:tI.cube.vertexShader,fragmentShader:tI.cube.fragmentShader,side:wg,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(Z,p,G){this.matrixWorld.copyPosition(G.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),I.update(s)),s.material.uniforms.envMap.value=r,s.material.uniforms.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,(a!==r||o!==r.version||n!==i.toneMapping)&&(s.material.needsUpdate=!0,a=r,o=r.version,n=i.toneMapping),d.unshift(s,s.geometry,s.material,0,0,null)):r&&r.isTexture&&(A===void 0&&(A=new og(new Ft(2,2),new Xe({name:"BackgroundMaterial",uniforms:mC(tI.background.uniforms),vertexShader:tI.background.vertexShader,fragmentShader:tI.background.fragmentShader,side:rC,depthTest:!1,depthWrite:!1,fog:!1})),A.geometry.deleteAttribute("normal"),Object.defineProperty(A.material,"map",{get:function(){return this.uniforms.t2D.value}}),I.update(A)),A.material.uniforms.t2D.value=r,r.matrixAutoUpdate===!0&&r.updateMatrix(),A.material.uniforms.uvTransform.value.copy(r.matrix),(a!==r||o!==r.version||n!==i.toneMapping)&&(A.material.needsUpdate=!0,a=r,o=r.version,n=i.toneMapping),d.unshift(A,A.geometry,A.material,0,0,null))}function c(d,h){g.buffers.color.setClear(d.r,d.g,d.b,h,e)}return{getClearColor:function(){return t},setClearColor:function(d,h=1){t.set(d),C=h,c(t,C)},getClearAlpha:function(){return C},setClearAlpha:function(d){C=d,c(t,C)},render:l}}function M0(i,V,g,I){const e=i.getParameter(34921),t=I.isWebGL2?null:V.get("OES_vertex_array_object"),C=I.isWebGL2||t!==null,A={},s=h(null);let a=s;function o(R,J,H,N,v){let T=!1;if(C){const D=d(N,H,J);a!==D&&(a=D,l(a.object)),T=m(N,v),T&&r(N,v)}else{const D=J.wireframe===!0;(a.geometry!==N.id||a.program!==H.id||a.wireframe!==D)&&(a.geometry=N.id,a.program=H.id,a.wireframe=D,T=!0)}R.isInstancedMesh===!0&&(T=!0),v!==null&&g.update(v,34963),T&&(X(R,J,H,N),v!==null&&i.bindBuffer(34963,g.get(v).buffer))}function n(){return I.isWebGL2?i.createVertexArray():t.createVertexArrayOES()}function l(R){return I.isWebGL2?i.bindVertexArray(R):t.bindVertexArrayOES(R)}function c(R){return I.isWebGL2?i.deleteVertexArray(R):t.deleteVertexArrayOES(R)}function d(R,J,H){const N=H.wireframe===!0;let v=A[R.id];v===void 0&&(v={},A[R.id]=v);let T=v[J.id];T===void 0&&(T={},v[J.id]=T);let D=T[N];return D===void 0&&(D=h(n()),T[N]=D),D}function h(R){const J=[],H=[],N=[];for(let v=0;v<e;v++)J[v]=0,H[v]=0,N[v]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:J,enabledAttributes:H,attributeDivisors:N,object:R,attributes:{},index:null}}function m(R,J){const H=a.attributes,N=R.attributes;let v=0;for(const T in N){const D=H[T],$=N[T];if(D===void 0||D.attribute!==$||D.data!==$.data)return!0;v++}return a.attributesNum!==v||a.index!==J}function r(R,J){const H={},N=R.attributes;let v=0;for(const T in N){const D=N[T],$={};$.attribute=D,D.data&&($.data=D.data),H[T]=$,v++}a.attributes=H,a.attributesNum=v,a.index=J}function u(){const R=a.newAttributes;for(let J=0,H=R.length;J<H;J++)R[J]=0}function b(R){Z(R,0)}function Z(R,J){const H=a.newAttributes,N=a.enabledAttributes,v=a.attributeDivisors;H[R]=1,N[R]===0&&(i.enableVertexAttribArray(R),N[R]=1),v[R]!==J&&((I.isWebGL2?i:V.get("ANGLE_instanced_arrays"))[I.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,J),v[R]=J)}function p(){const R=a.newAttributes,J=a.enabledAttributes;for(let H=0,N=J.length;H<N;H++)J[H]!==R[H]&&(i.disableVertexAttribArray(H),J[H]=0)}function G(R,J,H,N,v,T){I.isWebGL2===!0&&(H===5124||H===5125)?i.vertexAttribIPointer(R,J,H,v,T):i.vertexAttribPointer(R,J,H,N,v,T)}function X(R,J,H,N){if(I.isWebGL2===!1&&(R.isInstancedMesh||N.isInstancedBufferGeometry)&&V.get("ANGLE_instanced_arrays")===null)return;u();const v=N.attributes,T=H.getAttributes(),D=J.defaultAttributeValues;for(const $ in T){const M=T[$];if(M>=0){const _=v[$];if(_!==void 0){const x=_.normalized,z=_.itemSize,F=g.get(_);if(F===void 0)continue;const k=F.buffer,rV=F.type,nV=F.bytesPerElement;if(_.isInterleavedBufferAttribute){const j=_.data,VV=j.stride,lV=_.offset;j&&j.isInstancedInterleavedBuffer?(Z(M,j.meshPerAttribute),N._maxInstanceCount===void 0&&(N._maxInstanceCount=j.meshPerAttribute*j.count)):b(M),i.bindBuffer(34962,k),G(M,z,rV,x,VV*nV,lV*nV)}else _.isInstancedBufferAttribute?(Z(M,_.meshPerAttribute),N._maxInstanceCount===void 0&&(N._maxInstanceCount=_.meshPerAttribute*_.count)):b(M),i.bindBuffer(34962,k),G(M,z,rV,x,0,0)}else if($==="instanceMatrix"){const x=g.get(R.instanceMatrix);if(x===void 0)continue;const z=x.buffer,F=x.type;Z(M+0,1),Z(M+1,1),Z(M+2,1),Z(M+3,1),i.bindBuffer(34962,z),i.vertexAttribPointer(M+0,4,F,!1,64,0),i.vertexAttribPointer(M+1,4,F,!1,64,16),i.vertexAttribPointer(M+2,4,F,!1,64,32),i.vertexAttribPointer(M+3,4,F,!1,64,48)}else if($==="instanceColor"){const x=g.get(R.instanceColor);if(x===void 0)continue;const z=x.buffer,F=x.type;Z(M,1),i.bindBuffer(34962,z),i.vertexAttribPointer(M,3,F,!1,12,0)}else if(D!==void 0){const x=D[$];if(x!==void 0)switch(x.length){case 2:i.vertexAttrib2fv(M,x);break;case 3:i.vertexAttrib3fv(M,x);break;case 4:i.vertexAttrib4fv(M,x);break;default:i.vertexAttrib1fv(M,x)}}}}p()}function W(){f();for(const R in A){const J=A[R];for(const H in J){const N=J[H];for(const v in N)c(N[v].object),delete N[v];delete J[H]}delete A[R]}}function y(R){if(A[R.id]===void 0)return;const J=A[R.id];for(const H in J){const N=J[H];for(const v in N)c(N[v].object),delete N[v];delete J[H]}delete A[R.id]}function Y(R){for(const J in A){const H=A[J];if(H[R.id]===void 0)continue;const N=H[R.id];for(const v in N)c(N[v].object),delete N[v];delete H[R.id]}}function f(){L(),a!==s&&(a=s,l(a.object))}function L(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:o,reset:f,resetDefaultState:L,dispose:W,releaseStatesOfGeometry:y,releaseStatesOfProgram:Y,initAttributes:u,enableAttribute:b,disableUnusedAttributes:p}}function x0(i,V,g,I){const e=I.isWebGL2;let t;function C(a){t=a}function A(a,o){i.drawArrays(t,a,o),g.update(o,t,1)}function s(a,o,n){if(n===0)return;let l,c;if(e)l=i,c="drawArraysInstanced";else if(l=V.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",l===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}l[c](t,a,o,n),g.update(o,t,n)}this.setMode=C,this.render=A,this.renderInstances=s}function k0(i,V,g){let I;function e(){if(I!==void 0)return I;if(V.has("EXT_texture_filter_anisotropic")===!0){const X=V.get("EXT_texture_filter_anisotropic");I=i.getParameter(X.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else I=0;return I}function t(X){if(X==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";X="mediump"}return X==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const C=typeof WebGL2RenderingContext!="undefined"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&i instanceof WebGL2ComputeRenderingContext;let A=g.precision!==void 0?g.precision:"highp";const s=t(A);s!==A&&(console.warn("THREE.WebGLRenderer:",A,"not supported, using",s,"instead."),A=s);const a=C||V.has("WEBGL_draw_buffers"),o=g.logarithmicDepthBuffer===!0,n=i.getParameter(34930),l=i.getParameter(35660),c=i.getParameter(3379),d=i.getParameter(34076),h=i.getParameter(34921),m=i.getParameter(36347),r=i.getParameter(36348),u=i.getParameter(36349),b=l>0,Z=C||V.has("OES_texture_float"),p=b&&Z,G=C?i.getParameter(36183):0;return{isWebGL2:C,drawBuffers:a,getMaxAnisotropy:e,getMaxPrecision:t,precision:A,logarithmicDepthBuffer:o,maxTextures:n,maxVertexTextures:l,maxTextureSize:c,maxCubemapSize:d,maxAttributes:h,maxVertexUniforms:m,maxVaryings:r,maxFragmentUniforms:u,vertexTextures:b,floatFragmentTextures:Z,floatVertexTextures:p,maxSamples:G}}function z0(i){const V=this;let g=null,I=0,e=!1,t=!1;const C=new qe,A=new Dg,s={value:null,needsUpdate:!1};this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(n,l,c){const d=n.length!==0||l||I!==0||e;return e=l,g=o(n,c,0),I=n.length,d},this.beginShadows=function(){t=!0,o(null)},this.endShadows=function(){t=!1,a()},this.setState=function(n,l,c){const d=n.clippingPlanes,h=n.clipIntersection,m=n.clipShadows,r=i.get(n);if(!e||d===null||d.length===0||t&&!m)t?o(null):a();else{const u=t?0:I,b=u*4;let Z=r.clippingState||null;s.value=Z,Z=o(d,l,b,c);for(let p=0;p!==b;++p)Z[p]=g[p];r.clippingState=Z,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=u}};function a(){s.value!==g&&(s.value=g,s.needsUpdate=I>0),V.numPlanes=I,V.numIntersection=0}function o(n,l,c,d){const h=n!==null?n.length:0;let m=null;if(h!==0){if(m=s.value,d!==!0||m===null){const r=c+h*4,u=l.matrixWorldInverse;A.getNormalMatrix(u),(m===null||m.length<r)&&(m=new Float32Array(r));for(let b=0,Z=c;b!==h;++b,Z+=4)C.copy(n[b]).applyMatrix4(u,A),C.normal.toArray(m,Z),m[Z+3]=C.constant}s.value=m,s.needsUpdate=!0}return V.numPlanes=h,V.numIntersection=0,m}}function T0(i){let V=new WeakMap;function g(C,A){return A===Xa?C.mapping=Cl:A===Ra&&(C.mapping=il),C}function I(C){if(C&&C.isTexture){const A=C.mapping;if(A===Xa||A===Ra)if(V.has(C)){const s=V.get(C).texture;return g(s,C.mapping)}else{const s=C.image;if(s&&s.height>0){const a=i.getRenderTarget(),o=new Vd(s.height/2);return o.fromEquirectangularTexture(i,C),V.set(C,o),i.setRenderTarget(a),C.addEventListener("dispose",e),g(o.texture,C.mapping)}else return null}}return C}function e(C){const A=C.target;A.removeEventListener("dispose",e);const s=V.get(A);s!==void 0&&(V.delete(A),s.dispose())}function t(){V=new WeakMap}return{get:I,dispose:t}}function L0(i){const V={};function g(I){if(V[I]!==void 0)return V[I];let e;switch(I){case"WEBGL_depth_texture":e=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":e=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=i.getExtension(I)}return V[I]=e,e}return{has:function(I){return g(I)!==null},init:function(I){I.isWebGL2?g("EXT_color_buffer_float"):(g("WEBGL_depth_texture"),g("OES_texture_float"),g("OES_texture_half_float"),g("OES_texture_half_float_linear"),g("OES_standard_derivatives"),g("OES_element_index_uint"),g("OES_vertex_array_object"),g("ANGLE_instanced_arrays")),g("OES_texture_float_linear"),g("EXT_color_buffer_half_float")},get:function(I){const e=g(I);return e===null&&console.warn("THREE.WebGLRenderer: "+I+" extension not supported."),e}}}function U0(i,V,g,I){const e={},t=new WeakMap;function C(n){const l=n.target;l.index!==null&&V.remove(l.index);for(const d in l.attributes)V.remove(l.attributes[d]);l.removeEventListener("dispose",C),delete e[l.id];const c=t.get(l);c&&(V.remove(c),t.delete(l)),I.releaseStatesOfGeometry(l),l.isInstancedBufferGeometry===!0&&delete l._maxInstanceCount,g.memory.geometries--}function A(n,l){return e[l.id]===!0||(l.addEventListener("dispose",C),e[l.id]=!0,g.memory.geometries++),l}function s(n){const l=n.attributes;for(const d in l)V.update(l[d],34962);const c=n.morphAttributes;for(const d in c){const h=c[d];for(let m=0,r=h.length;m<r;m++)V.update(h[m],34962)}}function a(n){const l=[],c=n.index,d=n.attributes.position;let h=0;if(c!==null){const u=c.array;h=c.version;for(let b=0,Z=u.length;b<Z;b+=3){const p=u[b+0],G=u[b+1],X=u[b+2];l.push(p,G,G,X,X,p)}}else{const u=d.array;h=d.version;for(let b=0,Z=u.length/3-1;b<Z;b+=3){const p=b+0,G=b+1,X=b+2;l.push(p,G,G,X,X,p)}}const m=new($c(l)>65535?_c:Oc)(l,1);m.version=h;const r=t.get(n);r&&V.remove(r),t.set(n,m)}function o(n){const l=t.get(n);if(l){const c=n.index;c!==null&&l.version<c.version&&a(n)}else a(n);return t.get(n)}return{get:A,update:s,getWireframeAttribute:o}}function D0(i,V,g,I){const e=I.isWebGL2;let t;function C(l){t=l}let A,s;function a(l){A=l.type,s=l.bytesPerElement}function o(l,c){i.drawElements(t,c,A,l*s),g.update(c,t,1)}function n(l,c,d){if(d===0)return;let h,m;if(e)h=i,m="drawElementsInstanced";else if(h=V.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",h===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[m](t,c,A,l*s,d),g.update(c,t,d)}this.setMode=C,this.setIndex=a,this.render=o,this.renderInstances=n}function E0(i){const V={geometries:0,textures:0},g={frame:0,calls:0,triangles:0,points:0,lines:0};function I(t,C,A){switch(g.calls++,C){case 4:g.triangles+=A*(t/3);break;case 1:g.lines+=A*(t/2);break;case 3:g.lines+=A*(t-1);break;case 2:g.lines+=A*t;break;case 0:g.points+=A*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",C);break}}function e(){g.frame++,g.calls=0,g.triangles=0,g.points=0,g.lines=0}return{memory:V,render:g,programs:null,autoReset:!0,reset:e,update:I}}function Q0(i,V){return i[0]-V[0]}function j0(i,V){return Math.abs(V[1])-Math.abs(i[1])}function P0(i){const V={},g=new Float32Array(8),I=[];for(let t=0;t<8;t++)I[t]=[t,0];function e(t,C,A,s){const a=t.morphTargetInfluences,o=a===void 0?0:a.length;let n=V[C.id];if(n===void 0||n.length!==o){n=[];for(let m=0;m<o;m++)n[m]=[m,0];V[C.id]=n}for(let m=0;m<o;m++){const r=n[m];r[0]=m,r[1]=a[m]}n.sort(j0);for(let m=0;m<8;m++)m<o&&n[m][1]?(I[m][0]=n[m][0],I[m][1]=n[m][1]):(I[m][0]=Number.MAX_SAFE_INTEGER,I[m][1]=0);I.sort(Q0);const l=A.morphTargets&&C.morphAttributes.position,c=A.morphNormals&&C.morphAttributes.normal;let d=0;for(let m=0;m<8;m++){const r=I[m],u=r[0],b=r[1];u!==Number.MAX_SAFE_INTEGER&&b?(l&&C.getAttribute("morphTarget"+m)!==l[u]&&C.setAttribute("morphTarget"+m,l[u]),c&&C.getAttribute("morphNormal"+m)!==c[u]&&C.setAttribute("morphNormal"+m,c[u]),g[m]=b,d+=b):(l&&C.hasAttribute("morphTarget"+m)===!0&&C.deleteAttribute("morphTarget"+m),c&&C.hasAttribute("morphNormal"+m)===!0&&C.deleteAttribute("morphNormal"+m),g[m]=0)}const h=C.morphTargetsRelative?1:1-d;s.getUniforms().setValue(i,"morphTargetBaseInfluence",h),s.getUniforms().setValue(i,"morphTargetInfluences",g)}return{update:e}}function O0(i,V,g,I){let e=new WeakMap;function t(s){const a=I.render.frame,o=s.geometry,n=V.get(s,o);return e.get(n)!==a&&(V.update(n),e.set(n,a)),s.isInstancedMesh&&(s.hasEventListener("dispose",A)===!1&&s.addEventListener("dispose",A),g.update(s.instanceMatrix,34962),s.instanceColor!==null&&g.update(s.instanceColor,34962)),n}function C(){e=new WeakMap}function A(s){const a=s.target;a.removeEventListener("dispose",A),g.remove(a.instanceMatrix),a.instanceColor!==null&&g.remove(a.instanceColor)}return{update:t,dispose:C}}class Id extends Mg{constructor(V=null,g=1,I=1,e=1){super(null),this.image={data:V,width:g,height:I,depth:e},this.magFilter=Lg,this.minFilter=Lg,this.wrapR=lI,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Id.prototype.isDataTexture2DArray=!0;class ed extends Mg{constructor(V=null,g=1,I=1,e=1){super(null),this.image={data:V,width:g,height:I,depth:e},this.magFilter=Lg,this.minFilter=Lg,this.wrapR=lI,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ed.prototype.isDataTexture3D=!0;const td=new Mg,_0=new Id,$0=new ed,Cd=new Ni,_a=[],$a=[],Vo=new Float32Array(16),go=new Float32Array(9),Io=new Float32Array(4);function YC(i,V,g){const I=i[0];if(I<=0||I>0)return i;const e=V*g;let t=_a[e];if(t===void 0&&(t=new Float32Array(e),_a[e]=t),V!==0){I.toArray(t,0);for(let C=1,A=0;C!==V;++C)A+=g,i[C].toArray(t,A)}return t}function CI(i,V){if(i.length!==V.length)return!1;for(let g=0,I=i.length;g<I;g++)if(i[g]!==V[g])return!1;return!0}function $g(i,V){for(let g=0,I=V.length;g<I;g++)i[g]=V[g]}function id(i,V){let g=$a[V];g===void 0&&(g=new Int32Array(V),$a[V]=g);for(let I=0;I!==V;++I)g[I]=i.allocateTextureUnit();return g}function Vp(i,V){const g=this.cache;g[0]!==V&&(i.uniform1f(this.addr,V),g[0]=V)}function gp(i,V){const g=this.cache;if(V.x!==void 0)(g[0]!==V.x||g[1]!==V.y)&&(i.uniform2f(this.addr,V.x,V.y),g[0]=V.x,g[1]=V.y);else{if(CI(g,V))return;i.uniform2fv(this.addr,V),$g(g,V)}}function Ip(i,V){const g=this.cache;if(V.x!==void 0)(g[0]!==V.x||g[1]!==V.y||g[2]!==V.z)&&(i.uniform3f(this.addr,V.x,V.y,V.z),g[0]=V.x,g[1]=V.y,g[2]=V.z);else if(V.r!==void 0)(g[0]!==V.r||g[1]!==V.g||g[2]!==V.b)&&(i.uniform3f(this.addr,V.r,V.g,V.b),g[0]=V.r,g[1]=V.g,g[2]=V.b);else{if(CI(g,V))return;i.uniform3fv(this.addr,V),$g(g,V)}}function ep(i,V){const g=this.cache;if(V.x!==void 0)(g[0]!==V.x||g[1]!==V.y||g[2]!==V.z||g[3]!==V.w)&&(i.uniform4f(this.addr,V.x,V.y,V.z,V.w),g[0]=V.x,g[1]=V.y,g[2]=V.z,g[3]=V.w);else{if(CI(g,V))return;i.uniform4fv(this.addr,V),$g(g,V)}}function tp(i,V){const g=this.cache,I=V.elements;if(I===void 0){if(CI(g,V))return;i.uniformMatrix2fv(this.addr,!1,V),$g(g,V)}else{if(CI(g,I))return;Io.set(I),i.uniformMatrix2fv(this.addr,!1,Io),$g(g,I)}}function Cp(i,V){const g=this.cache,I=V.elements;if(I===void 0){if(CI(g,V))return;i.uniformMatrix3fv(this.addr,!1,V),$g(g,V)}else{if(CI(g,I))return;go.set(I),i.uniformMatrix3fv(this.addr,!1,go),$g(g,I)}}function ip(i,V){const g=this.cache,I=V.elements;if(I===void 0){if(CI(g,V))return;i.uniformMatrix4fv(this.addr,!1,V),$g(g,V)}else{if(CI(g,I))return;Vo.set(I),i.uniformMatrix4fv(this.addr,!1,Vo),$g(g,I)}}function Ap(i,V){const g=this.cache;g[0]!==V&&(i.uniform1i(this.addr,V),g[0]=V)}function np(i,V){const g=this.cache;CI(g,V)||(i.uniform2iv(this.addr,V),$g(g,V))}function sp(i,V){const g=this.cache;CI(g,V)||(i.uniform3iv(this.addr,V),$g(g,V))}function lp(i,V){const g=this.cache;CI(g,V)||(i.uniform4iv(this.addr,V),$g(g,V))}function ap(i,V){const g=this.cache;g[0]!==V&&(i.uniform1ui(this.addr,V),g[0]=V)}function op(i,V){const g=this.cache;CI(g,V)||(i.uniform2uiv(this.addr,V),$g(g,V))}function cp(i,V){const g=this.cache;CI(g,V)||(i.uniform3uiv(this.addr,V),$g(g,V))}function dp(i,V){const g=this.cache;CI(g,V)||(i.uniform4uiv(this.addr,V),$g(g,V))}function rp(i,V,g){const I=this.cache,e=g.allocateTextureUnit();I[0]!==e&&(i.uniform1i(this.addr,e),I[0]=e),g.safeSetTexture2D(V||td,e)}function hp(i,V,g){const I=this.cache,e=g.allocateTextureUnit();I[0]!==e&&(i.uniform1i(this.addr,e),I[0]=e),g.setTexture3D(V||$0,e)}function mp(i,V,g){const I=this.cache,e=g.allocateTextureUnit();I[0]!==e&&(i.uniform1i(this.addr,e),I[0]=e),g.safeSetTextureCube(V||Cd,e)}function up(i,V,g){const I=this.cache,e=g.allocateTextureUnit();I[0]!==e&&(i.uniform1i(this.addr,e),I[0]=e),g.setTexture2DArray(V||_0,e)}function bp(i){switch(i){case 5126:return Vp;case 35664:return gp;case 35665:return Ip;case 35666:return ep;case 35674:return tp;case 35675:return Cp;case 35676:return ip;case 5124:case 35670:return Ap;case 35667:case 35671:return np;case 35668:case 35672:return sp;case 35669:case 35673:return lp;case 5125:return ap;case 36294:return op;case 36295:return cp;case 36296:return dp;case 35678:case 36198:case 36298:case 36306:case 35682:return rp;case 35679:case 36299:case 36307:return hp;case 35680:case 36300:case 36308:case 36293:return mp;case 36289:case 36303:case 36311:case 36292:return up}}function Zp(i,V){i.uniform1fv(this.addr,V)}function Gp(i,V){const g=YC(V,this.size,2);i.uniform2fv(this.addr,g)}function pp(i,V){const g=YC(V,this.size,3);i.uniform3fv(this.addr,g)}function qp(i,V){const g=YC(V,this.size,4);i.uniform4fv(this.addr,g)}function Bp(i,V){const g=YC(V,this.size,4);i.uniformMatrix2fv(this.addr,!1,g)}function Wp(i,V){const g=YC(V,this.size,9);i.uniformMatrix3fv(this.addr,!1,g)}function yp(i,V){const g=YC(V,this.size,16);i.uniformMatrix4fv(this.addr,!1,g)}function Xp(i,V){i.uniform1iv(this.addr,V)}function Rp(i,V){i.uniform2iv(this.addr,V)}function Yp(i,V){i.uniform3iv(this.addr,V)}function wp(i,V){i.uniform4iv(this.addr,V)}function Hp(i,V){i.uniform1uiv(this.addr,V)}function fp(i,V){i.uniform2uiv(this.addr,V)}function Sp(i,V){i.uniform3uiv(this.addr,V)}function Fp(i,V){i.uniform4uiv(this.addr,V)}function vp(i,V,g){const I=V.length,e=id(g,I);i.uniform1iv(this.addr,e);for(let t=0;t!==I;++t)g.safeSetTexture2D(V[t]||td,e[t])}function Np(i,V,g){const I=V.length,e=id(g,I);i.uniform1iv(this.addr,e);for(let t=0;t!==I;++t)g.safeSetTextureCube(V[t]||Cd,e[t])}function Kp(i){switch(i){case 5126:return Zp;case 35664:return Gp;case 35665:return pp;case 35666:return qp;case 35674:return Bp;case 35675:return Wp;case 35676:return yp;case 5124:case 35670:return Xp;case 35667:case 35671:return Rp;case 35668:case 35672:return Yp;case 35669:case 35673:return wp;case 5125:return Hp;case 36294:return fp;case 36295:return Sp;case 36296:return Fp;case 35678:case 36198:case 36298:case 36306:case 35682:return vp;case 35680:case 36300:case 36308:case 36293:return Np}}function Jp(i,V,g){this.id=i,this.addr=g,this.cache=[],this.setValue=bp(V.type)}function Ad(i,V,g){this.id=i,this.addr=g,this.cache=[],this.size=V.size,this.setValue=Kp(V.type)}Ad.prototype.updateCache=function(i){const V=this.cache;i instanceof Float32Array&&V.length!==i.length&&(this.cache=new Float32Array(i.length)),$g(V,i)};function nd(i){this.id=i,this.seq=[],this.map={}}nd.prototype.setValue=function(i,V,g){const I=this.seq;for(let e=0,t=I.length;e!==t;++e){const C=I[e];C.setValue(i,V[C.id],g)}};const Mn=/(\w+)(\])?(\[|\.)?/g;function eo(i,V){i.seq.push(V),i.map[V.id]=V}function Mp(i,V,g){const I=i.name,e=I.length;for(Mn.lastIndex=0;;){const t=Mn.exec(I),C=Mn.lastIndex;let A=t[1];const s=t[2]==="]",a=t[3];if(s&&(A=A|0),a===void 0||a==="["&&C+2===e){eo(g,a===void 0?new Jp(A,i,V):new Ad(A,i,V));break}else{let n=g.map[A];n===void 0&&(n=new nd(A),eo(g,n)),g=n}}}function Pe(i,V){this.seq=[],this.map={};const g=i.getProgramParameter(V,35718);for(let I=0;I<g;++I){const e=i.getActiveUniform(V,I),t=i.getUniformLocation(V,e.name);Mp(e,t,this)}}Pe.prototype.setValue=function(i,V,g,I){const e=this.map[V];e!==void 0&&e.setValue(i,g,I)};Pe.prototype.setOptional=function(i,V,g){const I=V[g];I!==void 0&&this.setValue(i,g,I)};Pe.upload=function(i,V,g,I){for(let e=0,t=V.length;e!==t;++e){const C=V[e],A=g[C.id];A.needsUpdate!==!1&&C.setValue(i,A.value,I)}};Pe.seqWithValue=function(i,V){const g=[];for(let I=0,e=i.length;I!==e;++I){const t=i[I];t.id in V&&g.push(t)}return g};function to(i,V,g){const I=i.createShader(V);return i.shaderSource(I,g),i.compileShader(I),I}let xp=0;function kp(i){const V=i.split(`
`);for(let g=0;g<V.length;g++)V[g]=g+1+": "+V[g];return V.join(`
`)}function sd(i){switch(i){case vi:return["Linear","( value )"];case NA:return["sRGB","( value )"];case wb:return["RGBE","( value )"];case fb:return["RGBM","( value, 7.0 )"];case Sb:return["RGBM","( value, 16.0 )"];case Fb:return["RGBD","( value, 256.0 )"];case Yb:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Hb:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function Co(i,V,g){const I=i.getShaderParameter(V,35713),e=i.getShaderInfoLog(V).trim();if(I&&e==="")return"";const t=i.getShaderSource(V);return"THREE.WebGLShader: gl.getShaderInfoLog() "+g+`
`+e+kp(t)}function zC(i,V){const g=sd(V);return"vec4 "+i+"( vec4 value ) { return "+g[0]+"ToLinear"+g[1]+"; }"}function zp(i,V){const g=sd(V);return"vec4 "+i+"( vec4 value ) { return LinearTo"+g[0]+g[1]+"; }"}function Tp(i,V){let g;switch(V){case Ru:g="Linear";break;case Yu:g="Reinhard";break;case wu:g="OptimizedCineon";break;case Hu:g="ACESFilmic";break;case fu:g="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",V),g="Linear"}return"vec3 "+i+"( vec3 color ) { return "+g+"ToneMapping( color ); }"}function Lp(i){return[i.extensionDerivatives||i.envMapCubeUV||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission>0)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter($C).join(`
`)}function Up(i){const V=[];for(const g in i){const I=i[g];I!==!1&&V.push("#define "+g+" "+I)}return V.join(`
`)}function Dp(i,V){const g={},I=i.getProgramParameter(V,35721);for(let e=0;e<I;e++){const C=i.getActiveAttrib(V,e).name;g[C]=i.getAttribLocation(V,C)}return g}function $C(i){return i!==""}function io(i,V){return i.replace(/NUM_DIR_LIGHTS/g,V.numDirLights).replace(/NUM_SPOT_LIGHTS/g,V.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,V.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,V.numPointLights).replace(/NUM_HEMI_LIGHTS/g,V.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,V.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,V.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,V.numPointLightShadows)}function Ao(i,V){return i.replace(/NUM_CLIPPING_PLANES/g,V.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,V.numClippingPlanes-V.numClipIntersection)}const Ep=/^[ \t]*#include +<([\w\d./]+)>/gm;function Rs(i){return i.replace(Ep,Qp)}function Qp(i,V){const g=QV[V];if(g===void 0)throw new Error("Can not resolve #include <"+V+">");return Rs(g)}const jp=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Pp=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function no(i){return i.replace(Pp,ld).replace(jp,Op)}function Op(i,V,g,I){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ld(i,V,g,I)}function ld(i,V,g,I){let e="";for(let t=parseInt(V);t<parseInt(g);t++)e+=I.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return e}function so(i){let V="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?V+=`
#define HIGH_PRECISION`:i.precision==="mediump"?V+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(V+=`
#define LOW_PRECISION`),V}function _p(i){let V="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===Kc?V="SHADOWMAP_TYPE_PCF":i.shadowMapType===iu?V="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===_C&&(V="SHADOWMAP_TYPE_VSM"),V}function $p(i){let V="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Cl:case il:V="ENVMAP_TYPE_CUBE";break;case Al:case nl:V="ENVMAP_TYPE_CUBE_UV";break}return V}function Vq(i){let V="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case il:case nl:V="ENVMAP_MODE_REFRACTION";break}return V}function gq(i){let V="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case EA:V="ENVMAP_BLENDING_MULTIPLY";break;case yu:V="ENVMAP_BLENDING_MIX";break;case Xu:V="ENVMAP_BLENDING_ADD";break}return V}function Iq(i,V,g,I){const e=i.getContext(),t=g.defines;let C=g.vertexShader,A=g.fragmentShader;const s=_p(g),a=$p(g),o=Vq(g),n=gq(g),l=i.gammaFactor>0?i.gammaFactor:1,c=g.isWebGL2?"":Lp(g),d=Up(t),h=e.createProgram();let m,r,u=g.glslVersion?"#version "+g.glslVersion+`
`:"";g.isRawShaderMaterial?(m=[d].filter($C).join(`
`),m.length>0&&(m+=`
`),r=[c,d].filter($C).join(`
`),r.length>0&&(r+=`
`)):(m=[so(g),"#define SHADER_NAME "+g.shaderName,d,g.instancing?"#define USE_INSTANCING":"",g.instancingColor?"#define USE_INSTANCING_COLOR":"",g.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+l,"#define MAX_BONES "+g.maxBones,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp2?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+o:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.normalMap&&g.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",g.normalMap&&g.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",g.clearcoatMap?"#define USE_CLEARCOATMAP":"",g.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",g.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",g.displacementMap&&g.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.transmission?"#define USE_TRANSMISSION":"",g.transmissionMap?"#define USE_TRANSMISSIONMAP":"",g.thicknessMap?"#define USE_THICKNESSMAP":"",g.vertexTangents?"#define USE_TANGENT":"",g.vertexColors?"#define USE_COLOR":"",g.vertexAlphas?"#define USE_COLOR_ALPHA":"",g.vertexUvs?"#define USE_UV":"",g.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",g.flatShading?"#define FLAT_SHADED":"",g.skinning?"#define USE_SKINNING":"",g.useVertexTexture?"#define BONE_TEXTURE":"",g.morphTargets?"#define USE_MORPHTARGETS":"",g.morphNormals&&g.flatShading===!1?"#define USE_MORPHNORMALS":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+s:"",g.sizeAttenuation?"#define USE_SIZEATTENUATION":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&g.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter($C).join(`
`),r=[c,so(g),"#define SHADER_NAME "+g.shaderName,d,g.alphaTest?"#define ALPHATEST "+g.alphaTest+(g.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+l,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp2?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.matcap?"#define USE_MATCAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+a:"",g.envMap?"#define "+o:"",g.envMap?"#define "+n:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.normalMap&&g.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",g.normalMap&&g.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",g.clearcoatMap?"#define USE_CLEARCOATMAP":"",g.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",g.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.sheen?"#define USE_SHEEN":"",g.transmission?"#define USE_TRANSMISSION":"",g.transmissionMap?"#define USE_TRANSMISSIONMAP":"",g.thicknessMap?"#define USE_THICKNESSMAP":"",g.vertexTangents?"#define USE_TANGENT":"",g.vertexColors||g.instancingColor?"#define USE_COLOR":"",g.vertexAlphas?"#define USE_COLOR_ALPHA":"",g.vertexUvs?"#define USE_UV":"",g.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",g.gradientMap?"#define USE_GRADIENTMAP":"",g.flatShading?"#define FLAT_SHADED":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+s:"",g.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",g.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&g.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(g.extensionShaderTextureLOD||g.envMap)&&g.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",g.toneMapping!==nC?"#define TONE_MAPPING":"",g.toneMapping!==nC?QV.tonemapping_pars_fragment:"",g.toneMapping!==nC?Tp("toneMapping",g.toneMapping):"",g.dithering?"#define DITHERING":"",QV.encodings_pars_fragment,g.map?zC("mapTexelToLinear",g.mapEncoding):"",g.matcap?zC("matcapTexelToLinear",g.matcapEncoding):"",g.envMap?zC("envMapTexelToLinear",g.envMapEncoding):"",g.emissiveMap?zC("emissiveMapTexelToLinear",g.emissiveMapEncoding):"",g.lightMap?zC("lightMapTexelToLinear",g.lightMapEncoding):"",zp("linearToOutputTexel",g.outputEncoding),g.depthPacking?"#define DEPTH_PACKING "+g.depthPacking:"",`
`].filter($C).join(`
`)),C=Rs(C),C=io(C,g),C=Ao(C,g),A=Rs(A),A=io(A,g),A=Ao(A,g),C=no(C),A=no(A),g.isWebGL2&&g.isRawShaderMaterial!==!0&&(u=`#version 300 es
`,m=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,r=["#define varying in",g.glslVersion===xa?"":"out highp vec4 pc_fragColor;",g.glslVersion===xa?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+r);const b=u+m+C,Z=u+r+A,p=to(e,35633,b),G=to(e,35632,Z);if(e.attachShader(h,p),e.attachShader(h,G),g.index0AttributeName!==void 0?e.bindAttribLocation(h,0,g.index0AttributeName):g.morphTargets===!0&&e.bindAttribLocation(h,0,"position"),e.linkProgram(h),i.debug.checkShaderErrors){const y=e.getProgramInfoLog(h).trim(),Y=e.getShaderInfoLog(p).trim(),f=e.getShaderInfoLog(G).trim();let L=!0,R=!0;if(e.getProgramParameter(h,35714)===!1){L=!1;const J=Co(e,p,"vertex"),H=Co(e,G,"fragment");console.error("THREE.WebGLProgram: shader error: ",e.getError(),"35715",e.getProgramParameter(h,35715),"gl.getProgramInfoLog",y,J,H)}else y!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",y):(Y===""||f==="")&&(R=!1);R&&(this.diagnostics={runnable:L,programLog:y,vertexShader:{log:Y,prefix:m},fragmentShader:{log:f,prefix:r}})}e.deleteShader(p),e.deleteShader(G);let X;this.getUniforms=function(){return X===void 0&&(X=new Pe(e,h)),X};let W;return this.getAttributes=function(){return W===void 0&&(W=Dp(e,h)),W},this.destroy=function(){I.releaseStatesOfProgram(this),e.deleteProgram(h),this.program=void 0},this.name=g.shaderName,this.id=xp++,this.cacheKey=V,this.usedTimes=1,this.program=h,this.vertexShader=p,this.fragmentShader=G,this}function eq(i,V,g,I,e,t){const C=[],A=I.isWebGL2,s=I.logarithmicDepthBuffer,a=I.floatVertexTextures,o=I.maxVertexUniforms,n=I.vertexTextures;let l=I.precision;const c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},d=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function h(G){const W=G.skeleton.bones;if(a)return 1024;{const Y=Math.floor((o-20)/4),f=Math.min(Y,W.length);return f<W.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+W.length+" bones. This GPU supports "+f+"."),0):f}}function m(G){let X;return G&&G.isTexture?X=G.encoding:G&&G.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),X=G.texture.encoding):X=vi,X}function r(G,X,W,y,Y){const f=y.fog,L=G.isMeshStandardMaterial?y.environment:null,R=V.get(G.envMap||L),J=c[G.type],H=Y.isSkinnedMesh?h(Y):0;G.precision!==null&&(l=I.getMaxPrecision(G.precision),l!==G.precision&&console.warn("THREE.WebGLProgram.getParameters:",G.precision,"not supported, using",l,"instead."));let N,v;if(J){const $=tI[J];N=$.vertexShader,v=$.fragmentShader}else N=G.vertexShader,v=G.fragmentShader;const T=i.getRenderTarget();return{isWebGL2:A,shaderID:J,shaderName:G.type,vertexShader:N,fragmentShader:v,defines:G.defines,isRawShaderMaterial:G.isRawShaderMaterial===!0,glslVersion:G.glslVersion,precision:l,instancing:Y.isInstancedMesh===!0,instancingColor:Y.isInstancedMesh===!0&&Y.instanceColor!==null,supportsVertexTextures:n,outputEncoding:T!==null?m(T.texture):i.outputEncoding,map:!!G.map,mapEncoding:m(G.map),matcap:!!G.matcap,matcapEncoding:m(G.matcap),envMap:!!R,envMapMode:R&&R.mapping,envMapEncoding:m(R),envMapCubeUV:!!R&&(R.mapping===Al||R.mapping===nl),lightMap:!!G.lightMap,lightMapEncoding:m(G.lightMap),aoMap:!!G.aoMap,emissiveMap:!!G.emissiveMap,emissiveMapEncoding:m(G.emissiveMap),bumpMap:!!G.bumpMap,normalMap:!!G.normalMap,objectSpaceNormalMap:G.normalMapType===Kb,tangentSpaceNormalMap:G.normalMapType===Yt,clearcoatMap:!!G.clearcoatMap,clearcoatRoughnessMap:!!G.clearcoatRoughnessMap,clearcoatNormalMap:!!G.clearcoatNormalMap,displacementMap:!!G.displacementMap,roughnessMap:!!G.roughnessMap,metalnessMap:!!G.metalnessMap,specularMap:!!G.specularMap,alphaMap:!!G.alphaMap,gradientMap:!!G.gradientMap,sheen:!!G.sheen,transmission:!!G.transmission,transmissionMap:!!G.transmissionMap,thicknessMap:!!G.thicknessMap,combine:G.combine,vertexTangents:G.normalMap&&G.vertexTangents,vertexColors:G.vertexColors,vertexAlphas:G.vertexColors===!0&&Y.geometry&&Y.geometry.attributes.color&&Y.geometry.attributes.color.itemSize===4,vertexUvs:!!G.map||!!G.bumpMap||!!G.normalMap||!!G.specularMap||!!G.alphaMap||!!G.emissiveMap||!!G.roughnessMap||!!G.metalnessMap||!!G.clearcoatMap||!!G.clearcoatRoughnessMap||!!G.clearcoatNormalMap||!!G.displacementMap||!!G.transmissionMap||!!G.thicknessMap,uvsVertexOnly:!(!!G.map||!!G.bumpMap||!!G.normalMap||!!G.specularMap||!!G.alphaMap||!!G.emissiveMap||!!G.roughnessMap||!!G.metalnessMap||!!G.clearcoatNormalMap||!!G.transmission||!!G.transmissionMap||!!G.thicknessMap)&&!!G.displacementMap,fog:!!f,useFog:G.fog,fogExp2:f&&f.isFogExp2,flatShading:!!G.flatShading,sizeAttenuation:G.sizeAttenuation,logarithmicDepthBuffer:s,skinning:Y.isSkinnedMesh===!0&&H>0,maxBones:H,useVertexTexture:a,morphTargets:G.morphTargets,morphNormals:G.morphNormals,numDirLights:X.directional.length,numPointLights:X.point.length,numSpotLights:X.spot.length,numRectAreaLights:X.rectArea.length,numHemiLights:X.hemi.length,numDirLightShadows:X.directionalShadowMap.length,numPointLightShadows:X.pointShadowMap.length,numSpotLightShadows:X.spotShadowMap.length,numClippingPlanes:t.numPlanes,numClipIntersection:t.numIntersection,dithering:G.dithering,shadowMapEnabled:i.shadowMap.enabled&&W.length>0,shadowMapType:i.shadowMap.type,toneMapping:G.toneMapped?i.toneMapping:nC,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:G.premultipliedAlpha,alphaTest:G.alphaTest,doubleSided:G.side===yt,flipSided:G.side===wg,depthPacking:G.depthPacking!==void 0?G.depthPacking:!1,index0AttributeName:G.index0AttributeName,extensionDerivatives:G.extensions&&G.extensions.derivatives,extensionFragDepth:G.extensions&&G.extensions.fragDepth,extensionDrawBuffers:G.extensions&&G.extensions.drawBuffers,extensionShaderTextureLOD:G.extensions&&G.extensions.shaderTextureLOD,rendererExtensionFragDepth:A||g.has("EXT_frag_depth"),rendererExtensionDrawBuffers:A||g.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:A||g.has("EXT_shader_texture_lod"),customProgramCacheKey:G.customProgramCacheKey()}}function u(G){const X=[];if(G.shaderID?X.push(G.shaderID):(X.push(G.fragmentShader),X.push(G.vertexShader)),G.defines!==void 0)for(const W in G.defines)X.push(W),X.push(G.defines[W]);if(G.isRawShaderMaterial===!1){for(let W=0;W<d.length;W++)X.push(G[d[W]]);X.push(i.outputEncoding),X.push(i.gammaFactor)}return X.push(G.customProgramCacheKey),X.join()}function b(G){const X=c[G.type];let W;if(X){const y=tI[X];W=St.clone(y.uniforms)}else W=G.uniforms;return W}function Z(G,X){let W;for(let y=0,Y=C.length;y<Y;y++){const f=C[y];if(f.cacheKey===X){W=f,++W.usedTimes;break}}return W===void 0&&(W=new Iq(i,X,G,e),C.push(W)),W}function p(G){if(--G.usedTimes===0){const X=C.indexOf(G);C[X]=C[C.length-1],C.pop(),G.destroy()}}return{getParameters:r,getProgramCacheKey:u,getUniforms:b,acquireProgram:Z,releaseProgram:p,programs:C}}function tq(){let i=new WeakMap;function V(t){let C=i.get(t);return C===void 0&&(C={},i.set(t,C)),C}function g(t){i.delete(t)}function I(t,C,A){i.get(t)[C]=A}function e(){i=new WeakMap}return{get:V,remove:g,update:I,dispose:e}}function Cq(i,V){return i.groupOrder!==V.groupOrder?i.groupOrder-V.groupOrder:i.renderOrder!==V.renderOrder?i.renderOrder-V.renderOrder:i.program!==V.program?i.program.id-V.program.id:i.material.id!==V.material.id?i.material.id-V.material.id:i.z!==V.z?i.z-V.z:i.id-V.id}function lo(i,V){return i.groupOrder!==V.groupOrder?i.groupOrder-V.groupOrder:i.renderOrder!==V.renderOrder?i.renderOrder-V.renderOrder:i.z!==V.z?V.z-i.z:i.id-V.id}function ao(i){const V=[];let g=0;const I=[],e=[],t=[],C={id:-1};function A(){g=0,I.length=0,e.length=0,t.length=0}function s(c,d,h,m,r,u){let b=V[g];const Z=i.get(h);return b===void 0?(b={id:c.id,object:c,geometry:d,material:h,program:Z.program||C,groupOrder:m,renderOrder:c.renderOrder,z:r,group:u},V[g]=b):(b.id=c.id,b.object=c,b.geometry=d,b.material=h,b.program=Z.program||C,b.groupOrder=m,b.renderOrder=c.renderOrder,b.z=r,b.group=u),g++,b}function a(c,d,h,m,r,u){const b=s(c,d,h,m,r,u);h.transmission>0?e.push(b):h.transparent===!0?t.push(b):I.push(b)}function o(c,d,h,m,r,u){const b=s(c,d,h,m,r,u);h.transmission>0?e.unshift(b):h.transparent===!0?t.unshift(b):I.unshift(b)}function n(c,d){I.length>1&&I.sort(c||Cq),e.length>1&&e.sort(d||lo),t.length>1&&t.sort(d||lo)}function l(){for(let c=g,d=V.length;c<d;c++){const h=V[c];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.program=null,h.group=null}}return{opaque:I,transmissive:e,transparent:t,init:A,push:a,unshift:o,finish:l,sort:n}}function iq(i){let V=new WeakMap;function g(e,t){let C;return V.has(e)===!1?(C=new ao(i),V.set(e,[C])):t>=V.get(e).length?(C=new ao(i),V.get(e).push(C)):C=V.get(e)[t],C}function I(){V=new WeakMap}return{get:g,dispose:I}}function Aq(){const i={};return{get:function(V){if(i[V.id]!==void 0)return i[V.id];let g;switch(V.type){case"DirectionalLight":g={direction:new S,color:new NV};break;case"SpotLight":g={position:new S,direction:new S,color:new NV,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":g={position:new S,color:new NV,distance:0,decay:0};break;case"HemisphereLight":g={direction:new S,skyColor:new NV,groundColor:new NV};break;case"RectAreaLight":g={color:new NV,position:new S,halfWidth:new S,halfHeight:new S};break}return i[V.id]=g,g}}}function nq(){const i={};return{get:function(V){if(i[V.id]!==void 0)return i[V.id];let g;switch(V.type){case"DirectionalLight":g={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dV};break;case"SpotLight":g={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dV};break;case"PointLight":g={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dV,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[V.id]=g,g}}}let sq=0;function lq(i,V){return(V.castShadow?1:0)-(i.castShadow?1:0)}function aq(i,V){const g=new Aq,I=nq(),e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let o=0;o<9;o++)e.probe.push(new S);const t=new S,C=new JV,A=new JV;function s(o){let n=0,l=0,c=0;for(let X=0;X<9;X++)e.probe[X].set(0,0,0);let d=0,h=0,m=0,r=0,u=0,b=0,Z=0,p=0;o.sort(lq);for(let X=0,W=o.length;X<W;X++){const y=o[X],Y=y.color,f=y.intensity,L=y.distance,R=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)n+=Y.r*f,l+=Y.g*f,c+=Y.b*f;else if(y.isLightProbe)for(let J=0;J<9;J++)e.probe[J].addScaledVector(y.sh.coefficients[J],f);else if(y.isDirectionalLight){const J=g.get(y);if(J.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){const H=y.shadow,N=I.get(y);N.shadowBias=H.bias,N.shadowNormalBias=H.normalBias,N.shadowRadius=H.radius,N.shadowMapSize=H.mapSize,e.directionalShadow[d]=N,e.directionalShadowMap[d]=R,e.directionalShadowMatrix[d]=y.shadow.matrix,b++}e.directional[d]=J,d++}else if(y.isSpotLight){const J=g.get(y);if(J.position.setFromMatrixPosition(y.matrixWorld),J.color.copy(Y).multiplyScalar(f),J.distance=L,J.coneCos=Math.cos(y.angle),J.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),J.decay=y.decay,y.castShadow){const H=y.shadow,N=I.get(y);N.shadowBias=H.bias,N.shadowNormalBias=H.normalBias,N.shadowRadius=H.radius,N.shadowMapSize=H.mapSize,e.spotShadow[m]=N,e.spotShadowMap[m]=R,e.spotShadowMatrix[m]=y.shadow.matrix,p++}e.spot[m]=J,m++}else if(y.isRectAreaLight){const J=g.get(y);J.color.copy(Y).multiplyScalar(f),J.halfWidth.set(y.width*.5,0,0),J.halfHeight.set(0,y.height*.5,0),e.rectArea[r]=J,r++}else if(y.isPointLight){const J=g.get(y);if(J.color.copy(y.color).multiplyScalar(y.intensity),J.distance=y.distance,J.decay=y.decay,y.castShadow){const H=y.shadow,N=I.get(y);N.shadowBias=H.bias,N.shadowNormalBias=H.normalBias,N.shadowRadius=H.radius,N.shadowMapSize=H.mapSize,N.shadowCameraNear=H.camera.near,N.shadowCameraFar=H.camera.far,e.pointShadow[h]=N,e.pointShadowMap[h]=R,e.pointShadowMatrix[h]=y.shadow.matrix,Z++}e.point[h]=J,h++}else if(y.isHemisphereLight){const J=g.get(y);J.skyColor.copy(y.color).multiplyScalar(f),J.groundColor.copy(y.groundColor).multiplyScalar(f),e.hemi[u]=J,u++}}r>0&&(V.isWebGL2||i.has("OES_texture_float_linear")===!0?(e.rectAreaLTC1=FV.LTC_FLOAT_1,e.rectAreaLTC2=FV.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(e.rectAreaLTC1=FV.LTC_HALF_1,e.rectAreaLTC2=FV.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),e.ambient[0]=n,e.ambient[1]=l,e.ambient[2]=c;const G=e.hash;(G.directionalLength!==d||G.pointLength!==h||G.spotLength!==m||G.rectAreaLength!==r||G.hemiLength!==u||G.numDirectionalShadows!==b||G.numPointShadows!==Z||G.numSpotShadows!==p)&&(e.directional.length=d,e.spot.length=m,e.rectArea.length=r,e.point.length=h,e.hemi.length=u,e.directionalShadow.length=b,e.directionalShadowMap.length=b,e.pointShadow.length=Z,e.pointShadowMap.length=Z,e.spotShadow.length=p,e.spotShadowMap.length=p,e.directionalShadowMatrix.length=b,e.pointShadowMatrix.length=Z,e.spotShadowMatrix.length=p,G.directionalLength=d,G.pointLength=h,G.spotLength=m,G.rectAreaLength=r,G.hemiLength=u,G.numDirectionalShadows=b,G.numPointShadows=Z,G.numSpotShadows=p,e.version=sq++)}function a(o,n){let l=0,c=0,d=0,h=0,m=0;const r=n.matrixWorldInverse;for(let u=0,b=o.length;u<b;u++){const Z=o[u];if(Z.isDirectionalLight){const p=e.directional[l];p.direction.setFromMatrixPosition(Z.matrixWorld),t.setFromMatrixPosition(Z.target.matrixWorld),p.direction.sub(t),p.direction.transformDirection(r),l++}else if(Z.isSpotLight){const p=e.spot[d];p.position.setFromMatrixPosition(Z.matrixWorld),p.position.applyMatrix4(r),p.direction.setFromMatrixPosition(Z.matrixWorld),t.setFromMatrixPosition(Z.target.matrixWorld),p.direction.sub(t),p.direction.transformDirection(r),d++}else if(Z.isRectAreaLight){const p=e.rectArea[h];p.position.setFromMatrixPosition(Z.matrixWorld),p.position.applyMatrix4(r),A.identity(),C.copy(Z.matrixWorld),C.premultiply(r),A.extractRotation(C),p.halfWidth.set(Z.width*.5,0,0),p.halfHeight.set(0,Z.height*.5,0),p.halfWidth.applyMatrix4(A),p.halfHeight.applyMatrix4(A),h++}else if(Z.isPointLight){const p=e.point[c];p.position.setFromMatrixPosition(Z.matrixWorld),p.position.applyMatrix4(r),c++}else if(Z.isHemisphereLight){const p=e.hemi[m];p.direction.setFromMatrixPosition(Z.matrixWorld),p.direction.transformDirection(r),p.direction.normalize(),m++}}}return{setup:s,setupView:a,state:e}}function oo(i,V){const g=new aq(i,V),I=[],e=[];function t(){I.length=0,e.length=0}function C(n){I.push(n)}function A(n){e.push(n)}function s(){g.setup(I)}function a(n){g.setupView(I,n)}return{init:t,state:{lightsArray:I,shadowsArray:e,lights:g},setupLights:s,setupLightsView:a,pushLight:C,pushShadow:A}}function oq(i,V){let g=new WeakMap;function I(t,C=0){let A;return g.has(t)===!1?(A=new oo(i,V),g.set(t,[A])):C>=g.get(t).length?(A=new oo(i,V),g.get(t).push(A)):A=g.get(t)[C],A}function e(){g=new WeakMap}return{get:I,dispose:e}}class ad extends xg{constructor(V){super(),this.type="MeshDepthMaterial",this.depthPacking=vb,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(V)}copy(V){return super.copy(V),this.depthPacking=V.depthPacking,this.morphTargets=V.morphTargets,this.map=V.map,this.alphaMap=V.alphaMap,this.displacementMap=V.displacementMap,this.displacementScale=V.displacementScale,this.displacementBias=V.displacementBias,this.wireframe=V.wireframe,this.wireframeLinewidth=V.wireframeLinewidth,this}}ad.prototype.isMeshDepthMaterial=!0;class od extends xg{constructor(V){super(),this.type="MeshDistanceMaterial",this.referencePosition=new S,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(V)}copy(V){return super.copy(V),this.referencePosition.copy(V.referencePosition),this.nearDistance=V.nearDistance,this.farDistance=V.farDistance,this.morphTargets=V.morphTargets,this.map=V.map,this.alphaMap=V.alphaMap,this.displacementMap=V.displacementMap,this.displacementScale=V.displacementScale,this.displacementBias=V.displacementBias,this}}od.prototype.isMeshDistanceMaterial=!0;var cq=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,dq=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function cd(i,V,g){let I=new Ki;const e=new dV,t=new dV,C=new eg,A=[],s=[],a={},o=g.maxTextureSize,n={0:wg,1:rC,2:yt},l=new Xe({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new dV},radius:{value:4}},vertexShader:dq,fragmentShader:cq}),c=l.clone();c.defines.HORIZONTAL_PASS=1;const d=new $V;d.setAttribute("position",new qg(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const h=new og(d,l),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Kc,this.render=function(G,X,W){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||G.length===0)return;const y=i.getRenderTarget(),Y=i.getActiveCubeFace(),f=i.getActiveMipmapLevel(),L=i.state;L.setBlending(ei),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);for(let R=0,J=G.length;R<J;R++){const H=G[R],N=H.shadow;if(N===void 0){console.warn("THREE.WebGLShadowMap:",H,"has no shadow.");continue}if(N.autoUpdate===!1&&N.needsUpdate===!1)continue;e.copy(N.mapSize);const v=N.getFrameExtents();if(e.multiply(v),t.copy(N.mapSize),(e.x>o||e.y>o)&&(e.x>o&&(t.x=Math.floor(o/v.x),e.x=t.x*v.x,N.mapSize.x=t.x),e.y>o&&(t.y=Math.floor(o/v.y),e.y=t.y*v.y,N.mapSize.y=t.y)),N.map===null&&!N.isPointLightShadow&&this.type===_C){const D={minFilter:Sg,magFilter:Sg,format:NI};N.map=new Ie(e.x,e.y,D),N.map.texture.name=H.name+".shadowMap",N.mapPass=new Ie(e.x,e.y,D),N.camera.updateProjectionMatrix()}if(N.map===null){const D={minFilter:Lg,magFilter:Lg,format:NI};N.map=new Ie(e.x,e.y,D),N.map.texture.name=H.name+".shadowMap",N.camera.updateProjectionMatrix()}i.setRenderTarget(N.map),i.clear();const T=N.getViewportCount();for(let D=0;D<T;D++){const $=N.getViewport(D);C.set(t.x*$.x,t.y*$.y,t.x*$.z,t.y*$.w),L.viewport(C),N.updateMatrices(H,D),I=N.getFrustum(),p(X,W,N.camera,H,this.type)}!N.isPointLightShadow&&this.type===_C&&r(N,W),N.needsUpdate=!1}m.needsUpdate=!1,i.setRenderTarget(y,Y,f)};function r(G,X){const W=V.update(h);l.uniforms.shadow_pass.value=G.map.texture,l.uniforms.resolution.value=G.mapSize,l.uniforms.radius.value=G.radius,i.setRenderTarget(G.mapPass),i.clear(),i.renderBufferDirect(X,null,W,l,h,null),c.uniforms.shadow_pass.value=G.mapPass.texture,c.uniforms.resolution.value=G.mapSize,c.uniforms.radius.value=G.radius,i.setRenderTarget(G.map),i.clear(),i.renderBufferDirect(X,null,W,c,h,null)}function u(G){const X=G<<0;let W=A[X];return W===void 0&&(W=new ad({depthPacking:Nb,morphTargets:G}),A[X]=W),W}function b(G){const X=G<<0;let W=s[X];return W===void 0&&(W=new od({morphTargets:G}),s[X]=W),W}function Z(G,X,W,y,Y,f,L){let R=null,J=u,H=G.customDepthMaterial;if(y.isPointLight===!0&&(J=b,H=G.customDistanceMaterial),H===void 0){let N=!1;W.morphTargets===!0&&(N=X.morphAttributes&&X.morphAttributes.position&&X.morphAttributes.position.length>0),R=J(N)}else R=H;if(i.localClippingEnabled&&W.clipShadows===!0&&W.clippingPlanes.length!==0){const N=R.uuid,v=W.uuid;let T=a[N];T===void 0&&(T={},a[N]=T);let D=T[v];D===void 0&&(D=R.clone(),T[v]=D),R=D}return R.visible=W.visible,R.wireframe=W.wireframe,L===_C?R.side=W.shadowSide!==null?W.shadowSide:W.side:R.side=W.shadowSide!==null?W.shadowSide:n[W.side],R.clipShadows=W.clipShadows,R.clippingPlanes=W.clippingPlanes,R.clipIntersection=W.clipIntersection,R.wireframeLinewidth=W.wireframeLinewidth,R.linewidth=W.linewidth,y.isPointLight===!0&&R.isMeshDistanceMaterial===!0&&(R.referencePosition.setFromMatrixPosition(y.matrixWorld),R.nearDistance=Y,R.farDistance=f),R}function p(G,X,W,y,Y){if(G.visible===!1)return;if(G.layers.test(X.layers)&&(G.isMesh||G.isLine||G.isPoints)&&(G.castShadow||G.receiveShadow&&Y===_C)&&(!G.frustumCulled||I.intersectsObject(G))){G.modelViewMatrix.multiplyMatrices(W.matrixWorldInverse,G.matrixWorld);const R=V.update(G),J=G.material;if(Array.isArray(J)){const H=R.groups;for(let N=0,v=H.length;N<v;N++){const T=H[N],D=J[T.materialIndex];if(D&&D.visible){const $=Z(G,R,D,y,W.near,W.far,Y);i.renderBufferDirect(W,null,R,$,G,T)}}}else if(J.visible){const H=Z(G,R,J,y,W.near,W.far,Y);i.renderBufferDirect(W,null,R,H,G,null)}}const L=G.children;for(let R=0,J=L.length;R<J;R++)p(L[R],X,W,y,Y)}}function rq(i,V,g){const I=g.isWebGL2;function e(){let E=!1;const WV=new eg;let bV=null;const MV=new eg(0,0,0,0);return{setMask:function(HV){bV!==HV&&!E&&(i.colorMask(HV,HV,HV,HV),bV=HV)},setLocked:function(HV){E=HV},setClear:function(HV,OV,tg,Cg,gI){gI===!0&&(HV*=Cg,OV*=Cg,tg*=Cg),WV.set(HV,OV,tg,Cg),MV.equals(WV)===!1&&(i.clearColor(HV,OV,tg,Cg),MV.copy(WV))},reset:function(){E=!1,bV=null,MV.set(-1,0,0,0)}}}function t(){let E=!1,WV=null,bV=null,MV=null;return{setTest:function(HV){HV?z(2929):F(2929)},setMask:function(HV){WV!==HV&&!E&&(i.depthMask(HV),WV=HV)},setFunc:function(HV){if(bV!==HV){if(HV)switch(HV){case bu:i.depthFunc(512);break;case Zu:i.depthFunc(519);break;case Gu:i.depthFunc(513);break;case qs:i.depthFunc(515);break;case pu:i.depthFunc(514);break;case qu:i.depthFunc(518);break;case Bu:i.depthFunc(516);break;case Wu:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);bV=HV}},setLocked:function(HV){E=HV},setClear:function(HV){MV!==HV&&(i.clearDepth(HV),MV=HV)},reset:function(){E=!1,WV=null,bV=null,MV=null}}}function C(){let E=!1,WV=null,bV=null,MV=null,HV=null,OV=null,tg=null,Cg=null,gI=null;return{setTest:function(Vg){E||(Vg?z(2960):F(2960))},setMask:function(Vg){WV!==Vg&&!E&&(i.stencilMask(Vg),WV=Vg)},setFunc:function(Vg,Yg,mg){(bV!==Vg||MV!==Yg||HV!==mg)&&(i.stencilFunc(Vg,Yg,mg),bV=Vg,MV=Yg,HV=mg)},setOp:function(Vg,Yg,mg){(OV!==Vg||tg!==Yg||Cg!==mg)&&(i.stencilOp(Vg,Yg,mg),OV=Vg,tg=Yg,Cg=mg)},setLocked:function(Vg){E=Vg},setClear:function(Vg){gI!==Vg&&(i.clearStencil(Vg),gI=Vg)},reset:function(){E=!1,WV=null,bV=null,MV=null,HV=null,OV=null,tg=null,Cg=null,gI=null}}}const A=new e,s=new t,a=new C;let o={},n=null,l={},c=null,d=!1,h=null,m=null,r=null,u=null,b=null,Z=null,p=null,G=!1,X=null,W=null,y=null,Y=null,f=null;const L=i.getParameter(35661);let R=!1,J=0;const H=i.getParameter(7938);H.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(H)[1]),R=J>=1):H.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),R=J>=2);let N=null,v={};const T=i.getParameter(3088),D=i.getParameter(2978),$=new eg().fromArray(T),M=new eg().fromArray(D);function _(E,WV,bV){const MV=new Uint8Array(4),HV=i.createTexture();i.bindTexture(E,HV),i.texParameteri(E,10241,9728),i.texParameteri(E,10240,9728);for(let OV=0;OV<bV;OV++)i.texImage2D(WV+OV,0,6408,1,1,0,6408,5121,MV);return HV}const x={};x[3553]=_(3553,3553,1),x[34067]=_(34067,34069,6),A.setClear(0,0,0,1),s.setClear(1),a.setClear(0),z(2929),s.setFunc(qs),CV(!1),AV(Ga),z(2884),lV(ei);function z(E){o[E]!==!0&&(i.enable(E),o[E]=!0)}function F(E){o[E]!==!1&&(i.disable(E),o[E]=!1)}function k(E){E!==n&&(i.bindFramebuffer(36160,E),n=E)}function rV(E,WV){return WV===null&&n!==null&&(WV=n),l[E]!==WV?(i.bindFramebuffer(E,WV),l[E]=WV,I&&(E===36009&&(l[36160]=WV),E===36160&&(l[36009]=WV)),!0):!1}function nV(E){return c!==E?(i.useProgram(E),c=E,!0):!1}const j={[IC]:32774,[nu]:32778,[su]:32779};if(I)j[Wa]=32775,j[ya]=32776;else{const E=V.get("EXT_blend_minmax");E!==null&&(j[Wa]=E.MIN_EXT,j[ya]=E.MAX_EXT)}const VV={[lu]:0,[au]:1,[ou]:768,[Mc]:770,[uu]:776,[hu]:774,[du]:772,[cu]:769,[xc]:771,[mu]:775,[ru]:773};function lV(E,WV,bV,MV,HV,OV,tg,Cg){if(E===ei){d===!0&&(F(3042),d=!1);return}if(d===!1&&(z(3042),d=!0),E!==Au){if(E!==h||Cg!==G){if((m!==IC||b!==IC)&&(i.blendEquation(32774),m=IC,b=IC),Cg)switch(E){case ti:i.blendFuncSeparate(1,771,1,771);break;case pa:i.blendFunc(1,1);break;case qa:i.blendFuncSeparate(0,0,769,771);break;case Ba:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",E);break}else switch(E){case ti:i.blendFuncSeparate(770,771,1,771);break;case pa:i.blendFunc(770,1);break;case qa:i.blendFunc(0,769);break;case Ba:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",E);break}r=null,u=null,Z=null,p=null,h=E,G=Cg}return}HV=HV||WV,OV=OV||bV,tg=tg||MV,(WV!==m||HV!==b)&&(i.blendEquationSeparate(j[WV],j[HV]),m=WV,b=HV),(bV!==r||MV!==u||OV!==Z||tg!==p)&&(i.blendFuncSeparate(VV[bV],VV[MV],VV[OV],VV[tg]),r=bV,u=MV,Z=OV,p=tg),h=E,G=null}function iV(E,WV){E.side===yt?F(2884):z(2884);let bV=E.side===wg;WV&&(bV=!bV),CV(bV),E.blending===ti&&E.transparent===!1?lV(ei):lV(E.blending,E.blendEquation,E.blendSrc,E.blendDst,E.blendEquationAlpha,E.blendSrcAlpha,E.blendDstAlpha,E.premultipliedAlpha),s.setFunc(E.depthFunc),s.setTest(E.depthTest),s.setMask(E.depthWrite),A.setMask(E.colorWrite);const MV=E.stencilWrite;a.setTest(MV),MV&&(a.setMask(E.stencilWriteMask),a.setFunc(E.stencilFunc,E.stencilRef,E.stencilFuncMask),a.setOp(E.stencilFail,E.stencilZFail,E.stencilZPass)),eV(E.polygonOffset,E.polygonOffsetFactor,E.polygonOffsetUnits),E.alphaToCoverage===!0?z(32926):F(32926)}function CV(E){X!==E&&(E?i.frontFace(2304):i.frontFace(2305),X=E)}function AV(E){E!==tu?(z(2884),E!==W&&(E===Ga?i.cullFace(1029):E===Cu?i.cullFace(1028):i.cullFace(1032))):F(2884),W=E}function gV(E){E!==y&&(R&&i.lineWidth(E),y=E)}function eV(E,WV,bV){E?(z(32823),(Y!==WV||f!==bV)&&(i.polygonOffset(WV,bV),Y=WV,f=bV)):F(32823)}function K(E){E?z(3089):F(3089)}function w(E){E===void 0&&(E=33984+L-1),N!==E&&(i.activeTexture(E),N=E)}function sV(E,WV){N===null&&w();let bV=v[N];bV===void 0&&(bV={type:void 0,texture:void 0},v[N]=bV),(bV.type!==E||bV.texture!==WV)&&(i.bindTexture(E,WV||x[E]),bV.type=E,bV.texture=WV)}function tV(){const E=v[N];E!==void 0&&E.type!==void 0&&(i.bindTexture(E.type,null),E.type=void 0,E.texture=void 0)}function BV(){try{i.compressedTexImage2D.apply(i,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function yV(){try{i.texImage2D.apply(i,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function wV(){try{i.texImage3D.apply(i,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function fV(E){$.equals(E)===!1&&(i.scissor(E.x,E.y,E.z,E.w),$.copy(E))}function vV(E){M.equals(E)===!1&&(i.viewport(E.x,E.y,E.z,E.w),M.copy(E))}function YV(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),I===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),o={},N=null,v={},n=null,l={},c=null,d=!1,h=null,m=null,r=null,u=null,b=null,Z=null,p=null,G=!1,X=null,W=null,y=null,Y=null,f=null,$.set(0,0,i.canvas.width,i.canvas.height),M.set(0,0,i.canvas.width,i.canvas.height),A.reset(),s.reset(),a.reset()}return{buffers:{color:A,depth:s,stencil:a},enable:z,disable:F,bindFramebuffer:rV,bindXRFramebuffer:k,useProgram:nV,setBlending:lV,setMaterial:iV,setFlipSided:CV,setCullFace:AV,setLineWidth:gV,setPolygonOffset:eV,setScissorTest:K,activeTexture:w,bindTexture:sV,unbindTexture:tV,compressedTexImage2D:BV,texImage2D:yV,texImage3D:wV,scissor:fV,viewport:vV,reset:YV}}function hq(i,V,g,I,e,t,C){const A=e.isWebGL2,s=e.maxTextures,a=e.maxCubemapSize,o=e.maxTextureSize,n=e.maxSamples,l=new WeakMap;let c,d=!1;try{d=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(K){}function h(K,w){return d?new OffscreenCanvas(K,w):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function m(K,w,sV,tV){let BV=1;if((K.width>tV||K.height>tV)&&(BV=tV/Math.max(K.width,K.height)),BV<1||w===!0)if(typeof HTMLImageElement!="undefined"&&K instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&K instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&K instanceof ImageBitmap){const yV=w?Dc:Math.floor,wV=yV(BV*K.width),fV=yV(BV*K.height);c===void 0&&(c=h(wV,fV));const vV=sV?h(wV,fV):c;return vV.width=wV,vV.height=fV,vV.getContext("2d").drawImage(K,0,0,wV,fV),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+K.width+"x"+K.height+") to ("+wV+"x"+fV+")."),vV}else return"data"in K&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+K.width+"x"+K.height+")."),K;return K}function r(K){return Xs(K.width)&&Xs(K.height)}function u(K){return A?!1:K.wrapS!==lI||K.wrapT!==lI||K.minFilter!==Lg&&K.minFilter!==Sg}function b(K,w){return K.generateMipmaps&&w&&K.minFilter!==Lg&&K.minFilter!==Sg}function Z(K,w,sV,tV,BV=1){i.generateMipmap(K);const yV=I.get(w);yV.__maxMipLevel=Math.log2(Math.max(sV,tV,BV))}function p(K,w,sV){if(A===!1)return w;if(K!==null){if(i[K]!==void 0)return i[K];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+K+"'")}let tV=w;return w===6403&&(sV===5126&&(tV=33326),sV===5131&&(tV=33325),sV===5121&&(tV=33321)),w===6407&&(sV===5126&&(tV=34837),sV===5131&&(tV=34843),sV===5121&&(tV=32849)),w===6408&&(sV===5126&&(tV=34836),sV===5131&&(tV=34842),sV===5121&&(tV=32856)),(tV===33325||tV===33326||tV===34842||tV===34836)&&V.get("EXT_color_buffer_float"),tV}function G(K){return K===Lg||K===Bs||K===Ws?9728:9729}function X(K){const w=K.target;w.removeEventListener("dispose",X),y(w),w.isVideoTexture&&l.delete(w),C.memory.textures--}function W(K){const w=K.target;w.removeEventListener("dispose",W),Y(w)}function y(K){const w=I.get(K);w.__webglInit!==void 0&&(i.deleteTexture(w.__webglTexture),I.remove(K))}function Y(K){const w=K.texture,sV=I.get(K),tV=I.get(w);if(!!K){if(tV.__webglTexture!==void 0&&(i.deleteTexture(tV.__webglTexture),C.memory.textures--),K.depthTexture&&K.depthTexture.dispose(),K.isWebGLCubeRenderTarget)for(let BV=0;BV<6;BV++)i.deleteFramebuffer(sV.__webglFramebuffer[BV]),sV.__webglDepthbuffer&&i.deleteRenderbuffer(sV.__webglDepthbuffer[BV]);else i.deleteFramebuffer(sV.__webglFramebuffer),sV.__webglDepthbuffer&&i.deleteRenderbuffer(sV.__webglDepthbuffer),sV.__webglMultisampledFramebuffer&&i.deleteFramebuffer(sV.__webglMultisampledFramebuffer),sV.__webglColorRenderbuffer&&i.deleteRenderbuffer(sV.__webglColorRenderbuffer),sV.__webglDepthRenderbuffer&&i.deleteRenderbuffer(sV.__webglDepthRenderbuffer);if(K.isWebGLMultipleRenderTargets)for(let BV=0,yV=w.length;BV<yV;BV++){const wV=I.get(w[BV]);wV.__webglTexture&&(i.deleteTexture(wV.__webglTexture),C.memory.textures--),I.remove(w[BV])}I.remove(w),I.remove(K)}}let f=0;function L(){f=0}function R(){const K=f;return K>=s&&console.warn("THREE.WebGLTextures: Trying to use "+K+" texture units while this GPU supports only "+s),f+=1,K}function J(K,w){const sV=I.get(K);if(K.isVideoTexture&&iV(K),K.version>0&&sV.__version!==K.version){const tV=K.image;if(tV===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(tV.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{_(sV,K,w);return}}g.activeTexture(33984+w),g.bindTexture(3553,sV.__webglTexture)}function H(K,w){const sV=I.get(K);if(K.version>0&&sV.__version!==K.version){_(sV,K,w);return}g.activeTexture(33984+w),g.bindTexture(35866,sV.__webglTexture)}function N(K,w){const sV=I.get(K);if(K.version>0&&sV.__version!==K.version){_(sV,K,w);return}g.activeTexture(33984+w),g.bindTexture(32879,sV.__webglTexture)}function v(K,w){const sV=I.get(K);if(K.version>0&&sV.__version!==K.version){x(sV,K,w);return}g.activeTexture(33984+w),g.bindTexture(34067,sV.__webglTexture)}const T={[Vt]:10497,[lI]:33071,[fA]:33648},D={[Lg]:9728,[Bs]:9984,[Ws]:9986,[Sg]:9729,[zc]:9985,[XC]:9987};function $(K,w,sV){if(sV?(i.texParameteri(K,10242,T[w.wrapS]),i.texParameteri(K,10243,T[w.wrapT]),(K===32879||K===35866)&&i.texParameteri(K,32882,T[w.wrapR]),i.texParameteri(K,10240,D[w.magFilter]),i.texParameteri(K,10241,D[w.minFilter])):(i.texParameteri(K,10242,33071),i.texParameteri(K,10243,33071),(K===32879||K===35866)&&i.texParameteri(K,32882,33071),(w.wrapS!==lI||w.wrapT!==lI)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(K,10240,G(w.magFilter)),i.texParameteri(K,10241,G(w.minFilter)),w.minFilter!==Lg&&w.minFilter!==Sg&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),V.has("EXT_texture_filter_anisotropic")===!0){const tV=V.get("EXT_texture_filter_anisotropic");if(w.type===ze&&V.has("OES_texture_float_linear")===!1||A===!1&&w.type===sC&&V.has("OES_texture_half_float_linear")===!1)return;(w.anisotropy>1||I.get(w).__currentAnisotropy)&&(i.texParameterf(K,tV.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(w.anisotropy,e.getMaxAnisotropy())),I.get(w).__currentAnisotropy=w.anisotropy)}}function M(K,w){K.__webglInit===void 0&&(K.__webglInit=!0,w.addEventListener("dispose",X),K.__webglTexture=i.createTexture(),C.memory.textures++)}function _(K,w,sV){let tV=3553;w.isDataTexture2DArray&&(tV=35866),w.isDataTexture3D&&(tV=32879),M(K,w),g.activeTexture(33984+sV),g.bindTexture(tV,K.__webglTexture),i.pixelStorei(37440,w.flipY),i.pixelStorei(37441,w.premultiplyAlpha),i.pixelStorei(3317,w.unpackAlignment),i.pixelStorei(37443,0);const BV=u(w)&&r(w.image)===!1,yV=m(w.image,BV,!1,o),wV=r(yV)||A,fV=t.convert(w.format);let vV=t.convert(w.type),YV=p(w.internalFormat,fV,vV);$(tV,w,wV);let E;const WV=w.mipmaps;if(w.isDepthTexture)YV=6402,A?w.type===ze?YV=36012:w.type===qA?YV=33190:w.type===Ci?YV=35056:YV=33189:w.type===ze&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),w.format===lC&&YV===6402&&w.type!==FA&&w.type!==qA&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),w.type=FA,vV=t.convert(w.type)),w.format===ri&&YV===6402&&(YV=34041,w.type!==Ci&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),w.type=Ci,vV=t.convert(w.type))),g.texImage2D(3553,0,YV,yV.width,yV.height,0,fV,vV,null);else if(w.isDataTexture)if(WV.length>0&&wV){for(let bV=0,MV=WV.length;bV<MV;bV++)E=WV[bV],g.texImage2D(3553,bV,YV,E.width,E.height,0,fV,vV,E.data);w.generateMipmaps=!1,K.__maxMipLevel=WV.length-1}else g.texImage2D(3553,0,YV,yV.width,yV.height,0,fV,vV,yV.data),K.__maxMipLevel=0;else if(w.isCompressedTexture){for(let bV=0,MV=WV.length;bV<MV;bV++)E=WV[bV],w.format!==NI&&w.format!==je?fV!==null?g.compressedTexImage2D(3553,bV,YV,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):g.texImage2D(3553,bV,YV,E.width,E.height,0,fV,vV,E.data);K.__maxMipLevel=WV.length-1}else if(w.isDataTexture2DArray)g.texImage3D(35866,0,YV,yV.width,yV.height,yV.depth,0,fV,vV,yV.data),K.__maxMipLevel=0;else if(w.isDataTexture3D)g.texImage3D(32879,0,YV,yV.width,yV.height,yV.depth,0,fV,vV,yV.data),K.__maxMipLevel=0;else if(WV.length>0&&wV){for(let bV=0,MV=WV.length;bV<MV;bV++)E=WV[bV],g.texImage2D(3553,bV,YV,fV,vV,E);w.generateMipmaps=!1,K.__maxMipLevel=WV.length-1}else g.texImage2D(3553,0,YV,fV,vV,yV),K.__maxMipLevel=0;b(w,wV)&&Z(tV,w,yV.width,yV.height),K.__version=w.version,w.onUpdate&&w.onUpdate(w)}function x(K,w,sV){if(w.image.length!==6)return;M(K,w),g.activeTexture(33984+sV),g.bindTexture(34067,K.__webglTexture),i.pixelStorei(37440,w.flipY),i.pixelStorei(37441,w.premultiplyAlpha),i.pixelStorei(3317,w.unpackAlignment),i.pixelStorei(37443,0);const tV=w&&(w.isCompressedTexture||w.image[0].isCompressedTexture),BV=w.image[0]&&w.image[0].isDataTexture,yV=[];for(let bV=0;bV<6;bV++)!tV&&!BV?yV[bV]=m(w.image[bV],!1,!0,a):yV[bV]=BV?w.image[bV].image:w.image[bV];const wV=yV[0],fV=r(wV)||A,vV=t.convert(w.format),YV=t.convert(w.type),E=p(w.internalFormat,vV,YV);$(34067,w,fV);let WV;if(tV){for(let bV=0;bV<6;bV++){WV=yV[bV].mipmaps;for(let MV=0;MV<WV.length;MV++){const HV=WV[MV];w.format!==NI&&w.format!==je?vV!==null?g.compressedTexImage2D(34069+bV,MV,E,HV.width,HV.height,0,HV.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g.texImage2D(34069+bV,MV,E,HV.width,HV.height,0,vV,YV,HV.data)}}K.__maxMipLevel=WV.length-1}else{WV=w.mipmaps;for(let bV=0;bV<6;bV++)if(BV){g.texImage2D(34069+bV,0,E,yV[bV].width,yV[bV].height,0,vV,YV,yV[bV].data);for(let MV=0;MV<WV.length;MV++){const OV=WV[MV].image[bV].image;g.texImage2D(34069+bV,MV+1,E,OV.width,OV.height,0,vV,YV,OV.data)}}else{g.texImage2D(34069+bV,0,E,vV,YV,yV[bV]);for(let MV=0;MV<WV.length;MV++){const HV=WV[MV];g.texImage2D(34069+bV,MV+1,E,vV,YV,HV.image[bV])}}K.__maxMipLevel=WV.length}b(w,fV)&&Z(34067,w,wV.width,wV.height),K.__version=w.version,w.onUpdate&&w.onUpdate(w)}function z(K,w,sV,tV,BV){const yV=t.convert(sV.format),wV=t.convert(sV.type),fV=p(sV.internalFormat,yV,wV);BV===32879||BV===35866?g.texImage3D(BV,0,fV,w.width,w.height,w.depth,0,yV,wV,null):g.texImage2D(BV,0,fV,w.width,w.height,0,yV,wV,null),g.bindFramebuffer(36160,K),i.framebufferTexture2D(36160,tV,BV,I.get(sV).__webglTexture,0),g.bindFramebuffer(36160,null)}function F(K,w,sV){if(i.bindRenderbuffer(36161,K),w.depthBuffer&&!w.stencilBuffer){let tV=33189;if(sV){const BV=w.depthTexture;BV&&BV.isDepthTexture&&(BV.type===ze?tV=36012:BV.type===qA&&(tV=33190));const yV=lV(w);i.renderbufferStorageMultisample(36161,yV,tV,w.width,w.height)}else i.renderbufferStorage(36161,tV,w.width,w.height);i.framebufferRenderbuffer(36160,36096,36161,K)}else if(w.depthBuffer&&w.stencilBuffer){if(sV){const tV=lV(w);i.renderbufferStorageMultisample(36161,tV,35056,w.width,w.height)}else i.renderbufferStorage(36161,34041,w.width,w.height);i.framebufferRenderbuffer(36160,33306,36161,K)}else{const tV=w.isWebGLMultipleRenderTargets===!0?w.texture[0]:w.texture,BV=t.convert(tV.format),yV=t.convert(tV.type),wV=p(tV.internalFormat,BV,yV);if(sV){const fV=lV(w);i.renderbufferStorageMultisample(36161,fV,wV,w.width,w.height)}else i.renderbufferStorage(36161,wV,w.width,w.height)}i.bindRenderbuffer(36161,null)}function k(K,w){if(w&&w.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(g.bindFramebuffer(36160,K),!(w.depthTexture&&w.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!I.get(w.depthTexture).__webglTexture||w.depthTexture.image.width!==w.width||w.depthTexture.image.height!==w.height)&&(w.depthTexture.image.width=w.width,w.depthTexture.image.height=w.height,w.depthTexture.needsUpdate=!0),J(w.depthTexture,0);const tV=I.get(w.depthTexture).__webglTexture;if(w.depthTexture.format===lC)i.framebufferTexture2D(36160,36096,3553,tV,0);else if(w.depthTexture.format===ri)i.framebufferTexture2D(36160,33306,3553,tV,0);else throw new Error("Unknown depthTexture format")}function rV(K){const w=I.get(K),sV=K.isWebGLCubeRenderTarget===!0;if(K.depthTexture){if(sV)throw new Error("target.depthTexture not supported in Cube render targets");k(w.__webglFramebuffer,K)}else if(sV){w.__webglDepthbuffer=[];for(let tV=0;tV<6;tV++)g.bindFramebuffer(36160,w.__webglFramebuffer[tV]),w.__webglDepthbuffer[tV]=i.createRenderbuffer(),F(w.__webglDepthbuffer[tV],K,!1)}else g.bindFramebuffer(36160,w.__webglFramebuffer),w.__webglDepthbuffer=i.createRenderbuffer(),F(w.__webglDepthbuffer,K,!1);g.bindFramebuffer(36160,null)}function nV(K){const w=K.texture,sV=I.get(K),tV=I.get(w);K.addEventListener("dispose",W),K.isWebGLMultipleRenderTargets!==!0&&(tV.__webglTexture=i.createTexture(),tV.__version=w.version,C.memory.textures++);const BV=K.isWebGLCubeRenderTarget===!0,yV=K.isWebGLMultipleRenderTargets===!0,wV=K.isWebGLMultisampleRenderTarget===!0,fV=w.isDataTexture3D||w.isDataTexture2DArray,vV=r(K)||A;if(A&&w.format===je&&(w.type===ze||w.type===sC)&&(w.format=NI,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),BV){sV.__webglFramebuffer=[];for(let YV=0;YV<6;YV++)sV.__webglFramebuffer[YV]=i.createFramebuffer()}else if(sV.__webglFramebuffer=i.createFramebuffer(),yV)if(e.drawBuffers){const YV=K.texture;for(let E=0,WV=YV.length;E<WV;E++){const bV=I.get(YV[E]);bV.__webglTexture===void 0&&(bV.__webglTexture=i.createTexture(),C.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(wV)if(A){sV.__webglMultisampledFramebuffer=i.createFramebuffer(),sV.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,sV.__webglColorRenderbuffer);const YV=t.convert(w.format),E=t.convert(w.type),WV=p(w.internalFormat,YV,E),bV=lV(K);i.renderbufferStorageMultisample(36161,bV,WV,K.width,K.height),g.bindFramebuffer(36160,sV.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,sV.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),K.depthBuffer&&(sV.__webglDepthRenderbuffer=i.createRenderbuffer(),F(sV.__webglDepthRenderbuffer,K,!0)),g.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(BV){g.bindTexture(34067,tV.__webglTexture),$(34067,w,vV);for(let YV=0;YV<6;YV++)z(sV.__webglFramebuffer[YV],K,w,36064,34069+YV);b(w,vV)&&Z(34067,w,K.width,K.height),g.bindTexture(34067,null)}else if(yV){const YV=K.texture;for(let E=0,WV=YV.length;E<WV;E++){const bV=YV[E],MV=I.get(bV);g.bindTexture(3553,MV.__webglTexture),$(3553,bV,vV),z(sV.__webglFramebuffer,K,bV,36064+E,3553),b(bV,vV)&&Z(3553,bV,K.width,K.height)}g.bindTexture(3553,null)}else{let YV=3553;fV&&(A?YV=w.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),g.bindTexture(YV,tV.__webglTexture),$(YV,w,vV),z(sV.__webglFramebuffer,K,w,36064,YV),b(w,vV)&&Z(YV,w,K.width,K.height,K.depth),g.bindTexture(YV,null)}K.depthBuffer&&rV(K)}function j(K){const w=r(K)||A,sV=K.isWebGLMultipleRenderTargets===!0?K.texture:[K.texture];for(let tV=0,BV=sV.length;tV<BV;tV++){const yV=sV[tV];if(b(yV,w)){const wV=K.isWebGLCubeRenderTarget?34067:3553,fV=I.get(yV).__webglTexture;g.bindTexture(wV,fV),Z(wV,yV,K.width,K.height),g.bindTexture(wV,null)}}}function VV(K){if(K.isWebGLMultisampleRenderTarget)if(A){const w=K.width,sV=K.height;let tV=16384;K.depthBuffer&&(tV|=256),K.stencilBuffer&&(tV|=1024);const BV=I.get(K);g.bindFramebuffer(36008,BV.__webglMultisampledFramebuffer),g.bindFramebuffer(36009,BV.__webglFramebuffer),i.blitFramebuffer(0,0,w,sV,0,0,w,sV,tV,9728),g.bindFramebuffer(36008,null),g.bindFramebuffer(36009,BV.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function lV(K){return A&&K.isWebGLMultisampleRenderTarget?Math.min(n,K.samples):0}function iV(K){const w=C.render.frame;l.get(K)!==w&&(l.set(K,w),K.update())}let CV=!1,AV=!1;function gV(K,w){K&&K.isWebGLRenderTarget&&(CV===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),CV=!0),K=K.texture),J(K,w)}function eV(K,w){K&&K.isWebGLCubeRenderTarget&&(AV===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),AV=!0),K=K.texture),v(K,w)}this.allocateTextureUnit=R,this.resetTextureUnits=L,this.setTexture2D=J,this.setTexture2DArray=H,this.setTexture3D=N,this.setTextureCube=v,this.setupRenderTarget=nV,this.updateRenderTargetMipmap=j,this.updateMultisampleRenderTarget=VV,this.safeSetTexture2D=gV,this.safeSetTextureCube=eV}function mq(i,V,g){const I=g.isWebGL2;function e(t){let C;if(t===SA)return 5121;if(t===Nu)return 32819;if(t===Ku)return 32820;if(t===Ju)return 33635;if(t===Su)return 5120;if(t===Fu)return 5122;if(t===FA)return 5123;if(t===vu)return 5124;if(t===qA)return 5125;if(t===ze)return 5126;if(t===sC)return I?5131:(C=V.get("OES_texture_half_float"),C!==null?C.HALF_FLOAT_OES:null);if(t===Mu)return 6406;if(t===je)return 6407;if(t===NI)return 6408;if(t===xu)return 6409;if(t===ku)return 6410;if(t===lC)return 6402;if(t===ri)return 34041;if(t===zu)return 6403;if(t===Tu)return 36244;if(t===Lu)return 33319;if(t===Uu)return 33320;if(t===Du)return 36248;if(t===Eu)return 36249;if(t===Ya||t===wa||t===Ha||t===fa)if(C=V.get("WEBGL_compressed_texture_s3tc"),C!==null){if(t===Ya)return C.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===wa)return C.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Ha)return C.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===fa)return C.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(t===Sa||t===Fa||t===va||t===Na)if(C=V.get("WEBGL_compressed_texture_pvrtc"),C!==null){if(t===Sa)return C.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Fa)return C.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===va)return C.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Na)return C.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(t===Qu)return C=V.get("WEBGL_compressed_texture_etc1"),C!==null?C.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===Ka||t===Ja)&&(C=V.get("WEBGL_compressed_texture_etc"),C!==null)){if(t===Ka)return C.COMPRESSED_RGB8_ETC2;if(t===Ja)return C.COMPRESSED_RGBA8_ETC2_EAC}if(t===ju||t===Pu||t===Ou||t===_u||t===$u||t===Vb||t===gb||t===Ib||t===eb||t===tb||t===Cb||t===ib||t===Ab||t===nb||t===lb||t===ab||t===ob||t===cb||t===db||t===rb||t===hb||t===mb||t===ub||t===bb||t===Zb||t===Gb||t===pb||t===qb)return C=V.get("WEBGL_compressed_texture_astc"),C!==null?t:null;if(t===sb)return C=V.get("EXT_texture_compression_bptc"),C!==null?t:null;if(t===Ci)return I?34042:(C=V.get("WEBGL_depth_texture"),C!==null?C.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:e}}class dd extends jg{constructor(V=[]){super(),this.cameras=V}}dd.prototype.isArrayCamera=!0;class $I extends UV{constructor(){super(),this.type="Group"}}$I.prototype.isGroup=!0;const uq={type:"move"};class xn{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new $I,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new $I,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new S,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new S),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new $I,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new S,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new S),this._grip}dispatchEvent(V){return this._targetRay!==null&&this._targetRay.dispatchEvent(V),this._grip!==null&&this._grip.dispatchEvent(V),this._hand!==null&&this._hand.dispatchEvent(V),this}disconnect(V){return this.dispatchEvent({type:"disconnected",data:V}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(V,g,I){let e=null,t=null,C=null;const A=this._targetRay,s=this._grip,a=this._hand;if(V&&g.session.visibilityState!=="visible-blurred")if(A!==null&&(e=g.getPose(V.targetRaySpace,I),e!==null&&(A.matrix.fromArray(e.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),e.linearVelocity?(A.hasLinearVelocity=!0,A.linearVelocity.copy(e.linearVelocity)):A.hasLinearVelocity=!1,e.angularVelocity?(A.hasAngularVelocity=!0,A.angularVelocity.copy(e.angularVelocity)):A.hasAngularVelocity=!1,this.dispatchEvent(uq))),a&&V.hand){C=!0;for(const h of V.hand.values()){const m=g.getJointPose(h,I);if(a.joints[h.jointName]===void 0){const u=new $I;u.matrixAutoUpdate=!1,u.visible=!1,a.joints[h.jointName]=u,a.add(u)}const r=a.joints[h.jointName];m!==null&&(r.matrix.fromArray(m.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=m.radius),r.visible=m!==null}const o=a.joints["index-finger-tip"],n=a.joints["thumb-tip"],l=o.position.distanceTo(n.position),c=.02,d=.005;a.inputState.pinching&&l>c+d?(a.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:V.handedness,target:this})):!a.inputState.pinching&&l<=c-d&&(a.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:V.handedness,target:this}))}else s!==null&&V.gripSpace&&(t=g.getPose(V.gripSpace,I),t!==null&&(s.matrix.fromArray(t.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),t.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(t.linearVelocity)):s.hasLinearVelocity=!1,t.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(t.angularVelocity)):s.hasAngularVelocity=!1));return A!==null&&(A.visible=e!==null),s!==null&&(s.visible=t!==null),a!==null&&(a.visible=C!==null),this}}class bq extends wt{constructor(V,g){super();const I=this,e=V.state;let t=null,C=1,A=null,s="local-floor",a=null,o=null,n=null,l=null;const c=[],d=new Map,h=new jg;h.layers.enable(1),h.viewport=new eg;const m=new jg;m.layers.enable(2),m.viewport=new eg;const r=[h,m],u=new dd;u.layers.enable(1),u.layers.enable(2);let b=null,Z=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(H){let N=c[H];return N===void 0&&(N=new xn,c[H]=N),N.getTargetRaySpace()},this.getControllerGrip=function(H){let N=c[H];return N===void 0&&(N=new xn,c[H]=N),N.getGripSpace()},this.getHand=function(H){let N=c[H];return N===void 0&&(N=new xn,c[H]=N),N.getHandSpace()};function p(H){const N=d.get(H.inputSource);N&&N.dispatchEvent({type:H.type,data:H.inputSource})}function G(){d.forEach(function(H,N){H.disconnect(N)}),d.clear(),b=null,Z=null,e.bindXRFramebuffer(null),V.setRenderTarget(V.getRenderTarget()),J.stop(),I.isPresenting=!1,I.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(H){C=H,I.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(H){s=H,I.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return A},this.getSession=function(){return t},this.setSession=function(H){return SV(this,null,function*(){if(t=H,t!==null){t.addEventListener("select",p),t.addEventListener("selectstart",p),t.addEventListener("selectend",p),t.addEventListener("squeeze",p),t.addEventListener("squeezestart",p),t.addEventListener("squeezeend",p),t.addEventListener("end",G),t.addEventListener("inputsourceschange",X);const N=g.getContextAttributes();if(N.xrCompatible!==!0&&(yield g.makeXRCompatible()),t.renderState.layers===void 0){const v={antialias:N.antialias,alpha:N.alpha,depth:N.depth,stencil:N.stencil,framebufferScaleFactor:C},T=new XRWebGLLayer(t,g,v);t.updateRenderState({baseLayer:T})}else{let v=0;N.depth&&(v=N.stencil?34041:6402);const T={colorFormat:N.alpha?6408:6407,depthFormat:v,scaleFactor:C};o=new XRWebGLBinding(t,g),l=o.createProjectionLayer(T),n=g.createFramebuffer(),t.updateRenderState({layers:[l]})}A=yield t.requestReferenceSpace(s),J.setContext(t),J.start(),I.isPresenting=!0,I.dispatchEvent({type:"sessionstart"})}})};function X(H){const N=t.inputSources;for(let v=0;v<c.length;v++)d.set(N[v],c[v]);for(let v=0;v<H.removed.length;v++){const T=H.removed[v],D=d.get(T);D&&(D.dispatchEvent({type:"disconnected",data:T}),d.delete(T))}for(let v=0;v<H.added.length;v++){const T=H.added[v],D=d.get(T);D&&D.dispatchEvent({type:"connected",data:T})}}const W=new S,y=new S;function Y(H,N,v){W.setFromMatrixPosition(N.matrixWorld),y.setFromMatrixPosition(v.matrixWorld);const T=W.distanceTo(y),D=N.projectionMatrix.elements,$=v.projectionMatrix.elements,M=D[14]/(D[10]-1),_=D[14]/(D[10]+1),x=(D[9]+1)/D[5],z=(D[9]-1)/D[5],F=(D[8]-1)/D[0],k=($[8]+1)/$[0],rV=M*F,nV=M*k,j=T/(-F+k),VV=j*-F;N.matrixWorld.decompose(H.position,H.quaternion,H.scale),H.translateX(VV),H.translateZ(j),H.matrixWorld.compose(H.position,H.quaternion,H.scale),H.matrixWorldInverse.copy(H.matrixWorld).invert();const lV=M+j,iV=_+j,CV=rV-VV,AV=nV+(T-VV),gV=x*_/iV*lV,eV=z*_/iV*lV;H.projectionMatrix.makePerspective(CV,AV,gV,eV,lV,iV)}function f(H,N){N===null?H.matrixWorld.copy(H.matrix):H.matrixWorld.multiplyMatrices(N.matrixWorld,H.matrix),H.matrixWorldInverse.copy(H.matrixWorld).invert()}this.updateCamera=function(H){if(t===null)return;u.near=m.near=h.near=H.near,u.far=m.far=h.far=H.far,(b!==u.near||Z!==u.far)&&(t.updateRenderState({depthNear:u.near,depthFar:u.far}),b=u.near,Z=u.far);const N=H.parent,v=u.cameras;f(u,N);for(let D=0;D<v.length;D++)f(v[D],N);u.matrixWorld.decompose(u.position,u.quaternion,u.scale),H.position.copy(u.position),H.quaternion.copy(u.quaternion),H.scale.copy(u.scale),H.matrix.copy(u.matrix),H.matrixWorld.copy(u.matrixWorld);const T=H.children;for(let D=0,$=T.length;D<$;D++)T[D].updateMatrixWorld(!0);v.length===2?Y(u,h,m):u.projectionMatrix.copy(h.projectionMatrix)},this.getCamera=function(){return u};let L=null;function R(H,N){if(a=N.getViewerPose(A),a!==null){const T=a.views,D=t.renderState.baseLayer;t.renderState.layers===void 0&&e.bindXRFramebuffer(D.framebuffer);let $=!1;T.length!==u.cameras.length&&(u.cameras.length=0,$=!0);for(let M=0;M<T.length;M++){const _=T[M];let x=null;if(t.renderState.layers===void 0)x=D.getViewport(_);else{const F=o.getViewSubImage(l,_);e.bindXRFramebuffer(n),g.framebufferTexture2D(36160,36064,3553,F.colorTexture,0),F.depthStencilTexture!==void 0&&g.framebufferTexture2D(36160,36096,3553,F.depthStencilTexture,0),x=F.viewport}const z=r[M];z.matrix.fromArray(_.transform.matrix),z.projectionMatrix.fromArray(_.projectionMatrix),z.viewport.set(x.x,x.y,x.width,x.height),M===0&&u.matrix.copy(z.matrix),$===!0&&u.cameras.push(z)}}const v=t.inputSources;for(let T=0;T<c.length;T++){const D=c[T],$=v[T];D.update($,N,A)}L&&L(H,N)}const J=new gd;J.setAnimationLoop(R),this.setAnimationLoop=function(H){L=H},this.dispose=function(){}}}function Zq(i){function V(r,u){r.fogColor.value.copy(u.color),u.isFog?(r.fogNear.value=u.near,r.fogFar.value=u.far):u.isFogExp2&&(r.fogDensity.value=u.density)}function g(r,u,b,Z,p){u.isMeshBasicMaterial?I(r,u):u.isMeshLambertMaterial?(I(r,u),s(r,u)):u.isMeshToonMaterial?(I(r,u),o(r,u)):u.isMeshPhongMaterial?(I(r,u),a(r,u)):u.isMeshStandardMaterial?(I(r,u),u.isMeshPhysicalMaterial?l(r,u,p):n(r,u)):u.isMeshMatcapMaterial?(I(r,u),c(r,u)):u.isMeshDepthMaterial?(I(r,u),d(r,u)):u.isMeshDistanceMaterial?(I(r,u),h(r,u)):u.isMeshNormalMaterial?(I(r,u),m(r,u)):u.isLineBasicMaterial?(e(r,u),u.isLineDashedMaterial&&t(r,u)):u.isPointsMaterial?C(r,u,b,Z):u.isSpriteMaterial?A(r,u):u.isShadowMaterial?(r.color.value.copy(u.color),r.opacity.value=u.opacity):u.isShaderMaterial&&(u.uniformsNeedUpdate=!1)}function I(r,u){r.opacity.value=u.opacity,u.color&&r.diffuse.value.copy(u.color),u.emissive&&r.emissive.value.copy(u.emissive).multiplyScalar(u.emissiveIntensity),u.map&&(r.map.value=u.map),u.alphaMap&&(r.alphaMap.value=u.alphaMap),u.specularMap&&(r.specularMap.value=u.specularMap);const b=i.get(u).envMap;if(b){r.envMap.value=b,r.flipEnvMap.value=b.isCubeTexture&&b._needsFlipEnvMap?-1:1,r.reflectivity.value=u.reflectivity,r.refractionRatio.value=u.refractionRatio;const G=i.get(b).__maxMipLevel;G!==void 0&&(r.maxMipLevel.value=G)}u.lightMap&&(r.lightMap.value=u.lightMap,r.lightMapIntensity.value=u.lightMapIntensity),u.aoMap&&(r.aoMap.value=u.aoMap,r.aoMapIntensity.value=u.aoMapIntensity);let Z;u.map?Z=u.map:u.specularMap?Z=u.specularMap:u.displacementMap?Z=u.displacementMap:u.normalMap?Z=u.normalMap:u.bumpMap?Z=u.bumpMap:u.roughnessMap?Z=u.roughnessMap:u.metalnessMap?Z=u.metalnessMap:u.alphaMap?Z=u.alphaMap:u.emissiveMap?Z=u.emissiveMap:u.clearcoatMap?Z=u.clearcoatMap:u.clearcoatNormalMap?Z=u.clearcoatNormalMap:u.clearcoatRoughnessMap&&(Z=u.clearcoatRoughnessMap),Z!==void 0&&(Z.isWebGLRenderTarget&&(Z=Z.texture),Z.matrixAutoUpdate===!0&&Z.updateMatrix(),r.uvTransform.value.copy(Z.matrix));let p;u.aoMap?p=u.aoMap:u.lightMap&&(p=u.lightMap),p!==void 0&&(p.isWebGLRenderTarget&&(p=p.texture),p.matrixAutoUpdate===!0&&p.updateMatrix(),r.uv2Transform.value.copy(p.matrix))}function e(r,u){r.diffuse.value.copy(u.color),r.opacity.value=u.opacity}function t(r,u){r.dashSize.value=u.dashSize,r.totalSize.value=u.dashSize+u.gapSize,r.scale.value=u.scale}function C(r,u,b,Z){r.diffuse.value.copy(u.color),r.opacity.value=u.opacity,r.size.value=u.size*b,r.scale.value=Z*.5,u.map&&(r.map.value=u.map),u.alphaMap&&(r.alphaMap.value=u.alphaMap);let p;u.map?p=u.map:u.alphaMap&&(p=u.alphaMap),p!==void 0&&(p.matrixAutoUpdate===!0&&p.updateMatrix(),r.uvTransform.value.copy(p.matrix))}function A(r,u){r.diffuse.value.copy(u.color),r.opacity.value=u.opacity,r.rotation.value=u.rotation,u.map&&(r.map.value=u.map),u.alphaMap&&(r.alphaMap.value=u.alphaMap);let b;u.map?b=u.map:u.alphaMap&&(b=u.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),r.uvTransform.value.copy(b.matrix))}function s(r,u){u.emissiveMap&&(r.emissiveMap.value=u.emissiveMap)}function a(r,u){r.specular.value.copy(u.specular),r.shininess.value=Math.max(u.shininess,1e-4),u.emissiveMap&&(r.emissiveMap.value=u.emissiveMap),u.bumpMap&&(r.bumpMap.value=u.bumpMap,r.bumpScale.value=u.bumpScale,u.side===wg&&(r.bumpScale.value*=-1)),u.normalMap&&(r.normalMap.value=u.normalMap,r.normalScale.value.copy(u.normalScale),u.side===wg&&r.normalScale.value.negate()),u.displacementMap&&(r.displacementMap.value=u.displacementMap,r.displacementScale.value=u.displacementScale,r.displacementBias.value=u.displacementBias)}function o(r,u){u.gradientMap&&(r.gradientMap.value=u.gradientMap),u.emissiveMap&&(r.emissiveMap.value=u.emissiveMap),u.bumpMap&&(r.bumpMap.value=u.bumpMap,r.bumpScale.value=u.bumpScale,u.side===wg&&(r.bumpScale.value*=-1)),u.normalMap&&(r.normalMap.value=u.normalMap,r.normalScale.value.copy(u.normalScale),u.side===wg&&r.normalScale.value.negate()),u.displacementMap&&(r.displacementMap.value=u.displacementMap,r.displacementScale.value=u.displacementScale,r.displacementBias.value=u.displacementBias)}function n(r,u){r.roughness.value=u.roughness,r.metalness.value=u.metalness,u.roughnessMap&&(r.roughnessMap.value=u.roughnessMap),u.metalnessMap&&(r.metalnessMap.value=u.metalnessMap),u.emissiveMap&&(r.emissiveMap.value=u.emissiveMap),u.bumpMap&&(r.bumpMap.value=u.bumpMap,r.bumpScale.value=u.bumpScale,u.side===wg&&(r.bumpScale.value*=-1)),u.normalMap&&(r.normalMap.value=u.normalMap,r.normalScale.value.copy(u.normalScale),u.side===wg&&r.normalScale.value.negate()),u.displacementMap&&(r.displacementMap.value=u.displacementMap,r.displacementScale.value=u.displacementScale,r.displacementBias.value=u.displacementBias),i.get(u).envMap&&(r.envMapIntensity.value=u.envMapIntensity)}function l(r,u,b){n(r,u),r.reflectivity.value=u.reflectivity,r.clearcoat.value=u.clearcoat,r.clearcoatRoughness.value=u.clearcoatRoughness,u.sheen&&r.sheen.value.copy(u.sheen),u.clearcoatMap&&(r.clearcoatMap.value=u.clearcoatMap),u.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap.value=u.clearcoatRoughnessMap),u.clearcoatNormalMap&&(r.clearcoatNormalScale.value.copy(u.clearcoatNormalScale),r.clearcoatNormalMap.value=u.clearcoatNormalMap,u.side===wg&&r.clearcoatNormalScale.value.negate()),r.transmission.value=u.transmission,u.transmissionMap&&(r.transmissionMap.value=u.transmissionMap),u.transmission>0&&(r.transmissionSamplerMap.value=b.texture,r.transmissionSamplerSize.value.set(b.width,b.height)),r.thickness.value=u.thickness,u.thicknessMap&&(r.thicknessMap.value=u.thicknessMap),r.attenuationDistance.value=u.attenuationDistance,r.attenuationColor.value.copy(u.attenuationColor)}function c(r,u){u.matcap&&(r.matcap.value=u.matcap),u.bumpMap&&(r.bumpMap.value=u.bumpMap,r.bumpScale.value=u.bumpScale,u.side===wg&&(r.bumpScale.value*=-1)),u.normalMap&&(r.normalMap.value=u.normalMap,r.normalScale.value.copy(u.normalScale),u.side===wg&&r.normalScale.value.negate()),u.displacementMap&&(r.displacementMap.value=u.displacementMap,r.displacementScale.value=u.displacementScale,r.displacementBias.value=u.displacementBias)}function d(r,u){u.displacementMap&&(r.displacementMap.value=u.displacementMap,r.displacementScale.value=u.displacementScale,r.displacementBias.value=u.displacementBias)}function h(r,u){u.displacementMap&&(r.displacementMap.value=u.displacementMap,r.displacementScale.value=u.displacementScale,r.displacementBias.value=u.displacementBias),r.referencePosition.value.copy(u.referencePosition),r.nearDistance.value=u.nearDistance,r.farDistance.value=u.farDistance}function m(r,u){u.bumpMap&&(r.bumpMap.value=u.bumpMap,r.bumpScale.value=u.bumpScale,u.side===wg&&(r.bumpScale.value*=-1)),u.normalMap&&(r.normalMap.value=u.normalMap,r.normalScale.value.copy(u.normalScale),u.side===wg&&r.normalScale.value.negate()),u.displacementMap&&(r.displacementMap.value=u.displacementMap,r.displacementScale.value=u.displacementScale,r.displacementBias.value=u.displacementBias)}return{refreshFogUniforms:V,refreshMaterialUniforms:g}}function Gq(){const i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.style.display="block",i}function ig(i={}){const V=i.canvas!==void 0?i.canvas:Gq(),g=i.context!==void 0?i.context:null,I=i.alpha!==void 0?i.alpha:!1,e=i.depth!==void 0?i.depth:!0,t=i.stencil!==void 0?i.stencil:!0,C=i.antialias!==void 0?i.antialias:!1,A=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,s=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,a=i.powerPreference!==void 0?i.powerPreference:"default",o=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let n=null,l=null;const c=[],d=[];this.domElement=V,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=vi,this.physicallyCorrectLights=!1,this.toneMapping=nC,this.toneMappingExposure=1;const h=this;let m=!1,r=0,u=0,b=null,Z=-1,p=null;const G=new eg,X=new eg;let W=null,y=V.width,Y=V.height,f=1,L=null,R=null;const J=new eg(0,0,y,Y),H=new eg(0,0,y,Y);let N=!1;const v=[],T=new Ki;let D=!1,$=!1,M=null;const _=new JV,x=new S,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function F(){return b===null?f:1}let k=g;function rV(B,O){for(let U=0;U<B.length;U++){const Q=B[U],IV=V.getContext(Q,O);if(IV!==null)return IV}return null}try{const B={alpha:I,depth:e,stencil:t,antialias:C,premultipliedAlpha:A,preserveDrawingBuffer:s,powerPreference:a,failIfMajorPerformanceCaveat:o};if(V.addEventListener("webglcontextlost",OV,!1),V.addEventListener("webglcontextrestored",tg,!1),k===null){const O=["webgl2","webgl","experimental-webgl"];if(h.isWebGL1Renderer===!0&&O.shift(),k=rV(O,B),k===null)throw rV(O)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}k.getShaderPrecisionFormat===void 0&&(k.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(B){throw console.error("THREE.WebGLRenderer: "+B.message),B}let nV,j,VV,lV,iV,CV,AV,gV,eV,K,w,sV,tV,BV,yV,wV,fV,vV,YV,E,WV,bV;function MV(){nV=new L0(k),j=new k0(k,nV,i),nV.init(j),WV=new mq(k,nV,j),VV=new rq(k,nV,j),v[0]=1029,lV=new E0(k),iV=new tq,CV=new hq(k,nV,VV,iV,j,WV,lV),AV=new T0(h),gV=new hZ(k,j),bV=new M0(k,nV,gV,j),eV=new U0(k,gV,lV,bV),K=new O0(k,eV,gV,lV),vV=new P0(k),yV=new z0(iV),w=new eq(h,AV,nV,j,bV,yV),sV=new Zq(iV),tV=new iq(iV),BV=new oq(nV,j),fV=new J0(h,AV,VV,K,A),wV=new cd(h,K,j),YV=new x0(k,nV,lV,j),E=new D0(k,nV,lV,j),lV.programs=w.programs,h.capabilities=j,h.extensions=nV,h.properties=iV,h.renderLists=tV,h.shadowMap=wV,h.state=VV,h.info=lV}MV();const HV=new bq(h,k);this.xr=HV,this.getContext=function(){return k},this.getContextAttributes=function(){return k.getContextAttributes()},this.forceContextLoss=function(){const B=nV.get("WEBGL_lose_context");B&&B.loseContext()},this.forceContextRestore=function(){const B=nV.get("WEBGL_lose_context");B&&B.restoreContext()},this.getPixelRatio=function(){return f},this.setPixelRatio=function(B){B!==void 0&&(f=B,this.setSize(y,Y,!1))},this.getSize=function(B){return B.set(y,Y)},this.setSize=function(B,O,U){if(HV.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}y=B,Y=O,V.width=Math.floor(B*f),V.height=Math.floor(O*f),U!==!1&&(V.style.width=B+"px",V.style.height=O+"px"),this.setViewport(0,0,B,O)},this.getDrawingBufferSize=function(B){return B.set(y*f,Y*f).floor()},this.setDrawingBufferSize=function(B,O,U){y=B,Y=O,f=U,V.width=Math.floor(B*U),V.height=Math.floor(O*U),this.setViewport(0,0,B,O)},this.getCurrentViewport=function(B){return B.copy(G)},this.getViewport=function(B){return B.copy(J)},this.setViewport=function(B,O,U,Q){B.isVector4?J.set(B.x,B.y,B.z,B.w):J.set(B,O,U,Q),VV.viewport(G.copy(J).multiplyScalar(f).floor())},this.getScissor=function(B){return B.copy(H)},this.setScissor=function(B,O,U,Q){B.isVector4?H.set(B.x,B.y,B.z,B.w):H.set(B,O,U,Q),VV.scissor(X.copy(H).multiplyScalar(f).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(B){VV.setScissorTest(N=B)},this.setOpaqueSort=function(B){L=B},this.setTransparentSort=function(B){R=B},this.getClearColor=function(B){return B.copy(fV.getClearColor())},this.setClearColor=function(){fV.setClearColor.apply(fV,arguments)},this.getClearAlpha=function(){return fV.getClearAlpha()},this.setClearAlpha=function(){fV.setClearAlpha.apply(fV,arguments)},this.clear=function(B,O,U){let Q=0;(B===void 0||B)&&(Q|=16384),(O===void 0||O)&&(Q|=256),(U===void 0||U)&&(Q|=1024),k.clear(Q)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){V.removeEventListener("webglcontextlost",OV,!1),V.removeEventListener("webglcontextrestored",tg,!1),tV.dispose(),BV.dispose(),iV.dispose(),AV.dispose(),K.dispose(),bV.dispose(),HV.dispose(),HV.removeEventListener("sessionstart",rI),HV.removeEventListener("sessionend",iI),M&&(M.dispose(),M=null),ug.stop()};function OV(B){B.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function tg(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;const B=lV.autoReset,O=wV.enabled,U=wV.autoUpdate,Q=wV.needsUpdate,IV=wV.type;MV(),lV.autoReset=B,wV.enabled=O,wV.autoUpdate=U,wV.needsUpdate=Q,wV.type=IV}function Cg(B){const O=B.target;O.removeEventListener("dispose",Cg),gI(O)}function gI(B){Vg(B),iV.remove(B)}function Vg(B){const O=iV.get(B).programs;O!==void 0&&O.forEach(function(U){w.releaseProgram(U)})}function Yg(B,O){B.render(function(U){h.renderBufferImmediate(U,O)})}this.renderBufferImmediate=function(B,O){bV.initAttributes();const U=iV.get(B);B.hasPositions&&!U.position&&(U.position=k.createBuffer()),B.hasNormals&&!U.normal&&(U.normal=k.createBuffer()),B.hasUvs&&!U.uv&&(U.uv=k.createBuffer()),B.hasColors&&!U.color&&(U.color=k.createBuffer());const Q=O.getAttributes();B.hasPositions&&(k.bindBuffer(34962,U.position),k.bufferData(34962,B.positionArray,35048),bV.enableAttribute(Q.position),k.vertexAttribPointer(Q.position,3,5126,!1,0,0)),B.hasNormals&&(k.bindBuffer(34962,U.normal),k.bufferData(34962,B.normalArray,35048),bV.enableAttribute(Q.normal),k.vertexAttribPointer(Q.normal,3,5126,!1,0,0)),B.hasUvs&&(k.bindBuffer(34962,U.uv),k.bufferData(34962,B.uvArray,35048),bV.enableAttribute(Q.uv),k.vertexAttribPointer(Q.uv,2,5126,!1,0,0)),B.hasColors&&(k.bindBuffer(34962,U.color),k.bufferData(34962,B.colorArray,35048),bV.enableAttribute(Q.color),k.vertexAttribPointer(Q.color,3,5126,!1,0,0)),bV.disableUnusedAttributes(),k.drawArrays(4,0,B.count),B.count=0},this.renderBufferDirect=function(B,O,U,Q,IV,P){O===null&&(O=z);const hV=IV.isMesh&&IV.matrixWorld.determinant()<0,cV=oV(B,O,Q,IV);VV.setMaterial(Q,hV);let pV=U.index;const aV=U.attributes.position;if(pV===null){if(aV===void 0||aV.count===0)return}else if(pV.count===0)return;let uV=1;Q.wireframe===!0&&(pV=eV.getWireframeAttribute(U),uV=2),(Q.morphTargets||Q.morphNormals)&&vV.update(IV,U,Q,cV),bV.setup(IV,Q,cV,U,pV);let mV,RV=YV;pV!==null&&(mV=gV.get(pV),RV=E,RV.setIndex(mV));const kV=pV!==null?pV.count:aV.count,GV=U.drawRange.start*uV,DV=U.drawRange.count*uV,KV=P!==null?P.start*uV:0,gg=P!==null?P.count*uV:1/0,zV=Math.max(GV,KV),jV=Math.min(kV,GV+DV,KV+gg)-1,xV=Math.max(0,jV-zV+1);if(xV!==0){if(IV.isMesh)Q.wireframe===!0?(VV.setLineWidth(Q.wireframeLinewidth*F()),RV.setMode(1)):RV.setMode(4);else if(IV.isLine){let Fg=Q.linewidth;Fg===void 0&&(Fg=1),VV.setLineWidth(Fg*F()),IV.isLineSegments?RV.setMode(1):IV.isLineLoop?RV.setMode(2):RV.setMode(3)}else IV.isPoints?RV.setMode(0):IV.isSprite&&RV.setMode(4);if(IV.isInstancedMesh)RV.renderInstances(zV,xV,IV.count);else if(U.isInstancedBufferGeometry){const Fg=Math.min(U.instanceCount,U._maxInstanceCount);RV.renderInstances(zV,xV,Fg)}else RV.render(zV,xV)}},this.compile=function(B,O){l=BV.get(B),l.init(),B.traverseVisible(function(U){U.isLight&&U.layers.test(O.layers)&&(l.pushLight(U),U.castShadow&&l.pushShadow(U))}),l.setupLights(),B.traverse(function(U){const Q=U.material;if(Q)if(Array.isArray(Q))for(let IV=0;IV<Q.length;IV++){const P=Q[IV];jI(P,B,U)}else jI(Q,B,U)})};let mg=null;function II(B){mg&&mg(B)}function rI(){ug.stop()}function iI(){ug.start()}const ug=new gd;ug.setAnimationLoop(II),typeof window!="undefined"&&ug.setContext(window),this.setAnimationLoop=function(B){mg=B,HV.setAnimationLoop(B),B===null?ug.stop():ug.start()},HV.addEventListener("sessionstart",rI),HV.addEventListener("sessionend",iI),this.render=function(B,O){if(O!==void 0&&O.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;B.autoUpdate===!0&&B.updateMatrixWorld(),O.parent===null&&O.updateMatrixWorld(),HV.enabled===!0&&HV.isPresenting===!0&&(HV.cameraAutoUpdate===!0&&HV.updateCamera(O),O=HV.getCamera()),B.isScene===!0&&B.onBeforeRender(h,B,O,b),l=BV.get(B,d.length),l.init(),d.push(l),_.multiplyMatrices(O.projectionMatrix,O.matrixWorldInverse),T.setFromProjectionMatrix(_),$=this.localClippingEnabled,D=yV.init(this.clippingPlanes,$,O),n=tV.get(B,c.length),n.init(),c.push(n),QI(B,O,0,h.sortObjects),n.finish(),h.sortObjects===!0&&n.sort(L,R),D===!0&&yV.beginShadows();const U=l.state.shadowsArray;wV.render(U,B,O),l.setupLights(),l.setupLightsView(O),D===!0&&yV.endShadows(),this.info.autoReset===!0&&this.info.reset(),fV.render(n,B);const Q=n.opaque,IV=n.transmissive,P=n.transparent;Q.length>0&&RI(Q,B,O),IV.length>0&&ie(Q,IV,B,O),P.length>0&&RI(P,B,O),b!==null&&(CV.updateMultisampleRenderTarget(b),CV.updateRenderTargetMipmap(b)),B.isScene===!0&&B.onAfterRender(h,B,O),VV.buffers.depth.setTest(!0),VV.buffers.depth.setMask(!0),VV.buffers.color.setMask(!0),VV.setPolygonOffset(!1),bV.resetDefaultState(),Z=-1,p=null,d.pop(),d.length>0?l=d[d.length-1]:l=null,c.pop(),c.length>0?n=c[c.length-1]:n=null};function QI(B,O,U,Q){if(B.visible===!1)return;if(B.layers.test(O.layers)){if(B.isGroup)U=B.renderOrder;else if(B.isLOD)B.autoUpdate===!0&&B.update(O);else if(B.isLight)l.pushLight(B),B.castShadow&&l.pushShadow(B);else if(B.isSprite){if(!B.frustumCulled||T.intersectsSprite(B)){Q&&x.setFromMatrixPosition(B.matrixWorld).applyMatrix4(_);const hV=K.update(B),cV=B.material;cV.visible&&n.push(B,hV,cV,U,x.z,null)}}else if(B.isImmediateRenderObject)Q&&x.setFromMatrixPosition(B.matrixWorld).applyMatrix4(_),n.push(B,null,B.material,U,x.z,null);else if((B.isMesh||B.isLine||B.isPoints)&&(B.isSkinnedMesh&&B.skeleton.frame!==lV.render.frame&&(B.skeleton.update(),B.skeleton.frame=lV.render.frame),!B.frustumCulled||T.intersectsObject(B))){Q&&x.setFromMatrixPosition(B.matrixWorld).applyMatrix4(_);const hV=K.update(B),cV=B.material;if(Array.isArray(cV)){const pV=hV.groups;for(let aV=0,uV=pV.length;aV<uV;aV++){const mV=pV[aV],RV=cV[mV.materialIndex];RV&&RV.visible&&n.push(B,hV,RV,U,x.z,mV)}}else cV.visible&&n.push(B,hV,cV,U,x.z,null)}}const P=B.children;for(let hV=0,cV=P.length;hV<cV;hV++)QI(P[hV],O,U,Q)}function ie(B,O,U,Q){if(M===null){const cV=C===!0&&j.isWebGL2===!0?Qc:Ie;M=new cV(1024,1024,{generateMipmaps:!0,type:WV.convert(sC)!==null?sC:SA,minFilter:XC,magFilter:Lg,wrapS:lI,wrapT:lI})}const IV=h.getRenderTarget();h.setRenderTarget(M),h.clear();const P=h.toneMapping;h.toneMapping=nC,RI(B,U,Q),h.toneMapping=P,CV.updateMultisampleRenderTarget(M),CV.updateRenderTargetMipmap(M),h.setRenderTarget(IV),RI(O,U,Q)}function RI(B,O,U){const Q=O.isScene===!0?O.overrideMaterial:null;for(let IV=0,P=B.length;IV<P;IV++){const hV=B[IV],cV=hV.object,pV=hV.geometry,aV=Q===null?hV.material:Q,uV=hV.group;if(U.isArrayCamera){const mV=U.cameras;for(let RV=0,kV=mV.length;RV<kV;RV++){const GV=mV[RV];cV.layers.test(GV.layers)&&(VV.viewport(G.copy(GV.viewport)),l.setupLightsView(GV),Ae(cV,O,GV,pV,aV,uV))}}else Ae(cV,O,U,pV,aV,uV)}}function Ae(B,O,U,Q,IV,P){if(B.onBeforeRender(h,O,U,Q,IV,P),B.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,B.matrixWorld),B.normalMatrix.getNormalMatrix(B.modelViewMatrix),B.isImmediateRenderObject){const hV=oV(U,O,IV,B);VV.setMaterial(IV),bV.reset(),Yg(B,hV)}else IV.transparent===!0&&IV.side===yt?(IV.side=wg,IV.needsUpdate=!0,h.renderBufferDirect(U,O,Q,IV,B,P),IV.side=rC,IV.needsUpdate=!0,h.renderBufferDirect(U,O,Q,IV,B,P),IV.side=yt):h.renderBufferDirect(U,O,Q,IV,B,P);B.onAfterRender(h,O,U,Q,IV,P)}function jI(B,O,U){O.isScene!==!0&&(O=z);const Q=iV.get(B),IV=l.state.lights,P=l.state.shadowsArray,hV=IV.state.version,cV=w.getParameters(B,IV.state,P,O,U),pV=w.getProgramCacheKey(cV);let aV=Q.programs;Q.environment=B.isMeshStandardMaterial?O.environment:null,Q.fog=O.fog,Q.envMap=AV.get(B.envMap||Q.environment),aV===void 0&&(B.addEventListener("dispose",Cg),aV=new Map,Q.programs=aV);let uV=aV.get(pV);if(uV!==void 0){if(Q.currentProgram===uV&&Q.lightsStateVersion===hV)return Bg(B,cV),uV}else cV.uniforms=w.getUniforms(B),B.onBuild(cV,h),B.onBeforeCompile(cV,h),uV=w.acquireProgram(cV,pV),aV.set(pV,uV),Q.uniforms=cV.uniforms;const mV=Q.uniforms;(!B.isShaderMaterial&&!B.isRawShaderMaterial||B.clipping===!0)&&(mV.clippingPlanes=yV.uniform),Bg(B,cV),Q.needsLights=qV(B),Q.lightsStateVersion=hV,Q.needsLights&&(mV.ambientLightColor.value=IV.state.ambient,mV.lightProbe.value=IV.state.probe,mV.directionalLights.value=IV.state.directional,mV.directionalLightShadows.value=IV.state.directionalShadow,mV.spotLights.value=IV.state.spot,mV.spotLightShadows.value=IV.state.spotShadow,mV.rectAreaLights.value=IV.state.rectArea,mV.ltc_1.value=IV.state.rectAreaLTC1,mV.ltc_2.value=IV.state.rectAreaLTC2,mV.pointLights.value=IV.state.point,mV.pointLightShadows.value=IV.state.pointShadow,mV.hemisphereLights.value=IV.state.hemi,mV.directionalShadowMap.value=IV.state.directionalShadowMap,mV.directionalShadowMatrix.value=IV.state.directionalShadowMatrix,mV.spotShadowMap.value=IV.state.spotShadowMap,mV.spotShadowMatrix.value=IV.state.spotShadowMatrix,mV.pointShadowMap.value=IV.state.pointShadowMap,mV.pointShadowMatrix.value=IV.state.pointShadowMatrix);const RV=uV.getUniforms(),kV=Pe.seqWithValue(RV.seq,mV);return Q.currentProgram=uV,Q.uniformsList=kV,uV}function Bg(B,O){const U=iV.get(B);U.outputEncoding=O.outputEncoding,U.instancing=O.instancing,U.skinning=O.skinning,U.numClippingPlanes=O.numClippingPlanes,U.numIntersection=O.numClipIntersection,U.vertexAlphas=O.vertexAlphas}function oV(B,O,U,Q){O.isScene!==!0&&(O=z),CV.resetTextureUnits();const IV=O.fog,P=U.isMeshStandardMaterial?O.environment:null,hV=b===null?h.outputEncoding:b.texture.encoding,cV=AV.get(U.envMap||P),pV=U.vertexColors===!0&&Q.geometry&&Q.geometry.attributes.color&&Q.geometry.attributes.color.itemSize===4,aV=iV.get(U),uV=l.state.lights;if(D===!0&&($===!0||B!==p)){const zV=B===p&&U.id===Z;yV.setState(U,B,zV)}let mV=!1;U.version===aV.__version?(aV.needsLights&&aV.lightsStateVersion!==uV.state.version||aV.outputEncoding!==hV||Q.isInstancedMesh&&aV.instancing===!1||!Q.isInstancedMesh&&aV.instancing===!0||Q.isSkinnedMesh&&aV.skinning===!1||!Q.isSkinnedMesh&&aV.skinning===!0||aV.envMap!==cV||U.fog&&aV.fog!==IV||aV.numClippingPlanes!==void 0&&(aV.numClippingPlanes!==yV.numPlanes||aV.numIntersection!==yV.numIntersection)||aV.vertexAlphas!==pV)&&(mV=!0):(mV=!0,aV.__version=U.version);let RV=aV.currentProgram;mV===!0&&(RV=jI(U,O,Q));let kV=!1,GV=!1,DV=!1;const KV=RV.getUniforms(),gg=aV.uniforms;if(VV.useProgram(RV.program)&&(kV=!0,GV=!0,DV=!0),U.id!==Z&&(Z=U.id,GV=!0),kV||p!==B){if(KV.setValue(k,"projectionMatrix",B.projectionMatrix),j.logarithmicDepthBuffer&&KV.setValue(k,"logDepthBufFC",2/(Math.log(B.far+1)/Math.LN2)),p!==B&&(p=B,GV=!0,DV=!0),U.isShaderMaterial||U.isMeshPhongMaterial||U.isMeshToonMaterial||U.isMeshStandardMaterial||U.envMap){const zV=KV.map.cameraPosition;zV!==void 0&&zV.setValue(k,x.setFromMatrixPosition(B.matrixWorld))}(U.isMeshPhongMaterial||U.isMeshToonMaterial||U.isMeshLambertMaterial||U.isMeshBasicMaterial||U.isMeshStandardMaterial||U.isShaderMaterial)&&KV.setValue(k,"isOrthographic",B.isOrthographicCamera===!0),(U.isMeshPhongMaterial||U.isMeshToonMaterial||U.isMeshLambertMaterial||U.isMeshBasicMaterial||U.isMeshStandardMaterial||U.isShaderMaterial||U.isShadowMaterial||Q.isSkinnedMesh)&&KV.setValue(k,"viewMatrix",B.matrixWorldInverse)}if(Q.isSkinnedMesh){KV.setOptional(k,Q,"bindMatrix"),KV.setOptional(k,Q,"bindMatrixInverse");const zV=Q.skeleton;zV&&(j.floatVertexTextures?(zV.boneTexture===null&&zV.computeBoneTexture(),KV.setValue(k,"boneTexture",zV.boneTexture,CV),KV.setValue(k,"boneTextureSize",zV.boneTextureSize)):KV.setOptional(k,zV,"boneMatrices"))}return(GV||aV.receiveShadow!==Q.receiveShadow)&&(aV.receiveShadow=Q.receiveShadow,KV.setValue(k,"receiveShadow",Q.receiveShadow)),GV&&(KV.setValue(k,"toneMappingExposure",h.toneMappingExposure),aV.needsLights&&ZV(gg,DV),IV&&U.fog&&sV.refreshFogUniforms(gg,IV),sV.refreshMaterialUniforms(gg,U,f,Y,M),Pe.upload(k,aV.uniformsList,gg,CV)),U.isShaderMaterial&&U.uniformsNeedUpdate===!0&&(Pe.upload(k,aV.uniformsList,gg,CV),U.uniformsNeedUpdate=!1),U.isSpriteMaterial&&KV.setValue(k,"center",Q.center),KV.setValue(k,"modelViewMatrix",Q.modelViewMatrix),KV.setValue(k,"normalMatrix",Q.normalMatrix),KV.setValue(k,"modelMatrix",Q.matrixWorld),RV}function ZV(B,O){B.ambientLightColor.needsUpdate=O,B.lightProbe.needsUpdate=O,B.directionalLights.needsUpdate=O,B.directionalLightShadows.needsUpdate=O,B.pointLights.needsUpdate=O,B.pointLightShadows.needsUpdate=O,B.spotLights.needsUpdate=O,B.spotLightShadows.needsUpdate=O,B.rectAreaLights.needsUpdate=O,B.hemisphereLights.needsUpdate=O}function qV(B){return B.isMeshLambertMaterial||B.isMeshToonMaterial||B.isMeshPhongMaterial||B.isMeshStandardMaterial||B.isShadowMaterial||B.isShaderMaterial&&B.lights===!0}this.getActiveCubeFace=function(){return r},this.getActiveMipmapLevel=function(){return u},this.getRenderTarget=function(){return b},this.setRenderTarget=function(B,O=0,U=0){b=B,r=O,u=U,B&&iV.get(B).__webglFramebuffer===void 0&&CV.setupRenderTarget(B);let Q=null,IV=!1,P=!1;if(B){const cV=B.texture;(cV.isDataTexture3D||cV.isDataTexture2DArray)&&(P=!0);const pV=iV.get(B).__webglFramebuffer;B.isWebGLCubeRenderTarget?(Q=pV[O],IV=!0):B.isWebGLMultisampleRenderTarget?Q=iV.get(B).__webglMultisampledFramebuffer:Q=pV,G.copy(B.viewport),X.copy(B.scissor),W=B.scissorTest}else G.copy(J).multiplyScalar(f).floor(),X.copy(H).multiplyScalar(f).floor(),W=N;if(VV.bindFramebuffer(36160,Q)&&j.drawBuffers){let cV=!1;if(B)if(B.isWebGLMultipleRenderTargets){const pV=B.texture;if(v.length!==pV.length||v[0]!==36064){for(let aV=0,uV=pV.length;aV<uV;aV++)v[aV]=36064+aV;v.length=pV.length,cV=!0}}else(v.length!==1||v[0]!==36064)&&(v[0]=36064,v.length=1,cV=!0);else(v.length!==1||v[0]!==1029)&&(v[0]=1029,v.length=1,cV=!0);cV&&(j.isWebGL2?k.drawBuffers(v):nV.get("WEBGL_draw_buffers").drawBuffersWEBGL(v))}if(VV.viewport(G),VV.scissor(X),VV.setScissorTest(W),IV){const cV=iV.get(B.texture);k.framebufferTexture2D(36160,36064,34069+O,cV.__webglTexture,U)}else if(P){const cV=iV.get(B.texture),pV=O||0;k.framebufferTextureLayer(36160,36064,cV.__webglTexture,U||0,pV)}},this.readRenderTargetPixels=function(B,O,U,Q,IV,P,hV){if(!(B&&B.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let cV=iV.get(B).__webglFramebuffer;if(B.isWebGLCubeRenderTarget&&hV!==void 0&&(cV=cV[hV]),cV){VV.bindFramebuffer(36160,cV);try{const pV=B.texture,aV=pV.format,uV=pV.type;if(aV!==NI&&WV.convert(aV)!==k.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const mV=uV===sC&&(nV.has("EXT_color_buffer_half_float")||j.isWebGL2&&nV.has("EXT_color_buffer_float"));if(uV!==SA&&WV.convert(uV)!==k.getParameter(35738)&&!(uV===ze&&(j.isWebGL2||nV.has("OES_texture_float")||nV.has("WEBGL_color_buffer_float")))&&!mV){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}k.checkFramebufferStatus(36160)===36053?O>=0&&O<=B.width-Q&&U>=0&&U<=B.height-IV&&k.readPixels(O,U,Q,IV,WV.convert(aV),WV.convert(uV),P):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const pV=b!==null?iV.get(b).__webglFramebuffer:null;VV.bindFramebuffer(36160,pV)}}},this.copyFramebufferToTexture=function(B,O,U=0){const Q=Math.pow(2,-U),IV=Math.floor(O.image.width*Q),P=Math.floor(O.image.height*Q);let hV=WV.convert(O.format);j.isWebGL2&&(hV===6407&&(hV=32849),hV===6408&&(hV=32856)),CV.setTexture2D(O,0),k.copyTexImage2D(3553,U,hV,B.x,B.y,IV,P,0),VV.unbindTexture()},this.copyTextureToTexture=function(B,O,U,Q=0){const IV=O.image.width,P=O.image.height,hV=WV.convert(U.format),cV=WV.convert(U.type);CV.setTexture2D(U,0),k.pixelStorei(37440,U.flipY),k.pixelStorei(37441,U.premultiplyAlpha),k.pixelStorei(3317,U.unpackAlignment),O.isDataTexture?k.texSubImage2D(3553,Q,B.x,B.y,IV,P,hV,cV,O.image.data):O.isCompressedTexture?k.compressedTexSubImage2D(3553,Q,B.x,B.y,O.mipmaps[0].width,O.mipmaps[0].height,hV,O.mipmaps[0].data):k.texSubImage2D(3553,Q,B.x,B.y,hV,cV,O.image),Q===0&&U.generateMipmaps&&k.generateMipmap(3553),VV.unbindTexture()},this.copyTextureToTexture3D=function(B,O,U,Q,IV=0){if(h.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const P=B.max.x-B.min.x+1,hV=B.max.y-B.min.y+1,cV=B.max.z-B.min.z+1,pV=WV.convert(Q.format),aV=WV.convert(Q.type);let uV;if(Q.isDataTexture3D)CV.setTexture3D(Q,0),uV=32879;else if(Q.isDataTexture2DArray)CV.setTexture2DArray(Q,0),uV=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}k.pixelStorei(37440,Q.flipY),k.pixelStorei(37441,Q.premultiplyAlpha),k.pixelStorei(3317,Q.unpackAlignment);const mV=k.getParameter(3314),RV=k.getParameter(32878),kV=k.getParameter(3316),GV=k.getParameter(3315),DV=k.getParameter(32877),KV=U.isCompressedTexture?U.mipmaps[0]:U.image;k.pixelStorei(3314,KV.width),k.pixelStorei(32878,KV.height),k.pixelStorei(3316,B.min.x),k.pixelStorei(3315,B.min.y),k.pixelStorei(32877,B.min.z),U.isDataTexture||U.isDataTexture3D?k.texSubImage3D(uV,IV,O.x,O.y,O.z,P,hV,cV,pV,aV,KV.data):U.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),k.compressedTexSubImage3D(uV,IV,O.x,O.y,O.z,P,hV,cV,pV,KV.data)):k.texSubImage3D(uV,IV,O.x,O.y,O.z,P,hV,cV,pV,aV,KV),k.pixelStorei(3314,mV),k.pixelStorei(32878,RV),k.pixelStorei(3316,kV),k.pixelStorei(3315,GV),k.pixelStorei(32877,DV),IV===0&&Q.generateMipmaps&&k.generateMipmap(uV),VV.unbindTexture()},this.initTexture=function(B){CV.setTexture2D(B,0),VV.unbindTexture()},this.resetState=function(){r=0,u=0,b=null,VV.reset(),bV.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class pq extends ig{}pq.prototype.isWebGL1Renderer=!0;class QA{constructor(V,g=25e-5){this.name="",this.color=new NV(V),this.density=g}clone(){return new QA(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}QA.prototype.isFogExp2=!0;class wC extends UV{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(V,g){return super.copy(V,g),V.background!==null&&(this.background=V.background.clone()),V.environment!==null&&(this.environment=V.environment.clone()),V.fog!==null&&(this.fog=V.fog.clone()),V.overrideMaterial!==null&&(this.overrideMaterial=V.overrideMaterial.clone()),this.autoUpdate=V.autoUpdate,this.matrixAutoUpdate=V.matrixAutoUpdate,this}toJSON(V){const g=super.toJSON(V);return this.fog!==null&&(g.object.fog=this.fog.toJSON()),g}}wC.prototype.isScene=!0;class HC{constructor(V,g){this.array=V,this.stride=g,this.count=V!==void 0?V.length/g:0,this.usage=mi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=KI()}onUploadCallback(){}set needsUpdate(V){V===!0&&this.version++}setUsage(V){return this.usage=V,this}copy(V){return this.array=new V.array.constructor(V.array),this.count=V.count,this.stride=V.stride,this.usage=V.usage,this}copyAt(V,g,I){V*=this.stride,I*=g.stride;for(let e=0,t=this.stride;e<t;e++)this.array[V+e]=g.array[I+e];return this}set(V,g=0){return this.array.set(V,g),this}clone(V){V.arrayBuffers===void 0&&(V.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=KI()),V.arrayBuffers[this.array.buffer._uuid]===void 0&&(V.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const g=new this.array.constructor(V.arrayBuffers[this.array.buffer._uuid]),I=new this.constructor(g,this.stride);return I.setUsage(this.usage),I}onUpload(V){return this.onUploadCallback=V,this}toJSON(V){return V.arrayBuffers===void 0&&(V.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=KI()),V.arrayBuffers[this.array.buffer._uuid]===void 0&&(V.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}HC.prototype.isInterleavedBuffer=!0;const Wg=new S;class uC{constructor(V,g,I,e=!1){this.name="",this.data=V,this.itemSize=g,this.offset=I,this.normalized=e===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(V){this.data.needsUpdate=V}applyMatrix4(V){for(let g=0,I=this.data.count;g<I;g++)Wg.x=this.getX(g),Wg.y=this.getY(g),Wg.z=this.getZ(g),Wg.applyMatrix4(V),this.setXYZ(g,Wg.x,Wg.y,Wg.z);return this}applyNormalMatrix(V){for(let g=0,I=this.count;g<I;g++)Wg.x=this.getX(g),Wg.y=this.getY(g),Wg.z=this.getZ(g),Wg.applyNormalMatrix(V),this.setXYZ(g,Wg.x,Wg.y,Wg.z);return this}transformDirection(V){for(let g=0,I=this.count;g<I;g++)Wg.x=this.getX(g),Wg.y=this.getY(g),Wg.z=this.getZ(g),Wg.transformDirection(V),this.setXYZ(g,Wg.x,Wg.y,Wg.z);return this}setX(V,g){return this.data.array[V*this.data.stride+this.offset]=g,this}setY(V,g){return this.data.array[V*this.data.stride+this.offset+1]=g,this}setZ(V,g){return this.data.array[V*this.data.stride+this.offset+2]=g,this}setW(V,g){return this.data.array[V*this.data.stride+this.offset+3]=g,this}getX(V){return this.data.array[V*this.data.stride+this.offset]}getY(V){return this.data.array[V*this.data.stride+this.offset+1]}getZ(V){return this.data.array[V*this.data.stride+this.offset+2]}getW(V){return this.data.array[V*this.data.stride+this.offset+3]}setXY(V,g,I){return V=V*this.data.stride+this.offset,this.data.array[V+0]=g,this.data.array[V+1]=I,this}setXYZ(V,g,I,e){return V=V*this.data.stride+this.offset,this.data.array[V+0]=g,this.data.array[V+1]=I,this.data.array[V+2]=e,this}setXYZW(V,g,I,e,t){return V=V*this.data.stride+this.offset,this.data.array[V+0]=g,this.data.array[V+1]=I,this.data.array[V+2]=e,this.data.array[V+3]=t,this}clone(V){if(V===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const g=[];for(let I=0;I<this.count;I++){const e=I*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)g.push(this.data.array[e+t])}return new qg(new this.array.constructor(g),this.itemSize,this.normalized)}else return V.interleavedBuffers===void 0&&(V.interleavedBuffers={}),V.interleavedBuffers[this.data.uuid]===void 0&&(V.interleavedBuffers[this.data.uuid]=this.data.clone(V)),new uC(V.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(V){if(V===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const g=[];for(let I=0;I<this.count;I++){const e=I*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)g.push(this.data.array[e+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:g,normalized:this.normalized}}else return V.interleavedBuffers===void 0&&(V.interleavedBuffers={}),V.interleavedBuffers[this.data.uuid]===void 0&&(V.interleavedBuffers[this.data.uuid]=this.data.toJSON(V)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}uC.prototype.isInterleavedBufferAttribute=!0;class cl extends xg{constructor(V){super(),this.type="SpriteMaterial",this.color=new NV(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(V)}copy(V){return super.copy(V),this.color.copy(V.color),this.map=V.map,this.alphaMap=V.alphaMap,this.rotation=V.rotation,this.sizeAttenuation=V.sizeAttenuation,this}}cl.prototype.isSpriteMaterial=!0;let Pt;const TC=new S,Ot=new S,_t=new S,$t=new dV,LC=new dV,rd=new JV,iA=new S,UC=new S,AA=new S,co=new dV,kn=new dV,ro=new dV;class hd extends UV{constructor(V){if(super(),this.type="Sprite",Pt===void 0){Pt=new $V;const g=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),I=new HC(g,5);Pt.setIndex([0,1,2,0,2,3]),Pt.setAttribute("position",new uC(I,3,0,!1)),Pt.setAttribute("uv",new uC(I,2,3,!1))}this.geometry=Pt,this.material=V!==void 0?V:new cl,this.center=new dV(.5,.5)}raycast(V,g){V.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ot.setFromMatrixScale(this.matrixWorld),rd.copy(V.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(V.camera.matrixWorldInverse,this.matrixWorld),_t.setFromMatrixPosition(this.modelViewMatrix),V.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ot.multiplyScalar(-_t.z);const I=this.material.rotation;let e,t;I!==0&&(t=Math.cos(I),e=Math.sin(I));const C=this.center;nA(iA.set(-.5,-.5,0),_t,C,Ot,e,t),nA(UC.set(.5,-.5,0),_t,C,Ot,e,t),nA(AA.set(.5,.5,0),_t,C,Ot,e,t),co.set(0,0),kn.set(1,0),ro.set(1,1);let A=V.ray.intersectTriangle(iA,UC,AA,!1,TC);if(A===null&&(nA(UC.set(-.5,.5,0),_t,C,Ot,e,t),kn.set(0,1),A=V.ray.intersectTriangle(iA,AA,UC,!1,TC),A===null))return;const s=V.ray.origin.distanceTo(TC);s<V.near||s>V.far||g.push({distance:s,point:TC.clone(),uv:Xg.getUV(TC,iA,UC,AA,co,kn,ro,new dV),face:null,object:this})}copy(V){return super.copy(V),V.center!==void 0&&this.center.copy(V.center),this.material=V.material,this}}hd.prototype.isSprite=!0;function nA(i,V,g,I,e,t){$t.subVectors(i,g).addScalar(.5).multiply(I),e!==void 0?(LC.x=t*$t.x-e*$t.y,LC.y=e*$t.x+t*$t.y):LC.copy($t),i.copy(V),i.x+=LC.x,i.y+=LC.y,i.applyMatrix4(rd)}const ho=new S,mo=new eg,uo=new eg,qq=new S,bo=new JV;class dl extends og{constructor(V,g){super(V,g),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new JV,this.bindMatrixInverse=new JV}copy(V){return super.copy(V),this.bindMode=V.bindMode,this.bindMatrix.copy(V.bindMatrix),this.bindMatrixInverse.copy(V.bindMatrixInverse),this.skeleton=V.skeleton,this}bind(V,g){this.skeleton=V,g===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),g=this.matrixWorld),this.bindMatrix.copy(g),this.bindMatrixInverse.copy(g).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const V=new eg,g=this.geometry.attributes.skinWeight;for(let I=0,e=g.count;I<e;I++){V.x=g.getX(I),V.y=g.getY(I),V.z=g.getZ(I),V.w=g.getW(I);const t=1/V.manhattanLength();t!==1/0?V.multiplyScalar(t):V.set(1,0,0,0),g.setXYZW(I,V.x,V.y,V.z,V.w)}}updateMatrixWorld(V){super.updateMatrixWorld(V),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(V,g){const I=this.skeleton,e=this.geometry;mo.fromBufferAttribute(e.attributes.skinIndex,V),uo.fromBufferAttribute(e.attributes.skinWeight,V),ho.fromBufferAttribute(e.attributes.position,V).applyMatrix4(this.bindMatrix),g.set(0,0,0);for(let t=0;t<4;t++){const C=uo.getComponent(t);if(C!==0){const A=mo.getComponent(t);bo.multiplyMatrices(I.bones[A].matrixWorld,I.boneInverses[A]),g.addScaledVector(qq.copy(ho).applyMatrix4(bo),C)}}return g.applyMatrix4(this.bindMatrixInverse)}}dl.prototype.isSkinnedMesh=!0;class rl extends UV{constructor(){super(),this.type="Bone"}}rl.prototype.isBone=!0;class md extends Mg{constructor(V=null,g=1,I=1,e,t,C,A,s,a=Lg,o=Lg,n,l){super(null,C,A,s,a,o,e,t,n,l),this.image={data:V,width:g,height:I},this.magFilter=a,this.minFilter=o,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}md.prototype.isDataTexture=!0;const Zo=new JV,Bq=new JV;class hl{constructor(V=[],g=[]){this.uuid=KI(),this.bones=V.slice(0),this.boneInverses=g,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const V=this.bones,g=this.boneInverses;if(this.boneMatrices=new Float32Array(V.length*16),g.length===0)this.calculateInverses();else if(V.length!==g.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let I=0,e=this.bones.length;I<e;I++)this.boneInverses.push(new JV)}}calculateInverses(){this.boneInverses.length=0;for(let V=0,g=this.bones.length;V<g;V++){const I=new JV;this.bones[V]&&I.copy(this.bones[V].matrixWorld).invert(),this.boneInverses.push(I)}}pose(){for(let V=0,g=this.bones.length;V<g;V++){const I=this.bones[V];I&&I.matrixWorld.copy(this.boneInverses[V]).invert()}for(let V=0,g=this.bones.length;V<g;V++){const I=this.bones[V];I&&(I.parent&&I.parent.isBone?(I.matrix.copy(I.parent.matrixWorld).invert(),I.matrix.multiply(I.matrixWorld)):I.matrix.copy(I.matrixWorld),I.matrix.decompose(I.position,I.quaternion,I.scale))}}update(){const V=this.bones,g=this.boneInverses,I=this.boneMatrices,e=this.boneTexture;for(let t=0,C=V.length;t<C;t++){const A=V[t]?V[t].matrixWorld:Bq;Zo.multiplyMatrices(A,g[t]),Zo.toArray(I,t*16)}e!==null&&(e.needsUpdate=!0)}clone(){return new hl(this.bones,this.boneInverses)}computeBoneTexture(){let V=Math.sqrt(this.bones.length*4);V=Uc(V),V=Math.max(V,4);const g=new Float32Array(V*V*4);g.set(this.boneMatrices);const I=new md(g,V,V,NI,ze);return this.boneMatrices=g,this.boneTexture=I,this.boneTextureSize=V,this}getBoneByName(V){for(let g=0,I=this.bones.length;g<I;g++){const e=this.bones[g];if(e.name===V)return e}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(V,g){this.uuid=V.uuid;for(let I=0,e=V.bones.length;I<e;I++){const t=V.bones[I];let C=g[t];C===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",t),C=new rl),this.bones.push(C),this.boneInverses.push(new JV().fromArray(V.boneInverses[I]))}return this.init(),this}toJSON(){const V={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};V.uuid=this.uuid;const g=this.bones,I=this.boneInverses;for(let e=0,t=g.length;e<t;e++){const C=g[e];V.bones.push(C.uuid);const A=I[e];V.boneInverses.push(A.toArray())}return V}}const Go=new JV,po=new JV,sA=[],DC=new og;class Ji extends og{constructor(V,g,I){super(V,g),this.instanceMatrix=new qg(new Float32Array(I*16),16),this.instanceColor=null,this.count=I,this.frustumCulled=!1}copy(V){return super.copy(V),this.instanceMatrix.copy(V.instanceMatrix),V.instanceColor!==null&&(this.instanceColor=V.instanceColor.clone()),this.count=V.count,this}getColorAt(V,g){g.fromArray(this.instanceColor.array,V*3)}getMatrixAt(V,g){g.fromArray(this.instanceMatrix.array,V*16)}raycast(V,g){const I=this.matrixWorld,e=this.count;if(DC.geometry=this.geometry,DC.material=this.material,DC.material!==void 0)for(let t=0;t<e;t++){this.getMatrixAt(t,Go),po.multiplyMatrices(I,Go),DC.matrixWorld=po,DC.raycast(V,sA);for(let C=0,A=sA.length;C<A;C++){const s=sA[C];s.instanceId=t,s.object=this,g.push(s)}sA.length=0}}setColorAt(V,g){this.instanceColor===null&&(this.instanceColor=new qg(new Float32Array(this.count*3),3)),g.toArray(this.instanceColor.array,V*3)}setMatrixAt(V,g){g.toArray(this.instanceMatrix.array,V*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Ji.prototype.isInstancedMesh=!0;class fC extends xg{constructor(V){super(),this.type="LineBasicMaterial",this.color=new NV(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(V)}copy(V){return super.copy(V),this.color.copy(V.color),this.linewidth=V.linewidth,this.linecap=V.linecap,this.linejoin=V.linejoin,this.morphTargets=V.morphTargets,this}}fC.prototype.isLineBasicMaterial=!0;const qo=new S,Bo=new S,Wo=new JV,zn=new Ht,lA=new XI;class jA extends UV{constructor(V=new $V,g=new fC){super(),this.type="Line",this.geometry=V,this.material=g,this.updateMorphTargets()}copy(V){return super.copy(V),this.material=V.material,this.geometry=V.geometry,this}computeLineDistances(){const V=this.geometry;if(V.isBufferGeometry)if(V.index===null){const g=V.attributes.position,I=[0];for(let e=1,t=g.count;e<t;e++)qo.fromBufferAttribute(g,e-1),Bo.fromBufferAttribute(g,e),I[e]=I[e-1],I[e]+=qo.distanceTo(Bo);V.setAttribute("lineDistance",new hg(I,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else V.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(V,g){const I=this.geometry,e=this.matrixWorld,t=V.params.Line.threshold,C=I.drawRange;if(I.boundingSphere===null&&I.computeBoundingSphere(),lA.copy(I.boundingSphere),lA.applyMatrix4(e),lA.radius+=t,V.ray.intersectsSphere(lA)===!1)return;Wo.copy(e).invert(),zn.copy(V.ray).applyMatrix4(Wo);const A=t/((this.scale.x+this.scale.y+this.scale.z)/3),s=A*A,a=new S,o=new S,n=new S,l=new S,c=this.isLineSegments?2:1;if(I.isBufferGeometry){const d=I.index,m=I.attributes.position;if(d!==null){const r=Math.max(0,C.start),u=Math.min(d.count,C.start+C.count);for(let b=r,Z=u-1;b<Z;b+=c){const p=d.getX(b),G=d.getX(b+1);if(a.fromBufferAttribute(m,p),o.fromBufferAttribute(m,G),zn.distanceSqToSegment(a,o,l,n)>s)continue;l.applyMatrix4(this.matrixWorld);const W=V.ray.origin.distanceTo(l);W<V.near||W>V.far||g.push({distance:W,point:n.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{const r=Math.max(0,C.start),u=Math.min(m.count,C.start+C.count);for(let b=r,Z=u-1;b<Z;b+=c){if(a.fromBufferAttribute(m,b),o.fromBufferAttribute(m,b+1),zn.distanceSqToSegment(a,o,l,n)>s)continue;l.applyMatrix4(this.matrixWorld);const G=V.ray.origin.distanceTo(l);G<V.near||G>V.far||g.push({distance:G,point:n.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else I.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const V=this.geometry;if(V.isBufferGeometry){const g=V.morphAttributes,I=Object.keys(g);if(I.length>0){const e=g[I[0]];if(e!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,C=e.length;t<C;t++){const A=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[A]=t}}}}else{const g=V.morphTargets;g!==void 0&&g.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}jA.prototype.isLine=!0;const yo=new S,Xo=new S;class PA extends jA{constructor(V,g){super(V,g),this.type="LineSegments"}computeLineDistances(){const V=this.geometry;if(V.isBufferGeometry)if(V.index===null){const g=V.attributes.position,I=[];for(let e=0,t=g.count;e<t;e+=2)yo.fromBufferAttribute(g,e),Xo.fromBufferAttribute(g,e+1),I[e]=e===0?0:I[e-1],I[e+1]=I[e]+yo.distanceTo(Xo);V.setAttribute("lineDistance",new hg(I,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else V.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}PA.prototype.isLineSegments=!0;class ud extends jA{constructor(V,g){super(V,g),this.type="LineLoop"}}ud.prototype.isLineLoop=!0;class ml extends xg{constructor(V){super(),this.type="PointsMaterial",this.color=new NV(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(V)}copy(V){return super.copy(V),this.color.copy(V.color),this.map=V.map,this.alphaMap=V.alphaMap,this.size=V.size,this.sizeAttenuation=V.sizeAttenuation,this.morphTargets=V.morphTargets,this}}ml.prototype.isPointsMaterial=!0;const Ro=new JV,Ys=new Ht,aA=new XI,oA=new S;class bd extends UV{constructor(V=new $V,g=new ml){super(),this.type="Points",this.geometry=V,this.material=g,this.updateMorphTargets()}copy(V){return super.copy(V),this.material=V.material,this.geometry=V.geometry,this}raycast(V,g){const I=this.geometry,e=this.matrixWorld,t=V.params.Points.threshold,C=I.drawRange;if(I.boundingSphere===null&&I.computeBoundingSphere(),aA.copy(I.boundingSphere),aA.applyMatrix4(e),aA.radius+=t,V.ray.intersectsSphere(aA)===!1)return;Ro.copy(e).invert(),Ys.copy(V.ray).applyMatrix4(Ro);const A=t/((this.scale.x+this.scale.y+this.scale.z)/3),s=A*A;if(I.isBufferGeometry){const a=I.index,n=I.attributes.position;if(a!==null){const l=Math.max(0,C.start),c=Math.min(a.count,C.start+C.count);for(let d=l,h=c;d<h;d++){const m=a.getX(d);oA.fromBufferAttribute(n,m),Yo(oA,m,s,e,V,g,this)}}else{const l=Math.max(0,C.start),c=Math.min(n.count,C.start+C.count);for(let d=l,h=c;d<h;d++)oA.fromBufferAttribute(n,d),Yo(oA,d,s,e,V,g,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const V=this.geometry;if(V.isBufferGeometry){const g=V.morphAttributes,I=Object.keys(g);if(I.length>0){const e=g[I[0]];if(e!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,C=e.length;t<C;t++){const A=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[A]=t}}}}else{const g=V.morphTargets;g!==void 0&&g.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}bd.prototype.isPoints=!0;function Yo(i,V,g,I,e,t,C){const A=Ys.distanceSqToPoint(i);if(A<g){const s=new S;Ys.closestPointToPoint(i,s),s.applyMatrix4(I);const a=e.ray.origin.distanceTo(s);if(a<e.near||a>e.far)return;t.push({distance:a,distanceToRay:Math.sqrt(A),point:s,index:V,face:null,object:C})}}class Wq extends Mg{constructor(V,g,I,e,t,C,A,s,a){super(V,g,I,e,t,C,A,s,a),this.format=A!==void 0?A:je,this.minFilter=C!==void 0?C:Sg,this.magFilter=t!==void 0?t:Sg,this.generateMipmaps=!1;const o=this;function n(){o.needsUpdate=!0,V.requestVideoFrameCallback(n)}"requestVideoFrameCallback"in V&&V.requestVideoFrameCallback(n)}clone(){return new this.constructor(this.image).copy(this)}update(){const V=this.image;"requestVideoFrameCallback"in V===!1&&V.readyState>=V.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Wq.prototype.isVideoTexture=!0;class yq extends Mg{constructor(V,g,I,e,t,C,A,s,a,o,n,l){super(null,C,A,s,a,o,e,t,n,l),this.image={width:g,height:I},this.mipmaps=V,this.flipY=!1,this.generateMipmaps=!1}}yq.prototype.isCompressedTexture=!0;class Zd extends Mg{constructor(V,g,I,e,t,C,A,s,a){super(V,g,I,e,t,C,A,s,a),this.needsUpdate=!0}}Zd.prototype.isCanvasTexture=!0;class Xq extends Mg{constructor(V,g,I,e,t,C,A,s,a,o){if(o=o!==void 0?o:lC,o!==lC&&o!==ri)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");I===void 0&&o===lC&&(I=FA),I===void 0&&o===ri&&(I=Ci),super(null,e,t,C,A,s,o,I,a),this.image={width:V,height:g},this.magFilter=A!==void 0?A:Lg,this.minFilter=s!==void 0?s:Lg,this.flipY=!1,this.generateMipmaps=!1}}Xq.prototype.isDepthTexture=!0;class OA extends $V{constructor(V=1,g=1,I=1,e=8,t=1,C=!1,A=0,s=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:V,radiusBottom:g,height:I,radialSegments:e,heightSegments:t,openEnded:C,thetaStart:A,thetaLength:s};const a=this;e=Math.floor(e),t=Math.floor(t);const o=[],n=[],l=[],c=[];let d=0;const h=[],m=I/2;let r=0;u(),C===!1&&(V>0&&b(!0),g>0&&b(!1)),this.setIndex(o),this.setAttribute("position",new hg(n,3)),this.setAttribute("normal",new hg(l,3)),this.setAttribute("uv",new hg(c,2));function u(){const Z=new S,p=new S;let G=0;const X=(g-V)/I;for(let W=0;W<=t;W++){const y=[],Y=W/t,f=Y*(g-V)+V;for(let L=0;L<=e;L++){const R=L/e,J=R*s+A,H=Math.sin(J),N=Math.cos(J);p.x=f*H,p.y=-Y*I+m,p.z=f*N,n.push(p.x,p.y,p.z),Z.set(H,X,N).normalize(),l.push(Z.x,Z.y,Z.z),c.push(R,1-Y),y.push(d++)}h.push(y)}for(let W=0;W<e;W++)for(let y=0;y<t;y++){const Y=h[y][W],f=h[y+1][W],L=h[y+1][W+1],R=h[y][W+1];o.push(Y,f,R),o.push(f,L,R),G+=6}a.addGroup(r,G,0),r+=G}function b(Z){const p=d,G=new dV,X=new S;let W=0;const y=Z===!0?V:g,Y=Z===!0?1:-1;for(let L=1;L<=e;L++)n.push(0,m*Y,0),l.push(0,Y,0),c.push(.5,.5),d++;const f=d;for(let L=0;L<=e;L++){const J=L/e*s+A,H=Math.cos(J),N=Math.sin(J);X.x=y*N,X.y=m*Y,X.z=y*H,n.push(X.x,X.y,X.z),l.push(0,Y,0),G.x=H*.5+.5,G.y=N*.5*Y+.5,c.push(G.x,G.y),d++}for(let L=0;L<e;L++){const R=p+L,J=f+L;Z===!0?o.push(J,J+1,R):o.push(J+1,J,R),W+=3}a.addGroup(r,W,Z===!0?1:2),r+=W}}static fromJSON(V){return new OA(V.radiusTop,V.radiusBottom,V.height,V.radialSegments,V.heightSegments,V.openEnded,V.thetaStart,V.thetaLength)}}new S;new S;new S;new Xg;class JI{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(V,g){const I=this.getUtoTmapping(V);return this.getPoint(I,g)}getPoints(V=5){const g=[];for(let I=0;I<=V;I++)g.push(this.getPoint(I/V));return g}getSpacedPoints(V=5){const g=[];for(let I=0;I<=V;I++)g.push(this.getPointAt(I/V));return g}getLength(){const V=this.getLengths();return V[V.length-1]}getLengths(V=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===V+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const g=[];let I,e=this.getPoint(0),t=0;g.push(0);for(let C=1;C<=V;C++)I=this.getPoint(C/V),t+=I.distanceTo(e),g.push(t),e=I;return this.cacheArcLengths=g,g}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(V,g){const I=this.getLengths();let e=0;const t=I.length;let C;g?C=g:C=V*I[t-1];let A=0,s=t-1,a;for(;A<=s;)if(e=Math.floor(A+(s-A)/2),a=I[e]-C,a<0)A=e+1;else if(a>0)s=e-1;else{s=e;break}if(e=s,I[e]===C)return e/(t-1);const o=I[e],l=I[e+1]-o,c=(C-o)/l;return(e+c)/(t-1)}getTangent(V,g){let e=V-1e-4,t=V+1e-4;e<0&&(e=0),t>1&&(t=1);const C=this.getPoint(e),A=this.getPoint(t),s=g||(C.isVector2?new dV:new S);return s.copy(A).sub(C).normalize(),s}getTangentAt(V,g){const I=this.getUtoTmapping(V);return this.getTangent(I,g)}computeFrenetFrames(V,g){const I=new S,e=[],t=[],C=[],A=new S,s=new JV;for(let c=0;c<=V;c++){const d=c/V;e[c]=this.getTangentAt(d,new S),e[c].normalize()}t[0]=new S,C[0]=new S;let a=Number.MAX_VALUE;const o=Math.abs(e[0].x),n=Math.abs(e[0].y),l=Math.abs(e[0].z);o<=a&&(a=o,I.set(1,0,0)),n<=a&&(a=n,I.set(0,1,0)),l<=a&&I.set(0,0,1),A.crossVectors(e[0],I).normalize(),t[0].crossVectors(e[0],A),C[0].crossVectors(e[0],t[0]);for(let c=1;c<=V;c++){if(t[c]=t[c-1].clone(),C[c]=C[c-1].clone(),A.crossVectors(e[c-1],e[c]),A.length()>Number.EPSILON){A.normalize();const d=Math.acos(eI(e[c-1].dot(e[c]),-1,1));t[c].applyMatrix4(s.makeRotationAxis(A,d))}C[c].crossVectors(e[c],t[c])}if(g===!0){let c=Math.acos(eI(t[0].dot(t[V]),-1,1));c/=V,e[0].dot(A.crossVectors(t[0],t[V]))>0&&(c=-c);for(let d=1;d<=V;d++)t[d].applyMatrix4(s.makeRotationAxis(e[d],c*d)),C[d].crossVectors(e[d],t[d])}return{tangents:e,normals:t,binormals:C}}clone(){return new this.constructor().copy(this)}copy(V){return this.arcLengthDivisions=V.arcLengthDivisions,this}toJSON(){const V={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return V.arcLengthDivisions=this.arcLengthDivisions,V.type=this.type,V}fromJSON(V){return this.arcLengthDivisions=V.arcLengthDivisions,this}}class _A extends JI{constructor(V=0,g=0,I=1,e=1,t=0,C=Math.PI*2,A=!1,s=0){super(),this.type="EllipseCurve",this.aX=V,this.aY=g,this.xRadius=I,this.yRadius=e,this.aStartAngle=t,this.aEndAngle=C,this.aClockwise=A,this.aRotation=s}getPoint(V,g){const I=g||new dV,e=Math.PI*2;let t=this.aEndAngle-this.aStartAngle;const C=Math.abs(t)<Number.EPSILON;for(;t<0;)t+=e;for(;t>e;)t-=e;t<Number.EPSILON&&(C?t=0:t=e),this.aClockwise===!0&&!C&&(t===e?t=-e:t=t-e);const A=this.aStartAngle+V*t;let s=this.aX+this.xRadius*Math.cos(A),a=this.aY+this.yRadius*Math.sin(A);if(this.aRotation!==0){const o=Math.cos(this.aRotation),n=Math.sin(this.aRotation),l=s-this.aX,c=a-this.aY;s=l*o-c*n+this.aX,a=l*n+c*o+this.aY}return I.set(s,a)}copy(V){return super.copy(V),this.aX=V.aX,this.aY=V.aY,this.xRadius=V.xRadius,this.yRadius=V.yRadius,this.aStartAngle=V.aStartAngle,this.aEndAngle=V.aEndAngle,this.aClockwise=V.aClockwise,this.aRotation=V.aRotation,this}toJSON(){const V=super.toJSON();return V.aX=this.aX,V.aY=this.aY,V.xRadius=this.xRadius,V.yRadius=this.yRadius,V.aStartAngle=this.aStartAngle,V.aEndAngle=this.aEndAngle,V.aClockwise=this.aClockwise,V.aRotation=this.aRotation,V}fromJSON(V){return super.fromJSON(V),this.aX=V.aX,this.aY=V.aY,this.xRadius=V.xRadius,this.yRadius=V.yRadius,this.aStartAngle=V.aStartAngle,this.aEndAngle=V.aEndAngle,this.aClockwise=V.aClockwise,this.aRotation=V.aRotation,this}}_A.prototype.isEllipseCurve=!0;class Gd extends _A{constructor(V,g,I,e,t,C){super(V,g,I,I,e,t,C),this.type="ArcCurve"}}Gd.prototype.isArcCurve=!0;function ul(){let i=0,V=0,g=0,I=0;function e(t,C,A,s){i=t,V=A,g=-3*t+3*C-2*A-s,I=2*t-2*C+A+s}return{initCatmullRom:function(t,C,A,s,a){e(C,A,a*(A-t),a*(s-C))},initNonuniformCatmullRom:function(t,C,A,s,a,o,n){let l=(C-t)/a-(A-t)/(a+o)+(A-C)/o,c=(A-C)/o-(s-C)/(o+n)+(s-A)/n;l*=o,c*=o,e(C,A,l,c)},calc:function(t){const C=t*t,A=C*t;return i+V*t+g*C+I*A}}}const cA=new S,Tn=new ul,Ln=new ul,Un=new ul;class bl extends JI{constructor(V=[],g=!1,I="centripetal",e=.5){super(),this.type="CatmullRomCurve3",this.points=V,this.closed=g,this.curveType=I,this.tension=e}getPoint(V,g=new S){const I=g,e=this.points,t=e.length,C=(t-(this.closed?0:1))*V;let A=Math.floor(C),s=C-A;this.closed?A+=A>0?0:(Math.floor(Math.abs(A)/t)+1)*t:s===0&&A===t-1&&(A=t-2,s=1);let a,o;this.closed||A>0?a=e[(A-1)%t]:(cA.subVectors(e[0],e[1]).add(e[0]),a=cA);const n=e[A%t],l=e[(A+1)%t];if(this.closed||A+2<t?o=e[(A+2)%t]:(cA.subVectors(e[t-1],e[t-2]).add(e[t-1]),o=cA),this.curveType==="centripetal"||this.curveType==="chordal"){const c=this.curveType==="chordal"?.5:.25;let d=Math.pow(a.distanceToSquared(n),c),h=Math.pow(n.distanceToSquared(l),c),m=Math.pow(l.distanceToSquared(o),c);h<1e-4&&(h=1),d<1e-4&&(d=h),m<1e-4&&(m=h),Tn.initNonuniformCatmullRom(a.x,n.x,l.x,o.x,d,h,m),Ln.initNonuniformCatmullRom(a.y,n.y,l.y,o.y,d,h,m),Un.initNonuniformCatmullRom(a.z,n.z,l.z,o.z,d,h,m)}else this.curveType==="catmullrom"&&(Tn.initCatmullRom(a.x,n.x,l.x,o.x,this.tension),Ln.initCatmullRom(a.y,n.y,l.y,o.y,this.tension),Un.initCatmullRom(a.z,n.z,l.z,o.z,this.tension));return I.set(Tn.calc(s),Ln.calc(s),Un.calc(s)),I}copy(V){super.copy(V),this.points=[];for(let g=0,I=V.points.length;g<I;g++){const e=V.points[g];this.points.push(e.clone())}return this.closed=V.closed,this.curveType=V.curveType,this.tension=V.tension,this}toJSON(){const V=super.toJSON();V.points=[];for(let g=0,I=this.points.length;g<I;g++){const e=this.points[g];V.points.push(e.toArray())}return V.closed=this.closed,V.curveType=this.curveType,V.tension=this.tension,V}fromJSON(V){super.fromJSON(V),this.points=[];for(let g=0,I=V.points.length;g<I;g++){const e=V.points[g];this.points.push(new S().fromArray(e))}return this.closed=V.closed,this.curveType=V.curveType,this.tension=V.tension,this}}bl.prototype.isCatmullRomCurve3=!0;function wo(i,V,g,I,e){const t=(I-V)*.5,C=(e-g)*.5,A=i*i,s=i*A;return(2*g-2*I+t+C)*s+(-3*g+3*I-2*t-C)*A+t*i+g}function Rq(i,V){const g=1-i;return g*g*V}function Yq(i,V){return 2*(1-i)*i*V}function wq(i,V){return i*i*V}function ni(i,V,g,I){return Rq(i,V)+Yq(i,g)+wq(i,I)}function Hq(i,V){const g=1-i;return g*g*g*V}function fq(i,V){const g=1-i;return 3*g*g*i*V}function Sq(i,V){return 3*(1-i)*i*i*V}function Fq(i,V){return i*i*i*V}function si(i,V,g,I,e){return Hq(i,V)+fq(i,g)+Sq(i,I)+Fq(i,e)}class Zl extends JI{constructor(V=new dV,g=new dV,I=new dV,e=new dV){super(),this.type="CubicBezierCurve",this.v0=V,this.v1=g,this.v2=I,this.v3=e}getPoint(V,g=new dV){const I=g,e=this.v0,t=this.v1,C=this.v2,A=this.v3;return I.set(si(V,e.x,t.x,C.x,A.x),si(V,e.y,t.y,C.y,A.y)),I}copy(V){return super.copy(V),this.v0.copy(V.v0),this.v1.copy(V.v1),this.v2.copy(V.v2),this.v3.copy(V.v3),this}toJSON(){const V=super.toJSON();return V.v0=this.v0.toArray(),V.v1=this.v1.toArray(),V.v2=this.v2.toArray(),V.v3=this.v3.toArray(),V}fromJSON(V){return super.fromJSON(V),this.v0.fromArray(V.v0),this.v1.fromArray(V.v1),this.v2.fromArray(V.v2),this.v3.fromArray(V.v3),this}}Zl.prototype.isCubicBezierCurve=!0;class pd extends JI{constructor(V=new S,g=new S,I=new S,e=new S){super(),this.type="CubicBezierCurve3",this.v0=V,this.v1=g,this.v2=I,this.v3=e}getPoint(V,g=new S){const I=g,e=this.v0,t=this.v1,C=this.v2,A=this.v3;return I.set(si(V,e.x,t.x,C.x,A.x),si(V,e.y,t.y,C.y,A.y),si(V,e.z,t.z,C.z,A.z)),I}copy(V){return super.copy(V),this.v0.copy(V.v0),this.v1.copy(V.v1),this.v2.copy(V.v2),this.v3.copy(V.v3),this}toJSON(){const V=super.toJSON();return V.v0=this.v0.toArray(),V.v1=this.v1.toArray(),V.v2=this.v2.toArray(),V.v3=this.v3.toArray(),V}fromJSON(V){return super.fromJSON(V),this.v0.fromArray(V.v0),this.v1.fromArray(V.v1),this.v2.fromArray(V.v2),this.v3.fromArray(V.v3),this}}pd.prototype.isCubicBezierCurve3=!0;class $A extends JI{constructor(V=new dV,g=new dV){super(),this.type="LineCurve",this.v1=V,this.v2=g}getPoint(V,g=new dV){const I=g;return V===1?I.copy(this.v2):(I.copy(this.v2).sub(this.v1),I.multiplyScalar(V).add(this.v1)),I}getPointAt(V,g){return this.getPoint(V,g)}getTangent(V,g){const I=g||new dV;return I.copy(this.v2).sub(this.v1).normalize(),I}copy(V){return super.copy(V),this.v1.copy(V.v1),this.v2.copy(V.v2),this}toJSON(){const V=super.toJSON();return V.v1=this.v1.toArray(),V.v2=this.v2.toArray(),V}fromJSON(V){return super.fromJSON(V),this.v1.fromArray(V.v1),this.v2.fromArray(V.v2),this}}$A.prototype.isLineCurve=!0;class vq extends JI{constructor(V=new S,g=new S){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=V,this.v2=g}getPoint(V,g=new S){const I=g;return V===1?I.copy(this.v2):(I.copy(this.v2).sub(this.v1),I.multiplyScalar(V).add(this.v1)),I}getPointAt(V,g){return this.getPoint(V,g)}copy(V){return super.copy(V),this.v1.copy(V.v1),this.v2.copy(V.v2),this}toJSON(){const V=super.toJSON();return V.v1=this.v1.toArray(),V.v2=this.v2.toArray(),V}fromJSON(V){return super.fromJSON(V),this.v1.fromArray(V.v1),this.v2.fromArray(V.v2),this}}class Gl extends JI{constructor(V=new dV,g=new dV,I=new dV){super(),this.type="QuadraticBezierCurve",this.v0=V,this.v1=g,this.v2=I}getPoint(V,g=new dV){const I=g,e=this.v0,t=this.v1,C=this.v2;return I.set(ni(V,e.x,t.x,C.x),ni(V,e.y,t.y,C.y)),I}copy(V){return super.copy(V),this.v0.copy(V.v0),this.v1.copy(V.v1),this.v2.copy(V.v2),this}toJSON(){const V=super.toJSON();return V.v0=this.v0.toArray(),V.v1=this.v1.toArray(),V.v2=this.v2.toArray(),V}fromJSON(V){return super.fromJSON(V),this.v0.fromArray(V.v0),this.v1.fromArray(V.v1),this.v2.fromArray(V.v2),this}}Gl.prototype.isQuadraticBezierCurve=!0;class qd extends JI{constructor(V=new S,g=new S,I=new S){super(),this.type="QuadraticBezierCurve3",this.v0=V,this.v1=g,this.v2=I}getPoint(V,g=new S){const I=g,e=this.v0,t=this.v1,C=this.v2;return I.set(ni(V,e.x,t.x,C.x),ni(V,e.y,t.y,C.y),ni(V,e.z,t.z,C.z)),I}copy(V){return super.copy(V),this.v0.copy(V.v0),this.v1.copy(V.v1),this.v2.copy(V.v2),this}toJSON(){const V=super.toJSON();return V.v0=this.v0.toArray(),V.v1=this.v1.toArray(),V.v2=this.v2.toArray(),V}fromJSON(V){return super.fromJSON(V),this.v0.fromArray(V.v0),this.v1.fromArray(V.v1),this.v2.fromArray(V.v2),this}}qd.prototype.isQuadraticBezierCurve3=!0;class pl extends JI{constructor(V=[]){super(),this.type="SplineCurve",this.points=V}getPoint(V,g=new dV){const I=g,e=this.points,t=(e.length-1)*V,C=Math.floor(t),A=t-C,s=e[C===0?C:C-1],a=e[C],o=e[C>e.length-2?e.length-1:C+1],n=e[C>e.length-3?e.length-1:C+2];return I.set(wo(A,s.x,a.x,o.x,n.x),wo(A,s.y,a.y,o.y,n.y)),I}copy(V){super.copy(V),this.points=[];for(let g=0,I=V.points.length;g<I;g++){const e=V.points[g];this.points.push(e.clone())}return this}toJSON(){const V=super.toJSON();V.points=[];for(let g=0,I=this.points.length;g<I;g++){const e=this.points[g];V.points.push(e.toArray())}return V}fromJSON(V){super.fromJSON(V),this.points=[];for(let g=0,I=V.points.length;g<I;g++){const e=V.points[g];this.points.push(new dV().fromArray(e))}return this}}pl.prototype.isSplineCurve=!0;var Bd=Object.freeze({__proto__:null,ArcCurve:Gd,CatmullRomCurve3:bl,CubicBezierCurve:Zl,CubicBezierCurve3:pd,EllipseCurve:_A,LineCurve:$A,LineCurve3:vq,QuadraticBezierCurve:Gl,QuadraticBezierCurve3:qd,SplineCurve:pl});const Nq={triangulate:function(i,V,g=2){const I=V&&V.length,e=I?V[0]*g:i.length;let t=Wd(i,0,e,g,!0);const C=[];if(!t||t.next===t.prev)return C;let A,s,a,o,n,l,c;if(I&&(t=kq(i,V,t,g)),i.length>80*g){A=a=i[0],s=o=i[1];for(let d=g;d<e;d+=g)n=i[d],l=i[d+1],n<A&&(A=n),l<s&&(s=l),n>a&&(a=n),l>o&&(o=l);c=Math.max(a-A,o-s),c=c!==0?1/c:0}return bi(t,C,g,A,s,c),C}};function Wd(i,V,g,I,e){let t,C;if(e===_q(i,V,g,I)>0)for(t=V;t<g;t+=I)C=Ho(t,i[t],i[t+1],C);else for(t=g-I;t>=V;t-=I)C=Ho(t,i[t],i[t+1],C);return C&&Vn(C,C.next)&&(Gi(C),C=C.next),C}function gt(i,V){if(!i)return i;V||(V=i);let g=i,I;do if(I=!1,!g.steiner&&(Vn(g,g.next)||Zg(g.prev,g,g.next)===0)){if(Gi(g),g=V=g.prev,g===g.next)break;I=!0}else g=g.next;while(I||g!==V);return V}function bi(i,V,g,I,e,t,C){if(!i)return;!C&&t&&Dq(i,I,e,t);let A=i,s,a;for(;i.prev!==i.next;){if(s=i.prev,a=i.next,t?Jq(i,I,e,t):Kq(i)){V.push(s.i/g),V.push(i.i/g),V.push(a.i/g),Gi(i),i=a.next,A=a.next;continue}if(i=a,i===A){C?C===1?(i=Mq(gt(i),V,g),bi(i,V,g,I,e,t,2)):C===2&&xq(i,V,g,I,e,t):bi(gt(i),V,g,I,e,t,1);break}}}function Kq(i){const V=i.prev,g=i,I=i.next;if(Zg(V,g,I)>=0)return!1;let e=i.next.next;for(;e!==i.prev;){if(CC(V.x,V.y,g.x,g.y,I.x,I.y,e.x,e.y)&&Zg(e.prev,e,e.next)>=0)return!1;e=e.next}return!0}function Jq(i,V,g,I){const e=i.prev,t=i,C=i.next;if(Zg(e,t,C)>=0)return!1;const A=e.x<t.x?e.x<C.x?e.x:C.x:t.x<C.x?t.x:C.x,s=e.y<t.y?e.y<C.y?e.y:C.y:t.y<C.y?t.y:C.y,a=e.x>t.x?e.x>C.x?e.x:C.x:t.x>C.x?t.x:C.x,o=e.y>t.y?e.y>C.y?e.y:C.y:t.y>C.y?t.y:C.y,n=ws(A,s,V,g,I),l=ws(a,o,V,g,I);let c=i.prevZ,d=i.nextZ;for(;c&&c.z>=n&&d&&d.z<=l;){if(c!==i.prev&&c!==i.next&&CC(e.x,e.y,t.x,t.y,C.x,C.y,c.x,c.y)&&Zg(c.prev,c,c.next)>=0||(c=c.prevZ,d!==i.prev&&d!==i.next&&CC(e.x,e.y,t.x,t.y,C.x,C.y,d.x,d.y)&&Zg(d.prev,d,d.next)>=0))return!1;d=d.nextZ}for(;c&&c.z>=n;){if(c!==i.prev&&c!==i.next&&CC(e.x,e.y,t.x,t.y,C.x,C.y,c.x,c.y)&&Zg(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;d&&d.z<=l;){if(d!==i.prev&&d!==i.next&&CC(e.x,e.y,t.x,t.y,C.x,C.y,d.x,d.y)&&Zg(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Mq(i,V,g){let I=i;do{const e=I.prev,t=I.next.next;!Vn(e,t)&&yd(e,I,I.next,t)&&Zi(e,t)&&Zi(t,e)&&(V.push(e.i/g),V.push(I.i/g),V.push(t.i/g),Gi(I),Gi(I.next),I=i=t),I=I.next}while(I!==i);return gt(I)}function xq(i,V,g,I,e,t){let C=i;do{let A=C.next.next;for(;A!==C.prev;){if(C.i!==A.i&&jq(C,A)){let s=Xd(C,A);C=gt(C,C.next),s=gt(s,s.next),bi(C,V,g,I,e,t),bi(s,V,g,I,e,t);return}A=A.next}C=C.next}while(C!==i)}function kq(i,V,g,I){const e=[];let t,C,A,s,a;for(t=0,C=V.length;t<C;t++)A=V[t]*I,s=t<C-1?V[t+1]*I:i.length,a=Wd(i,A,s,I,!1),a===a.next&&(a.steiner=!0),e.push(Qq(a));for(e.sort(zq),t=0;t<e.length;t++)Tq(e[t],g),g=gt(g,g.next);return g}function zq(i,V){return i.x-V.x}function Tq(i,V){if(V=Lq(i,V),V){const g=Xd(V,i);gt(V,V.next),gt(g,g.next)}}function Lq(i,V){let g=V;const I=i.x,e=i.y;let t=-1/0,C;do{if(e<=g.y&&e>=g.next.y&&g.next.y!==g.y){const l=g.x+(e-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(l<=I&&l>t){if(t=l,l===I){if(e===g.y)return g;if(e===g.next.y)return g.next}C=g.x<g.next.x?g:g.next}}g=g.next}while(g!==V);if(!C)return null;if(I===t)return C;const A=C,s=C.x,a=C.y;let o=1/0,n;g=C;do I>=g.x&&g.x>=s&&I!==g.x&&CC(e<a?I:t,e,s,a,e<a?t:I,e,g.x,g.y)&&(n=Math.abs(e-g.y)/(I-g.x),Zi(g,i)&&(n<o||n===o&&(g.x>C.x||g.x===C.x&&Uq(C,g)))&&(C=g,o=n)),g=g.next;while(g!==A);return C}function Uq(i,V){return Zg(i.prev,i,V.prev)<0&&Zg(V.next,i,i.next)<0}function Dq(i,V,g,I){let e=i;do e.z===null&&(e.z=ws(e.x,e.y,V,g,I)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==i);e.prevZ.nextZ=null,e.prevZ=null,Eq(e)}function Eq(i){let V,g,I,e,t,C,A,s,a=1;do{for(g=i,i=null,t=null,C=0;g;){for(C++,I=g,A=0,V=0;V<a&&(A++,I=I.nextZ,!!I);V++);for(s=a;A>0||s>0&&I;)A!==0&&(s===0||!I||g.z<=I.z)?(e=g,g=g.nextZ,A--):(e=I,I=I.nextZ,s--),t?t.nextZ=e:i=e,e.prevZ=t,t=e;g=I}t.nextZ=null,a*=2}while(C>1);return i}function ws(i,V,g,I,e){return i=32767*(i-g)*e,V=32767*(V-I)*e,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,V=(V|V<<8)&16711935,V=(V|V<<4)&252645135,V=(V|V<<2)&858993459,V=(V|V<<1)&1431655765,i|V<<1}function Qq(i){let V=i,g=i;do(V.x<g.x||V.x===g.x&&V.y<g.y)&&(g=V),V=V.next;while(V!==i);return g}function CC(i,V,g,I,e,t,C,A){return(e-C)*(V-A)-(i-C)*(t-A)>=0&&(i-C)*(I-A)-(g-C)*(V-A)>=0&&(g-C)*(t-A)-(e-C)*(I-A)>=0}function jq(i,V){return i.next.i!==V.i&&i.prev.i!==V.i&&!Pq(i,V)&&(Zi(i,V)&&Zi(V,i)&&Oq(i,V)&&(Zg(i.prev,i,V.prev)||Zg(i,V.prev,V))||Vn(i,V)&&Zg(i.prev,i,i.next)>0&&Zg(V.prev,V,V.next)>0)}function Zg(i,V,g){return(V.y-i.y)*(g.x-V.x)-(V.x-i.x)*(g.y-V.y)}function Vn(i,V){return i.x===V.x&&i.y===V.y}function yd(i,V,g,I){const e=rA(Zg(i,V,g)),t=rA(Zg(i,V,I)),C=rA(Zg(g,I,i)),A=rA(Zg(g,I,V));return!!(e!==t&&C!==A||e===0&&dA(i,g,V)||t===0&&dA(i,I,V)||C===0&&dA(g,i,I)||A===0&&dA(g,V,I))}function dA(i,V,g){return V.x<=Math.max(i.x,g.x)&&V.x>=Math.min(i.x,g.x)&&V.y<=Math.max(i.y,g.y)&&V.y>=Math.min(i.y,g.y)}function rA(i){return i>0?1:i<0?-1:0}function Pq(i,V){let g=i;do{if(g.i!==i.i&&g.next.i!==i.i&&g.i!==V.i&&g.next.i!==V.i&&yd(g,g.next,i,V))return!0;g=g.next}while(g!==i);return!1}function Zi(i,V){return Zg(i.prev,i,i.next)<0?Zg(i,V,i.next)>=0&&Zg(i,i.prev,V)>=0:Zg(i,V,i.prev)<0||Zg(i,i.next,V)<0}function Oq(i,V){let g=i,I=!1;const e=(i.x+V.x)/2,t=(i.y+V.y)/2;do g.y>t!=g.next.y>t&&g.next.y!==g.y&&e<(g.next.x-g.x)*(t-g.y)/(g.next.y-g.y)+g.x&&(I=!I),g=g.next;while(g!==i);return I}function Xd(i,V){const g=new Hs(i.i,i.x,i.y),I=new Hs(V.i,V.x,V.y),e=i.next,t=V.prev;return i.next=V,V.prev=i,g.next=e,e.prev=g,I.next=g,g.prev=I,t.next=I,I.prev=t,I}function Ho(i,V,g,I){const e=new Hs(i,V,g);return I?(e.next=I.next,e.prev=I,I.next.prev=e,I.next=e):(e.prev=e,e.next=e),e}function Gi(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Hs(i,V,g){this.i=i,this.x=V,this.y=g,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _q(i,V,g,I){let e=0;for(let t=V,C=g-I;t<g;t+=I)e+=(i[C]-i[t])*(i[t+1]+i[C+1]),C=t;return e}class Oe{static area(V){const g=V.length;let I=0;for(let e=g-1,t=0;t<g;e=t++)I+=V[e].x*V[t].y-V[t].x*V[e].y;return I*.5}static isClockWise(V){return Oe.area(V)<0}static triangulateShape(V,g){const I=[],e=[],t=[];fo(V),So(I,V);let C=V.length;g.forEach(fo);for(let s=0;s<g.length;s++)e.push(C),C+=g[s].length,So(I,g[s]);const A=Nq.triangulate(I,e);for(let s=0;s<A.length;s+=3)t.push(A.slice(s,s+3));return t}}function fo(i){const V=i.length;V>2&&i[V-1].equals(i[0])&&i.pop()}function So(i,V){for(let g=0;g<V.length;g++)i.push(V[g].x),i.push(V[g].y)}class vt extends $V{constructor(V,g){super(),this.type="ExtrudeGeometry",this.parameters={shapes:V,options:g},V=Array.isArray(V)?V:[V];const I=this,e=[],t=[];for(let A=0,s=V.length;A<s;A++){const a=V[A];C(a)}this.setAttribute("position",new hg(e,3)),this.setAttribute("uv",new hg(t,2)),this.computeVertexNormals();function C(A){const s=[],a=g.curveSegments!==void 0?g.curveSegments:12,o=g.steps!==void 0?g.steps:1;let n=g.depth!==void 0?g.depth:100,l=g.bevelEnabled!==void 0?g.bevelEnabled:!0,c=g.bevelThickness!==void 0?g.bevelThickness:6,d=g.bevelSize!==void 0?g.bevelSize:c-2,h=g.bevelOffset!==void 0?g.bevelOffset:0,m=g.bevelSegments!==void 0?g.bevelSegments:3;const r=g.extrudePath,u=g.UVGenerator!==void 0?g.UVGenerator:$q;g.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),n=g.amount);let b,Z=!1,p,G,X,W;r&&(b=r.getSpacedPoints(o),Z=!0,l=!1,p=r.computeFrenetFrames(o,!1),G=new S,X=new S,W=new S),l||(m=0,c=0,d=0,h=0);const y=A.extractPoints(a);let Y=y.shape;const f=y.holes;if(!Oe.isClockWise(Y)){Y=Y.reverse();for(let iV=0,CV=f.length;iV<CV;iV++){const AV=f[iV];Oe.isClockWise(AV)&&(f[iV]=AV.reverse())}}const R=Oe.triangulateShape(Y,f),J=Y;for(let iV=0,CV=f.length;iV<CV;iV++){const AV=f[iV];Y=Y.concat(AV)}function H(iV,CV,AV){return CV||console.error("THREE.ExtrudeGeometry: vec does not exist"),CV.clone().multiplyScalar(AV).add(iV)}const N=Y.length,v=R.length;function T(iV,CV,AV){let gV,eV,K;const w=iV.x-CV.x,sV=iV.y-CV.y,tV=AV.x-iV.x,BV=AV.y-iV.y,yV=w*w+sV*sV,wV=w*BV-sV*tV;if(Math.abs(wV)>Number.EPSILON){const fV=Math.sqrt(yV),vV=Math.sqrt(tV*tV+BV*BV),YV=CV.x-sV/fV,E=CV.y+w/fV,WV=AV.x-BV/vV,bV=AV.y+tV/vV,MV=((WV-YV)*BV-(bV-E)*tV)/(w*BV-sV*tV);gV=YV+w*MV-iV.x,eV=E+sV*MV-iV.y;const HV=gV*gV+eV*eV;if(HV<=2)return new dV(gV,eV);K=Math.sqrt(HV/2)}else{let fV=!1;w>Number.EPSILON?tV>Number.EPSILON&&(fV=!0):w<-Number.EPSILON?tV<-Number.EPSILON&&(fV=!0):Math.sign(sV)===Math.sign(BV)&&(fV=!0),fV?(gV=-sV,eV=w,K=Math.sqrt(yV)):(gV=w,eV=sV,K=Math.sqrt(yV/2))}return new dV(gV/K,eV/K)}const D=[];for(let iV=0,CV=J.length,AV=CV-1,gV=iV+1;iV<CV;iV++,AV++,gV++)AV===CV&&(AV=0),gV===CV&&(gV=0),D[iV]=T(J[iV],J[AV],J[gV]);const $=[];let M,_=D.concat();for(let iV=0,CV=f.length;iV<CV;iV++){const AV=f[iV];M=[];for(let gV=0,eV=AV.length,K=eV-1,w=gV+1;gV<eV;gV++,K++,w++)K===eV&&(K=0),w===eV&&(w=0),M[gV]=T(AV[gV],AV[K],AV[w]);$.push(M),_=_.concat(M)}for(let iV=0;iV<m;iV++){const CV=iV/m,AV=c*Math.cos(CV*Math.PI/2),gV=d*Math.sin(CV*Math.PI/2)+h;for(let eV=0,K=J.length;eV<K;eV++){const w=H(J[eV],D[eV],gV);rV(w.x,w.y,-AV)}for(let eV=0,K=f.length;eV<K;eV++){const w=f[eV];M=$[eV];for(let sV=0,tV=w.length;sV<tV;sV++){const BV=H(w[sV],M[sV],gV);rV(BV.x,BV.y,-AV)}}}const x=d+h;for(let iV=0;iV<N;iV++){const CV=l?H(Y[iV],_[iV],x):Y[iV];Z?(X.copy(p.normals[0]).multiplyScalar(CV.x),G.copy(p.binormals[0]).multiplyScalar(CV.y),W.copy(b[0]).add(X).add(G),rV(W.x,W.y,W.z)):rV(CV.x,CV.y,0)}for(let iV=1;iV<=o;iV++)for(let CV=0;CV<N;CV++){const AV=l?H(Y[CV],_[CV],x):Y[CV];Z?(X.copy(p.normals[iV]).multiplyScalar(AV.x),G.copy(p.binormals[iV]).multiplyScalar(AV.y),W.copy(b[iV]).add(X).add(G),rV(W.x,W.y,W.z)):rV(AV.x,AV.y,n/o*iV)}for(let iV=m-1;iV>=0;iV--){const CV=iV/m,AV=c*Math.cos(CV*Math.PI/2),gV=d*Math.sin(CV*Math.PI/2)+h;for(let eV=0,K=J.length;eV<K;eV++){const w=H(J[eV],D[eV],gV);rV(w.x,w.y,n+AV)}for(let eV=0,K=f.length;eV<K;eV++){const w=f[eV];M=$[eV];for(let sV=0,tV=w.length;sV<tV;sV++){const BV=H(w[sV],M[sV],gV);Z?rV(BV.x,BV.y+b[o-1].y,b[o-1].x+AV):rV(BV.x,BV.y,n+AV)}}}z(),F();function z(){const iV=e.length/3;if(l){let CV=0,AV=N*CV;for(let gV=0;gV<v;gV++){const eV=R[gV];nV(eV[2]+AV,eV[1]+AV,eV[0]+AV)}CV=o+m*2,AV=N*CV;for(let gV=0;gV<v;gV++){const eV=R[gV];nV(eV[0]+AV,eV[1]+AV,eV[2]+AV)}}else{for(let CV=0;CV<v;CV++){const AV=R[CV];nV(AV[2],AV[1],AV[0])}for(let CV=0;CV<v;CV++){const AV=R[CV];nV(AV[0]+N*o,AV[1]+N*o,AV[2]+N*o)}}I.addGroup(iV,e.length/3-iV,0)}function F(){const iV=e.length/3;let CV=0;k(J,CV),CV+=J.length;for(let AV=0,gV=f.length;AV<gV;AV++){const eV=f[AV];k(eV,CV),CV+=eV.length}I.addGroup(iV,e.length/3-iV,1)}function k(iV,CV){let AV=iV.length;for(;--AV>=0;){const gV=AV;let eV=AV-1;eV<0&&(eV=iV.length-1);for(let K=0,w=o+m*2;K<w;K++){const sV=N*K,tV=N*(K+1),BV=CV+gV+sV,yV=CV+eV+sV,wV=CV+eV+tV,fV=CV+gV+tV;j(BV,yV,wV,fV)}}}function rV(iV,CV,AV){s.push(iV),s.push(CV),s.push(AV)}function nV(iV,CV,AV){VV(iV),VV(CV),VV(AV);const gV=e.length/3,eV=u.generateTopUV(I,e,gV-3,gV-2,gV-1);lV(eV[0]),lV(eV[1]),lV(eV[2])}function j(iV,CV,AV,gV){VV(iV),VV(CV),VV(gV),VV(CV),VV(AV),VV(gV);const eV=e.length/3,K=u.generateSideWallUV(I,e,eV-6,eV-3,eV-2,eV-1);lV(K[0]),lV(K[1]),lV(K[3]),lV(K[1]),lV(K[2]),lV(K[3])}function VV(iV){e.push(s[iV*3+0]),e.push(s[iV*3+1]),e.push(s[iV*3+2])}function lV(iV){t.push(iV.x),t.push(iV.y)}}}toJSON(){const V=super.toJSON(),g=this.parameters.shapes,I=this.parameters.options;return VB(g,I,V)}static fromJSON(V,g){const I=[];for(let t=0,C=V.shapes.length;t<C;t++){const A=g[V.shapes[t]];I.push(A)}const e=V.options.extrudePath;return e!==void 0&&(V.options.extrudePath=new Bd[e.type]().fromJSON(e)),new vt(I,V.options)}}const $q={generateTopUV:function(i,V,g,I,e){const t=V[g*3],C=V[g*3+1],A=V[I*3],s=V[I*3+1],a=V[e*3],o=V[e*3+1];return[new dV(t,C),new dV(A,s),new dV(a,o)]},generateSideWallUV:function(i,V,g,I,e,t){const C=V[g*3],A=V[g*3+1],s=V[g*3+2],a=V[I*3],o=V[I*3+1],n=V[I*3+2],l=V[e*3],c=V[e*3+1],d=V[e*3+2],h=V[t*3],m=V[t*3+1],r=V[t*3+2];return Math.abs(A-o)<Math.abs(C-a)?[new dV(C,1-s),new dV(a,1-n),new dV(l,1-d),new dV(h,1-r)]:[new dV(A,1-s),new dV(o,1-n),new dV(c,1-d),new dV(m,1-r)]}};function VB(i,V,g){if(g.shapes=[],Array.isArray(i))for(let I=0,e=i.length;I<e;I++){const t=i[I];g.shapes.push(t.uuid)}else g.shapes.push(i.uuid);return V.extrudePath!==void 0&&(g.options.extrudePath=V.extrudePath.toJSON()),g}class ql extends $V{constructor(V,g=12){super(),this.type="ShapeGeometry",this.parameters={shapes:V,curveSegments:g};const I=[],e=[],t=[],C=[];let A=0,s=0;if(Array.isArray(V)===!1)a(V);else for(let o=0;o<V.length;o++)a(V[o]),this.addGroup(A,s,o),A+=s,s=0;this.setIndex(I),this.setAttribute("position",new hg(e,3)),this.setAttribute("normal",new hg(t,3)),this.setAttribute("uv",new hg(C,2));function a(o){const n=e.length/3,l=o.extractPoints(g);let c=l.shape;const d=l.holes;Oe.isClockWise(c)===!1&&(c=c.reverse());for(let m=0,r=d.length;m<r;m++){const u=d[m];Oe.isClockWise(u)===!0&&(d[m]=u.reverse())}const h=Oe.triangulateShape(c,d);for(let m=0,r=d.length;m<r;m++){const u=d[m];c=c.concat(u)}for(let m=0,r=c.length;m<r;m++){const u=c[m];e.push(u.x,u.y,0),t.push(0,0,1),C.push(u.x,u.y)}for(let m=0,r=h.length;m<r;m++){const u=h[m],b=u[0]+n,Z=u[1]+n,p=u[2]+n;I.push(b,Z,p),s+=3}}}toJSON(){const V=super.toJSON(),g=this.parameters.shapes;return gB(g,V)}static fromJSON(V,g){const I=[];for(let e=0,t=V.shapes.length;e<t;e++){const C=g[V.shapes[e]];I.push(C)}return new ql(I,V.curveSegments)}}function gB(i,V){if(V.shapes=[],Array.isArray(i))for(let g=0,I=i.length;g<I;g++){const e=i[g];V.shapes.push(e.uuid)}else V.shapes.push(i.uuid);return V}class Bl extends $V{constructor(V=1,g=8,I=6,e=0,t=Math.PI*2,C=0,A=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:V,widthSegments:g,heightSegments:I,phiStart:e,phiLength:t,thetaStart:C,thetaLength:A},g=Math.max(3,Math.floor(g)),I=Math.max(2,Math.floor(I));const s=Math.min(C+A,Math.PI);let a=0;const o=[],n=new S,l=new S,c=[],d=[],h=[],m=[];for(let r=0;r<=I;r++){const u=[],b=r/I;let Z=0;r==0&&C==0?Z=.5/g:r==I&&s==Math.PI&&(Z=-.5/g);for(let p=0;p<=g;p++){const G=p/g;n.x=-V*Math.cos(e+G*t)*Math.sin(C+b*A),n.y=V*Math.cos(C+b*A),n.z=V*Math.sin(e+G*t)*Math.sin(C+b*A),d.push(n.x,n.y,n.z),l.copy(n).normalize(),h.push(l.x,l.y,l.z),m.push(G+Z,1-b),u.push(a++)}o.push(u)}for(let r=0;r<I;r++)for(let u=0;u<g;u++){const b=o[r][u+1],Z=o[r][u],p=o[r+1][u],G=o[r+1][u+1];(r!==0||C>0)&&c.push(b,Z,G),(r!==I-1||s<Math.PI)&&c.push(Z,p,G)}this.setIndex(c),this.setAttribute("position",new hg(d,3)),this.setAttribute("normal",new hg(h,3)),this.setAttribute("uv",new hg(m,2))}static fromJSON(V){return new Bl(V.radius,V.widthSegments,V.heightSegments,V.phiStart,V.phiLength,V.thetaStart,V.thetaLength)}}class IB extends xg{constructor(V){super(),this.type="ShadowMaterial",this.color=new NV(0),this.transparent=!0,this.setValues(V)}copy(V){return super.copy(V),this.color.copy(V.color),this}}IB.prototype.isShadowMaterial=!0;class eB extends Xe{constructor(V){super(V),this.type="RawShaderMaterial"}}eB.prototype.isRawShaderMaterial=!0;class Hg extends xg{constructor(V){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new NV(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new NV(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new dV(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(V)}copy(V){return super.copy(V),this.defines={STANDARD:""},this.color.copy(V.color),this.roughness=V.roughness,this.metalness=V.metalness,this.map=V.map,this.lightMap=V.lightMap,this.lightMapIntensity=V.lightMapIntensity,this.aoMap=V.aoMap,this.aoMapIntensity=V.aoMapIntensity,this.emissive.copy(V.emissive),this.emissiveMap=V.emissiveMap,this.emissiveIntensity=V.emissiveIntensity,this.bumpMap=V.bumpMap,this.bumpScale=V.bumpScale,this.normalMap=V.normalMap,this.normalMapType=V.normalMapType,this.normalScale.copy(V.normalScale),this.displacementMap=V.displacementMap,this.displacementScale=V.displacementScale,this.displacementBias=V.displacementBias,this.roughnessMap=V.roughnessMap,this.metalnessMap=V.metalnessMap,this.alphaMap=V.alphaMap,this.envMap=V.envMap,this.envMapIntensity=V.envMapIntensity,this.refractionRatio=V.refractionRatio,this.wireframe=V.wireframe,this.wireframeLinewidth=V.wireframeLinewidth,this.wireframeLinecap=V.wireframeLinecap,this.wireframeLinejoin=V.wireframeLinejoin,this.morphTargets=V.morphTargets,this.morphNormals=V.morphNormals,this.flatShading=V.flatShading,this.vertexTangents=V.vertexTangents,this}}Hg.prototype.isMeshStandardMaterial=!0;class Wl extends Hg{constructor(V){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new dV(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(g){this.reflectivity=eI(2.5*(g-1)/(g+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new NV(1,1,1),this.setValues(V)}copy(V){return super.copy(V),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=V.clearcoat,this.clearcoatMap=V.clearcoatMap,this.clearcoatRoughness=V.clearcoatRoughness,this.clearcoatRoughnessMap=V.clearcoatRoughnessMap,this.clearcoatNormalMap=V.clearcoatNormalMap,this.clearcoatNormalScale.copy(V.clearcoatNormalScale),this.reflectivity=V.reflectivity,V.sheen?this.sheen=(this.sheen||new NV).copy(V.sheen):this.sheen=null,this.transmission=V.transmission,this.transmissionMap=V.transmissionMap,this.thickness=V.thickness,this.thicknessMap=V.thicknessMap,this.attenuationDistance=V.attenuationDistance,this.attenuationColor.copy(V.attenuationColor),this}}Wl.prototype.isMeshPhysicalMaterial=!0;class tB extends xg{constructor(V){super(),this.type="MeshPhongMaterial",this.color=new NV(16777215),this.specular=new NV(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new NV(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new dV(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=EA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(V)}copy(V){return super.copy(V),this.color.copy(V.color),this.specular.copy(V.specular),this.shininess=V.shininess,this.map=V.map,this.lightMap=V.lightMap,this.lightMapIntensity=V.lightMapIntensity,this.aoMap=V.aoMap,this.aoMapIntensity=V.aoMapIntensity,this.emissive.copy(V.emissive),this.emissiveMap=V.emissiveMap,this.emissiveIntensity=V.emissiveIntensity,this.bumpMap=V.bumpMap,this.bumpScale=V.bumpScale,this.normalMap=V.normalMap,this.normalMapType=V.normalMapType,this.normalScale.copy(V.normalScale),this.displacementMap=V.displacementMap,this.displacementScale=V.displacementScale,this.displacementBias=V.displacementBias,this.specularMap=V.specularMap,this.alphaMap=V.alphaMap,this.envMap=V.envMap,this.combine=V.combine,this.reflectivity=V.reflectivity,this.refractionRatio=V.refractionRatio,this.wireframe=V.wireframe,this.wireframeLinewidth=V.wireframeLinewidth,this.wireframeLinecap=V.wireframeLinecap,this.wireframeLinejoin=V.wireframeLinejoin,this.morphTargets=V.morphTargets,this.morphNormals=V.morphNormals,this.flatShading=V.flatShading,this}}tB.prototype.isMeshPhongMaterial=!0;class CB extends xg{constructor(V){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new NV(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new NV(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new dV(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(V)}copy(V){return super.copy(V),this.color.copy(V.color),this.map=V.map,this.gradientMap=V.gradientMap,this.lightMap=V.lightMap,this.lightMapIntensity=V.lightMapIntensity,this.aoMap=V.aoMap,this.aoMapIntensity=V.aoMapIntensity,this.emissive.copy(V.emissive),this.emissiveMap=V.emissiveMap,this.emissiveIntensity=V.emissiveIntensity,this.bumpMap=V.bumpMap,this.bumpScale=V.bumpScale,this.normalMap=V.normalMap,this.normalMapType=V.normalMapType,this.normalScale.copy(V.normalScale),this.displacementMap=V.displacementMap,this.displacementScale=V.displacementScale,this.displacementBias=V.displacementBias,this.alphaMap=V.alphaMap,this.wireframe=V.wireframe,this.wireframeLinewidth=V.wireframeLinewidth,this.wireframeLinecap=V.wireframeLinecap,this.wireframeLinejoin=V.wireframeLinejoin,this.morphTargets=V.morphTargets,this.morphNormals=V.morphNormals,this}}CB.prototype.isMeshToonMaterial=!0;class iB extends xg{constructor(V){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new dV(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(V)}copy(V){return super.copy(V),this.bumpMap=V.bumpMap,this.bumpScale=V.bumpScale,this.normalMap=V.normalMap,this.normalMapType=V.normalMapType,this.normalScale.copy(V.normalScale),this.displacementMap=V.displacementMap,this.displacementScale=V.displacementScale,this.displacementBias=V.displacementBias,this.wireframe=V.wireframe,this.wireframeLinewidth=V.wireframeLinewidth,this.morphTargets=V.morphTargets,this.morphNormals=V.morphNormals,this.flatShading=V.flatShading,this}}iB.prototype.isMeshNormalMaterial=!0;class AB extends xg{constructor(V){super(),this.type="MeshLambertMaterial",this.color=new NV(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new NV(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=EA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(V)}copy(V){return super.copy(V),this.color.copy(V.color),this.map=V.map,this.lightMap=V.lightMap,this.lightMapIntensity=V.lightMapIntensity,this.aoMap=V.aoMap,this.aoMapIntensity=V.aoMapIntensity,this.emissive.copy(V.emissive),this.emissiveMap=V.emissiveMap,this.emissiveIntensity=V.emissiveIntensity,this.specularMap=V.specularMap,this.alphaMap=V.alphaMap,this.envMap=V.envMap,this.combine=V.combine,this.reflectivity=V.reflectivity,this.refractionRatio=V.refractionRatio,this.wireframe=V.wireframe,this.wireframeLinewidth=V.wireframeLinewidth,this.wireframeLinecap=V.wireframeLinecap,this.wireframeLinejoin=V.wireframeLinejoin,this.morphTargets=V.morphTargets,this.morphNormals=V.morphNormals,this}}AB.prototype.isMeshLambertMaterial=!0;class nB extends xg{constructor(V){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new NV(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new dV(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(V)}copy(V){return super.copy(V),this.defines={MATCAP:""},this.color.copy(V.color),this.matcap=V.matcap,this.map=V.map,this.bumpMap=V.bumpMap,this.bumpScale=V.bumpScale,this.normalMap=V.normalMap,this.normalMapType=V.normalMapType,this.normalScale.copy(V.normalScale),this.displacementMap=V.displacementMap,this.displacementScale=V.displacementScale,this.displacementBias=V.displacementBias,this.alphaMap=V.alphaMap,this.morphTargets=V.morphTargets,this.morphNormals=V.morphNormals,this.flatShading=V.flatShading,this}}nB.prototype.isMeshMatcapMaterial=!0;class sB extends fC{constructor(V){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(V)}copy(V){return super.copy(V),this.scale=V.scale,this.dashSize=V.dashSize,this.gapSize=V.gapSize,this}}sB.prototype.isLineDashedMaterial=!0;const rg={arraySlice:function(i,V,g){return rg.isTypedArray(i)?new i.constructor(i.subarray(V,g!==void 0?g:i.length)):i.slice(V,g)},convertArray:function(i,V,g){return!i||!g&&i.constructor===V?i:typeof V.BYTES_PER_ELEMENT=="number"?new V(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){function V(e,t){return i[e]-i[t]}const g=i.length,I=new Array(g);for(let e=0;e!==g;++e)I[e]=e;return I.sort(V),I},sortedArray:function(i,V,g){const I=i.length,e=new i.constructor(I);for(let t=0,C=0;C!==I;++t){const A=g[t]*V;for(let s=0;s!==V;++s)e[C++]=i[A+s]}return e},flattenJSON:function(i,V,g,I){let e=1,t=i[0];for(;t!==void 0&&t[I]===void 0;)t=i[e++];if(t===void 0)return;let C=t[I];if(C!==void 0)if(Array.isArray(C))do C=t[I],C!==void 0&&(V.push(t.time),g.push.apply(g,C)),t=i[e++];while(t!==void 0);else if(C.toArray!==void 0)do C=t[I],C!==void 0&&(V.push(t.time),C.toArray(g,g.length)),t=i[e++];while(t!==void 0);else do C=t[I],C!==void 0&&(V.push(t.time),g.push(C)),t=i[e++];while(t!==void 0)},subclip:function(i,V,g,I,e=30){const t=i.clone();t.name=V;const C=[];for(let s=0;s<t.tracks.length;++s){const a=t.tracks[s],o=a.getValueSize(),n=[],l=[];for(let c=0;c<a.times.length;++c){const d=a.times[c]*e;if(!(d<g||d>=I)){n.push(a.times[c]);for(let h=0;h<o;++h)l.push(a.values[c*o+h])}}n.length!==0&&(a.times=rg.convertArray(n,a.times.constructor),a.values=rg.convertArray(l,a.values.constructor),C.push(a))}t.tracks=C;let A=1/0;for(let s=0;s<t.tracks.length;++s)A>t.tracks[s].times[0]&&(A=t.tracks[s].times[0]);for(let s=0;s<t.tracks.length;++s)t.tracks[s].shift(-1*A);return t.resetDuration(),t},makeClipAdditive:function(i,V=0,g=i,I=30){I<=0&&(I=30);const e=g.tracks.length,t=V/I;for(let C=0;C<e;++C){const A=g.tracks[C],s=A.ValueTypeName;if(s==="bool"||s==="string")continue;const a=i.tracks.find(function(r){return r.name===A.name&&r.ValueTypeName===s});if(a===void 0)continue;let o=0;const n=A.getValueSize();A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=n/3);let l=0;const c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);const d=A.times.length-1;let h;if(t<=A.times[0]){const r=o,u=n-o;h=rg.arraySlice(A.values,r,u)}else if(t>=A.times[d]){const r=d*n+o,u=r+n-o;h=rg.arraySlice(A.values,r,u)}else{const r=A.createInterpolant(),u=o,b=n-o;r.evaluate(t),h=rg.arraySlice(r.resultBuffer,u,b)}s==="quaternion"&&new Rg().fromArray(h).normalize().conjugate().toArray(h);const m=a.times.length;for(let r=0;r<m;++r){const u=r*c+l;if(s==="quaternion")Rg.multiplyQuaternionsFlat(a.values,u,h,0,a.values,u);else{const b=c-l*2;for(let Z=0;Z<b;++Z)a.values[u+Z]-=h[Z]}}}return i.blendMode=Tc,i}};class Re{constructor(V,g,I,e){this.parameterPositions=V,this._cachedIndex=0,this.resultBuffer=e!==void 0?e:new g.constructor(I),this.sampleValues=g,this.valueSize=I,this.settings=null,this.DefaultSettings_={}}evaluate(V){const g=this.parameterPositions;let I=this._cachedIndex,e=g[I],t=g[I-1];V:{g:{let C;I:{e:if(!(V<e)){for(let A=I+2;;){if(e===void 0){if(V<t)break e;return I=g.length,this._cachedIndex=I,this.afterEnd_(I-1,V,t)}if(I===A)break;if(t=e,e=g[++I],V<e)break g}C=g.length;break I}if(!(V>=t)){const A=g[1];V<A&&(I=2,t=A);for(let s=I-2;;){if(t===void 0)return this._cachedIndex=0,this.beforeStart_(0,V,e);if(I===s)break;if(e=t,t=g[--I-1],V>=t)break g}C=I,I=0;break I}break V}for(;I<C;){const A=I+C>>>1;V<g[A]?C=A:I=A+1}if(e=g[I],t=g[I-1],t===void 0)return this._cachedIndex=0,this.beforeStart_(0,V,e);if(e===void 0)return I=g.length,this._cachedIndex=I,this.afterEnd_(I-1,t,V)}this._cachedIndex=I,this.intervalChanged_(I,t,e)}return this.interpolate_(I,t,V,e)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(V){const g=this.resultBuffer,I=this.sampleValues,e=this.valueSize,t=V*e;for(let C=0;C!==e;++C)g[C]=I[t+C];return g}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Re.prototype.beforeStart_=Re.prototype.copySampleValue_;Re.prototype.afterEnd_=Re.prototype.copySampleValue_;class lB extends Re{constructor(V,g,I,e){super(V,g,I,e),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:eC,endingEnd:eC}}intervalChanged_(V,g,I){const e=this.parameterPositions;let t=V-2,C=V+1,A=e[t],s=e[C];if(A===void 0)switch(this.getSettings_().endingStart){case tC:t=V,A=2*g-I;break;case vA:t=e.length-2,A=g+e[t]-e[t+1];break;default:t=V,A=I}if(s===void 0)switch(this.getSettings_().endingEnd){case tC:C=V,s=2*I-g;break;case vA:C=1,s=I+e[1]-e[0];break;default:C=V-1,s=g}const a=(I-g)*.5,o=this.valueSize;this._weightPrev=a/(g-A),this._weightNext=a/(s-I),this._offsetPrev=t*o,this._offsetNext=C*o}interpolate_(V,g,I,e){const t=this.resultBuffer,C=this.sampleValues,A=this.valueSize,s=V*A,a=s-A,o=this._offsetPrev,n=this._offsetNext,l=this._weightPrev,c=this._weightNext,d=(I-g)/(e-g),h=d*d,m=h*d,r=-l*m+2*l*h-l*d,u=(1+l)*m+(-1.5-2*l)*h+(-.5+l)*d+1,b=(-1-c)*m+(1.5+c)*h+.5*d,Z=c*m-c*h;for(let p=0;p!==A;++p)t[p]=r*C[o+p]+u*C[a+p]+b*C[s+p]+Z*C[n+p];return t}}class Rd extends Re{constructor(V,g,I,e){super(V,g,I,e)}interpolate_(V,g,I,e){const t=this.resultBuffer,C=this.sampleValues,A=this.valueSize,s=V*A,a=s-A,o=(I-g)/(e-g),n=1-o;for(let l=0;l!==A;++l)t[l]=C[a+l]*n+C[s+l]*o;return t}}class aB extends Re{constructor(V,g,I,e){super(V,g,I,e)}interpolate_(V){return this.copySampleValue_(V-1)}}class Ce{constructor(V,g,I,e){if(V===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(g===void 0||g.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+V);this.name=V,this.times=rg.convertArray(g,this.TimeBufferType),this.values=rg.convertArray(I,this.ValueBufferType),this.setInterpolation(e||this.DefaultInterpolation)}static toJSON(V){const g=V.constructor;let I;if(g.toJSON!==this.toJSON)I=g.toJSON(V);else{I={name:V.name,times:rg.convertArray(V.times,Array),values:rg.convertArray(V.values,Array)};const e=V.getInterpolation();e!==V.DefaultInterpolation&&(I.interpolation=e)}return I.type=V.ValueTypeName,I}InterpolantFactoryMethodDiscrete(V){return new aB(this.times,this.values,this.getValueSize(),V)}InterpolantFactoryMethodLinear(V){return new Rd(this.times,this.values,this.getValueSize(),V)}InterpolantFactoryMethodSmooth(V){return new lB(this.times,this.values,this.getValueSize(),V)}setInterpolation(V){let g;switch(V){case hi:g=this.InterpolantFactoryMethodDiscrete;break;case hC:g=this.InterpolantFactoryMethodLinear;break;case dn:g=this.InterpolantFactoryMethodSmooth;break}if(g===void 0){const I="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(V!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(I);return console.warn("THREE.KeyframeTrack:",I),this}return this.createInterpolant=g,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return hi;case this.InterpolantFactoryMethodLinear:return hC;case this.InterpolantFactoryMethodSmooth:return dn}}getValueSize(){return this.values.length/this.times.length}shift(V){if(V!==0){const g=this.times;for(let I=0,e=g.length;I!==e;++I)g[I]+=V}return this}scale(V){if(V!==1){const g=this.times;for(let I=0,e=g.length;I!==e;++I)g[I]*=V}return this}trim(V,g){const I=this.times,e=I.length;let t=0,C=e-1;for(;t!==e&&I[t]<V;)++t;for(;C!==-1&&I[C]>g;)--C;if(++C,t!==0||C!==e){t>=C&&(C=Math.max(C,1),t=C-1);const A=this.getValueSize();this.times=rg.arraySlice(I,t,C),this.values=rg.arraySlice(this.values,t*A,C*A)}return this}validate(){let V=!0;const g=this.getValueSize();g-Math.floor(g)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),V=!1);const I=this.times,e=this.values,t=I.length;t===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),V=!1);let C=null;for(let A=0;A!==t;A++){const s=I[A];if(typeof s=="number"&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,A,s),V=!1;break}if(C!==null&&C>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,A,s,C),V=!1;break}C=s}if(e!==void 0&&rg.isTypedArray(e))for(let A=0,s=e.length;A!==s;++A){const a=e[A];if(isNaN(a)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,A,a),V=!1;break}}return V}optimize(){const V=rg.arraySlice(this.times),g=rg.arraySlice(this.values),I=this.getValueSize(),e=this.getInterpolation()===dn,t=V.length-1;let C=1;for(let A=1;A<t;++A){let s=!1;const a=V[A],o=V[A+1];if(a!==o&&(A!==1||a!==V[0]))if(e)s=!0;else{const n=A*I,l=n-I,c=n+I;for(let d=0;d!==I;++d){const h=g[n+d];if(h!==g[l+d]||h!==g[c+d]){s=!0;break}}}if(s){if(A!==C){V[C]=V[A];const n=A*I,l=C*I;for(let c=0;c!==I;++c)g[l+c]=g[n+c]}++C}}if(t>0){V[C]=V[t];for(let A=t*I,s=C*I,a=0;a!==I;++a)g[s+a]=g[A+a];++C}return C!==V.length?(this.times=rg.arraySlice(V,0,C),this.values=rg.arraySlice(g,0,C*I)):(this.times=V,this.values=g),this}clone(){const V=rg.arraySlice(this.times,0),g=rg.arraySlice(this.values,0),I=this.constructor,e=new I(this.name,V,g);return e.createInterpolant=this.createInterpolant,e}}Ce.prototype.TimeBufferType=Float32Array;Ce.prototype.ValueBufferType=Float32Array;Ce.prototype.DefaultInterpolation=hC;class SC extends Ce{}SC.prototype.ValueTypeName="bool";SC.prototype.ValueBufferType=Array;SC.prototype.DefaultInterpolation=hi;SC.prototype.InterpolantFactoryMethodLinear=void 0;SC.prototype.InterpolantFactoryMethodSmooth=void 0;class Yd extends Ce{}Yd.prototype.ValueTypeName="color";class pi extends Ce{}pi.prototype.ValueTypeName="number";class oB extends Re{constructor(V,g,I,e){super(V,g,I,e)}interpolate_(V,g,I,e){const t=this.resultBuffer,C=this.sampleValues,A=this.valueSize,s=(I-g)/(e-g);let a=V*A;for(let o=a+A;a!==o;a+=4)Rg.slerpFlat(t,0,C,a-A,C,a,s);return t}}class FC extends Ce{InterpolantFactoryMethodLinear(V){return new oB(this.times,this.values,this.getValueSize(),V)}}FC.prototype.ValueTypeName="quaternion";FC.prototype.DefaultInterpolation=hC;FC.prototype.InterpolantFactoryMethodSmooth=void 0;class vC extends Ce{}vC.prototype.ValueTypeName="string";vC.prototype.ValueBufferType=Array;vC.prototype.DefaultInterpolation=hi;vC.prototype.InterpolantFactoryMethodLinear=void 0;vC.prototype.InterpolantFactoryMethodSmooth=void 0;class qi extends Ce{}qi.prototype.ValueTypeName="vector";class fs{constructor(V,g=-1,I,e=sl){this.name=V,this.tracks=I,this.duration=g,this.blendMode=e,this.uuid=KI(),this.duration<0&&this.resetDuration()}static parse(V){const g=[],I=V.tracks,e=1/(V.fps||1);for(let C=0,A=I.length;C!==A;++C)g.push(dB(I[C]).scale(e));const t=new this(V.name,V.duration,g,V.blendMode);return t.uuid=V.uuid,t}static toJSON(V){const g=[],I=V.tracks,e={name:V.name,duration:V.duration,tracks:g,uuid:V.uuid,blendMode:V.blendMode};for(let t=0,C=I.length;t!==C;++t)g.push(Ce.toJSON(I[t]));return e}static CreateFromMorphTargetSequence(V,g,I,e){const t=g.length,C=[];for(let A=0;A<t;A++){let s=[],a=[];s.push((A+t-1)%t,A,(A+1)%t),a.push(0,1,0);const o=rg.getKeyframeOrder(s);s=rg.sortedArray(s,1,o),a=rg.sortedArray(a,1,o),!e&&s[0]===0&&(s.push(t),a.push(a[0])),C.push(new pi(".morphTargetInfluences["+g[A].name+"]",s,a).scale(1/I))}return new this(V,-1,C)}static findByName(V,g){let I=V;if(!Array.isArray(V)){const e=V;I=e.geometry&&e.geometry.animations||e.animations}for(let e=0;e<I.length;e++)if(I[e].name===g)return I[e];return null}static CreateClipsFromMorphTargetSequences(V,g,I){const e={},t=/^([\w-]*?)([\d]+)$/;for(let A=0,s=V.length;A<s;A++){const a=V[A],o=a.name.match(t);if(o&&o.length>1){const n=o[1];let l=e[n];l||(e[n]=l=[]),l.push(a)}}const C=[];for(const A in e)C.push(this.CreateFromMorphTargetSequence(A,e[A],g,I));return C}static parseAnimation(V,g){if(!V)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const I=function(n,l,c,d,h){if(c.length!==0){const m=[],r=[];rg.flattenJSON(c,m,r,d),m.length!==0&&h.push(new n(l,m,r))}},e=[],t=V.name||"default",C=V.fps||30,A=V.blendMode;let s=V.length||-1;const a=V.hierarchy||[];for(let n=0;n<a.length;n++){const l=a[n].keys;if(!(!l||l.length===0))if(l[0].morphTargets){const c={};let d;for(d=0;d<l.length;d++)if(l[d].morphTargets)for(let h=0;h<l[d].morphTargets.length;h++)c[l[d].morphTargets[h]]=-1;for(const h in c){const m=[],r=[];for(let u=0;u!==l[d].morphTargets.length;++u){const b=l[d];m.push(b.time),r.push(b.morphTarget===h?1:0)}e.push(new pi(".morphTargetInfluence["+h+"]",m,r))}s=c.length*(C||1)}else{const c=".bones["+g[n].name+"]";I(qi,c+".position",l,"pos",e),I(FC,c+".quaternion",l,"rot",e),I(qi,c+".scale",l,"scl",e)}}return e.length===0?null:new this(t,s,e,A)}resetDuration(){const V=this.tracks;let g=0;for(let I=0,e=V.length;I!==e;++I){const t=this.tracks[I];g=Math.max(g,t.times[t.times.length-1])}return this.duration=g,this}trim(){for(let V=0;V<this.tracks.length;V++)this.tracks[V].trim(0,this.duration);return this}validate(){let V=!0;for(let g=0;g<this.tracks.length;g++)V=V&&this.tracks[g].validate();return V}optimize(){for(let V=0;V<this.tracks.length;V++)this.tracks[V].optimize();return this}clone(){const V=[];for(let g=0;g<this.tracks.length;g++)V.push(this.tracks[g].clone());return new this.constructor(this.name,this.duration,V,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function cB(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return pi;case"vector":case"vector2":case"vector3":case"vector4":return qi;case"color":return Yd;case"quaternion":return FC;case"bool":case"boolean":return SC;case"string":return vC}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function dB(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const V=cB(i.type);if(i.times===void 0){const g=[],I=[];rg.flattenJSON(i.keys,g,I,"value"),i.times=g,i.values=I}return V.parse!==void 0?V.parse(i):new V(i.name,i.times,i.values,i.interpolation)}const bC={enabled:!1,files:{},add:function(i,V){this.enabled!==!1&&(this.files[i]=V)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class rB{constructor(V,g,I){const e=this;let t=!1,C=0,A=0,s;const a=[];this.onStart=void 0,this.onLoad=V,this.onProgress=g,this.onError=I,this.itemStart=function(o){A++,t===!1&&e.onStart!==void 0&&e.onStart(o,C,A),t=!0},this.itemEnd=function(o){C++,e.onProgress!==void 0&&e.onProgress(o,C,A),C===A&&(t=!1,e.onLoad!==void 0&&e.onLoad())},this.itemError=function(o){e.onError!==void 0&&e.onError(o)},this.resolveURL=function(o){return s?s(o):o},this.setURLModifier=function(o){return s=o,this},this.addHandler=function(o,n){return a.push(o,n),this},this.removeHandler=function(o){const n=a.indexOf(o);return n!==-1&&a.splice(n,2),this},this.getHandler=function(o){for(let n=0,l=a.length;n<l;n+=2){const c=a[n],d=a[n+1];if(c.global&&(c.lastIndex=0),c.test(o))return d}return null}}}const hB=new rB;class He{constructor(V){this.manager=V!==void 0?V:hB,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(V,g){const I=this;return new Promise(function(e,t){I.load(V,e,g,t)})}parse(){}setCrossOrigin(V){return this.crossOrigin=V,this}setWithCredentials(V){return this.withCredentials=V,this}setPath(V){return this.path=V,this}setResourcePath(V){return this.resourcePath=V,this}setRequestHeader(V){return this.requestHeader=V,this}}const UI={};class yl extends He{constructor(V){super(V)}load(V,g,I,e){V===void 0&&(V=""),this.path!==void 0&&(V=this.path+V),V=this.manager.resolveURL(V);const t=this,C=bC.get(V);if(C!==void 0)return t.manager.itemStart(V),setTimeout(function(){g&&g(C),t.manager.itemEnd(V)},0),C;if(UI[V]!==void 0){UI[V].push({onLoad:g,onProgress:I,onError:e});return}const A=/^data:(.*?)(;base64)?,(.*)$/,s=V.match(A);let a;if(s){const o=s[1],n=!!s[2];let l=s[3];l=decodeURIComponent(l),n&&(l=atob(l));try{let c;const d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":const h=new Uint8Array(l.length);for(let r=0;r<l.length;r++)h[r]=l.charCodeAt(r);d==="blob"?c=new Blob([h.buffer],{type:o}):c=h.buffer;break;case"document":c=new DOMParser().parseFromString(l,o);break;case"json":c=JSON.parse(l);break;default:c=l;break}setTimeout(function(){g&&g(c),t.manager.itemEnd(V)},0)}catch(c){setTimeout(function(){e&&e(c),t.manager.itemError(V),t.manager.itemEnd(V)},0)}}else{UI[V]=[],UI[V].push({onLoad:g,onProgress:I,onError:e}),a=new XMLHttpRequest,a.open("GET",V,!0),a.addEventListener("load",function(o){const n=this.response,l=UI[V];if(delete UI[V],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),bC.add(V,n);for(let c=0,d=l.length;c<d;c++){const h=l[c];h.onLoad&&h.onLoad(n)}t.manager.itemEnd(V)}else{for(let c=0,d=l.length;c<d;c++){const h=l[c];h.onError&&h.onError(o)}t.manager.itemError(V),t.manager.itemEnd(V)}},!1),a.addEventListener("progress",function(o){const n=UI[V];for(let l=0,c=n.length;l<c;l++){const d=n[l];d.onProgress&&d.onProgress(o)}},!1),a.addEventListener("error",function(o){const n=UI[V];delete UI[V];for(let l=0,c=n.length;l<c;l++){const d=n[l];d.onError&&d.onError(o)}t.manager.itemError(V),t.manager.itemEnd(V)},!1),a.addEventListener("abort",function(o){const n=UI[V];delete UI[V];for(let l=0,c=n.length;l<c;l++){const d=n[l];d.onError&&d.onError(o)}t.manager.itemError(V),t.manager.itemEnd(V)},!1),this.responseType!==void 0&&(a.responseType=this.responseType),this.withCredentials!==void 0&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const o in this.requestHeader)a.setRequestHeader(o,this.requestHeader[o]);a.send(null)}return t.manager.itemStart(V),a}setResponseType(V){return this.responseType=V,this}setMimeType(V){return this.mimeType=V,this}}class wd extends He{constructor(V){super(V)}load(V,g,I,e){this.path!==void 0&&(V=this.path+V),V=this.manager.resolveURL(V);const t=this,C=bC.get(V);if(C!==void 0)return t.manager.itemStart(V),setTimeout(function(){g&&g(C),t.manager.itemEnd(V)},0),C;const A=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){A.removeEventListener("load",s,!1),A.removeEventListener("error",a,!1),bC.add(V,this),g&&g(this),t.manager.itemEnd(V)}function a(o){A.removeEventListener("load",s,!1),A.removeEventListener("error",a,!1),e&&e(o),t.manager.itemError(V),t.manager.itemEnd(V)}return A.addEventListener("load",s,!1),A.addEventListener("error",a,!1),V.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(A.crossOrigin=this.crossOrigin),t.manager.itemStart(V),A.src=V,A}}class mB extends He{constructor(V){super(V)}load(V,g,I,e){const t=new Ni,C=new wd(this.manager);C.setCrossOrigin(this.crossOrigin),C.setPath(this.path);let A=0;function s(a){C.load(V[a],function(o){t.images[a]=o,A++,A===6&&(t.needsUpdate=!0,g&&g(t))},void 0,e)}for(let a=0;a<V.length;++a)s(a);return t}}class Le extends He{constructor(V){super(V)}load(V,g,I,e){const t=new Mg,C=new wd(this.manager);return C.setCrossOrigin(this.crossOrigin),C.setPath(this.path),C.load(V,function(A){t.image=A;const s=V.search(/\.jpe?g($|\?)/i)>0||V.search(/^data\:image\/jpeg/)===0;t.format=s?je:NI,t.needsUpdate=!0,g!==void 0&&g(t)},I,e),t}}class uB extends JI{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(V){this.curves.push(V)}closePath(){const V=this.curves[0].getPoint(0),g=this.curves[this.curves.length-1].getPoint(1);V.equals(g)||this.curves.push(new $A(g,V))}getPoint(V){const g=V*this.getLength(),I=this.getCurveLengths();let e=0;for(;e<I.length;){if(I[e]>=g){const t=I[e]-g,C=this.curves[e],A=C.getLength(),s=A===0?0:1-t/A;return C.getPointAt(s)}e++}return null}getLength(){const V=this.getCurveLengths();return V[V.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const V=[];let g=0;for(let I=0,e=this.curves.length;I<e;I++)g+=this.curves[I].getLength(),V.push(g);return this.cacheLengths=V,V}getSpacedPoints(V=40){const g=[];for(let I=0;I<=V;I++)g.push(this.getPoint(I/V));return this.autoClose&&g.push(g[0]),g}getPoints(V=12){const g=[];let I;for(let e=0,t=this.curves;e<t.length;e++){const C=t[e],A=C&&C.isEllipseCurve?V*2:C&&(C.isLineCurve||C.isLineCurve3)?1:C&&C.isSplineCurve?V*C.points.length:V,s=C.getPoints(A);for(let a=0;a<s.length;a++){const o=s[a];I&&I.equals(o)||(g.push(o),I=o)}}return this.autoClose&&g.length>1&&!g[g.length-1].equals(g[0])&&g.push(g[0]),g}copy(V){super.copy(V),this.curves=[];for(let g=0,I=V.curves.length;g<I;g++){const e=V.curves[g];this.curves.push(e.clone())}return this.autoClose=V.autoClose,this}toJSON(){const V=super.toJSON();V.autoClose=this.autoClose,V.curves=[];for(let g=0,I=this.curves.length;g<I;g++){const e=this.curves[g];V.curves.push(e.toJSON())}return V}fromJSON(V){super.fromJSON(V),this.autoClose=V.autoClose,this.curves=[];for(let g=0,I=V.curves.length;g<I;g++){const e=V.curves[g];this.curves.push(new Bd[e.type]().fromJSON(e))}return this}}class Ss extends uB{constructor(V){super(),this.type="Path",this.currentPoint=new dV,V&&this.setFromPoints(V)}setFromPoints(V){this.moveTo(V[0].x,V[0].y);for(let g=1,I=V.length;g<I;g++)this.lineTo(V[g].x,V[g].y);return this}moveTo(V,g){return this.currentPoint.set(V,g),this}lineTo(V,g){const I=new $A(this.currentPoint.clone(),new dV(V,g));return this.curves.push(I),this.currentPoint.set(V,g),this}quadraticCurveTo(V,g,I,e){const t=new Gl(this.currentPoint.clone(),new dV(V,g),new dV(I,e));return this.curves.push(t),this.currentPoint.set(I,e),this}bezierCurveTo(V,g,I,e,t,C){const A=new Zl(this.currentPoint.clone(),new dV(V,g),new dV(I,e),new dV(t,C));return this.curves.push(A),this.currentPoint.set(t,C),this}splineThru(V){const g=[this.currentPoint.clone()].concat(V),I=new pl(g);return this.curves.push(I),this.currentPoint.copy(V[V.length-1]),this}arc(V,g,I,e,t,C){const A=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(V+A,g+s,I,e,t,C),this}absarc(V,g,I,e,t,C){return this.absellipse(V,g,I,I,e,t,C),this}ellipse(V,g,I,e,t,C,A,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absellipse(V+a,g+o,I,e,t,C,A,s),this}absellipse(V,g,I,e,t,C,A,s){const a=new _A(V,g,I,e,t,C,A,s);if(this.curves.length>0){const n=a.getPoint(0);n.equals(this.currentPoint)||this.lineTo(n.x,n.y)}this.curves.push(a);const o=a.getPoint(1);return this.currentPoint.copy(o),this}copy(V){return super.copy(V),this.currentPoint.copy(V.currentPoint),this}toJSON(){const V=super.toJSON();return V.currentPoint=this.currentPoint.toArray(),V}fromJSON(V){return super.fromJSON(V),this.currentPoint.fromArray(V.currentPoint),this}}class gn extends Ss{constructor(V){super(V),this.uuid=KI(),this.type="Shape",this.holes=[]}getPointsHoles(V){const g=[];for(let I=0,e=this.holes.length;I<e;I++)g[I]=this.holes[I].getPoints(V);return g}extractPoints(V){return{shape:this.getPoints(V),holes:this.getPointsHoles(V)}}copy(V){super.copy(V),this.holes=[];for(let g=0,I=V.holes.length;g<I;g++){const e=V.holes[g];this.holes.push(e.clone())}return this}toJSON(){const V=super.toJSON();V.uuid=this.uuid,V.holes=[];for(let g=0,I=this.holes.length;g<I;g++){const e=this.holes[g];V.holes.push(e.toJSON())}return V}fromJSON(V){super.fromJSON(V),this.uuid=V.uuid,this.holes=[];for(let g=0,I=V.holes.length;g<I;g++){const e=V.holes[g];this.holes.push(new Ss().fromJSON(e))}return this}}class te extends UV{constructor(V,g=1){super(),this.type="Light",this.color=new NV(V),this.intensity=g}dispose(){}copy(V){return super.copy(V),this.color.copy(V.color),this.intensity=V.intensity,this}toJSON(V){const g=super.toJSON(V);return g.object.color=this.color.getHex(),g.object.intensity=this.intensity,this.groundColor!==void 0&&(g.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(g.object.distance=this.distance),this.angle!==void 0&&(g.object.angle=this.angle),this.decay!==void 0&&(g.object.decay=this.decay),this.penumbra!==void 0&&(g.object.penumbra=this.penumbra),this.shadow!==void 0&&(g.object.shadow=this.shadow.toJSON()),g}}te.prototype.isLight=!0;class Xl extends te{constructor(V,g,I){super(V,I),this.type="HemisphereLight",this.position.copy(UV.DefaultUp),this.updateMatrix(),this.groundColor=new NV(g)}copy(V){return te.prototype.copy.call(this,V),this.groundColor.copy(V.groundColor),this}}Xl.prototype.isHemisphereLight=!0;const Fo=new JV,vo=new S,No=new S;class Rl{constructor(V){this.camera=V,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new dV(512,512),this.map=null,this.mapPass=null,this.matrix=new JV,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ki,this._frameExtents=new dV(1,1),this._viewportCount=1,this._viewports=[new eg(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(V){const g=this.camera,I=this.matrix;vo.setFromMatrixPosition(V.matrixWorld),g.position.copy(vo),No.setFromMatrixPosition(V.target.matrixWorld),g.lookAt(No),g.updateMatrixWorld(),Fo.multiplyMatrices(g.projectionMatrix,g.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Fo),I.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),I.multiply(g.projectionMatrix),I.multiply(g.matrixWorldInverse)}getViewport(V){return this._viewports[V]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(V){return this.camera=V.camera.clone(),this.bias=V.bias,this.radius=V.radius,this.mapSize.copy(V.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const V={};return this.bias!==0&&(V.bias=this.bias),this.normalBias!==0&&(V.normalBias=this.normalBias),this.radius!==1&&(V.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(V.mapSize=this.mapSize.toArray()),V.camera=this.camera.toJSON(!1).object,delete V.camera.matrix,V}}class Hd extends Rl{constructor(){super(new jg(50,1,.5,500)),this.focus=1}updateMatrices(V){const g=this.camera,I=ui*2*V.angle*this.focus,e=this.mapSize.width/this.mapSize.height,t=V.distance||g.far;(I!==g.fov||e!==g.aspect||t!==g.far)&&(g.fov=I,g.aspect=e,g.far=t,g.updateProjectionMatrix()),super.updateMatrices(V)}copy(V){return super.copy(V),this.focus=V.focus,this}}Hd.prototype.isSpotLightShadow=!0;class Yl extends te{constructor(V,g,I=0,e=Math.PI/3,t=0,C=1){super(V,g),this.type="SpotLight",this.position.copy(UV.DefaultUp),this.updateMatrix(),this.target=new UV,this.distance=I,this.angle=e,this.penumbra=t,this.decay=C,this.shadow=new Hd}get power(){return this.intensity*Math.PI}set power(V){this.intensity=V/Math.PI}dispose(){this.shadow.dispose()}copy(V){return super.copy(V),this.distance=V.distance,this.angle=V.angle,this.penumbra=V.penumbra,this.decay=V.decay,this.target=V.target.clone(),this.shadow=V.shadow.clone(),this}}Yl.prototype.isSpotLight=!0;const Ko=new JV,EC=new S,Dn=new S;class fd extends Rl{constructor(){super(new jg(90,1,.5,500)),this._frameExtents=new dV(4,2),this._viewportCount=6,this._viewports=[new eg(2,1,1,1),new eg(0,1,1,1),new eg(3,1,1,1),new eg(1,1,1,1),new eg(3,0,1,1),new eg(1,0,1,1)],this._cubeDirections=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],this._cubeUps=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)]}updateMatrices(V,g=0){const I=this.camera,e=this.matrix,t=V.distance||I.far;t!==I.far&&(I.far=t,I.updateProjectionMatrix()),EC.setFromMatrixPosition(V.matrixWorld),I.position.copy(EC),Dn.copy(I.position),Dn.add(this._cubeDirections[g]),I.up.copy(this._cubeUps[g]),I.lookAt(Dn),I.updateMatrixWorld(),e.makeTranslation(-EC.x,-EC.y,-EC.z),Ko.multiplyMatrices(I.projectionMatrix,I.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ko)}}fd.prototype.isPointLightShadow=!0;class Sd extends te{constructor(V,g,I=0,e=1){super(V,g),this.type="PointLight",this.distance=I,this.decay=e,this.shadow=new fd}get power(){return this.intensity*4*Math.PI}set power(V){this.intensity=V/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(V){return super.copy(V),this.distance=V.distance,this.decay=V.decay,this.shadow=V.shadow.clone(),this}}Sd.prototype.isPointLight=!0;class In extends al{constructor(V=-1,g=1,I=1,e=-1,t=.1,C=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=V,this.right=g,this.top=I,this.bottom=e,this.near=t,this.far=C,this.updateProjectionMatrix()}copy(V,g){return super.copy(V,g),this.left=V.left,this.right=V.right,this.top=V.top,this.bottom=V.bottom,this.near=V.near,this.far=V.far,this.zoom=V.zoom,this.view=V.view===null?null:Object.assign({},V.view),this}setViewOffset(V,g,I,e,t,C){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=V,this.view.fullHeight=g,this.view.offsetX=I,this.view.offsetY=e,this.view.width=t,this.view.height=C,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const V=(this.right-this.left)/(2*this.zoom),g=(this.top-this.bottom)/(2*this.zoom),I=(this.right+this.left)/2,e=(this.top+this.bottom)/2;let t=I-V,C=I+V,A=e+g,s=e-g;if(this.view!==null&&this.view.enabled){const a=(this.right-this.left)/this.view.fullWidth/this.zoom,o=(this.top-this.bottom)/this.view.fullHeight/this.zoom;t+=a*this.view.offsetX,C=t+a*this.view.width,A-=o*this.view.offsetY,s=A-o*this.view.height}this.projectionMatrix.makeOrthographic(t,C,A,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(V){const g=super.toJSON(V);return g.object.zoom=this.zoom,g.object.left=this.left,g.object.right=this.right,g.object.top=this.top,g.object.bottom=this.bottom,g.object.near=this.near,g.object.far=this.far,this.view!==null&&(g.object.view=Object.assign({},this.view)),g}}In.prototype.isOrthographicCamera=!0;class Fd extends Rl{constructor(){super(new In(-5,5,5,-5,.5,500))}}Fd.prototype.isDirectionalLightShadow=!0;class en extends te{constructor(V,g){super(V,g),this.type="DirectionalLight",this.position.copy(UV.DefaultUp),this.updateMatrix(),this.target=new UV,this.shadow=new Fd}dispose(){this.shadow.dispose()}copy(V){return super.copy(V),this.target=V.target.clone(),this.shadow=V.shadow.clone(),this}}en.prototype.isDirectionalLight=!0;class wl extends te{constructor(V,g){super(V,g),this.type="AmbientLight"}}wl.prototype.isAmbientLight=!0;class bB extends te{constructor(V,g,I=10,e=10){super(V,g),this.type="RectAreaLight",this.width=I,this.height=e}copy(V){return super.copy(V),this.width=V.width,this.height=V.height,this}toJSON(V){const g=super.toJSON(V);return g.object.width=this.width,g.object.height=this.height,g}}bB.prototype.isRectAreaLight=!0;class vd{constructor(){this.coefficients=[];for(let V=0;V<9;V++)this.coefficients.push(new S)}set(V){for(let g=0;g<9;g++)this.coefficients[g].copy(V[g]);return this}zero(){for(let V=0;V<9;V++)this.coefficients[V].set(0,0,0);return this}getAt(V,g){const I=V.x,e=V.y,t=V.z,C=this.coefficients;return g.copy(C[0]).multiplyScalar(.282095),g.addScaledVector(C[1],.488603*e),g.addScaledVector(C[2],.488603*t),g.addScaledVector(C[3],.488603*I),g.addScaledVector(C[4],1.092548*(I*e)),g.addScaledVector(C[5],1.092548*(e*t)),g.addScaledVector(C[6],.315392*(3*t*t-1)),g.addScaledVector(C[7],1.092548*(I*t)),g.addScaledVector(C[8],.546274*(I*I-e*e)),g}getIrradianceAt(V,g){const I=V.x,e=V.y,t=V.z,C=this.coefficients;return g.copy(C[0]).multiplyScalar(.886227),g.addScaledVector(C[1],2*.511664*e),g.addScaledVector(C[2],2*.511664*t),g.addScaledVector(C[3],2*.511664*I),g.addScaledVector(C[4],2*.429043*I*e),g.addScaledVector(C[5],2*.429043*e*t),g.addScaledVector(C[6],.743125*t*t-.247708),g.addScaledVector(C[7],2*.429043*I*t),g.addScaledVector(C[8],.429043*(I*I-e*e)),g}add(V){for(let g=0;g<9;g++)this.coefficients[g].add(V.coefficients[g]);return this}addScaledSH(V,g){for(let I=0;I<9;I++)this.coefficients[I].addScaledVector(V.coefficients[I],g);return this}scale(V){for(let g=0;g<9;g++)this.coefficients[g].multiplyScalar(V);return this}lerp(V,g){for(let I=0;I<9;I++)this.coefficients[I].lerp(V.coefficients[I],g);return this}equals(V){for(let g=0;g<9;g++)if(!this.coefficients[g].equals(V.coefficients[g]))return!1;return!0}copy(V){return this.set(V.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(V,g=0){const I=this.coefficients;for(let e=0;e<9;e++)I[e].fromArray(V,g+e*3);return this}toArray(V=[],g=0){const I=this.coefficients;for(let e=0;e<9;e++)I[e].toArray(V,g+e*3);return V}static getBasisAt(V,g){const I=V.x,e=V.y,t=V.z;g[0]=.282095,g[1]=.488603*e,g[2]=.488603*t,g[3]=.488603*I,g[4]=1.092548*I*e,g[5]=1.092548*e*t,g[6]=.315392*(3*t*t-1),g[7]=1.092548*I*t,g[8]=.546274*(I*I-e*e)}}vd.prototype.isSphericalHarmonics3=!0;class Hl extends te{constructor(V=new vd,g=1){super(void 0,g),this.sh=V}copy(V){return super.copy(V),this.sh.copy(V.sh),this}fromJSON(V){return this.intensity=V.intensity,this.sh.fromArray(V.sh),this}toJSON(V){const g=super.toJSON(V);return g.object.sh=this.sh.toArray(),g}}Hl.prototype.isLightProbe=!0;class aC{static decodeText(V){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(V);let g="";for(let I=0,e=V.length;I<e;I++)g+=String.fromCharCode(V[I]);try{return decodeURIComponent(escape(g))}catch(I){return g}}static extractUrlBase(V){const g=V.lastIndexOf("/");return g===-1?"./":V.substr(0,g+1)}}class ZB extends $V{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(V){return super.copy(V),this.instanceCount=V.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const V=super.toJSON(this);return V.instanceCount=this.instanceCount,V.isInstancedBufferGeometry=!0,V}}ZB.prototype.isInstancedBufferGeometry=!0;class Nd extends qg{constructor(V,g,I,e=1){typeof I=="number"&&(e=I,I=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(V,g,I),this.meshPerAttribute=e}copy(V){return super.copy(V),this.meshPerAttribute=V.meshPerAttribute,this}toJSON(){const V=super.toJSON();return V.meshPerAttribute=this.meshPerAttribute,V.isInstancedBufferAttribute=!0,V}}Nd.prototype.isInstancedBufferAttribute=!0;class Kd extends He{constructor(V){super(V),typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(V){return this.options=V,this}load(V,g,I,e){V===void 0&&(V=""),this.path!==void 0&&(V=this.path+V),V=this.manager.resolveURL(V);const t=this,C=bC.get(V);if(C!==void 0)return t.manager.itemStart(V),setTimeout(function(){g&&g(C),t.manager.itemEnd(V)},0),C;const A={};A.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",A.headers=this.requestHeader,fetch(V,A).then(function(s){return s.blob()}).then(function(s){return createImageBitmap(s,Object.assign(t.options,{colorSpaceConversion:"none"}))}).then(function(s){bC.add(V,s),g&&g(s),t.manager.itemEnd(V)}).catch(function(s){e&&e(s),t.manager.itemError(V),t.manager.itemEnd(V)}),t.manager.itemStart(V)}}Kd.prototype.isImageBitmapLoader=!0;let hA;const Jd={getContext:function(){return hA===void 0&&(hA=new(window.AudioContext||window.webkitAudioContext)),hA},setContext:function(i){hA=i}};class GB extends He{constructor(V){super(V)}load(V,g,I,e){const t=this,C=new yl(this.manager);C.setResponseType("arraybuffer"),C.setPath(this.path),C.setRequestHeader(this.requestHeader),C.setWithCredentials(this.withCredentials),C.load(V,function(A){try{const s=A.slice(0);Jd.getContext().decodeAudioData(s,function(o){g(o)})}catch(s){e?e(s):console.error(s),t.manager.itemError(V)}},I,e)}}class pB extends Hl{constructor(V,g,I=1){super(void 0,I);const e=new NV().set(V),t=new NV().set(g),C=new S(e.r,e.g,e.b),A=new S(t.r,t.g,t.b),s=Math.sqrt(Math.PI),a=s*Math.sqrt(.75);this.sh.coefficients[0].copy(C).add(A).multiplyScalar(s),this.sh.coefficients[1].copy(C).sub(A).multiplyScalar(a)}}pB.prototype.isHemisphereLightProbe=!0;class qB extends Hl{constructor(V,g=1){super(void 0,g);const I=new NV().set(V);this.sh.coefficients[0].set(I.r,I.g,I.b).multiplyScalar(2*Math.sqrt(Math.PI))}}qB.prototype.isAmbientLightProbe=!0;class BB{constructor(V=!0){this.autoStart=V,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Jo(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let V=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const g=Jo();V=(g-this.oldTime)/1e3,this.oldTime=g,this.elapsedTime+=V}return V}}function Jo(){return(typeof performance=="undefined"?Date:performance).now()}const at=new S,Mo=new Rg,WB=new S,ot=new S;class yB extends UV{constructor(){super(),this.type="AudioListener",this.context=Jd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new BB}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(V){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=V,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(V){return this.gain.gain.setTargetAtTime(V,this.context.currentTime,.01),this}updateMatrixWorld(V){super.updateMatrixWorld(V);const g=this.context.listener,I=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(at,Mo,WB),ot.set(0,0,-1).applyQuaternion(Mo),g.positionX){const e=this.context.currentTime+this.timeDelta;g.positionX.linearRampToValueAtTime(at.x,e),g.positionY.linearRampToValueAtTime(at.y,e),g.positionZ.linearRampToValueAtTime(at.z,e),g.forwardX.linearRampToValueAtTime(ot.x,e),g.forwardY.linearRampToValueAtTime(ot.y,e),g.forwardZ.linearRampToValueAtTime(ot.z,e),g.upX.linearRampToValueAtTime(I.x,e),g.upY.linearRampToValueAtTime(I.y,e),g.upZ.linearRampToValueAtTime(I.z,e)}else g.setPosition(at.x,at.y,at.z),g.setOrientation(ot.x,ot.y,ot.z,I.x,I.y,I.z)}}class Md extends UV{constructor(V){super(),this.type="Audio",this.listener=V,this.context=V.context,this.gain=this.context.createGain(),this.gain.connect(V.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(V){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=V,this.connect(),this}setMediaElementSource(V){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(V),this.connect(),this}setMediaStreamSource(V){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(V),this.connect(),this}setBuffer(V){return this.buffer=V,this.sourceType="buffer",this.autoplay&&this.play(),this}play(V=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+V;const g=this.context.createBufferSource();return g.buffer=this.buffer,g.loop=this.loop,g.loopStart=this.loopStart,g.loopEnd=this.loopEnd,g.onended=this.onEnded.bind(this),g.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=g,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let V=1,g=this.filters.length;V<g;V++)this.filters[V-1].connect(this.filters[V]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let V=1,g=this.filters.length;V<g;V++)this.filters[V-1].disconnect(this.filters[V]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(V){return V||(V=[]),this._connected===!0?(this.disconnect(),this.filters=V.slice(),this.connect()):this.filters=V.slice(),this}setDetune(V){if(this.detune=V,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(V){return this.setFilters(V?[V]:[])}setPlaybackRate(V){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=V,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(V){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=V,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(V){return this.loopStart=V,this}setLoopEnd(V){return this.loopEnd=V,this}getVolume(){return this.gain.gain.value}setVolume(V){return this.gain.gain.setTargetAtTime(V,this.context.currentTime,.01),this}}const ct=new S,xo=new Rg,XB=new S,dt=new S;class RB extends Md{constructor(V){super(V),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(V){return this.panner.refDistance=V,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(V){return this.panner.rolloffFactor=V,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(V){return this.panner.distanceModel=V,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(V){return this.panner.maxDistance=V,this}setDirectionalCone(V,g,I){return this.panner.coneInnerAngle=V,this.panner.coneOuterAngle=g,this.panner.coneOuterGain=I,this}updateMatrixWorld(V){if(super.updateMatrixWorld(V),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(ct,xo,XB),dt.set(0,0,1).applyQuaternion(xo);const g=this.panner;if(g.positionX){const I=this.context.currentTime+this.listener.timeDelta;g.positionX.linearRampToValueAtTime(ct.x,I),g.positionY.linearRampToValueAtTime(ct.y,I),g.positionZ.linearRampToValueAtTime(ct.z,I),g.orientationX.linearRampToValueAtTime(dt.x,I),g.orientationY.linearRampToValueAtTime(dt.y,I),g.orientationZ.linearRampToValueAtTime(dt.z,I)}else g.setPosition(ct.x,ct.y,ct.z),g.setOrientation(dt.x,dt.y,dt.z)}}class YB{constructor(V,g,I){this.binding=V,this.valueSize=I;let e,t,C;switch(g){case"quaternion":e=this._slerp,t=this._slerpAdditive,C=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(I*6),this._workIndex=5;break;case"string":case"bool":e=this._select,t=this._select,C=this._setAdditiveIdentityOther,this.buffer=new Array(I*5);break;default:e=this._lerp,t=this._lerpAdditive,C=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(I*5)}this._mixBufferRegion=e,this._mixBufferRegionAdditive=t,this._setIdentity=C,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(V,g){const I=this.buffer,e=this.valueSize,t=V*e+e;let C=this.cumulativeWeight;if(C===0){for(let A=0;A!==e;++A)I[t+A]=I[A];C=g}else{C+=g;const A=g/C;this._mixBufferRegion(I,t,0,A,e)}this.cumulativeWeight=C}accumulateAdditive(V){const g=this.buffer,I=this.valueSize,e=I*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(g,e,0,V,I),this.cumulativeWeightAdditive+=V}apply(V){const g=this.valueSize,I=this.buffer,e=V*g+g,t=this.cumulativeWeight,C=this.cumulativeWeightAdditive,A=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,t<1){const s=g*this._origIndex;this._mixBufferRegion(I,e,s,1-t,g)}C>0&&this._mixBufferRegionAdditive(I,e,this._addIndex*g,1,g);for(let s=g,a=g+g;s!==a;++s)if(I[s]!==I[s+g]){A.setValue(I,e);break}}saveOriginalState(){const V=this.binding,g=this.buffer,I=this.valueSize,e=I*this._origIndex;V.getValue(g,e);for(let t=I,C=e;t!==C;++t)g[t]=g[e+t%I];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const V=this.valueSize*3;this.binding.setValue(this.buffer,V)}_setAdditiveIdentityNumeric(){const V=this._addIndex*this.valueSize,g=V+this.valueSize;for(let I=V;I<g;I++)this.buffer[I]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const V=this._origIndex*this.valueSize,g=this._addIndex*this.valueSize;for(let I=0;I<this.valueSize;I++)this.buffer[g+I]=this.buffer[V+I]}_select(V,g,I,e,t){if(e>=.5)for(let C=0;C!==t;++C)V[g+C]=V[I+C]}_slerp(V,g,I,e){Rg.slerpFlat(V,g,V,g,V,I,e)}_slerpAdditive(V,g,I,e,t){const C=this._workIndex*t;Rg.multiplyQuaternionsFlat(V,C,V,g,V,I),Rg.slerpFlat(V,g,V,g,V,C,e)}_lerp(V,g,I,e,t){const C=1-e;for(let A=0;A!==t;++A){const s=g+A;V[s]=V[s]*C+V[I+A]*e}}_lerpAdditive(V,g,I,e,t){for(let C=0;C!==t;++C){const A=g+C;V[A]=V[A]+V[I+C]*e}}}const fl="\\[\\]\\.:\\/",wB=new RegExp("["+fl+"]","g"),Sl="[^"+fl+"]",HB="[^"+fl.replace("\\.","")+"]",fB=/((?:WC+[\/:])*)/.source.replace("WC",Sl),SB=/(WCOD+)?/.source.replace("WCOD",HB),FB=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Sl),vB=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Sl),NB=new RegExp("^"+fB+SB+FB+vB+"$"),KB=["material","materials","bones"];class JB{constructor(V,g,I){const e=I||Ig.parseTrackName(g);this._targetGroup=V,this._bindings=V.subscribe_(g,e)}getValue(V,g){this.bind();const I=this._targetGroup.nCachedObjects_,e=this._bindings[I];e!==void 0&&e.getValue(V,g)}setValue(V,g){const I=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=I.length;e!==t;++e)I[e].setValue(V,g)}bind(){const V=this._bindings;for(let g=this._targetGroup.nCachedObjects_,I=V.length;g!==I;++g)V[g].bind()}unbind(){const V=this._bindings;for(let g=this._targetGroup.nCachedObjects_,I=V.length;g!==I;++g)V[g].unbind()}}class Ig{constructor(V,g,I){this.path=g,this.parsedPath=I||Ig.parseTrackName(g),this.node=Ig.findNode(V,this.parsedPath.nodeName)||V,this.rootNode=V,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(V,g,I){return V&&V.isAnimationObjectGroup?new Ig.Composite(V,g,I):new Ig(V,g,I)}static sanitizeNodeName(V){return V.replace(/\s/g,"_").replace(wB,"")}static parseTrackName(V){const g=NB.exec(V);if(!g)throw new Error("PropertyBinding: Cannot parse trackName: "+V);const I={nodeName:g[2],objectName:g[3],objectIndex:g[4],propertyName:g[5],propertyIndex:g[6]},e=I.nodeName&&I.nodeName.lastIndexOf(".");if(e!==void 0&&e!==-1){const t=I.nodeName.substring(e+1);KB.indexOf(t)!==-1&&(I.nodeName=I.nodeName.substring(0,e),I.objectName=t)}if(I.propertyName===null||I.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+V);return I}static findNode(V,g){if(!g||g===""||g==="."||g===-1||g===V.name||g===V.uuid)return V;if(V.skeleton){const I=V.skeleton.getBoneByName(g);if(I!==void 0)return I}if(V.children){const I=function(t){for(let C=0;C<t.length;C++){const A=t[C];if(A.name===g||A.uuid===g)return A;const s=I(A.children);if(s)return s}return null},e=I(V.children);if(e)return e}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(V,g){V[g]=this.node[this.propertyName]}_getValue_array(V,g){const I=this.resolvedProperty;for(let e=0,t=I.length;e!==t;++e)V[g++]=I[e]}_getValue_arrayElement(V,g){V[g]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(V,g){this.resolvedProperty.toArray(V,g)}_setValue_direct(V,g){this.targetObject[this.propertyName]=V[g]}_setValue_direct_setNeedsUpdate(V,g){this.targetObject[this.propertyName]=V[g],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(V,g){this.targetObject[this.propertyName]=V[g],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(V,g){const I=this.resolvedProperty;for(let e=0,t=I.length;e!==t;++e)I[e]=V[g++]}_setValue_array_setNeedsUpdate(V,g){const I=this.resolvedProperty;for(let e=0,t=I.length;e!==t;++e)I[e]=V[g++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(V,g){const I=this.resolvedProperty;for(let e=0,t=I.length;e!==t;++e)I[e]=V[g++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(V,g){this.resolvedProperty[this.propertyIndex]=V[g]}_setValue_arrayElement_setNeedsUpdate(V,g){this.resolvedProperty[this.propertyIndex]=V[g],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(V,g){this.resolvedProperty[this.propertyIndex]=V[g],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(V,g){this.resolvedProperty.fromArray(V,g)}_setValue_fromArray_setNeedsUpdate(V,g){this.resolvedProperty.fromArray(V,g),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(V,g){this.resolvedProperty.fromArray(V,g),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(V,g){this.bind(),this.getValue(V,g)}_setValue_unbound(V,g){this.bind(),this.setValue(V,g)}bind(){let V=this.node;const g=this.parsedPath,I=g.objectName,e=g.propertyName;let t=g.propertyIndex;if(V||(V=Ig.findNode(this.rootNode,g.nodeName)||this.rootNode,this.node=V),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!V){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(I){let a=g.objectIndex;switch(I){case"materials":if(!V.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!V.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}V=V.material.materials;break;case"bones":if(!V.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}V=V.skeleton.bones;for(let o=0;o<V.length;o++)if(V[o].name===a){a=o;break}break;default:if(V[I]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}V=V[I]}if(a!==void 0){if(V[a]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,V);return}V=V[a]}}const C=V[e];if(C===void 0){const a=g.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+a+"."+e+" but it wasn't found.",V);return}let A=this.Versioning.None;this.targetObject=V,V.needsUpdate!==void 0?A=this.Versioning.NeedsUpdate:V.matrixWorldNeedsUpdate!==void 0&&(A=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(t!==void 0){if(e==="morphTargetInfluences"){if(!V.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(V.geometry.isBufferGeometry){if(!V.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}V.morphTargetDictionary[t]!==void 0&&(t=V.morphTargetDictionary[t])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}s=this.BindingType.ArrayElement,this.resolvedProperty=C,this.propertyIndex=t}else C.fromArray!==void 0&&C.toArray!==void 0?(s=this.BindingType.HasFromToArray,this.resolvedProperty=C):Array.isArray(C)?(s=this.BindingType.EntireArray,this.resolvedProperty=C):this.propertyName=e;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][A]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ig.Composite=JB;Ig.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ig.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ig.prototype.GetterByBindingType=[Ig.prototype._getValue_direct,Ig.prototype._getValue_array,Ig.prototype._getValue_arrayElement,Ig.prototype._getValue_toArray];Ig.prototype.SetterByBindingTypeAndVersioning=[[Ig.prototype._setValue_direct,Ig.prototype._setValue_direct_setNeedsUpdate,Ig.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ig.prototype._setValue_array,Ig.prototype._setValue_array_setNeedsUpdate,Ig.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ig.prototype._setValue_arrayElement,Ig.prototype._setValue_arrayElement_setNeedsUpdate,Ig.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ig.prototype._setValue_fromArray,Ig.prototype._setValue_fromArray_setNeedsUpdate,Ig.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class MB{constructor(V,g,I=null,e=g.blendMode){this._mixer=V,this._clip=g,this._localRoot=I,this.blendMode=e;const t=g.tracks,C=t.length,A=new Array(C),s={endingStart:eC,endingEnd:eC};for(let a=0;a!==C;++a){const o=t[a].createInterpolant(null);A[a]=o,o.settings=s}this._interpolantSettings=s,this._interpolants=A,this._propertyBindings=new Array(C),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Wb,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(V){return this._startTime=V,this}setLoop(V,g){return this.loop=V,this.repetitions=g,this}setEffectiveWeight(V){return this.weight=V,this._effectiveWeight=this.enabled?V:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(V){return this._scheduleFading(V,0,1)}fadeOut(V){return this._scheduleFading(V,1,0)}crossFadeFrom(V,g,I){if(V.fadeOut(g),this.fadeIn(g),I){const e=this._clip.duration,t=V._clip.duration,C=t/e,A=e/t;V.warp(1,C,g),this.warp(A,1,g)}return this}crossFadeTo(V,g,I){return V.crossFadeFrom(this,g,I)}stopFading(){const V=this._weightInterpolant;return V!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(V)),this}setEffectiveTimeScale(V){return this.timeScale=V,this._effectiveTimeScale=this.paused?0:V,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(V){return this.timeScale=this._clip.duration/V,this.stopWarping()}syncWith(V){return this.time=V.time,this.timeScale=V.timeScale,this.stopWarping()}halt(V){return this.warp(this._effectiveTimeScale,0,V)}warp(V,g,I){const e=this._mixer,t=e.time,C=this.timeScale;let A=this._timeScaleInterpolant;A===null&&(A=e._lendControlInterpolant(),this._timeScaleInterpolant=A);const s=A.parameterPositions,a=A.sampleValues;return s[0]=t,s[1]=t+I,a[0]=V/C,a[1]=g/C,this}stopWarping(){const V=this._timeScaleInterpolant;return V!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(V)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(V,g,I,e){if(!this.enabled){this._updateWeight(V);return}const t=this._startTime;if(t!==null){const s=(V-t)*I;if(s<0||I===0)return;this._startTime=null,g=I*s}g*=this._updateTimeScale(V);const C=this._updateTime(g),A=this._updateWeight(V);if(A>0){const s=this._interpolants,a=this._propertyBindings;switch(this.blendMode){case Tc:for(let o=0,n=s.length;o!==n;++o)s[o].evaluate(C),a[o].accumulateAdditive(A);break;case sl:default:for(let o=0,n=s.length;o!==n;++o)s[o].evaluate(C),a[o].accumulate(e,A)}}}_updateWeight(V){let g=0;if(this.enabled){g=this.weight;const I=this._weightInterpolant;if(I!==null){const e=I.evaluate(V)[0];g*=e,V>I.parameterPositions[1]&&(this.stopFading(),e===0&&(this.enabled=!1))}}return this._effectiveWeight=g,g}_updateTimeScale(V){let g=0;if(!this.paused){g=this.timeScale;const I=this._timeScaleInterpolant;I!==null&&(g*=I.evaluate(V)[0],V>I.parameterPositions[1]&&(this.stopWarping(),g===0?this.paused=!0:this.timeScale=g))}return this._effectiveTimeScale=g,g}_updateTime(V){const g=this._clip.duration,I=this.loop;let e=this.time+V,t=this._loopCount;const C=I===yb;if(V===0)return t===-1?e:C&&(t&1)===1?g-e:e;if(I===Bb){t===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));V:{if(e>=g)e=g;else if(e<0)e=0;else{this.time=e;break V}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:V<0?-1:1})}}else{if(t===-1&&(V>=0?(t=0,this._setEndings(!0,this.repetitions===0,C)):this._setEndings(this.repetitions===0,!0,C)),e>=g||e<0){const A=Math.floor(e/g);e-=g*A,t+=Math.abs(A);const s=this.repetitions-t;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=V>0?g:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:V>0?1:-1});else{if(s===1){const a=V<0;this._setEndings(a,!a,C)}else this._setEndings(!1,!1,C);this._loopCount=t,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:A})}}else this.time=e;if(C&&(t&1)===1)return g-e}return e}_setEndings(V,g,I){const e=this._interpolantSettings;I?(e.endingStart=tC,e.endingEnd=tC):(V?e.endingStart=this.zeroSlopeAtStart?tC:eC:e.endingStart=vA,g?e.endingEnd=this.zeroSlopeAtEnd?tC:eC:e.endingEnd=vA)}_scheduleFading(V,g,I){const e=this._mixer,t=e.time;let C=this._weightInterpolant;C===null&&(C=e._lendControlInterpolant(),this._weightInterpolant=C);const A=C.parameterPositions,s=C.sampleValues;return A[0]=t,s[0]=g,A[1]=t+V,s[1]=I,this}}class xB extends wt{constructor(V){super(),this._root=V,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(V,g){const I=V._localRoot||this._root,e=V._clip.tracks,t=e.length,C=V._propertyBindings,A=V._interpolants,s=I.uuid,a=this._bindingsByRootAndName;let o=a[s];o===void 0&&(o={},a[s]=o);for(let n=0;n!==t;++n){const l=e[n],c=l.name;let d=o[c];if(d!==void 0)C[n]=d;else{if(d=C[n],d!==void 0){d._cacheIndex===null&&(++d.referenceCount,this._addInactiveBinding(d,s,c));continue}const h=g&&g._propertyBindings[n].binding.parsedPath;d=new YB(Ig.create(I,c,h),l.ValueTypeName,l.getValueSize()),++d.referenceCount,this._addInactiveBinding(d,s,c),C[n]=d}A[n].resultBuffer=d.buffer}}_activateAction(V){if(!this._isActiveAction(V)){if(V._cacheIndex===null){const I=(V._localRoot||this._root).uuid,e=V._clip.uuid,t=this._actionsByClip[e];this._bindAction(V,t&&t.knownActions[0]),this._addInactiveAction(V,e,I)}const g=V._propertyBindings;for(let I=0,e=g.length;I!==e;++I){const t=g[I];t.useCount++===0&&(this._lendBinding(t),t.saveOriginalState())}this._lendAction(V)}}_deactivateAction(V){if(this._isActiveAction(V)){const g=V._propertyBindings;for(let I=0,e=g.length;I!==e;++I){const t=g[I];--t.useCount===0&&(t.restoreOriginalState(),this._takeBackBinding(t))}this._takeBackAction(V)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const V=this;this.stats={actions:{get total(){return V._actions.length},get inUse(){return V._nActiveActions}},bindings:{get total(){return V._bindings.length},get inUse(){return V._nActiveBindings}},controlInterpolants:{get total(){return V._controlInterpolants.length},get inUse(){return V._nActiveControlInterpolants}}}}_isActiveAction(V){const g=V._cacheIndex;return g!==null&&g<this._nActiveActions}_addInactiveAction(V,g,I){const e=this._actions,t=this._actionsByClip;let C=t[g];if(C===void 0)C={knownActions:[V],actionByRoot:{}},V._byClipCacheIndex=0,t[g]=C;else{const A=C.knownActions;V._byClipCacheIndex=A.length,A.push(V)}V._cacheIndex=e.length,e.push(V),C.actionByRoot[I]=V}_removeInactiveAction(V){const g=this._actions,I=g[g.length-1],e=V._cacheIndex;I._cacheIndex=e,g[e]=I,g.pop(),V._cacheIndex=null;const t=V._clip.uuid,C=this._actionsByClip,A=C[t],s=A.knownActions,a=s[s.length-1],o=V._byClipCacheIndex;a._byClipCacheIndex=o,s[o]=a,s.pop(),V._byClipCacheIndex=null;const n=A.actionByRoot,l=(V._localRoot||this._root).uuid;delete n[l],s.length===0&&delete C[t],this._removeInactiveBindingsForAction(V)}_removeInactiveBindingsForAction(V){const g=V._propertyBindings;for(let I=0,e=g.length;I!==e;++I){const t=g[I];--t.referenceCount===0&&this._removeInactiveBinding(t)}}_lendAction(V){const g=this._actions,I=V._cacheIndex,e=this._nActiveActions++,t=g[e];V._cacheIndex=e,g[e]=V,t._cacheIndex=I,g[I]=t}_takeBackAction(V){const g=this._actions,I=V._cacheIndex,e=--this._nActiveActions,t=g[e];V._cacheIndex=e,g[e]=V,t._cacheIndex=I,g[I]=t}_addInactiveBinding(V,g,I){const e=this._bindingsByRootAndName,t=this._bindings;let C=e[g];C===void 0&&(C={},e[g]=C),C[I]=V,V._cacheIndex=t.length,t.push(V)}_removeInactiveBinding(V){const g=this._bindings,I=V.binding,e=I.rootNode.uuid,t=I.path,C=this._bindingsByRootAndName,A=C[e],s=g[g.length-1],a=V._cacheIndex;s._cacheIndex=a,g[a]=s,g.pop(),delete A[t],Object.keys(A).length===0&&delete C[e]}_lendBinding(V){const g=this._bindings,I=V._cacheIndex,e=this._nActiveBindings++,t=g[e];V._cacheIndex=e,g[e]=V,t._cacheIndex=I,g[I]=t}_takeBackBinding(V){const g=this._bindings,I=V._cacheIndex,e=--this._nActiveBindings,t=g[e];V._cacheIndex=e,g[e]=V,t._cacheIndex=I,g[I]=t}_lendControlInterpolant(){const V=this._controlInterpolants,g=this._nActiveControlInterpolants++;let I=V[g];return I===void 0&&(I=new Rd(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),I.__cacheIndex=g,V[g]=I),I}_takeBackControlInterpolant(V){const g=this._controlInterpolants,I=V.__cacheIndex,e=--this._nActiveControlInterpolants,t=g[e];V.__cacheIndex=e,g[e]=V,t.__cacheIndex=I,g[I]=t}clipAction(V,g,I){const e=g||this._root,t=e.uuid;let C=typeof V=="string"?fs.findByName(e,V):V;const A=C!==null?C.uuid:V,s=this._actionsByClip[A];let a=null;if(I===void 0&&(C!==null?I=C.blendMode:I=sl),s!==void 0){const n=s.actionByRoot[t];if(n!==void 0&&n.blendMode===I)return n;a=s.knownActions[0],C===null&&(C=a._clip)}if(C===null)return null;const o=new MB(this,C,g,I);return this._bindAction(o,a),this._addInactiveAction(o,A,t),o}existingAction(V,g){const I=g||this._root,e=I.uuid,t=typeof V=="string"?fs.findByName(I,V):V,C=t?t.uuid:V,A=this._actionsByClip[C];return A!==void 0&&A.actionByRoot[e]||null}stopAllAction(){const V=this._actions,g=this._nActiveActions;for(let I=g-1;I>=0;--I)V[I].stop();return this}update(V){V*=this.timeScale;const g=this._actions,I=this._nActiveActions,e=this.time+=V,t=Math.sign(V),C=this._accuIndex^=1;for(let a=0;a!==I;++a)g[a]._update(e,V,t,C);const A=this._bindings,s=this._nActiveBindings;for(let a=0;a!==s;++a)A[a].apply(C);return this}setTime(V){this.time=0;for(let g=0;g<this._actions.length;g++)this._actions[g].time=0;return this.update(V)}getRoot(){return this._root}uncacheClip(V){const g=this._actions,I=V.uuid,e=this._actionsByClip,t=e[I];if(t!==void 0){const C=t.knownActions;for(let A=0,s=C.length;A!==s;++A){const a=C[A];this._deactivateAction(a);const o=a._cacheIndex,n=g[g.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,n._cacheIndex=o,g[o]=n,g.pop(),this._removeInactiveBindingsForAction(a)}delete e[I]}}uncacheRoot(V){const g=V.uuid,I=this._actionsByClip;for(const C in I){const A=I[C].actionByRoot,s=A[g];s!==void 0&&(this._deactivateAction(s),this._removeInactiveAction(s))}const e=this._bindingsByRootAndName,t=e[g];if(t!==void 0)for(const C in t){const A=t[C];A.restoreOriginalState(),this._removeInactiveBinding(A)}}uncacheAction(V,g){const I=this.existingAction(V,g);I!==null&&(this._deactivateAction(I),this._removeInactiveAction(I))}}xB.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class kB extends HC{constructor(V,g,I=1){super(V,g),this.meshPerAttribute=I}copy(V){return super.copy(V),this.meshPerAttribute=V.meshPerAttribute,this}clone(V){const g=super.clone(V);return g.meshPerAttribute=this.meshPerAttribute,g}toJSON(V){const g=super.toJSON(V);return g.isInstancedInterleavedBuffer=!0,g.meshPerAttribute=this.meshPerAttribute,g}}kB.prototype.isInstancedInterleavedBuffer=!0;class zB{constructor(V,g,I=0,e=1/0){this.ray=new Ht(V,g),this.near=I,this.far=e,this.camera=null,this.layers=new jc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(V,g){this.ray.set(V,g)}setFromCamera(V,g){g&&g.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(g.matrixWorld),this.ray.direction.set(V.x,V.y,.5).unproject(g).sub(this.ray.origin).normalize(),this.camera=g):g&&g.isOrthographicCamera?(this.ray.origin.set(V.x,V.y,(g.near+g.far)/(g.near-g.far)).unproject(g),this.ray.direction.set(0,0,-1).transformDirection(g.matrixWorld),this.camera=g):console.error("THREE.Raycaster: Unsupported camera type: "+g.type)}intersectObject(V,g=!1,I=[]){return Fs(V,this,I,g),I.sort(ko),I}intersectObjects(V,g=!1,I=[]){for(let e=0,t=V.length;e<t;e++)Fs(V[e],this,I,g);return I.sort(ko),I}}function ko(i,V){return i.distance-V.distance}function Fs(i,V,g,I){if(i.layers.test(V.layers)&&i.raycast(V,g),I===!0){const e=i.children;for(let t=0,C=e.length;t<C;t++)Fs(e[t],V,g,!0)}}const zo=new dV;class NC{constructor(V=new dV(1/0,1/0),g=new dV(-1/0,-1/0)){this.min=V,this.max=g}set(V,g){return this.min.copy(V),this.max.copy(g),this}setFromPoints(V){this.makeEmpty();for(let g=0,I=V.length;g<I;g++)this.expandByPoint(V[g]);return this}setFromCenterAndSize(V,g){const I=zo.copy(g).multiplyScalar(.5);return this.min.copy(V).sub(I),this.max.copy(V).add(I),this}clone(){return new this.constructor().copy(this)}copy(V){return this.min.copy(V.min),this.max.copy(V.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(V){return this.isEmpty()?V.set(0,0):V.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(V){return this.isEmpty()?V.set(0,0):V.subVectors(this.max,this.min)}expandByPoint(V){return this.min.min(V),this.max.max(V),this}expandByVector(V){return this.min.sub(V),this.max.add(V),this}expandByScalar(V){return this.min.addScalar(-V),this.max.addScalar(V),this}containsPoint(V){return!(V.x<this.min.x||V.x>this.max.x||V.y<this.min.y||V.y>this.max.y)}containsBox(V){return this.min.x<=V.min.x&&V.max.x<=this.max.x&&this.min.y<=V.min.y&&V.max.y<=this.max.y}getParameter(V,g){return g.set((V.x-this.min.x)/(this.max.x-this.min.x),(V.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(V){return!(V.max.x<this.min.x||V.min.x>this.max.x||V.max.y<this.min.y||V.min.y>this.max.y)}clampPoint(V,g){return g.copy(V).clamp(this.min,this.max)}distanceToPoint(V){return zo.copy(V).clamp(this.min,this.max).sub(V).length()}intersect(V){return this.min.max(V.min),this.max.min(V.max),this}union(V){return this.min.min(V.min),this.max.max(V.max),this}translate(V){return this.min.add(V),this.max.add(V),this}equals(V){return V.min.equals(this.min)&&V.max.equals(this.max)}}NC.prototype.isBox2=!0;const To=new S,mA=new S;class xd{constructor(V=new S,g=new S){this.start=V,this.end=g}set(V,g){return this.start.copy(V),this.end.copy(g),this}copy(V){return this.start.copy(V.start),this.end.copy(V.end),this}getCenter(V){return V.addVectors(this.start,this.end).multiplyScalar(.5)}delta(V){return V.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(V,g){return this.delta(g).multiplyScalar(V).add(this.start)}closestPointToPointParameter(V,g){To.subVectors(V,this.start),mA.subVectors(this.end,this.start);const I=mA.dot(mA);let t=mA.dot(To)/I;return g&&(t=eI(t,0,1)),t}closestPointToPoint(V,g,I){const e=this.closestPointToPointParameter(V,g);return this.delta(I).multiplyScalar(e).add(this.start)}applyMatrix4(V){return this.start.applyMatrix4(V),this.end.applyMatrix4(V),this}equals(V){return V.start.equals(this.start)&&V.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}class TB extends UV{constructor(V){super(),this.material=V,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}TB.prototype.isImmediateRenderObject=!0;const Me=new S,uA=new JV,En=new JV;class LB extends PA{constructor(V){const g=kd(V),I=new $V,e=[],t=[],C=new NV(0,0,1),A=new NV(0,1,0);for(let a=0;a<g.length;a++){const o=g[a];o.parent&&o.parent.isBone&&(e.push(0,0,0),e.push(0,0,0),t.push(C.r,C.g,C.b),t.push(A.r,A.g,A.b))}I.setAttribute("position",new hg(e,3)),I.setAttribute("color",new hg(t,3));const s=new fC({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(I,s),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=V,this.bones=g,this.matrix=V.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(V){const g=this.bones,I=this.geometry,e=I.getAttribute("position");En.copy(this.root.matrixWorld).invert();for(let t=0,C=0;t<g.length;t++){const A=g[t];A.parent&&A.parent.isBone&&(uA.multiplyMatrices(En,A.matrixWorld),Me.setFromMatrixPosition(uA),e.setXYZ(C,Me.x,Me.y,Me.z),uA.multiplyMatrices(En,A.parent.matrixWorld),Me.setFromMatrixPosition(uA),e.setXYZ(C+1,Me.x,Me.y,Me.z),C+=2)}I.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(V)}}function kd(i){const V=[];i&&i.isBone&&V.push(i);for(let g=0;g<i.children.length;g++)V.push.apply(V,kd(i.children[g]));return V}class UB extends PA{constructor(V=10,g=10,I=4473924,e=8947848){I=new NV(I),e=new NV(e);const t=g/2,C=V/g,A=V/2,s=[],a=[];for(let l=0,c=0,d=-A;l<=g;l++,d+=C){s.push(-A,0,d,A,0,d),s.push(d,0,-A,d,0,A);const h=l===t?I:e;h.toArray(a,c),c+=3,h.toArray(a,c),c+=3,h.toArray(a,c),c+=3,h.toArray(a,c),c+=3}const o=new $V;o.setAttribute("position",new hg(s,3)),o.setAttribute("color",new hg(a,3));const n=new fC({vertexColors:!0,toneMapped:!1});super(o,n),this.type="GridHelper"}}const DB=new Float32Array(1);new Int32Array(DB.buffer);const EB=new EI({side:wg,depthWrite:!1,depthTest:!1});new og(new ft,EB);JI.create=function(i,V){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(JI.prototype),i.prototype.constructor=i,i.prototype.getPoint=V,i};Ss.prototype.fromPoints=function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)};UB.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};LB.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};He.prototype.extractUrlBase=function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),aC.extractUrlBase(i)};He.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};NC.prototype.center=function(i){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(i)};NC.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};NC.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};NC.prototype.size=function(i){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(i)};pg.prototype.center=function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)};pg.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};pg.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};pg.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};pg.prototype.size=function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)};XI.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Ki.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)};xd.prototype.center=function(i){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(i)};Dg.prototype.flattenToArrayOffset=function(i,V){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,V)};Dg.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};Dg.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Dg.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};Dg.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Dg.prototype.getInverse=function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};JV.prototype.extractPosition=function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)};JV.prototype.flattenToArrayOffset=function(i,V){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,V)};JV.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new S().setFromMatrixColumn(this,3)};JV.prototype.setRotationFromQuaternion=function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)};JV.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};JV.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};JV.prototype.multiplyVector4=function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};JV.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};JV.prototype.rotateAxis=function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)};JV.prototype.crossVector=function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};JV.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};JV.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};JV.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};JV.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};JV.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};JV.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};JV.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};JV.prototype.makeFrustum=function(i,V,g,I,e,t){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,V,I,g,e,t)};JV.prototype.getInverse=function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};qe.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)};Rg.prototype.multiplyVector3=function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)};Rg.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Ht.prototype.isIntersectionBox=function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};Ht.prototype.isIntersectionPlane=function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)};Ht.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};Xg.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Xg.prototype.barycoordFromPoint=function(i,V){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,V)};Xg.prototype.midpoint=function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)};Xg.prototypenormal=function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)};Xg.prototype.plane=function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)};Xg.barycoordFromPoint=function(i,V,g,I,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Xg.getBarycoord(i,V,g,I,e)};Xg.normal=function(i,V,g,I){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Xg.getNormal(i,V,g,I)};gn.prototype.extractAllPoints=function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)};gn.prototype.extrude=function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new vt(this,i)};gn.prototype.makeGeometry=function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ql(this,i)};dV.prototype.fromAttribute=function(i,V,g){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,V,g)};dV.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};dV.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};S.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};S.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};S.prototype.getPositionFromMatrix=function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)};S.prototype.getScaleFromMatrix=function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)};S.prototype.getColumnFromMatrix=function(i,V){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(V,i)};S.prototype.applyProjection=function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)};S.prototype.fromAttribute=function(i,V,g){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,V,g)};S.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};S.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};eg.prototype.fromAttribute=function(i,V,g){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,V,g)};eg.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};UV.prototype.getChildByName=function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)};UV.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};UV.prototype.translate=function(i,V){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(V,i)};UV.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};UV.prototype.applyMatrix=function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(UV.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});og.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(og.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Xb},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});dl.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};jg.prototype.setLens=function(i,V){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),V!==void 0&&(this.filmGauge=V),this.setFocalLength(i)};Object.defineProperties(te.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}});Object.defineProperties(qg.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===KA},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(KA)}}});qg.prototype.setDynamic=function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?KA:mi),this};qg.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},qg.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};$V.prototype.addIndex=function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)};$V.prototype.addAttribute=function(i,V){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(V&&V.isBufferAttribute)&&!(V&&V.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new qg(arguments[1],arguments[2]))):i==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(V),this):this.setAttribute(i,V)};$V.prototype.addDrawCall=function(i,V,g){g!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,V)};$V.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};$V.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};$V.prototype.removeAttribute=function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)};$V.prototype.applyMatrix=function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties($V.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});HC.prototype.setDynamic=function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?KA:mi),this};HC.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};vt.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};vt.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};vt.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};wC.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(xg.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new NV}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===Jc}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}}});Object.defineProperties(Xe.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}});ig.prototype.clearTarget=function(i,V,g,I){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(V,g,I)};ig.prototype.animate=function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)};ig.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};ig.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};ig.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};ig.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};ig.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};ig.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};ig.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};ig.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};ig.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};ig.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};ig.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};ig.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};ig.prototype.enableScissorTest=function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)};ig.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};ig.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};ig.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};ig.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};ig.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};ig.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};ig.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};ig.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};ig.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};ig.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(ig.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?NA:vi}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(cd.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Ie.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}});Md.prototype.load=function(i){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const V=this;return new GB().load(i,function(I){V.setBuffer(I)}),this};ol.prototype.updateCubeMap=function(i,V){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,V)};ol.prototype.clear=function(i,V,g,I){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,V,g,I)};RC.crossOrigin=void 0;RC.loadTexture=function(i,V,g,I){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const e=new Le;e.setCrossOrigin(this.crossOrigin);const t=e.load(i,g,void 0,I);return V&&(t.mapping=V),t};RC.loadTextureCube=function(i,V,g,I){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const e=new mB;e.setCrossOrigin(this.crossOrigin);const t=e.load(i,g,void 0,I);return V&&(t.mapping=V),t};RC.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};RC.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Nc}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Nc);class VI{static assign(V,g){V.pool=new VI(V,g),V.get=function(){const I=V.pool.get();return I&&V.pool.reset&&V.pool.reset(I),I},V.release=function(){V.pool.release.apply(V.pool,arguments)},V.prototype.release=function(){return V.pool.release(this),this}}constructor(V,g,{maxLength:I=100}={}){this.prototype=V,this.reset=g,this.maxLength=I,this.items=[],this.availables=[]}set(V=100){this.maxLength=V}clear(){this.items=[],this.availables=[]}reset(){for(const V of this.items)V.release()}release(){for(const V of arguments){if(!V.isFromPool)throw new Error("The item is not from the pool");if(V.isAvailable)return;V.isAvailable=!0,this.availables.push(V)}}get(V){this.items.size>this.maxLength&&this.onMaxLengthReached(this);const g=this.availables.length?this.availables.pop():V?new this.prototype(V):new this.prototype;return g.isFromPool||this.items.push(g),g.isFromPool=!0,g.isAvailable=!1,this.reset&&this.reset(g),g}onMaxLengthReached(){throw new Error(`${this.prototype.name} pool exceed capacity`)}}VI.assign(dV,i=>i.setScalar(0));VI.assign(S,i=>i.setScalar(0));VI.assign(eg,i=>i.setScalar(0));VI.assign(Rg,i=>i.set(0,0,0,0));VI.assign(NC,i=>i.makeEmpty());VI.assign(pg,i=>i.makeEmpty());VI.assign(Xg);VI.assign(UV);VI.assign(ee);VI.assign(xd);VI.assign(JV);VI.assign(NV);Math.minAngleBetween=function(i,V){const g=Math.PI*2,I=(V-i)%g;return 2*I%g-I};Math.lerpAngle=function(i,V,g){return i+Math.minAngleBetween(i,V)*g};Math.randomSign=function(){return Math.random()<.5?-1:1};Math.lookAt=function(i,V,g){const I=S.get(),e=JV.get(),t=Rg.get(),C=i.parent;i.updateMatrixWorld(!0,!1),I.setFromMatrixPosition(i.matrixWorld),e.lookAt(V,I,g),i.quaternion.setFromRotationMatrix(e),C&&(e.extractRotation(C.matrixWorld),t.setFromRotationMatrix(e),i.quaternion.premultiply(t.inverse())),S.release(I),JV.release(e),Rg.release(t)};S.prototype.randomize=function(i=1){const V=2*Math.PI*Math.random(),g=Math.acos(2*Math.random()-1);return this.x=Math.sin(g)*Math.cos(V),this.y=Math.sin(g)*Math.sin(V),this.z=Math.cos(g),this.multiplyScalar(i)};dV.prototype.randomize=function(i=1){const V=2*Math.PI*Math.random();return this.x=Math.cos(V),this.y=Math.sin(V),this.multiplyScalar(i)};Array.prototype.shuffle=function(){for(let i=this.length-1;i>0;i--){const V=Math.floor(Math.random()*(i+1));[this[i],this[V]]=[this[V],this[i]]}return this};Array.prototype.getLast=function(){return this[this.length-1]};Array.prototype.getFirst=function(){return this[0]};Array.prototype.remove=function(i){const V=this.indexOf(i);return i==-1?this:(this.splice(V,1),this)};Array.ensure=function(i){return Array.isArray(i)?i:i!==void 0?[i]:[]};Object.assign(Math,Ec);function QB(i){const V=[];do{const g=Object.getOwnPropertyNames(i);for(let I=0,e=g.length;I<e;I++){const t=g[I],C=Object.getOwnPropertyDescriptor(i,t);C.get||C.set||V.push(t)}}while(i=Object.getPrototypeOf(i));return V}function zd(i){const V=QB(i);for(let g=0,I=V.length;g<I;g++){const e=V[g],t=i[e];e!=="constructor"&&typeof t=="function"&&(i[e]=i[e].bind(i))}return i}window.autobind=zd;var jB=[{routeID:"Home",path:"",silent:!1},{routeID:"SkinSelector",path:"skin-selector",silent:!0},{routeID:"Store",path:"store",silent:!0},{routeID:"Game",path:"game",silent:!0},{routeID:"GameOver",path:"game-over",silent:!0},{routeID:"EndScreen",path:"end-screen",silent:!0}];class BI{constructor(){this.listeners={}}addEventListener(V,g){return this.listeners[V]||(this.listeners[V]=[]),this.listeners[V].indexOf(g)===-1&&this.listeners[V].push(g),this}hasEventListener(V,g){return this.listeners[V]!==void 0&&this.listeners[V].indexOf(g)!==-1}removeEventListener(V,g){const I=this.listeners[V];if(I!==void 0){const e=I.indexOf(g);e!==-1&&I.splice(e,1)}return this}dispatchEvent(V){const g=this.listeners[V.type]||[];V.target=this;for(let I=0,e=g.length;I<e;I++)g[I].call(this,V);return this}}function bA(i="",V=!1,g=!1){const I=i.trim().split("/").filter(Boolean),e=(V?"/":"")+I.join("/")+(g?"/":"");return e==="//"?"/":e}class PB extends BI{constructor(){super(),autobind(this),this.routes=[],this.regExp=/(:[^/]+)/g}initialize(){const V=new URL(location.href);this.protocol=V.protocol,this.origin=V.origin,this.base="/";const g=document.querySelector("base");if((g?g.getAttribute("href"):"/").startsWith(".")){this.base=V.pathname;for(const e of this.routes)if(!!e.path&&this.base.endsWith(e.path)){this.base.slice(0,-e.path.length);break}}this.base=bA(this.base,!0,!0),addEventListener("click",this.onClick),addEventListener("popstate",this.onPopState),this.onPopState()}onPopState(){const{origin:V,href:g}=window.location,I=g.replace(V,"");this.navigate(I)}onClick(V){const{metaKey:g,ctrlKey:I,shiftKey:e}=V;if(g||I||e)return;const C=V.composedPath().filter(A=>(A.getAttribute&&A.getAttribute("href"))!=null).map(A=>A.getAttribute("href")).shift();C!=null&&(V.preventDefault(),V.stopPropagation(),this.navigate(C))}add(V){if(Array.isArray(V))return V.forEach(this.add);const{path:g}=V,I=new RegExp(g.replace(this.regExp,"([^/]+)")+"$"),e=(g.match(this.regExp)||[]).map(t=>t.substring(1));return this.routes.push(Object.assign({regExp:I,parameters:e},V)),this.routes=this.routes.sort((t,C)=>C.path.length-t.path.length),this}navigate(V){const{sameOrigin:g,path:I,fullPath:e}=this.parseURL(V),{route:t,parameters:C}=this.getRoutesParameters(this.routes,I),{routeID:A}=t;t?(this.dispatchEvent({type:"change",routeID:A,parameters:C}),this.setHistory(e,t)):this.navigate("/")}setHistory(V,g){this.currentRoute&&(this.previousRouteID=this.currentRoute.routeID),this.currentRouteID=g.routeID,history.pushState({previousRouteID:this.previousRouteID,currentRouteID:this.currentRouteID,fullPath:V},"",g.silent?null:V)}getCurrentRoute(V){const{path:g}=this.parseURL(V),I=this.getRoutesParameters(this.routes,g);return I&&I.route}getMatchedParameters(V,g){const I=g.match(V.regExp);return I?V.parameters.reduce((e,t,C)=>(e[t]=decodeURIComponent(I[C+1]),e),{}):!1}getRoutesParameters(V,g){let I;return{route:V.find(t=>I=this.getMatchedParameters(t,g)),parameters:I}}tryToParseURL(V){let g;try{g=new URL(V)}catch(I){}return g}parseURL(V){let g=this.tryToParseURL(V);g||(V.startsWith("/")?V=this.origin+V:V=this.origin+this.base+V,g=new URL(V));const I=g.origin===this.origin;let e=bA(g.pathname,!0,!1),t=bA(e.replace(/\/index\.html$/,""),!0,!0);return I&&t.startsWith(this.base)&&(t=t.substring(this.base.length)),t=bA(t,!1,!1),e+=g.search+g.hash,{sameOrigin:I,path:t,fullPath:e}}}class OB extends BI{constructor(){super(),autobind(this);const{usernames:V,achievements:g}=data.content;this.ranmodId=0,this.data=data,this.usernames=Array.from(V).shuffle(),this.names=[...this.usernames],this.skinIDs=g.map(I=>I.skinID),this.tints=["#f1c40f","#2ecc71","#e74c3c","#e67e22","#3498db"].shuffle()}getRandomName(){this.usernames.shuffle();let V=this.usernames.pop();return console.log("getRandomName this.usernames:",this.usernames.length),V}pushDeadName(V){this.usernames.push(V)}restoreNames(){this.usernames=[...this.names],console.log("restoreNames this.usernames:",this.usernames.length)}getRandomSkinID(){const V=this.players.map(g=>g.skinID);return this.skinIDs.filter(g=>!V.includes(g)).shuffle().pop()}getRandomTint(){return this.tints.unshift(this.tints.pop()),this.tints[0]}getDOMElements(V=document.documentElement,g={}){const I=V.querySelectorAll("*[ data-element ]");for(let e=0,t=I.length;e<t;e++){const C=I[e],s=C.getAttribute("data-element").split(", ");for(const a of s){const o=g[a];Array.isArray(o)?g[a].push(C):o?g[a]=[o,C]:g[a]=C}}return g}setTextContent(V,g){V.properties||(V.properties={}),V.properties.textContent!==g&&(V.properties.textContent=g,V.textContent=g)}setClass(V,g,I){V.properties||(V.properties={}),V.properties[g]!==I&&(V.properties[g]=I,V.classList.toggle(g,I))}setStyleProperty(V,g,I){V.properties||(V.properties={}),V.properties[g]!==I&&(V.properties[g]=I,V.style.setProperty(g,I))}match(V,g){return(g||"").search(V)!==-1}setupIs(V,g=null){const I=V?V.headers["user-agent"]:navigator.userAgent,e=g||{};return this.match(/Trident\/|MSIE/,I)&&(e.ie=!0),this.match("Edge/",I)&&(e.edge=!0),this.match("Firefox/",I)&&(e.firefox=!0),this.match("Chrome/",I)&&(e.chrome=!0),this.match("Safari",I)&&!this.match("Chrome",I)&&(e.safari=!0),this.match(/(iPhone|iPad|iPod)/,I)&&(e.ios=!0),this.match("Android",I)&&(e.android=!0),(this.match(/iPad/i,I)||this.match(/Android/i,I)&&!this.match(/Mobile/i,I))&&(e.tablet=!0),(e.ios||e.android)&&!e.tablet&&(e.mobile=!0),!e.mobile&&!e.tablet&&(e.desktop=!0),e.images=[e.chrome||e.firefox?"webm":null,"png","jpg"].filter(t=>t!==null),e}}function be(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Td(i,V){i.prototype=Object.create(V.prototype),i.prototype.constructor=i,i.__proto__=V}/*!
 * GSAP 3.10.3
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var pI={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},ZC={duration:.5,overwrite:!1,delay:0},Fl,SI=1e8,sg=1/SI,vs=Math.PI*2,_B=vs/4,$B=0,Ld=Math.sqrt,VW=Math.cos,gW=Math.sin,kg=function(V){return typeof V=="string"},Jg=function(V){return typeof V=="function"},Ye=function(V){return typeof V=="number"},vl=function(V){return typeof V=="undefined"},we=function(V){return typeof V=="object"},oI=function(V){return V!==!1},Ud=function(){return typeof window!="undefined"},ZA=function(V){return Jg(V)||kg(V)},Dd=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},_g=Array.isArray,Ns=/(?:-?\.?\d|\.)+/gi,Ed=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,iC=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Qn=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Qd=/[+-]=-?[.\d]+/,jd=/[^,'"\[\]\s]+/gi,IW=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,bg,PI,Ks,Nl,WI={},JA={},Pd,Od=function(V){return(JA=Xt(V,WI))&&yI},Kl=function(V,g){return console.warn("Invalid property",V,"set to",g,"Missing plugin? gsap.registerPlugin()")},MA=function(V,g){return!g&&console.warn(V)},_d=function(V,g){return V&&(WI[V]=g)&&JA&&(JA[V]=g)||WI},Bi=function(){return 0},Jl={},_e=[],Js={},$d,bI={},jn={},Lo=30,BA=[],Ml="",xl=function(V){var g=V[0],I,e;if(we(g)||Jg(g)||(V=[V]),!(I=(g._gsap||{}).harness)){for(e=BA.length;e--&&!BA[e].targetTest(g););I=BA[e]}for(e=V.length;e--;)V[e]&&(V[e]._gsap||(V[e]._gsap=new Gr(V[e],I)))||V.splice(e,1);return V},qt=function(V){return V._gsap||xl(FI(V))[0]._gsap},Vr=function(V,g,I){return(I=V[g])&&Jg(I)?V[g]():vl(I)&&V.getAttribute&&V.getAttribute(g)||I},cI=function(V,g){return(V=V.split(",")).forEach(g)||V},yg=function(V){return Math.round(V*1e5)/1e5||0},Pg=function(V){return Math.round(V*1e7)/1e7||0},oC=function(V,g){var I=g.charAt(0),e=parseFloat(g.substr(2));return V=parseFloat(V),I==="+"?V+e:I==="-"?V-e:I==="*"?V*e:V/e},eW=function(V,g){for(var I=g.length,e=0;V.indexOf(g[e])<0&&++e<I;);return e<I},xA=function(){var V=_e.length,g=_e.slice(0),I,e;for(Js={},_e.length=0,I=0;I<V;I++)e=g[I],e&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},gr=function(V,g,I,e){_e.length&&xA(),V.render(g,I,e),_e.length&&xA()},Ir=function(V){var g=parseFloat(V);return(g||g===0)&&(V+"").match(jd).length<2?g:kg(V)?V.trim():V},er=function(V){return V},MI=function(V,g){for(var I in g)I in V||(V[I]=g[I]);return V},tW=function(V){return function(g,I){for(var e in I)e in g||e==="duration"&&V||e==="ease"||(g[e]=I[e])}},Xt=function(V,g){for(var I in g)V[I]=g[I];return V},Uo=function i(V,g){for(var I in g)I!=="__proto__"&&I!=="constructor"&&I!=="prototype"&&(V[I]=we(g[I])?i(V[I]||(V[I]={}),g[I]):g[I]);return V},kA=function(V,g){var I={},e;for(e in V)e in g||(I[e]=V[e]);return I},li=function(V){var g=V.parent||bg,I=V.keyframes?tW(_g(V.keyframes)):MI;if(oI(V.inherit))for(;g;)I(V,g.vars.defaults),g=g.parent||g._dp;return V},CW=function(V,g){for(var I=V.length,e=I===g.length;e&&I--&&V[I]===g[I];);return I<0},tr=function(V,g,I,e,t){I===void 0&&(I="_first"),e===void 0&&(e="_last");var C=V[e],A;if(t)for(A=g[t];C&&C[t]>A;)C=C._prev;return C?(g._next=C._next,C._next=g):(g._next=V[I],V[I]=g),g._next?g._next._prev=g:V[e]=g,g._prev=C,g.parent=g._dp=V,g},tn=function(V,g,I,e){I===void 0&&(I="_first"),e===void 0&&(e="_last");var t=g._prev,C=g._next;t?t._next=C:V[I]===g&&(V[I]=C),C?C._prev=t:V[e]===g&&(V[e]=t),g._next=g._prev=g.parent=null},Be=function(V,g){V.parent&&(!g||V.parent.autoRemoveChildren)&&V.parent.remove(V),V._act=0},Bt=function(V,g){if(V&&(!g||g._end>V._dur||g._start<0))for(var I=V;I;)I._dirty=1,I=I.parent;return V},iW=function(V){for(var g=V.parent;g&&g.parent;)g._dirty=1,g.totalDuration(),g=g.parent;return V},AW=function i(V){return!V||V._ts&&i(V.parent)},Do=function(V){return V._repeat?GC(V._tTime,V=V.duration()+V._rDelay)*V:0},GC=function(V,g){var I=Math.floor(V/=g);return V&&I===V?I-1:I},zA=function(V,g){return(V-g._start)*g._ts+(g._ts>=0?0:g._dirty?g.totalDuration():g._tDur)},Cn=function(V){return V._end=Pg(V._start+(V._tDur/Math.abs(V._ts||V._rts||sg)||0))},kl=function(V,g){var I=V._dp;return I&&I.smoothChildTiming&&V._ts&&(V._start=Pg(I._time-(V._ts>0?g/V._ts:((V._dirty?V.totalDuration():V._tDur)-g)/-V._ts)),Cn(V),I._dirty||Bt(I,V)),V},Cr=function(V,g){var I;if((g._time||g._initted&&!g._dur)&&(I=zA(V.rawTime(),g),(!g._dur||Mi(0,g.totalDuration(),I)-g._tTime>sg)&&g.render(I,!0)),Bt(V,g)._dp&&V._initted&&V._time>=V._dur&&V._ts){if(V._dur<V.duration())for(I=V;I._dp;)I.rawTime()>=0&&I.totalTime(I._tTime),I=I._dp;V._zTime=-sg}},_I=function(V,g,I,e){return g.parent&&Be(g),g._start=Pg((Ye(I)?I:I||V!==bg?fI(V,I,g):V._time)+g._delay),g._end=Pg(g._start+(g.totalDuration()/Math.abs(g.timeScale())||0)),tr(V,g,"_first","_last",V._sort?"_start":0),Ms(g)||(V._recent=g),e||Cr(V,g),V},ir=function(V,g){return(WI.ScrollTrigger||Kl("scrollTrigger",g))&&WI.ScrollTrigger.create(g,V)},Ar=function(V,g,I,e){if(Tl(V,g),!V._initted)return 1;if(!I&&V._pt&&(V._dur&&V.vars.lazy!==!1||!V._dur&&V.vars.lazy)&&$d!==GI.frame)return _e.push(V),V._lazy=[g,e],1},nW=function i(V){var g=V.parent;return g&&g._ts&&g._initted&&!g._lock&&(g.rawTime()<0||i(g))},Ms=function(V){var g=V.data;return g==="isFromStart"||g==="isStart"},sW=function(V,g,I,e){var t=V.ratio,C=g<0||!g&&(!V._start&&nW(V)&&!(!V._initted&&Ms(V))||(V._ts<0||V._dp._ts<0)&&!Ms(V))?0:1,A=V._rDelay,s=0,a,o,n;if(A&&V._repeat&&(s=Mi(0,V._tDur,g),o=GC(s,A),V._yoyo&&o&1&&(C=1-C),o!==GC(V._tTime,A)&&(t=1-C,V.vars.repeatRefresh&&V._initted&&V.invalidate())),C!==t||e||V._zTime===sg||!g&&V._zTime){if(!V._initted&&Ar(V,g,e,I))return;for(n=V._zTime,V._zTime=g||(I?sg:0),I||(I=g&&!n),V.ratio=C,V._from&&(C=1-C),V._time=0,V._tTime=s,a=V._pt;a;)a.r(C,a.d),a=a._next;V._startAt&&g<0&&V._startAt.render(g,!0,!0),V._onUpdate&&!I&&vI(V,"onUpdate"),s&&V._repeat&&!I&&V.parent&&vI(V,"onRepeat"),(g>=V._tDur||g<0)&&V.ratio===C&&(C&&Be(V,1),I||(vI(V,C?"onComplete":"onReverseComplete",!0),V._prom&&V._prom()))}else V._zTime||(V._zTime=g)},lW=function(V,g,I){var e;if(I>g)for(e=V._first;e&&e._start<=I;){if(e.data==="isPause"&&e._start>g)return e;e=e._next}else for(e=V._last;e&&e._start>=I;){if(e.data==="isPause"&&e._start<g)return e;e=e._prev}},pC=function(V,g,I,e){var t=V._repeat,C=Pg(g)||0,A=V._tTime/V._tDur;return A&&!e&&(V._time*=C/V._dur),V._dur=C,V._tDur=t?t<0?1e10:Pg(C*(t+1)+V._rDelay*t):C,A>0&&!e?kl(V,V._tTime=V._tDur*A):V.parent&&Cn(V),I||Bt(V.parent,V),V},Eo=function(V){return V instanceof aI?Bt(V):pC(V,V._dur)},aW={_start:0,endTime:Bi,totalDuration:Bi},fI=function i(V,g,I){var e=V.labels,t=V._recent||aW,C=V.duration()>=SI?t.endTime(!1):V._dur,A,s,a;return kg(g)&&(isNaN(g)||g in e)?(s=g.charAt(0),a=g.substr(-1)==="%",A=g.indexOf("="),s==="<"||s===">"?(A>=0&&(g=g.replace(/=/,"")),(s==="<"?t._start:t.endTime(t._repeat>=0))+(parseFloat(g.substr(1))||0)*(a?(A<0?t:I).totalDuration()/100:1)):A<0?(g in e||(e[g]=C),e[g]):(s=parseFloat(g.charAt(A-1)+g.substr(A+1)),a&&I&&(s=s/100*(_g(I)?I[0]:I).totalDuration()),A>1?i(V,g.substr(0,A-1),I)+s:C+s)):g==null?C:+g},ai=function(V,g,I){var e=Ye(g[1]),t=(e?2:1)+(V<2?0:1),C=g[t],A,s;if(e&&(C.duration=g[1]),C.parent=I,V){for(A=C,s=I;s&&!("immediateRender"in A);)A=s.vars.defaults||{},s=oI(s.vars.inherit)&&s.parent;C.immediateRender=oI(A.immediateRender),V<2?C.runBackwards=1:C.startAt=g[t-1]}return new Kg(g[0],C,g[t+1])},it=function(V,g){return V||V===0?g(V):g},Mi=function(V,g,I){return I<V?V:I>g?g:I},Og=function(V,g){return!kg(V)||!(g=IW.exec(V))?"":g[1]},oW=function(V,g,I){return it(I,function(e){return Mi(V,g,e)})},xs=[].slice,nr=function(V,g){return V&&we(V)&&"length"in V&&(!g&&!V.length||V.length-1 in V&&we(V[0]))&&!V.nodeType&&V!==PI},cW=function(V,g,I){return I===void 0&&(I=[]),V.forEach(function(e){var t;return kg(e)&&!g||nr(e,1)?(t=I).push.apply(t,FI(e)):I.push(e)})||I},FI=function(V,g,I){return kg(V)&&!I&&(Ks||!qC())?xs.call((g||Nl).querySelectorAll(V),0):_g(V)?cW(V,I):nr(V)?xs.call(V,0):V?[V]:[]},dW=function(V){return V=FI(V)[0]||MA("Invalid scope")||{},function(g){var I=V.current||V.nativeElement||V;return FI(g,I.querySelectorAll?I:I===V?MA("Invalid scope")||Nl.createElement("div"):V)}},sr=function(V){return V.sort(function(){return .5-Math.random()})},lr=function(V){if(Jg(V))return V;var g=we(V)?V:{each:V},I=Wt(g.ease),e=g.from||0,t=parseFloat(g.base)||0,C={},A=e>0&&e<1,s=isNaN(e)||A,a=g.axis,o=e,n=e;return kg(e)?o=n={center:.5,edges:.5,end:1}[e]||0:!A&&s&&(o=e[0],n=e[1]),function(l,c,d){var h=(d||g).length,m=C[h],r,u,b,Z,p,G,X,W,y;if(!m){if(y=g.grid==="auto"?0:(g.grid||[1,SI])[1],!y){for(X=-SI;X<(X=d[y++].getBoundingClientRect().left)&&y<h;);y--}for(m=C[h]=[],r=s?Math.min(y,h)*o-.5:e%y,u=y===SI?0:s?h*n/y-.5:e/y|0,X=0,W=SI,G=0;G<h;G++)b=G%y-r,Z=u-(G/y|0),m[G]=p=a?Math.abs(a==="y"?Z:b):Ld(b*b+Z*Z),p>X&&(X=p),p<W&&(W=p);e==="random"&&sr(m),m.max=X-W,m.min=W,m.v=h=(parseFloat(g.amount)||parseFloat(g.each)*(y>h?h-1:a?a==="y"?h/y:y:Math.max(y,h/y))||0)*(e==="edges"?-1:1),m.b=h<0?t-h:t,m.u=Og(g.amount||g.each)||0,I=I&&h<0?ur(I):I}return h=(m[l]-m.min)/m.max||0,Pg(m.b+(I?I(h):h)*m.v)+m.u}},ks=function(V){var g=Math.pow(10,((V+"").split(".")[1]||"").length);return function(I){var e=Math.round(parseFloat(I)/V)*V*g;return(e-e%1)/g+(Ye(I)?0:Og(I))}},ar=function(V,g){var I=_g(V),e,t;return!I&&we(V)&&(e=I=V.radius||SI,V.values?(V=FI(V.values),(t=!Ye(V[0]))&&(e*=e)):V=ks(V.increment)),it(g,I?Jg(V)?function(C){return t=V(C),Math.abs(t-C)<=e?t:C}:function(C){for(var A=parseFloat(t?C.x:C),s=parseFloat(t?C.y:0),a=SI,o=0,n=V.length,l,c;n--;)t?(l=V[n].x-A,c=V[n].y-s,l=l*l+c*c):l=Math.abs(V[n]-A),l<a&&(a=l,o=n);return o=!e||a<=e?V[o]:C,t||o===C||Ye(C)?o:o+Og(C)}:ks(V))},or=function(V,g,I,e){return it(_g(V)?!g:I===!0?!!(I=0):!e,function(){return _g(V)?V[~~(Math.random()*V.length)]:(I=I||1e-5)&&(e=I<1?Math.pow(10,(I+"").length-2):1)&&Math.floor(Math.round((V-I/2+Math.random()*(g-V+I*.99))/I)*I*e)/e})},rW=function(){for(var V=arguments.length,g=new Array(V),I=0;I<V;I++)g[I]=arguments[I];return function(e){return g.reduce(function(t,C){return C(t)},e)}},hW=function(V,g){return function(I){return V(parseFloat(I))+(g||Og(I))}},mW=function(V,g,I){return dr(V,g,0,1,I)},cr=function(V,g,I){return it(I,function(e){return V[~~g(e)]})},uW=function i(V,g,I){var e=g-V;return _g(V)?cr(V,i(0,V.length),g):it(I,function(t){return(e+(t-V)%e)%e+V})},bW=function i(V,g,I){var e=g-V,t=e*2;return _g(V)?cr(V,i(0,V.length-1),g):it(I,function(C){return C=(t+(C-V)%t)%t||0,V+(C>e?t-C:C)})},Wi=function(V){for(var g=0,I="",e,t,C,A;~(e=V.indexOf("random(",g));)C=V.indexOf(")",e),A=V.charAt(e+7)==="[",t=V.substr(e+7,C-e-7).match(A?jd:Ns),I+=V.substr(g,e-g)+or(A?t:+t[0],A?0:+t[1],+t[2]||1e-5),g=C+1;return I+V.substr(g,V.length-g)},dr=function(V,g,I,e,t){var C=g-V,A=e-I;return it(t,function(s){return I+((s-V)/C*A||0)})},ZW=function i(V,g,I,e){var t=isNaN(V+g)?0:function(c){return(1-c)*V+c*g};if(!t){var C=kg(V),A={},s,a,o,n,l;if(I===!0&&(e=1)&&(I=null),C)V={p:V},g={p:g};else if(_g(V)&&!_g(g)){for(o=[],n=V.length,l=n-2,a=1;a<n;a++)o.push(i(V[a-1],V[a]));n--,t=function(d){d*=n;var h=Math.min(l,~~d);return o[h](d-h)},I=g}else e||(V=Xt(_g(V)?[]:{},V));if(!o){for(s in g)zl.call(A,V,s,"get",g[s]);t=function(d){return Dl(d,A)||(C?V.p:V)}}}return it(I,t)},Qo=function(V,g,I){var e=V.labels,t=SI,C,A,s;for(C in e)A=e[C]-g,A<0==!!I&&A&&t>(A=Math.abs(A))&&(s=C,t=A);return s},vI=function(V,g,I){var e=V.vars,t=e[g],C,A;if(!!t)return C=e[g+"Params"],A=e.callbackScope||V,I&&_e.length&&xA(),C?t.apply(A,C):t.call(A)},Vi=function(V){return Be(V),V.scrollTrigger&&V.scrollTrigger.kill(!1),V.progress()<1&&vI(V,"onInterrupt"),V},AC,GW=function(V){V=!V.name&&V.default||V;var g=V.name,I=Jg(V),e=g&&!I&&V.init?function(){this._props=[]}:V,t={init:Bi,render:Dl,add:zl,kill:KW,modifier:NW,rawVars:0},C={targetTest:0,get:0,getSetter:Ul,aliases:{},register:0};if(qC(),V!==e){if(bI[g])return;MI(e,MI(kA(V,t),C)),Xt(e.prototype,Xt(t,kA(V,C))),bI[e.prop=g]=e,V.targetTest&&(BA.push(e),Jl[g]=1),g=(g==="css"?"CSS":g.charAt(0).toUpperCase()+g.substr(1))+"Plugin"}_d(g,e),V.register&&V.register(yI,e,dI)},ng=255,gi={aqua:[0,ng,ng],lime:[0,ng,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,ng],navy:[0,0,128],white:[ng,ng,ng],olive:[128,128,0],yellow:[ng,ng,0],orange:[ng,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[ng,0,0],pink:[ng,192,203],cyan:[0,ng,ng],transparent:[ng,ng,ng,0]},Pn=function(V,g,I){return V+=V<0?1:V>1?-1:0,(V*6<1?g+(I-g)*V*6:V<.5?I:V*3<2?g+(I-g)*(2/3-V)*6:g)*ng+.5|0},rr=function(V,g,I){var e=V?Ye(V)?[V>>16,V>>8&ng,V&ng]:0:gi.black,t,C,A,s,a,o,n,l,c,d;if(!e){if(V.substr(-1)===","&&(V=V.substr(0,V.length-1)),gi[V])e=gi[V];else if(V.charAt(0)==="#"){if(V.length<6&&(t=V.charAt(1),C=V.charAt(2),A=V.charAt(3),V="#"+t+t+C+C+A+A+(V.length===5?V.charAt(4)+V.charAt(4):"")),V.length===9)return e=parseInt(V.substr(1,6),16),[e>>16,e>>8&ng,e&ng,parseInt(V.substr(7),16)/255];V=parseInt(V.substr(1),16),e=[V>>16,V>>8&ng,V&ng]}else if(V.substr(0,3)==="hsl"){if(e=d=V.match(Ns),!g)s=+e[0]%360/360,a=+e[1]/100,o=+e[2]/100,C=o<=.5?o*(a+1):o+a-o*a,t=o*2-C,e.length>3&&(e[3]*=1),e[0]=Pn(s+1/3,t,C),e[1]=Pn(s,t,C),e[2]=Pn(s-1/3,t,C);else if(~V.indexOf("="))return e=V.match(Ed),I&&e.length<4&&(e[3]=1),e}else e=V.match(Ns)||gi.transparent;e=e.map(Number)}return g&&!d&&(t=e[0]/ng,C=e[1]/ng,A=e[2]/ng,n=Math.max(t,C,A),l=Math.min(t,C,A),o=(n+l)/2,n===l?s=a=0:(c=n-l,a=o>.5?c/(2-n-l):c/(n+l),s=n===t?(C-A)/c+(C<A?6:0):n===C?(A-t)/c+2:(t-C)/c+4,s*=60),e[0]=~~(s+.5),e[1]=~~(a*100+.5),e[2]=~~(o*100+.5)),I&&e.length<4&&(e[3]=1),e},hr=function(V){var g=[],I=[],e=-1;return V.split($e).forEach(function(t){var C=t.match(iC)||[];g.push.apply(g,C),I.push(e+=C.length+1)}),g.c=I,g},jo=function(V,g,I){var e="",t=(V+e).match($e),C=g?"hsla(":"rgba(",A=0,s,a,o,n;if(!t)return V;if(t=t.map(function(l){return(l=rr(l,g,1))&&C+(g?l[0]+","+l[1]+"%,"+l[2]+"%,"+l[3]:l.join(","))+")"}),I&&(o=hr(V),s=I.c,s.join(e)!==o.c.join(e)))for(a=V.replace($e,"1").split(iC),n=a.length-1;A<n;A++)e+=a[A]+(~s.indexOf(A)?t.shift()||C+"0,0,0,0)":(o.length?o:t.length?t:I).shift());if(!a)for(a=V.split($e),n=a.length-1;A<n;A++)e+=a[A]+t[A];return e+a[n]},$e=function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",V;for(V in gi)i+="|"+V+"\\b";return new RegExp(i+")","gi")}(),pW=/hsl[a]?\(/,mr=function(V){var g=V.join(" "),I;if($e.lastIndex=0,$e.test(g))return I=pW.test(g),V[1]=jo(V[1],I),V[0]=jo(V[0],I,hr(V[1])),!0},yi,GI=function(){var i=Date.now,V=500,g=33,I=i(),e=I,t=1e3/240,C=t,A=[],s,a,o,n,l,c,d=function h(m){var r=i()-e,u=m===!0,b,Z,p,G;if(r>V&&(I+=r-g),e+=r,p=e-I,b=p-C,(b>0||u)&&(G=++n.frame,l=p-n.time*1e3,n.time=p=p/1e3,C+=b+(b>=t?4:t-b),Z=1),u||(s=a(h)),Z)for(c=0;c<A.length;c++)A[c](p,l,G,m)};return n={time:0,frame:0,tick:function(){d(!0)},deltaRatio:function(m){return l/(1e3/(m||60))},wake:function(){Pd&&(!Ks&&Ud()&&(PI=Ks=window,Nl=PI.document||{},WI.gsap=yI,(PI.gsapVersions||(PI.gsapVersions=[])).push(yI.version),Od(JA||PI.GreenSockGlobals||!PI.gsap&&PI||{}),o=PI.requestAnimationFrame),s&&n.sleep(),a=o||function(m){return setTimeout(m,C-n.time*1e3+1|0)},yi=1,d(2))},sleep:function(){(o?PI.cancelAnimationFrame:clearTimeout)(s),yi=0,a=Bi},lagSmoothing:function(m,r){V=m||1/sg,g=Math.min(r,V,0)},fps:function(m){t=1e3/(m||240),C=n.time*1e3+t},add:function(m,r,u){var b=r?function(Z,p,G,X){m(Z,p,G,X),n.remove(b)}:m;return n.remove(m),A[u?"unshift":"push"](b),qC(),b},remove:function(m,r){~(r=A.indexOf(m))&&A.splice(r,1)&&c>=r&&c--},_listeners:A},n}(),qC=function(){return!yi&&GI.wake()},PV={},qW=/^[\d.\-M][\d.\-,\s]/,BW=/["']/g,WW=function(V){for(var g={},I=V.substr(1,V.length-3).split(":"),e=I[0],t=1,C=I.length,A,s,a;t<C;t++)s=I[t],A=t!==C-1?s.lastIndexOf(","):s.length,a=s.substr(0,A),g[e]=isNaN(a)?a.replace(BW,"").trim():+a,e=s.substr(A+1).trim();return g},yW=function(V){var g=V.indexOf("(")+1,I=V.indexOf(")"),e=V.indexOf("(",g);return V.substring(g,~e&&e<I?V.indexOf(")",I+1):I)},XW=function(V){var g=(V+"").split("("),I=PV[g[0]];return I&&g.length>1&&I.config?I.config.apply(null,~V.indexOf("{")?[WW(g[1])]:yW(V).split(",").map(Ir)):PV._CE&&qW.test(V)?PV._CE("",V):I},ur=function(V){return function(g){return 1-V(1-g)}},br=function i(V,g){for(var I=V._first,e;I;)I instanceof aI?i(I,g):I.vars.yoyoEase&&(!I._yoyo||!I._repeat)&&I._yoyo!==g&&(I.timeline?i(I.timeline,g):(e=I._ease,I._ease=I._yEase,I._yEase=e,I._yoyo=g)),I=I._next},Wt=function(V,g){return V&&(Jg(V)?V:PV[V]||XW(V))||g},Nt=function(V,g,I,e){I===void 0&&(I=function(s){return 1-g(1-s)}),e===void 0&&(e=function(s){return s<.5?g(s*2)/2:1-g((1-s)*2)/2});var t={easeIn:g,easeOut:I,easeInOut:e},C;return cI(V,function(A){PV[A]=WI[A]=t,PV[C=A.toLowerCase()]=I;for(var s in t)PV[C+(s==="easeIn"?".in":s==="easeOut"?".out":".inOut")]=PV[A+"."+s]=t[s]}),t},Zr=function(V){return function(g){return g<.5?(1-V(1-g*2))/2:.5+V((g-.5)*2)/2}},On=function i(V,g,I){var e=g>=1?g:1,t=(I||(V?.3:.45))/(g<1?g:1),C=t/vs*(Math.asin(1/e)||0),A=function(o){return o===1?1:e*Math.pow(2,-10*o)*gW((o-C)*t)+1},s=V==="out"?A:V==="in"?function(a){return 1-A(1-a)}:Zr(A);return t=vs/t,s.config=function(a,o){return i(V,a,o)},s},_n=function i(V,g){g===void 0&&(g=1.70158);var I=function(C){return C?--C*C*((g+1)*C+g)+1:0},e=V==="out"?I:V==="in"?function(t){return 1-I(1-t)}:Zr(I);return e.config=function(t){return i(V,t)},e};cI("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,V){var g=V<5?V+1:V;Nt(i+",Power"+(g-1),V?function(I){return Math.pow(I,g)}:function(I){return I},function(I){return 1-Math.pow(1-I,g)},function(I){return I<.5?Math.pow(I*2,g)/2:1-Math.pow((1-I)*2,g)/2})});PV.Linear.easeNone=PV.none=PV.Linear.easeIn;Nt("Elastic",On("in"),On("out"),On());(function(i,V){var g=1/V,I=2*g,e=2.5*g,t=function(A){return A<g?i*A*A:A<I?i*Math.pow(A-1.5/V,2)+.75:A<e?i*(A-=2.25/V)*A+.9375:i*Math.pow(A-2.625/V,2)+.984375};Nt("Bounce",function(C){return 1-t(1-C)},t)})(7.5625,2.75);Nt("Expo",function(i){return i?Math.pow(2,10*(i-1)):0});Nt("Circ",function(i){return-(Ld(1-i*i)-1)});Nt("Sine",function(i){return i===1?1:-VW(i*_B)+1});Nt("Back",_n("in"),_n("out"),_n());PV.SteppedEase=PV.steps=WI.SteppedEase={config:function(V,g){V===void 0&&(V=1);var I=1/V,e=V+(g?0:1),t=g?1:0,C=1-sg;return function(A){return((e*Mi(0,C,A)|0)+t)*I}}};ZC.ease=PV["quad.out"];cI("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return Ml+=i+","+i+"Params,"});var Gr=function(V,g){this.id=$B++,V._gsap=this,this.target=V,this.harness=g,this.get=g?g.get:Vr,this.set=g?g.getSetter:Ul},Xi=function(){function i(g){this.vars=g,this._delay=+g.delay||0,(this._repeat=g.repeat===1/0?-2:g.repeat||0)&&(this._rDelay=g.repeatDelay||0,this._yoyo=!!g.yoyo||!!g.yoyoEase),this._ts=1,pC(this,+g.duration,1,1),this.data=g.data,yi||GI.wake()}var V=i.prototype;return V.delay=function(I){return I||I===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+I-this._delay),this._delay=I,this):this._delay},V.duration=function(I){return arguments.length?this.totalDuration(this._repeat>0?I+(I+this._rDelay)*this._repeat:I):this.totalDuration()&&this._dur},V.totalDuration=function(I){return arguments.length?(this._dirty=0,pC(this,this._repeat<0?I:(I-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},V.totalTime=function(I,e){if(qC(),!arguments.length)return this._tTime;var t=this._dp;if(t&&t.smoothChildTiming&&this._ts){for(kl(this,I),!t._dp||t.parent||Cr(t,this);t&&t.parent;)t.parent._time!==t._start+(t._ts>=0?t._tTime/t._ts:(t.totalDuration()-t._tTime)/-t._ts)&&t.totalTime(t._tTime,!0),t=t.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&I<this._tDur||this._ts<0&&I>0||!this._tDur&&!I)&&_I(this._dp,this,this._start-this._delay)}return(this._tTime!==I||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===sg||!I&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=I),gr(this,I,e)),this},V.time=function(I,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),I+Do(this))%(this._dur+this._rDelay)||(I?this._dur:0),e):this._time},V.totalProgress=function(I,e){return arguments.length?this.totalTime(this.totalDuration()*I,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},V.progress=function(I,e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-I:I)+Do(this),e):this.duration()?Math.min(1,this._time/this._dur):this.ratio},V.iteration=function(I,e){var t=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(I-1)*t,e):this._repeat?GC(this._tTime,t)+1:1},V.timeScale=function(I){if(!arguments.length)return this._rts===-sg?0:this._rts;if(this._rts===I)return this;var e=this.parent&&this._ts?zA(this.parent._time,this):this._tTime;return this._rts=+I||0,this._ts=this._ps||I===-sg?0:this._rts,this.totalTime(Mi(-this._delay,this._tDur,e),!0),Cn(this),iW(this)},V.paused=function(I){return arguments.length?(this._ps!==I&&(this._ps=I,I?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(qC(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==sg&&(this._tTime-=sg)))),this):this._ps},V.startTime=function(I){if(arguments.length){this._start=I;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&_I(e,this,I-this._delay),this}return this._start},V.endTime=function(I){return this._start+(oI(I)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},V.rawTime=function(I){var e=this.parent||this._dp;return e?I&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?zA(e.rawTime(I),this):this._tTime:this._tTime},V.globalTime=function(I){for(var e=this,t=arguments.length?I:e.rawTime();e;)t=e._start+t/(e._ts||1),e=e._dp;return t},V.repeat=function(I){return arguments.length?(this._repeat=I===1/0?-2:I,Eo(this)):this._repeat===-2?1/0:this._repeat},V.repeatDelay=function(I){if(arguments.length){var e=this._time;return this._rDelay=I,Eo(this),e?this.time(e):this}return this._rDelay},V.yoyo=function(I){return arguments.length?(this._yoyo=I,this):this._yoyo},V.seek=function(I,e){return this.totalTime(fI(this,I),oI(e))},V.restart=function(I,e){return this.play().totalTime(I?-this._delay:0,oI(e))},V.play=function(I,e){return I!=null&&this.seek(I,e),this.reversed(!1).paused(!1)},V.reverse=function(I,e){return I!=null&&this.seek(I||this.totalDuration(),e),this.reversed(!0).paused(!1)},V.pause=function(I,e){return I!=null&&this.seek(I,e),this.paused(!0)},V.resume=function(){return this.paused(!1)},V.reversed=function(I){return arguments.length?(!!I!==this.reversed()&&this.timeScale(-this._rts||(I?-sg:0)),this):this._rts<0},V.invalidate=function(){return this._initted=this._act=0,this._zTime=-sg,this},V.isActive=function(){var I=this.parent||this._dp,e=this._start,t;return!!(!I||this._ts&&this._initted&&I.isActive()&&(t=I.rawTime(!0))>=e&&t<this.endTime(!0)-sg)},V.eventCallback=function(I,e,t){var C=this.vars;return arguments.length>1?(e?(C[I]=e,t&&(C[I+"Params"]=t),I==="onUpdate"&&(this._onUpdate=e)):delete C[I],this):C[I]},V.then=function(I){var e=this;return new Promise(function(t){var C=Jg(I)?I:er,A=function(){var a=e.then;e.then=null,Jg(C)&&(C=C(e))&&(C.then||C===e)&&(e.then=a),t(C),e.then=a};e._initted&&e.totalProgress()===1&&e._ts>=0||!e._tTime&&e._ts<0?A():e._prom=A})},V.kill=function(){Vi(this)},i}();MI(Xi.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-sg,_prom:0,_ps:!1,_rts:1});var aI=function(i){Td(V,i);function V(I,e){var t;return I===void 0&&(I={}),t=i.call(this,I)||this,t.labels={},t.smoothChildTiming=!!I.smoothChildTiming,t.autoRemoveChildren=!!I.autoRemoveChildren,t._sort=oI(I.sortChildren),bg&&_I(I.parent||bg,be(t),e),I.reversed&&t.reverse(),I.paused&&t.paused(!0),I.scrollTrigger&&ir(be(t),I.scrollTrigger),t}var g=V.prototype;return g.to=function(e,t,C){return ai(0,arguments,this),this},g.from=function(e,t,C){return ai(1,arguments,this),this},g.fromTo=function(e,t,C,A){return ai(2,arguments,this),this},g.set=function(e,t,C){return t.duration=0,t.parent=this,li(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new Kg(e,t,fI(this,C),1),this},g.call=function(e,t,C){return _I(this,Kg.delayedCall(0,e,t),C)},g.staggerTo=function(e,t,C,A,s,a,o){return C.duration=t,C.stagger=C.stagger||A,C.onComplete=a,C.onCompleteParams=o,C.parent=this,new Kg(e,C,fI(this,s)),this},g.staggerFrom=function(e,t,C,A,s,a,o){return C.runBackwards=1,li(C).immediateRender=oI(C.immediateRender),this.staggerTo(e,t,C,A,s,a,o)},g.staggerFromTo=function(e,t,C,A,s,a,o,n){return A.startAt=C,li(A).immediateRender=oI(A.immediateRender),this.staggerTo(e,t,A,s,a,o,n)},g.render=function(e,t,C){var A=this._time,s=this._dirty?this.totalDuration():this._tDur,a=this._dur,o=e<=0?0:Pg(e),n=this._zTime<0!=e<0&&(this._initted||!a),l,c,d,h,m,r,u,b,Z,p,G,X;if(this!==bg&&o>s&&e>=0&&(o=s),o!==this._tTime||C||n){if(A!==this._time&&a&&(o+=this._time-A,e+=this._time-A),l=o,Z=this._start,b=this._ts,r=!b,n&&(a||(A=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(G=this._yoyo,m=a+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(m*100+e,t,C);if(l=Pg(o%m),o===s?(h=this._repeat,l=a):(h=~~(o/m),h&&h===o/m&&(l=a,h--),l>a&&(l=a)),p=GC(this._tTime,m),!A&&this._tTime&&p!==h&&(p=h),G&&h&1&&(l=a-l,X=1),h!==p&&!this._lock){var W=G&&p&1,y=W===(G&&h&1);if(h<p&&(W=!W),A=W?0:a,this._lock=1,this.render(A||(X?0:Pg(h*m)),t,!a)._lock=0,this._tTime=o,!t&&this.parent&&vI(this,"onRepeat"),this.vars.repeatRefresh&&!X&&(this.invalidate()._lock=1),A&&A!==this._time||r!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(a=this._dur,s=this._tDur,y&&(this._lock=2,A=W?a:-1e-4,this.render(A,!0),this.vars.repeatRefresh&&!X&&this.invalidate()),this._lock=0,!this._ts&&!r)return this;br(this,X)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(u=lW(this,Pg(A),Pg(l)),u&&(o-=l-(l=u._start))),this._tTime=o,this._time=l,this._act=!b,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,A=0),!A&&l&&!t&&(vI(this,"onStart"),this._tTime!==o))return this;if(l>=A&&e>=0)for(c=this._first;c;){if(d=c._next,(c._act||l>=c._start)&&c._ts&&u!==c){if(c.parent!==this)return this.render(e,t,C);if(c.render(c._ts>0?(l-c._start)*c._ts:(c._dirty?c.totalDuration():c._tDur)+(l-c._start)*c._ts,t,C),l!==this._time||!this._ts&&!r){u=0,d&&(o+=this._zTime=-sg);break}}c=d}else{c=this._last;for(var Y=e<0?e:l;c;){if(d=c._prev,(c._act||Y<=c._end)&&c._ts&&u!==c){if(c.parent!==this)return this.render(e,t,C);if(c.render(c._ts>0?(Y-c._start)*c._ts:(c._dirty?c.totalDuration():c._tDur)+(Y-c._start)*c._ts,t,C),l!==this._time||!this._ts&&!r){u=0,d&&(o+=this._zTime=Y?-sg:sg);break}}c=d}}if(u&&!t&&(this.pause(),u.render(l>=A?0:-sg)._zTime=l>=A?1:-1,this._ts))return this._start=Z,Cn(this),this.render(e,t,C);this._onUpdate&&!t&&vI(this,"onUpdate",!0),(o===s&&this._tTime>=this.totalDuration()||!o&&A)&&(Z===this._start||Math.abs(b)!==Math.abs(this._ts))&&(this._lock||((e||!a)&&(o===s&&this._ts>0||!o&&this._ts<0)&&Be(this,1),!t&&!(e<0&&!A)&&(o||A||!s)&&(vI(this,o===s&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(o<s&&this.timeScale()>0)&&this._prom())))}return this},g.add=function(e,t){var C=this;if(Ye(t)||(t=fI(this,t,e)),!(e instanceof Xi)){if(_g(e))return e.forEach(function(A){return C.add(A,t)}),this;if(kg(e))return this.addLabel(e,t);if(Jg(e))e=Kg.delayedCall(0,e);else return this}return this!==e?_I(this,e,t):this},g.getChildren=function(e,t,C,A){e===void 0&&(e=!0),t===void 0&&(t=!0),C===void 0&&(C=!0),A===void 0&&(A=-SI);for(var s=[],a=this._first;a;)a._start>=A&&(a instanceof Kg?t&&s.push(a):(C&&s.push(a),e&&s.push.apply(s,a.getChildren(!0,t,C)))),a=a._next;return s},g.getById=function(e){for(var t=this.getChildren(1,1,1),C=t.length;C--;)if(t[C].vars.id===e)return t[C]},g.remove=function(e){return kg(e)?this.removeLabel(e):Jg(e)?this.killTweensOf(e):(tn(this,e),e===this._recent&&(this._recent=this._last),Bt(this))},g.totalTime=function(e,t){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Pg(GI.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),i.prototype.totalTime.call(this,e,t),this._forcing=0,this):this._tTime},g.addLabel=function(e,t){return this.labels[e]=fI(this,t),this},g.removeLabel=function(e){return delete this.labels[e],this},g.addPause=function(e,t,C){var A=Kg.delayedCall(0,t||Bi,C);return A.data="isPause",this._hasPause=1,_I(this,A,fI(this,e))},g.removePause=function(e){var t=this._first;for(e=fI(this,e);t;)t._start===e&&t.data==="isPause"&&Be(t),t=t._next},g.killTweensOf=function(e,t,C){for(var A=this.getTweensOf(e,C),s=A.length;s--;)Ue!==A[s]&&A[s].kill(e,t);return this},g.getTweensOf=function(e,t){for(var C=[],A=FI(e),s=this._first,a=Ye(t),o;s;)s instanceof Kg?eW(s._targets,A)&&(a?(!Ue||s._initted&&s._ts)&&s.globalTime(0)<=t&&s.globalTime(s.totalDuration())>t:!t||s.isActive())&&C.push(s):(o=s.getTweensOf(A,t)).length&&C.push.apply(C,o),s=s._next;return C},g.tweenTo=function(e,t){t=t||{};var C=this,A=fI(C,e),s=t,a=s.startAt,o=s.onStart,n=s.onStartParams,l=s.immediateRender,c,d=Kg.to(C,MI({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:A,overwrite:"auto",duration:t.duration||Math.abs((A-(a&&"time"in a?a.time:C._time))/C.timeScale())||sg,onStart:function(){if(C.pause(),!c){var m=t.duration||Math.abs((A-(a&&"time"in a?a.time:C._time))/C.timeScale());d._dur!==m&&pC(d,m,0,1).render(d._time,!0,!0),c=1}o&&o.apply(d,n||[])}},t));return l?d.render(0):d},g.tweenFromTo=function(e,t,C){return this.tweenTo(t,MI({startAt:{time:fI(this,e)}},C))},g.recent=function(){return this._recent},g.nextLabel=function(e){return e===void 0&&(e=this._time),Qo(this,fI(this,e))},g.previousLabel=function(e){return e===void 0&&(e=this._time),Qo(this,fI(this,e),1)},g.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+sg)},g.shiftChildren=function(e,t,C){C===void 0&&(C=0);for(var A=this._first,s=this.labels,a;A;)A._start>=C&&(A._start+=e,A._end+=e),A=A._next;if(t)for(a in s)s[a]>=C&&(s[a]+=e);return Bt(this)},g.invalidate=function(){var e=this._first;for(this._lock=0;e;)e.invalidate(),e=e._next;return i.prototype.invalidate.call(this)},g.clear=function(e){e===void 0&&(e=!0);for(var t=this._first,C;t;)C=t._next,this.remove(t),t=C;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),Bt(this)},g.totalDuration=function(e){var t=0,C=this,A=C._last,s=SI,a,o,n;if(arguments.length)return C.timeScale((C._repeat<0?C.duration():C.totalDuration())/(C.reversed()?-e:e));if(C._dirty){for(n=C.parent;A;)a=A._prev,A._dirty&&A.totalDuration(),o=A._start,o>s&&C._sort&&A._ts&&!C._lock?(C._lock=1,_I(C,A,o-A._delay,1)._lock=0):s=o,o<0&&A._ts&&(t-=o,(!n&&!C._dp||n&&n.smoothChildTiming)&&(C._start+=o/C._ts,C._time-=o,C._tTime-=o),C.shiftChildren(-o,!1,-1/0),s=0),A._end>t&&A._ts&&(t=A._end),A=a;pC(C,C===bg&&C._time>t?C._time:t,1,1),C._dirty=0}return C._tDur},V.updateRoot=function(e){if(bg._ts&&(gr(bg,zA(e,bg)),$d=GI.frame),GI.frame>=Lo){Lo+=pI.autoSleep||120;var t=bg._first;if((!t||!t._ts)&&pI.autoSleep&&GI._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||GI.sleep()}}},V}(Xi);MI(aI.prototype,{_lock:0,_hasPause:0,_forcing:0});var RW=function(V,g,I,e,t,C,A){var s=new dI(this._pt,V,g,0,1,Xr,null,t),a=0,o=0,n,l,c,d,h,m,r,u;for(s.b=I,s.e=e,I+="",e+="",(r=~e.indexOf("random("))&&(e=Wi(e)),C&&(u=[I,e],C(u,V,g),I=u[0],e=u[1]),l=I.match(Qn)||[];n=Qn.exec(e);)d=n[0],h=e.substring(a,n.index),c?c=(c+1)%5:h.substr(-5)==="rgba("&&(c=1),d!==l[o++]&&(m=parseFloat(l[o-1])||0,s._pt={_next:s._pt,p:h||o===1?h:",",s:m,c:d.charAt(1)==="="?oC(m,d)-m:parseFloat(d)-m,m:c&&c<4?Math.round:0},a=Qn.lastIndex);return s.c=a<e.length?e.substring(a,e.length):"",s.fp=A,(Qd.test(e)||r)&&(s.e=0),this._pt=s,s},zl=function(V,g,I,e,t,C,A,s,a){Jg(e)&&(e=e(t||0,V,C));var o=V[g],n=I!=="get"?I:Jg(o)?a?V[g.indexOf("set")||!Jg(V["get"+g.substr(3)])?g:"get"+g.substr(3)](a):V[g]():o,l=Jg(o)?a?SW:Wr:Ll,c;if(kg(e)&&(~e.indexOf("random(")&&(e=Wi(e)),e.charAt(1)==="="&&(c=oC(n,e)+(Og(n)||0),(c||c===0)&&(e=c))),n!==e||zs)return!isNaN(n*e)&&e!==""?(c=new dI(this._pt,V,g,+n||0,e-(n||0),typeof o=="boolean"?vW:yr,0,l),a&&(c.fp=a),A&&c.modifier(A,this,V),this._pt=c):(!o&&!(g in V)&&Kl(g,e),RW.call(this,V,g,n,e,l,s||pI.stringFilter,a))},YW=function(V,g,I,e,t){if(Jg(V)&&(V=oi(V,t,g,I,e)),!we(V)||V.style&&V.nodeType||_g(V)||Dd(V))return kg(V)?oi(V,t,g,I,e):V;var C={},A;for(A in V)C[A]=oi(V[A],t,g,I,e);return C},pr=function(V,g,I,e,t,C){var A,s,a,o;if(bI[V]&&(A=new bI[V]).init(t,A.rawVars?g[V]:YW(g[V],e,t,C,I),I,e,C)!==!1&&(I._pt=s=new dI(I._pt,t,V,0,1,A.render,A,0,A.priority),I!==AC))for(a=I._ptLookup[I._targets.indexOf(t)],o=A._props.length;o--;)a[A._props[o]]=s;return A},Ue,zs,Tl=function i(V,g){var I=V.vars,e=I.ease,t=I.startAt,C=I.immediateRender,A=I.lazy,s=I.onUpdate,a=I.onUpdateParams,o=I.callbackScope,n=I.runBackwards,l=I.yoyoEase,c=I.keyframes,d=I.autoRevert,h=V._dur,m=V._startAt,r=V._targets,u=V.parent,b=u&&u.data==="nested"?u.parent._targets:r,Z=V._overwrite==="auto"&&!Fl,p=V.timeline,G,X,W,y,Y,f,L,R,J,H,N,v,T;if(p&&(!c||!e)&&(e="none"),V._ease=Wt(e,ZC.ease),V._yEase=l?ur(Wt(l===!0?e:l,ZC.ease)):0,l&&V._yoyo&&!V._repeat&&(l=V._yEase,V._yEase=V._ease,V._ease=l),V._from=!p&&!!I.runBackwards,!p||c&&!I.stagger){if(R=r[0]?qt(r[0]).harness:0,v=R&&I[R.prop],G=kA(I,Jl),m&&(Be(m.render(-1,!0)),m._lazy=0),t)if(Be(V._startAt=Kg.set(r,MI({data:"isStart",overwrite:!1,parent:u,immediateRender:!0,lazy:oI(A),startAt:null,delay:0,onUpdate:s,onUpdateParams:a,callbackScope:o,stagger:0},t))),g<0&&!C&&!d&&V._startAt.render(-1,!0),C){if(g>0&&!d&&(V._startAt=0),h&&g<=0){g&&(V._zTime=g);return}}else d===!1&&(V._startAt=0);else if(n&&h){if(m)!d&&(V._startAt=0);else if(g&&(C=!1),W=MI({overwrite:!1,data:"isFromStart",lazy:C&&oI(A),immediateRender:C,stagger:0,parent:u},G),v&&(W[R.prop]=v),Be(V._startAt=Kg.set(r,W)),g<0&&V._startAt.render(-1,!0),V._zTime=g,!C)i(V._startAt,sg);else if(!g)return}for(V._pt=V._ptCache=0,A=h&&oI(A)||A&&!h,X=0;X<r.length;X++){if(Y=r[X],L=Y._gsap||xl(r)[X]._gsap,V._ptLookup[X]=H={},Js[L.id]&&_e.length&&xA(),N=b===r?X:b.indexOf(Y),R&&(J=new R).init(Y,v||G,V,N,b)!==!1&&(V._pt=y=new dI(V._pt,Y,J.name,0,1,J.render,J,0,J.priority),J._props.forEach(function(D){H[D]=y}),J.priority&&(f=1)),!R||v)for(W in G)bI[W]&&(J=pr(W,G,V,N,Y,b))?J.priority&&(f=1):H[W]=y=zl.call(V,Y,W,"get",G[W],N,b,0,I.stringFilter);V._op&&V._op[X]&&V.kill(Y,V._op[X]),Z&&V._pt&&(Ue=V,bg.killTweensOf(Y,H,V.globalTime(g)),T=!V.parent,Ue=0),V._pt&&A&&(Js[L.id]=1)}f&&Rr(V),V._onInit&&V._onInit(V)}V._onUpdate=s,V._initted=(!V._op||V._pt)&&!T,c&&g<=0&&p.render(SI,!0,!0)},wW=function(V,g,I,e,t,C,A){var s=(V._pt&&V._ptCache||(V._ptCache={}))[g],a,o,n;if(!s)for(s=V._ptCache[g]=[],o=V._ptLookup,n=V._targets.length;n--;){if(a=o[n][g],a&&a.d&&a.d._pt)for(a=a.d._pt;a&&a.p!==g;)a=a._next;if(!a)return zs=1,V.vars[g]="+=0",Tl(V,A),zs=0,1;s.push(a)}for(n=s.length;n--;)a=s[n],a.s=(e||e===0)&&!t?e:a.s+(e||0)+C*a.c,a.c=I-a.s,a.e&&(a.e=yg(I)+Og(a.e)),a.b&&(a.b=a.s+Og(a.b))},HW=function(V,g){var I=V[0]?qt(V[0]).harness:0,e=I&&I.aliases,t,C,A,s;if(!e)return g;t=Xt({},g);for(C in e)if(C in t)for(s=e[C].split(","),A=s.length;A--;)t[s[A]]=t[C];return t},fW=function(V,g,I,e){var t=g.ease||e||"power1.inOut",C,A;if(_g(g))A=I[V]||(I[V]=[]),g.forEach(function(s,a){return A.push({t:a/(g.length-1)*100,v:s,e:t})});else for(C in g)A=I[C]||(I[C]=[]),C==="ease"||A.push({t:parseFloat(V),v:g[C],e:t})},oi=function(V,g,I,e,t){return Jg(V)?V.call(g,I,e,t):kg(V)&&~V.indexOf("random(")?Wi(V):V},qr=Ml+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Br={};cI(qr+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return Br[i]=1});var Kg=function(i){Td(V,i);function V(I,e,t,C){var A;typeof e=="number"&&(t.duration=e,e=t,t=null),A=i.call(this,C?e:li(e))||this;var s=A.vars,a=s.duration,o=s.delay,n=s.immediateRender,l=s.stagger,c=s.overwrite,d=s.keyframes,h=s.defaults,m=s.scrollTrigger,r=s.yoyoEase,u=e.parent||bg,b=(_g(I)||Dd(I)?Ye(I[0]):"length"in e)?[I]:FI(I),Z,p,G,X,W,y,Y,f;if(A._targets=b.length?xl(b):MA("GSAP target "+I+" not found. https://greensock.com",!pI.nullTargetWarn)||[],A._ptLookup=[],A._overwrite=c,d||l||ZA(a)||ZA(o)){if(e=A.vars,Z=A.timeline=new aI({data:"nested",defaults:h||{}}),Z.kill(),Z.parent=Z._dp=be(A),Z._start=0,l||ZA(a)||ZA(o)){if(X=b.length,Y=l&&lr(l),we(l))for(W in l)~qr.indexOf(W)&&(f||(f={}),f[W]=l[W]);for(p=0;p<X;p++)G=kA(e,Br),G.stagger=0,r&&(G.yoyoEase=r),f&&Xt(G,f),y=b[p],G.duration=+oi(a,be(A),p,y,b),G.delay=(+oi(o,be(A),p,y,b)||0)-A._delay,!l&&X===1&&G.delay&&(A._delay=o=G.delay,A._start+=o,G.delay=0),Z.to(y,G,Y?Y(p,y,b):0),Z._ease=PV.none;Z.duration()?a=o=0:A.timeline=0}else if(d){li(MI(Z.vars.defaults,{ease:"none"})),Z._ease=Wt(d.ease||e.ease||"none");var L=0,R,J,H;if(_g(d))d.forEach(function(N){return Z.to(b,N,">")});else{G={};for(W in d)W==="ease"||W==="easeEach"||fW(W,d[W],G,d.easeEach);for(W in G)for(R=G[W].sort(function(N,v){return N.t-v.t}),L=0,p=0;p<R.length;p++)J=R[p],H={ease:J.e,duration:(J.t-(p?R[p-1].t:0))/100*a},H[W]=J.v,Z.to(b,H,L),L+=H.duration;Z.duration()<a&&Z.to({},{duration:a-Z.duration()})}}a||A.duration(a=Z.duration())}else A.timeline=0;return c===!0&&!Fl&&(Ue=be(A),bg.killTweensOf(b),Ue=0),_I(u,be(A),t),e.reversed&&A.reverse(),e.paused&&A.paused(!0),(n||!a&&!d&&A._start===Pg(u._time)&&oI(n)&&AW(be(A))&&u.data!=="nested")&&(A._tTime=-sg,A.render(Math.max(0,-o))),m&&ir(be(A),m),A}var g=V.prototype;return g.render=function(e,t,C){var A=this._time,s=this._tDur,a=this._dur,o=e>s-sg&&e>=0?s:e<sg?0:e,n,l,c,d,h,m,r,u,b;if(!a)sW(this,e,t,C);else if(o!==this._tTime||!e||C||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=e<0){if(n=o,u=this.timeline,this._repeat){if(d=a+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(d*100+e,t,C);if(n=Pg(o%d),o===s?(c=this._repeat,n=a):(c=~~(o/d),c&&c===o/d&&(n=a,c--),n>a&&(n=a)),m=this._yoyo&&c&1,m&&(b=this._yEase,n=a-n),h=GC(this._tTime,d),n===A&&!C&&this._initted)return this._tTime=o,this;c!==h&&(u&&this._yEase&&br(u,m),this.vars.repeatRefresh&&!m&&!this._lock&&(this._lock=C=1,this.render(Pg(d*c),!0).invalidate()._lock=0))}if(!this._initted){if(Ar(this,e<0?e:n,C,t))return this._tTime=0,this;if(A!==this._time)return this;if(a!==this._dur)return this.render(e,t,C)}if(this._tTime=o,this._time=n,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=r=(b||this._ease)(n/a),this._from&&(this.ratio=r=1-r),n&&!A&&!t&&(vI(this,"onStart"),this._tTime!==o))return this;for(l=this._pt;l;)l.r(r,l.d),l=l._next;u&&u.render(e<0?e:!n&&m?-sg:u._dur*u._ease(n/this._dur),t,C)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(e<0&&this._startAt&&this._startAt.render(e,!0,C),vI(this,"onUpdate")),this._repeat&&c!==h&&this.vars.onRepeat&&!t&&this.parent&&vI(this,"onRepeat"),(o===this._tDur||!o)&&this._tTime===o&&(e<0&&this._startAt&&!this._onUpdate&&this._startAt.render(e,!0,!0),(e||!a)&&(o===this._tDur&&this._ts>0||!o&&this._ts<0)&&Be(this,1),!t&&!(e<0&&!A)&&(o||A)&&(vI(this,o===s?"onComplete":"onReverseComplete",!0),this._prom&&!(o<s&&this.timeScale()>0)&&this._prom()))}return this},g.targets=function(){return this._targets},g.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),i.prototype.invalidate.call(this)},g.resetTo=function(e,t,C,A){yi||GI.wake(),this._ts||this.play();var s=Math.min(this._dur,(this._dp._time-this._start)*this._ts),a;return this._initted||Tl(this,s),a=this._ease(s/this._dur),wW(this,e,t,C,A,a,s)?this.resetTo(e,t,C,A):(kl(this,0),this.parent||tr(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},g.kill=function(e,t){if(t===void 0&&(t="all"),!e&&(!t||t==="all"))return this._lazy=this._pt=0,this.parent?Vi(this):this;if(this.timeline){var C=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,Ue&&Ue.vars.overwrite!==!0)._first||Vi(this),this.parent&&C!==this.timeline.totalDuration()&&pC(this,this._dur*this.timeline._tDur/C,0,1),this}var A=this._targets,s=e?FI(e):A,a=this._ptLookup,o=this._pt,n,l,c,d,h,m,r;if((!t||t==="all")&&CW(A,s))return t==="all"&&(this._pt=0),Vi(this);for(n=this._op=this._op||[],t!=="all"&&(kg(t)&&(h={},cI(t,function(u){return h[u]=1}),t=h),t=HW(A,t)),r=A.length;r--;)if(~s.indexOf(A[r])){l=a[r],t==="all"?(n[r]=t,d=l,c={}):(c=n[r]=n[r]||{},d=t);for(h in d)m=l&&l[h],m&&((!("kill"in m.d)||m.d.kill(h)===!0)&&tn(this,m,"_pt"),delete l[h]),c!=="all"&&(c[h]=1)}return this._initted&&!this._pt&&o&&Vi(this),this},V.to=function(e,t){return new V(e,t,arguments[2])},V.from=function(e,t){return ai(1,arguments)},V.delayedCall=function(e,t,C,A){return new V(t,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:t,onReverseComplete:t,onCompleteParams:C,onReverseCompleteParams:C,callbackScope:A})},V.fromTo=function(e,t,C){return ai(2,arguments)},V.set=function(e,t){return t.duration=0,t.repeatDelay||(t.repeat=0),new V(e,t)},V.killTweensOf=function(e,t,C){return bg.killTweensOf(e,t,C)},V}(Xi);MI(Kg.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});cI("staggerTo,staggerFrom,staggerFromTo",function(i){Kg[i]=function(){var V=new aI,g=xs.call(arguments,0);return g.splice(i==="staggerFromTo"?5:4,0,0),V[i].apply(V,g)}});var Ll=function(V,g,I){return V[g]=I},Wr=function(V,g,I){return V[g](I)},SW=function(V,g,I,e){return V[g](e.fp,I)},FW=function(V,g,I){return V.setAttribute(g,I)},Ul=function(V,g){return Jg(V[g])?Wr:vl(V[g])&&V.setAttribute?FW:Ll},yr=function(V,g){return g.set(g.t,g.p,Math.round((g.s+g.c*V)*1e6)/1e6,g)},vW=function(V,g){return g.set(g.t,g.p,!!(g.s+g.c*V),g)},Xr=function(V,g){var I=g._pt,e="";if(!V&&g.b)e=g.b;else if(V===1&&g.e)e=g.e;else{for(;I;)e=I.p+(I.m?I.m(I.s+I.c*V):Math.round((I.s+I.c*V)*1e4)/1e4)+e,I=I._next;e+=g.c}g.set(g.t,g.p,e,g)},Dl=function(V,g){for(var I=g._pt;I;)I.r(V,I.d),I=I._next},NW=function(V,g,I,e){for(var t=this._pt,C;t;)C=t._next,t.p===e&&t.modifier(V,g,I),t=C},KW=function(V){for(var g=this._pt,I,e;g;)e=g._next,g.p===V&&!g.op||g.op===V?tn(this,g,"_pt"):g.dep||(I=1),g=e;return!I},JW=function(V,g,I,e){e.mSet(V,g,e.m.call(e.tween,I,e.mt),e)},Rr=function(V){for(var g=V._pt,I,e,t,C;g;){for(I=g._next,e=t;e&&e.pr>g.pr;)e=e._next;(g._prev=e?e._prev:C)?g._prev._next=g:t=g,(g._next=e)?e._prev=g:C=g,g=I}V._pt=t},dI=function(){function i(g,I,e,t,C,A,s,a,o){this.t=I,this.s=t,this.c=C,this.p=e,this.r=A||yr,this.d=s||this,this.set=a||Ll,this.pr=o||0,this._next=g,g&&(g._prev=this)}var V=i.prototype;return V.modifier=function(I,e,t){this.mSet=this.mSet||this.set,this.set=JW,this.m=I,this.mt=t,this.tween=e},i}();cI(Ml+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return Jl[i]=1});WI.TweenMax=WI.TweenLite=Kg;WI.TimelineLite=WI.TimelineMax=aI;bg=new aI({sortChildren:!1,defaults:ZC,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});pI.stringFilter=mr;var TA={registerPlugin:function(){for(var V=arguments.length,g=new Array(V),I=0;I<V;I++)g[I]=arguments[I];g.forEach(function(e){return GW(e)})},timeline:function(V){return new aI(V)},getTweensOf:function(V,g){return bg.getTweensOf(V,g)},getProperty:function(V,g,I,e){kg(V)&&(V=FI(V)[0]);var t=qt(V||{}).get,C=I?er:Ir;return I==="native"&&(I=""),V&&(g?C((bI[g]&&bI[g].get||t)(V,g,I,e)):function(A,s,a){return C((bI[A]&&bI[A].get||t)(V,A,s,a))})},quickSetter:function(V,g,I){if(V=FI(V),V.length>1){var e=V.map(function(o){return yI.quickSetter(o,g,I)}),t=e.length;return function(o){for(var n=t;n--;)e[n](o)}}V=V[0]||{};var C=bI[g],A=qt(V),s=A.harness&&(A.harness.aliases||{})[g]||g,a=C?function(o){var n=new C;AC._pt=0,n.init(V,I?o+I:o,AC,0,[V]),n.render(1,n),AC._pt&&Dl(1,AC)}:A.set(V,s);return C?a:function(o){return a(V,s,I?o+I:o,A,1)}},quickTo:function(V,g,I){var e,t=yI.to(V,Xt((e={},e[g]="+=0.1",e.paused=!0,e),I||{})),C=function(s,a,o){return t.resetTo(g,s,a,o)};return C.tween=t,C},isTweening:function(V){return bg.getTweensOf(V,!0).length>0},defaults:function(V){return V&&V.ease&&(V.ease=Wt(V.ease,ZC.ease)),Uo(ZC,V||{})},config:function(V){return Uo(pI,V||{})},registerEffect:function(V){var g=V.name,I=V.effect,e=V.plugins,t=V.defaults,C=V.extendTimeline;(e||"").split(",").forEach(function(A){return A&&!bI[A]&&!WI[A]&&MA(g+" effect requires "+A+" plugin.")}),jn[g]=function(A,s,a){return I(FI(A),MI(s||{},t),a)},C&&(aI.prototype[g]=function(A,s,a){return this.add(jn[g](A,we(s)?s:(a=s)&&{},this),a)})},registerEase:function(V,g){PV[V]=Wt(g)},parseEase:function(V,g){return arguments.length?Wt(V,g):PV},getById:function(V){return bg.getById(V)},exportRoot:function(V,g){V===void 0&&(V={});var I=new aI(V),e,t;for(I.smoothChildTiming=oI(V.smoothChildTiming),bg.remove(I),I._dp=0,I._time=I._tTime=bg._time,e=bg._first;e;)t=e._next,(g||!(!e._dur&&e instanceof Kg&&e.vars.onComplete===e._targets[0]))&&_I(I,e,e._start-e._delay),e=t;return _I(bg,I,0),I},utils:{wrap:uW,wrapYoyo:bW,distribute:lr,random:or,snap:ar,normalize:mW,getUnit:Og,clamp:oW,splitColor:rr,toArray:FI,selector:dW,mapRange:dr,pipe:rW,unitize:hW,interpolate:ZW,shuffle:sr},install:Od,effects:jn,ticker:GI,updateRoot:aI.updateRoot,plugins:bI,globalTimeline:bg,core:{PropTween:dI,globals:_d,Tween:Kg,Timeline:aI,Animation:Xi,getCache:qt,_removeLinkedListItem:tn,suppressOverwrites:function(V){return Fl=V}}};cI("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return TA[i]=Kg[i]});GI.add(aI.updateRoot);AC=TA.to({},{duration:0});var MW=function(V,g){for(var I=V._pt;I&&I.p!==g&&I.op!==g&&I.fp!==g;)I=I._next;return I},xW=function(V,g){var I=V._targets,e,t,C;for(e in g)for(t=I.length;t--;)C=V._ptLookup[t][e],C&&(C=C.d)&&(C._pt&&(C=MW(C,e)),C&&C.modifier&&C.modifier(g[e],V,I[t],e))},$n=function(V,g){return{name:V,rawVars:1,init:function(e,t,C){C._onInit=function(A){var s,a;if(kg(t)&&(s={},cI(t,function(o){return s[o]=1}),t=s),g){s={};for(a in t)s[a]=g(t[a]);t=s}xW(A,t)}}}},yI=TA.registerPlugin({name:"attr",init:function(V,g,I,e,t){var C,A;for(C in g)A=this.add(V,"setAttribute",(V.getAttribute(C)||0)+"",g[C],e,t,0,0,C),A&&(A.op=C),this._props.push(C)}},{name:"endArray",init:function(V,g){for(var I=g.length;I--;)this.add(V,I,V[I]||0,g[I])}},$n("roundProps",ks),$n("modifiers"),$n("snap",ar))||TA;Kg.version=aI.version=yI.version="3.10.3";Pd=1;Ud()&&qC();PV.Power0;PV.Power1;PV.Power2;PV.Power3;PV.Power4;PV.Linear;PV.Quad;PV.Cubic;PV.Quart;PV.Quint;PV.Strong;PV.Elastic;PV.Back;PV.SteppedEase;PV.Bounce;PV.Sine;PV.Expo;PV.Circ;/*!
 * CSSPlugin 3.10.3
 * https://greensock.com
 *
 * Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Po,De,cC,El,pt,Oo,kW=function(){return typeof window!="undefined"},It={},ut=180/Math.PI,dC=Math.PI/180,VC=Math.atan2,_o=1e8,Yr=/([A-Z])/g,zW=/(left|right|width|margin|padding|x)/i,TW=/[\s,\(]\S/,Ee={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},wr=function(V,g){return g.set(g.t,g.p,Math.round((g.s+g.c*V)*1e4)/1e4+g.u,g)},LW=function(V,g){return g.set(g.t,g.p,V===1?g.e:Math.round((g.s+g.c*V)*1e4)/1e4+g.u,g)},UW=function(V,g){return g.set(g.t,g.p,V?Math.round((g.s+g.c*V)*1e4)/1e4+g.u:g.b,g)},DW=function(V,g){var I=g.s+g.c*V;g.set(g.t,g.p,~~(I+(I<0?-.5:.5))+g.u,g)},Hr=function(V,g){return g.set(g.t,g.p,V?g.e:g.b,g)},fr=function(V,g){return g.set(g.t,g.p,V!==1?g.b:g.e,g)},EW=function(V,g,I){return V.style[g]=I},QW=function(V,g,I){return V.style.setProperty(g,I)},jW=function(V,g,I){return V._gsap[g]=I},PW=function(V,g,I){return V._gsap.scaleX=V._gsap.scaleY=I},OW=function(V,g,I,e,t){var C=V._gsap;C.scaleX=C.scaleY=I,C.renderTransform(t,C)},_W=function(V,g,I,e,t){var C=V._gsap;C[g]=I,C.renderTransform(t,C)},Ug="transform",et=Ug+"Origin",Sr,Ts=function(V,g){var I=De.createElementNS?De.createElementNS((g||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),V):De.createElement(V);return I.style?I:De.createElement(V)},We=function i(V,g,I){var e=getComputedStyle(V);return e[g]||e.getPropertyValue(g.replace(Yr,"-$1").toLowerCase())||e.getPropertyValue(g)||!I&&i(V,BC(g)||g,1)||""},$o="O,Moz,ms,Ms,Webkit".split(","),BC=function(V,g,I){var e=g||pt,t=e.style,C=5;if(V in t&&!I)return V;for(V=V.charAt(0).toUpperCase()+V.substr(1);C--&&!($o[C]+V in t););return C<0?null:(C===3?"ms":C>=0?$o[C]:"")+V},Ls=function(){kW()&&window.document&&(Po=window,De=Po.document,cC=De.documentElement,pt=Ts("div")||{style:{}},Ts("div"),Ug=BC(Ug),et=Ug+"Origin",pt.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Sr=!!BC("perspective"),El=1)},Vs=function i(V){var g=Ts("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),I=this.parentNode,e=this.nextSibling,t=this.style.cssText,C;if(cC.appendChild(g),g.appendChild(this),this.style.display="block",V)try{C=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=i}catch(A){}else this._gsapBBox&&(C=this._gsapBBox());return I&&(e?I.insertBefore(this,e):I.appendChild(this)),cC.removeChild(g),this.style.cssText=t,C},Vc=function(V,g){for(var I=g.length;I--;)if(V.hasAttribute(g[I]))return V.getAttribute(g[I])},Fr=function(V){var g;try{g=V.getBBox()}catch(I){g=Vs.call(V,!0)}return g&&(g.width||g.height)||V.getBBox===Vs||(g=Vs.call(V,!0)),g&&!g.width&&!g.x&&!g.y?{x:+Vc(V,["x","cx","x1"])||0,y:+Vc(V,["y","cy","y1"])||0,width:0,height:0}:g},vr=function(V){return!!(V.getCTM&&(!V.parentNode||V.ownerSVGElement)&&Fr(V))},Ri=function(V,g){if(g){var I=V.style;g in It&&g!==et&&(g=Ug),I.removeProperty?((g.substr(0,2)==="ms"||g.substr(0,6)==="webkit")&&(g="-"+g),I.removeProperty(g.replace(Yr,"-$1").toLowerCase())):I.removeAttribute(g)}},Qe=function(V,g,I,e,t,C){var A=new dI(V._pt,g,I,0,1,C?fr:Hr);return V._pt=A,A.b=e,A.e=t,V._props.push(I),A},gc={deg:1,rad:1,turn:1},tt=function i(V,g,I,e){var t=parseFloat(I)||0,C=(I+"").trim().substr((t+"").length)||"px",A=pt.style,s=zW.test(g),a=V.tagName.toLowerCase()==="svg",o=(a?"client":"offset")+(s?"Width":"Height"),n=100,l=e==="px",c=e==="%",d,h,m,r;return e===C||!t||gc[e]||gc[C]?t:(C!=="px"&&!l&&(t=i(V,g,I,"px")),r=V.getCTM&&vr(V),(c||C==="%")&&(It[g]||~g.indexOf("adius"))?(d=r?V.getBBox()[s?"width":"height"]:V[o],yg(c?t/d*n:t/100*d)):(A[s?"width":"height"]=n+(l?C:e),h=~g.indexOf("adius")||e==="em"&&V.appendChild&&!a?V:V.parentNode,r&&(h=(V.ownerSVGElement||{}).parentNode),(!h||h===De||!h.appendChild)&&(h=De.body),m=h._gsap,m&&c&&m.width&&s&&m.time===GI.time?yg(t/m.width*n):((c||C==="%")&&(A.position=We(V,"position")),h===V&&(A.position="static"),h.appendChild(pt),d=pt[o],h.removeChild(pt),A.position="absolute",s&&c&&(m=qt(h),m.time=GI.time,m.width=h[o]),yg(l?d*t/n:d&&t?n/d*t:0))))},bt=function(V,g,I,e){var t;return El||Ls(),g in Ee&&g!=="transform"&&(g=Ee[g],~g.indexOf(",")&&(g=g.split(",")[0])),It[g]&&g!=="transform"?(t=wi(V,e),t=g!=="transformOrigin"?t[g]:t.svg?t.origin:UA(We(V,et))+" "+t.zOrigin+"px"):(t=V.style[g],(!t||t==="auto"||e||~(t+"").indexOf("calc("))&&(t=LA[g]&&LA[g](V,g,I)||We(V,g)||Vr(V,g)||(g==="opacity"?1:0))),I&&!~(t+"").trim().indexOf(" ")?tt(V,g,t,I)+I:t},$W=function(V,g,I,e){if(!I||I==="none"){var t=BC(g,V,1),C=t&&We(V,t,1);C&&C!==I?(g=t,I=C):g==="borderColor"&&(I=We(V,"borderTopColor"))}var A=new dI(this._pt,V.style,g,0,1,Xr),s=0,a=0,o,n,l,c,d,h,m,r,u,b,Z,p;if(A.b=I,A.e=e,I+="",e+="",e==="auto"&&(V.style[g]=e,e=We(V,g)||e,V.style[g]=I),o=[I,e],mr(o),I=o[0],e=o[1],l=I.match(iC)||[],p=e.match(iC)||[],p.length){for(;n=iC.exec(e);)m=n[0],u=e.substring(s,n.index),d?d=(d+1)%5:(u.substr(-5)==="rgba("||u.substr(-5)==="hsla(")&&(d=1),m!==(h=l[a++]||"")&&(c=parseFloat(h)||0,Z=h.substr((c+"").length),m.charAt(1)==="="&&(m=oC(c,m)+Z),r=parseFloat(m),b=m.substr((r+"").length),s=iC.lastIndex-b.length,b||(b=b||pI.units[g]||Z,s===e.length&&(e+=b,A.e+=b)),Z!==b&&(c=tt(V,g,h,b)||0),A._pt={_next:A._pt,p:u||a===1?u:",",s:c,c:r-c,m:d&&d<4||g==="zIndex"?Math.round:0});A.c=s<e.length?e.substring(s,e.length):""}else A.r=g==="display"&&e==="none"?fr:Hr;return Qd.test(e)&&(A.e=0),this._pt=A,A},Ic={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Vy=function(V){var g=V.split(" "),I=g[0],e=g[1]||"50%";return(I==="top"||I==="bottom"||e==="left"||e==="right")&&(V=I,I=e,e=V),g[0]=Ic[I]||I,g[1]=Ic[e]||e,g.join(" ")},gy=function(V,g){if(g.tween&&g.tween._time===g.tween._dur){var I=g.t,e=I.style,t=g.u,C=I._gsap,A,s,a;if(t==="all"||t===!0)e.cssText="",s=1;else for(t=t.split(","),a=t.length;--a>-1;)A=t[a],It[A]&&(s=1,A=A==="transformOrigin"?et:Ug),Ri(I,A);s&&(Ri(I,Ug),C&&(C.svg&&I.removeAttribute("transform"),wi(I,1),C.uncache=1))}},LA={clearProps:function(V,g,I,e,t){if(t.data!=="isFromStart"){var C=V._pt=new dI(V._pt,g,I,0,0,gy);return C.u=e,C.pr=-10,C.tween=t,V._props.push(I),1}}},Yi=[1,0,0,1,0,0],Nr={},Kr=function(V){return V==="matrix(1, 0, 0, 1, 0, 0)"||V==="none"||!V},ec=function(V){var g=We(V,Ug);return Kr(g)?Yi:g.substr(7).match(Ed).map(yg)},Ql=function(V,g){var I=V._gsap||qt(V),e=V.style,t=ec(V),C,A,s,a;return I.svg&&V.getAttribute("transform")?(s=V.transform.baseVal.consolidate().matrix,t=[s.a,s.b,s.c,s.d,s.e,s.f],t.join(",")==="1,0,0,1,0,0"?Yi:t):(t===Yi&&!V.offsetParent&&V!==cC&&!I.svg&&(s=e.display,e.display="block",C=V.parentNode,(!C||!V.offsetParent)&&(a=1,A=V.nextSibling,cC.appendChild(V)),t=ec(V),s?e.display=s:Ri(V,"display"),a&&(A?C.insertBefore(V,A):C?C.appendChild(V):cC.removeChild(V))),g&&t.length>6?[t[0],t[1],t[4],t[5],t[12],t[13]]:t)},Us=function(V,g,I,e,t,C){var A=V._gsap,s=t||Ql(V,!0),a=A.xOrigin||0,o=A.yOrigin||0,n=A.xOffset||0,l=A.yOffset||0,c=s[0],d=s[1],h=s[2],m=s[3],r=s[4],u=s[5],b=g.split(" "),Z=parseFloat(b[0])||0,p=parseFloat(b[1])||0,G,X,W,y;I?s!==Yi&&(X=c*m-d*h)&&(W=Z*(m/X)+p*(-h/X)+(h*u-m*r)/X,y=Z*(-d/X)+p*(c/X)-(c*u-d*r)/X,Z=W,p=y):(G=Fr(V),Z=G.x+(~b[0].indexOf("%")?Z/100*G.width:Z),p=G.y+(~(b[1]||b[0]).indexOf("%")?p/100*G.height:p)),e||e!==!1&&A.smooth?(r=Z-a,u=p-o,A.xOffset=n+(r*c+u*h)-r,A.yOffset=l+(r*d+u*m)-u):A.xOffset=A.yOffset=0,A.xOrigin=Z,A.yOrigin=p,A.smooth=!!e,A.origin=g,A.originIsAbsolute=!!I,V.style[et]="0px 0px",C&&(Qe(C,A,"xOrigin",a,Z),Qe(C,A,"yOrigin",o,p),Qe(C,A,"xOffset",n,A.xOffset),Qe(C,A,"yOffset",l,A.yOffset)),V.setAttribute("data-svg-origin",Z+" "+p)},wi=function(V,g){var I=V._gsap||new Gr(V);if("x"in I&&!g&&!I.uncache)return I;var e=V.style,t=I.scaleX<0,C="px",A="deg",s=We(V,et)||"0",a,o,n,l,c,d,h,m,r,u,b,Z,p,G,X,W,y,Y,f,L,R,J,H,N,v,T,D,$,M,_,x,z;return a=o=n=d=h=m=r=u=b=0,l=c=1,I.svg=!!(V.getCTM&&vr(V)),G=Ql(V,I.svg),I.svg&&(N=(!I.uncache||s==="0px 0px")&&!g&&V.getAttribute("data-svg-origin"),Us(V,N||s,!!N||I.originIsAbsolute,I.smooth!==!1,G)),Z=I.xOrigin||0,p=I.yOrigin||0,G!==Yi&&(Y=G[0],f=G[1],L=G[2],R=G[3],a=J=G[4],o=H=G[5],G.length===6?(l=Math.sqrt(Y*Y+f*f),c=Math.sqrt(R*R+L*L),d=Y||f?VC(f,Y)*ut:0,r=L||R?VC(L,R)*ut+d:0,r&&(c*=Math.abs(Math.cos(r*dC))),I.svg&&(a-=Z-(Z*Y+p*L),o-=p-(Z*f+p*R))):(z=G[6],_=G[7],D=G[8],$=G[9],M=G[10],x=G[11],a=G[12],o=G[13],n=G[14],X=VC(z,M),h=X*ut,X&&(W=Math.cos(-X),y=Math.sin(-X),N=J*W+D*y,v=H*W+$*y,T=z*W+M*y,D=J*-y+D*W,$=H*-y+$*W,M=z*-y+M*W,x=_*-y+x*W,J=N,H=v,z=T),X=VC(-L,M),m=X*ut,X&&(W=Math.cos(-X),y=Math.sin(-X),N=Y*W-D*y,v=f*W-$*y,T=L*W-M*y,x=R*y+x*W,Y=N,f=v,L=T),X=VC(f,Y),d=X*ut,X&&(W=Math.cos(X),y=Math.sin(X),N=Y*W+f*y,v=J*W+H*y,f=f*W-Y*y,H=H*W-J*y,Y=N,J=v),h&&Math.abs(h)+Math.abs(d)>359.9&&(h=d=0,m=180-m),l=yg(Math.sqrt(Y*Y+f*f+L*L)),c=yg(Math.sqrt(H*H+z*z)),X=VC(J,H),r=Math.abs(X)>2e-4?X*ut:0,b=x?1/(x<0?-x:x):0),I.svg&&(N=V.getAttribute("transform"),I.forceCSS=V.setAttribute("transform","")||!Kr(We(V,Ug)),N&&V.setAttribute("transform",N))),Math.abs(r)>90&&Math.abs(r)<270&&(t?(l*=-1,r+=d<=0?180:-180,d+=d<=0?180:-180):(c*=-1,r+=r<=0?180:-180)),g=g||I.uncache,I.x=a-((I.xPercent=a&&(!g&&I.xPercent||(Math.round(V.offsetWidth/2)===Math.round(-a)?-50:0)))?V.offsetWidth*I.xPercent/100:0)+C,I.y=o-((I.yPercent=o&&(!g&&I.yPercent||(Math.round(V.offsetHeight/2)===Math.round(-o)?-50:0)))?V.offsetHeight*I.yPercent/100:0)+C,I.z=n+C,I.scaleX=yg(l),I.scaleY=yg(c),I.rotation=yg(d)+A,I.rotationX=yg(h)+A,I.rotationY=yg(m)+A,I.skewX=r+A,I.skewY=u+A,I.transformPerspective=b+C,(I.zOrigin=parseFloat(s.split(" ")[2])||0)&&(e[et]=UA(s)),I.xOffset=I.yOffset=0,I.force3D=pI.force3D,I.renderTransform=I.svg?ey:Sr?Jr:Iy,I.uncache=0,I},UA=function(V){return(V=V.split(" "))[0]+" "+V[1]},gs=function(V,g,I){var e=Og(g);return yg(parseFloat(g)+parseFloat(tt(V,"x",I+"px",e)))+e},Iy=function(V,g){g.z="0px",g.rotationY=g.rotationX="0deg",g.force3D=0,Jr(V,g)},rt="0deg",QC="0px",ht=") ",Jr=function(V,g){var I=g||this,e=I.xPercent,t=I.yPercent,C=I.x,A=I.y,s=I.z,a=I.rotation,o=I.rotationY,n=I.rotationX,l=I.skewX,c=I.skewY,d=I.scaleX,h=I.scaleY,m=I.transformPerspective,r=I.force3D,u=I.target,b=I.zOrigin,Z="",p=r==="auto"&&V&&V!==1||r===!0;if(b&&(n!==rt||o!==rt)){var G=parseFloat(o)*dC,X=Math.sin(G),W=Math.cos(G),y;G=parseFloat(n)*dC,y=Math.cos(G),C=gs(u,C,X*y*-b),A=gs(u,A,-Math.sin(G)*-b),s=gs(u,s,W*y*-b+b)}m!==QC&&(Z+="perspective("+m+ht),(e||t)&&(Z+="translate("+e+"%, "+t+"%) "),(p||C!==QC||A!==QC||s!==QC)&&(Z+=s!==QC||p?"translate3d("+C+", "+A+", "+s+") ":"translate("+C+", "+A+ht),a!==rt&&(Z+="rotate("+a+ht),o!==rt&&(Z+="rotateY("+o+ht),n!==rt&&(Z+="rotateX("+n+ht),(l!==rt||c!==rt)&&(Z+="skew("+l+", "+c+ht),(d!==1||h!==1)&&(Z+="scale("+d+", "+h+ht),u.style[Ug]=Z||"translate(0, 0)"},ey=function(V,g){var I=g||this,e=I.xPercent,t=I.yPercent,C=I.x,A=I.y,s=I.rotation,a=I.skewX,o=I.skewY,n=I.scaleX,l=I.scaleY,c=I.target,d=I.xOrigin,h=I.yOrigin,m=I.xOffset,r=I.yOffset,u=I.forceCSS,b=parseFloat(C),Z=parseFloat(A),p,G,X,W,y;s=parseFloat(s),a=parseFloat(a),o=parseFloat(o),o&&(o=parseFloat(o),a+=o,s+=o),s||a?(s*=dC,a*=dC,p=Math.cos(s)*n,G=Math.sin(s)*n,X=Math.sin(s-a)*-l,W=Math.cos(s-a)*l,a&&(o*=dC,y=Math.tan(a-o),y=Math.sqrt(1+y*y),X*=y,W*=y,o&&(y=Math.tan(o),y=Math.sqrt(1+y*y),p*=y,G*=y)),p=yg(p),G=yg(G),X=yg(X),W=yg(W)):(p=n,W=l,G=X=0),(b&&!~(C+"").indexOf("px")||Z&&!~(A+"").indexOf("px"))&&(b=tt(c,"x",C,"px"),Z=tt(c,"y",A,"px")),(d||h||m||r)&&(b=yg(b+d-(d*p+h*X)+m),Z=yg(Z+h-(d*G+h*W)+r)),(e||t)&&(y=c.getBBox(),b=yg(b+e/100*y.width),Z=yg(Z+t/100*y.height)),y="matrix("+p+","+G+","+X+","+W+","+b+","+Z+")",c.setAttribute("transform",y),u&&(c.style[Ug]=y)},ty=function(V,g,I,e,t){var C=360,A=kg(t),s=parseFloat(t)*(A&&~t.indexOf("rad")?ut:1),a=s-e,o=e+a+"deg",n,l;return A&&(n=t.split("_")[1],n==="short"&&(a%=C,a!==a%(C/2)&&(a+=a<0?C:-C)),n==="cw"&&a<0?a=(a+C*_o)%C-~~(a/C)*C:n==="ccw"&&a>0&&(a=(a-C*_o)%C-~~(a/C)*C)),V._pt=l=new dI(V._pt,g,I,e,a,LW),l.e=o,l.u="deg",V._props.push(I),l},tc=function(V,g){for(var I in g)V[I]=g[I];return V},Cy=function(V,g,I){var e=tc({},I._gsap),t="perspective,force3D,transformOrigin,svgOrigin",C=I.style,A,s,a,o,n,l,c,d;e.svg?(a=I.getAttribute("transform"),I.setAttribute("transform",""),C[Ug]=g,A=wi(I,1),Ri(I,Ug),I.setAttribute("transform",a)):(a=getComputedStyle(I)[Ug],C[Ug]=g,A=wi(I,1),C[Ug]=a);for(s in It)a=e[s],o=A[s],a!==o&&t.indexOf(s)<0&&(c=Og(a),d=Og(o),n=c!==d?tt(I,s,a,d):parseFloat(a),l=parseFloat(o),V._pt=new dI(V._pt,A,s,n,l-n,wr),V._pt.u=d||0,V._props.push(s));tc(A,e)};cI("padding,margin,Width,Radius",function(i,V){var g="Top",I="Right",e="Bottom",t="Left",C=(V<3?[g,I,e,t]:[g+t,g+I,e+I,e+t]).map(function(A){return V<2?i+A:"border"+A+i});LA[V>1?"border"+i:i]=function(A,s,a,o,n){var l,c;if(arguments.length<4)return l=C.map(function(d){return bt(A,d,a)}),c=l.join(" "),c.split(l[0]).length===5?l[0]:c;l=(o+"").split(" "),c={},C.forEach(function(d,h){return c[d]=l[h]=l[h]||l[(h-1)/2|0]}),A.init(s,c,n)}});var jl={name:"css",register:Ls,targetTest:function(V){return V.style&&V.nodeType},init:function(V,g,I,e,t){var C=this._props,A=V.style,s=I.vars.startAt,a,o,n,l,c,d,h,m,r,u,b,Z,p,G,X;El||Ls();for(h in g)if(h!=="autoRound"&&(o=g[h],!(bI[h]&&pr(h,g,I,e,V,t)))){if(c=typeof o,d=LA[h],c==="function"&&(o=o.call(I,e,V,t),c=typeof o),c==="string"&&~o.indexOf("random(")&&(o=Wi(o)),d)d(this,V,h,o,I)&&(X=1);else if(h.substr(0,2)==="--")a=(getComputedStyle(V).getPropertyValue(h)+"").trim(),o+="",$e.lastIndex=0,$e.test(a)||(m=Og(a),r=Og(o)),r?m!==r&&(a=tt(V,h,a,r)+r):m&&(o+=m),this.add(A,"setProperty",a,o,e,t,0,0,h),C.push(h);else if(c!=="undefined"){if(s&&h in s?(a=typeof s[h]=="function"?s[h].call(I,e,V,t):s[h],kg(a)&&~a.indexOf("random(")&&(a=Wi(a)),Og(a+"")||(a+=pI.units[h]||Og(bt(V,h))||""),(a+"").charAt(1)==="="&&(a=bt(V,h))):a=bt(V,h),l=parseFloat(a),u=c==="string"&&o.charAt(1)==="="&&o.substr(0,2),u&&(o=o.substr(2)),n=parseFloat(o),h in Ee&&(h==="autoAlpha"&&(l===1&&bt(V,"visibility")==="hidden"&&n&&(l=0),Qe(this,A,"visibility",l?"inherit":"hidden",n?"inherit":"hidden",!n)),h!=="scale"&&h!=="transform"&&(h=Ee[h],~h.indexOf(",")&&(h=h.split(",")[0]))),b=h in It,b){if(Z||(p=V._gsap,p.renderTransform&&!g.parseTransform||wi(V,g.parseTransform),G=g.smoothOrigin!==!1&&p.smooth,Z=this._pt=new dI(this._pt,A,Ug,0,1,p.renderTransform,p,0,-1),Z.dep=1),h==="scale")this._pt=new dI(this._pt,p,"scaleY",p.scaleY,(u?oC(p.scaleY,u+n):n)-p.scaleY||0),C.push("scaleY",h),h+="X";else if(h==="transformOrigin"){o=Vy(o),p.svg?Us(V,o,0,G,0,this):(r=parseFloat(o.split(" ")[2])||0,r!==p.zOrigin&&Qe(this,p,"zOrigin",p.zOrigin,r),Qe(this,A,h,UA(a),UA(o)));continue}else if(h==="svgOrigin"){Us(V,o,1,G,0,this);continue}else if(h in Nr){ty(this,p,h,l,u?oC(l,u+o):o);continue}else if(h==="smoothOrigin"){Qe(this,p,"smooth",p.smooth,o);continue}else if(h==="force3D"){p[h]=o;continue}else if(h==="transform"){Cy(this,o,V);continue}}else h in A||(h=BC(h)||h);if(b||(n||n===0)&&(l||l===0)&&!TW.test(o)&&h in A)m=(a+"").substr((l+"").length),n||(n=0),r=Og(o)||(h in pI.units?pI.units[h]:m),m!==r&&(l=tt(V,h,a,r)),this._pt=new dI(this._pt,b?p:A,h,l,(u?oC(l,u+n):n)-l,!b&&(r==="px"||h==="zIndex")&&g.autoRound!==!1?DW:wr),this._pt.u=r||0,m!==r&&r!=="%"&&(this._pt.b=a,this._pt.r=UW);else if(h in A)$W.call(this,V,h,a,u?u+o:o);else if(h in V)this.add(V,h,a||V[h],u?u+o:o,e,t);else{Kl(h,o);continue}C.push(h)}}X&&Rr(this)},get:bt,aliases:Ee,getSetter:function(V,g,I){var e=Ee[g];return e&&e.indexOf(",")<0&&(g=e),g in It&&g!==et&&(V._gsap.x||bt(V,"x"))?I&&Oo===I?g==="scale"?PW:jW:(Oo=I||{})&&(g==="scale"?OW:_W):V.style&&!vl(V.style[g])?EW:~g.indexOf("-")?QW:Ul(V,g)},core:{_removeProperty:Ri,_getMatrix:Ql}};yI.utils.checkPrefix=BC;(function(i,V,g,I){var e=cI(i+","+V+","+g,function(t){It[t]=1});cI(V,function(t){pI.units[t]="deg",Nr[t]=1}),Ee[e[13]]=i+","+V,cI(I,function(t){var C=t.split(":");Ee[C[1]]=e[C[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");cI("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){pI.units[i]="px"});yI.registerPlugin(jl);var ke=yI.registerPlugin(jl)||yI;ke.core.Tween;class Pl extends BI{constructor(){super(),autobind(this),this.frame=0,this.newTime=0,this.deltaTime=0,this.elapsedTime=0,this.listDeltaRatio=[],this.deltaRatio=0,this.history=[],this.started=!1,this.requestID=null,this.start(),ke.ticker.add(this.update),ke.ticker.fps(60)}start(){this.started||(this.started=!0)}stop(){!this.started||(this.started=!1)}update(V,g,I){if(this.frame=I,this.deltaTime=g,this.elapsedTime=V*1e3,this.listDeltaRatio.length>0&&ke.ticker.deltaRatio()*1.5<this.listDeltaRatio[this.listDeltaRatio.length-1]&&(this.listDeltaRatio=[]),this.listDeltaRatio.length==0)this.deltaRatio=ke.ticker.deltaRatio(),this.listDeltaRatio.push(ke.ticker.deltaRatio());else if(this.listDeltaRatio.length<20){var e=0;this.listDeltaRatio.forEach(t=>{e+=t}),this.deltaRatio=e/this.listDeltaRatio.length,this.listDeltaRatio.push(ke.ticker.deltaRatio())}else{var e=0;this.listDeltaRatio.forEach(C=>{e+=C}),this.deltaRatio=e/this.listDeltaRatio.length,this.listDeltaRatio.shift(),this.listDeltaRatio.push(ke.ticker.deltaRatio())}this.deltaRatio>=1.2&&(this.deltaRatio*=.9),this.dispatchEvent({type:"update"})}wait(V=1e3){return SV(this,null,function*(){yield new Promise(g=>this.setDelay(g,V))})}setRepeat(V,g){let I=this.elapsedTime;const e=new Object,t=()=>{this.elapsedTime-I>=g&&(V.call(),I=this.elapsedTime),e.requestID=requestAnimationFrame(t)};return e.requestID=requestAnimationFrame(t),e}clearRepeat(V){!V||cancelAnimationFrame(V.requestID)}setDelay(V,g){const I=this.elapsedTime,e=new Object,t=()=>{this.elapsedTime-I>=g?V.call():e.requestID=requestAnimationFrame(t)};return e.requestID=requestAnimationFrame(t),e}clearDelay(V){!V||cancelAnimationFrame(V.requestID)}}class iy extends BI{constructor(){super(),autobind(this),this.size=new dV;const{Viewport:V}=q.DOMElements,{clientWidth:g,clientHeight:I}=V;this.setSize(g,I),addEventListener("resize",this.onResize),q.addEventListener("update",this.update)}setSize(V,g){const{devicePixelRatio:I}=window,e=this.width===V,t=this.height===g,C=!e||!t;this.width=V,this.height=g,this.size.set(this.width,this.height),this.aspect=this.width/this.height,this.devicePixelRatio=I||1,this.orientation=this.aspect>1?"landscape":"portrait";const{documentElement:A}=document;q.setStyleProperty(A,"--inner-height",`${this.height}px`),q.setStyleProperty(A,"--inner-width",`${this.width}px`),C&&q.dispatchEvent({type:"resize"})}update(){return SV(this,null,function*(){const{fullscreen:V}=q.settings.general;this.isFullscreen!==V&&(this.isFullscreen=V,document.body.setAttribute("data-fullscreen",this.isFullscreen),this.onResize())})}onResize(){const{Viewport:V}=q.DOMElements,{clientWidth:g,clientHeight:I}=V;this.setSize(g,I)}}var Te={user:{name:{value:"Player"},coins:{value:0,min:0,max:1e8,step:10},controls:{value:!0},tournaments:{value:[]},skinID:{value:"Cube",options:["Cube","Vache","Elephant","Girafe","Hippo","Licorne","Burger","Bus","Avion","Canard","Cochon","Crotte","Donut","Wc","Rhinoceros","Rouleau","Souris","Voiture","Mammouth","Police","Pq"]},bestStats:{percentCovered:{value:0,min:0,max:1e4,step:1},consecutiveDays:{value:0,min:0,max:10,step:1,disabled:!0},killCount:{value:0,min:0,max:100,step:1},kingKilled:{value:!1},consecutiveKills:{value:0,min:0,max:15,step:1},timeOutsideZone:{value:0,min:0,max:20,step:.01},percentCoveredWithoutKill:{value:1.15,min:0,max:1e4,step:1},revive:{value:0,min:0,max:15,step:1}}},general:{store:{value:!1},share:{value:!0},advertisment:{value:!0},fullscreen:{value:!0}},quality:{transitions:{value:!0},animations:{value:!0},spritesheets:{value:!0},particles:{value:!0},territory:{value:3,min:0,max:4,step:1}},bonus:{price:{value:100,min:0,max:900,step:50},duration:{value:10,min:0,max:20,step:.5},kill:{value:3,min:0,max:5,step:1}},gameplay:{speed:{value:.6,min:0,max:4,step:.1},friction:{value:.1,min:0,max:.05,step:9e-6},angleTurn:{value:.2,min:0,max:1,step:9e-6}},bots:{count:{value:7,min:0,max:15,step:1,disabled:!0},hunt:{value:!0},aggressivity:{value:20,min:5,max:75,step:1}},skinSelector:{development:!0,speed:{value:2.5,min:0,max:10,step:.1}},development:{development:!0,views:{top:{value:!1},global:{value:!1},ia:{value:!1}},bots:{waypoints:{value:!1},hunting:{value:!1}},helpers:{visible:{value:!1}},controls:{enabled:{value:!1},target:{value:"Scene",options:["Scene"]}}},renderer:{development:!0,quality:{value:2,min:.5,max:2,step:.25,disabled:!0},pixelRatio:{value:2,min:1,max:2,step:.5,disabled:!0},antialias:{value:!0,disabled:!0},clearColor:{value:"#ffffff",disabled:!0}},physics:{development:!0,timeScale:{value:1,min:.01,max:2,step:.01,development:!0},gravity:{value:100,min:0,max:100,step:.1}},fog:{density:{value:0,min:0,max:.2,step:.001},color:{value:"#ffffff"}},camera:{object:{value:"User",options:["User","Bot"]},position:{x:{value:0,min:-150,max:150,step:.1},y:{value:15,min:-150,max:150,step:.1},z:{value:25,min:-150,max:150,step:.1}},target:{x:{value:0,min:-150,max:150,step:.1},y:{value:0,min:-150,max:150,step:.1},z:{value:0,min:-150,max:150,step:.1}},fov:{value:35,min:10,max:120,step:1,development:!0},near:{value:1,min:.1,max:5,step:.1,development:!0},far:{value:500,min:10,max:1e3,step:10,development:!0}},lighting:{development:!0,sky:{topColor:{value:"#0065ad"},bottomColor:{value:"#5cd6ff"}},ambientLight:{color:{value:"#ffffff"},intensity:{value:.4,min:0,max:2,step:.001}},hemisphereLight:{skyColor:{value:"#cceaff"},groundColor:{value:"#fdfff5"},intensity:{value:.5,min:0,max:2,step:.001}},directionalLight:{development:!0,color:{value:"#fff4e5"},intensity:{value:.2,min:0,max:2,step:.001},castShadow:{value:!0},shadowCameraSize:{value:10,min:0,max:200,step:.1},shadowMapSize:{value:2048,options:[512,1024,2048,4096],development:!0},position:{x:{value:20,min:-50,max:50,step:.1},y:{value:40,min:-50,max:50,step:.1},z:{value:4,min:-50,max:50,step:.1}}},spotLight:{development:!0,color:{value:"#fff4e5"},intensity:{value:.1,min:0,max:2,step:.001},distance:{value:100,min:10,max:100,step:1},angle:{value:.75,min:0,max:2,step:.01},penumbra:{value:.2,min:0,max:1,step:.01},decay:{value:2,min:1,max:2,step:.01},focus:{value:.25,min:0,max:1,step:.01},position:{x:{value:0,min:-50,max:50,step:.1},y:{value:10,min:-50,max:50,step:.1},z:{value:0,min:-50,max:50,step:.1}}}},postProcessing:{development:!0,enabled:{value:!0},vignette:{enabled:{value:!0},strength:{value:.5,min:0,max:2,step:.001},color:{value:"#000000"}}},sound:!0,vibrate:!1};class Ay extends BI{constructor(){super(),autobind(this),this.settings=JSON.parse(JSON.stringify(Te)),this.constraints=JSON.parse(JSON.stringify(Te)),this.traverse(this.constraints,this.settings,(V,g,I)=>{const e=Object.assign(new BI,V[I]);e.initialValue=e.value,e.currentValue=e.value,e.settings=g,V[I]=e,g[I]=e.value,this.addEventListener("reset",()=>e.settings[I]=e.initialValue),Object.defineProperty(V[I],"value",{get:()=>e.settings[I],set:function(t){e.currentValue!==e.value&&(e.currentValue=e.value,e.dispatchEvent({type:"change"})),e.settings[I]=t}})}),q.settings=this.settings,q.addEventListener("applySettings",this.applySettings)}applySettings(){this.traverse(this.constraints,this.settings,(V,g,I)=>V[I].settings=g)}reset(){this.dispatchEvent({type:"reset"})}traverse(V,g,I){for(const e in V)V[e].value!==void 0?I(V,g,e):this.traverse(V[e],g[e],I);return V}}class ny{constructor(){autobind(this),this.isMobile=q.setupIs().mobile,this.history=[],q.addEventListener("ready",this.initialize)}initialize(){return SV(this,null,function*(){this.checkPerformences()})}addEventListeners(){q.addEventListener("update",this.update)}start(){this.isStarted=!0}stop(){this.isStarted=!1}checkPerformences(){if(this.isMobile){const{renderer:V,quality:g,postProcessing:I,lighting:e,gameplay:t}=q.settings;V.antialias=!1,V.pixelRatio=1,g.animations=!1,g.spritesheets=!1,g.particles=!1,e.directionalLight.shadowMapSize=512,e.directionalLight.castShadow=!1,e.spotLight.intensity=0,I.enabled=!1,I.vignette.enabled=!1,t.speed=.5}}update(){}}var sy=`#define STANDARD\r
\r
varying vec3 vViewPosition;\r
\r
#ifndef FLAT_SHADED\r
\r
	varying vec3 vNormal;\r
\r
	#ifdef USE_TANGENT\r
\r
		varying vec3 vTangent;\r
		varying vec3 vBitangent;\r
\r
	#endif\r
\r
#endif\r
\r
#ifdef USE_TRANSMISSION\r
\r
	varying vec4 vWorldPosition;\r
\r
#endif\r
\r
#include <common>\r
#include <uv_pars_vertex>\r
#include <uv2_pars_vertex>\r
#include <displacementmap_pars_vertex>\r
#include <color_pars_vertex>\r
#include <fog_pars_vertex>\r
#include <morphtarget_pars_vertex>\r
#include <skinning_pars_vertex>\r
#include <shadowmap_pars_vertex>\r
#include <logdepthbuf_pars_vertex>\r
#include <clipping_planes_pars_vertex>\r
\r
void main() {\r
\r
	#include <uv_vertex>\r
	#include <uv2_vertex>\r
	#include <color_vertex>\r
\r
	#include <beginnormal_vertex>\r
	#include <morphnormal_vertex>\r
	#include <skinbase_vertex>\r
	#include <skinnormal_vertex>\r
	#include <defaultnormal_vertex>\r
\r
#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\r
\r
	vNormal = normalize( transformedNormal );\r
\r
	#ifdef USE_TANGENT\r
\r
		vTangent = normalize( transformedTangent );\r
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\r
\r
	#endif\r
\r
#endif\r
\r
	#include <begin_vertex>\r
	#include <morphtarget_vertex>\r
	#include <skinning_vertex>\r
	#include <displacementmap_vertex>\r
	#include <project_vertex>\r
	#include <logdepthbuf_vertex>\r
	#include <clipping_planes_vertex>\r
\r
	vViewPosition = - mvPosition.xyz;\r
\r
	#include <worldpos_vertex>\r
	#include <shadowmap_vertex>\r
	#include <fog_vertex>\r
\r
	#ifdef USE_UV\r
\r
	vUv = ( uvTransform * vec3( worldPosition.xz, 1 ) ).xy;\r
\r
	#endif\r
\r
#ifdef USE_TRANSMISSION\r
\r
	vWorldPosition = worldPosition;\r
\r
#endif\r
}\r
`,ly=`#define STANDARD\r
\r
#ifdef PHYSICAL\r
	#define REFLECTIVITY\r
	#define CLEARCOAT\r
#endif\r
\r
uniform vec3 diffuse;\r
uniform vec3 emissive;\r
uniform float roughness;\r
uniform float metalness;\r
uniform float opacity;\r
\r
#ifdef USE_TRANSMISSION\r
	uniform float transmission;\r
	uniform float thickness;\r
	uniform vec3 attenuationColor;\r
	uniform float attenuationDistance;\r
#endif\r
\r
#ifdef REFLECTIVITY\r
	uniform float reflectivity;\r
#endif\r
\r
#ifdef CLEARCOAT\r
	uniform float clearcoat;\r
	uniform float clearcoatRoughness;\r
#endif\r
\r
#ifdef USE_SHEEN\r
	uniform vec3 sheen;\r
#endif\r
\r
varying vec3 vViewPosition;\r
\r
#ifndef FLAT_SHADED\r
\r
	varying vec3 vNormal;\r
\r
	#ifdef USE_TANGENT\r
\r
		varying vec3 vTangent;\r
		varying vec3 vBitangent;\r
\r
	#endif\r
\r
#endif\r
\r
#include <common>\r
#include <packing>\r
#include <dithering_pars_fragment>\r
#include <color_pars_fragment>\r
#include <uv_pars_fragment>\r
#include <uv2_pars_fragment>\r
#include <map_pars_fragment>\r
#include <alphamap_pars_fragment>\r
#include <aomap_pars_fragment>\r
#include <lightmap_pars_fragment>\r
#include <emissivemap_pars_fragment>\r
#include <bsdfs>\r
#include <transmission_pars_fragment>\r
#include <cube_uv_reflection_fragment>\r
#include <envmap_common_pars_fragment>\r
#include <envmap_physical_pars_fragment>\r
#include <fog_pars_fragment>\r
#include <lights_pars_begin>\r
#include <lights_physical_pars_fragment>\r
#include <shadowmap_pars_fragment>\r
#include <bumpmap_pars_fragment>\r
#include <normalmap_pars_fragment>\r
#include <clearcoat_pars_fragment>\r
#include <roughnessmap_pars_fragment>\r
#include <metalnessmap_pars_fragment>\r
#include <logdepthbuf_pars_fragment>\r
#include <clipping_planes_pars_fragment>\r
\r
void main() {\r
\r
	#include <clipping_planes_fragment>\r
\r
	vec4 diffuseColor = vec4( diffuse, opacity );\r
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r
	vec3 totalEmissiveRadiance = emissive;\r
\r
	#include <logdepthbuf_fragment>\r
	#include <map_fragment>\r
	#include <color_fragment>\r
	#include <alphamap_fragment>\r
	#include <alphatest_fragment>\r
	#include <roughnessmap_fragment>\r
	#include <metalnessmap_fragment>\r
	#include <normal_fragment_begin>\r
	#include <normal_fragment_maps>\r
	#include <clearcoat_normal_fragment_begin>\r
	#include <clearcoat_normal_fragment_maps>\r
	#include <emissivemap_fragment>\r
\r
	// accumulation\r
	#include <lights_physical_fragment>\r
	#include <lights_fragment_begin>\r
	#include <lights_fragment_maps>\r
	#include <lights_fragment_end>\r
\r
	// modulation\r
	#include <aomap_fragment>\r
\r
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\r
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\r
\r
	#include <transmission_fragment>\r
\r
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\r
\r
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );\r
\r
	#include <tonemapping_fragment>\r
	#include <encodings_fragment>\r
	#include <fog_fragment>\r
	#include <premultiplied_alpha_fragment>\r
	#include <dithering_fragment>\r
\r
}\r
`;class Mr extends Hg{constructor(V={}){super(V),autobind(this),this.type="StandardMaterial",this.vertexShader=sy,this.fragmentShader=ly,this.uniforms=Object.assign({},St.clone(tI.standard.uniforms))}}var ay=`#define STANDARD\r
\r
varying vec3 vViewPosition;\r
\r
#ifndef FLAT_SHADED\r
\r
	varying vec3 vNormal;\r
\r
	#ifdef USE_TANGENT\r
\r
		varying vec3 vTangent;\r
		varying vec3 vBitangent;\r
\r
	#endif\r
\r
#endif\r
\r
#ifdef USE_TRANSMISSION\r
\r
	varying vec4 vWorldPosition;\r
\r
#endif\r
\r
#include <common>\r
#include <uv_pars_vertex>\r
#include <uv2_pars_vertex>\r
#include <displacementmap_pars_vertex>\r
#include <color_pars_vertex>\r
#include <fog_pars_vertex>\r
#include <morphtarget_pars_vertex>\r
#include <skinning_pars_vertex>\r
#include <shadowmap_pars_vertex>\r
#include <logdepthbuf_pars_vertex>\r
#include <clipping_planes_pars_vertex>\r
\r
attribute vec3 extrusion;\r
attribute float side;\r
attribute float counters;\r
\r
varying vec2 vLinearGradient;\r
\r
uniform float lineWidth;\r
uniform float hasWorldCoordinates;\r
\r
void main() {\r
\r
	vLinearGradient = uv;\r
\r
	#include <uv_vertex>\r
	#include <uv2_vertex>\r
	#include <color_vertex>\r
\r
	#include <beginnormal_vertex>\r
	#include <morphnormal_vertex>\r
	#include <skinbase_vertex>\r
	#include <skinnormal_vertex>\r
	#include <defaultnormal_vertex>\r
\r
#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\r
\r
	vNormal = normalize( transformedNormal );\r
\r
	#ifdef USE_TANGENT\r
\r
		vTangent = normalize( transformedTangent );\r
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\r
\r
	#endif\r
\r
#endif\r
\r
	#include <begin_vertex>\r
\r
	transformed += extrusion * lineWidth * side * .5;\r
\r
	#include <morphtarget_vertex>\r
	#include <skinning_vertex>\r
	#include <displacementmap_vertex>\r
	#include <project_vertex>\r
	#include <logdepthbuf_vertex>\r
	#include <clipping_planes_vertex>\r
\r
	vViewPosition = - mvPosition.xyz;\r
\r
	#include <worldpos_vertex>\r
	#include <shadowmap_vertex>\r
	#include <fog_vertex>\r
\r
	#ifdef USE_UV\r
\r
	if ( hasWorldCoordinates > .5 ) vUv = ( uvTransform * vec3( worldPosition.xz, 1 ) ).xy;\r
\r
	#endif\r
\r
#ifdef USE_TRANSMISSION\r
\r
	vWorldPosition = worldPosition;\r
\r
#endif\r
}\r
`,oy=`#define STANDARD\r
\r
#ifdef PHYSICAL\r
	#define REFLECTIVITY\r
	#define CLEARCOAT\r
#endif\r
\r
uniform vec3 diffuse;\r
uniform vec3 emissive;\r
uniform float roughness;\r
uniform float metalness;\r
uniform float opacity;\r
\r
#ifdef USE_TRANSMISSION\r
	uniform float transmission;\r
	uniform float thickness;\r
	uniform vec3 attenuationColor;\r
	uniform float attenuationDistance;\r
#endif\r
\r
#ifdef REFLECTIVITY\r
	uniform float reflectivity;\r
#endif\r
\r
#ifdef CLEARCOAT\r
	uniform float clearcoat;\r
	uniform float clearcoatRoughness;\r
#endif\r
\r
#ifdef USE_SHEEN\r
	uniform vec3 sheen;\r
#endif\r
\r
varying vec3 vViewPosition;\r
\r
#ifndef FLAT_SHADED\r
\r
	varying vec3 vNormal;\r
\r
	#ifdef USE_TANGENT\r
\r
		varying vec3 vTangent;\r
		varying vec3 vBitangent;\r
\r
	#endif\r
\r
#endif\r
\r
#include <common>\r
#include <packing>\r
#include <dithering_pars_fragment>\r
#include <color_pars_fragment>\r
#include <uv_pars_fragment>\r
#include <uv2_pars_fragment>\r
#include <map_pars_fragment>\r
#include <alphamap_pars_fragment>\r
#include <aomap_pars_fragment>\r
#include <lightmap_pars_fragment>\r
#include <emissivemap_pars_fragment>\r
#include <bsdfs>\r
#include <transmission_pars_fragment>\r
#include <cube_uv_reflection_fragment>\r
#include <envmap_common_pars_fragment>\r
#include <envmap_physical_pars_fragment>\r
#include <fog_pars_fragment>\r
#include <lights_pars_begin>\r
#include <lights_physical_pars_fragment>\r
#include <shadowmap_pars_fragment>\r
#include <bumpmap_pars_fragment>\r
#include <normalmap_pars_fragment>\r
#include <clearcoat_pars_fragment>\r
#include <roughnessmap_pars_fragment>\r
#include <metalnessmap_pars_fragment>\r
#include <logdepthbuf_pars_fragment>\r
#include <clipping_planes_pars_fragment>\r
\r
uniform float linearGradientOffset;\r
varying vec2 vLinearGradient;\r
\r
void main() {\r
\r
	#include <clipping_planes_fragment>\r
\r
	float linearGradient = ( 1. - vLinearGradient.x - linearGradientOffset * 1.25 ) + .25;\r
	vec4 diffuseColor = vec4( diffuse, opacity * clamp( linearGradient * 10., 0., 1. ) );\r
\r
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r
	vec3 totalEmissiveRadiance = emissive;\r
\r
	#include <logdepthbuf_fragment>\r
	#include <map_fragment>\r
	#include <color_fragment>\r
	#include <alphamap_fragment>\r
	#include <alphatest_fragment>\r
	#include <roughnessmap_fragment>\r
	#include <metalnessmap_fragment>\r
	#include <normal_fragment_begin>\r
	#include <normal_fragment_maps>\r
	#include <clearcoat_normal_fragment_begin>\r
	#include <clearcoat_normal_fragment_maps>\r
	#include <emissivemap_fragment>\r
\r
	// accumulation\r
	#include <lights_physical_fragment>\r
	#include <lights_fragment_begin>\r
	#include <lights_fragment_maps>\r
	#include <lights_fragment_end>\r
\r
	// modulation\r
	#include <aomap_fragment>\r
\r
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\r
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\r
\r
	#include <transmission_fragment>\r
\r
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\r
\r
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );\r
\r
	#include <tonemapping_fragment>\r
	#include <encodings_fragment>\r
	#include <fog_fragment>\r
	#include <premultiplied_alpha_fragment>\r
	#include <dithering_fragment>\r
\r
}\r
`;class Ol extends Hg{constructor(V={}){Object.assign(Ol.prototype,{lineWidth:null,linearGradientOffset:null,hasWorldCoordinates:null}),super(V),autobind(this),this.type="StandardMaterial",this.vertexShader=ay,this.fragmentShader=oy,this.lineWidth=V.lineWidth||1,this.linearGradientOffset=V.linearGradientOffset||0,this.hasWorldCoordinates=V.hasWorldCoordinates||!1,this.uniforms=Object.assign({lineWidth:{value:1},linearGradientOffset:{value:0},hasWorldCoordinates:{value:!1}},St.clone(tI.standard.uniforms)),q.addEventListener("update",this.update)}update(){this.uniforms.lineWidth.value=this.lineWidth,this.uniforms.linearGradientOffset.value=this.linearGradientOffset,this.uniforms.hasWorldCoordinates.value=this.hasWorldCoordinates}}var cy=`#include <common>\r
#include <uv_pars_vertex>\r
#include <uv2_pars_vertex>\r
#include <envmap_pars_vertex>\r
#include <color_pars_vertex>\r
#include <fog_pars_vertex>\r
#include <morphtarget_pars_vertex>\r
#include <skinning_pars_vertex>\r
#include <logdepthbuf_pars_vertex>\r
#include <clipping_planes_pars_vertex>\r
\r
attribute vec3 extrusion;\r
attribute float side;\r
attribute float counters;\r
\r
uniform float lineWidth;\r
uniform float hasWorldCoordinates;\r
\r
void main() {\r
\r
	#include <uv_vertex>\r
	#include <uv2_vertex>\r
	#include <color_vertex>\r
	#include <skinbase_vertex>\r
\r
	#ifdef USE_ENVMAP\r
\r
	#include <beginnormal_vertex>\r
	#include <morphnormal_vertex>\r
	#include <skinnormal_vertex>\r
	#include <defaultnormal_vertex>\r
\r
	#endif\r
\r
	#include <begin_vertex>\r
\r
	transformed += extrusion * lineWidth * side * .5;\r
\r
	#include <morphtarget_vertex>\r
	#include <skinning_vertex>\r
	#include <project_vertex>\r
	#include <logdepthbuf_vertex>\r
\r
	#include <worldpos_vertex>\r
	#include <clipping_planes_vertex>\r
	#include <envmap_vertex>\r
	#include <fog_vertex>\r
\r
	#ifdef USE_UV\r
\r
	if ( hasWorldCoordinates > .5 ) vUv = ( uvTransform * vec3( worldPosition.xz, 1 ) ).xy;\r
\r
	#endif\r
\r
}\r
`,dy=`uniform vec3 diffuse;\r
uniform float opacity;\r
\r
#ifndef FLAT_SHADED\r
\r
	varying vec3 vNormal;\r
\r
#endif\r
\r
#include <common>\r
#include <dithering_pars_fragment>\r
#include <color_pars_fragment>\r
#include <uv_pars_fragment>\r
#include <uv2_pars_fragment>\r
#include <map_pars_fragment>\r
#include <alphamap_pars_fragment>\r
#include <aomap_pars_fragment>\r
#include <lightmap_pars_fragment>\r
#include <envmap_common_pars_fragment>\r
#include <envmap_pars_fragment>\r
#include <cube_uv_reflection_fragment>\r
#include <fog_pars_fragment>\r
#include <specularmap_pars_fragment>\r
#include <logdepthbuf_pars_fragment>\r
#include <clipping_planes_pars_fragment>\r
\r
void main() {\r
\r
	#include <clipping_planes_fragment>\r
\r
	vec4 diffuseColor = vec4( diffuse, opacity );\r
\r
	#include <logdepthbuf_fragment>\r
	#include <map_fragment>\r
	#include <color_fragment>\r
	#include <alphamap_fragment>\r
	#include <alphatest_fragment>\r
	#include <specularmap_fragment>\r
\r
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r
\r
	// accumulation (baked indirect lighting only)\r
	#ifdef USE_LIGHTMAP\r
\r
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );\r
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\r
\r
	#else\r
\r
		reflectedLight.indirectDiffuse += vec3( 1.0 );\r
\r
	#endif\r
\r
	// modulation\r
	#include <aomap_fragment>\r
\r
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\r
\r
	vec3 outgoingLight = reflectedLight.indirectDiffuse;\r
\r
	#include <envmap_fragment>\r
\r
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );\r
\r
	#include <tonemapping_fragment>\r
	#include <encodings_fragment>\r
	#include <fog_fragment>\r
	#include <premultiplied_alpha_fragment>\r
	#include <dithering_fragment>\r
\r
}\r
`;class _l extends EI{constructor(V={}){Object.assign(_l.prototype,{lineWidth:null,linearGradientOffset:null,hasWorldCoordinates:null}),super(V),autobind(this),this.type="BasicMaterial",this.vertexShader=cy,this.fragmentShader=dy,this.uniforms=Object.assign({lineWidth:{value:1},hasWorldCoordinates:{value:!1}},St.clone(tI.standard.uniforms)),q.addEventListener("update",this.update)}update(){this.uniforms.lineWidth.value=this.lineWidth,this.uniforms.hasWorldCoordinates.value=this.hasWorldCoordinates}}class ry extends He{constructor(V){super(V),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(g){return new by(g)}),this.register(function(g){return new Gy(g)}),this.register(function(g){return new py(g)}),this.register(function(g){return new Zy(g)}),this.register(function(g){return new my(g)}),this.register(function(g){return new qy(g)})}load(V,g,I,e){const t=this;let C;this.resourcePath!==""?C=this.resourcePath:this.path!==""?C=this.path:C=aC.extractUrlBase(V),this.manager.itemStart(V);const A=function(a){e?e(a):console.error(a),t.manager.itemError(V),t.manager.itemEnd(V)},s=new yl(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(V,function(a){try{t.parse(a,C,function(o){g(o),t.manager.itemEnd(V)},A)}catch(o){A(o)}},I,A)}setDRACOLoader(V){return this.dracoLoader=V,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(V){return this.ktx2Loader=V,this}setMeshoptDecoder(V){return this.meshoptDecoder=V,this}register(V){return this.pluginCallbacks.indexOf(V)===-1&&this.pluginCallbacks.push(V),this}unregister(V){return this.pluginCallbacks.indexOf(V)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(V),1),this}parse(V,g,I,e){let t;const C={},A={};if(typeof V=="string")t=V;else if(aC.decodeText(new Uint8Array(V,0,4))===xr){try{C[_V.KHR_BINARY_GLTF]=new By(V)}catch(n){e&&e(n);return}t=C[_V.KHR_BINARY_GLTF].content}else t=aC.decodeText(new Uint8Array(V));const s=JSON.parse(t);if(s.asset===void 0||s.asset.version[0]<2){e&&e(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const a=new Fy(s,{path:g||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let o=0;o<this.pluginCallbacks.length;o++){const n=this.pluginCallbacks[o](a);A[n.name]=n,C[n.name]=!0}if(s.extensionsUsed)for(let o=0;o<s.extensionsUsed.length;++o){const n=s.extensionsUsed[o],l=s.extensionsRequired||[];switch(n){case _V.KHR_MATERIALS_UNLIT:C[n]=new uy;break;case _V.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:C[n]=new Xy;break;case _V.KHR_DRACO_MESH_COMPRESSION:C[n]=new Wy(s,this.dracoLoader);break;case _V.KHR_TEXTURE_TRANSFORM:C[n]=new yy;break;case _V.KHR_MESH_QUANTIZATION:C[n]=new Ry;break;default:l.indexOf(n)>=0&&A[n]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+n+'".')}}a.setExtensions(C),a.setPlugins(A),a.parse(I,e)}}function hy(){let i={};return{get:function(V){return i[V]},add:function(V,g){i[V]=g},remove:function(V){delete i[V]},removeAll:function(){i={}}}}const _V={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class my{constructor(V){this.parser=V,this.name=_V.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const V=this.parser,g=this.parser.json.nodes||[];for(let I=0,e=g.length;I<e;I++){const t=g[I];t.extensions&&t.extensions[this.name]&&t.extensions[this.name].light!==void 0&&V._addNodeRef(this.cache,t.extensions[this.name].light)}}_loadLight(V){const g=this.parser,I="light:"+V;let e=g.cache.get(I);if(e)return e;const t=g.json,s=((t.extensions&&t.extensions[this.name]||{}).lights||[])[V];let a;const o=new NV(16777215);s.color!==void 0&&o.fromArray(s.color);const n=s.range!==void 0?s.range:0;switch(s.type){case"directional":a=new en(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new Sd(o),a.distance=n;break;case"spot":a=new Yl(o),a.distance=n,s.spot=s.spot||{},s.spot.innerConeAngle=s.spot.innerConeAngle!==void 0?s.spot.innerConeAngle:0,s.spot.outerConeAngle=s.spot.outerConeAngle!==void 0?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,s.intensity!==void 0&&(a.intensity=s.intensity),a.name=g.createUniqueName(s.name||"light_"+V),e=Promise.resolve(a),g.cache.add(I,e),e}createNodeAttachment(V){const g=this,I=this.parser,t=I.json.nodes[V],A=(t.extensions&&t.extensions[this.name]||{}).light;return A===void 0?null:this._loadLight(A).then(function(s){return I._getNodeRef(g.cache,A,s)})}}class uy{constructor(){this.name=_V.KHR_MATERIALS_UNLIT}getMaterialType(){return EI}extendParams(V,g,I){const e=[];V.color=new NV(1,1,1),V.opacity=1;const t=g.pbrMetallicRoughness;if(t){if(Array.isArray(t.baseColorFactor)){const C=t.baseColorFactor;V.color.fromArray(C),V.opacity=C[3]}t.baseColorTexture!==void 0&&e.push(I.assignTexture(V,"map",t.baseColorTexture))}return Promise.all(e)}}class by{constructor(V){this.parser=V,this.name=_V.KHR_MATERIALS_CLEARCOAT}getMaterialType(V){const I=this.parser.json.materials[V];return!I.extensions||!I.extensions[this.name]?null:Wl}extendMaterialParams(V,g){const I=this.parser,e=I.json.materials[V];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const t=[],C=e.extensions[this.name];if(C.clearcoatFactor!==void 0&&(g.clearcoat=C.clearcoatFactor),C.clearcoatTexture!==void 0&&t.push(I.assignTexture(g,"clearcoatMap",C.clearcoatTexture)),C.clearcoatRoughnessFactor!==void 0&&(g.clearcoatRoughness=C.clearcoatRoughnessFactor),C.clearcoatRoughnessTexture!==void 0&&t.push(I.assignTexture(g,"clearcoatRoughnessMap",C.clearcoatRoughnessTexture)),C.clearcoatNormalTexture!==void 0&&(t.push(I.assignTexture(g,"clearcoatNormalMap",C.clearcoatNormalTexture)),C.clearcoatNormalTexture.scale!==void 0)){const A=C.clearcoatNormalTexture.scale;g.clearcoatNormalScale=new dV(A,-A)}return Promise.all(t)}}class Zy{constructor(V){this.parser=V,this.name=_V.KHR_MATERIALS_TRANSMISSION}getMaterialType(V){const I=this.parser.json.materials[V];return!I.extensions||!I.extensions[this.name]?null:Wl}extendMaterialParams(V,g){const I=this.parser,e=I.json.materials[V];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const t=[],C=e.extensions[this.name];return C.transmissionFactor!==void 0&&(g.transmission=C.transmissionFactor),C.transmissionTexture!==void 0&&t.push(I.assignTexture(g,"transmissionMap",C.transmissionTexture)),Promise.all(t)}}class Gy{constructor(V){this.parser=V,this.name=_V.KHR_TEXTURE_BASISU}loadTexture(V){const g=this.parser,I=g.json,e=I.textures[V];if(!e.extensions||!e.extensions[this.name])return null;const t=e.extensions[this.name],C=I.images[t.source],A=g.options.ktx2Loader;if(!A){if(I.extensionsRequired&&I.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return g.loadTextureImage(V,C,A)}}class py{constructor(V){this.parser=V,this.name=_V.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(V){const g=this.name,I=this.parser,e=I.json,t=e.textures[V];if(!t.extensions||!t.extensions[g])return null;const C=t.extensions[g],A=e.images[C.source];let s=I.textureLoader;if(A.uri){const a=I.options.manager.getHandler(A.uri);a!==null&&(s=a)}return this.detectSupport().then(function(a){if(a)return I.loadTextureImage(V,A,s);if(e.extensionsRequired&&e.extensionsRequired.indexOf(g)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return I.loadTexture(V)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(V){const g=new Image;g.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",g.onload=g.onerror=function(){V(g.height===1)}})),this.isSupported}}class qy{constructor(V){this.name=_V.EXT_MESHOPT_COMPRESSION,this.parser=V}loadBufferView(V){const g=this.parser.json,I=g.bufferViews[V];if(I.extensions&&I.extensions[this.name]){const e=I.extensions[this.name],t=this.parser.getDependency("buffer",e.buffer),C=this.parser.options.meshoptDecoder;if(!C||!C.supported){if(g.extensionsRequired&&g.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([t,C.ready]).then(function(A){const s=e.byteOffset||0,a=e.byteLength||0,o=e.count,n=e.byteStride,l=new ArrayBuffer(o*n),c=new Uint8Array(A[0],s,a);return C.decodeGltfBuffer(new Uint8Array(l),o,n,c,e.mode,e.filter),l})}else return null}}const xr="glTF",jC=12,Cc={JSON:1313821514,BIN:5130562};class By{constructor(V){this.name=_V.KHR_BINARY_GLTF,this.content=null,this.body=null;const g=new DataView(V,0,jC);if(this.header={magic:aC.decodeText(new Uint8Array(V.slice(0,4))),version:g.getUint32(4,!0),length:g.getUint32(8,!0)},this.header.magic!==xr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const I=this.header.length-jC,e=new DataView(V,jC);let t=0;for(;t<I;){const C=e.getUint32(t,!0);t+=4;const A=e.getUint32(t,!0);if(t+=4,A===Cc.JSON){const s=new Uint8Array(V,jC+t,C);this.content=aC.decodeText(s)}else if(A===Cc.BIN){const s=jC+t;this.body=V.slice(s,s+C)}t+=C}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Wy{constructor(V,g){if(!g)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=_V.KHR_DRACO_MESH_COMPRESSION,this.json=V,this.dracoLoader=g,this.dracoLoader.preload()}decodePrimitive(V,g){const I=this.json,e=this.dracoLoader,t=V.extensions[this.name].bufferView,C=V.extensions[this.name].attributes,A={},s={},a={};for(const o in C){const n=Es[o]||o.toLowerCase();A[n]=C[o]}for(const o in V.attributes){const n=Es[o]||o.toLowerCase();if(C[o]!==void 0){const l=I.accessors[V.attributes[o]],c=Hi[l.componentType];a[n]=c,s[n]=l.normalized===!0}}return g.getDependency("bufferView",t).then(function(o){return new Promise(function(n){e.decodeDracoFile(o,function(l){for(const c in l.attributes){const d=l.attributes[c],h=s[c];h!==void 0&&(d.normalized=h)}n(l)},A,a)})})}}class yy{constructor(){this.name=_V.KHR_TEXTURE_TRANSFORM}extendTexture(V,g){return g.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),g.offset===void 0&&g.rotation===void 0&&g.scale===void 0||(V=V.clone(),g.offset!==void 0&&V.offset.fromArray(g.offset),g.rotation!==void 0&&(V.rotation=g.rotation),g.scale!==void 0&&V.repeat.fromArray(g.scale),V.needsUpdate=!0),V}}class Ds extends Hg{constructor(V){super(),this.isGLTFSpecularGlossinessMaterial=!0;const g=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),I=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),e=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),t=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),C=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),A={specular:{value:new NV().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=A,this.onBeforeCompile=function(s){for(const a in A)s.uniforms[a]=A[a];s.fragmentShader=s.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",g).replace("#include <metalnessmap_pars_fragment>",I).replace("#include <roughnessmap_fragment>",e).replace("#include <metalnessmap_fragment>",t).replace("#include <lights_physical_fragment>",C)},Object.defineProperties(this,{specular:{get:function(){return A.specular.value},set:function(s){A.specular.value=s}},specularMap:{get:function(){return A.specularMap.value},set:function(s){A.specularMap.value=s,s?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return A.glossiness.value},set:function(s){A.glossiness.value=s}},glossinessMap:{get:function(){return A.glossinessMap.value},set:function(s){A.glossinessMap.value=s,s?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(V)}copy(V){return super.copy(V),this.specularMap=V.specularMap,this.specular.copy(V.specular),this.glossinessMap=V.glossinessMap,this.glossiness=V.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Xy{constructor(){this.name=_V.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Ds}extendParams(V,g,I){const e=g.extensions[this.name];V.color=new NV(1,1,1),V.opacity=1;const t=[];if(Array.isArray(e.diffuseFactor)){const C=e.diffuseFactor;V.color.fromArray(C),V.opacity=C[3]}if(e.diffuseTexture!==void 0&&t.push(I.assignTexture(V,"map",e.diffuseTexture)),V.emissive=new NV(0,0,0),V.glossiness=e.glossinessFactor!==void 0?e.glossinessFactor:1,V.specular=new NV(1,1,1),Array.isArray(e.specularFactor)&&V.specular.fromArray(e.specularFactor),e.specularGlossinessTexture!==void 0){const C=e.specularGlossinessTexture;t.push(I.assignTexture(V,"glossinessMap",C)),t.push(I.assignTexture(V,"specularMap",C))}return Promise.all(t)}createMaterial(V){const g=new Ds(V);return g.fog=!0,g.color=V.color,g.map=V.map===void 0?null:V.map,g.lightMap=null,g.lightMapIntensity=1,g.aoMap=V.aoMap===void 0?null:V.aoMap,g.aoMapIntensity=1,g.emissive=V.emissive,g.emissiveIntensity=1,g.emissiveMap=V.emissiveMap===void 0?null:V.emissiveMap,g.bumpMap=V.bumpMap===void 0?null:V.bumpMap,g.bumpScale=1,g.normalMap=V.normalMap===void 0?null:V.normalMap,g.normalMapType=Yt,V.normalScale&&(g.normalScale=V.normalScale),g.displacementMap=null,g.displacementScale=1,g.displacementBias=0,g.specularMap=V.specularMap===void 0?null:V.specularMap,g.specular=V.specular,g.glossinessMap=V.glossinessMap===void 0?null:V.glossinessMap,g.glossiness=V.glossiness,g.alphaMap=null,g.envMap=V.envMap===void 0?null:V.envMap,g.envMapIntensity=1,g.refractionRatio=.98,g}}class Ry{constructor(){this.name=_V.KHR_MESH_QUANTIZATION}}class WC extends Re{constructor(V,g,I,e){super(V,g,I,e)}copySampleValue_(V){const g=this.resultBuffer,I=this.sampleValues,e=this.valueSize,t=V*e*3+e;for(let C=0;C!==e;C++)g[C]=I[t+C];return g}}WC.prototype.beforeStart_=WC.prototype.copySampleValue_;WC.prototype.afterEnd_=WC.prototype.copySampleValue_;WC.prototype.interpolate_=function(i,V,g,I){const e=this.resultBuffer,t=this.sampleValues,C=this.valueSize,A=C*2,s=C*3,a=I-V,o=(g-V)/a,n=o*o,l=n*o,c=i*s,d=c-s,h=-2*l+3*n,m=l-n,r=1-h,u=m-n+o;for(let b=0;b!==C;b++){const Z=t[d+b+C],p=t[d+b+A]*a,G=t[c+b+C],X=t[c+b]*a;e[b]=r*Z+u*p+h*G+m*X}return e};const me={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Hi={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ic={9728:Lg,9729:Sg,9984:Bs,9985:zc,9986:Ws,9987:XC},Ac={33071:lI,33648:fA,10497:Vt},nc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Es={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},xe={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Yy={CUBICSPLINE:void 0,LINEAR:hC,STEP:hi},Is={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function sc(i,V){return typeof i!="string"||i===""?"":(/^https?:\/\//i.test(V)&&/^\//.test(i)&&(V=V.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(i)||/^data:.*,.*$/i.test(i)||/^blob:.*$/i.test(i)?i:V+i)}function wy(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new Hg({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:rC})),i.DefaultMaterial}function PC(i,V,g){for(const I in g.extensions)i[I]===void 0&&(V.userData.gltfExtensions=V.userData.gltfExtensions||{},V.userData.gltfExtensions[I]=g.extensions[I])}function Zt(i,V){V.extras!==void 0&&(typeof V.extras=="object"?Object.assign(i.userData,V.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+V.extras))}function Hy(i,V,g){let I=!1,e=!1;for(let A=0,s=V.length;A<s;A++){const a=V[A];if(a.POSITION!==void 0&&(I=!0),a.NORMAL!==void 0&&(e=!0),I&&e)break}if(!I&&!e)return Promise.resolve(i);const t=[],C=[];for(let A=0,s=V.length;A<s;A++){const a=V[A];if(I){const o=a.POSITION!==void 0?g.getDependency("accessor",a.POSITION):i.attributes.position;t.push(o)}if(e){const o=a.NORMAL!==void 0?g.getDependency("accessor",a.NORMAL):i.attributes.normal;C.push(o)}}return Promise.all([Promise.all(t),Promise.all(C)]).then(function(A){const s=A[0],a=A[1];return I&&(i.morphAttributes.position=s),e&&(i.morphAttributes.normal=a),i.morphTargetsRelative=!0,i})}function fy(i,V){if(i.updateMorphTargets(),V.weights!==void 0)for(let g=0,I=V.weights.length;g<I;g++)i.morphTargetInfluences[g]=V.weights[g];if(V.extras&&Array.isArray(V.extras.targetNames)){const g=V.extras.targetNames;if(i.morphTargetInfluences.length===g.length){i.morphTargetDictionary={};for(let I=0,e=g.length;I<e;I++)i.morphTargetDictionary[g[I]]=I}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Sy(i){const V=i.extensions&&i.extensions[_V.KHR_DRACO_MESH_COMPRESSION];let g;return V?g="draco:"+V.bufferView+":"+V.indices+":"+lc(V.attributes):g=i.indices+":"+lc(i.attributes)+":"+i.mode,g}function lc(i){let V="";const g=Object.keys(i).sort();for(let I=0,e=g.length;I<e;I++)V+=g[I]+":"+i[g[I]]+";";return V}function Qs(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Fy{constructor(V={},g={}){this.json=V,this.extensions={},this.plugins={},this.options=g,this.cache=new hy,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new Kd(this.options.manager):this.textureLoader=new Le(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new yl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(V){this.extensions=V}setPlugins(V){this.plugins=V}parse(V,g){const I=this,e=this.json,t=this.extensions;this.cache.removeAll(),this._invokeAll(function(C){return C._markDefs&&C._markDefs()}),Promise.all(this._invokeAll(function(C){return C.beforeRoot&&C.beforeRoot()})).then(function(){return Promise.all([I.getDependencies("scene"),I.getDependencies("animation"),I.getDependencies("camera")])}).then(function(C){const A={scene:C[0][e.scene||0],scenes:C[0],animations:C[1],cameras:C[2],asset:e.asset,parser:I,userData:{}};PC(t,A,e),Zt(A,e),Promise.all(I._invokeAll(function(s){return s.afterRoot&&s.afterRoot(A)})).then(function(){V(A)})}).catch(g)}_markDefs(){const V=this.json.nodes||[],g=this.json.skins||[],I=this.json.meshes||[];for(let e=0,t=g.length;e<t;e++){const C=g[e].joints;for(let A=0,s=C.length;A<s;A++)V[C[A]].isBone=!0}for(let e=0,t=V.length;e<t;e++){const C=V[e];C.mesh!==void 0&&(this._addNodeRef(this.meshCache,C.mesh),C.skin!==void 0&&(I[C.mesh].isSkinnedMesh=!0)),C.camera!==void 0&&this._addNodeRef(this.cameraCache,C.camera)}}_addNodeRef(V,g){g!==void 0&&(V.refs[g]===void 0&&(V.refs[g]=V.uses[g]=0),V.refs[g]++)}_getNodeRef(V,g,I){if(V.refs[g]<=1)return I;const e=I.clone();return e.name+="_instance_"+V.uses[g]++,e}_invokeOne(V){const g=Object.values(this.plugins);g.push(this);for(let I=0;I<g.length;I++){const e=V(g[I]);if(e)return e}return null}_invokeAll(V){const g=Object.values(this.plugins);g.unshift(this);const I=[];for(let e=0;e<g.length;e++){const t=V(g[e]);t&&I.push(t)}return I}getDependency(V,g){const I=V+":"+g;let e=this.cache.get(I);if(!e){switch(V){case"scene":e=this.loadScene(g);break;case"node":e=this.loadNode(g);break;case"mesh":e=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(g)});break;case"accessor":e=this.loadAccessor(g);break;case"bufferView":e=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(g)});break;case"buffer":e=this.loadBuffer(g);break;case"material":e=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(g)});break;case"texture":e=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(g)});break;case"skin":e=this.loadSkin(g);break;case"animation":e=this.loadAnimation(g);break;case"camera":e=this.loadCamera(g);break;default:throw new Error("Unknown type: "+V)}this.cache.add(I,e)}return e}getDependencies(V){let g=this.cache.get(V);if(!g){const I=this,e=this.json[V+(V==="mesh"?"es":"s")]||[];g=Promise.all(e.map(function(t,C){return I.getDependency(V,C)})),this.cache.add(V,g)}return g}loadBuffer(V){const g=this.json.buffers[V],I=this.fileLoader;if(g.type&&g.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+g.type+" buffer type is not supported.");if(g.uri===void 0&&V===0)return Promise.resolve(this.extensions[_V.KHR_BINARY_GLTF].body);const e=this.options;return new Promise(function(t,C){I.load(sc(g.uri,e.path),t,void 0,function(){C(new Error('THREE.GLTFLoader: Failed to load buffer "'+g.uri+'".'))})})}loadBufferView(V){const g=this.json.bufferViews[V];return this.getDependency("buffer",g.buffer).then(function(I){const e=g.byteLength||0,t=g.byteOffset||0;return I.slice(t,t+e)})}loadAccessor(V){const g=this,I=this.json,e=this.json.accessors[V];if(e.bufferView===void 0&&e.sparse===void 0)return Promise.resolve(null);const t=[];return e.bufferView!==void 0?t.push(this.getDependency("bufferView",e.bufferView)):t.push(null),e.sparse!==void 0&&(t.push(this.getDependency("bufferView",e.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",e.sparse.values.bufferView))),Promise.all(t).then(function(C){const A=C[0],s=nc[e.type],a=Hi[e.componentType],o=a.BYTES_PER_ELEMENT,n=o*s,l=e.byteOffset||0,c=e.bufferView!==void 0?I.bufferViews[e.bufferView].byteStride:void 0,d=e.normalized===!0;let h,m;if(c&&c!==n){const r=Math.floor(l/c),u="InterleavedBuffer:"+e.bufferView+":"+e.componentType+":"+r+":"+e.count;let b=g.cache.get(u);b||(h=new a(A,r*c,e.count*c/o),b=new HC(h,c/o),g.cache.add(u,b)),m=new uC(b,s,l%c/o,d)}else A===null?h=new a(e.count*s):h=new a(A,l,e.count*s),m=new qg(h,s,d);if(e.sparse!==void 0){const r=nc.SCALAR,u=Hi[e.sparse.indices.componentType],b=e.sparse.indices.byteOffset||0,Z=e.sparse.values.byteOffset||0,p=new u(C[1],b,e.sparse.count*r),G=new a(C[2],Z,e.sparse.count*s);A!==null&&(m=new qg(m.array.slice(),m.itemSize,m.normalized));for(let X=0,W=p.length;X<W;X++){const y=p[X];if(m.setX(y,G[X*s]),s>=2&&m.setY(y,G[X*s+1]),s>=3&&m.setZ(y,G[X*s+2]),s>=4&&m.setW(y,G[X*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(V){const g=this.json,I=this.options,e=g.textures[V],t=g.images[e.source];let C=this.textureLoader;if(t.uri){const A=I.manager.getHandler(t.uri);A!==null&&(C=A)}return this.loadTextureImage(V,t,C)}loadTextureImage(V,g,I){const e=this,t=this.json,C=this.options,A=t.textures[V],s=(g.uri||g.bufferView)+":"+A.sampler;if(this.textureCache[s])return this.textureCache[s];const a=self.URL||self.webkitURL;let o=g.uri||"",n=!1,l=!0;const c=o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0;if((g.mimeType==="image/jpeg"||c)&&(l=!1),g.bufferView!==void 0)o=e.getDependency("bufferView",g.bufferView).then(function(h){if(g.mimeType==="image/png"){const r=new DataView(h,25,1).getUint8(0,!1);l=r===6||r===4||r===3}n=!0;const m=new Blob([h],{type:g.mimeType});return o=a.createObjectURL(m),o});else if(g.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+V+" is missing URI and bufferView");const d=Promise.resolve(o).then(function(h){return new Promise(function(m,r){let u=m;I.isImageBitmapLoader===!0&&(u=function(b){m(new Zd(b))}),I.load(sc(h,C.path),u,void 0,r)})}).then(function(h){n===!0&&a.revokeObjectURL(o),h.flipY=!1,A.name&&(h.name=A.name),l||(h.format=je);const r=(t.samplers||{})[A.sampler]||{};return h.magFilter=ic[r.magFilter]||Sg,h.minFilter=ic[r.minFilter]||XC,h.wrapS=Ac[r.wrapS]||Vt,h.wrapT=Ac[r.wrapT]||Vt,e.associations.set(h,{type:"textures",index:V}),h});return this.textureCache[s]=d,d}assignTexture(V,g,I){const e=this;return this.getDependency("texture",I.index).then(function(t){if(I.texCoord!==void 0&&I.texCoord!=0&&!(g==="aoMap"&&I.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+I.texCoord+" for texture "+g+" not yet supported."),e.extensions[_V.KHR_TEXTURE_TRANSFORM]){const C=I.extensions!==void 0?I.extensions[_V.KHR_TEXTURE_TRANSFORM]:void 0;if(C){const A=e.associations.get(t);t=e.extensions[_V.KHR_TEXTURE_TRANSFORM].extendTexture(t,C),e.associations.set(t,A)}}V[g]=t})}assignFinalMaterial(V){const g=V.geometry;let I=V.material;const e=g.attributes.tangent!==void 0,t=g.attributes.color!==void 0,C=g.attributes.normal===void 0,A=Object.keys(g.morphAttributes).length>0,s=A&&g.morphAttributes.normal!==void 0;if(V.isPoints){const a="PointsMaterial:"+I.uuid;let o=this.cache.get(a);o||(o=new ml,xg.prototype.copy.call(o,I),o.color.copy(I.color),o.map=I.map,o.sizeAttenuation=!1,this.cache.add(a,o)),I=o}else if(V.isLine){const a="LineBasicMaterial:"+I.uuid;let o=this.cache.get(a);o||(o=new fC,xg.prototype.copy.call(o,I),o.color.copy(I.color),this.cache.add(a,o)),I=o}if(e||t||C||A){let a="ClonedMaterial:"+I.uuid+":";I.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),e&&(a+="vertex-tangents:"),t&&(a+="vertex-colors:"),C&&(a+="flat-shading:"),A&&(a+="morph-targets:"),s&&(a+="morph-normals:");let o=this.cache.get(a);o||(o=I.clone(),t&&(o.vertexColors=!0),C&&(o.flatShading=!0),A&&(o.morphTargets=!0),s&&(o.morphNormals=!0),e&&(o.vertexTangents=!0,o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(a,o),this.associations.set(o,this.associations.get(I))),I=o}I.aoMap&&g.attributes.uv2===void 0&&g.attributes.uv!==void 0&&g.setAttribute("uv2",g.attributes.uv),V.material=I}getMaterialType(){return Hg}loadMaterial(V){const g=this,I=this.json,e=this.extensions,t=I.materials[V];let C;const A={},s=t.extensions||{},a=[];if(s[_V.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const n=e[_V.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];C=n.getMaterialType(),a.push(n.extendParams(A,t,g))}else if(s[_V.KHR_MATERIALS_UNLIT]){const n=e[_V.KHR_MATERIALS_UNLIT];C=n.getMaterialType(),a.push(n.extendParams(A,t,g))}else{const n=t.pbrMetallicRoughness||{};if(A.color=new NV(1,1,1),A.opacity=1,Array.isArray(n.baseColorFactor)){const l=n.baseColorFactor;A.color.fromArray(l),A.opacity=l[3]}n.baseColorTexture!==void 0&&a.push(g.assignTexture(A,"map",n.baseColorTexture)),A.metalness=n.metallicFactor!==void 0?n.metallicFactor:1,A.roughness=n.roughnessFactor!==void 0?n.roughnessFactor:1,n.metallicRoughnessTexture!==void 0&&(a.push(g.assignTexture(A,"metalnessMap",n.metallicRoughnessTexture)),a.push(g.assignTexture(A,"roughnessMap",n.metallicRoughnessTexture))),C=this._invokeOne(function(l){return l.getMaterialType&&l.getMaterialType(V)}),a.push(Promise.all(this._invokeAll(function(l){return l.extendMaterialParams&&l.extendMaterialParams(V,A)})))}t.doubleSided===!0&&(A.side=yt);const o=t.alphaMode||Is.OPAQUE;return o===Is.BLEND?(A.transparent=!0,A.depthWrite=!1):(A.transparent=!1,o===Is.MASK&&(A.alphaTest=t.alphaCutoff!==void 0?t.alphaCutoff:.5)),t.normalTexture!==void 0&&C!==EI&&(a.push(g.assignTexture(A,"normalMap",t.normalTexture)),A.normalScale=new dV(1,-1),t.normalTexture.scale!==void 0&&A.normalScale.set(t.normalTexture.scale,-t.normalTexture.scale)),t.occlusionTexture!==void 0&&C!==EI&&(a.push(g.assignTexture(A,"aoMap",t.occlusionTexture)),t.occlusionTexture.strength!==void 0&&(A.aoMapIntensity=t.occlusionTexture.strength)),t.emissiveFactor!==void 0&&C!==EI&&(A.emissive=new NV().fromArray(t.emissiveFactor)),t.emissiveTexture!==void 0&&C!==EI&&a.push(g.assignTexture(A,"emissiveMap",t.emissiveTexture)),Promise.all(a).then(function(){let n;return C===Ds?n=e[_V.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(A):n=new C(A),t.name&&(n.name=t.name),n.map&&(n.map.encoding=NA),n.emissiveMap&&(n.emissiveMap.encoding=NA),Zt(n,t),g.associations.set(n,{type:"materials",index:V}),t.extensions&&PC(e,n,t),n})}createUniqueName(V){const g=Ig.sanitizeNodeName(V||"");let I=g;for(let e=1;this.nodeNamesUsed[I];++e)I=g+"_"+e;return this.nodeNamesUsed[I]=!0,I}loadGeometries(V){const g=this,I=this.extensions,e=this.primitiveCache;function t(A){return I[_V.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(A,g).then(function(s){return ac(s,A,g)})}const C=[];for(let A=0,s=V.length;A<s;A++){const a=V[A],o=Sy(a),n=e[o];if(n)C.push(n.promise);else{let l;a.extensions&&a.extensions[_V.KHR_DRACO_MESH_COMPRESSION]?l=t(a):l=ac(new $V,a,g),e[o]={primitive:a,promise:l},C.push(l)}}return Promise.all(C)}loadMesh(V){const g=this,I=this.json,e=this.extensions,t=I.meshes[V],C=t.primitives,A=[];for(let s=0,a=C.length;s<a;s++){const o=C[s].material===void 0?wy(this.cache):this.getDependency("material",C[s].material);A.push(o)}return A.push(g.loadGeometries(C)),Promise.all(A).then(function(s){const a=s.slice(0,s.length-1),o=s[s.length-1],n=[];for(let c=0,d=o.length;c<d;c++){const h=o[c],m=C[c];let r;const u=a[c];if(m.mode===me.TRIANGLES||m.mode===me.TRIANGLE_STRIP||m.mode===me.TRIANGLE_FAN||m.mode===void 0)r=t.isSkinnedMesh===!0?new dl(h,u):new og(h,u),r.isSkinnedMesh===!0&&!r.geometry.attributes.skinWeight.normalized&&r.normalizeSkinWeights(),m.mode===me.TRIANGLE_STRIP?r.geometry=oc(r.geometry,Rb):m.mode===me.TRIANGLE_FAN&&(r.geometry=oc(r.geometry,Lc));else if(m.mode===me.LINES)r=new PA(h,u);else if(m.mode===me.LINE_STRIP)r=new jA(h,u);else if(m.mode===me.LINE_LOOP)r=new ud(h,u);else if(m.mode===me.POINTS)r=new bd(h,u);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(r.geometry.morphAttributes).length>0&&fy(r,t),r.name=g.createUniqueName(t.name||"mesh_"+V),Zt(r,t),m.extensions&&PC(e,r,m),g.assignFinalMaterial(r),n.push(r)}if(n.length===1)return n[0];const l=new $I;for(let c=0,d=n.length;c<d;c++)l.add(n[c]);return l})}loadCamera(V){let g;const I=this.json.cameras[V],e=I[I.type];if(!e){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return I.type==="perspective"?g=new jg(Ec.radToDeg(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):I.type==="orthographic"&&(g=new In(-e.xmag,e.xmag,e.ymag,-e.ymag,e.znear,e.zfar)),I.name&&(g.name=this.createUniqueName(I.name)),Zt(g,I),Promise.resolve(g)}loadSkin(V){const g=this.json.skins[V],I={joints:g.joints};return g.inverseBindMatrices===void 0?Promise.resolve(I):this.getDependency("accessor",g.inverseBindMatrices).then(function(e){return I.inverseBindMatrices=e,I})}loadAnimation(V){const I=this.json.animations[V],e=[],t=[],C=[],A=[],s=[];for(let a=0,o=I.channels.length;a<o;a++){const n=I.channels[a],l=I.samplers[n.sampler],c=n.target,d=c.node!==void 0?c.node:c.id,h=I.parameters!==void 0?I.parameters[l.input]:l.input,m=I.parameters!==void 0?I.parameters[l.output]:l.output;e.push(this.getDependency("node",d)),t.push(this.getDependency("accessor",h)),C.push(this.getDependency("accessor",m)),A.push(l),s.push(c)}return Promise.all([Promise.all(e),Promise.all(t),Promise.all(C),Promise.all(A),Promise.all(s)]).then(function(a){const o=a[0],n=a[1],l=a[2],c=a[3],d=a[4],h=[];for(let r=0,u=o.length;r<u;r++){const b=o[r],Z=n[r],p=l[r],G=c[r],X=d[r];if(b===void 0)continue;b.updateMatrix(),b.matrixAutoUpdate=!0;let W;switch(xe[X.path]){case xe.weights:W=pi;break;case xe.rotation:W=FC;break;case xe.position:case xe.scale:default:W=qi;break}const y=b.name?b.name:b.uuid,Y=G.interpolation!==void 0?Yy[G.interpolation]:hC,f=[];xe[X.path]===xe.weights?b.traverse(function(R){R.isMesh===!0&&R.morphTargetInfluences&&f.push(R.name?R.name:R.uuid)}):f.push(y);let L=p.array;if(p.normalized){const R=Qs(L.constructor),J=new Float32Array(L.length);for(let H=0,N=L.length;H<N;H++)J[H]=L[H]*R;L=J}for(let R=0,J=f.length;R<J;R++){const H=new W(f[R]+"."+xe[X.path],Z.array,L,Y);G.interpolation==="CUBICSPLINE"&&(H.createInterpolant=function(v){return new WC(this.times,this.values,this.getValueSize()/3,v)},H.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),h.push(H)}}const m=I.name?I.name:"animation_"+V;return new fs(m,void 0,h)})}createNodeMesh(V){const g=this.json,I=this,e=g.nodes[V];return e.mesh===void 0?null:I.getDependency("mesh",e.mesh).then(function(t){const C=I._getNodeRef(I.meshCache,e.mesh,t);return e.weights!==void 0&&C.traverse(function(A){if(!!A.isMesh)for(let s=0,a=e.weights.length;s<a;s++)A.morphTargetInfluences[s]=e.weights[s]}),C})}loadNode(V){const g=this.json,I=this.extensions,e=this,t=g.nodes[V],C=t.name?e.createUniqueName(t.name):"";return function(){const A=[],s=e._invokeOne(function(a){return a.createNodeMesh&&a.createNodeMesh(V)});return s&&A.push(s),t.camera!==void 0&&A.push(e.getDependency("camera",t.camera).then(function(a){return e._getNodeRef(e.cameraCache,t.camera,a)})),e._invokeAll(function(a){return a.createNodeAttachment&&a.createNodeAttachment(V)}).forEach(function(a){A.push(a)}),Promise.all(A)}().then(function(A){let s;if(t.isBone===!0?s=new rl:A.length>1?s=new $I:A.length===1?s=A[0]:s=new UV,s!==A[0])for(let a=0,o=A.length;a<o;a++)s.add(A[a]);if(t.name&&(s.userData.name=t.name,s.name=C),Zt(s,t),t.extensions&&PC(I,s,t),t.matrix!==void 0){const a=new JV;a.fromArray(t.matrix),s.applyMatrix4(a)}else t.translation!==void 0&&s.position.fromArray(t.translation),t.rotation!==void 0&&s.quaternion.fromArray(t.rotation),t.scale!==void 0&&s.scale.fromArray(t.scale);return e.associations.set(s,{type:"nodes",index:V}),s})}loadScene(V){const g=this.json,I=this.extensions,e=this.json.scenes[V],t=this,C=new $I;e.name&&(C.name=t.createUniqueName(e.name)),Zt(C,e),e.extensions&&PC(I,C,e);const A=e.nodes||[],s=[];for(let a=0,o=A.length;a<o;a++)s.push(kr(A[a],C,g,t));return Promise.all(s).then(function(){return C})}}function kr(i,V,g,I){const e=g.nodes[i];return I.getDependency("node",i).then(function(t){if(e.skin===void 0)return t;let C;return I.getDependency("skin",e.skin).then(function(A){C=A;const s=[];for(let a=0,o=C.joints.length;a<o;a++)s.push(I.getDependency("node",C.joints[a]));return Promise.all(s)}).then(function(A){return t.traverse(function(s){if(!s.isMesh)return;const a=[],o=[];for(let n=0,l=A.length;n<l;n++){const c=A[n];if(c){a.push(c);const d=new JV;C.inverseBindMatrices!==void 0&&d.fromArray(C.inverseBindMatrices.array,n*16),o.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',C.joints[n])}s.bind(new hl(a,o),s.matrixWorld)}),t})}).then(function(t){V.add(t);const C=[];if(e.children){const A=e.children;for(let s=0,a=A.length;s<a;s++){const o=A[s];C.push(kr(o,t,g,I))}}return Promise.all(C)})}function vy(i,V,g){const I=V.attributes,e=new pg;if(I.POSITION!==void 0){const A=g.json.accessors[I.POSITION],s=A.min,a=A.max;if(s!==void 0&&a!==void 0){if(e.set(new S(s[0],s[1],s[2]),new S(a[0],a[1],a[2])),A.normalized){const o=Qs(Hi[A.componentType]);e.min.multiplyScalar(o),e.max.multiplyScalar(o)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const t=V.targets;if(t!==void 0){const A=new S,s=new S;for(let a=0,o=t.length;a<o;a++){const n=t[a];if(n.POSITION!==void 0){const l=g.json.accessors[n.POSITION],c=l.min,d=l.max;if(c!==void 0&&d!==void 0){if(s.setX(Math.max(Math.abs(c[0]),Math.abs(d[0]))),s.setY(Math.max(Math.abs(c[1]),Math.abs(d[1]))),s.setZ(Math.max(Math.abs(c[2]),Math.abs(d[2]))),l.normalized){const h=Qs(Hi[l.componentType]);s.multiplyScalar(h)}A.max(s)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}e.expandByVector(A)}i.boundingBox=e;const C=new XI;e.getCenter(C.center),C.radius=e.min.distanceTo(e.max)/2,i.boundingSphere=C}function ac(i,V,g){const I=V.attributes,e=[];function t(C,A){return g.getDependency("accessor",C).then(function(s){i.setAttribute(A,s)})}for(const C in I){const A=Es[C]||C.toLowerCase();A in i.attributes||e.push(t(I[C],A))}if(V.indices!==void 0&&!i.index){const C=g.getDependency("accessor",V.indices).then(function(A){i.setIndex(A)});e.push(C)}return Zt(i,V),vy(i,V,g),Promise.all(e).then(function(){return V.targets!==void 0?Hy(i,V.targets,g):i})}function oc(i,V){let g=i.getIndex();if(g===null){const C=[],A=i.getAttribute("position");if(A!==void 0){for(let s=0;s<A.count;s++)C.push(s);i.setIndex(C),g=i.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const I=g.count-2,e=[];if(V===Lc)for(let C=1;C<=I;C++)e.push(g.getX(0)),e.push(g.getX(C)),e.push(g.getX(C+1));else for(let C=0;C<I;C++)C%2===0?(e.push(g.getX(C)),e.push(g.getX(C+1)),e.push(g.getX(C+2))):(e.push(g.getX(C+2)),e.push(g.getX(C+1)),e.push(g.getX(C)));e.length/3!==I&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const t=i.clone();return t.setIndex(e),t}var Ny=function(){var i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",V="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",g=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),I=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};var e=i;WebAssembly.validate(g)&&(e=V,console.log("Warning: meshopt_decoder is using experimental SIMD support"));var t,C=WebAssembly.instantiate(A(e),{}).then(function(n){t=n.instance,t.exports.__wasm_call_ctors()});function A(n){for(var l=new Uint8Array(n.length),c=0;c<n.length;++c){var d=n.charCodeAt(c);l[c]=d>96?d-71:d>64?d-65:d>47?d+4:d>46?63:62}for(var h=0,c=0;c<n.length;++c)l[h++]=l[c]<60?I[l[c]]:(l[c]-60)*64+l[++c];return l.buffer.slice(0,h)}function s(n,l,c,d,h,m){var r=t.exports.sbrk,u=c+3&-4,b=r(u*d),Z=r(h.length),p=new Uint8Array(t.exports.memory.buffer);p.set(h,Z);var G=n(b,c,d,Z,h.length);if(G==0&&m&&m(b,u,d),l.set(p.subarray(b,b+c*d)),r(b-r(0)),G!=0)throw new Error("Malformed buffer data: "+G)}var a={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:C,supported:!0,decodeVertexBuffer:function(n,l,c,d,h){s(t.exports.meshopt_decodeVertexBuffer,n,l,c,d,t.exports[a[h]])},decodeIndexBuffer:function(n,l,c,d){s(t.exports.meshopt_decodeIndexBuffer,n,l,c,d)},decodeIndexSequence:function(n,l,c,d){s(t.exports.meshopt_decodeIndexSequence,n,l,c,d)},decodeGltfBuffer:function(n,l,c,d,h,m){s(t.exports[o[h]],n,l,c,d,t.exports[a[m]])}}}();class Ky{constructor(){autobind(this),this.map=[{parser:this.getJSON,extensions:/.(json)/g},{parser:this.getSVG,extensions:/.(svg)/g},{parser:this.getTexture,extensions:/.(jpg|png)/g},{parser:this.getAudioBuffer,extensions:/.(m4a|mp3)/g},{parser:this.getModels,extensions:/.(glb)/g}],this.DOMParser=document.createElement("div"),this.GLTFloader=new ry,this.GLTFloader.setMeshoptDecoder(Ny)}unpack(V,g){return SV(this,null,function*(){const e=new DataView(g,0,4).getUint32(0,!0),t=4+e,C=g.slice(4,t),s=(yield this.getJSON(C)).map(a=>SV(this,null,function*(){const{position:o,size:n,fileID:l}=a,{parser:c}=this.map.find(h=>l.match(h.extensions));if(!c)return;const d=g.slice(t+o,t+o+n);return a.data=yield c(d,l),a}));return Promise.all(s)})}getURI(V){const g=new Blob([V]);return URL.createObjectURL(g)}getJSON(V){return SV(this,null,function*(){const g=yield this.getString(V);return JSON.parse(g)})}getString(V){return SV(this,null,function*(){if(typeof V!="string"){const g=new Uint8Array(V);return new TextDecoder().decode(g)}else return string})}getAudioBuffer(V){return SV(this,null,function*(){const{context:g}=XV.audio.audioListener;return yield g.decodeAudioData(V)})}getImage(V){return SV(this,null,function*(){const g=new Image,I=this.getURI(V);if(g.decode)g.src=I,yield g.decode();else{const e=new Promise(t=>g.onload=t);g.src=I,yield e}return g})}getSVG(V){return SV(this,null,function*(){const g=I=>(this.DOMParser.innerHTML=I,this.DOMParser.querySelector("svg"));if(typeof V!="string"){const I=yield this.getString(V);return g(I)}else g(V)})}getTexture(V){return SV(this,null,function*(){const g=yield this.getImage(V),I=new Mg(g);return Object.assign(I,{minFilter:ys,magFilter:Sg,generateMipmaps:!0,needsUpdate:!0,flipY:!1}),I})}getModels(V,g=""){return SV(this,null,function*(){const I={objects:{},geometries:{},animations:{}},{scene:e,animations:t}=yield new Promise(C=>this.GLTFloader.parse(V,"",C));e.traverse(C=>I.objects[`${g}/${C.name}`]=C);for(const C of t)I.animations[`${g}/${C.name}`]=C;for(const C in I.objects){const{geometry:A}=I.objects[C];A&&(I.geometries[C]=A)}return I})}}class Jy{constructor(){autobind(this),this.parser=new Ky,this.percentLoaded=0,this.audioBuffers={},this.svgs={},this.jsons={},this.objects={},this.animations={},this.geometries={},this.materials={},this.textures={},this.packs={},this.promises=[]}initialize(){return SV(this,null,function*(){yield Promise.all([this.load("Scene")]);const V="Scene/EnvMap/";this.textures.EnvMap=new Ni,this.textures.EnvMap.needsUpdate=!0,this.textures.EnvMap.images=["px","nx","py","ny","pz","nz"].map(g=>this.textures[`${V}${g}.jpg`].image),this.materials.Locked=new Hg({envMap:this.textures.EnvMap,color:"#0d1a1a",transparent:!0,metalness:.5,roughness:.95}),this.materials.Crown=new Hg({envMap:this.textures.EnvMap,color:"#f2c40f",emissive:"#111111",metalness:0,roughness:.95}),this.materials.Check=new Hg({envMap:this.textures.EnvMap,color:"#2ecc71",metalness:.15,roughness:.75}),this.materials.Character=new Hg({envMap:this.textures.EnvMap,map:this.textures["Scene/Colors.png"],metalness:.05,roughness:.75}),this.materials.EagleEye=new Hg({envMap:this.textures.EnvMap,map:this.textures["Scene/EagleEye.png"],emissive:"#222222",metalness:0,roughness:.95}),this.materials.Shield=new Hg({envMap:this.textures.EnvMap,map:this.textures["Scene/Shield.png"],emissive:"#222222",metalness:0,roughness:.95}),this.materials.SpeedUp=new Hg({envMap:this.textures.EnvMap,map:this.textures["Scene/SpeedUp.png"],emissive:"#222222",metalness:0,roughness:.95}),this.materials.Territory=new Mr({envMap:this.textures.EnvMap,transparent:!0,metalness:.05,roughness:.75}),this.materials.Stencil=new EI({colorWrite:!1,depthWrite:!1,stencilWrite:!0,stencilZPass:Jb}),this.materials.Trail=new Ol({envMap:this.textures.EnvMap,emissive:"#111111",metalness:.05,roughness:.75,transparent:!0,opacity:.9,lineWidth:4,stencilWrite:!0,stencilFunc:Ma,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1}),this.materials.Mask=new _l({transparent:!0,opacity:0,lineWidth:4,color:"red",stencilWrite:!0,stencilFunc:Ma}),this.materials.Particles=new Hg({envMap:this.textures.EnvMap,metalness:.05,roughness:.75})})}load(V){return new Promise(g=>{const I=new XMLHttpRequest;this.packs[V]={},I.addEventListener("progress",e=>{const{loaded:t,total:C}=e;this.packs[V].loaded=t,this.packs[V].total=C||C,this.setPercentLoaded()}),I.addEventListener("load",e=>{const{loaded:t,total:C,currentTarget:A}=e;this.packs[V].loaded=t,this.packs[V].total=C||C,this.setPercentLoaded(),g(A.response)}),I.responseType="arraybuffer",I.open("GET",`packs/${V}.pack`),I.send()}).then(g=>this.parser.unpack(V,g)).then(g=>g.forEach(this.add))}setPercentLoaded(){let V=0,g=0;for(const I in this.packs){const e=this.packs[I];V+=e.total,g+=e.loaded||0}this.percentLoaded=g/V*100}add(V){const{fileID:g,data:I}=V;g.match(/glb/g)&&(Object.assign(this.objects,I.objects),Object.assign(this.geometries,I.geometries),Object.assign(this.animations,I.animations)),g.match(/(json)/g)&&(this.jsons[g]=I),g.match(/(svg)/g)&&(this.svgs[g]=I),g.match(/(jpg|png)/g)&&(this.textures[g]=I),g.match(/(m4a|mp3)/g)&&(this.audioBuffers[g]=I)}loadGlb(V){return this.promises[V]?this.promises[V]:(this.promises[V]=new Promise(g=>{const I=new XMLHttpRequest;I.addEventListener("load",e=>{const{currentTarget:t}=e;g(t.response)}),I.responseType="arraybuffer",I.open("GET",`${V}.glb`),I.send()}).then(g=>this.parser.getModels(g,"glb")).then(g=>{Object.assign(this.objects,g.objects),Object.assign(this.geometries,g.geometries),Object.assign(this.animations,g.animations)}),this.promises[V])}loadFont(V){const g=`fonts/${V}`,I=`${g}/Data`,e=`${g}/Texture`;return this.loadFile(I,"json").then(t=>this.parser.getJSON(t)).then(t=>{this.jsons[g]=t}).then(()=>this.loadFile(e,"png")).then(t=>this.parser.getImage(t)).then(t=>this.textures[g]=t)}loadFile(V,g){return this.promises[V]?this.promises[V]:(this.promises[V]=new Promise(I=>{const e=new XMLHttpRequest;e.addEventListener("load",t=>{const{currentTarget:C}=t;I(C.response)}),e.responseType="arraybuffer",e.open("GET",`${V}.${g}`),e.send()}),this.promises[V])}getPattern(V){const g=`Patterns/${V}.png`;if(this.textures[g])return this.textures[g];const I=new Le().load(g);return Object.assign(I,{minFilter:ys,magFilter:Sg,generateMipmaps:!0,needsUpdate:!0,flipY:!1}),I}trailExists(V){return["Bus","Default","Licorne","Police","Pq","Voiture"].indexOf(V)>-1}getTrail(V){const g=`Trails/${V}.png`;if(this.textures[g])return this.textures[g];const I=new Le().load(g);return Object.assign(I,{minFilter:ys,magFilter:Sg,generateMipmaps:!0,needsUpdate:!0,flipY:!1}),I}}class zr{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}}class Tr extends zr{constructor(V,g){super(),this.textureID=g!==void 0?g:"tDiffuse",V instanceof Xe?(this.uniforms=V.uniforms,this.defines=V.defines,this.material=V):V&&(this.uniforms=St.clone(V.uniforms),this.material=new Xe({uniforms:this.uniforms,vertexShader:V.vertexShader,fragmentShader:V.fragmentShader}),this.defines=V.defines,this.material.defines=this.defines),this.camera=new In(-1,1,1,-1,0,1),this.scene=new wC,this.quad=new og(new Ft(2,2),null),this.quad.frustumCulled=!1,this.quad.material=this.material,this.scene.add(this.quad)}render(V,g,I){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=I.texture),this.quad.material=this.material,this.renderToScreen?(V.setRenderTarget(null),V.render(this.scene,this.camera)):(V.setRenderTarget(g),this.clear&&V.clear(V.autoClearColor,V.autoClearDepth,V.autoClearStencil),V.render(this.scene,this.camera))}}var Lr=`varying vec2 vUv;\r
\r
void main() {\r
\r
	vUv = uv;\r
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1. );\r
\r
}\r
`,My=`uniform float opacity;\r
\r
uniform sampler2D tDiffuse;\r
\r
varying vec2 vUv;\r
\r
void main() {\r
\r
	vec4 texelColor = texture2D( tDiffuse, vUv );\r
	gl_FragColor = texelColor;\r
\r
}\r
`;class Ur extends Tr{constructor(){super({uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:Lr,fragmentShader:My})}}class xy{constructor(V,g){if(this.renderer=V,!g){const I={minFilter:Sg,magFilter:Sg,format:NI,stencilBuffer:!0},e=dV.get();V.getSize(e),g=new Ie(e.width,e.height,I),g.texture.name="EffectComposer.renderTargetA",dV.release(e)}this.renderTargetA=g,this.renderTargetB=g.clone(),this.renderTargetB.texture.name="EffectComposer.renderTargetB",this.writeBuffer=this.renderTargetA,this.readBuffer=this.renderTargetB,this.passes=[],this.renderToScreen=!0,this.copyPass=new Ur}swapBuffers(){const V=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=V}addPass(V){this.passes.push(V);const g=dV.get();this.renderer.getSize(g),V.setSize(g.width,g.height),dV.release(g)}insertPass(V,g){this.passes.splice(g,0,V)}getLastPass(){let V=this.passes.length,g;for(;V--&&g===void 0;)this.passes[V].enabled&&(g=this.passes[V]);return g}render(V){this.renderToScreen&&(this.getLastPass().renderToScreen=!0);const g=!1;for(let I=0,e=this.passes.length;I<e;I++){const t=this.passes[I];t.enabled!==!1&&(t.render(this.renderer,this.writeBuffer,this.readBuffer,V,g),t.needsSwap&&this.swapBuffers())}}reset(V){if(V===void 0){const g=this.renderer.getSize();V=this.renderTargetA.clone(),V.setSize(g.width,g.height)}this.renderTargetA.dispose(),this.renderTargetB.dispose(),this.renderTargetA=V,this.renderTargetB=V.clone(),this.writeBuffer=this.renderTargetA,this.readBuffer=this.renderTargetB}setSize(V,g){this.renderTargetA.setSize(V,g),this.renderTargetB.setSize(V,g);for(let I=0;I<this.passes.length;I++)this.passes[I].setSize(V,g)}}class ky extends zr{constructor(V,g,I=null,e,t){super(),this.scene=V,this.camera=g,this.overrideMaterial=I,this.clearColor=e,this.clearAlpha=t!==void 0?t:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1}render(V,g,I){const e=V.autoClear;V.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial;let t,C;this.clearColor&&(t=V.getClearColor().getHex(),C=V.getClearAlpha(),V.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&V.clearDepth(),V.setRenderTarget(this.renderToScreen?null:I),this.clear&&V.clear(V.autoClearColor,V.autoClearDepth,V.autoClearStencil),V.render(this.scene,this.camera),this.clearColor&&V.setClearColor(t,C),this.scene.overrideMaterial=null,V.autoClear=e}}var Dr={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},$l={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},zy=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],DA={CSS:{},springs:{}};function Ve(i,V,g){return Math.min(Math.max(i,V),g)}function ci(i,V){return i.indexOf(V)>-1}function es(i,V){return i.apply(null,V)}var TV={arr:function(i){return Array.isArray(i)},obj:function(i){return ci(Object.prototype.toString.call(i),"Object")},pth:function(i){return TV.obj(i)&&i.hasOwnProperty("totalLength")},svg:function(i){return i instanceof SVGElement},inp:function(i){return i instanceof HTMLInputElement},dom:function(i){return i.nodeType||TV.svg(i)},str:function(i){return typeof i=="string"},fnc:function(i){return typeof i=="function"},und:function(i){return typeof i=="undefined"},nil:function(i){return TV.und(i)||i===null},hex:function(i){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(i)},rgb:function(i){return/^rgb/.test(i)},hsl:function(i){return/^hsl/.test(i)},col:function(i){return TV.hex(i)||TV.rgb(i)||TV.hsl(i)},key:function(i){return!Dr.hasOwnProperty(i)&&!$l.hasOwnProperty(i)&&i!=="targets"&&i!=="keyframes"}};function Er(i){var V=/\(([^)]+)\)/.exec(i);return V?V[1].split(",").map(function(g){return parseFloat(g)}):[]}function Qr(i,V){var g=Er(i),I=Ve(TV.und(g[0])?1:g[0],.1,100),e=Ve(TV.und(g[1])?100:g[1],.1,100),t=Ve(TV.und(g[2])?10:g[2],.1,100),C=Ve(TV.und(g[3])?0:g[3],.1,100),A=Math.sqrt(e/I),s=t/(2*Math.sqrt(e*I)),a=s<1?A*Math.sqrt(1-s*s):0,o=1,n=s<1?(s*A+-C)/a:-C+A;function l(d){var h=V?V*d/1e3:d;return s<1?h=Math.exp(-h*s*A)*(o*Math.cos(a*h)+n*Math.sin(a*h)):h=(o+n*h)*Math.exp(-h*A),d===0||d===1?d:1-h}function c(){var d=DA.springs[i];if(d)return d;for(var h=1/6,m=0,r=0;;)if(m+=h,l(m)===1){if(r++,r>=16)break}else r=0;var u=m*h*1e3;return DA.springs[i]=u,u}return V?l:c}function Ty(i){return i===void 0&&(i=10),function(V){return Math.ceil(Ve(V,1e-6,1)*i)*(1/i)}}var Ly=function(){var i=11,V=1/(i-1);function g(o,n){return 1-3*n+3*o}function I(o,n){return 3*n-6*o}function e(o){return 3*o}function t(o,n,l){return((g(n,l)*o+I(n,l))*o+e(n))*o}function C(o,n,l){return 3*g(n,l)*o*o+2*I(n,l)*o+e(n)}function A(o,n,l,c,d){var h,m,r=0;do m=n+(l-n)/2,h=t(m,c,d)-o,h>0?l=m:n=m;while(Math.abs(h)>1e-7&&++r<10);return m}function s(o,n,l,c){for(var d=0;d<4;++d){var h=C(n,l,c);if(h===0)return n;var m=t(n,l,c)-o;n-=m/h}return n}function a(o,n,l,c){if(!(0<=o&&o<=1&&0<=l&&l<=1))return;var d=new Float32Array(i);if(o!==n||l!==c)for(var h=0;h<i;++h)d[h]=t(h*V,o,l);function m(r){for(var u=0,b=1,Z=i-1;b!==Z&&d[b]<=r;++b)u+=V;--b;var p=(r-d[b])/(d[b+1]-d[b]),G=u+p*V,X=C(G,o,l);return X>=.001?s(r,G,o,l):X===0?G:A(r,u,u+V,o,l)}return function(r){return o===n&&l===c||r===0||r===1?r:t(m(r),n,c)}}return a}(),jr=function(){var i={linear:function(){return function(I){return I}}},V={Sine:function(){return function(I){return 1-Math.cos(I*Math.PI/2)}},Circ:function(){return function(I){return 1-Math.sqrt(1-I*I)}},Back:function(){return function(I){return I*I*(3*I-2)}},Bounce:function(){return function(I){for(var e,t=4;I<((e=Math.pow(2,--t))-1)/11;);return 1/Math.pow(4,3-t)-7.5625*Math.pow((e*3-2)/22-I,2)}},Elastic:function(I,e){I===void 0&&(I=1),e===void 0&&(e=.5);var t=Ve(I,1,10),C=Ve(e,.1,2);return function(A){return A===0||A===1?A:-t*Math.pow(2,10*(A-1))*Math.sin((A-1-C/(Math.PI*2)*Math.asin(1/t))*(Math.PI*2)/C)}}},g=["Quad","Cubic","Quart","Quint","Expo"];return g.forEach(function(I,e){V[I]=function(){return function(t){return Math.pow(t,e+2)}}}),Object.keys(V).forEach(function(I){var e=V[I];i["easeIn"+I]=e,i["easeOut"+I]=function(t,C){return function(A){return 1-e(t,C)(1-A)}},i["easeInOut"+I]=function(t,C){return function(A){return A<.5?e(t,C)(A*2)/2:1-e(t,C)(A*-2+2)/2}},i["easeOutIn"+I]=function(t,C){return function(A){return A<.5?(1-e(t,C)(1-A*2))/2:(e(t,C)(A*2-1)+1)/2}}}),i}();function Va(i,V){if(TV.fnc(i))return i;var g=i.split("(")[0],I=jr[g],e=Er(i);switch(g){case"spring":return Qr(i,V);case"cubicBezier":return es(Ly,e);case"steps":return es(Ty,e);default:return es(I,e)}}function Pr(i){try{var V=document.querySelectorAll(i);return V}catch(g){return}}function An(i,V){for(var g=i.length,I=arguments.length>=2?arguments[1]:void 0,e=[],t=0;t<g;t++)if(t in i){var C=i[t];V.call(I,C,t,i)&&e.push(C)}return e}function nn(i){return i.reduce(function(V,g){return V.concat(TV.arr(g)?nn(g):g)},[])}function cc(i){return TV.arr(i)?i:(TV.str(i)&&(i=Pr(i)||i),i instanceof NodeList||i instanceof HTMLCollection?[].slice.call(i):[i])}function ga(i,V){return i.some(function(g){return g===V})}function Ia(i){var V={};for(var g in i)V[g]=i[g];return V}function js(i,V){var g=Ia(i);for(var I in i)g[I]=V.hasOwnProperty(I)?V[I]:i[I];return g}function sn(i,V){var g=Ia(i);for(var I in V)g[I]=TV.und(i[I])?V[I]:i[I];return g}function Uy(i){var V=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(i);return V?"rgba("+V[1]+",1)":i}function Dy(i){var V=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,g=i.replace(V,function(A,s,a,o){return s+s+a+a+o+o}),I=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(g),e=parseInt(I[1],16),t=parseInt(I[2],16),C=parseInt(I[3],16);return"rgba("+e+","+t+","+C+",1)"}function Ey(i){var V=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(i)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(i),g=parseInt(V[1],10)/360,I=parseInt(V[2],10)/100,e=parseInt(V[3],10)/100,t=V[4]||1;function C(l,c,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?l+(c-l)*6*d:d<1/2?c:d<2/3?l+(c-l)*(2/3-d)*6:l}var A,s,a;if(I==0)A=s=a=e;else{var o=e<.5?e*(1+I):e+I-e*I,n=2*e-o;A=C(n,o,g+1/3),s=C(n,o,g),a=C(n,o,g-1/3)}return"rgba("+A*255+","+s*255+","+a*255+","+t+")"}function Qy(i){if(TV.rgb(i))return Uy(i);if(TV.hex(i))return Dy(i);if(TV.hsl(i))return Ey(i)}function ye(i){var V=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(i);if(V)return V[1]}function jy(i){if(ci(i,"translate")||i==="perspective")return"px";if(ci(i,"rotate")||ci(i,"skew"))return"deg"}function Ps(i,V){return TV.fnc(i)?i(V.target,V.id,V.total):i}function ge(i,V){return i.getAttribute(V)}function ea(i,V,g){var I=ye(V);if(ga([g,"deg","rad","turn"],I))return V;var e=DA.CSS[V+g];if(!TV.und(e))return e;var t=100,C=document.createElement(i.tagName),A=i.parentNode&&i.parentNode!==document?i.parentNode:document.body;A.appendChild(C),C.style.position="absolute",C.style.width=t+g;var s=t/C.offsetWidth;A.removeChild(C);var a=s*parseFloat(V);return DA.CSS[V+g]=a,a}function Or(i,V,g){if(V in i.style){var I=V.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e=i.style[V]||getComputedStyle(i).getPropertyValue(I)||"0";return g?ea(i,e,g):e}}function ta(i,V){if(TV.dom(i)&&!TV.inp(i)&&(!TV.nil(ge(i,V))||TV.svg(i)&&i[V]))return"attribute";if(TV.dom(i)&&ga(zy,V))return"transform";if(TV.dom(i)&&V!=="transform"&&Or(i,V))return"css";if(i[V]!=null)return"object"}function _r(i){if(!!TV.dom(i)){for(var V=i.style.transform||"",g=/(\w+)\(([^)]*)\)/g,I=new Map,e;e=g.exec(V);)I.set(e[1],e[2]);return I}}function Py(i,V,g,I){var e=ci(V,"scale")?1:0+jy(V),t=_r(i).get(V)||e;return g&&(g.transforms.list.set(V,t),g.transforms.last=V),I?ea(i,t,I):t}function Ca(i,V,g,I){switch(ta(i,V)){case"transform":return Py(i,V,I,g);case"css":return Or(i,V,g);case"attribute":return ge(i,V);default:return i[V]||0}}function ia(i,V){var g=/^(\*=|\+=|-=)/.exec(i);if(!g)return i;var I=ye(i)||0,e=parseFloat(V),t=parseFloat(i.replace(g[0],""));switch(g[0][0]){case"+":return e+t+I;case"-":return e-t+I;case"*":return e*t+I}}function $r(i,V){if(TV.col(i))return Qy(i);if(/\s/g.test(i))return i;var g=ye(i),I=g?i.substr(0,i.length-g.length):i;return V?I+V:I}function Aa(i,V){return Math.sqrt(Math.pow(V.x-i.x,2)+Math.pow(V.y-i.y,2))}function Oy(i){return Math.PI*2*ge(i,"r")}function _y(i){return ge(i,"width")*2+ge(i,"height")*2}function $y(i){return Aa({x:ge(i,"x1"),y:ge(i,"y1")},{x:ge(i,"x2"),y:ge(i,"y2")})}function Vh(i){for(var V=i.points,g=0,I,e=0;e<V.numberOfItems;e++){var t=V.getItem(e);e>0&&(g+=Aa(I,t)),I=t}return g}function VX(i){var V=i.points;return Vh(i)+Aa(V.getItem(V.numberOfItems-1),V.getItem(0))}function gh(i){if(i.getTotalLength)return i.getTotalLength();switch(i.tagName.toLowerCase()){case"circle":return Oy(i);case"rect":return _y(i);case"line":return $y(i);case"polyline":return Vh(i);case"polygon":return VX(i)}}function gX(i){var V=gh(i);return i.setAttribute("stroke-dasharray",V),V}function IX(i){for(var V=i.parentNode;TV.svg(V)&&TV.svg(V.parentNode);)V=V.parentNode;return V}function Ih(i,V){var g=V||{},I=g.el||IX(i),e=I.getBoundingClientRect(),t=ge(I,"viewBox"),C=e.width,A=e.height,s=g.viewBox||(t?t.split(" "):[0,0,C,A]);return{el:I,viewBox:s,x:s[0]/1,y:s[1]/1,w:C,h:A,vW:s[2],vH:s[3]}}function eX(i,V){var g=TV.str(i)?Pr(i)[0]:i,I=V||100;return function(e){return{property:e,el:g,svg:Ih(g),totalLength:gh(g)*(I/100)}}}function tX(i,V,g){function I(o){o===void 0&&(o=0);var n=V+o>=1?V+o:0;return i.el.getPointAtLength(n)}var e=Ih(i.el,i.svg),t=I(),C=I(-1),A=I(1),s=g?1:e.w/e.vW,a=g?1:e.h/e.vH;switch(i.property){case"x":return(t.x-e.x)*s;case"y":return(t.y-e.y)*a;case"angle":return Math.atan2(A.y-C.y,A.x-C.x)*180/Math.PI}}function dc(i,V){var g=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,I=$r(TV.pth(i)?i.totalLength:i,V)+"";return{original:I,numbers:I.match(g)?I.match(g).map(Number):[0],strings:TV.str(i)||V?I.split(g):[]}}function na(i){var V=i?nn(TV.arr(i)?i.map(cc):cc(i)):[];return An(V,function(g,I,e){return e.indexOf(g)===I})}function eh(i){var V=na(i);return V.map(function(g,I){return{target:g,id:I,total:V.length,transforms:{list:_r(g)}}})}function CX(i,V){var g=Ia(V);if(/^spring/.test(g.easing)&&(g.duration=Qr(g.easing)),TV.arr(i)){var I=i.length,e=I===2&&!TV.obj(i[0]);e?i={value:i}:TV.fnc(V.duration)||(g.duration=V.duration/I)}var t=TV.arr(i)?i:[i];return t.map(function(C,A){var s=TV.obj(C)&&!TV.pth(C)?C:{value:C};return TV.und(s.delay)&&(s.delay=A?0:V.delay),TV.und(s.endDelay)&&(s.endDelay=A===t.length-1?V.endDelay:0),s}).map(function(C){return sn(C,g)})}function iX(i){for(var V=An(nn(i.map(function(t){return Object.keys(t)})),function(t){return TV.key(t)}).reduce(function(t,C){return t.indexOf(C)<0&&t.push(C),t},[]),g={},I=function(t){var C=V[t];g[C]=i.map(function(A){var s={};for(var a in A)TV.key(a)?a==C&&(s.value=A[a]):s[a]=A[a];return s})},e=0;e<V.length;e++)I(e);return g}function AX(i,V){var g=[],I=V.keyframes;I&&(V=sn(iX(I),V));for(var e in V)TV.key(e)&&g.push({name:e,tweens:CX(V[e],i)});return g}function nX(i,V){var g={};for(var I in i){var e=Ps(i[I],V);TV.arr(e)&&(e=e.map(function(t){return Ps(t,V)}),e.length===1&&(e=e[0])),g[I]=e}return g.duration=parseFloat(g.duration),g.delay=parseFloat(g.delay),g}function sX(i,V){var g;return i.tweens.map(function(I){var e=nX(I,V),t=e.value,C=TV.arr(t)?t[1]:t,A=ye(C),s=Ca(V.target,i.name,A,V),a=g?g.to.original:s,o=TV.arr(t)?t[0]:a,n=ye(o)||ye(s),l=A||n;return TV.und(C)&&(C=a),e.from=dc(o,l),e.to=dc(ia(C,o),l),e.start=g?g.end:0,e.end=e.start+e.delay+e.duration+e.endDelay,e.easing=Va(e.easing,e.duration),e.isPath=TV.pth(t),e.isPathTargetInsideSVG=e.isPath&&TV.svg(V.target),e.isColor=TV.col(e.from.original),e.isColor&&(e.round=1),g=e,e})}var th={css:function(i,V,g){return i.style[V]=g},attribute:function(i,V,g){return i.setAttribute(V,g)},object:function(i,V,g){return i[V]=g},transform:function(i,V,g,I,e){if(I.list.set(V,g),V===I.last||e){var t="";I.list.forEach(function(C,A){t+=A+"("+C+") "}),i.style.transform=t}}};function Ch(i,V){var g=eh(i);g.forEach(function(I){for(var e in V){var t=Ps(V[e],I),C=I.target,A=ye(t),s=Ca(C,e,A,I),a=A||ye(s),o=ia($r(t,a),s),n=ta(C,e);th[n](C,e,o,I.transforms,!0)}})}function lX(i,V){var g=ta(i.target,V.name);if(g){var I=sX(V,i),e=I[I.length-1];return{type:g,property:V.name,animatable:i,tweens:I,duration:e.end,delay:I[0].delay,endDelay:e.endDelay}}}function aX(i,V){return An(nn(i.map(function(g){return V.map(function(I){return lX(g,I)})})),function(g){return!TV.und(g)})}function ih(i,V){var g=i.length,I=function(t){return t.timelineOffset?t.timelineOffset:0},e={};return e.duration=g?Math.max.apply(Math,i.map(function(t){return I(t)+t.duration})):V.duration,e.delay=g?Math.min.apply(Math,i.map(function(t){return I(t)+t.delay})):V.delay,e.endDelay=g?e.duration-Math.max.apply(Math,i.map(function(t){return I(t)+t.duration-t.endDelay})):V.endDelay,e}var rc=0;function oX(i){var V=js(Dr,i),g=js($l,i),I=AX(g,i),e=eh(i.targets),t=aX(e,I),C=ih(t,g),A=rc;return rc++,sn(V,{id:A,children:[],animatables:e,animations:t,duration:C.duration,delay:C.delay,endDelay:C.endDelay})}var DI=[],Ah=function(){var i;function V(){!i&&(!hc()||!LV.suspendWhenDocumentHidden)&&DI.length>0&&(i=requestAnimationFrame(g))}function g(e){for(var t=DI.length,C=0;C<t;){var A=DI[C];A.paused?(DI.splice(C,1),t--):(A.tick(e),C++)}i=C>0?requestAnimationFrame(g):void 0}function I(){!LV.suspendWhenDocumentHidden||(hc()?i=cancelAnimationFrame(i):(DI.forEach(function(e){return e._onDocumentVisibility()}),Ah()))}return typeof document!="undefined"&&document.addEventListener("visibilitychange",I),V}();function hc(){return!!document&&document.hidden}function LV(i){i===void 0&&(i={});var V=0,g=0,I=0,e,t=0,C=null;function A(u){var b=window.Promise&&new Promise(function(Z){return C=Z});return u.finished=b,b}var s=oX(i);A(s);function a(){var u=s.direction;u!=="alternate"&&(s.direction=u!=="normal"?"normal":"reverse"),s.reversed=!s.reversed,e.forEach(function(b){return b.reversed=s.reversed})}function o(u){return s.reversed?s.duration-u:u}function n(){V=0,g=o(s.currentTime)*(1/LV.speed)}function l(u,b){b&&b.seek(u-b.timelineOffset)}function c(u){if(s.reversePlayback)for(var Z=t;Z--;)l(u,e[Z]);else for(var b=0;b<t;b++)l(u,e[b])}function d(u){for(var b=0,Z=s.animations,p=Z.length;b<p;){var G=Z[b],X=G.animatable,W=G.tweens,y=W.length-1,Y=W[y];y&&(Y=An(W,function(k){return u<k.end})[0]||Y);for(var f=Ve(u-Y.start-Y.delay,0,Y.duration)/Y.duration,L=isNaN(f)?1:Y.easing(f),R=Y.to.strings,J=Y.round,H=[],N=Y.to.numbers.length,v=void 0,T=0;T<N;T++){var D=void 0,$=Y.to.numbers[T],M=Y.from.numbers[T]||0;Y.isPath?D=tX(Y.value,L*$,Y.isPathTargetInsideSVG):D=M+L*($-M),J&&(Y.isColor&&T>2||(D=Math.round(D*J)/J)),H.push(D)}var _=R.length;if(!_)v=H[0];else{v=R[0];for(var x=0;x<_;x++){R[x];var z=R[x+1],F=H[x];isNaN(F)||(z?v+=F+z:v+=F+" ")}}th[G.type](X.target,G.property,v,X.transforms),G.currentValue=v,b++}}function h(u){s[u]&&!s.passThrough&&s[u](s)}function m(){s.remaining&&s.remaining!==!0&&s.remaining--}function r(u){var b=s.duration,Z=s.delay,p=b-s.endDelay,G=o(u);s.progress=Ve(G/b*100,0,100),s.reversePlayback=G<s.currentTime,e&&c(G),!s.began&&s.currentTime>0&&(s.began=!0,h("begin")),!s.loopBegan&&s.currentTime>0&&(s.loopBegan=!0,h("loopBegin")),G<=Z&&s.currentTime!==0&&d(0),(G>=p&&s.currentTime!==b||!b)&&d(b),G>Z&&G<p?(s.changeBegan||(s.changeBegan=!0,s.changeCompleted=!1,h("changeBegin")),h("change"),d(G)):s.changeBegan&&(s.changeCompleted=!0,s.changeBegan=!1,h("changeComplete")),s.currentTime=Ve(G,0,b),s.began&&h("update"),u>=b&&(g=0,m(),s.remaining?(V=I,h("loopComplete"),s.loopBegan=!1,s.direction==="alternate"&&a()):(s.paused=!0,s.completed||(s.completed=!0,h("loopComplete"),h("complete"),!s.passThrough&&"Promise"in window&&(C(),A(s)))))}return s.reset=function(){var u=s.direction;s.passThrough=!1,s.currentTime=0,s.progress=0,s.paused=!0,s.began=!1,s.loopBegan=!1,s.changeBegan=!1,s.completed=!1,s.changeCompleted=!1,s.reversePlayback=!1,s.reversed=u==="reverse",s.remaining=s.loop,e=s.children,t=e.length;for(var b=t;b--;)s.children[b].reset();(s.reversed&&s.loop!==!0||u==="alternate"&&s.loop===1)&&s.remaining++,d(s.reversed?s.duration:0)},s._onDocumentVisibility=n,s.set=function(u,b){return Ch(u,b),s},s.tick=function(u){I=u,V||(V=I),r((I+(g-V))*LV.speed)},s.seek=function(u){r(o(u))},s.pause=function(){s.paused=!0,n()},s.play=function(){!s.paused||(s.completed&&s.reset(),s.paused=!1,DI.push(s),n(),Ah())},s.reverse=function(){a(),s.completed=!s.reversed,n()},s.restart=function(){s.reset(),s.play()},s.remove=function(u){var b=na(u);nh(b,s)},s.reset(),s.autoplay&&s.play(),s}function mc(i,V){for(var g=V.length;g--;)ga(i,V[g].animatable.target)&&V.splice(g,1)}function nh(i,V){var g=V.animations,I=V.children;mc(i,g);for(var e=I.length;e--;){var t=I[e],C=t.animations;mc(i,C),!C.length&&!t.children.length&&I.splice(e,1)}!g.length&&!I.length&&V.pause()}function cX(i){for(var V=na(i),g=DI.length;g--;){var I=DI[g];nh(V,I)}}function dX(i,V){V===void 0&&(V={});var g=V.direction||"normal",I=V.easing?Va(V.easing):null,e=V.grid,t=V.axis,C=V.from||0,A=C==="first",s=C==="center",a=C==="last",o=TV.arr(i),n=parseFloat(o?i[0]:i),l=o?parseFloat(i[1]):0,c=ye(o?i[1]:i)||0,d=V.start||0+(o?n:0),h=[],m=0;return function(r,u,b){if(A&&(C=0),s&&(C=(b-1)/2),a&&(C=b-1),!h.length){for(var Z=0;Z<b;Z++){if(!e)h.push(Math.abs(C-Z));else{var p=s?(e[0]-1)/2:C%e[0],G=s?(e[1]-1)/2:Math.floor(C/e[0]),X=Z%e[0],W=Math.floor(Z/e[0]),y=p-X,Y=G-W,f=Math.sqrt(y*y+Y*Y);t==="x"&&(f=-y),t==="y"&&(f=-Y),h.push(f)}m=Math.max.apply(Math,h)}I&&(h=h.map(function(R){return I(R/m)*m})),g==="reverse"&&(h=h.map(function(R){return t?R<0?R*-1:-R:Math.abs(m-R)}))}var L=o?(l-n)/m:n;return d+L*(Math.round(h[u]*100)/100)+c}}function rX(i){i===void 0&&(i={});var V=LV(i);return V.duration=0,V.add=function(g,I){var e=DI.indexOf(V),t=V.children;e>-1&&DI.splice(e,1);function C(l){l.passThrough=!0}for(var A=0;A<t.length;A++)C(t[A]);var s=sn(g,js($l,i));s.targets=s.targets||i.targets;var a=V.duration;s.autoplay=!1,s.direction=V.direction,s.timelineOffset=TV.und(I)?a:ia(I,a),C(V),V.seek(s.timelineOffset);var o=LV(s);C(o),t.push(o);var n=ih(t,i);return V.delay=n.delay,V.endDelay=n.endDelay,V.duration=n.duration,V.seek(0),V.reset(),V.autoplay&&V.play(),V},V}LV.version="3.2.1";LV.speed=1;LV.suspendWhenDocumentHidden=!0;LV.running=DI;LV.remove=cX;LV.get=Ca;LV.set=Ch;LV.convertPx=ea;LV.path=eX;LV.setDashoffset=gX;LV.stagger=dX;LV.timeline=rX;LV.easing=Va;LV.penner=jr;LV.random=function(i,V){return Math.floor(Math.random()*(V-i+1))+i};var hX=`#include <common>\r
#include <math>\r
\r
varying vec2 vUv;\r
\r
uniform sampler2D tDiffuse;\r
uniform vec3 color;\r
uniform float strength;\r
\r
void main() {\r
\r
	gl_FragColor = texture2D( tDiffuse, vUv );\r
\r
	vec2 coordinates = vUv * 2. - 1.;\r
	float linearGradient = mapLinear( vUv.y, 0., 1., .25, 1. );\r
	float radialGradient = sineIn( length( coordinates ) );\r
	float finalGradient = linearGradient * radialGradient;\r
	gl_FragColor.rgb = mix( gl_FragColor.rgb, color, finalGradient * strength );\r
\r
}\r
`;class mX extends Tr{constructor(){super({uniforms:{tDiffuse:{value:null},color:{value:new NV(1,1,1)},strength:{value:.5}},vertexShader:Lr,fragmentShader:hX}),autobind(this),this.strengthFactor=1,q.addEventListener("applySettings",this.applySettings),q.addEventListener("onViewChange",this.onViewChange)}applySettings(){const{strength:V,color:g,enabled:I}=q.settings.postProcessing.vignette;this.uniforms.strength.value=V*this.strengthFactor,this.uniforms.color.value.set(g),this.enabled=I}onViewChange(){const V=q.inGame?0:1;LV({targets:this,strengthFactor:V,easing:"easeOutExpo",duration:1e3})}}class uX{constructor(V){autobind(this),this.renderPass=new ky,this.vignettePass=new mX,this.copyPass=new Ur,this.composer=new xy(V),this.composer.addPass(this.renderPass),this.composer.addPass(this.vignettePass),this.composer.addPass(this.copyPass),q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("resize",this.onResize)}render(){const V=XV.overrideCamera||XV.camera;this.renderPass.camera=V,this.renderPass.scene=XV.scene,this.composer.render()}onResize(){const{x:V,y:g}=XV.renderer.resolution;this.composer.setSize(V,g)}}var bX=`float random( vec2 c ) { return fract( sin( dot( c.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 ); }\r
float randFloat( vec2 c, float low, float high ) { return low + random( c ) * ( high - low ); }\r
int randInt( vec2 c, float low, float high ) { return int( low + floor( random( c ) * ( high - low + 1. ) ) ); }\r
\r
float mapLinear( float value, float min1, float max1, float min2, float max2 ) {\r
\r
	return min2 + ( value - min1 ) * ( max2 - min2 ) / ( max1 - min1 );\r
\r
}\r
\r
vec3 randomVector3( vec2 c, float scale ) {\r
\r
	float theta = 2. * PI * random( c );\r
	float phi = acos( 2. * random( c ) - 1. );\r
\r
	float x = sin( phi ) * cos( theta );\r
	float y = sin( phi ) * sin( theta );\r
	float z = cos( phi );\r
\r
	return vec3( x, y, z ) * scale;\r
\r
}\r
\r
float euclideanModulo( float n, float m ) {\r
\r
	return mod( ( mod( n, m ) + m ), m );\r
\r
}\r
\r
float bounceOut( float t ) {\r
\r
	const float a = 4. / 11.;\r
	const float b = 8. / 11.;\r
	const float c = 9. / 10.;\r
	const float ca = 4356. / 361.;\r
	const float cb = 35442. / 1805.;\r
	const float cc = 16061. / 1805.;\r
	float t2 = t * t;\r
\r
	return t < a ? 7.5625 * t2 : t < b ? 9.075 * t2 - 9.9 * t + 3.4 : t < c ? ca * t2 - cb * t + cc : 10.8 * t * t - 20.52 * t + 10.72;\r
\r
}\r
\r
float bounceInOut( float t ) { return t < .5 ? .5 * ( 1. - bounceOut( 1. - t * 2. ) ) : .5 * bounceOut( t * 2. - 1. ) + .5; }\r
float bounceIn( float t ) { return 1. - bounceOut( 1. - t ); }\r
\r
float circularIn( float t ) { return 1. - sqrt( 1. - t * t ); }\r
float circularOut( float t ) { return sqrt( ( 2. - t ) * t ); }\r
float circularInOut( float t ) { return t < .5 ? .5 * ( 1. - sqrt( 1. - 4. * t * t ) ) : .5 * ( sqrt( ( 3. - 2. * t ) * ( 2. * t - 1. ) ) + 1. ); }\r
\r
float cubicInOut( float t ) { return t < .5 ? 4. * t * t * t : .5 * pow( 2. * t - 2.0, 3. ) + 1.; }\r
float cubicIn( float t ) { return t * t * t; }\r
float cubicOut( float t ) {\r
\r
	float f = t - 1.;\r
	return f * f * f + 1.;\r
\r
}\r
\r
float elasticIn( float t ) { return sin( 13. * t * PI_HALF ) * pow( 2.0, 10. * ( t - 1. ) ); }\r
float elasticOut( float t ) { return sin( -13. * ( t + 1. ) * PI_HALF ) * pow( 2.0, -10. * t ) + 1.; }\r
float elasticInOut( float t ) { return t < .5 ? .5 * sin( +13. * PI_HALF * 2. * t ) * pow( 2.0, 10. * ( 2. * t - 1. ) ) : .5 * sin( -13. * PI_HALF * ( ( 2. * t - 1. ) + 1. ) ) * pow( 2.0, -10. * ( 2. * t - 1. ) ) + 1.; }\r
\r
float exponentialIn( float t ) { return t == .0 ? t : pow( 2.0, 10. * ( t - 1. ) ); }\r
float exponentialOut( float t ) { return t == 1. ? t : 1. - pow( 2.0, -10. * t ); }\r
float exponentialInOut( float t ) { return t == .0 || t == 1. ? t : t < .5 ? +0.5 * pow( 2.0, ( 20. * t ) - 10. ) : -0.5 * pow( 2.0, 10. - ( t * 20. ) ) + 1.; }\r
\r
float quadraticIn( float t ) { return t * t; }\r
float quadraticOut( float t ) { return -t * ( t - 2. ); }\r
float quadraticInOut( float t ) {\r
\r
	float p = 2. * t * t;\r
	return t < .5 ? p : -p + ( 4. * t ) - 1.;\r
\r
}\r
\r
float quarticIn( float t ) { return pow( t, 4. ); }\r
float quarticOut( float t ) { return pow( t - 1.0, 3. ) * ( 1. - t ) + 1.; }\r
float quarticInOut( float t ) { return t < .5 ? + 8. * pow( t, 4. ) : - 8. * pow( t - 1.0, 4. ) + 1.; }\r
\r
float qinticIn( float t ) { return pow( t, 5. ); }\r
float qinticOut( float t ) { return 1. - ( pow( t - 1.0, 5. ) ); }\r
float qinticInOut( float t ) { return t < .5 ? + 16. * pow( t, 5. ) : - .5 * pow( 2. * t - 2.0, 5. ) + 1.; }\r
\r
float sineInOut( float t ) { return -0.5 * ( cos( PI * t ) - 1. ); }\r
float sineIn( float t ) { return sin( ( t - 1. ) * PI_HALF ) + 1.; }\r
float sineOut( float t ) { return sin( t * PI_HALF ); }\r
\r
float linear( float t ) { return t; }\r
`,ZX=`float getLuma ( const in vec3 color ) {\r
\r
    return dot( color, vec3( .299, .587, .114 ) );\r
\r
}\r
`,GX=`mat3 lookAt( vec3 origin, vec3 target, vec3 up ) {\r
\r
	vec3 ww = normalize( target - origin );\r
	vec3 uu = normalize( cross( ww, up ) );\r
	vec3 vv = normalize( cross( uu, ww ) );\r
\r
	return mat3( uu, vv, ww );\r
\r
}\r
`,pX=`vec4 screenPosition = vec4( transformed, 1. );\r
\r
#ifdef USE_INSTANCING\r
\r
	screenPosition = instanceMatrix * screenPosition;\r
\r
#endif\r
\r
screenPosition = modelMatrix * screenPosition;\r
screenPosition.xy /= resolution / ( pixelRatio * 2. );\r
gl_Position = screenPosition;\r
`,qX=`uniform vec2 resolution;\r
uniform float pixelRatio;\r
`,BX=`#ifdef USE_SKINNING\r
\r
	boneMatX = getPreviousBoneMatrix( skinIndex.x );\r
	boneMatY = getPreviousBoneMatrix( skinIndex.y );\r
	boneMatZ = getPreviousBoneMatrix( skinIndex.z );\r
	boneMatW = getPreviousBoneMatrix( skinIndex.w );\r
\r
#endif\r
`,WX=`#ifdef USE_SKINNING\r
\r
	#ifdef BONE_TEXTURE\r
\r
		uniform sampler2D prevBoneTexture;\r
\r
		mat4 getPrevBoneMatrix( const in float i ) {\r
\r
			float j = i * 4.0;\r
			float x = mod( j, float( boneTextureSize ) );\r
			float y = floor( j / float( boneTextureSize ) );\r
			float dx = 1.0 / float( boneTextureSize );\r
			float dy = 1.0 / float( boneTextureSize );\r
			y = dy * ( y + 0.5 );\r
\r
			vec4 v1 = texture2D( prevBoneTexture, vec2( dx * ( x + 0.5 ), y ) );\r
			vec4 v2 = texture2D( prevBoneTexture, vec2( dx * ( x + 1.5 ), y ) );\r
			vec4 v3 = texture2D( prevBoneTexture, vec2( dx * ( x + 2.5 ), y ) );\r
			vec4 v4 = texture2D( prevBoneTexture, vec2( dx * ( x + 3.5 ), y ) );\r
			mat4 bone = mat4( v1, v2, v3, v4 );\r
\r
			return bone;\r
\r
\r
		}\r
	#else\r
\r
		uniform mat4 prevBoneMatrices[ MAX_BONES ];\r
\r
		mat4 getPrevBoneMatrix( const in float i ) {\r
\r
			mat4 bone = prevBoneMatrices[ int( i ) ];\r
			return bone;\r
\r
		}\r
\r
	#endif\r
\r
#endif\r
`,yX=`#ifdef USE_SKINNING\r
\r
	skinVertex = bindMatrix * vec4( transformed, 1.0 );\r
\r
	skinned = vec4( 0.0 );\r
	skinned += boneMatX * skinVertex * skinWeight.x;\r
	skinned += boneMatY * skinVertex * skinWeight.y;\r
	skinned += boneMatZ * skinVertex * skinWeight.z;\r
	skinned += boneMatW * skinVertex * skinWeight.w;\r
\r
	transformed = ( bindMatrixInverse * skinned ).xyz;\r
\r
#endif\r
`;QV.math=bX;QV.getLuma=ZX;QV.lookAt=GX;QV.screen_position_vertex=pX;QV.screen_position_pars_vertex=qX;QV.previous_skinbase_vertex=BX;QV.previous_skinning_pars_vertex=WX;QV.previous_skinning_vertex=yX;class XX extends ig{constructor(){const{antialias:V}=q.settings.renderer;super({antialias:V,powerPreference:"high-performance",logarithmicDepthBuffer:!1,alpha:!1}),autobind(this),this.scene=new wC,this.resolution=new dV,this.shadowMap.enabled=!0,this.info.autoReset=!1;const{Viewport:g}=q.DOMElements;g.prepend(this.domElement),q.addEventListener("ready",this.initialize),q.addEventListener("applySettings",this.applySettings),q.addEventListener("render",this.update),XV.postProcessing=new uX(this)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("resize",this.onResize)}applySettings(){this.autoClear=!1;const{clearColor:V,pixelRatio:g}=q.settings.renderer;this.setClearColor(V,1),this.setPixelRatio(g)}update(){if(this.info.reset(),this.clear(),!XV.scene)return;const V=XV.overrideCamera||XV.camera,{enabled:g}=q.settings.postProcessing;g?XV.postProcessing.render():this.render(XV.scene,V)}prerender(V){const g=V.parent;this.scene.add(V),this.setObjectsCulling(V,!1);const I=XV.overrideCamera||XV.camera;this.render(this.scene,I),this.setObjectsCulling(V,!0),g&&g.add(V)}setObjectsCulling(V,g){V.traverse(I=>this.setObjectCulling(I,g))}setObjectCulling(V,g){!V.isMesh||(g||(V._frustumCulled=V.frustumCulled,V._visible=V.visible),V.frustumCulled=g&&V._frustumCulled,V.visible=g?V._visible:!0,g&&(delete V._frustumCulled,delete V._visible))}onResize(){const{quality:V,pixelRatio:g}=q.settings.renderer,{size:I,width:e,height:t,devicePixelRatio:C}=q.viewport;this.pixelRatio=Math.clamp(V,.5,C),this.resolution.copy(I).multiplyScalar(this.pixelRatio),this.setSize(e,t),this.setPixelRatio(g)}}var ZI={exports:{}};(function(i,V){(function(g){i.exports=g()})(function(){return function g(I,e,t){function C(a,o){if(!e[a]){if(!I[a]){var n=typeof ki=="function"&&ki;if(!o&&n)return n(a,!0);if(A)return A(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=e[a]={exports:{}};I[a][0].call(l.exports,function(c){var d=I[a][1][c];return C(d||c)},l,l.exports,g,I,e,t)}return e[a].exports}for(var A=typeof ki=="function"&&ki,s=0;s<t.length;s++)C(t[s]);return C}({1:[function(g,I,e){I.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(g,I,e){I.exports={version:g("../package.json").version,AABB:g("./collision/AABB"),ArrayCollisionMatrix:g("./collision/ArrayCollisionMatrix"),Body:g("./objects/Body"),Box:g("./shapes/Box"),Broadphase:g("./collision/Broadphase"),Constraint:g("./constraints/Constraint"),ContactEquation:g("./equations/ContactEquation"),Narrowphase:g("./world/Narrowphase"),ConeTwistConstraint:g("./constraints/ConeTwistConstraint"),ContactMaterial:g("./material/ContactMaterial"),ConvexPolyhedron:g("./shapes/ConvexPolyhedron"),Cylinder:g("./shapes/Cylinder"),DistanceConstraint:g("./constraints/DistanceConstraint"),Equation:g("./equations/Equation"),EventTarget:g("./utils/EventTarget"),FrictionEquation:g("./equations/FrictionEquation"),GSSolver:g("./solver/GSSolver"),GridBroadphase:g("./collision/GridBroadphase"),Heightfield:g("./shapes/Heightfield"),HingeConstraint:g("./constraints/HingeConstraint"),LockConstraint:g("./constraints/LockConstraint"),Mat3:g("./math/Mat3"),Material:g("./material/Material"),NaiveBroadphase:g("./collision/NaiveBroadphase"),ObjectCollisionMatrix:g("./collision/ObjectCollisionMatrix"),Pool:g("./utils/Pool"),Particle:g("./shapes/Particle"),Plane:g("./shapes/Plane"),PointToPointConstraint:g("./constraints/PointToPointConstraint"),Quaternion:g("./math/Quaternion"),Ray:g("./collision/Ray"),RaycastVehicle:g("./objects/RaycastVehicle"),RaycastResult:g("./collision/RaycastResult"),RigidVehicle:g("./objects/RigidVehicle"),RotationalEquation:g("./equations/RotationalEquation"),RotationalMotorEquation:g("./equations/RotationalMotorEquation"),SAPBroadphase:g("./collision/SAPBroadphase"),SPHSystem:g("./objects/SPHSystem"),Shape:g("./shapes/Shape"),Solver:g("./solver/Solver"),Sphere:g("./shapes/Sphere"),SplitSolver:g("./solver/SplitSolver"),Spring:g("./objects/Spring"),Trimesh:g("./shapes/Trimesh"),Vec3:g("./math/Vec3"),Vec3Pool:g("./utils/Vec3Pool"),World:g("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(g,I,e){var t=g("../math/Vec3");g("../utils/Utils"),I.exports=C;function C(a){a=a||{},this.lowerBound=new t,a.lowerBound&&this.lowerBound.copy(a.lowerBound),this.upperBound=new t,a.upperBound&&this.upperBound.copy(a.upperBound)}var A=new t;C.prototype.setFromPoints=function(a,o,n,l){var c=this.lowerBound,d=this.upperBound,h=n;c.copy(a[0]),h&&h.vmult(c,c),d.copy(c);for(var m=1;m<a.length;m++){var r=a[m];h&&(h.vmult(r,A),r=A),r.x>d.x&&(d.x=r.x),r.x<c.x&&(c.x=r.x),r.y>d.y&&(d.y=r.y),r.y<c.y&&(c.y=r.y),r.z>d.z&&(d.z=r.z),r.z<c.z&&(c.z=r.z)}return o&&(o.vadd(c,c),o.vadd(d,d)),l&&(c.x-=l,c.y-=l,c.z-=l,d.x+=l,d.y+=l,d.z+=l),this},C.prototype.copy=function(a){return this.lowerBound.copy(a.lowerBound),this.upperBound.copy(a.upperBound),this},C.prototype.clone=function(){return new C().copy(this)},C.prototype.extend=function(a){var o=a.lowerBound.x;this.lowerBound.x>o&&(this.lowerBound.x=o);var n=a.upperBound.x;this.upperBound.x<n&&(this.upperBound.x=n);var o=a.lowerBound.y;this.lowerBound.y>o&&(this.lowerBound.y=o);var n=a.upperBound.y;this.upperBound.y<n&&(this.upperBound.y=n);var o=a.lowerBound.z;this.lowerBound.z>o&&(this.lowerBound.z=o);var n=a.upperBound.z;this.upperBound.z<n&&(this.upperBound.z=n)},C.prototype.overlaps=function(a){var o=this.lowerBound,n=this.upperBound,l=a.lowerBound,c=a.upperBound;return(l.x<=n.x&&n.x<=c.x||o.x<=c.x&&c.x<=n.x)&&(l.y<=n.y&&n.y<=c.y||o.y<=c.y&&c.y<=n.y)&&(l.z<=n.z&&n.z<=c.z||o.z<=c.z&&c.z<=n.z)},C.prototype.contains=function(a){var o=this.lowerBound,n=this.upperBound,l=a.lowerBound,c=a.upperBound;return o.x<=l.x&&n.x>=c.x&&o.y<=l.y&&n.y>=c.y&&o.z<=l.z&&n.z>=c.z},C.prototype.getCorners=function(a,o,n,l,c,d,h,m){var r=this.lowerBound,u=this.upperBound;a.copy(r),o.set(u.x,r.y,r.z),n.set(u.x,u.y,r.z),l.set(r.x,u.y,u.z),c.set(u.x,r.y,r.z),d.set(r.x,u.y,r.z),h.set(r.x,r.y,u.z),m.copy(u)};var s=[new t,new t,new t,new t,new t,new t,new t,new t];C.prototype.toLocalFrame=function(a,o){var n=s,l=n[0],c=n[1],d=n[2],h=n[3],m=n[4],r=n[5],u=n[6],b=n[7];this.getCorners(l,c,d,h,m,r,u,b);for(var Z=0;Z!==8;Z++){var p=n[Z];a.pointToLocal(p,p)}return o.setFromPoints(n)},C.prototype.toWorldFrame=function(a,o){var n=s,l=n[0],c=n[1],d=n[2],h=n[3],m=n[4],r=n[5],u=n[6],b=n[7];this.getCorners(l,c,d,h,m,r,u,b);for(var Z=0;Z!==8;Z++){var p=n[Z];a.pointToWorld(p,p)}return o.setFromPoints(n)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(g,I,e){I.exports=t;function t(){this.matrix=[]}t.prototype.get=function(C,A){if(C=C.index,A=A.index,A>C){var s=A;A=C,C=s}return this.matrix[(C*(C+1)>>1)+A-1]},t.prototype.set=function(C,A,s){if(C=C.index,A=A.index,A>C){var a=A;A=C,C=a}this.matrix[(C*(C+1)>>1)+A-1]=s?1:0},t.prototype.reset=function(){for(var C=0,A=this.matrix.length;C!==A;C++)this.matrix[C]=0},t.prototype.setNumObjects=function(C){this.matrix.length=C*(C-1)>>1}},{}],5:[function(g,I,e){var t=g("../objects/Body"),C=g("../math/Vec3"),A=g("../math/Quaternion");g("../shapes/Shape"),g("../shapes/Plane"),I.exports=s;function s(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}s.prototype.collisionPairs=function(h,m,r){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var a=t.STATIC|t.KINEMATIC;s.prototype.needBroadphaseCollision=function(h,m){return!((h.collisionFilterGroup&m.collisionFilterMask)===0||(m.collisionFilterGroup&h.collisionFilterMask)===0||((h.type&a)!==0||h.sleepState===t.SLEEPING)&&((m.type&a)!==0||m.sleepState===t.SLEEPING))},s.prototype.intersectionTest=function(h,m,r,u){this.useBoundingBoxes?this.doBoundingBoxBroadphase(h,m,r,u):this.doBoundingSphereBroadphase(h,m,r,u)};var o=new C;new C,new A,new C,s.prototype.doBoundingSphereBroadphase=function(h,m,r,u){var b=o;m.position.vsub(h.position,b);var Z=Math.pow(h.boundingRadius+m.boundingRadius,2),p=b.norm2();p<Z&&(r.push(h),u.push(m))},s.prototype.doBoundingBoxBroadphase=function(h,m,r,u){h.aabbNeedsUpdate&&h.computeAABB(),m.aabbNeedsUpdate&&m.computeAABB(),h.aabb.overlaps(m.aabb)&&(r.push(h),u.push(m))};var n={keys:[]},l=[],c=[];s.prototype.makePairsUnique=function(h,m){for(var r=n,u=l,b=c,Z=h.length,p=0;p!==Z;p++)u[p]=h[p],b[p]=m[p];h.length=0,m.length=0;for(var p=0;p!==Z;p++){var G=u[p].id,X=b[p].id,W=G<X?G+","+X:X+","+G;r[W]=p,r.keys.push(W)}for(var p=0;p!==r.keys.length;p++){var W=r.keys.pop(),y=r[W];h.push(u[y]),m.push(b[y]),delete r[W]}},s.prototype.setWorld=function(h){};var d=new C;s.boundingSphereCheck=function(h,m){var r=d;return h.position.vsub(m.position,r),Math.pow(h.shape.boundingSphereRadius+m.shape.boundingSphereRadius,2)>r.norm2()},s.prototype.aabbQuery=function(h,m,r){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(g,I,e){I.exports=s;var t=g("./Broadphase"),C=g("../math/Vec3"),A=g("../shapes/Shape");function s(o,n,l,c,d){t.apply(this),this.nx=l||10,this.ny=c||10,this.nz=d||10,this.aabbMin=o||new C(100,100,100),this.aabbMax=n||new C(-100,-100,-100);var h=this.nx*this.ny*this.nz;if(h<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=h,this.binLengths.length=h;for(var m=0;m<h;m++)this.bins[m]=[],this.binLengths[m]=0}s.prototype=new t,s.prototype.constructor=s;var a=new C;new C,s.prototype.collisionPairs=function(o,n,l){var c=o.numObjects(),d=o.bodies,rV=this.aabbMax,k=this.aabbMin,h=this.nx,m=this.ny,r=this.nz,u=m*r,b=r,Z=1,p=rV.x,G=rV.y,X=rV.z,W=k.x,y=k.y,Y=k.z,f=h/(p-W),L=m/(G-y),R=r/(X-Y),J=(p-W)/h,H=(G-y)/m,N=(X-Y)/r,v=Math.sqrt(J*J+H*H+N*N)*.5,T=A.types,D=T.SPHERE,$=T.PLANE;T.BOX,T.COMPOUND,T.CONVEXPOLYHEDRON;for(var M=this.bins,_=this.binLengths,x=this.bins.length,z=0;z!==x;z++)_[z]=0;var F=Math.ceil,k=Math.min,rV=Math.max;function nV(MV,HV,OV,tg,Cg,gI,Vg){var Yg=(MV-W)*f|0,mg=(HV-y)*L|0,II=(OV-Y)*R|0,rI=F((tg-W)*f),iI=F((Cg-y)*L),ug=F((gI-Y)*R);Yg<0?Yg=0:Yg>=h&&(Yg=h-1),mg<0?mg=0:mg>=m&&(mg=m-1),II<0?II=0:II>=r&&(II=r-1),rI<0?rI=0:rI>=h&&(rI=h-1),iI<0?iI=0:iI>=m&&(iI=m-1),ug<0?ug=0:ug>=r&&(ug=r-1),Yg*=u,mg*=b,II*=Z,rI*=u,iI*=b,ug*=Z;for(var QI=Yg;QI<=rI;QI+=u)for(var ie=mg;ie<=iI;ie+=b)for(var RI=II;RI<=ug;RI+=Z){var Ae=QI+ie+RI;M[Ae][_[Ae]++]=Vg}}for(var z=0;z!==c;z++){var j=d[z],VV=j.shape;switch(VV.type){case D:var lV=j.position.x,iV=j.position.y,CV=j.position.z,AV=VV.radius;nV(lV-AV,iV-AV,CV-AV,lV+AV,iV+AV,CV+AV,j);break;case $:VV.worldNormalNeedsUpdate&&VV.computeWorldNormal(j.quaternion);var gV=VV.worldNormal,eV=W+J*.5-j.position.x,K=y+H*.5-j.position.y,w=Y+N*.5-j.position.z,sV=a;sV.set(eV,K,w);for(var tV=0,BV=0;tV!==h;tV++,BV+=u,sV.y=K,sV.x+=J)for(var yV=0,wV=0;yV!==m;yV++,wV+=b,sV.z=w,sV.y+=H)for(var fV=0,vV=0;fV!==r;fV++,vV+=Z,sV.z+=N)if(sV.dot(gV)<v){var YV=BV+wV+vV;M[YV][_[YV]++]=j}break;default:j.aabbNeedsUpdate&&j.computeAABB(),nV(j.aabb.lowerBound.x,j.aabb.lowerBound.y,j.aabb.lowerBound.z,j.aabb.upperBound.x,j.aabb.upperBound.y,j.aabb.upperBound.z,j);break}}for(var z=0;z!==x;z++){var E=_[z];if(E>1)for(var WV=M[z],tV=0;tV!==E;tV++)for(var j=WV[tV],yV=0;yV!==tV;yV++){var bV=WV[yV];this.needBroadphaseCollision(j,bV)&&this.intersectionTest(j,bV,n,l)}}this.makePairsUnique(n,l)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(g,I,e){I.exports=A;var t=g("./Broadphase"),C=g("./AABB");function A(){t.apply(this)}A.prototype=new t,A.prototype.constructor=A,A.prototype.collisionPairs=function(s,a,o){var n=s.bodies,l=n.length,c,d,h,m;for(c=0;c!==l;c++)for(d=0;d!==c;d++)h=n[c],m=n[d],this.needBroadphaseCollision(h,m)&&this.intersectionTest(h,m,a,o)},new C,A.prototype.aabbQuery=function(s,a,o){o=o||[];for(var n=0;n<s.bodies.length;n++){var l=s.bodies[n];l.aabbNeedsUpdate&&l.computeAABB(),l.aabb.overlaps(a)&&o.push(l)}return o}},{"./AABB":3,"./Broadphase":5}],8:[function(g,I,e){I.exports=t;function t(){this.matrix={}}t.prototype.get=function(C,A){if(C=C.id,A=A.id,A>C){var s=A;A=C,C=s}return C+"-"+A in this.matrix},t.prototype.set=function(C,A,s){if(C=C.id,A=A.id,A>C){var a=A;A=C,C=a}s?this.matrix[C+"-"+A]=!0:delete this.matrix[C+"-"+A]},t.prototype.reset=function(){this.matrix={}},t.prototype.setNumObjects=function(C){}},{}],9:[function(g,I,e){I.exports=n;var t=g("../math/Vec3"),C=g("../math/Quaternion"),A=g("../math/Transform");g("../shapes/ConvexPolyhedron"),g("../shapes/Box");var s=g("../collision/RaycastResult"),a=g("../shapes/Shape"),o=g("../collision/AABB");function n(x,z){this.from=x?x.clone():new t,this.to=z?z.clone():new t,this._direction=new t,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=n.ANY,this.result=new s,this.hasHit=!1,this.callback=function(F){}}n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4;var l=new o,c=[];n.prototype.intersectWorld=function(x,z){return this.mode=z.mode||n.ANY,this.result=z.result||new s,this.skipBackfaces=!!z.skipBackfaces,this.collisionFilterMask=typeof z.collisionFilterMask!="undefined"?z.collisionFilterMask:-1,this.collisionFilterGroup=typeof z.collisionFilterGroup!="undefined"?z.collisionFilterGroup:-1,z.from&&this.from.copy(z.from),z.to&&this.to.copy(z.to),this.callback=z.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(l),c.length=0,x.broadphase.aabbQuery(x,l,c),this.intersectBodies(c),this.hasHit};var d=new t,h=new t;n.pointInTriangle=m;function m(x,z,F,k){k.vsub(z,$),F.vsub(z,d),x.vsub(z,h);var rV=$.dot($),nV=$.dot(d),j=$.dot(h),VV=d.dot(d),lV=d.dot(h),iV,CV;return(iV=VV*j-nV*lV)>=0&&(CV=rV*lV-nV*j)>=0&&iV+CV<rV*VV-nV*nV}var r=new t,u=new C;n.prototype.intersectBody=function(x,z){z&&(this.result=z,this._updateDirection());var F=this.checkCollisionResponse;if(!(F&&!x.collisionResponse)&&!((this.collisionFilterGroup&x.collisionFilterMask)===0||(x.collisionFilterGroup&this.collisionFilterMask)===0))for(var k=r,rV=u,nV=0,j=x.shapes.length;nV<j;nV++){var VV=x.shapes[nV];if(!(F&&!VV.collisionResponse)&&(x.quaternion.mult(x.shapeOrientations[nV],rV),x.quaternion.vmult(x.shapeOffsets[nV],k),k.vadd(x.position,k),this.intersectShape(VV,rV,k,x),this.result._shouldStop))break}},n.prototype.intersectBodies=function(x,z){z&&(this.result=z,this._updateDirection());for(var F=0,k=x.length;!this.result._shouldStop&&F<k;F++)this.intersectBody(x[F])},n.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},n.prototype.intersectShape=function(x,z,F,k){var rV=this.from,nV=_(rV,this._direction,F);if(!(nV>x.boundingSphereRadius)){var j=this[x.type];j&&j.call(this,x,z,F,k)}},new t,new t;var b=new t,Z=new t,p=new t,G=new t;new t,new s,n.prototype.intersectBox=function(x,z,F,k){return this.intersectConvex(x.convexPolyhedronRepresentation,z,F,k)},n.prototype[a.types.BOX]=n.prototype.intersectBox,n.prototype.intersectPlane=function(x,z,F,k){var rV=this.from,nV=this.to,j=this._direction,VV=new t(0,0,1);z.vmult(VV,VV);var lV=new t;rV.vsub(F,lV);var iV=lV.dot(VV);nV.vsub(F,lV);var CV=lV.dot(VV);if(!(iV*CV>0)&&!(rV.distanceTo(nV)<iV)){var AV=VV.dot(j);if(!(Math.abs(AV)<this.precision)){var gV=new t,eV=new t,K=new t;rV.vsub(F,gV);var w=-VV.dot(gV)/AV;j.scale(w,eV),rV.vadd(eV,K),this.reportIntersection(VV,K,x,k,-1)}}},n.prototype[a.types.PLANE]=n.prototype.intersectPlane,n.prototype.getAABB=function(x){var z=this.to,F=this.from;x.lowerBound.x=Math.min(z.x,F.x),x.lowerBound.y=Math.min(z.y,F.y),x.lowerBound.z=Math.min(z.z,F.z),x.upperBound.x=Math.max(z.x,F.x),x.upperBound.y=Math.max(z.y,F.y),x.upperBound.z=Math.max(z.z,F.z)};var X={faceList:[0]};n.prototype.intersectHeightfield=function(x,z,F,k){x.data,x.elementSize;var rV=new t,nV=new n(this.from,this.to);A.pointToLocalFrame(F,z,nV.from,nV.from),A.pointToLocalFrame(F,z,nV.to,nV.to);var j=[],VV=null,lV=null,iV=null,CV=null,AV=x.getIndexOfPosition(nV.from.x,nV.from.y,j,!1);if(AV&&(VV=j[0],lV=j[1],iV=j[0],CV=j[1]),AV=x.getIndexOfPosition(nV.to.x,nV.to.y,j,!1),AV&&((VV===null||j[0]<VV)&&(VV=j[0]),(iV===null||j[0]>iV)&&(iV=j[0]),(lV===null||j[1]<lV)&&(lV=j[1]),(CV===null||j[1]>CV)&&(CV=j[1])),VV!==null){var gV=[];x.getRectMinMax(VV,lV,iV,CV,gV),gV[0],gV[1];for(var eV=VV;eV<=iV;eV++)for(var K=lV;K<=CV;K++){if(this.result._shouldStop||(x.getConvexTrianglePillar(eV,K,!1),A.pointToWorldFrame(F,z,x.pillarOffset,rV),this.intersectConvex(x.pillarConvex,z,rV,k,X),this.result._shouldStop))return;x.getConvexTrianglePillar(eV,K,!0),A.pointToWorldFrame(F,z,x.pillarOffset,rV),this.intersectConvex(x.pillarConvex,z,rV,k,X)}}},n.prototype[a.types.HEIGHTFIELD]=n.prototype.intersectHeightfield;var W=new t,y=new t;n.prototype.intersectSphere=function(x,z,F,k){var rV=this.from,nV=this.to,j=x.radius,VV=Math.pow(nV.x-rV.x,2)+Math.pow(nV.y-rV.y,2)+Math.pow(nV.z-rV.z,2),lV=2*((nV.x-rV.x)*(rV.x-F.x)+(nV.y-rV.y)*(rV.y-F.y)+(nV.z-rV.z)*(rV.z-F.z)),iV=Math.pow(rV.x-F.x,2)+Math.pow(rV.y-F.y,2)+Math.pow(rV.z-F.z,2)-Math.pow(j,2),CV=Math.pow(lV,2)-4*VV*iV,AV=W,gV=y;if(!(CV<0))if(CV===0)rV.lerp(nV,CV,AV),AV.vsub(F,gV),gV.normalize(),this.reportIntersection(gV,AV,x,k,-1);else{var eV=(-lV-Math.sqrt(CV))/(2*VV),K=(-lV+Math.sqrt(CV))/(2*VV);if(eV>=0&&eV<=1&&(rV.lerp(nV,eV,AV),AV.vsub(F,gV),gV.normalize(),this.reportIntersection(gV,AV,x,k,-1)),this.result._shouldStop)return;K>=0&&K<=1&&(rV.lerp(nV,K,AV),AV.vsub(F,gV),gV.normalize(),this.reportIntersection(gV,AV,x,k,-1))}},n.prototype[a.types.SPHERE]=n.prototype.intersectSphere;var Y=new t;new t,new t;var f=new t;n.prototype.intersectConvex=function(z,F,k,rV,nV){for(var j=Y,VV=f,lV=nV&&nV.faceList||null,iV=z.faces,CV=z.vertices,AV=z.faceNormals,gV=this._direction,eV=this.from,K=this.to,w=eV.distanceTo(K),sV=lV?lV.length:iV.length,tV=this.result,BV=0;!tV._shouldStop&&BV<sV;BV++){var yV=lV?lV[BV]:BV,wV=iV[yV],fV=AV[yV],vV=F,YV=k;VV.copy(CV[wV[0]]),vV.vmult(VV,VV),VV.vadd(YV,VV),VV.vsub(eV,VV),vV.vmult(fV,j);var E=gV.dot(j);if(!(Math.abs(E)<this.precision)){var WV=j.dot(VV)/E;if(!(WV<0)){gV.mult(WV,b),b.vadd(eV,b),Z.copy(CV[wV[0]]),vV.vmult(Z,Z),YV.vadd(Z,Z);for(var bV=1;!tV._shouldStop&&bV<wV.length-1;bV++){p.copy(CV[wV[bV]]),G.copy(CV[wV[bV+1]]),vV.vmult(p,p),vV.vmult(G,G),YV.vadd(p,p),YV.vadd(G,G);var MV=b.distanceTo(eV);!(m(b,Z,p,G)||m(b,p,Z,G))||MV>w||this.reportIntersection(j,b,z,rV,yV)}}}}},n.prototype[a.types.CONVEXPOLYHEDRON]=n.prototype.intersectConvex;var L=new t,R=new t,J=new t,H=new t,N=new t,v=new t;new o;var T=[],D=new A;n.prototype.intersectTrimesh=function(z,F,k,rV,nV){var j=L,VV=T,lV=D,iV=f,CV=R,AV=J,gV=H,eV=v,K=N;nV&&nV.faceList;var w=z.indices;z.vertices,z.faceNormals;var sV=this.from,tV=this.to,BV=this._direction;lV.position.copy(k),lV.quaternion.copy(F),A.vectorToLocalFrame(k,F,BV,CV),A.pointToLocalFrame(k,F,sV,AV),A.pointToLocalFrame(k,F,tV,gV);var yV=AV.distanceSquared(gV);z.tree.rayQuery(this,lV,VV);for(var wV=0,fV=VV.length;!this.result._shouldStop&&wV!==fV;wV++){var vV=VV[wV];z.getNormal(vV,j),z.getVertex(w[vV*3],Z),Z.vsub(AV,iV);var YV=CV.dot(j),E=j.dot(iV)/YV;if(!(E<0)){CV.scale(E,b),b.vadd(AV,b),z.getVertex(w[vV*3+1],p),z.getVertex(w[vV*3+2],G);var WV=b.distanceSquared(AV);!(m(b,p,Z,G)||m(b,Z,p,G))||WV>yV||(A.vectorToWorldFrame(F,j,K),A.pointToWorldFrame(k,F,b,eV),this.reportIntersection(K,eV,z,rV,vV))}}VV.length=0},n.prototype[a.types.TRIMESH]=n.prototype.intersectTrimesh,n.prototype.reportIntersection=function(x,z,F,k,rV){var nV=this.from,j=this.to,VV=nV.distanceTo(z),lV=this.result;if(!(this.skipBackfaces&&x.dot(this._direction)>0))switch(lV.hitFaceIndex=typeof rV!="undefined"?rV:-1,this.mode){case n.ALL:this.hasHit=!0,lV.set(nV,j,x,z,F,k,VV),lV.hasHit=!0,this.callback(lV);break;case n.CLOSEST:(VV<lV.distance||!lV.hasHit)&&(this.hasHit=!0,lV.hasHit=!0,lV.set(nV,j,x,z,F,k,VV));break;case n.ANY:this.hasHit=!0,lV.hasHit=!0,lV.set(nV,j,x,z,F,k,VV),lV._shouldStop=!0;break}};var $=new t,M=new t;function _(x,z,F){F.vsub(x,$);var k=$.dot(z);z.mult(k,M),M.vadd(x,M);var rV=F.distanceTo(M);return rV}},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(g,I,e){var t=g("../math/Vec3");I.exports=C;function C(){this.rayFromWorld=new t,this.rayToWorld=new t,this.hitNormalWorld=new t,this.hitPointWorld=new t,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}C.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},C.prototype.abort=function(){this._shouldStop=!0},C.prototype.set=function(A,s,a,o,n,l,c){this.rayFromWorld.copy(A),this.rayToWorld.copy(s),this.hitNormalWorld.copy(a),this.hitPointWorld.copy(o),this.shape=n,this.body=l,this.distance=c}},{"../math/Vec3":30}],11:[function(g,I,e){g("../shapes/Shape");var t=g("../collision/Broadphase");I.exports=C;function C(A){t.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var s=this.axisList;this._addBodyHandler=function(a){s.push(a.body)},this._removeBodyHandler=function(a){var o=s.indexOf(a.body);o!==-1&&s.splice(o,1)},A&&this.setWorld(A)}C.prototype=new t,C.prototype.setWorld=function(A){this.axisList.length=0;for(var s=0;s<A.bodies.length;s++)this.axisList.push(A.bodies[s]);A.removeEventListener("addBody",this._addBodyHandler),A.removeEventListener("removeBody",this._removeBodyHandler),A.addEventListener("addBody",this._addBodyHandler),A.addEventListener("removeBody",this._removeBodyHandler),this.world=A,this.dirty=!0},C.insertionSortX=function(A){for(var s=1,a=A.length;s<a;s++){for(var o=A[s],n=s-1;n>=0&&!(A[n].aabb.lowerBound.x<=o.aabb.lowerBound.x);n--)A[n+1]=A[n];A[n+1]=o}return A},C.insertionSortY=function(A){for(var s=1,a=A.length;s<a;s++){for(var o=A[s],n=s-1;n>=0&&!(A[n].aabb.lowerBound.y<=o.aabb.lowerBound.y);n--)A[n+1]=A[n];A[n+1]=o}return A},C.insertionSortZ=function(A){for(var s=1,a=A.length;s<a;s++){for(var o=A[s],n=s-1;n>=0&&!(A[n].aabb.lowerBound.z<=o.aabb.lowerBound.z);n--)A[n+1]=A[n];A[n+1]=o}return A},C.prototype.collisionPairs=function(A,s,a){var o=this.axisList,n=o.length,l=this.axisIndex,c,d;for(this.dirty&&(this.sortList(),this.dirty=!1),c=0;c!==n;c++){var h=o[c];for(d=c+1;d<n;d++){var m=o[d];if(!!this.needBroadphaseCollision(h,m)){if(!C.checkBounds(h,m,l))break;this.intersectionTest(h,m,s,a)}}}},C.prototype.sortList=function(){for(var A=this.axisList,s=this.axisIndex,a=A.length,o=0;o!==a;o++){var n=A[o];n.aabbNeedsUpdate&&n.computeAABB()}s===0?C.insertionSortX(A):s===1?C.insertionSortY(A):s===2&&C.insertionSortZ(A)},C.checkBounds=function(A,s,a){var o,n;a===0?(o=A.position.x,n=s.position.x):a===1?(o=A.position.y,n=s.position.y):a===2&&(o=A.position.z,n=s.position.z);var l=A.boundingRadius,c=s.boundingRadius,d=o+l,h=n-c;return h<d},C.prototype.autoDetectAxis=function(){for(var A=0,s=0,a=0,o=0,n=0,l=0,c=this.axisList,d=c.length,h=1/d,m=0;m!==d;m++){var r=c[m],u=r.position.x;A+=u,s+=u*u;var b=r.position.y;a+=b,o+=b*b;var Z=r.position.z;n+=Z,l+=Z*Z}var p=s-A*A*h,G=o-a*a*h,X=l-n*n*h;p>G?p>X?this.axisIndex=0:this.axisIndex=2:G>X?this.axisIndex=1:this.axisIndex=2},C.prototype.aabbQuery=function(A,s,a){a=a||[],this.dirty&&(this.sortList(),this.dirty=!1);var o=this.axisIndex,n="x";o===1&&(n="y"),o===2&&(n="z");var l=this.axisList;s.lowerBound[n],s.upperBound[n];for(var c=0;c<l.length;c++){var d=l[c];d.aabbNeedsUpdate&&d.computeAABB(),d.aabb.overlaps(s)&&a.push(d)}return a}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(g,I,e){I.exports=a,g("./Constraint");var t=g("./PointToPointConstraint"),C=g("../equations/ConeEquation"),A=g("../equations/RotationalEquation");g("../equations/ContactEquation");var s=g("../math/Vec3");function a(o,n,l){l=l||{};var c=typeof l.maxForce!="undefined"?l.maxForce:1e6,d=l.pivotA?l.pivotA.clone():new s,h=l.pivotB?l.pivotB.clone():new s;this.axisA=l.axisA?l.axisA.clone():new s,this.axisB=l.axisB?l.axisB.clone():new s,t.call(this,o,d,n,h,c),this.collideConnected=!!l.collideConnected,this.angle=typeof l.angle!="undefined"?l.angle:0;var m=this.coneEquation=new C(o,n,l),r=this.twistEquation=new A(o,n,l);this.twistAngle=typeof l.twistAngle!="undefined"?l.twistAngle:0,m.maxForce=0,m.minForce=-c,r.maxForce=0,r.minForce=-c,this.equations.push(m,r)}a.prototype=new t,a.constructor=a,new s,new s,a.prototype.update=function(){var o=this.bodyA,n=this.bodyB,l=this.coneEquation,c=this.twistEquation;t.prototype.update.call(this),o.vectorToWorldFrame(this.axisA,l.axisA),n.vectorToWorldFrame(this.axisB,l.axisB),this.axisA.tangents(c.axisA,c.axisA),o.vectorToWorldFrame(c.axisA,c.axisA),this.axisB.tangents(c.axisB,c.axisB),n.vectorToWorldFrame(c.axisB,c.axisB),l.angle=this.angle,c.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(g,I,e){I.exports=C;var t=g("../utils/Utils");function C(A,s,a){a=t.defaults(a,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=A,this.bodyB=s,this.id=C.idCounter++,this.collideConnected=a.collideConnected,a.wakeUpBodies&&(A&&A.wakeUp(),s&&s.wakeUp())}C.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},C.prototype.enable=function(){for(var A=this.equations,s=0;s<A.length;s++)A[s].enabled=!0},C.prototype.disable=function(){for(var A=this.equations,s=0;s<A.length;s++)A[s].enabled=!1},C.idCounter=0},{"../utils/Utils":53}],14:[function(g,I,e){I.exports=A;var t=g("./Constraint"),C=g("../equations/ContactEquation");function A(s,a,o,n){t.call(this,s,a),typeof o=="undefined"&&(o=s.position.distanceTo(a.position)),typeof n=="undefined"&&(n=1e6),this.distance=o;var l=this.distanceEquation=new C(s,a);this.equations.push(l),l.minForce=-n,l.maxForce=n}A.prototype=new t,A.prototype.update=function(){var s=this.bodyA,a=this.bodyB,o=this.distanceEquation,n=this.distance*.5,l=o.ni;a.position.vsub(s.position,l),l.normalize(),l.mult(n,o.ri),l.mult(-n,o.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(g,I,e){I.exports=a,g("./Constraint");var t=g("./PointToPointConstraint"),C=g("../equations/RotationalEquation"),A=g("../equations/RotationalMotorEquation");g("../equations/ContactEquation");var s=g("../math/Vec3");function a(l,c,d){d=d||{};var h=typeof d.maxForce!="undefined"?d.maxForce:1e6,m=d.pivotA?d.pivotA.clone():new s,r=d.pivotB?d.pivotB.clone():new s;t.call(this,l,m,c,r,h);var u=this.axisA=d.axisA?d.axisA.clone():new s(1,0,0);u.normalize();var b=this.axisB=d.axisB?d.axisB.clone():new s(1,0,0);b.normalize();var Z=this.rotationalEquation1=new C(l,c,d),p=this.rotationalEquation2=new C(l,c,d),G=this.motorEquation=new A(l,c,h);G.enabled=!1,this.equations.push(Z,p,G)}a.prototype=new t,a.constructor=a,a.prototype.enableMotor=function(){this.motorEquation.enabled=!0},a.prototype.disableMotor=function(){this.motorEquation.enabled=!1},a.prototype.setMotorSpeed=function(l){this.motorEquation.targetVelocity=l},a.prototype.setMotorMaxForce=function(l){this.motorEquation.maxForce=l,this.motorEquation.minForce=-l};var o=new s,n=new s;a.prototype.update=function(){var l=this.bodyA,c=this.bodyB,d=this.motorEquation,h=this.rotationalEquation1,m=this.rotationalEquation2,r=o,u=n,b=this.axisA,Z=this.axisB;t.prototype.update.call(this),l.quaternion.vmult(b,r),c.quaternion.vmult(Z,u),r.tangents(h.axisA,m.axisA),h.axisB.copy(u),m.axisB.copy(u),this.motorEquation.enabled&&(l.quaternion.vmult(this.axisA,d.axisA),c.quaternion.vmult(this.axisB,d.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(g,I,e){I.exports=s,g("./Constraint");var t=g("./PointToPointConstraint"),C=g("../equations/RotationalEquation");g("../equations/RotationalMotorEquation"),g("../equations/ContactEquation");var A=g("../math/Vec3");function s(a,o,n){n=n||{};var l=typeof n.maxForce!="undefined"?n.maxForce:1e6,c=new A,d=new A,h=new A;a.position.vadd(o.position,h),h.scale(.5,h),o.pointToLocalFrame(h,d),a.pointToLocalFrame(h,c),t.call(this,a,c,o,d,l);var m=this.rotationalEquation1=new C(a,o,n),r=this.rotationalEquation2=new C(a,o,n),u=this.rotationalEquation3=new C(a,o,n);this.equations.push(m,r,u)}s.prototype=new t,s.constructor=s,new A,new A,s.prototype.update=function(){var a=this.bodyA,o=this.bodyB;this.motorEquation;var n=this.rotationalEquation1,l=this.rotationalEquation2,c=this.rotationalEquation3;t.prototype.update.call(this),a.vectorToWorldFrame(A.UNIT_X,n.axisA),o.vectorToWorldFrame(A.UNIT_Y,n.axisB),a.vectorToWorldFrame(A.UNIT_Y,l.axisA),o.vectorToWorldFrame(A.UNIT_Z,l.axisB),a.vectorToWorldFrame(A.UNIT_Z,c.axisA),o.vectorToWorldFrame(A.UNIT_X,c.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(g,I,e){I.exports=s;var t=g("./Constraint"),C=g("../equations/ContactEquation"),A=g("../math/Vec3");function s(a,o,n,l,c){t.call(this,a,n),c=typeof c!="undefined"?c:1e6,this.pivotA=o?o.clone():new A,this.pivotB=l?l.clone():new A;var d=this.equationX=new C(a,n),h=this.equationY=new C(a,n),m=this.equationZ=new C(a,n);this.equations.push(d,h,m),d.minForce=h.minForce=m.minForce=-c,d.maxForce=h.maxForce=m.maxForce=c,d.ni.set(1,0,0),h.ni.set(0,1,0),m.ni.set(0,0,1)}s.prototype=new t,s.prototype.update=function(){var a=this.bodyA,o=this.bodyB,n=this.equationX,l=this.equationY,c=this.equationZ;a.quaternion.vmult(this.pivotA,n.ri),o.quaternion.vmult(this.pivotB,n.rj),l.ri.copy(n.ri),l.rj.copy(n.rj),c.ri.copy(n.ri),c.rj.copy(n.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(g,I,e){I.exports=A;var t=g("../math/Vec3");g("../math/Mat3");var C=g("./Equation");function A(o,n,l){l=l||{};var c=typeof l.maxForce!="undefined"?l.maxForce:1e6;C.call(this,o,n,-c,c),this.axisA=l.axisA?l.axisA.clone():new t(1,0,0),this.axisB=l.axisB?l.axisB.clone():new t(0,1,0),this.angle=typeof l.angle!="undefined"?l.angle:0}A.prototype=new C,A.prototype.constructor=A;var s=new t,a=new t;A.prototype.computeB=function(o){var n=this.a,l=this.b,c=this.axisA,d=this.axisB,h=s,m=a,r=this.jacobianElementA,u=this.jacobianElementB;c.cross(d,h),d.cross(c,m),r.rotational.copy(m),u.rotational.copy(h);var b=Math.cos(this.angle)-c.dot(d),Z=this.computeGW(),p=this.computeGiMf(),G=-b*n-Z*l-o*p;return G}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(g,I,e){I.exports=A;var t=g("./Equation"),C=g("../math/Vec3");g("../math/Mat3");function A(m,r,u){u=typeof u!="undefined"?u:1e6,t.call(this,m,r,0,u),this.restitution=0,this.ri=new C,this.rj=new C,this.ni=new C}A.prototype=new t,A.prototype.constructor=A;var s=new C,a=new C,o=new C;A.prototype.computeB=function(m){var r=this.a,u=this.b,b=this.bi,Z=this.bj,p=this.ri,G=this.rj,X=s,W=a,y=b.velocity,Y=b.angularVelocity;b.force,b.torque;var f=Z.velocity,L=Z.angularVelocity;Z.force,Z.torque;var R=o,J=this.jacobianElementA,H=this.jacobianElementB,N=this.ni;p.cross(N,X),G.cross(N,W),N.negate(J.spatial),X.negate(J.rotational),H.spatial.copy(N),H.rotational.copy(W),R.copy(Z.position),R.vadd(G,R),R.vsub(b.position,R),R.vsub(p,R);var v=N.dot(R),T=this.restitution+1,D=T*f.dot(N)-T*y.dot(N)+L.dot(W)-Y.dot(X),$=this.computeGiMf(),M=-v*r-D*u-m*$;return M};var n=new C,l=new C,c=new C,d=new C,h=new C;A.prototype.getImpactVelocityAlongNormal=function(){var m=n,r=l,u=c,b=d,Z=h;return this.bi.position.vadd(this.ri,u),this.bj.position.vadd(this.rj,b),this.bi.getVelocityAtWorldPoint(u,m),this.bj.getVelocityAtWorldPoint(b,r),m.vsub(r,Z),this.ni.dot(Z)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(g,I,e){I.exports=A;var t=g("../math/JacobianElement"),C=g("../math/Vec3");function A(h,m,r,u){this.id=A.id++,this.minForce=typeof r=="undefined"?-1e6:r,this.maxForce=typeof u=="undefined"?1e6:u,this.bi=h,this.bj=m,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new t,this.jacobianElementB=new t,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}A.prototype.constructor=A,A.id=0,A.prototype.setSpookParams=function(h,m,r){var u=m,b=h,Z=r;this.a=4/(Z*(1+4*u)),this.b=4*u/(1+4*u),this.eps=4/(Z*Z*b*(1+4*u))},A.prototype.computeB=function(h,m,r){var u=this.computeGW(),b=this.computeGq(),Z=this.computeGiMf();return-b*h-u*m-Z*r},A.prototype.computeGq=function(){var h=this.jacobianElementA,m=this.jacobianElementB,r=this.bi,u=this.bj,b=r.position,Z=u.position;return h.spatial.dot(b)+m.spatial.dot(Z)};var s=new C;A.prototype.computeGW=function(){var h=this.jacobianElementA,m=this.jacobianElementB,r=this.bi,u=this.bj,b=r.velocity,Z=u.velocity,p=r.angularVelocity||s,G=u.angularVelocity||s;return h.multiplyVectors(b,p)+m.multiplyVectors(Z,G)},A.prototype.computeGWlambda=function(){var h=this.jacobianElementA,m=this.jacobianElementB,r=this.bi,u=this.bj,b=r.vlambda,Z=u.vlambda,p=r.wlambda||s,G=u.wlambda||s;return h.multiplyVectors(b,p)+m.multiplyVectors(Z,G)};var a=new C,o=new C,n=new C,l=new C;A.prototype.computeGiMf=function(){var h=this.jacobianElementA,m=this.jacobianElementB,r=this.bi,u=this.bj,b=r.force,Z=r.torque,p=u.force,G=u.torque,X=r.invMassSolve,W=u.invMassSolve;return r.invInertiaWorldSolve?r.invInertiaWorldSolve.vmult(Z,n):n.set(0,0,0),u.invInertiaWorldSolve?u.invInertiaWorldSolve.vmult(G,l):l.set(0,0,0),b.mult(X,a),p.mult(W,o),h.multiplyVectors(a,n)+m.multiplyVectors(o,l)};var c=new C;A.prototype.computeGiMGt=function(){var h=this.jacobianElementA,m=this.jacobianElementB,r=this.bi,u=this.bj,b=r.invMassSolve,Z=u.invMassSolve,p=r.invInertiaWorldSolve,G=u.invInertiaWorldSolve,X=b+Z;return p&&(p.vmult(h.rotational,c),X+=c.dot(h.rotational)),G&&(G.vmult(m.rotational,c),X+=c.dot(m.rotational)),X};var d=new C;new C,new C,new C,new C,new C,A.prototype.addToWlambda=function(h){var m=this.jacobianElementA,r=this.jacobianElementB,u=this.bi,b=this.bj,Z=d;m.spatial.mult(u.invMassSolve*h,Z),u.vlambda.vadd(Z,u.vlambda),r.spatial.mult(b.invMassSolve*h,Z),b.vlambda.vadd(Z,b.vlambda),u.invInertiaWorldSolve&&(u.invInertiaWorldSolve.vmult(m.rotational,Z),Z.mult(h,Z),u.wlambda.vadd(Z,u.wlambda)),b.invInertiaWorldSolve&&(b.invInertiaWorldSolve.vmult(r.rotational,Z),Z.mult(h,Z),b.wlambda.vadd(Z,b.wlambda))},A.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(g,I,e){I.exports=A;var t=g("./Equation"),C=g("../math/Vec3");g("../math/Mat3");function A(o,n,l){t.call(this,o,n,-l,l),this.ri=new C,this.rj=new C,this.t=new C}A.prototype=new t,A.prototype.constructor=A;var s=new C,a=new C;A.prototype.computeB=function(o){this.a;var n=this.b;this.bi,this.bj;var l=this.ri,c=this.rj,d=s,h=a,m=this.t;l.cross(m,d),c.cross(m,h);var r=this.jacobianElementA,u=this.jacobianElementB;m.negate(r.spatial),d.negate(r.rotational),u.spatial.copy(m),u.rotational.copy(h);var b=this.computeGW(),Z=this.computeGiMf(),p=-b*n-o*Z;return p}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(g,I,e){I.exports=A;var t=g("../math/Vec3");g("../math/Mat3");var C=g("./Equation");function A(o,n,l){l=l||{};var c=typeof l.maxForce!="undefined"?l.maxForce:1e6;C.call(this,o,n,-c,c),this.axisA=l.axisA?l.axisA.clone():new t(1,0,0),this.axisB=l.axisB?l.axisB.clone():new t(0,1,0),this.maxAngle=Math.PI/2}A.prototype=new C,A.prototype.constructor=A;var s=new t,a=new t;A.prototype.computeB=function(o){var n=this.a,l=this.b,c=this.axisA,d=this.axisB,h=s,m=a,r=this.jacobianElementA,u=this.jacobianElementB;c.cross(d,h),d.cross(c,m),r.rotational.copy(m),u.rotational.copy(h);var b=Math.cos(this.maxAngle)-c.dot(d),Z=this.computeGW(),p=this.computeGiMf(),G=-b*n-Z*l-o*p;return G}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(g,I,e){I.exports=A;var t=g("../math/Vec3");g("../math/Mat3");var C=g("./Equation");function A(s,a,o){o=typeof o!="undefined"?o:1e6,C.call(this,s,a,-o,o),this.axisA=new t,this.axisB=new t,this.targetVelocity=0}A.prototype=new C,A.prototype.constructor=A,A.prototype.computeB=function(s){this.a;var a=this.b;this.bi,this.bj;var o=this.axisA,n=this.axisB,l=this.jacobianElementA,c=this.jacobianElementB;l.rotational.copy(o),n.negate(c.rotational);var d=this.computeGW()-this.targetVelocity,h=this.computeGiMf(),m=-d*a-s*h;return m}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(g,I,e){var t=g("../utils/Utils");I.exports=C;function C(A,s,a){a=t.defaults(a,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=C.idCounter++,this.materials=[A,s],this.friction=a.friction,this.restitution=a.restitution,this.contactEquationStiffness=a.contactEquationStiffness,this.contactEquationRelaxation=a.contactEquationRelaxation,this.frictionEquationStiffness=a.frictionEquationStiffness,this.frictionEquationRelaxation=a.frictionEquationRelaxation}C.idCounter=0},{"../utils/Utils":53}],25:[function(g,I,e){I.exports=t;function t(C){var A="";C=C||{},typeof C=="string"?(A=C,C={}):typeof C=="object"&&(A=""),this.name=A,this.id=t.idCounter++,this.friction=typeof C.friction!="undefined"?C.friction:-1,this.restitution=typeof C.restitution!="undefined"?C.restitution:-1}t.idCounter=0},{}],26:[function(g,I,e){I.exports=C;var t=g("./Vec3");function C(){this.spatial=new t,this.rotational=new t}C.prototype.multiplyElement=function(A){return A.spatial.dot(this.spatial)+A.rotational.dot(this.rotational)},C.prototype.multiplyVectors=function(A,s){return A.dot(this.spatial)+s.dot(this.rotational)}},{"./Vec3":30}],27:[function(g,I,e){I.exports=C;var t=g("./Vec3");function C(A){A?this.elements=A:this.elements=[0,0,0,0,0,0,0,0,0]}C.prototype.identity=function(){var A=this.elements;A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=1,A[5]=0,A[6]=0,A[7]=0,A[8]=1},C.prototype.setZero=function(){var A=this.elements;A[0]=0,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=0,A[6]=0,A[7]=0,A[8]=0},C.prototype.setTrace=function(A){var s=this.elements;s[0]=A.x,s[4]=A.y,s[8]=A.z},C.prototype.getTrace=function(s){var s=s||new t,a=this.elements;s.x=a[0],s.y=a[4],s.z=a[8]},C.prototype.vmult=function(A,s){s=s||new t;var a=this.elements,o=A.x,n=A.y,l=A.z;return s.x=a[0]*o+a[1]*n+a[2]*l,s.y=a[3]*o+a[4]*n+a[5]*l,s.z=a[6]*o+a[7]*n+a[8]*l,s},C.prototype.smult=function(A){for(var s=0;s<this.elements.length;s++)this.elements[s]*=A},C.prototype.mmult=function(A,s){for(var a=s||new C,o=0;o<3;o++)for(var n=0;n<3;n++){for(var l=0,c=0;c<3;c++)l+=A.elements[o+c*3]*this.elements[c+n*3];a.elements[o+n*3]=l}return a},C.prototype.scale=function(A,s){s=s||new C;for(var a=this.elements,o=s.elements,n=0;n!==3;n++)o[3*n+0]=A.x*a[3*n+0],o[3*n+1]=A.y*a[3*n+1],o[3*n+2]=A.z*a[3*n+2];return s},C.prototype.solve=function(A,s){s=s||new t;for(var a=3,o=4,n=[],l=0;l<a*o;l++)n.push(0);var l,c;for(l=0;l<3;l++)for(c=0;c<3;c++)n[l+o*c]=this.elements[l+3*c];n[3+4*0]=A.x,n[3+4*1]=A.y,n[3+4*2]=A.z;var d=3,h=d,m,r=4,u;do{if(l=h-d,n[l+o*l]===0){for(c=l+1;c<h;c++)if(n[l+o*c]!==0){m=r;do u=r-m,n[u+o*l]+=n[u+o*c];while(--m);break}}if(n[l+o*l]!==0)for(c=l+1;c<h;c++){var b=n[l+o*c]/n[l+o*l];m=r;do u=r-m,n[u+o*c]=u<=l?0:n[u+o*c]-n[u+o*l]*b;while(--m)}}while(--d);if(s.z=n[2*o+3]/n[2*o+2],s.y=(n[1*o+3]-n[1*o+2]*s.z)/n[1*o+1],s.x=(n[0*o+3]-n[0*o+2]*s.z-n[0*o+1]*s.y)/n[0*o+0],isNaN(s.x)||isNaN(s.y)||isNaN(s.z)||s.x===1/0||s.y===1/0||s.z===1/0)throw"Could not solve equation! Got x=["+s.toString()+"], b=["+A.toString()+"], A=["+this.toString()+"]";return s},C.prototype.e=function(A,s,a){if(a===void 0)return this.elements[s+3*A];this.elements[s+3*A]=a},C.prototype.copy=function(A){for(var s=0;s<A.elements.length;s++)this.elements[s]=A.elements[s];return this},C.prototype.toString=function(){for(var A="",s=",",a=0;a<9;a++)A+=this.elements[a]+s;return A},C.prototype.reverse=function(A){A=A||new C;for(var s=3,a=6,o=[],n=0;n<s*a;n++)o.push(0);var n,l;for(n=0;n<3;n++)for(l=0;l<3;l++)o[n+a*l]=this.elements[n+3*l];o[3+6*0]=1,o[3+6*1]=0,o[3+6*2]=0,o[4+6*0]=0,o[4+6*1]=1,o[4+6*2]=0,o[5+6*0]=0,o[5+6*1]=0,o[5+6*2]=1;var c=3,d=c,h,m=a,r;do{if(n=d-c,o[n+a*n]===0){for(l=n+1;l<d;l++)if(o[n+a*l]!==0){h=m;do r=m-h,o[r+a*n]+=o[r+a*l];while(--h);break}}if(o[n+a*n]!==0)for(l=n+1;l<d;l++){var u=o[n+a*l]/o[n+a*n];h=m;do r=m-h,o[r+a*l]=r<=n?0:o[r+a*l]-o[r+a*n]*u;while(--h)}}while(--c);n=2;do{l=n-1;do{var u=o[n+a*l]/o[n+a*n];h=a;do r=a-h,o[r+a*l]=o[r+a*l]-o[r+a*n]*u;while(--h)}while(l--)}while(--n);n=2;do{var u=1/o[n+a*n];h=a;do r=a-h,o[r+a*n]=o[r+a*n]*u;while(--h)}while(n--);n=2;do{l=2;do{if(r=o[s+l+a*n],isNaN(r)||r===1/0)throw"Could not reverse! A=["+this.toString()+"]";A.e(n,l,r)}while(l--)}while(n--);return A},C.prototype.setRotationFromQuaternion=function(A){var s=A.x,a=A.y,o=A.z,n=A.w,l=s+s,c=a+a,d=o+o,h=s*l,m=s*c,r=s*d,u=a*c,b=a*d,Z=o*d,p=n*l,G=n*c,X=n*d,W=this.elements;return W[3*0+0]=1-(u+Z),W[3*0+1]=m-X,W[3*0+2]=r+G,W[3*1+0]=m+X,W[3*1+1]=1-(h+Z),W[3*1+2]=b-p,W[3*2+0]=r-G,W[3*2+1]=b+p,W[3*2+2]=1-(h+u),this},C.prototype.transpose=function(A){A=A||new C;for(var s=A.elements,a=this.elements,o=0;o!==3;o++)for(var n=0;n!==3;n++)s[3*o+n]=a[3*n+o];return A}},{"./Vec3":30}],28:[function(g,I,e){I.exports=C;var t=g("./Vec3");function C(l,c,d,h){this.x=l!==void 0?l:0,this.y=c!==void 0?c:0,this.z=d!==void 0?d:0,this.w=h!==void 0?h:1}C.prototype.set=function(l,c,d,h){this.x=l,this.y=c,this.z=d,this.w=h},C.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},C.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},C.prototype.setFromAxisAngle=function(l,c){var d=Math.sin(c*.5);this.x=l.x*d,this.y=l.y*d,this.z=l.z*d,this.w=Math.cos(c*.5)},C.prototype.toAxisAngle=function(l){l=l||new t,this.normalize();var c=2*Math.acos(this.w),d=Math.sqrt(1-this.w*this.w);return d<.001?(l.x=this.x,l.y=this.y,l.z=this.z):(l.x=this.x/d,l.y=this.y/d,l.z=this.z/d),[l,c]};var A=new t,s=new t;C.prototype.setFromVectors=function(l,c){if(l.isAntiparallelTo(c)){var d=A,h=s;l.tangents(d,h),this.setFromAxisAngle(d,Math.PI)}else{var m=l.cross(c);this.x=m.x,this.y=m.y,this.z=m.z,this.w=Math.sqrt(Math.pow(l.norm(),2)*Math.pow(c.norm(),2))+l.dot(c),this.normalize()}};var a=new t,o=new t,n=new t;C.prototype.mult=function(l,c){c=c||new C;var d=this.w,h=a,m=o,r=n;return h.set(this.x,this.y,this.z),m.set(l.x,l.y,l.z),c.w=d*l.w-h.dot(m),h.cross(m,r),c.x=d*m.x+l.w*h.x+r.x,c.y=d*m.y+l.w*h.y+r.y,c.z=d*m.z+l.w*h.z+r.z,c},C.prototype.inverse=function(l){var c=this.x,d=this.y,h=this.z,m=this.w;l=l||new C,this.conjugate(l);var r=1/(c*c+d*d+h*h+m*m);return l.x*=r,l.y*=r,l.z*=r,l.w*=r,l},C.prototype.conjugate=function(l){return l=l||new C,l.x=-this.x,l.y=-this.y,l.z=-this.z,l.w=this.w,l},C.prototype.normalize=function(){var l=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);l===0?(this.x=0,this.y=0,this.z=0,this.w=0):(l=1/l,this.x*=l,this.y*=l,this.z*=l,this.w*=l)},C.prototype.normalizeFast=function(){var l=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;l===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=l,this.y*=l,this.z*=l,this.w*=l)},C.prototype.vmult=function(l,c){c=c||new t;var d=l.x,h=l.y,m=l.z,r=this.x,u=this.y,b=this.z,Z=this.w,p=Z*d+u*m-b*h,G=Z*h+b*d-r*m,X=Z*m+r*h-u*d,W=-r*d-u*h-b*m;return c.x=p*Z+W*-r+G*-b-X*-u,c.y=G*Z+W*-u+X*-r-p*-b,c.z=X*Z+W*-b+p*-u-G*-r,c},C.prototype.copy=function(l){return this.x=l.x,this.y=l.y,this.z=l.z,this.w=l.w,this},C.prototype.toEuler=function(l,c){c=c||"YZX";var d,h,m,r=this.x,u=this.y,b=this.z,Z=this.w;switch(c){case"YZX":var p=r*u+b*Z;if(p>.499&&(d=2*Math.atan2(r,Z),h=Math.PI/2,m=0),p<-.499&&(d=-2*Math.atan2(r,Z),h=-Math.PI/2,m=0),isNaN(d)){var G=r*r,X=u*u,W=b*b;d=Math.atan2(2*u*Z-2*r*b,1-2*X-2*W),h=Math.asin(2*p),m=Math.atan2(2*r*Z-2*u*b,1-2*G-2*W)}break;default:throw new Error("Euler order "+c+" not supported yet.")}l.y=d,l.z=h,l.x=m},C.prototype.setFromEuler=function(l,c,d,h){h=h||"XYZ";var m=Math.cos(l/2),r=Math.cos(c/2),u=Math.cos(d/2),b=Math.sin(l/2),Z=Math.sin(c/2),p=Math.sin(d/2);return h==="XYZ"?(this.x=b*r*u+m*Z*p,this.y=m*Z*u-b*r*p,this.z=m*r*p+b*Z*u,this.w=m*r*u-b*Z*p):h==="YXZ"?(this.x=b*r*u+m*Z*p,this.y=m*Z*u-b*r*p,this.z=m*r*p-b*Z*u,this.w=m*r*u+b*Z*p):h==="ZXY"?(this.x=b*r*u-m*Z*p,this.y=m*Z*u+b*r*p,this.z=m*r*p+b*Z*u,this.w=m*r*u-b*Z*p):h==="ZYX"?(this.x=b*r*u-m*Z*p,this.y=m*Z*u+b*r*p,this.z=m*r*p-b*Z*u,this.w=m*r*u+b*Z*p):h==="YZX"?(this.x=b*r*u+m*Z*p,this.y=m*Z*u+b*r*p,this.z=m*r*p-b*Z*u,this.w=m*r*u-b*Z*p):h==="XZY"&&(this.x=b*r*u-m*Z*p,this.y=m*Z*u-b*r*p,this.z=m*r*p+b*Z*u,this.w=m*r*u+b*Z*p),this},C.prototype.clone=function(){return new C(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(g,I,e){var t=g("./Vec3"),C=g("./Quaternion");I.exports=A;function A(a){a=a||{},this.position=new t,a.position&&this.position.copy(a.position),this.quaternion=new C,a.quaternion&&this.quaternion.copy(a.quaternion)}var s=new C;A.pointToLocalFrame=function(a,o,n,c){var c=c||new t;return n.vsub(a,c),o.conjugate(s),s.vmult(c,c),c},A.prototype.pointToLocal=function(a,o){return A.pointToLocalFrame(this.position,this.quaternion,a,o)},A.pointToWorldFrame=function(a,o,n,c){var c=c||new t;return o.vmult(n,c),c.vadd(a,c),c},A.prototype.pointToWorld=function(a,o){return A.pointToWorldFrame(this.position,this.quaternion,a,o)},A.prototype.vectorToWorldFrame=function(a,n){var n=n||new t;return this.quaternion.vmult(a,n),n},A.vectorToWorldFrame=function(a,o,n){return a.vmult(o,n),n},A.vectorToLocalFrame=function(a,o,n,c){var c=c||new t;return o.w*=-1,o.vmult(n,c),o.w*=-1,c}},{"./Quaternion":28,"./Vec3":30}],30:[function(g,I,e){I.exports=C;var t=g("./Mat3");function C(o,n,l){this.x=o||0,this.y=n||0,this.z=l||0}C.ZERO=new C(0,0,0),C.UNIT_X=new C(1,0,0),C.UNIT_Y=new C(0,1,0),C.UNIT_Z=new C(0,0,1),C.prototype.cross=function(o,n){var l=o.x,c=o.y,d=o.z,h=this.x,m=this.y,r=this.z;return n=n||new C,n.x=m*d-r*c,n.y=r*l-h*d,n.z=h*c-m*l,n},C.prototype.set=function(o,n,l){return this.x=o,this.y=n,this.z=l,this},C.prototype.setZero=function(){this.x=this.y=this.z=0},C.prototype.vadd=function(o,n){if(n)n.x=o.x+this.x,n.y=o.y+this.y,n.z=o.z+this.z;else return new C(this.x+o.x,this.y+o.y,this.z+o.z)},C.prototype.vsub=function(o,n){if(n)n.x=this.x-o.x,n.y=this.y-o.y,n.z=this.z-o.z;else return new C(this.x-o.x,this.y-o.y,this.z-o.z)},C.prototype.crossmat=function(){return new t([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},C.prototype.normalize=function(){var o=this.x,n=this.y,l=this.z,c=Math.sqrt(o*o+n*n+l*l);if(c>0){var d=1/c;this.x*=d,this.y*=d,this.z*=d}else this.x=0,this.y=0,this.z=0;return c},C.prototype.unit=function(o){o=o||new C;var n=this.x,l=this.y,c=this.z,d=Math.sqrt(n*n+l*l+c*c);return d>0?(d=1/d,o.x=n*d,o.y=l*d,o.z=c*d):(o.x=1,o.y=0,o.z=0),o},C.prototype.norm=function(){var o=this.x,n=this.y,l=this.z;return Math.sqrt(o*o+n*n+l*l)},C.prototype.length=C.prototype.norm,C.prototype.norm2=function(){return this.dot(this)},C.prototype.lengthSquared=C.prototype.norm2,C.prototype.distanceTo=function(o){var n=this.x,l=this.y,c=this.z,d=o.x,h=o.y,m=o.z;return Math.sqrt((d-n)*(d-n)+(h-l)*(h-l)+(m-c)*(m-c))},C.prototype.distanceSquared=function(o){var n=this.x,l=this.y,c=this.z,d=o.x,h=o.y,m=o.z;return(d-n)*(d-n)+(h-l)*(h-l)+(m-c)*(m-c)},C.prototype.mult=function(o,n){n=n||new C;var l=this.x,c=this.y,d=this.z;return n.x=o*l,n.y=o*c,n.z=o*d,n},C.prototype.scale=C.prototype.mult,C.prototype.dot=function(o){return this.x*o.x+this.y*o.y+this.z*o.z},C.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0},C.prototype.negate=function(o){return o=o||new C,o.x=-this.x,o.y=-this.y,o.z=-this.z,o};var A=new C,s=new C;C.prototype.tangents=function(o,n){var l=this.norm();if(l>0){var c=A,d=1/l;c.set(this.x*d,this.y*d,this.z*d);var h=s;Math.abs(c.x)<.9?(h.set(1,0,0),c.cross(h,o)):(h.set(0,1,0),c.cross(h,o)),c.cross(o,n)}else o.set(1,0,0),n.set(0,1,0)},C.prototype.toString=function(){return this.x+","+this.y+","+this.z},C.prototype.toArray=function(){return[this.x,this.y,this.z]},C.prototype.copy=function(o){return this.x=o.x,this.y=o.y,this.z=o.z,this},C.prototype.lerp=function(o,n,l){var c=this.x,d=this.y,h=this.z;l.x=c+(o.x-c)*n,l.y=d+(o.y-d)*n,l.z=h+(o.z-h)*n},C.prototype.almostEquals=function(o,n){return n===void 0&&(n=1e-6),!(Math.abs(this.x-o.x)>n||Math.abs(this.y-o.y)>n||Math.abs(this.z-o.z)>n)},C.prototype.almostZero=function(o){return o===void 0&&(o=1e-6),!(Math.abs(this.x)>o||Math.abs(this.y)>o||Math.abs(this.z)>o)};var a=new C;C.prototype.isAntiparallelTo=function(o,n){return this.negate(a),a.almostEquals(o,n)},C.prototype.clone=function(){return new C(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(g,I,e){I.exports=n;var t=g("../utils/EventTarget");g("../shapes/Shape");var C=g("../math/Vec3"),A=g("../math/Mat3"),s=g("../math/Quaternion");g("../material/Material");var a=g("../collision/AABB"),o=g("../shapes/Box");function n(f){f=f||{},t.apply(this),this.id=n.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new C,this.collisionFilterGroup=typeof f.collisionFilterGroup=="number"?f.collisionFilterGroup:1,this.collisionFilterMask=typeof f.collisionFilterMask=="number"?f.collisionFilterMask:1,this.collisionResponse=!0,this.position=new C,f.position&&this.position.copy(f.position),this.previousPosition=new C,this.initPosition=new C,this.velocity=new C,f.velocity&&this.velocity.copy(f.velocity),this.initVelocity=new C,this.force=new C;var L=typeof f.mass=="number"?f.mass:0;this.mass=L,this.invMass=L>0?1/L:0,this.material=f.material||null,this.linearDamping=typeof f.linearDamping=="number"?f.linearDamping:.01,this.type=L<=0?n.STATIC:n.DYNAMIC,typeof f.type==typeof n.STATIC&&(this.type=f.type),this.allowSleep=typeof f.allowSleep!="undefined"?f.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit=typeof f.sleepSpeedLimit!="undefined"?f.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof f.sleepTimeLimit!="undefined"?f.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new C,this.quaternion=new s,f.quaternion&&this.quaternion.copy(f.quaternion),this.initQuaternion=new s,this.angularVelocity=new C,f.angularVelocity&&this.angularVelocity.copy(f.angularVelocity),this.initAngularVelocity=new C,this.interpolatedPosition=new C,this.interpolatedQuaternion=new s,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new C,this.invInertia=new C,this.invInertiaWorld=new A,this.invMassSolve=0,this.invInertiaSolve=new C,this.invInertiaWorldSolve=new A,this.fixedRotation=typeof f.fixedRotation!="undefined"?f.fixedRotation:!1,this.angularDamping=typeof f.angularDamping!="undefined"?f.angularDamping:.01,this.aabb=new a,this.aabbNeedsUpdate=!0,this.wlambda=new C,f.shape&&this.addShape(f.shape),this.updateMassProperties()}n.prototype=new t,n.prototype.constructor=n,n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2,n.idCounter=0,n.prototype.wakeUp=function(){var f=this.sleepState;this.sleepState=0,f===n.SLEEPING&&this.dispatchEvent({type:"wakeup"})},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.prototype.sleepTick=function(f){if(this.allowSleep){var L=this.sleepState,R=this.velocity.norm2()+this.angularVelocity.norm2(),J=Math.pow(this.sleepSpeedLimit,2);L===n.AWAKE&&R<J?(this.sleepState=n.SLEEPY,this.timeLastSleepy=f,this.dispatchEvent(n.sleepyEvent)):L===n.SLEEPY&&R>J?this.wakeUp():L===n.SLEEPY&&f-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}},n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},n.prototype.pointToLocalFrame=function(f,R){var R=R||new C;return f.vsub(this.position,R),this.quaternion.conjugate().vmult(R,R),R},n.prototype.vectorToLocalFrame=function(f,R){var R=R||new C;return this.quaternion.conjugate().vmult(f,R),R},n.prototype.pointToWorldFrame=function(f,R){var R=R||new C;return this.quaternion.vmult(f,R),R.vadd(this.position,R),R},n.prototype.vectorToWorldFrame=function(f,R){var R=R||new C;return this.quaternion.vmult(f,R),R};var l=new C,c=new s;n.prototype.addShape=function(f,L,R){var J=new C,H=new s;return L&&J.copy(L),R&&H.copy(R),this.shapes.push(f),this.shapeOffsets.push(J),this.shapeOrientations.push(H),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},n.prototype.updateBoundingRadius=function(){for(var f=this.shapes,L=this.shapeOffsets,R=f.length,J=0,H=0;H!==R;H++){var N=f[H];N.updateBoundingSphereRadius();var v=L[H].norm(),T=N.boundingSphereRadius;v+T>J&&(J=v+T)}this.boundingRadius=J};var d=new a;n.prototype.computeAABB=function(){for(var f=this.shapes,L=this.shapeOffsets,R=this.shapeOrientations,J=f.length,H=l,N=c,v=this.quaternion,T=this.aabb,D=d,$=0;$!==J;$++){var M=f[$];R[$].mult(v,N),N.vmult(L[$],H),H.vadd(this.position,H),M.calculateWorldAABB(H,N,D.lowerBound,D.upperBound),$===0?T.copy(D):T.extend(D)}this.aabbNeedsUpdate=!1};var h=new A,m=new A;new A,n.prototype.updateInertiaWorld=function(f){var L=this.invInertia;if(!(L.x===L.y&&L.y===L.z&&!f)){var R=h,J=m;R.setRotationFromQuaternion(this.quaternion),R.transpose(J),R.scale(L,R),R.mmult(J,this.invInertiaWorld)}};var r=new C,u=new C;n.prototype.applyForce=function(f,L){if(this.type===n.DYNAMIC){var R=r;L.vsub(this.position,R);var J=u;R.cross(f,J),this.force.vadd(f,this.force),this.torque.vadd(J,this.torque)}};var b=new C,Z=new C;n.prototype.applyLocalForce=function(f,L){if(this.type===n.DYNAMIC){var R=b,J=Z;this.vectorToWorldFrame(f,R),this.pointToWorldFrame(L,J),this.applyForce(R,J)}};var p=new C,G=new C,X=new C;n.prototype.applyImpulse=function(f,L){if(this.type===n.DYNAMIC){var R=p;L.vsub(this.position,R);var J=G;J.copy(f),J.mult(this.invMass,J),this.velocity.vadd(J,this.velocity);var H=X;R.cross(f,H),this.invInertiaWorld.vmult(H,H),this.angularVelocity.vadd(H,this.angularVelocity)}};var W=new C,y=new C;n.prototype.applyLocalImpulse=function(f,L){if(this.type===n.DYNAMIC){var R=W,J=y;this.vectorToWorldFrame(f,R),this.pointToWorldFrame(L,J),this.applyImpulse(R,J)}};var Y=new C;n.prototype.updateMassProperties=function(){var f=Y;this.invMass=this.mass>0?1/this.mass:0;var L=this.inertia,R=this.fixedRotation;this.computeAABB(),f.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),o.calculateInertia(f,this.mass,L),this.invInertia.set(L.x>0&&!R?1/L.x:0,L.y>0&&!R?1/L.y:0,L.z>0&&!R?1/L.z:0),this.updateInertiaWorld(!0)},n.prototype.getVelocityAtWorldPoint=function(f,L){var R=new C;return f.vsub(this.position,R),this.angularVelocity.cross(R,L),this.velocity.vadd(L,L),L}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(g,I,e){g("./Body");var t=g("../math/Vec3"),C=g("../math/Quaternion");g("../collision/RaycastResult");var A=g("../collision/Ray"),s=g("../objects/WheelInfo");I.exports=a;function a(v){this.chassisBody=v.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=typeof v.indexRightAxis!="undefined"?v.indexRightAxis:1,this.indexForwardAxis=typeof v.indexForwardAxis!="undefined"?v.indexForwardAxis:0,this.indexUpAxis=typeof v.indexUpAxis!="undefined"?v.indexUpAxis:2}new t,new t,new t;var o=new t,n=new t,l=new t;new A,a.prototype.addWheel=function(v){v=v||{};var T=new s(v),D=this.wheelInfos.length;return this.wheelInfos.push(T),D},a.prototype.setSteeringValue=function(v,T){var D=this.wheelInfos[T];D.steering=v},new t,a.prototype.applyEngineForce=function(v,T){this.wheelInfos[T].engineForce=v},a.prototype.setBrake=function(v,T){this.wheelInfos[T].brake=v},a.prototype.addToWorld=function(v){this.constraints,v.add(this.chassisBody);var T=this;this.preStepCallback=function(){T.updateVehicle(v.dt)},v.addEventListener("preStep",this.preStepCallback),this.world=v},a.prototype.getVehicleAxisWorld=function(v,T){T.set(v===0?1:0,v===1?1:0,v===2?1:0),this.chassisBody.vectorToWorldFrame(T,T)},a.prototype.updateVehicle=function(v){for(var T=this.wheelInfos,D=T.length,$=this.chassisBody,M=0;M<D;M++)this.updateWheelTransform(M);this.currentVehicleSpeedKmHour=3.6*$.velocity.norm();var _=new t;this.getVehicleAxisWorld(this.indexForwardAxis,_),_.dot($.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var M=0;M<D;M++)this.castRay(T[M]);this.updateSuspension(v);for(var x=new t,z=new t,M=0;M<D;M++){var F=T[M],k=F.suspensionForce;k>F.maxSuspensionForce&&(k=F.maxSuspensionForce),F.raycastResult.hitNormalWorld.scale(k*v,x),F.raycastResult.hitPointWorld.vsub($.position,z),$.applyImpulse(x,F.raycastResult.hitPointWorld)}this.updateFriction(v);var rV=new t,nV=new t,j=new t;for(M=0;M<D;M++){var F=T[M];$.getVelocityAtWorldPoint(F.chassisConnectionPointWorld,j);var VV=1;switch(this.indexUpAxis){case 1:VV=-1;break}if(F.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,nV);var lV=nV.dot(F.raycastResult.hitNormalWorld);F.raycastResult.hitNormalWorld.scale(lV,rV),nV.vsub(rV,nV);var iV=nV.dot(j);F.deltaRotation=VV*iV*v/F.radius}(F.sliding||!F.isInContact)&&F.engineForce!==0&&F.useCustomSlidingRotationalSpeed&&(F.deltaRotation=(F.engineForce>0?1:-1)*F.customSlidingRotationalSpeed*v),Math.abs(F.brake)>Math.abs(F.engineForce)&&(F.deltaRotation=0),F.rotation+=F.deltaRotation,F.deltaRotation*=.99}},a.prototype.updateSuspension=function(v){for(var T=this.chassisBody,D=T.mass,$=this.wheelInfos,M=$.length,_=0;_<M;_++){var x=$[_];if(x.isInContact){var z,F=x.suspensionRestLength,k=x.suspensionLength,rV=F-k;z=x.suspensionStiffness*rV*x.clippedInvContactDotSuspension;var nV=x.suspensionRelativeVelocity,j;nV<0?j=x.dampingCompression:j=x.dampingRelaxation,z-=j*nV,x.suspensionForce=z*D,x.suspensionForce<0&&(x.suspensionForce=0)}else x.suspensionForce=0}},a.prototype.removeFromWorld=function(v){this.constraints,v.remove(this.chassisBody),v.removeEventListener("preStep",this.preStepCallback),this.world=null};var c=new t,d=new t;a.prototype.castRay=function(v){var T=c,D=d;this.updateWheelTransformWorld(v);var $=this.chassisBody,M=-1,_=v.suspensionRestLength+v.radius;v.directionWorld.scale(_,T);var x=v.chassisConnectionPointWorld;x.vadd(T,D);var z=v.raycastResult;z.reset();var F=$.collisionResponse;$.collisionResponse=!1,this.world.rayTest(x,D,z),$.collisionResponse=F;var k=z.body;if(v.raycastResult.groundObject=0,k){M=z.distance,v.raycastResult.hitNormalWorld=z.hitNormalWorld,v.isInContact=!0;var rV=z.distance;v.suspensionLength=rV-v.radius;var nV=v.suspensionRestLength-v.maxSuspensionTravel,j=v.suspensionRestLength+v.maxSuspensionTravel;v.suspensionLength<nV&&(v.suspensionLength=nV),v.suspensionLength>j&&(v.suspensionLength=j,v.raycastResult.reset());var VV=v.raycastResult.hitNormalWorld.dot(v.directionWorld),lV=new t;$.getVelocityAtWorldPoint(v.raycastResult.hitPointWorld,lV);var iV=v.raycastResult.hitNormalWorld.dot(lV);if(VV>=-.1)v.suspensionRelativeVelocity=0,v.clippedInvContactDotSuspension=1/.1;else{var CV=-1/VV;v.suspensionRelativeVelocity=iV*CV,v.clippedInvContactDotSuspension=CV}}else v.suspensionLength=v.suspensionRestLength+0*v.maxSuspensionTravel,v.suspensionRelativeVelocity=0,v.directionWorld.scale(-1,v.raycastResult.hitNormalWorld),v.clippedInvContactDotSuspension=1;return M},a.prototype.updateWheelTransformWorld=function(v){v.isInContact=!1;var T=this.chassisBody;T.pointToWorldFrame(v.chassisConnectionPointLocal,v.chassisConnectionPointWorld),T.vectorToWorldFrame(v.directionLocal,v.directionWorld),T.vectorToWorldFrame(v.axleLocal,v.axleWorld)},a.prototype.updateWheelTransform=function(v){var T=o,D=n,$=l,M=this.wheelInfos[v];this.updateWheelTransformWorld(M),M.directionLocal.scale(-1,T),D.copy(M.axleLocal),T.cross(D,$),$.normalize(),D.normalize();var _=M.steering,x=new C;x.setFromAxisAngle(T,_);var z=new C;z.setFromAxisAngle(D,M.rotation);var F=M.worldTransform.quaternion;this.chassisBody.quaternion.mult(x,F),F.mult(z,F),F.normalize();var k=M.worldTransform.position;k.copy(M.directionWorld),k.scale(M.suspensionLength,k),k.vadd(M.chassisConnectionPointWorld,k)};var h=[new t(1,0,0),new t(0,1,0),new t(0,0,1)];a.prototype.getWheelTransformWorld=function(v){return this.wheelInfos[v].worldTransform};var m=new t,r=[],u=[],b=1;a.prototype.updateFriction=function(v){for(var T=m,D=this.wheelInfos,$=D.length,M=this.chassisBody,_=u,x=r,z=0;z<$;z++){var F=D[z],k=F.raycastResult.body;F.sideImpulse=0,F.forwardImpulse=0,_[z]||(_[z]=new t),x[z]||(x[z]=new t)}for(var z=0;z<$;z++){var F=D[z],k=F.raycastResult.body;if(k){var rV=x[z],nV=this.getWheelTransformWorld(z);nV.vectorToWorldFrame(h[this.indexRightAxis],rV);var j=F.raycastResult.hitNormalWorld,VV=rV.dot(j);j.scale(VV,T),rV.vsub(T,rV),rV.normalize(),j.cross(rV,_[z]),_[z].normalize(),F.sideImpulse=N(M,F.raycastResult.hitPointWorld,k,F.raycastResult.hitPointWorld,rV),F.sideImpulse*=b}}var lV=1,iV=.5;this.sliding=!1;for(var z=0;z<$;z++){var F=D[z],k=F.raycastResult.body,CV=0;if(F.slipInfo=1,k){var AV=0,gV=F.brake?F.brake:AV;CV=X(M,k,F.raycastResult.hitPointWorld,_[z],gV),CV+=F.engineForce*v;var eV=gV/CV;F.slipInfo*=eV}if(F.forwardImpulse=0,F.skidInfo=1,k){F.skidInfo=1;var K=F.suspensionForce*v*F.frictionSlip,w=K,sV=K*w;F.forwardImpulse=CV;var tV=F.forwardImpulse*iV,BV=F.sideImpulse*lV,yV=tV*tV+BV*BV;if(F.sliding=!1,yV>sV){this.sliding=!0,F.sliding=!0;var eV=K/Math.sqrt(yV);F.skidInfo*=eV}}}if(this.sliding)for(var z=0;z<$;z++){var F=D[z];F.sideImpulse!==0&&F.skidInfo<1&&(F.forwardImpulse*=F.skidInfo,F.sideImpulse*=F.skidInfo)}for(var z=0;z<$;z++){var F=D[z],wV=new t;if(wV.copy(F.raycastResult.hitPointWorld),F.forwardImpulse!==0){var fV=new t;_[z].scale(F.forwardImpulse,fV),M.applyImpulse(fV,wV)}if(F.sideImpulse!==0){var k=F.raycastResult.body,vV=new t;vV.copy(F.raycastResult.hitPointWorld);var YV=new t;x[z].scale(F.sideImpulse,YV),M.pointToLocalFrame(wV,wV),wV["xyz"[this.indexUpAxis]]*=F.rollInfluence,M.pointToWorldFrame(wV,wV),M.applyImpulse(YV,wV),YV.scale(-1,YV),k.applyImpulse(YV,vV)}}};var Z=new t,p=new t,G=new t;function X(v,T,D,$,M){var _=0,x=D,z=Z,F=p,k=G;v.getVelocityAtWorldPoint(x,z),T.getVelocityAtWorldPoint(x,F),z.vsub(F,k);var rV=$.dot(k),nV=L(v,D,$),j=L(T,D,$),VV=1,lV=VV/(nV+j);return _=-rV*lV,M<_&&(_=M),_<-M&&(_=-M),_}var W=new t,y=new t,Y=new t,f=new t;function L(v,T,D){var $=W,M=y,_=Y,x=f;return T.vsub(v.position,$),$.cross(D,M),v.invInertiaWorld.vmult(M,x),x.cross($,_),v.invMass+D.dot(_)}var R=new t,J=new t,H=new t;function N(v,T,D,$,M,VV){var x=M.norm2();if(x>1.1)return 0;var z=R,F=J,k=H;v.getVelocityAtWorldPoint(T,z),D.getVelocityAtWorldPoint($,F),z.vsub(F,k);var rV=M.dot(k),nV=.2,j=1/(v.invMass+D.invMass),VV=-nV*rV*j;return VV}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(g,I,e){var t=g("./Body"),C=g("../shapes/Sphere"),A=g("../shapes/Box"),s=g("../math/Vec3"),a=g("../constraints/HingeConstraint");I.exports=o;function o(c){if(this.wheelBodies=[],this.coordinateSystem=typeof c.coordinateSystem=="undefined"?new s(1,2,3):c.coordinateSystem.clone(),this.chassisBody=c.chassisBody,!this.chassisBody){var d=new A(new s(5,2,.5));this.chassisBody=new t(1,d)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}o.prototype.addWheel=function(c){c=c||{};var d=c.body;d||(d=new t(1,new C(1.2))),this.wheelBodies.push(d),this.wheelForces.push(0),new s;var h=typeof c.position!="undefined"?c.position.clone():new s,m=new s;this.chassisBody.pointToWorldFrame(h,m),d.position.set(m.x,m.y,m.z);var r=typeof c.axis!="undefined"?c.axis.clone():new s(0,1,0);this.wheelAxes.push(r);var u=new a(this.chassisBody,d,{pivotA:h,axisA:r,pivotB:s.ZERO,axisB:r,collideConnected:!1});return this.constraints.push(u),this.wheelBodies.length-1},o.prototype.setSteeringValue=function(c,d){var h=this.wheelAxes[d],m=Math.cos(c),r=Math.sin(c),u=h.x,b=h.y;this.constraints[d].axisA.set(m*u-r*b,r*u+m*b,0)},o.prototype.setMotorSpeed=function(c,d){var h=this.constraints[d];h.enableMotor(),h.motorTargetVelocity=c},o.prototype.disableMotor=function(c){var d=this.constraints[c];d.disableMotor()};var n=new s;o.prototype.setWheelForce=function(c,d){this.wheelForces[d]=c},o.prototype.applyWheelForce=function(c,d){var h=this.wheelAxes[d],m=this.wheelBodies[d],r=m.torque;h.scale(c,n),m.vectorToWorldFrame(n,n),r.vadd(n,r)},o.prototype.addToWorld=function(c){for(var d=this.constraints,h=this.wheelBodies.concat([this.chassisBody]),m=0;m<h.length;m++)c.add(h[m]);for(var m=0;m<d.length;m++)c.addConstraint(d[m]);c.addEventListener("preStep",this._update.bind(this))},o.prototype._update=function(){for(var c=this.wheelForces,d=0;d<c.length;d++)this.applyWheelForce(c[d],d)},o.prototype.removeFromWorld=function(c){for(var d=this.constraints,h=this.wheelBodies.concat([this.chassisBody]),m=0;m<h.length;m++)c.remove(h[m]);for(var m=0;m<d.length;m++)c.removeConstraint(d[m])};var l=new s;o.prototype.getWheelSpeed=function(c){var d=this.wheelAxes[c],h=this.wheelBodies[c],m=h.angularVelocity;return this.chassisBody.vectorToWorldFrame(d,l),m.dot(l)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(g,I,e){I.exports=C,g("../shapes/Shape");var t=g("../math/Vec3");g("../math/Quaternion"),g("../shapes/Particle"),g("../objects/Body"),g("../material/Material");function C(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}C.prototype.add=function(d){this.particles.push(d),this.neighbors.length<this.particles.length&&this.neighbors.push([])},C.prototype.remove=function(d){var h=this.particles.indexOf(d);h!==-1&&(this.particles.splice(h,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var A=new t;C.prototype.getNeighbors=function(d,h){for(var m=this.particles.length,r=d.id,u=this.smoothingRadius*this.smoothingRadius,b=A,Z=0;Z!==m;Z++){var p=this.particles[Z];p.position.vsub(d.position,b),r!==p.id&&b.norm2()<u&&h.push(p)}};var s=new t,a=new t,o=new t,n=new t,l=new t,c=new t;C.prototype.update=function(){for(var d=this.particles.length,h=s,m=this.speedOfSound,r=this.eps,u=0;u!==d;u++){var b=this.particles[u],Z=this.neighbors[u];Z.length=0,this.getNeighbors(b,Z),Z.push(this.particles[u]);for(var p=Z.length,G=0,X=0;X!==p;X++){b.position.vsub(Z[X].position,h);var W=h.norm(),y=this.w(W);G+=Z[X].mass*y}this.densities[u]=G,this.pressures[u]=m*m*(this.densities[u]-this.density)}for(var Y=a,f=o,L=n,R=l,J=c,u=0;u!==d;u++){var H=this.particles[u];Y.set(0,0,0),f.set(0,0,0);for(var N,v,Z=this.neighbors[u],p=Z.length,X=0;X!==p;X++){var T=Z[X];H.position.vsub(T.position,R);var D=R.norm();N=-T.mass*(this.pressures[u]/(this.densities[u]*this.densities[u]+r)+this.pressures[X]/(this.densities[X]*this.densities[X]+r)),this.gradw(R,L),L.mult(N,L),Y.vadd(L,Y),T.velocity.vsub(H.velocity,J),J.mult(1/(1e-4+this.densities[u]*this.densities[X])*this.viscosity*T.mass,J),v=this.nablaw(D),J.mult(v,J),f.vadd(J,f)}f.mult(H.mass,f),Y.mult(H.mass,Y),H.force.vadd(f,H.force),H.force.vadd(Y,H.force)}},C.prototype.w=function(d){var h=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(h,9))*Math.pow(h*h-d*d,3)},C.prototype.gradw=function(d,h){var m=d.norm(),r=this.smoothingRadius;d.mult(945/(32*Math.PI*Math.pow(r,9))*Math.pow(r*r-m*m,2),h)},C.prototype.nablaw=function(d){var h=this.smoothingRadius,m=945/(32*Math.PI*Math.pow(h,9))*(h*h-d*d)*(7*d*d-3*h*h);return m}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(g,I,e){var t=g("../math/Vec3");I.exports=C;function C(u,b,Z){Z=Z||{},this.restLength=typeof Z.restLength=="number"?Z.restLength:1,this.stiffness=Z.stiffness||100,this.damping=Z.damping||1,this.bodyA=u,this.bodyB=b,this.localAnchorA=new t,this.localAnchorB=new t,Z.localAnchorA&&this.localAnchorA.copy(Z.localAnchorA),Z.localAnchorB&&this.localAnchorB.copy(Z.localAnchorB),Z.worldAnchorA&&this.setWorldAnchorA(Z.worldAnchorA),Z.worldAnchorB&&this.setWorldAnchorB(Z.worldAnchorB)}C.prototype.setWorldAnchorA=function(u){this.bodyA.pointToLocalFrame(u,this.localAnchorA)},C.prototype.setWorldAnchorB=function(u){this.bodyB.pointToLocalFrame(u,this.localAnchorB)},C.prototype.getWorldAnchorA=function(u){this.bodyA.pointToWorldFrame(this.localAnchorA,u)},C.prototype.getWorldAnchorB=function(u){this.bodyB.pointToWorldFrame(this.localAnchorB,u)};var A=new t,s=new t,a=new t,o=new t,n=new t,l=new t,c=new t,d=new t,h=new t,m=new t,r=new t;C.prototype.applyForce=function(){var u=this.stiffness,b=this.damping,Z=this.restLength,p=this.bodyA,G=this.bodyB,X=A,W=s,y=a,Y=o,f=r,L=n,R=l,J=c,H=d,N=h,v=m;this.getWorldAnchorA(L),this.getWorldAnchorB(R),L.vsub(p.position,J),R.vsub(G.position,H),R.vsub(L,X);var T=X.norm();W.copy(X),W.normalize(),G.velocity.vsub(p.velocity,y),G.angularVelocity.cross(H,f),y.vadd(f,y),p.angularVelocity.cross(J,f),y.vsub(f,y),W.mult(-u*(T-Z)-b*y.dot(W),Y),p.force.vsub(Y,p.force),G.force.vadd(Y,G.force),J.cross(Y,N),H.cross(Y,v),p.torque.vsub(N,p.torque),G.torque.vadd(v,G.torque)}},{"../math/Vec3":30}],36:[function(g,I,e){var t=g("../math/Vec3"),C=g("../math/Transform"),A=g("../collision/RaycastResult"),s=g("../utils/Utils");I.exports=a;function a(l){l=s.defaults(l,{chassisConnectionPointLocal:new t,chassisConnectionPointWorld:new t,directionLocal:new t,directionWorld:new t,axleLocal:new t,axleWorld:new t,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=l.maxSuspensionTravel,this.customSlidingRotationalSpeed=l.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=l.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=l.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=l.chassisConnectionPointWorld.clone(),this.directionLocal=l.directionLocal.clone(),this.directionWorld=l.directionWorld.clone(),this.axleLocal=l.axleLocal.clone(),this.axleWorld=l.axleWorld.clone(),this.suspensionRestLength=l.suspensionRestLength,this.suspensionMaxLength=l.suspensionMaxLength,this.radius=l.radius,this.suspensionStiffness=l.suspensionStiffness,this.dampingCompression=l.dampingCompression,this.dampingRelaxation=l.dampingRelaxation,this.frictionSlip=l.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=l.rollInfluence,this.maxSuspensionForce=l.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=l.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new A,this.worldTransform=new C,this.isInContact=!1}var n=new t,o=new t,n=new t;a.prototype.updateWheel=function(l){var c=this.raycastResult;if(this.isInContact){var d=c.hitNormalWorld.dot(c.directionWorld);c.hitPointWorld.vsub(l.position,o),l.getVelocityAtWorldPoint(o,n);var h=c.hitNormalWorld.dot(n);if(d>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=1/.1;else{var m=-1/d;this.suspensionRelativeVelocity=h*m,this.clippedInvContactDotSuspension=m}}else c.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,c.directionWorld.scale(-1,c.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(g,I,e){I.exports=s;var t=g("./Shape"),C=g("../math/Vec3"),A=g("./ConvexPolyhedron");function s(n){t.call(this),this.type=t.types.BOX,this.halfExtents=n,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}s.prototype=new t,s.prototype.constructor=s,s.prototype.updateConvexPolyhedronRepresentation=function(){var n=this.halfExtents.x,l=this.halfExtents.y,c=this.halfExtents.z,d=C,h=[new d(-n,-l,-c),new d(n,-l,-c),new d(n,l,-c),new d(-n,l,-c),new d(-n,-l,c),new d(n,-l,c),new d(n,l,c),new d(-n,l,c)],m=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]];new d(0,0,1),new d(0,1,0),new d(1,0,0);var r=new A(h,m);this.convexPolyhedronRepresentation=r,r.material=this.material},s.prototype.calculateLocalInertia=function(n,l){return l=l||new C,s.calculateInertia(this.halfExtents,n,l),l},s.calculateInertia=function(n,l,c){var d=n;c.x=1/12*l*(2*d.y*2*d.y+2*d.z*2*d.z),c.y=1/12*l*(2*d.x*2*d.x+2*d.z*2*d.z),c.z=1/12*l*(2*d.y*2*d.y+2*d.x*2*d.x)},s.prototype.getSideNormals=function(n,l){var c=n,d=this.halfExtents;if(c[0].set(d.x,0,0),c[1].set(0,d.y,0),c[2].set(0,0,d.z),c[3].set(-d.x,0,0),c[4].set(0,-d.y,0),c[5].set(0,0,-d.z),l!==void 0)for(var h=0;h!==c.length;h++)l.vmult(c[h],c[h]);return c},s.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new C;new C,s.prototype.forEachWorldCorner=function(n,l,c){for(var d=this.halfExtents,h=[[d.x,d.y,d.z],[-d.x,d.y,d.z],[-d.x,-d.y,d.z],[-d.x,-d.y,-d.z],[d.x,-d.y,-d.z],[d.x,d.y,-d.z],[-d.x,d.y,-d.z],[d.x,-d.y,d.z]],m=0;m<h.length;m++)a.set(h[m][0],h[m][1],h[m][2]),l.vmult(a,a),n.vadd(a,a),c(a.x,a.y,a.z)};var o=[new C,new C,new C,new C,new C,new C,new C,new C];s.prototype.calculateWorldAABB=function(n,l,c,d){var h=this.halfExtents;o[0].set(h.x,h.y,h.z),o[1].set(-h.x,h.y,h.z),o[2].set(-h.x,-h.y,h.z),o[3].set(-h.x,-h.y,-h.z),o[4].set(h.x,-h.y,-h.z),o[5].set(h.x,h.y,-h.z),o[6].set(-h.x,h.y,-h.z),o[7].set(h.x,-h.y,h.z);var m=o[0];l.vmult(m,m),n.vadd(m,m),d.copy(m),c.copy(m);for(var r=1;r<8;r++){var m=o[r];l.vmult(m,m),n.vadd(m,m);var u=m.x,b=m.y,Z=m.z;u>d.x&&(d.x=u),b>d.y&&(d.y=b),Z>d.z&&(d.z=Z),u<c.x&&(c.x=u),b<c.y&&(c.y=b),Z<c.z&&(c.z=Z)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(g,I,e){I.exports=s;var t=g("./Shape"),C=g("../math/Vec3");g("../math/Quaternion");var A=g("../math/Transform");function s(M,_,x){t.call(this),this.type=t.types.CONVEXPOLYHEDRON,this.vertices=M||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=_||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=x?x.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}s.prototype=new t,s.prototype.constructor=s;var a=new C;s.prototype.computeEdges=function(){var M=this.faces,_=this.vertices;_.length;var x=this.uniqueEdges;x.length=0;for(var z=a,F=0;F!==M.length;F++)for(var k=M[F],rV=k.length,nV=0;nV!==rV;nV++){var j=(nV+1)%rV;_[k[nV]].vsub(_[k[j]],z),z.normalize();for(var VV=!1,lV=0;lV!==x.length;lV++)if(x[lV].almostEquals(z)||x[lV].almostEquals(z)){VV=!0;break}VV||x.push(z.clone())}},s.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var M=0;M<this.faces.length;M++){for(var _=0;_<this.faces[M].length;_++)if(!this.vertices[this.faces[M][_]])throw new Error("Vertex "+this.faces[M][_]+" not found!");var x=this.faceNormals[M]||new C;this.getFaceNormal(M,x),x.negate(x),this.faceNormals[M]=x;var z=this.vertices[this.faces[M][0]];if(x.dot(z)<0){console.error(".faceNormals["+M+"] = Vec3("+x.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var _=0;_<this.faces[M].length;_++)console.warn(".vertices["+this.faces[M][_]+"] = Vec3("+this.vertices[this.faces[M][_]].toString()+")")}}};var o=new C,n=new C;s.computeNormal=function(M,_,x,z){_.vsub(M,n),x.vsub(_,o),o.cross(n,z),z.isZero()||z.normalize()},s.prototype.getFaceNormal=function(M,_){var x=this.faces[M],z=this.vertices[x[0]],F=this.vertices[x[1]],k=this.vertices[x[2]];return s.computeNormal(z,F,k,_)};var l=new C;s.prototype.clipAgainstHull=function(M,_,x,z,F,k,rV,nV,j){for(var VV=l,lV=-1,iV=-Number.MAX_VALUE,CV=0;CV<x.faces.length;CV++){VV.copy(x.faceNormals[CV]),F.vmult(VV,VV);var AV=VV.dot(k);AV>iV&&(iV=AV,lV=CV)}for(var gV=[],eV=x.faces[lV],K=eV.length,w=0;w<K;w++){var sV=x.vertices[eV[w]],tV=new C;tV.copy(sV),F.vmult(tV,tV),z.vadd(tV,tV),gV.push(tV)}lV>=0&&this.clipFaceAgainstHull(k,M,_,gV,rV,nV,j)};var c=new C,d=new C,h=new C,m=new C,r=new C,u=new C;s.prototype.findSeparatingAxis=function(M,_,x,z,F,k,rV,nV){var j=c,VV=d,lV=h,iV=m,CV=r,AV=u,gV=Number.MAX_VALUE,eV=this;if(eV.uniqueAxes)for(var w=0;w!==eV.uniqueAxes.length;w++){x.vmult(eV.uniqueAxes[w],j);var tV=eV.testSepAxis(j,M,_,x,z,F);if(tV===!1)return!1;tV<gV&&(gV=tV,k.copy(j))}else for(var K=rV?rV.length:eV.faces.length,w=0;w<K;w++){var sV=rV?rV[w]:w;j.copy(eV.faceNormals[sV]),x.vmult(j,j);var tV=eV.testSepAxis(j,M,_,x,z,F);if(tV===!1)return!1;tV<gV&&(gV=tV,k.copy(j))}if(M.uniqueAxes)for(var w=0;w!==M.uniqueAxes.length;w++){F.vmult(M.uniqueAxes[w],VV);var tV=eV.testSepAxis(VV,M,_,x,z,F);if(tV===!1)return!1;tV<gV&&(gV=tV,k.copy(VV))}else for(var BV=nV?nV.length:M.faces.length,w=0;w<BV;w++){var sV=nV?nV[w]:w;VV.copy(M.faceNormals[sV]),F.vmult(VV,VV);var tV=eV.testSepAxis(VV,M,_,x,z,F);if(tV===!1)return!1;tV<gV&&(gV=tV,k.copy(VV))}for(var yV=0;yV!==eV.uniqueEdges.length;yV++){x.vmult(eV.uniqueEdges[yV],iV);for(var wV=0;wV!==M.uniqueEdges.length;wV++)if(F.vmult(M.uniqueEdges[wV],CV),iV.cross(CV,AV),!AV.almostZero()){AV.normalize();var fV=eV.testSepAxis(AV,M,_,x,z,F);if(fV===!1)return!1;fV<gV&&(gV=fV,k.copy(AV))}}return z.vsub(_,lV),lV.dot(k)>0&&k.negate(k),!0};var b=[],Z=[];s.prototype.testSepAxis=function(M,_,x,z,F,k){var rV=this;s.project(rV,M,x,z,b),s.project(_,M,F,k,Z);var nV=b[0],j=b[1],VV=Z[0],lV=Z[1];if(nV<lV||VV<j)return!1;var iV=nV-lV,CV=VV-j,AV=iV<CV?iV:CV;return AV};var p=new C,G=new C;s.prototype.calculateLocalInertia=function(M,_){this.computeLocalAABB(p,G);var x=G.x-p.x,z=G.y-p.y,F=G.z-p.z;_.x=1/12*M*(2*z*2*z+2*F*2*F),_.y=1/12*M*(2*x*2*x+2*F*2*F),_.z=1/12*M*(2*z*2*z+2*x*2*x)},s.prototype.getPlaneConstantOfFace=function(M){var _=this.faces[M],x=this.faceNormals[M],z=this.vertices[_[0]],F=-x.dot(z);return F};var X=new C,W=new C,y=new C,Y=new C,f=new C,L=new C,R=new C,J=new C;s.prototype.clipFaceAgainstHull=function(M,_,x,z,F,k,rV){for(var nV=X,j=W,VV=y,lV=Y,iV=f,CV=L,AV=R,gV=J,eV=this,K=[],w=z,sV=K,tV=-1,BV=Number.MAX_VALUE,yV=0;yV<eV.faces.length;yV++){nV.copy(eV.faceNormals[yV]),x.vmult(nV,nV);var wV=nV.dot(M);wV<BV&&(BV=wV,tV=yV)}if(!(tV<0)){var fV=eV.faces[tV];fV.connectedFaces=[];for(var vV=0;vV<eV.faces.length;vV++)for(var YV=0;YV<eV.faces[vV].length;YV++)fV.indexOf(eV.faces[vV][YV])!==-1&&vV!==tV&&fV.connectedFaces.indexOf(vV)===-1&&fV.connectedFaces.push(vV);w.length;for(var E=fV.length,WV=0;WV<E;WV++){var bV=eV.vertices[fV[WV]],MV=eV.vertices[fV[(WV+1)%E]];bV.vsub(MV,j),VV.copy(j),x.vmult(VV,VV),_.vadd(VV,VV),lV.copy(this.faceNormals[tV]),x.vmult(lV,lV),_.vadd(lV,lV),VV.cross(lV,iV),iV.negate(iV),CV.copy(bV),x.vmult(CV,CV),_.vadd(CV,CV),-CV.dot(iV);var tg;{var HV=fV.connectedFaces[WV];AV.copy(this.faceNormals[HV]);var OV=this.getPlaneConstantOfFace(HV);gV.copy(AV),x.vmult(gV,gV);var tg=OV-gV.dot(_)}for(this.clipFaceAgainstPlane(w,sV,gV,tg);w.length;)w.shift();for(;sV.length;)w.push(sV.shift())}AV.copy(this.faceNormals[tV]);var OV=this.getPlaneConstantOfFace(tV);gV.copy(AV),x.vmult(gV,gV);for(var tg=OV-gV.dot(_),vV=0;vV<w.length;vV++){var Cg=gV.dot(w[vV])+tg;if(Cg<=F&&(console.log("clamped: depth="+Cg+" to minDist="+(F+"")),Cg=F),Cg<=k){var gI=w[vV];if(Cg<=0){var Vg={point:gI,normal:gV,depth:Cg};rV.push(Vg)}}}}},s.prototype.clipFaceAgainstPlane=function(M,_,x,z){var F,k,rV=M.length;if(rV<2)return _;var nV=M[M.length-1],j=M[0];F=x.dot(nV)+z;for(var VV=0;VV<rV;VV++){if(j=M[VV],k=x.dot(j)+z,F<0)if(k<0){var lV=new C;lV.copy(j),_.push(lV)}else{var lV=new C;nV.lerp(j,F/(F-k),lV),_.push(lV)}else if(k<0){var lV=new C;nV.lerp(j,F/(F-k),lV),_.push(lV),_.push(j)}nV=j,F=k}return _},s.prototype.computeWorldVertices=function(M,_){for(var x=this.vertices.length;this.worldVertices.length<x;)this.worldVertices.push(new C);for(var z=this.vertices,F=this.worldVertices,k=0;k!==x;k++)_.vmult(z[k],F[k]),M.vadd(F[k],F[k]);this.worldVerticesNeedsUpdate=!1},new C,s.prototype.computeLocalAABB=function(M,_){var x=this.vertices.length,z=this.vertices;M.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),_.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var F=0;F<x;F++){var k=z[F];k.x<M.x?M.x=k.x:k.x>_.x&&(_.x=k.x),k.y<M.y?M.y=k.y:k.y>_.y&&(_.y=k.y),k.z<M.z?M.z=k.z:k.z>_.z&&(_.z=k.z)}},s.prototype.computeWorldFaceNormals=function(M){for(var _=this.faceNormals.length;this.worldFaceNormals.length<_;)this.worldFaceNormals.push(new C);for(var x=this.faceNormals,z=this.worldFaceNormals,F=0;F!==_;F++)M.vmult(x[F],z[F]);this.worldFaceNormalsNeedsUpdate=!1},s.prototype.updateBoundingSphereRadius=function(){for(var M=0,_=this.vertices,x=0,z=_.length;x!==z;x++){var F=_[x].norm2();F>M&&(M=F)}this.boundingSphereRadius=Math.sqrt(M)};var H=new C;s.prototype.calculateWorldAABB=function(M,_,x,z){for(var F=this.vertices.length,k=this.vertices,rV,nV,j,VV,lV,iV,CV=0;CV<F;CV++){H.copy(k[CV]),_.vmult(H,H),M.vadd(H,H);var AV=H;AV.x<rV||rV===void 0?rV=AV.x:(AV.x>VV||VV===void 0)&&(VV=AV.x),AV.y<nV||nV===void 0?nV=AV.y:(AV.y>lV||lV===void 0)&&(lV=AV.y),AV.z<j||j===void 0?j=AV.z:(AV.z>iV||iV===void 0)&&(iV=AV.z)}x.set(rV,nV,j),z.set(VV,lV,iV)},s.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},s.prototype.getAveragePointLocal=function(M){M=M||new C;for(var _=this.vertices.length,x=this.vertices,z=0;z<_;z++)M.vadd(x[z],M);return M.mult(1/_,M),M},s.prototype.transformAllPoints=function(M,_){var x=this.vertices.length,z=this.vertices;if(_){for(var F=0;F<x;F++){var k=z[F];_.vmult(k,k)}for(var F=0;F<this.faceNormals.length;F++){var k=this.faceNormals[F];_.vmult(k,k)}}if(M)for(var F=0;F<x;F++){var k=z[F];k.vadd(M,k)}};var N=new C,v=new C,T=new C;s.prototype.pointIsInside=function(M){var _=this.vertices.length,x=this.vertices,z=this.faces,F=this.faceNormals,k=null,rV=this.faces.length,nV=N;this.getAveragePointLocal(nV);for(var j=0;j<rV;j++){this.faces[j].length;var _=F[j],VV=x[z[j][0]],lV=v;M.vsub(VV,lV);var iV=_.dot(lV),CV=T;nV.vsub(VV,CV);var AV=_.dot(CV);if(iV<0&&AV>0||iV>0&&AV<0)return!1}return k?1:-1},new C;var D=new C,$=new C;s.project=function(M,_,x,z,F){var k=M.vertices.length,rV=D,nV=0,j=0,VV=$,lV=M.vertices;VV.setZero(),A.vectorToLocalFrame(x,z,_,rV),A.pointToLocalFrame(x,z,VV,VV);var iV=VV.dot(rV);j=nV=lV[0].dot(rV);for(var CV=1;CV<k;CV++){var AV=lV[CV].dot(rV);AV>nV&&(nV=AV),AV<j&&(j=AV)}if(j-=iV,nV-=iV,j>nV){var gV=j;j=nV,nV=gV}F[0]=nV,F[1]=j}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(g,I,e){I.exports=s;var t=g("./Shape"),C=g("../math/Vec3");g("../math/Quaternion");var A=g("./ConvexPolyhedron");function s(a,o,n,l){var c=l,d=[],h=[],m=[],r=[],u=[],b=Math.cos,Z=Math.sin;d.push(new C(o*b(0),o*Z(0),-n*.5)),r.push(0),d.push(new C(a*b(0),a*Z(0),n*.5)),u.push(1);for(var p=0;p<c;p++){var G=2*Math.PI/c*(p+1),X=2*Math.PI/c*(p+.5);p<c-1?(d.push(new C(o*b(G),o*Z(G),-n*.5)),r.push(2*p+2),d.push(new C(a*b(G),a*Z(G),n*.5)),u.push(2*p+3),m.push([2*p+2,2*p+3,2*p+1,2*p])):m.push([0,1,2*p+1,2*p]),(c%2===1||p<c/2)&&h.push(new C(b(X),Z(X),0))}m.push(u),h.push(new C(0,0,1));for(var W=[],p=0;p<r.length;p++)W.push(r[r.length-p-1]);m.push(W),this.type=t.types.CONVEXPOLYHEDRON,A.call(this,d,m,h)}s.prototype=new A},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(g,I,e){var t=g("./Shape"),C=g("./ConvexPolyhedron"),A=g("../math/Vec3"),s=g("../utils/Utils");I.exports=a;function a(o,n){n=s.defaults(n,{maxValue:null,minValue:null,elementSize:1}),this.data=o,this.maxValue=n.maxValue,this.minValue=n.minValue,this.elementSize=n.elementSize,n.minValue===null&&this.updateMinValue(),n.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,t.call(this),this.pillarConvex=new C,this.pillarOffset=new A,this.type=t.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}a.prototype=new t,a.prototype.update=function(){this._cachedPillars={}},a.prototype.updateMinValue=function(){for(var o=this.data,n=o[0][0],l=0;l!==o.length;l++)for(var c=0;c!==o[l].length;c++){var d=o[l][c];d<n&&(n=d)}this.minValue=n},a.prototype.updateMaxValue=function(){for(var o=this.data,n=o[0][0],l=0;l!==o.length;l++)for(var c=0;c!==o[l].length;c++){var d=o[l][c];d>n&&(n=d)}this.maxValue=n},a.prototype.setHeightValueAtIndex=function(o,n,l){var c=this.data;c[o][n]=l,this.clearCachedConvexTrianglePillar(o,n,!1),o>0&&(this.clearCachedConvexTrianglePillar(o-1,n,!0),this.clearCachedConvexTrianglePillar(o-1,n,!1)),n>0&&(this.clearCachedConvexTrianglePillar(o,n-1,!0),this.clearCachedConvexTrianglePillar(o,n-1,!1)),n>0&&o>0&&this.clearCachedConvexTrianglePillar(o-1,n-1,!0)},a.prototype.getRectMinMax=function(o,n,l,c,d){d=d||[];for(var h=this.data,m=this.minValue,r=o;r<=l;r++)for(var u=n;u<=c;u++){var b=h[r][u];b>m&&(m=b)}d[0]=this.minValue,d[1]=m},a.prototype.getIndexOfPosition=function(o,n,l,c){var d=this.elementSize,h=this.data,m=Math.floor(o/d),r=Math.floor(n/d);return l[0]=m,l[1]=r,c&&(m<0&&(m=0),r<0&&(r=0),m>=h.length-1&&(m=h.length-1),r>=h[0].length-1&&(r=h[0].length-1)),!(m<0||r<0||m>=h.length-1||r>=h[0].length-1)},a.prototype.getHeightAt=function(o,n,l){var c=[];this.getIndexOfPosition(o,n,c,l);var d=[];return this.getRectMinMax(c[0],c[1]+1,c[0],c[1]+1,d),(d[0]+d[1])/2},a.prototype.getCacheConvexTrianglePillarKey=function(o,n,l){return o+"_"+n+"_"+(l?1:0)},a.prototype.getCachedConvexTrianglePillar=function(o,n,l){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(o,n,l)]},a.prototype.setCachedConvexTrianglePillar=function(o,n,l,c,d){this._cachedPillars[this.getCacheConvexTrianglePillarKey(o,n,l)]={convex:c,offset:d}},a.prototype.clearCachedConvexTrianglePillar=function(o,n,l){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(o,n,l)]},a.prototype.getConvexTrianglePillar=function(o,n,l){var c=this.pillarConvex,d=this.pillarOffset;if(this.cacheEnabled){var h=this.getCachedConvexTrianglePillar(o,n,l);if(h){this.pillarConvex=h.convex,this.pillarOffset=h.offset;return}c=new C,d=new A,this.pillarConvex=c,this.pillarOffset=d}var h=this.data,m=this.elementSize,r=c.faces;c.vertices.length=6;for(var u=0;u<6;u++)c.vertices[u]||(c.vertices[u]=new A);r.length=5;for(var u=0;u<5;u++)r[u]||(r[u]=[]);var b=c.vertices,Z=(Math.min(h[o][n],h[o+1][n],h[o][n+1],h[o+1][n+1])-this.minValue)/2+this.minValue;l?(d.set((o+.75)*m,(n+.75)*m,Z),b[0].set(.25*m,.25*m,h[o+1][n+1]-Z),b[1].set(-.75*m,.25*m,h[o][n+1]-Z),b[2].set(.25*m,-.75*m,h[o+1][n]-Z),b[3].set(.25*m,.25*m,-Z-1),b[4].set(-.75*m,.25*m,-Z-1),b[5].set(.25*m,-.75*m,-Z-1),r[0][0]=0,r[0][1]=1,r[0][2]=2,r[1][0]=5,r[1][1]=4,r[1][2]=3,r[2][0]=2,r[2][1]=5,r[2][2]=3,r[2][3]=0,r[3][0]=3,r[3][1]=4,r[3][2]=1,r[3][3]=0,r[4][0]=1,r[4][1]=4,r[4][2]=5,r[4][3]=2):(d.set((o+.25)*m,(n+.25)*m,Z),b[0].set(-.25*m,-.25*m,h[o][n]-Z),b[1].set(.75*m,-.25*m,h[o+1][n]-Z),b[2].set(-.25*m,.75*m,h[o][n+1]-Z),b[3].set(-.25*m,-.25*m,-Z-1),b[4].set(.75*m,-.25*m,-Z-1),b[5].set(-.25*m,.75*m,-Z-1),r[0][0]=0,r[0][1]=1,r[0][2]=2,r[1][0]=5,r[1][1]=4,r[1][2]=3,r[2][0]=0,r[2][1]=2,r[2][2]=5,r[2][3]=3,r[3][0]=1,r[3][1]=0,r[3][2]=3,r[3][3]=4,r[4][0]=4,r[4][1]=5,r[4][2]=2,r[4][3]=1),c.computeNormals(),c.computeEdges(),c.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(o,n,l,c,d)},a.prototype.calculateLocalInertia=function(o,n){return n=n||new A,n.set(0,0,0),n},a.prototype.volume=function(){return Number.MAX_VALUE},a.prototype.calculateWorldAABB=function(o,n,l,c){l.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),c.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a.prototype.updateBoundingSphereRadius=function(){var o=this.data,n=this.elementSize;this.boundingSphereRadius=new A(o.length*n,o[0].length*n,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(g,I,e){I.exports=A;var t=g("./Shape"),C=g("../math/Vec3");function A(){t.call(this),this.type=t.types.PARTICLE}A.prototype=new t,A.prototype.constructor=A,A.prototype.calculateLocalInertia=function(s,a){return a=a||new C,a.set(0,0,0),a},A.prototype.volume=function(){return 0},A.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},A.prototype.calculateWorldAABB=function(s,a,o,n){o.copy(s),n.copy(s)}},{"../math/Vec3":30,"./Shape":43}],42:[function(g,I,e){I.exports=A;var t=g("./Shape"),C=g("../math/Vec3");function A(){t.call(this),this.type=t.types.PLANE,this.worldNormal=new C,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}A.prototype=new t,A.prototype.constructor=A,A.prototype.computeWorldNormal=function(a){var o=this.worldNormal;o.set(0,0,1),a.vmult(o,o),this.worldNormalNeedsUpdate=!1},A.prototype.calculateLocalInertia=function(a,o){return o=o||new C,o},A.prototype.volume=function(){return Number.MAX_VALUE};var s=new C;A.prototype.calculateWorldAABB=function(a,o,n,l){s.set(0,0,1),o.vmult(s,s);var c=Number.MAX_VALUE;n.set(-c,-c,-c),l.set(c,c,c),s.x===1&&(l.x=a.x),s.y===1&&(l.y=a.y),s.z===1&&(l.z=a.z),s.x===-1&&(n.x=a.x),s.y===-1&&(n.y=a.y),s.z===-1&&(n.z=a.z)},A.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(g,I,e){I.exports=t;var t=g("./Shape");g("../math/Vec3"),g("../math/Quaternion"),g("../material/Material");function t(){this.id=t.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t.prototype.constructor=t,t.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},t.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},t.prototype.calculateLocalInertia=function(C,A){throw"calculateLocalInertia() not implemented for shape type "+this.type},t.idCounter=0,t.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(g,I,e){I.exports=A;var t=g("./Shape"),C=g("../math/Vec3");function A(s){if(t.call(this),this.radius=s!==void 0?Number(s):1,this.type=t.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}A.prototype=new t,A.prototype.constructor=A,A.prototype.calculateLocalInertia=function(s,a){a=a||new C;var o=2*s*this.radius*this.radius/5;return a.x=o,a.y=o,a.z=o,a},A.prototype.volume=function(){return 4*Math.PI*this.radius/3},A.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},A.prototype.calculateWorldAABB=function(s,a,o,n){for(var l=this.radius,c=["x","y","z"],d=0;d<c.length;d++){var h=c[d];o[h]=s[h]-l,n[h]=s[h]+l}}},{"../math/Vec3":30,"./Shape":43}],45:[function(g,I,e){I.exports=o;var t=g("./Shape"),C=g("../math/Vec3");g("../math/Quaternion");var A=g("../math/Transform"),s=g("../collision/AABB"),a=g("../utils/Octree");function o(W,y){t.call(this),this.type=t.types.TRIMESH,this.vertices=new Float32Array(W),this.indices=new Int16Array(y),this.normals=new Float32Array(y.length),this.aabb=new s,this.edges=null,this.scale=new C(1,1,1),this.tree=new a,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}o.prototype=new t,o.prototype.constructor=o;var n=new C;o.prototype.updateTree=function(){var W=this.tree;W.reset(),W.aabb.copy(this.aabb);var y=this.scale;W.aabb.lowerBound.x*=1/y.x,W.aabb.lowerBound.y*=1/y.y,W.aabb.lowerBound.z*=1/y.z,W.aabb.upperBound.x*=1/y.x,W.aabb.upperBound.y*=1/y.y,W.aabb.upperBound.z*=1/y.z;for(var Y=new s,f=new C,L=new C,R=new C,J=[f,L,R],H=0;H<this.indices.length/3;H++){var N=H*3;this._getUnscaledVertex(this.indices[N],f),this._getUnscaledVertex(this.indices[N+1],L),this._getUnscaledVertex(this.indices[N+2],R),Y.setFromPoints(J),W.insert(Y,H)}W.removeEmptyNodes()};var l=new s;o.prototype.getTrianglesInAABB=function(W,y){l.copy(W);var Y=this.scale,f=Y.x,L=Y.y,R=Y.z,J=l.lowerBound,H=l.upperBound;return J.x/=f,J.y/=L,J.z/=R,H.x/=f,H.y/=L,H.z/=R,this.tree.aabbQuery(l,y)},o.prototype.setScale=function(W){var y=this.scale.x===this.scale.y===this.scale.z,Y=W.x===W.y===W.z;y&&Y||this.updateNormals(),this.scale.copy(W),this.updateAABB(),this.updateBoundingSphereRadius()},o.prototype.updateNormals=function(){for(var W=n,y=this.normals,Y=0;Y<this.indices.length/3;Y++){var f=Y*3,L=this.indices[f],R=this.indices[f+1],J=this.indices[f+2];this.getVertex(L,r),this.getVertex(R,u),this.getVertex(J,b),o.computeNormal(u,r,b,W),y[f]=W.x,y[f+1]=W.y,y[f+2]=W.z}},o.prototype.updateEdges=function(){for(var W={},y=function(N,v){var T=L<R?L+"_"+R:R+"_"+L;W[T]=!0},Y=0;Y<this.indices.length/3;Y++){var f=Y*3,L=this.indices[f],R=this.indices[f+1];this.indices[f+2],y(),y(),y()}var J=Object.keys(W);this.edges=new Int16Array(J.length*2);for(var Y=0;Y<J.length;Y++){var H=J[Y].split("_");this.edges[2*Y]=parseInt(H[0],10),this.edges[2*Y+1]=parseInt(H[1],10)}},o.prototype.getEdgeVertex=function(W,y,Y){var f=this.edges[W*2+(y?1:0)];this.getVertex(f,Y)};var c=new C,d=new C;o.prototype.getEdgeVector=function(W,y){var Y=c,f=d;this.getEdgeVertex(W,0,Y),this.getEdgeVertex(W,1,f),f.vsub(Y,y)};var h=new C,m=new C;o.computeNormal=function(W,y,Y,f){y.vsub(W,m),Y.vsub(y,h),h.cross(m,f),f.isZero()||f.normalize()};var r=new C,u=new C,b=new C;o.prototype.getVertex=function(W,y){var Y=this.scale;return this._getUnscaledVertex(W,y),y.x*=Y.x,y.y*=Y.y,y.z*=Y.z,y},o.prototype._getUnscaledVertex=function(W,y){var Y=W*3,f=this.vertices;return y.set(f[Y],f[Y+1],f[Y+2])},o.prototype.getWorldVertex=function(W,y,Y,f){return this.getVertex(W,f),A.pointToWorldFrame(y,Y,f,f),f},o.prototype.getTriangleVertices=function(W,y,Y,f){var L=W*3;this.getVertex(this.indices[L],y),this.getVertex(this.indices[L+1],Y),this.getVertex(this.indices[L+2],f)},o.prototype.getNormal=function(W,y){var Y=W*3;return y.set(this.normals[Y],this.normals[Y+1],this.normals[Y+2])};var Z=new s;o.prototype.calculateLocalInertia=function(W,y){this.computeLocalAABB(Z);var Y=Z.upperBound.x-Z.lowerBound.x,f=Z.upperBound.y-Z.lowerBound.y,L=Z.upperBound.z-Z.lowerBound.z;return y.set(1/12*W*(2*f*2*f+2*L*2*L),1/12*W*(2*Y*2*Y+2*L*2*L),1/12*W*(2*f*2*f+2*Y*2*Y))};var p=new C;o.prototype.computeLocalAABB=function(W){var y=W.lowerBound,Y=W.upperBound,f=this.vertices.length;this.vertices;var L=p;this.getVertex(0,L),y.copy(L),Y.copy(L);for(var R=0;R!==f;R++)this.getVertex(R,L),L.x<y.x?y.x=L.x:L.x>Y.x&&(Y.x=L.x),L.y<y.y?y.y=L.y:L.y>Y.y&&(Y.y=L.y),L.z<y.z?y.z=L.z:L.z>Y.z&&(Y.z=L.z)},o.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},o.prototype.updateBoundingSphereRadius=function(){for(var W=0,y=this.vertices,Y=new C,f=0,L=y.length/3;f!==L;f++){this.getVertex(f,Y);var R=Y.norm2();R>W&&(W=R)}this.boundingSphereRadius=Math.sqrt(W)},new C;var G=new A,X=new s;o.prototype.calculateWorldAABB=function(W,y,Y,f){var L=G,R=X;L.position=W,L.quaternion=y,this.aabb.toWorldFrame(L,R),Y.copy(R.lowerBound),f.copy(R.upperBound)},o.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},o.createTorus=function(W,y,Y,f,L){W=W||1,y=y||.5,Y=Y||8,f=f||6,L=L||Math.PI*2;for(var R=[],J=[],H=0;H<=Y;H++)for(var N=0;N<=f;N++){var v=N/f*L,T=H/Y*Math.PI*2,D=(W+y*Math.cos(T))*Math.cos(v),$=(W+y*Math.cos(T))*Math.sin(v),M=y*Math.sin(T);R.push(D,$,M)}for(var H=1;H<=Y;H++)for(var N=1;N<=f;N++){var _=(f+1)*H+N-1,x=(f+1)*(H-1)+N-1,z=(f+1)*(H-1)+N,F=(f+1)*H+N;J.push(_,x,F),J.push(x,z,F)}return new o(R,J)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(g,I,e){I.exports=C,g("../math/Vec3"),g("../math/Quaternion");var t=g("./Solver");function C(){t.call(this),this.iterations=10,this.tolerance=1e-7}C.prototype=new t;var A=[],s=[],a=[];C.prototype.solve=function(o,n){var l=0,c=this.iterations,d=this.tolerance*this.tolerance,h=this.equations,m=h.length,r=n.bodies,u=r.length,b=o,Z,p,G,X,W,y;if(m!==0)for(var Y=0;Y!==u;Y++)r[Y].updateSolveMassProperties();var f=s,L=a,R=A;f.length=m,L.length=m,R.length=m;for(var Y=0;Y!==m;Y++){var J=h[Y];R[Y]=0,L[Y]=J.computeB(b),f[Y]=1/J.computeC()}if(m!==0){for(var Y=0;Y!==u;Y++){var H=r[Y],N=H.vlambda,v=H.wlambda;N.set(0,0,0),v&&v.set(0,0,0)}for(l=0;l!==c;l++){X=0;for(var T=0;T!==m;T++){var J=h[T];Z=L[T],p=f[T],y=R[T],W=J.computeGWlambda(),G=p*(Z-W-J.eps*y),y+G<J.minForce?G=J.minForce-y:y+G>J.maxForce&&(G=J.maxForce-y),R[T]+=G,X+=G>0?G:-G,J.addToWlambda(G)}if(X*X<d)break}for(var Y=0;Y!==u;Y++){var H=r[Y],D=H.velocity,$=H.angularVelocity;D.vadd(H.vlambda,D),$&&$.vadd(H.wlambda,$)}}return l}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(g,I,e){I.exports=t;function t(){this.equations=[]}t.prototype.solve=function(C,A){return 0},t.prototype.addEquation=function(C){C.enabled&&this.equations.push(C)},t.prototype.removeEquation=function(C){var A=this.equations,s=A.indexOf(C);s!==-1&&A.splice(s,1)},t.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(g,I,e){I.exports=A,g("../math/Vec3"),g("../math/Quaternion");var t=g("./Solver"),C=g("../objects/Body");function A(r){for(t.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=r,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}A.prototype=new t;var s=[],a=[],o={bodies:[]},n=C.STATIC;function l(r){for(var u=r.length,b=0;b!==u;b++){var Z=r[b];if(!Z.visited&&!(Z.body.type&n))return Z}return!1}var c=[];function d(r,u,b,Z){for(c.push(r),r.visited=!0,u(r,b,Z);c.length;)for(var p=c.pop(),G;G=l(p.children);)G.visited=!0,u(G,b,Z),c.push(G)}function h(r,u,b){u.push(r.body);for(var Z=r.eqs.length,p=0;p!==Z;p++){var G=r.eqs[p];b.indexOf(G)===-1&&b.push(G)}}A.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},A.prototype.solve=function(r,u){for(var b=s,Z=this.nodePool,p=u.bodies,G=this.equations,X=G.length,W=p.length,y=this.subsolver;Z.length<W;)Z.push(this.createNode());b.length=W;for(var Y=0;Y<W;Y++)b[Y]=Z[Y];for(var Y=0;Y!==W;Y++){var f=b[Y];f.body=p[Y],f.children.length=0,f.eqs.length=0,f.visited=!1}for(var L=0;L!==X;L++){var R=G[L],Y=p.indexOf(R.bi),J=p.indexOf(R.bj),H=b[Y],N=b[J];H.children.push(N),H.eqs.push(R),N.children.push(H),N.eqs.push(R)}var v,T=0,D=a;y.tolerance=this.tolerance,y.iterations=this.iterations;for(var $=o;v=l(b);){D.length=0,$.bodies.length=0,d(v,h,$.bodies,D);var M=D.length;D=D.sort(m);for(var Y=0;Y!==M;Y++)y.addEquation(D[Y]);y.solve(r,$),y.removeAllEquations(),T++}return T};function m(r,u){return u.id-r.id}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(g,I,e){var t=function(){};I.exports=t,t.prototype={constructor:t,addEventListener:function(C,A){this._listeners===void 0&&(this._listeners={});var s=this._listeners;return s[C]===void 0&&(s[C]=[]),s[C].indexOf(A)===-1&&s[C].push(A),this},hasEventListener:function(C,A){if(this._listeners===void 0)return!1;var s=this._listeners;return s[C]!==void 0&&s[C].indexOf(A)!==-1},removeEventListener:function(C,A){if(this._listeners===void 0)return this;var s=this._listeners;if(s[C]===void 0)return this;var a=s[C].indexOf(A);return a!==-1&&s[C].splice(a,1),this},dispatchEvent:function(C){if(this._listeners===void 0)return this;var A=this._listeners,s=A[C.type];if(s!==void 0){C.target=this;for(var a=0,o=s.length;a<o;a++)s[a].call(this,C)}return this}}},{}],50:[function(g,I,e){var t=g("../collision/AABB"),C=g("../math/Vec3");I.exports=s;function A(n){n=n||{},this.root=n.root||null,this.aabb=n.aabb?n.aabb.clone():new t,this.data=[],this.children=[]}function s(n,l){l=l||{},l.root=null,l.aabb=n,A.call(this,l),this.maxDepth=typeof l.maxDepth!="undefined"?l.maxDepth:8}s.prototype=new A,A.prototype.reset=function(n,l){this.children.length=this.data.length=0},A.prototype.insert=function(n,l,c){var d=this.data;if(c=c||0,!this.aabb.contains(n))return!1;var h=this.children;if(c<(this.maxDepth||this.root.maxDepth)){var m=!1;h.length||(this.subdivide(),m=!0);for(var r=0;r!==8;r++)if(h[r].insert(n,l,c+1))return!0;m&&(h.length=0)}return d.push(l),!0};var a=new C;A.prototype.subdivide=function(){var n=this.aabb,l=n.lowerBound,c=n.upperBound,d=this.children;d.push(new A({aabb:new t({lowerBound:new C(0,0,0)})}),new A({aabb:new t({lowerBound:new C(1,0,0)})}),new A({aabb:new t({lowerBound:new C(1,1,0)})}),new A({aabb:new t({lowerBound:new C(1,1,1)})}),new A({aabb:new t({lowerBound:new C(0,1,1)})}),new A({aabb:new t({lowerBound:new C(0,0,1)})}),new A({aabb:new t({lowerBound:new C(1,0,1)})}),new A({aabb:new t({lowerBound:new C(0,1,0)})})),c.vsub(l,a),a.scale(.5,a);for(var h=this.root||this,m=0;m!==8;m++){var r=d[m];r.root=h;var u=r.aabb.lowerBound;u.x*=a.x,u.y*=a.y,u.z*=a.z,u.vadd(l,u),u.vadd(a,r.aabb.upperBound)}},A.prototype.aabbQuery=function(n,l){this.data,this.children;for(var c=[this];c.length;){var d=c.pop();d.aabb.overlaps(n)&&Array.prototype.push.apply(l,d.data),Array.prototype.push.apply(c,d.children)}return l};var o=new t;A.prototype.rayQuery=function(n,l,c){return n.getAABB(o),o.toLocalFrame(l,o),this.aabbQuery(o,c),c},A.prototype.removeEmptyNodes=function(){for(var n=[this];n.length;){for(var l=n.pop(),c=l.children.length-1;c>=0;c--)l.children[c].data.length||l.children.splice(c,1);Array.prototype.push.apply(n,l.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(g,I,e){I.exports=t;function t(){this.objects=[],this.type=Object}t.prototype.release=function(){for(var C=arguments.length,A=0;A!==C;A++)this.objects.push(arguments[A])},t.prototype.get=function(){return this.objects.length===0?this.constructObject():this.objects.pop()},t.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(g,I,e){I.exports=t;function t(){this.data={keys:[]}}t.prototype.get=function(C,A){if(C>A){var s=A;A=C,C=s}return this.data[C+"-"+A]},t.prototype.set=function(C,A,s){if(C>A){var a=A;A=C,C=a}var o=C+"-"+A;this.get(C,A)||this.data.keys.push(o),this.data[o]=s},t.prototype.reset=function(){for(var C=this.data,A=C.keys;A.length>0;){var s=A.pop();delete C[s]}}},{}],53:[function(g,I,e){function t(){}I.exports=t,t.defaults=function(C,A){C=C||{};for(var s in A)s in C||(C[s]=A[s]);return C}},{}],54:[function(g,I,e){I.exports=A;var t=g("../math/Vec3"),C=g("./Pool");function A(){C.call(this),this.type=t}A.prototype=new C,A.prototype.constructObject=function(){return new t}},{"../math/Vec3":30,"./Pool":51}],55:[function(g,I,e){I.exports=d;var t=g("../collision/AABB"),C=g("../shapes/Shape"),A=g("../collision/Ray"),s=g("../math/Vec3"),a=g("../math/Transform");g("../shapes/ConvexPolyhedron");var o=g("../math/Quaternion");g("../solver/Solver");var n=g("../utils/Vec3Pool"),l=g("../equations/ContactEquation"),c=g("../equations/FrictionEquation");function d(oV){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new n,this.world=oV,this.currentContactMaterial=null,this.enableFrictionReduction=!1}d.prototype.createContactEquation=function(oV,ZV,qV,B,O,U){var Q;this.contactPointPool.length?(Q=this.contactPointPool.pop(),Q.bi=oV,Q.bj=ZV):Q=new l(oV,ZV),Q.enabled=oV.collisionResponse&&ZV.collisionResponse&&qV.collisionResponse&&B.collisionResponse;var IV=this.currentContactMaterial;Q.restitution=IV.restitution,Q.setSpookParams(IV.contactEquationStiffness,IV.contactEquationRelaxation,this.world.dt);var P=qV.material||oV.material,hV=B.material||ZV.material;return P&&hV&&P.restitution>=0&&hV.restitution>=0&&(Q.restitution=P.restitution*hV.restitution),Q.si=O||qV,Q.sj=U||B,Q},d.prototype.createFrictionEquationsFromContact=function(oV,ZV){var qV=oV.bi,B=oV.bj,O=oV.si,U=oV.sj,Q=this.world,IV=this.currentContactMaterial,P=IV.friction,hV=O.material||qV.material,cV=U.material||B.material;if(hV&&cV&&hV.friction>=0&&cV.friction>=0&&(P=hV.friction*cV.friction),P>0){var pV=P*Q.gravity.length(),aV=qV.invMass+B.invMass;aV>0&&(aV=1/aV);var uV=this.frictionEquationPool,mV=uV.length?uV.pop():new c(qV,B,pV*aV),RV=uV.length?uV.pop():new c(qV,B,pV*aV);return mV.bi=RV.bi=qV,mV.bj=RV.bj=B,mV.minForce=RV.minForce=-pV*aV,mV.maxForce=RV.maxForce=pV*aV,mV.ri.copy(oV.ri),mV.rj.copy(oV.rj),RV.ri.copy(oV.ri),RV.rj.copy(oV.rj),oV.ni.tangents(mV.t,RV.t),mV.setSpookParams(IV.frictionEquationStiffness,IV.frictionEquationRelaxation,Q.dt),RV.setSpookParams(IV.frictionEquationStiffness,IV.frictionEquationRelaxation,Q.dt),mV.enabled=RV.enabled=oV.enabled,ZV.push(mV,RV),!0}return!1};var h=new s,m=new s,r=new s;d.prototype.createFrictionFromAverage=function(oV){var ZV=this.result[this.result.length-1];if(!(!this.createFrictionEquationsFromContact(ZV,this.frictionResult)||oV===1)){var qV=this.frictionResult[this.frictionResult.length-2],B=this.frictionResult[this.frictionResult.length-1];h.setZero(),m.setZero(),r.setZero();var O=ZV.bi;ZV.bj;for(var U=0;U!==oV;U++)ZV=this.result[this.result.length-1-U],ZV.bodyA!==O?(h.vadd(ZV.ni,h),m.vadd(ZV.ri,m),r.vadd(ZV.rj,r)):(h.vsub(ZV.ni,h),m.vadd(ZV.rj,m),r.vadd(ZV.ri,r));var Q=1/oV;m.scale(Q,qV.ri),r.scale(Q,qV.rj),B.ri.copy(qV.ri),B.rj.copy(qV.rj),h.normalize(),h.tangents(qV.t,B.t)}};var u=new s,b=new s,Z=new o,p=new o;d.prototype.getContacts=function(oV,ZV,qV,B,O,U,Q){this.contactPointPool=O,this.frictionEquationPool=Q,this.result=B,this.frictionResult=U;for(var IV=Z,P=p,hV=u,cV=b,pV=0,aV=oV.length;pV!==aV;pV++){var uV=oV[pV],mV=ZV[pV],RV=null;uV.material&&mV.material&&(RV=qV.getContactMaterial(uV.material,mV.material)||null);for(var kV=0;kV<uV.shapes.length;kV++){uV.quaternion.mult(uV.shapeOrientations[kV],IV),uV.quaternion.vmult(uV.shapeOffsets[kV],hV),hV.vadd(uV.position,hV);for(var GV=uV.shapes[kV],DV=0;DV<mV.shapes.length;DV++){mV.quaternion.mult(mV.shapeOrientations[DV],P),mV.quaternion.vmult(mV.shapeOffsets[DV],cV),cV.vadd(mV.position,cV);var KV=mV.shapes[DV];if(!(hV.distanceTo(cV)>GV.boundingSphereRadius+KV.boundingSphereRadius)){var gg=null;GV.material&&KV.material&&(gg=qV.getContactMaterial(GV.material,KV.material)||null),this.currentContactMaterial=gg||RV||qV.defaultContactMaterial;var zV=this[GV.type|KV.type];zV&&(GV.type<KV.type?zV.call(this,GV,KV,hV,cV,IV,P,uV,mV,GV,KV):zV.call(this,KV,GV,cV,hV,P,IV,mV,uV,GV,KV))}}}}},d.prototype[C.types.BOX|C.types.BOX]=d.prototype.boxBox=function(oV,ZV,qV,B,O,U,Q,IV){oV.convexPolyhedronRepresentation.material=oV.material,ZV.convexPolyhedronRepresentation.material=ZV.material,oV.convexPolyhedronRepresentation.collisionResponse=oV.collisionResponse,ZV.convexPolyhedronRepresentation.collisionResponse=ZV.collisionResponse,this.convexConvex(oV.convexPolyhedronRepresentation,ZV.convexPolyhedronRepresentation,qV,B,O,U,Q,IV,oV,ZV)},d.prototype[C.types.BOX|C.types.CONVEXPOLYHEDRON]=d.prototype.boxConvex=function(oV,ZV,qV,B,O,U,Q,IV){oV.convexPolyhedronRepresentation.material=oV.material,oV.convexPolyhedronRepresentation.collisionResponse=oV.collisionResponse,this.convexConvex(oV.convexPolyhedronRepresentation,ZV,qV,B,O,U,Q,IV,oV,ZV)},d.prototype[C.types.BOX|C.types.PARTICLE]=d.prototype.boxParticle=function(oV,ZV,qV,B,O,U,Q,IV){oV.convexPolyhedronRepresentation.material=oV.material,oV.convexPolyhedronRepresentation.collisionResponse=oV.collisionResponse,this.convexParticle(oV.convexPolyhedronRepresentation,ZV,qV,B,O,U,Q,IV,oV,ZV)},d.prototype[C.types.SPHERE]=d.prototype.sphereSphere=function(oV,ZV,qV,B,O,U,Q,IV){var P=this.createContactEquation(Q,IV,oV,ZV);B.vsub(qV,P.ni),P.ni.normalize(),P.ri.copy(P.ni),P.rj.copy(P.ni),P.ri.mult(oV.radius,P.ri),P.rj.mult(-ZV.radius,P.rj),P.ri.vadd(qV,P.ri),P.ri.vsub(Q.position,P.ri),P.rj.vadd(B,P.rj),P.rj.vsub(IV.position,P.rj),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult)};var G=new s,X=new s,W=new s;d.prototype[C.types.PLANE|C.types.TRIMESH]=d.prototype.planeTrimesh=function(oV,ZV,qV,B,O,U,Q,IV){var P=new s,hV=G;hV.set(0,0,1),O.vmult(hV,hV);for(var cV=0;cV<ZV.vertices.length/3;cV++){ZV.getVertex(cV,P);var pV=new s;pV.copy(P),a.pointToWorldFrame(B,U,pV,P);var aV=X;P.vsub(qV,aV);var uV=hV.dot(aV);if(uV<=0){var mV=this.createContactEquation(Q,IV,oV,ZV);mV.ni.copy(hV);var RV=W;hV.scale(aV.dot(hV),RV),P.vsub(RV,RV),mV.ri.copy(RV),mV.ri.vsub(Q.position,mV.ri),mV.rj.copy(P),mV.rj.vsub(IV.position,mV.rj),this.result.push(mV),this.createFrictionEquationsFromContact(mV,this.frictionResult)}}};var y=new s,Y=new s;new s;var f=new s,L=new s,R=new s,J=new s,H=new s,N=new s,v=new s,T=new s,D=new s,$=new s,M=new s,_=new t,x=[];d.prototype[C.types.SPHERE|C.types.TRIMESH]=d.prototype.sphereTrimesh=function(oV,ZV,qV,B,O,U,Q,IV){var P=R,hV=J,cV=H,pV=N,aV=v,uV=T,mV=_,RV=L,kV=Y,GV=x;a.pointToLocalFrame(B,U,qV,aV);var DV=oV.radius;mV.lowerBound.set(aV.x-DV,aV.y-DV,aV.z-DV),mV.upperBound.set(aV.x+DV,aV.y+DV,aV.z+DV),ZV.getTrianglesInAABB(mV,GV);for(var KV=f,gg=oV.radius*oV.radius,zV=0;zV<GV.length;zV++)for(var jV=0;jV<3;jV++)if(ZV.getVertex(ZV.indices[GV[zV]*3+jV],KV),KV.vsub(aV,kV),kV.norm2()<=gg){RV.copy(KV),a.pointToWorldFrame(B,U,RV,KV),KV.vsub(qV,kV);var xV=this.createContactEquation(Q,IV,oV,ZV);xV.ni.copy(kV),xV.ni.normalize(),xV.ri.copy(xV.ni),xV.ri.scale(oV.radius,xV.ri),xV.ri.vadd(qV,xV.ri),xV.ri.vsub(Q.position,xV.ri),xV.rj.copy(KV),xV.rj.vsub(IV.position,xV.rj),this.result.push(xV),this.createFrictionEquationsFromContact(xV,this.frictionResult)}for(var zV=0;zV<GV.length;zV++)for(var jV=0;jV<3;jV++){ZV.getVertex(ZV.indices[GV[zV]*3+jV],P),ZV.getVertex(ZV.indices[GV[zV]*3+(jV+1)%3],hV),hV.vsub(P,cV),aV.vsub(hV,uV);var Fg=uV.dot(cV);aV.vsub(P,uV);var YI=uV.dot(cV);if(YI>0&&Fg<0){aV.vsub(P,uV),pV.copy(cV),pV.normalize(),YI=uV.dot(pV),pV.scale(YI,uV),uV.vadd(P,uV);var AI=uV.distanceTo(aV);if(AI<oV.radius){var xV=this.createContactEquation(Q,IV,oV,ZV);uV.vsub(aV,xV.ni),xV.ni.normalize(),xV.ni.scale(oV.radius,xV.ri),a.pointToWorldFrame(B,U,uV,uV),uV.vsub(IV.position,xV.rj),a.vectorToWorldFrame(U,xV.ni,xV.ni),a.vectorToWorldFrame(U,xV.ri,xV.ri),this.result.push(xV),this.createFrictionEquationsFromContact(xV,this.frictionResult)}}}for(var ne=D,nI=$,Ag=M,se=y,zV=0,cg=GV.length;zV!==cg;zV++){ZV.getTriangleVertices(GV[zV],ne,nI,Ag),ZV.getNormal(GV[zV],se),aV.vsub(ne,uV);var AI=uV.dot(se);if(se.scale(AI,uV),aV.vsub(uV,uV),AI=uV.distanceTo(aV),A.pointInTriangle(uV,ne,nI,Ag)&&AI<oV.radius){var xV=this.createContactEquation(Q,IV,oV,ZV);uV.vsub(aV,xV.ni),xV.ni.normalize(),xV.ni.scale(oV.radius,xV.ri),a.pointToWorldFrame(B,U,uV,uV),uV.vsub(IV.position,xV.rj),a.vectorToWorldFrame(U,xV.ni,xV.ni),a.vectorToWorldFrame(U,xV.ri,xV.ri),this.result.push(xV),this.createFrictionEquationsFromContact(xV,this.frictionResult)}}GV.length=0};var z=new s,F=new s;d.prototype[C.types.SPHERE|C.types.PLANE]=d.prototype.spherePlane=function(oV,ZV,qV,B,O,U,Q,IV){var P=this.createContactEquation(Q,IV,oV,ZV);if(P.ni.set(0,0,1),U.vmult(P.ni,P.ni),P.ni.negate(P.ni),P.ni.normalize(),P.ni.mult(oV.radius,P.ri),qV.vsub(B,z),P.ni.mult(P.ni.dot(z),F),z.vsub(F,P.rj),-z.dot(P.ni)<=oV.radius){var hV=P.ri,cV=P.rj;hV.vadd(qV,hV),hV.vsub(Q.position,hV),cV.vadd(B,cV),cV.vsub(IV.position,cV),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult)}};var k=new s,rV=new s,nV=new s;function j(oV,ZV,qV){for(var B=null,O=oV.length,U=0;U!==O;U++){var Q=oV[U],IV=k;oV[(U+1)%O].vsub(Q,IV);var P=rV;IV.cross(ZV,P);var hV=nV;qV.vsub(Q,hV);var cV=P.dot(hV);if(B===null||cV>0&&B===!0||cV<=0&&B===!1){B===null&&(B=cV>0);continue}else return!1}return!0}var VV=new s,lV=new s,iV=new s,CV=new s,AV=[new s,new s,new s,new s,new s,new s],gV=new s,eV=new s,K=new s,w=new s;d.prototype[C.types.SPHERE|C.types.BOX]=d.prototype.sphereBox=function(oV,ZV,qV,B,O,U,Q,IV){var P=this.v3pool,hV=AV;qV.vsub(B,VV),ZV.getSideNormals(hV,U);for(var cV=oV.radius,pV=!1,aV=eV,uV=K,mV=w,RV=null,kV=0,GV=0,DV=0,KV=null,gg=0,zV=hV.length;gg!==zV&&pV===!1;gg++){var jV=lV;jV.copy(hV[gg]);var xV=jV.norm();jV.normalize();var Fg=VV.dot(jV);if(Fg<xV+cV&&Fg>0){var YI=iV,AI=CV;YI.copy(hV[(gg+1)%3]),AI.copy(hV[(gg+2)%3]);var ne=YI.norm(),nI=AI.norm();YI.normalize(),AI.normalize();var Ag=VV.dot(YI),se=VV.dot(AI);if(Ag<ne&&Ag>-ne&&se<nI&&se>-nI){var vg=Math.abs(Fg-xV-cV);(KV===null||vg<KV)&&(KV=vg,GV=Ag,DV=se,RV=xV,aV.copy(jV),uV.copy(YI),mV.copy(AI),kV++)}}}if(kV){pV=!0;var EV=this.createContactEquation(Q,IV,oV,ZV);aV.mult(-cV,EV.ri),EV.ni.copy(aV),EV.ni.negate(EV.ni),aV.mult(RV,aV),uV.mult(GV,uV),aV.vadd(uV,aV),mV.mult(DV,mV),aV.vadd(mV,EV.rj),EV.ri.vadd(qV,EV.ri),EV.ri.vsub(Q.position,EV.ri),EV.rj.vadd(B,EV.rj),EV.rj.vsub(IV.position,EV.rj),this.result.push(EV),this.createFrictionEquationsFromContact(EV,this.frictionResult)}for(var cg=P.get(),le=gV,sI=0;sI!==2&&!pV;sI++)for(var Eg=0;Eg!==2&&!pV;Eg++)for(var zg=0;zg!==2&&!pV;zg++)if(cg.set(0,0,0),sI?cg.vadd(hV[0],cg):cg.vsub(hV[0],cg),Eg?cg.vadd(hV[1],cg):cg.vsub(hV[1],cg),zg?cg.vadd(hV[2],cg):cg.vsub(hV[2],cg),B.vadd(cg,le),le.vsub(qV,le),le.norm2()<cV*cV){pV=!0;var EV=this.createContactEquation(Q,IV,oV,ZV);EV.ri.copy(le),EV.ri.normalize(),EV.ni.copy(EV.ri),EV.ri.mult(cV,EV.ri),EV.rj.copy(cg),EV.ri.vadd(qV,EV.ri),EV.ri.vsub(Q.position,EV.ri),EV.rj.vadd(B,EV.rj),EV.rj.vsub(IV.position,EV.rj),this.result.push(EV),this.createFrictionEquationsFromContact(EV,this.frictionResult)}P.release(cg),cg=null;for(var wI=P.get(),ae=P.get(),EV=P.get(),hI=P.get(),vg=P.get(),At=hV.length,sI=0;sI!==At&&!pV;sI++)for(var Eg=0;Eg!==At&&!pV;Eg++)if(sI%3!==Eg%3){hV[Eg].cross(hV[sI],wI),wI.normalize(),hV[sI].vadd(hV[Eg],ae),EV.copy(qV),EV.vsub(ae,EV),EV.vsub(B,EV);var nt=EV.dot(wI);wI.mult(nt,hI);for(var zg=0;zg===sI%3||zg===Eg%3;)zg++;vg.copy(qV),vg.vsub(hI,vg),vg.vsub(ae,vg),vg.vsub(B,vg);var rh=Math.abs(nt),hh=vg.norm();if(rh<hV[zg].norm()&&hh<cV){pV=!0;var dg=this.createContactEquation(Q,IV,oV,ZV);ae.vadd(hI,dg.rj),dg.rj.copy(dg.rj),vg.negate(dg.ni),dg.ni.normalize(),dg.ri.copy(dg.rj),dg.ri.vadd(B,dg.ri),dg.ri.vsub(qV,dg.ri),dg.ri.normalize(),dg.ri.mult(cV,dg.ri),dg.ri.vadd(qV,dg.ri),dg.ri.vsub(Q.position,dg.ri),dg.rj.vadd(B,dg.rj),dg.rj.vsub(IV.position,dg.rj),this.result.push(dg),this.createFrictionEquationsFromContact(dg,this.frictionResult)}}P.release(wI,ae,EV,hI,vg)};var sV=new s,tV=new s,BV=new s,yV=new s,wV=new s,fV=new s,vV=new s,YV=new s,E=new s,WV=new s;d.prototype[C.types.SPHERE|C.types.CONVEXPOLYHEDRON]=d.prototype.sphereConvex=function(oV,ZV,qV,B,O,U,Q,IV){var P=this.v3pool;qV.vsub(B,sV);for(var hV=ZV.faceNormals,cV=ZV.faces,pV=ZV.vertices,aV=oV.radius,uV=0;uV!==pV.length;uV++){var mV=pV[uV],RV=wV;U.vmult(mV,RV),B.vadd(RV,RV);var kV=yV;if(RV.vsub(qV,kV),kV.norm2()<aV*aV){DV=!0;var GV=this.createContactEquation(Q,IV,oV,ZV);GV.ri.copy(kV),GV.ri.normalize(),GV.ni.copy(GV.ri),GV.ri.mult(aV,GV.ri),RV.vsub(B,GV.rj),GV.ri.vadd(qV,GV.ri),GV.ri.vsub(Q.position,GV.ri),GV.rj.vadd(B,GV.rj),GV.rj.vsub(IV.position,GV.rj),this.result.push(GV),this.createFrictionEquationsFromContact(GV,this.frictionResult);return}}for(var DV=!1,uV=0,KV=cV.length;uV!==KV&&DV===!1;uV++){var gg=hV[uV],zV=cV[uV],jV=fV;U.vmult(gg,jV);var xV=vV;U.vmult(pV[zV[0]],xV),xV.vadd(B,xV);var Fg=YV;jV.mult(-aV,Fg),qV.vadd(Fg,Fg);var YI=E;Fg.vsub(xV,YI);var AI=YI.dot(jV),ne=WV;if(qV.vsub(xV,ne),AI<0&&ne.dot(jV)>0){for(var nI=[],Ag=0,se=zV.length;Ag!==se;Ag++){var cg=P.get();U.vmult(pV[zV[Ag]],cg),B.vadd(cg,cg),nI.push(cg)}if(j(nI,jV,qV)){DV=!0;var GV=this.createContactEquation(Q,IV,oV,ZV);jV.mult(-aV,GV.ri),jV.negate(GV.ni);var le=P.get();jV.mult(-AI,le);var sI=P.get();jV.mult(-aV,sI),qV.vsub(B,GV.rj),GV.rj.vadd(sI,GV.rj),GV.rj.vadd(le,GV.rj),GV.rj.vadd(B,GV.rj),GV.rj.vsub(IV.position,GV.rj),GV.ri.vadd(qV,GV.ri),GV.ri.vsub(Q.position,GV.ri),P.release(le),P.release(sI),this.result.push(GV),this.createFrictionEquationsFromContact(GV,this.frictionResult);for(var Ag=0,Eg=nI.length;Ag!==Eg;Ag++)P.release(nI[Ag]);return}else for(var Ag=0;Ag!==zV.length;Ag++){var zg=P.get(),wI=P.get();U.vmult(pV[zV[(Ag+1)%zV.length]],zg),U.vmult(pV[zV[(Ag+2)%zV.length]],wI),B.vadd(zg,zg),B.vadd(wI,wI);var ae=tV;wI.vsub(zg,ae);var EV=BV;ae.unit(EV);var hI=P.get(),vg=P.get();qV.vsub(zg,vg);var At=vg.dot(EV);EV.mult(At,hI),hI.vadd(zg,hI);var nt=P.get();if(hI.vsub(qV,nt),At>0&&At*At<ae.norm2()&&nt.norm2()<aV*aV){var GV=this.createContactEquation(Q,IV,oV,ZV);hI.vsub(B,GV.rj),hI.vsub(qV,GV.ni),GV.ni.normalize(),GV.ni.mult(aV,GV.ri),GV.rj.vadd(B,GV.rj),GV.rj.vsub(IV.position,GV.rj),GV.ri.vadd(qV,GV.ri),GV.ri.vsub(Q.position,GV.ri),this.result.push(GV),this.createFrictionEquationsFromContact(GV,this.frictionResult);for(var Ag=0,Eg=nI.length;Ag!==Eg;Ag++)P.release(nI[Ag]);P.release(zg),P.release(wI),P.release(hI),P.release(nt),P.release(vg);return}P.release(zg),P.release(wI),P.release(hI),P.release(nt),P.release(vg)}for(var Ag=0,Eg=nI.length;Ag!==Eg;Ag++)P.release(nI[Ag])}}},new s,new s,d.prototype[C.types.PLANE|C.types.BOX]=d.prototype.planeBox=function(oV,ZV,qV,B,O,U,Q,IV){ZV.convexPolyhedronRepresentation.material=ZV.material,ZV.convexPolyhedronRepresentation.collisionResponse=ZV.collisionResponse,this.planeConvex(oV,ZV.convexPolyhedronRepresentation,qV,B,O,U,Q,IV)};var bV=new s,MV=new s,HV=new s,OV=new s;d.prototype[C.types.PLANE|C.types.CONVEXPOLYHEDRON]=d.prototype.planeConvex=function(oV,ZV,qV,B,O,U,Q,IV){var P=bV,hV=MV;hV.set(0,0,1),O.vmult(hV,hV);for(var cV=0,pV=HV,aV=0;aV!==ZV.vertices.length;aV++){P.copy(ZV.vertices[aV]),U.vmult(P,P),B.vadd(P,P),P.vsub(qV,pV);var uV=hV.dot(pV);if(uV<=0){var mV=this.createContactEquation(Q,IV,oV,ZV),RV=OV;hV.mult(hV.dot(pV),RV),P.vsub(RV,RV),RV.vsub(qV,mV.ri),mV.ni.copy(hV),P.vsub(B,mV.rj),mV.ri.vadd(qV,mV.ri),mV.ri.vsub(Q.position,mV.ri),mV.rj.vadd(B,mV.rj),mV.rj.vsub(IV.position,mV.rj),this.result.push(mV),cV++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(mV,this.frictionResult)}}this.enableFrictionReduction&&cV&&this.createFrictionFromAverage(cV)};var tg=new s,Cg=new s;d.prototype[C.types.CONVEXPOLYHEDRON]=d.prototype.convexConvex=function(oV,ZV,qV,B,O,U,Q,IV,P,hV,cV,pV){var aV=tg;if(!(qV.distanceTo(B)>oV.boundingSphereRadius+ZV.boundingSphereRadius)&&oV.findSeparatingAxis(ZV,qV,O,B,U,aV,cV,pV)){var uV=[],mV=Cg;oV.clipAgainstHull(qV,O,ZV,B,U,aV,-100,100,uV);for(var RV=0,kV=0;kV!==uV.length;kV++){var GV=this.createContactEquation(Q,IV,oV,ZV,P,hV),DV=GV.ri,KV=GV.rj;aV.negate(GV.ni),uV[kV].normal.negate(mV),mV.mult(uV[kV].depth,mV),uV[kV].point.vadd(mV,DV),KV.copy(uV[kV].point),DV.vsub(qV,DV),KV.vsub(B,KV),DV.vadd(qV,DV),DV.vsub(Q.position,DV),KV.vadd(B,KV),KV.vsub(IV.position,KV),this.result.push(GV),RV++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(GV,this.frictionResult)}this.enableFrictionReduction&&RV&&this.createFrictionFromAverage(RV)}};var gI=new s,Vg=new s,Yg=new s;d.prototype[C.types.PLANE|C.types.PARTICLE]=d.prototype.planeParticle=function(oV,ZV,qV,B,O,U,Q,IV){var P=gI;P.set(0,0,1),Q.quaternion.vmult(P,P);var hV=Vg;B.vsub(Q.position,hV);var cV=P.dot(hV);if(cV<=0){var pV=this.createContactEquation(IV,Q,ZV,oV);pV.ni.copy(P),pV.ni.negate(pV.ni),pV.ri.set(0,0,0);var aV=Yg;P.mult(P.dot(B),aV),B.vsub(aV,aV),pV.rj.copy(aV),this.result.push(pV),this.createFrictionEquationsFromContact(pV,this.frictionResult)}};var mg=new s;d.prototype[C.types.PARTICLE|C.types.SPHERE]=d.prototype.sphereParticle=function(oV,ZV,qV,B,O,U,Q,IV){var P=mg;P.set(0,0,1),B.vsub(qV,P);var hV=P.norm2();if(hV<=oV.radius*oV.radius){var cV=this.createContactEquation(IV,Q,ZV,oV);P.normalize(),cV.rj.copy(P),cV.rj.mult(oV.radius,cV.rj),cV.ni.copy(P),cV.ni.negate(cV.ni),cV.ri.set(0,0,0),this.result.push(cV),this.createFrictionEquationsFromContact(cV,this.frictionResult)}};var II=new o,rI=new s;new s;var iI=new s,ug=new s,QI=new s;d.prototype[C.types.PARTICLE|C.types.CONVEXPOLYHEDRON]=d.prototype.convexParticle=function(oV,ZV,qV,B,O,U,Q,IV){var P=-1,hV=iI,cV=QI,pV=null,aV=rI;if(aV.copy(B),aV.vsub(qV,aV),O.conjugate(II),II.vmult(aV,aV),oV.pointIsInside(aV)){oV.worldVerticesNeedsUpdate&&oV.computeWorldVertices(qV,O),oV.worldFaceNormalsNeedsUpdate&&oV.computeWorldFaceNormals(O);for(var uV=0,mV=oV.faces.length;uV!==mV;uV++){var RV=[oV.worldVertices[oV.faces[uV][0]]],kV=oV.worldFaceNormals[uV];B.vsub(RV[0],ug);var GV=-kV.dot(ug);(pV===null||Math.abs(GV)<Math.abs(pV))&&(pV=GV,P=uV,hV.copy(kV))}if(P!==-1){var DV=this.createContactEquation(IV,Q,ZV,oV);hV.mult(pV,cV),cV.vadd(B,cV),cV.vsub(qV,cV),DV.rj.copy(cV),hV.negate(DV.ni),DV.ri.set(0,0,0);var KV=DV.ri,gg=DV.rj;KV.vadd(B,KV),KV.vsub(IV.position,KV),gg.vadd(qV,gg),gg.vsub(Q.position,gg),this.result.push(DV),this.createFrictionEquationsFromContact(DV,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},d.prototype[C.types.BOX|C.types.HEIGHTFIELD]=d.prototype.boxHeightfield=function(oV,ZV,qV,B,O,U,Q,IV){oV.convexPolyhedronRepresentation.material=oV.material,oV.convexPolyhedronRepresentation.collisionResponse=oV.collisionResponse,this.convexHeightfield(oV.convexPolyhedronRepresentation,ZV,qV,B,O,U,Q,IV)};var ie=new s,RI=new s,Ae=[0];d.prototype[C.types.CONVEXPOLYHEDRON|C.types.HEIGHTFIELD]=d.prototype.convexHeightfield=function(oV,ZV,qV,B,O,U,Q,IV){var P=ZV.data,hV=ZV.elementSize,cV=oV.boundingSphereRadius,pV=RI,aV=Ae,uV=ie;a.pointToLocalFrame(B,U,qV,uV);var mV=Math.floor((uV.x-cV)/hV)-1,RV=Math.ceil((uV.x+cV)/hV)+1,kV=Math.floor((uV.y-cV)/hV)-1,GV=Math.ceil((uV.y+cV)/hV)+1;if(!(RV<0||GV<0||mV>P.length||kV>P[0].length)){mV<0&&(mV=0),RV<0&&(RV=0),kV<0&&(kV=0),GV<0&&(GV=0),mV>=P.length&&(mV=P.length-1),RV>=P.length&&(RV=P.length-1),GV>=P[0].length&&(GV=P[0].length-1),kV>=P[0].length&&(kV=P[0].length-1);var DV=[];ZV.getRectMinMax(mV,kV,RV,GV,DV);var KV=DV[0],gg=DV[1];if(!(uV.z-cV>gg||uV.z+cV<KV))for(var zV=mV;zV<RV;zV++)for(var jV=kV;jV<GV;jV++)ZV.getConvexTrianglePillar(zV,jV,!1),a.pointToWorldFrame(B,U,ZV.pillarOffset,pV),qV.distanceTo(pV)<ZV.pillarConvex.boundingSphereRadius+oV.boundingSphereRadius&&this.convexConvex(oV,ZV.pillarConvex,qV,pV,O,U,Q,IV,null,null,aV,null),ZV.getConvexTrianglePillar(zV,jV,!0),a.pointToWorldFrame(B,U,ZV.pillarOffset,pV),qV.distanceTo(pV)<ZV.pillarConvex.boundingSphereRadius+oV.boundingSphereRadius&&this.convexConvex(oV,ZV.pillarConvex,qV,pV,O,U,Q,IV,null,null,aV,null)}};var jI=new s,Bg=new s;d.prototype[C.types.SPHERE|C.types.HEIGHTFIELD]=d.prototype.sphereHeightfield=function(oV,ZV,qV,B,O,U,Q,IV){var P=ZV.data,hV=oV.radius,cV=ZV.elementSize,pV=Bg,aV=jI;a.pointToLocalFrame(B,U,qV,aV);var uV=Math.floor((aV.x-hV)/cV)-1,mV=Math.ceil((aV.x+hV)/cV)+1,RV=Math.floor((aV.y-hV)/cV)-1,kV=Math.ceil((aV.y+hV)/cV)+1;if(!(mV<0||kV<0||uV>P.length||kV>P[0].length)){uV<0&&(uV=0),mV<0&&(mV=0),RV<0&&(RV=0),kV<0&&(kV=0),uV>=P.length&&(uV=P.length-1),mV>=P.length&&(mV=P.length-1),kV>=P[0].length&&(kV=P[0].length-1),RV>=P[0].length&&(RV=P[0].length-1);var GV=[];ZV.getRectMinMax(uV,RV,mV,kV,GV);var DV=GV[0],KV=GV[1];if(!(aV.z-hV>KV||aV.z+hV<DV))for(var gg=this.result,zV=uV;zV<mV;zV++)for(var jV=RV;jV<kV;jV++){var xV=gg.length;ZV.getConvexTrianglePillar(zV,jV,!1),a.pointToWorldFrame(B,U,ZV.pillarOffset,pV),qV.distanceTo(pV)<ZV.pillarConvex.boundingSphereRadius+oV.boundingSphereRadius&&this.sphereConvex(oV,ZV.pillarConvex,qV,pV,O,U,Q,IV),ZV.getConvexTrianglePillar(zV,jV,!0),a.pointToWorldFrame(B,U,ZV.pillarOffset,pV),qV.distanceTo(pV)<ZV.pillarConvex.boundingSphereRadius+oV.boundingSphereRadius&&this.sphereConvex(oV,ZV.pillarConvex,qV,pV,O,U,Q,IV);var Fg=gg.length-xV;if(Fg>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(g,I,e){I.exports=Z;var t=g("../shapes/Shape"),C=g("../math/Vec3"),A=g("../math/Quaternion"),s=g("../solver/GSSolver");g("../utils/Vec3Pool"),g("../equations/ContactEquation"),g("../equations/FrictionEquation");var a=g("./Narrowphase"),o=g("../utils/EventTarget"),n=g("../collision/ArrayCollisionMatrix"),l=g("../material/Material"),c=g("../material/ContactMaterial"),d=g("../objects/Body"),h=g("../utils/TupleDictionary"),m=g("../collision/RaycastResult"),r=g("../collision/AABB"),u=g("../collision/Ray"),b=g("../collision/NaiveBroadphase");function Z(){o.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new C,this.broadphase=new b,this.bodies=[],this.solver=new s,this.constraints=[],this.narrowphase=new a(this),this.collisionMatrix=new n,this.collisionMatrixPrevious=new n,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new h,this.defaultMaterial=new l("default"),this.defaultContactMaterial=new c(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}Z.prototype=new o,new r;var p=new u;if(Z.prototype.getContactMaterial=function(T,D){return this.contactMaterialTable.get(T.id,D.id)},Z.prototype.numObjects=function(){return this.bodies.length},Z.prototype.collisionMatrixTick=function(){var T=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=T,this.collisionMatrix.reset()},Z.prototype.add=Z.prototype.addBody=function(T){this.bodies.indexOf(T)===-1&&(T.index=this.bodies.length,this.bodies.push(T),T.world=this,T.initPosition.copy(T.position),T.initVelocity.copy(T.velocity),T.timeLastSleepy=this.time,T instanceof d&&(T.initAngularVelocity.copy(T.angularVelocity),T.initQuaternion.copy(T.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=T,this.dispatchEvent(this.addBodyEvent))},Z.prototype.addConstraint=function(T){this.constraints.push(T)},Z.prototype.removeConstraint=function(T){var D=this.constraints.indexOf(T);D!==-1&&this.constraints.splice(D,1)},Z.prototype.rayTest=function(T,D,$){$ instanceof m?this.raycastClosest(T,D,{skipBackfaces:!0},$):this.raycastAll(T,D,{skipBackfaces:!0},$)},Z.prototype.raycastAll=function(T,D,$,M){return $.mode=u.ALL,$.from=T,$.to=D,$.callback=M,p.intersectWorld(this,$)},Z.prototype.raycastAny=function(T,D,$,M){return $.mode=u.ANY,$.from=T,$.to=D,$.result=M,p.intersectWorld(this,$)},Z.prototype.raycastClosest=function(T,D,$,M){return $.mode=u.CLOSEST,$.from=T,$.to=D,$.result=M,p.intersectWorld(this,$)},Z.prototype.remove=function(T){T.world=null;var D=this.bodies.length-1,$=this.bodies,M=$.indexOf(T);if(M!==-1){$.splice(M,1);for(var _=0;_!==$.length;_++)$[_].index=_;this.collisionMatrix.setNumObjects(D),this.removeBodyEvent.body=T,this.dispatchEvent(this.removeBodyEvent)}},Z.prototype.removeBody=Z.prototype.remove,Z.prototype.addMaterial=function(T){this.materials.push(T)},Z.prototype.addContactMaterial=function(T){this.contactmaterials.push(T),this.contactMaterialTable.set(T.materials[0].id,T.materials[1].id,T)},typeof performance=="undefined"&&(performance={}),!performance.now){var G=Date.now();performance.timing&&performance.timing.navigationStart&&(G=performance.timing.navigationStart),performance.now=function(){return Date.now()-G}}var X=new C;Z.prototype.step=function(T,D,$){if($=$||10,D=D||0,D===0)this.internalStep(T),this.time+=T;else{var M=Math.floor((this.time+D)/T)-Math.floor(this.time/T);M=Math.min(M,$);for(var _=performance.now(),x=0;x!==M&&(this.internalStep(T),!(performance.now()-_>T*1e3));x++);this.time+=D;for(var z=this.time%T,F=z/T,k=X,rV=this.bodies,nV=0;nV!==rV.length;nV++){var j=rV[nV];j.type!==d.STATIC&&j.sleepState!==d.SLEEPING?(j.position.vsub(j.previousPosition,k),k.scale(F,k),j.position.vadd(k,j.interpolatedPosition)):(j.interpolatedPosition.copy(j.position),j.interpolatedQuaternion.copy(j.quaternion))}}};var W={type:"postStep"},y={type:"preStep"},Y={type:"collide",body:null,contact:null},f=[],L=[],R=[],J=[];new C,new C,new C,new C,new C,new C,new C,new C,new C,new A;var H=new A,N=new A,v=new C;Z.prototype.internalStep=function(T){this.dt=T;var D=this.contacts,$=R,M=J,_=this.numObjects(),x=this.bodies,z=this.solver,F=this.gravity,k=this.doProfiling,rV=this.profile,nV=d.DYNAMIC,j,VV=this.constraints,lV=L;F.norm();var iV=F.x,CV=F.y,AV=F.z,gV=0;for(k&&(j=performance.now()),gV=0;gV!==_;gV++){var eV=x[gV];if(eV.type&nV){var K=eV.force,w=eV.mass;K.x+=w*iV,K.y+=w*CV,K.z+=w*AV}}for(var gV=0,sV=this.subsystems.length;gV!==sV;gV++)this.subsystems[gV].update();k&&(j=performance.now()),$.length=0,M.length=0,this.broadphase.collisionPairs(this,$,M),k&&(rV.broadphase=performance.now()-j);var tg=VV.length;for(gV=0;gV!==tg;gV++){var tV=VV[gV];if(!tV.collideConnected)for(var BV=$.length-1;BV>=0;BV-=1)(tV.bodyA===$[BV]&&tV.bodyB===M[BV]||tV.bodyB===$[BV]&&tV.bodyA===M[BV])&&($.splice(BV,1),M.splice(BV,1))}this.collisionMatrixTick(),k&&(j=performance.now());var yV=f,wV=D.length;for(gV=0;gV!==wV;gV++)yV.push(D[gV]);D.length=0;var fV=this.frictionEquations.length;for(gV=0;gV!==fV;gV++)lV.push(this.frictionEquations[gV]);this.frictionEquations.length=0,this.narrowphase.getContacts($,M,this,D,yV,this.frictionEquations,lV),k&&(rV.narrowphase=performance.now()-j),k&&(j=performance.now());for(var gV=0;gV<this.frictionEquations.length;gV++)z.addEquation(this.frictionEquations[gV]);for(var vV=D.length,YV=0;YV!==vV;YV++){var tV=D[YV],eV=tV.bi,E=tV.bj;tV.si,tV.sj;var WV;if(eV.material&&E.material?WV=this.getContactMaterial(eV.material,E.material)||this.defaultContactMaterial:WV=this.defaultContactMaterial,WV.friction,eV.material&&E.material&&(eV.material.friction>=0&&E.material.friction>=0&&eV.material.friction*E.material.friction,eV.material.restitution>=0&&E.material.restitution>=0&&(tV.restitution=eV.material.restitution*E.material.restitution)),z.addEquation(tV),eV.allowSleep&&eV.type===d.DYNAMIC&&eV.sleepState===d.SLEEPING&&E.sleepState===d.AWAKE&&E.type!==d.STATIC){var bV=E.velocity.norm2()+E.angularVelocity.norm2(),MV=Math.pow(E.sleepSpeedLimit,2);bV>=MV*2&&(eV._wakeUpAfterNarrowphase=!0)}if(E.allowSleep&&E.type===d.DYNAMIC&&E.sleepState===d.SLEEPING&&eV.sleepState===d.AWAKE&&eV.type!==d.STATIC){var HV=eV.velocity.norm2()+eV.angularVelocity.norm2(),OV=Math.pow(eV.sleepSpeedLimit,2);HV>=OV*2&&(E._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(eV,E,!0),this.collisionMatrixPrevious.get(eV,E)||(Y.body=E,Y.contact=tV,eV.dispatchEvent(Y),Y.body=eV,E.dispatchEvent(Y))}for(k&&(rV.makeContactConstraints=performance.now()-j,j=performance.now()),gV=0;gV!==_;gV++){var eV=x[gV];eV._wakeUpAfterNarrowphase&&(eV.wakeUp(),eV._wakeUpAfterNarrowphase=!1)}var tg=VV.length;for(gV=0;gV!==tg;gV++){var tV=VV[gV];tV.update();for(var BV=0,Cg=tV.equations.length;BV!==Cg;BV++){var gI=tV.equations[BV];z.addEquation(gI)}}z.solve(T,this),k&&(rV.solve=performance.now()-j),z.removeAllEquations();var Vg=Math.pow;for(gV=0;gV!==_;gV++){var eV=x[gV];if(eV.type&nV){var Yg=Vg(1-eV.linearDamping,T),mg=eV.velocity;mg.mult(Yg,mg);var II=eV.angularVelocity;if(II){var rI=Vg(1-eV.angularDamping,T);II.mult(rI,II)}}}for(this.dispatchEvent(y),gV=0;gV!==_;gV++){var eV=x[gV];eV.preStep&&eV.preStep.call(eV)}k&&(j=performance.now());var iI=H,ug=N,QI=this.stepnumber,ie=d.DYNAMIC|d.KINEMATIC,RI=QI%(this.quatNormalizeSkip+1)===0,Ae=this.quatNormalizeFast,jI=T*.5;for(t.types.PLANE,t.types.CONVEXPOLYHEDRON,gV=0;gV!==_;gV++){var Bg=x[gV],oV=Bg.force,ZV=Bg.torque;if(Bg.type&ie&&Bg.sleepState!==d.SLEEPING){var qV=Bg.velocity,B=Bg.angularVelocity,O=Bg.position,U=Bg.quaternion,Q=Bg.invMass,IV=Bg.invInertiaWorld;qV.x+=oV.x*Q*T,qV.y+=oV.y*Q*T,qV.z+=oV.z*Q*T,Bg.angularVelocity&&(IV.vmult(ZV,v),v.mult(T,v),v.vadd(B,B)),O.x+=qV.x*T,O.y+=qV.y*T,O.z+=qV.z*T,Bg.angularVelocity&&(iI.set(B.x,B.y,B.z,0),iI.mult(U,ug),U.x+=jI*ug.x,U.y+=jI*ug.y,U.z+=jI*ug.z,U.w+=jI*ug.w,RI&&(Ae?U.normalizeFast():U.normalize())),Bg.aabb&&(Bg.aabbNeedsUpdate=!0),Bg.updateInertiaWorld&&Bg.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,k&&(rV.integrate=performance.now()-j),this.time+=T,this.stepnumber+=1,this.dispatchEvent(W),gV=0;gV!==_;gV++){var eV=x[gV],P=eV.postStep;P&&P.call(eV)}if(this.allowSleep)for(gV=0;gV!==_;gV++)x[gV].sleepTick(this.time)},Z.prototype.clearForces=function(){for(var T=this.bodies,D=T.length,$=0;$!==D;$++){var M=T[$];M.force,M.torque,M.force.set(0,0,0),M.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})})(ZI);class RX extends ZI.exports.World{constructor(){super(),autobind(this),this.nodes=[],this.timeScale=1,this.allowSleep=!1,this.broadphase=new ZI.exports.SAPBroadphase(this),this.solver.iterations=10,this.solver.tolerance=1e-4,this.settings={Arena:new ZI.exports.Material,Particles:new ZI.exports.Material},this.groups={Arena:1,Particles:2};const V=[new ZI.exports.ContactMaterial(this.settings.Arena,this.settings.Particles,{friction:.1,restitution:.5})];Object.assign(this.defaultContactMaterial,{friction:.3,restitution:.2,contactEquationStiffness:1e6,contactEquationRegularizationTime:1});for(const g in this.settings)this.addMaterial(this.settings[g]);for(let g=0,I=V.length;g<I;g++)this.addContactMaterial(V[g]);q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("physics",this.update)}add(V){this.nodes.push(V)}getHalfExtents(V){const g=new pg;V.isMesh||V.isObject3D?g.setFromObject(V):g.setFromArray(V.attributes.position.array);const I=g.getSize(new S),e=g.getCenter(new S),t=new S().copy(I).multiplyScalar(.5),C=new ZI.exports.Vec3().copy(t);return{size:I,center:e,halfExtents:C}}update(){for(let I=0,e=this.nodes.length;I<e;I++){const t=this.nodes[I];this[t.isDisabled?"removeBody":"addBody"](t)}const{timeScale:V,gravity:g}=q.settings.physics;this.timeScale=V,this.gravity.set(0,-g,0),this.step(1/60*this.timeScale)}}class YX extends BI{constructor(){super(),autobind(this),this.volume=1,this.muted=!1,this.cache={},this.audioListener=new yB,this.audioListener.setMasterVolume(0),XV.camera.add(this.audioListener)}initialize(){this.audioListener.context.resume(),this.addEventListeners()}addEventListeners(){addEventListener("visibilitychange",this.onVisibilityChange),Application.addEventListener("update",this.update)}update(){const V=this.disabled?0:this.volume;this.audioListener.setMasterVolume(V)}play(V,{volume:g=1,loop:I=!1,playbackRate:e=!1}={}){if(this.cache[V])return this.cache[V].currentTime=0,this.cache[V].play(),this.cache[V];const t=new RB(this.audioListener);return t.setBuffer(buffer),t.setVolume(g),t.setLoop(I),t.setPlaybackRate(e),t.play(),t}pause(V){!this.cache[V]||this.cache[V].pause()}toggle(){this[this.muted?"unmute":"mute"]()}mute(){this.muted||(this.muted=!0,LV({targets:this,easing:"easeOutQuart",duration:500,volume:0}),this.dispatchEvent({type:"mute"}))}unmute(){!this.muted||(this.muted=!1,LV({targets:this,easing:"easeOutQuart",duration:500,volume:1}),this.dispatchEvent({type:"unmute"}))}onVisibilityChange(){this.disabled=document.hidden,this.update()}}class wX extends BI{constructor(){super(),autobind(this),this.enabled=!0,this.preventDefault=!1,this.size=new dV,this.onResize()}getTouch(V){const g=Object.keys(this.touchList);return g.length?this.touchList[g[V]||g.pop()]:!1}getTouches(){return Object.values(this.touchList)}onStart(V){if(!!this.enabled){this.isActive=!0;for(let g=0,I=V.touches.length;g<I;g++){const{clientX:e,clientY:t,identifier:C}=V.touches[g];if(this.touchList[C])continue;const A=new HX(this.size);A.position.set(e,t),A.dispatchEvent({type:"touchStart"}),this.touchList[C]=A}this.preventEvent(V),this.dispatchEvent({type:"touchStart"})}}onMove(V){if(!!this.enabled){for(let g=0,I=V.touches.length;g<I;g++){const{clientX:e,clientY:t,identifier:C}=V.touches[g],A=this.touchList[C];A.position.set(e,t),A.dispatchEvent({type:"touchMove"})}this.preventEvent(V),this.dispatchEvent({type:"touchMove",touches:V.touches})}}onEnd(V){if(!this.enabled)return;this.isActive=!!this.touchList.length;const{changedTouches:g,touches:I}=V;for(let e=0,t=g.length;e<t;e++){const C=g[e];this.touchList[C.identifier].dispatchEvent({type:"touchEnd"}),delete this.touchList[C.identifier]}this.preventEvent(V),this.dispatchEvent({type:"touchEnd",touches:I})}preventEvent(V){!this.preventDefault||V.preventDefault()}preventGesture(V){V.preventDefault()}onResize(){const{InputCapture:V}=q.DOMElements,{clientWidth:g,clientHeight:I}=V;this.size.set(g,I)}reset(){this.touchList={}}addEventListeners(){if(this.hasEventListeners)return;this.hasEventListeners=!0,this.reset();const{InputCapture:V}=q.DOMElements,g={passive:!1};V.addEventListener("touchstart",this.onStart,g),V.addEventListener("touchmove",this.onMove,g),V.addEventListener("touchend",this.onEnd,g),V.addEventListener("gesturestart",this.preventGesture,g),q.addEventListener("resize",this.onResize)}removeEventListeners(){if(!this.hasEventListeners)return;this.hasEventListeners=!1;const{InputCapture:V}=q.DOMElements;V.removeEventListener("touchstart",this.onStart),V.removeEventListener("touchmove",this.onMove),V.removeEventListener("touchend",this.onEnd),V.removeEventListener("gesturestart",this.preventGesture),q.removeEventListener("resize",this.onResize)}}class HX extends BI{constructor(V){super(),this.size=V,this.position=new dV}getPosition(V){return V.copy(this.position)}getNormalizedPosition(V){return V.copy(this.position),V.x=Math.mapLinear(V.x,0,this.size.x,-1,1),V.y=Math.mapLinear(V.y,0,this.size.y,1,-1),V}}class fX extends BI{constructor(){super(),autobind(this),this.keys={}}isDown(V){return this.keys[V]}onKeyDown(V){if(V.key==="Tab"&&V.preventDefault(),V.key!="ArrowRight"&&V.key!="ArrowLeft"&&V.key!="ArrowUp"&&V.key!="ArrowDown"){V.preventDefault();return}this.keys[V.code]=!0,this.dispatchEvent({type:"keyDown",originalEvent:V,key:V.key,code:V.code})}onKeyUp(V){if(V.key==="Tab"&&V.preventDefault(),V.key!="ArrowRight"&&V.key!="ArrowLeft"&&V.key!="ArrowUp"&&V.key!="ArrowDown"){V.preventDefault();return}delete this.keys[V.code],this.dispatchEvent({type:"keyUp",originalEvent:V,key:V.key,code:V.code})}addEventListeners(){this.hasEventListeners||(this.hasEventListeners=!0,addEventListener("keyup",this.onKeyUp),addEventListener("keydown",this.onKeyDown))}removeEventListeners(){!this.hasEventListeners||(this.hasEventListeners=!1,removeEventListener("keyup",this.onKeyUp),removeEventListener("keydown",this.onKeyDown))}}class SX extends BI{constructor(){super(),autobind(this),this.enabled=!0,this.preventDefault=!1,this.buttons=["left",null,"right"],this.position=new dV,this.size=new dV,this.onResize()}getPosition(V){return V.copy(this.position)}getNormalizedPosition(V){return V.copy(this.position),V.x=Math.mapLinear(V.x,0,this.size.x,-1,1),V.y=Math.mapLinear(V.y,0,this.size.y,1,-1),V}onDown(V){if(!this.enabled)return;const{button:g,clientX:I,clientY:e}=V;this.isDown=!0,this.button=this.buttons[g],this.position.set(I,e),this.preventEvent(V),this.dispatchEvent({type:"down"})}onMove(V){if(!this.enabled)return;const{clientX:g,clientY:I}=V;this.isMoving=!0,this.timeout=q.time.setDelay(()=>this.isMoving=!1,250),this.position.set(g,I),this.preventEvent(V),this.dispatchEvent({type:"move"})}onUp(){!this.enabled||!this.isDown||(this.isDown=!1,this.preventEvent(event),this.dispatchEvent({type:"up"}))}onDoubleClick(){this.preventEvent(event),this.dispatchEvent({type:"doubleClick"})}onClick(){this.preventEvent(event),this.dispatchEvent({type:"click"})}onResize(){const{InputCapture:V}=q.DOMElements,{clientWidth:g,clientHeight:I}=V;this.size.set(g,I)}preventEvent(V){!this.preventDefault||V.preventDefault()}reset(){this.position.copy(this.size).multiplyScalar(.5)}addEventListeners(){if(this.hasEventListeners)return;this.hasEventListeners=!0,this.reset();const{InputCapture:V}=q.DOMElements;V.addEventListener("mousedown",this.onDown,!1),window.addEventListener("mousemove",this.onMove,!1),window.addEventListener("mouseup",this.onUp,!1),V.addEventListener("click",this.onClick,!1),V.addEventListener("dblclick",this.onDoubleClick,!1),V.addEventListener("contextmenu",this.preventEvent,!1),q.addEventListener("resize",this.onResize)}removeEventListeners(){if(!this.hasEventListeners)return;this.hasEventListeners=!1;const{InputCapture:V}=q.DOMElements;V.removeEventListener("mousedown",this.onDown,!1),window.removeEventListener("mousemove",this.onMove,!1),window.removeEventListener("mouseup",this.onUp,!1),window.removeEventListener("mouseleave",this.onUp,!1),V.removeEventListener("click",this.onClick,!1),V.removeEventListener("dblclick",this.onDoubleClick,!1),q.removeEventListener("resize",this.onResize)}}class FX extends BI{constructor(){super(),autobind(this),this.radius=50,this.isEnabled=!0,this.isActive=!1,this.size=new dV,this.direction=new dV,this.position=new dV,this.angle=0}addEventListeners(){const{multiTouch:V,mouse:g}=XV;V.addEventListener("touchStart",this.onInputStart),V.addEventListener("touchMove",this.onInputMove),V.addEventListener("touchEnd",this.onInputEnd),g.addEventListener("down",this.onInputStart),g.addEventListener("move",this.onInputMove),g.addEventListener("up",this.onInputEnd),q.addEventListener("update",this.update)}onInputStart(){this.isActive=!0;const{multiTouch:V,mouse:g}=XV;(V.getTouch()||g).getPosition(this.position),this.dispatchEvent({type:"start"})}onInputMove(){if(!this.isActive)return;const{multiTouch:V,mouse:g}=XV,e=(V.getTouch()||g).getPosition(dV.get()),t=dV.get().copy(e).sub(this.position).divide(this.size);t.length()>0&&(this.direction.copy(t).clampLength(0,1),this.angle=Math.PI*2-this.direction.angle(),this.dispatchEvent({type:"move"})),dV.release(e,t)}onInputEnd(){this.isActive=!1,this.dispatchEvent({type:"end"})}update(){if(this.size.setScalar(this.radius).multiplyScalar(2),!this.isActive){const V=dV.get();this.direction.lerp(V,.1),dV.release(V)}}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}}class vX extends jg{constructor(){super(45,1,1,400),autobind(this),this.frustum=new Ki,this.object=new UV,this.offset=new S,this.target=new S,this.object=new UV,this.objectVelocity=new S(0,0,0),this.pos=new S(0,0,0),this.idleFactor=1,q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("applySettings",this.applySettings),q.addEventListener("beforeUpdate",this.beforeUpdate),q.addEventListener("beforeRender",this.update),q.addEventListener("onViewChange",this.onViewChange)}applySettings(){const{fov:V,near:g,far:I,target:e,position:t}=q.settings.camera;this.target.copy(e),this.position.copy(t),this.initFov=V,this.fov=V,this.near=g,this.far=I}setMode(V){V==="EagleEye"?LV({targets:q.settings.camera.position,easing:"easeInOutExpo",duration:2e3,fov:75,y:160,z:90}):this.onViewChange()}onViewChange(V){return SV(this,null,function*(){const{currentViewID:g,previousViewID:I}=V||q;I||(yield q.time.wait(500)),console.log(">>>>>>>>>>>>>>>>>>>>>>> onViewChange :",g);const e=S.get(),t=S.get();g.match(/(Home)/)?this.currentView="home":g.match(/(SkinSelector)/)?this.currentView="skin":this.currentView=null,g.match(/(Home)/)?e.set(0,20,25):g.match(/SkinSelector/)?e.set(0,20,30):g.match(/(EndScreen)/)?e.set(0,30,40):g.match(/(GameOver)/)?e.set(0,50,35):g.match(/(Game)/)?e.set(0,85,55):e.set(0,25,15),g.match(/SkinSelector/)?t.set(0,2,0):t.set(0,0,0);const C=g.match(/(GameOver|Home)/)?4:1,A=I?1e3:2e3;LV({targets:q.settings.camera.position,easing:"easeOutExpo",duration:A,fov:55,x:e.x,y:e.y,z:e.z}),LV({targets:this.offset,easing:"easeOutExpo",duration:A,x:t.x,y:t.y,z:t.z}),LV({targets:this,easing:"easeOutExpo",duration:2e3,idleFactor:C}),S.release(e,t)})}reset(){const{position:V,lastPosition:g,velocity:I}=q.user.character;this.object.position.copy(V),this.lastPosition=g,this.objectVelocity=I,XV.camera.update(),XV.scene.lighting.update()}beforeUpdate(){this.computeFrustum()}update(){let V=1e3/window.innerWidth*.7;this.position.add(this.object.position).add(this.offset);const g=S.get().copy(this.lastPosition).add(this.offset);this.pos.copy(this.position),this.pos.y-=140,this.pos.z-=70,this.currentView=="home"||this.currentView=="skin"?(this.fov=60,this.lookAt(g)):(V=V>1.1?1.1:V,this.position.y+=80*V,this.position.z+=2*V,this.fov=this.initFov,this.lookAt(this.pos));const I=S.get().randomize();q.time.elapsedTime-this.shakeStartTime<this.shakeDuration&&this.position.add(I.randomize(this.shakeAmount)),S.release(g,I),this.aspect=q.viewport.aspect,this.updateProjectionMatrix(),this.computeFrustum()}shake(V=500,g=1){this.shakeDuration=V,this.shakeAmount=g,this.shakeStartTime=q.time.elapsedTime}computeFrustum(){const V=JV.get().copy(this.projectionMatrix).multiply(this.matrixWorldInverse);this.frustum.setFromProjectionMatrix(V),JV.release(V)}intersects(V){return this.frustum.intersectsSphere(V)}}var NX=`#ifdef USE_SPHERE\r
\r
varying vec3 vWorldPosition;\r
\r
#else\r
\r
varying vec2 vUv;\r
\r
#endif\r
\r
void main() {\r
\r
	#ifdef USE_SPHERE\r
\r
	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\r
	vWorldPosition = worldPosition.xyz;\r
\r
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1. );\r
\r
	#else\r
\r
	vUv = uv;\r
	gl_Position = vec4( position, 1. );\r
\r
	#endif\r
\r
}\r
`,KX=`uniform vec3 topColor;\r
uniform vec3 bottomColor;\r
\r
#ifdef USE_SPHERE\r
\r
uniform float offset;\r
uniform float exponent;\r
varying vec3 vWorldPosition;\r
\r
#else\r
\r
varying vec2 vUv;\r
\r
#endif\r
\r
void main() {\r
\r
	#ifdef USE_SPHERE\r
\r
	float h = normalize( vWorldPosition + offset ).y;\r
	gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , .0 ), exponent ), .0 ) ), 1. );\r
\r
	#else\r
\r
	float ratio = vUv.y;\r
	vec3 color = mix( bottomColor, topColor, ratio );\r
	gl_FragColor = vec4( color, 1. );\r
\r
	#endif\r
\r
}\r
`;class JX extends EI{constructor(V){super(),autobind(this),this.type="BasicMaterial",this.vertexShader=NX,this.fragmentShader=KX,V?(this.side=wg,this.defines={USE_SPHERE:!0}):this.depthTest=!1,this.uniforms=Object.assign({topColor:{value:new NV},bottomColor:{value:new NV},offset:{value:30},exponent:{value:.5}},St.clone(tI.standard.uniforms)),q.addEventListener("update",this.update)}update(){const{topColor:V,bottomColor:g}=q.settings.lighting.sky;this.uniforms.topColor.value.set(V),this.uniforms.bottomColor.value.set(g)}}class MX extends og{constructor(V=!1){const g=V?new Bl(800,32,15):new Ft(2,2),I=new JX(V);super(g,I),this.renderOrder=XV.renderOrders.Sky,this.frustumCulled=!1}}class xX extends UV{constructor(){super(),autobind(this),this.spotLightFactor=1,this.ambientLight=new wl,this.add(this.ambientLight),this.hemisphereLight=new Xl,this.hemisphereLight.position.set(0,50,0),this.add(this.hemisphereLight),this.directionalLight=new en,this.directionalLight.direction=new S,this.directionalLight.shadow.camera.far=100,this.add(this.directionalLight),this.add(this.directionalLight.target),this.spotLight=new Yl,this.spotLight.direction=new S,this.add(this.spotLight),this.add(this.spotLight.target),this.setShadowCameraSize(this.directionalLight,10),q.addEventListener("applySettings",this.applySettings),q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(V){const{currentViewID:g}=V,{inGame:I}=q,{directionalLight:e,spotLight:t}=q.settings.lighting,C=g.match(/(Home|SkinSelector)/g)?.1:0,A=I?100:10;LV({targets:t,intensity:C,easing:"easeOutExpo",duration:1e3}),LV({targets:e,shadowCameraSize:A,easing:"easeOutExpo",duration:1e3})}applySettings(){const{ambientLight:V,hemisphereLight:g,directionalLight:I,spotLight:e}=q.settings.lighting;this.ambientLight.intensity=V.intensity,this.ambientLight.color.set(V.color),this.hemisphereLight.intensity=g.intensity,this.hemisphereLight.color.set(g.skyColor),this.hemisphereLight.groundColor.set(g.groundColor),this.directionalLight.castShadow=I.castShadow,this.directionalLight.intensity=I.intensity,this.directionalLight.color.set(I.color),this.directionalLight.direction.copy(I.position),this.spotLight.intensity=e.intensity*this.spotLightFactor,this.spotLight.distance=e.distance,this.spotLight.angle=e.angle,this.spotLight.penumbra=e.penumbra,this.spotLight.decay=e.decay,this.spotLight.focus=e.focus,this.spotLight.color.set(e.color),this.spotLight.direction.copy(e.position),this.setShadowCameraSize(this.directionalLight,I.shadowCameraSize);const t=parseInt(I.shadowMapSize);this.mapSize!==t&&this.setShadowMapSize(this.directionalLight,t)}update(){const{position:V}=XV.camera.object,g=S.get().copy(V);this.directionalLight.target.position.copy(g),this.directionalLight.position.copy(g).add(this.directionalLight.direction),this.spotLight.target.position.copy(g),this.spotLight.position.copy(g).add(this.spotLight.direction),S.release(g)}setShadowCameraSize(V,g){const{camera:I}=V.shadow;I.top=g,I.right=g,I.bottom=-g,I.left=-g,I.updateProjectionMatrix()}setShadowMapSize(V,g){this.mapSize=g,V.shadow.mapSize.width=g,V.shadow.mapSize.height=g,V.shadow.map&&(V.shadow.map.dispose(),this.directionalLight.shadow.map=null)}}class kX extends og{constructor(){const{textures:V}=XV.assets,g=250,I=3,e=new OA(g,g,I,128);e.translate(0,-I*.5,0);const t=new Hg({envMap:V.EnvMap,color:"#dce6ed",metalness:0,roughness:.95});super(e,t),autobind(this),this.radius=g,this.receiveShadow=!0,this.body=new ZI.exports.Body,this.body.addShape(new ZI.exports.Plane),this.body.quaternion.setFromAxisAngle(new ZI.exports.Vec3(1,0,0),-Math.PI*.5);const{settings:C,groups:A}=XV.physics;this.body.material=C.Arena,this.body.collisionFilterGroup=A.Arena,this.body.collisionFilterMask=A.Particles,this.area=Math.pow(g-2,2)*Math.PI,XV.physics.add(this.body)}}class zX extends og{constructor(){const{textures:V}=XV.assets,g=new Ft(1250,1250);g.rotateX(-Math.PI*.5);const I=new Hg({envMap:V.EnvMap,color:"#416663",metalness:0,roughness:.95});super(g,I),autobind(this),this.receiveShadow=!0,q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(){this.visible=!q.inGame}update(){const{character:V}=q.user;this.position.copy(V.position),this.position.y+=.01}}class TX{constructor(){this.position=new S,this.normal=new S,this.extrusion=new S,this.normal.set(0,1,0)}copy(V){this.position.copy(V.position),this.extrusion.copy(V.extrusion),this.normal.copy(V.normal)}}class LX extends $V{constructor(V){super(),this.vertices=Array.from({length:V},()=>new TX),this.sides=[],this.indices=[],this.uvs=[],this.counters=[];for(let g=0,I=this.vertices.length;g<I;g++){const e=g/this.vertices.length;this.counters.push(e,e)}this.initialize(),this.update(!0)}initialize(){const V=1/this.vertices.length;for(let I=0,e=this.vertices.length;I<e;I++)this.sides.push(1,-1),this.uvs.push(I*V,0,I*V,1);for(let I=0;I<this.vertices.length-1;I++){const e=I*2;this.indices.push(e,e+1,e+2),this.indices.push(e+2,e+1,e+3)}this.setAttribute("side",this.getBufferAttribute(this.sides,1)),this.setAttribute("uv",this.getBufferAttribute(this.uvs,2)),this.setAttribute("counters",this.getBufferAttribute(this.counters,1));const g=3*this.vertices.length;this.setAttribute("position",this.getBufferAttribute(new Array(g*2),3)),this.setAttribute("normal",this.getBufferAttribute(new Array(g*2),3)),this.setAttribute("extrusion",this.getBufferAttribute(new Array(g*2),3)),this.positions=this.attributes.position.array,this.normals=this.attributes.normal.array,this.extrusions=this.attributes.extrusion.array,this.setIndex(new qg(new Uint16Array(this.indices),1))}update(V=!1){for(let g=0,I=this.vertices.length;g<I;g++){const{position:e,extrusion:t,normal:C}=this.vertices[g];this.positions[g*6+0]=this.positions[g*6+3]=e.x,this.positions[g*6+1]=this.positions[g*6+4]=e.y,this.positions[g*6+2]=this.positions[g*6+5]=e.z,this.extrusions[g*6+0]=this.extrusions[g*6+3]=t.x,this.extrusions[g*6+1]=this.extrusions[g*6+4]=t.y,this.extrusions[g*6+2]=this.extrusions[g*6+5]=t.z,V&&(this.normals[g*6+0]=this.normals[g*6+3]=C.x,this.normals[g*6+1]=this.normals[g*6+4]=C.y,this.normals[g*6+2]=this.normals[g*6+5]=C.z)}this.attributes.position.needsUpdate=!0,this.attributes.extrusion.needsUpdate=!0,this.attributes.normal.needsUpdate=V}getBufferAttribute(V,g){return new qg(new Float32Array(V),g)}}class UX extends og{constructor(V,g){const{materials:I}=XV.assets,{territory:e,stencilRef:t,playerID:C}=V,A=I.Mask.clone();A.stencilRef=t,super(g,A),autobind(this),this.player=V,this.maskID=`Trail_00${C}`,this.renderOrder=XV.renderOrders.Mask,this.position.set(0,e.height+1.5,0),I[this.maskID]=A,q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update)}update(){const{size:V,isDead:g}=this.player;this.visible=!g,this.material.lineWidth=V*4}}class DX extends og{constructor(V){const{materials:g}=XV.assets,{stencilRef:I,playerID:e}=V,t=g.Trail.clone();t.stencilRef=I;const C=new LX(4e3);super(C,t),autobind(this),this.player=V,this.trailID=`Trail_00${e}`,this.visible=!1,this.receiveShadow=!0,this.renderOrder=XV.renderOrders.Trail,this.boundingBox=new pg,this.boundingSphere=new XI,this.position.set(0,V.playerID*.001+.01,0),this.geometry.update(),this.mask=new UX(V,C),this.add(this.mask),g[this.trailID]=t,q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){this.player.addEventListener("reset",this.onPlayerReset),this.player.addEventListener("exit",this.onPlayerExit),this.player.addEventListener("die",this.onPlayerDie),this.player.addEventListener("revive",this.onPlayerReset),q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(V){const{currentViewID:g}=V;this.isHidden=!g.match(/(Game|GameOver)/)}onPlayerReset(){this.animation&&this.animation.remove(this),this.linearGradientOffset=0,this.count=0}onPlayerExit(){const{vertices:V}=this.geometry,g=2,I=V.slice(this.count-g,this.count);this.boundingBox.makeEmpty(),this.count=g;for(let e=0,t=I.length;e<t;e++){const C=I[e];V[e].copy(C),this.boundingBox.expandByPoint(C)}this.setVertices()}onPlayerDie(){if(!q.inGame)return;const{vertices:V}=this.geometry;this.linearGradientOffset=1-this.count/V.length,this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"easeOutExpo",duration:2500,linearGradientOffset:1})}onPlayerRevive(){this.linearGradientOffset=0}setVertices(){const{character:V}=this.player,{vertices:g}=this.geometry;if(this.count===void 0||this.count>=g.length)return;const{position:I,extrusion:e}=g[this.count];I.copy(V.position),e.set(1,0,0).applyQuaternion(V.quaternion),this.boundingBox.expandByPoint(I),this.boundingBox.getBoundingSphere(this.boundingSphere),this.geometry.boundingSphere=this.boundingSphere,this.geometry.setDrawRange(0,6*this.count),this.geometry.update(),this.count++}update(){const{size:V,inOwnTerritory:g}=this.player,I=XV.camera.intersects(this.boundingSphere);this.visible=I&&!this.isHidden&&!g,q.inGame&&(this.material.linearGradientOffset=this.linearGradientOffset,this.material.lineWidth=4*V,this.setVertices())}}class EX{constructor(V){autobind(this),this.worker=V,this.worker.onmessage=this.onmessage,this.globalMessageID=0,this.resolves={},this.rejects={}}send(V){const g=this.globalMessageID++;return new Promise((I,e)=>{this.resolves[g]=I,this.rejects[g]=e,this.worker.postMessage({messageID:g,message:V})})}onmessage(V){const{messageID:g,error:I,message:e}=V.data,t=this.resolves[g],C=this.rejects[g];e&&t?t(e):C&&C(I||"Got nothing"),delete this.resolves[g],delete this.rejects[g]}}const QX=new Blob([atob("KCgpID0+IHsKICB2YXIgX19jcmVhdGUgPSBPYmplY3QuY3JlYXRlOwogIHZhciBfX2RlZlByb3AgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgdmFyIF9fZ2V0T3duUHJvcERlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogIHZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwogIHZhciBfX2dldFByb3RvT2YgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Y7CiAgdmFyIF9faGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CiAgdmFyIF9fY29tbW9uSlMgPSAoY2IsIG1vZCkgPT4gZnVuY3Rpb24gX19yZXF1aXJlKCkgewogICAgcmV0dXJuIG1vZCB8fCAoMCwgY2JbX19nZXRPd25Qcm9wTmFtZXMoY2IpWzBdXSkoKG1vZCA9IHsgZXhwb3J0czoge30gfSkuZXhwb3J0cywgbW9kKSwgbW9kLmV4cG9ydHM7CiAgfTsKICB2YXIgX19leHBvcnQgPSAodGFyZ2V0LCBhbGwpID0+IHsKICAgIGZvciAodmFyIG5hbWUgaW4gYWxsKQogICAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwogIH07CiAgdmFyIF9fY29weVByb3BzID0gKHRvLCBmcm9tLCBleGNlcHQsIGRlc2MpID0+IHsKICAgIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSAib2JqZWN0IiB8fCB0eXBlb2YgZnJvbSA9PT0gImZ1bmN0aW9uIikgewogICAgICBmb3IgKGxldCBrZXkgb2YgX19nZXRPd25Qcm9wTmFtZXMoZnJvbSkpCiAgICAgICAgaWYgKCFfX2hhc093blByb3AuY2FsbCh0bywga2V5KSAmJiBrZXkgIT09IGV4Y2VwdCkKICAgICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTsKICAgIH0KICAgIHJldHVybiB0bzsKICB9OwogIHZhciBfX3RvRVNNID0gKG1vZCwgaXNOb2RlTW9kZSwgdGFyZ2V0KSA9PiAodGFyZ2V0ID0gbW9kICE9IG51bGwgPyBfX2NyZWF0ZShfX2dldFByb3RvT2YobW9kKSkgOiB7fSwgX19jb3B5UHJvcHMoaXNOb2RlTW9kZSB8fCAhbW9kIHx8ICFtb2QuX19lc01vZHVsZSA/IF9fZGVmUHJvcCh0YXJnZXQsICJkZWZhdWx0IiwgeyB2YWx1ZTogbW9kLCBlbnVtZXJhYmxlOiB0cnVlIH0pIDogdGFyZ2V0LCBtb2QpKTsKCiAgLy8gbm9kZV9tb2R1bGVzL2xpYnRlc3MvbGlidGVzcy5taW4uanMKICB2YXIgcmVxdWlyZV9saWJ0ZXNzX21pbiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9saWJ0ZXNzL2xpYnRlc3MubWluLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbjsKICAgICAgZnVuY3Rpb24gdChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEuYiA9PT0gYi5iICYmIGEuYSA9PT0gYi5hOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHUoYSwgYikgewogICAgICAgIHJldHVybiBhLmIgPCBiLmIgfHwgYS5iID09PSBiLmIgJiYgYS5hIDw9IGIuYTsKICAgICAgfQogICAgICBmdW5jdGlvbiB2KGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IGIuYiAtIGEuYiwgZSA9IGMuYiAtIGIuYjsKICAgICAgICByZXR1cm4gMCA8IGQgKyBlID8gZCA8IGUgPyBiLmEgLSBhLmEgKyBkIC8gKGQgKyBlKSAqIChhLmEgLSBjLmEpIDogYi5hIC0gYy5hICsgZSAvIChkICsgZSkgKiAoYy5hIC0gYS5hKSA6IDA7CiAgICAgIH0KICAgICAgZnVuY3Rpb24geChhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBiLmIgLSBhLmIsIGUgPSBjLmIgLSBiLmI7CiAgICAgICAgcmV0dXJuIDAgPCBkICsgZSA/IChiLmEgLSBjLmEpICogZCArIChiLmEgLSBhLmEpICogZSA6IDA7CiAgICAgIH0KICAgICAgZnVuY3Rpb24geihhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEuYSA8IGIuYSB8fCBhLmEgPT09IGIuYSAmJiBhLmIgPD0gYi5iOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFhKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IGIuYSAtIGEuYSwgZSA9IGMuYSAtIGIuYTsKICAgICAgICByZXR1cm4gMCA8IGQgKyBlID8gZCA8IGUgPyBiLmIgLSBhLmIgKyBkIC8gKGQgKyBlKSAqIChhLmIgLSBjLmIpIDogYi5iIC0gYy5iICsgZSAvIChkICsgZSkgKiAoYy5iIC0gYS5iKSA6IDA7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYmEoYSwgYiwgYykgewogICAgICAgIHZhciBkID0gYi5hIC0gYS5hLCBlID0gYy5hIC0gYi5hOwogICAgICAgIHJldHVybiAwIDwgZCArIGUgPyAoYi5iIC0gYy5iKSAqIGQgKyAoYi5iIC0gYS5iKSAqIGUgOiAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNhKGEpIHsKICAgICAgICByZXR1cm4gdShhLmIuYSwgYS5hKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkYShhKSB7CiAgICAgICAgcmV0dXJuIHUoYS5hLCBhLmIuYSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQShhLCBiLCBjLCBkKSB7CiAgICAgICAgYSA9IDAgPiBhID8gMCA6IGE7CiAgICAgICAgYyA9IDAgPiBjID8gMCA6IGM7CiAgICAgICAgcmV0dXJuIGEgPD0gYyA/IGMgPT09IDAgPyAoYiArIGQpIC8gMiA6IGIgKyBhIC8gKGEgKyBjKSAqIChkIC0gYikgOiBkICsgYyAvIChhICsgYykgKiAoYiAtIGQpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGVhKGEpIHsKICAgICAgICB2YXIgYiA9IEIoYS5iKTsKICAgICAgICBDKGIsIGEuYyk7CiAgICAgICAgQyhiLmIsIGEuYyk7CiAgICAgICAgRChiLCBhLmEpOwogICAgICAgIHJldHVybiBiOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEUoYSwgYikgewogICAgICAgIHZhciBjID0gZmFsc2UsIGQgPSBmYWxzZTsKICAgICAgICBhICE9PSBiICYmIChiLmEgIT09IGEuYSAmJiAoZCA9IHRydWUsIEYoYi5hLCBhLmEpKSwgYi5kICE9PSBhLmQgJiYgKGMgPSB0cnVlLCBHKGIuZCwgYS5kKSksIEgoYiwgYSksIGQgfHwgKEMoYiwgYS5hKSwgYS5hLmMgPSBhKSwgYyB8fCAoRChiLCBhLmQpLCBhLmQuYSA9IGEpKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJKGEpIHsKICAgICAgICB2YXIgYiA9IGEuYiwgYyA9IGZhbHNlOwogICAgICAgIGEuZCAhPT0gYS5iLmQgJiYgKGMgPSB0cnVlLCBHKGEuZCwgYS5iLmQpKTsKICAgICAgICBhLmMgPT09IGEgPyBGKGEuYSwgbnVsbCkgOiAoYS5iLmQuYSA9IEooYSksIGEuYS5jID0gYS5jLCBIKGEsIEooYSkpLCBjIHx8IEQoYSwgYS5kKSk7CiAgICAgICAgYi5jID09PSBiID8gKEYoYi5hLCBudWxsKSwgRyhiLmQsIG51bGwpKSA6IChhLmQuYSA9IEooYiksIGIuYS5jID0gYi5jLCBIKGIsIEooYikpKTsKICAgICAgICBmYShhKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBLKGEpIHsKICAgICAgICB2YXIgYiA9IEIoYSksIGMgPSBiLmI7CiAgICAgICAgSChiLCBhLmUpOwogICAgICAgIGIuYSA9IGEuYi5hOwogICAgICAgIEMoYywgYi5hKTsKICAgICAgICBiLmQgPSBjLmQgPSBhLmQ7CiAgICAgICAgYiA9IGIuYjsKICAgICAgICBIKGEuYiwgSihhLmIpKTsKICAgICAgICBIKGEuYiwgYik7CiAgICAgICAgYS5iLmEgPSBiLmE7CiAgICAgICAgYi5iLmEuYyA9IGIuYjsKICAgICAgICBiLmIuZCA9IGEuYi5kOwogICAgICAgIGIuZiA9IGEuZjsKICAgICAgICBiLmIuZiA9IGEuYi5mOwogICAgICAgIHJldHVybiBiOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEwoYSwgYikgewogICAgICAgIHZhciBjID0gZmFsc2UsIGQgPSBCKGEpLCBlID0gZC5iOwogICAgICAgIGIuZCAhPT0gYS5kICYmIChjID0gdHJ1ZSwgRyhiLmQsIGEuZCkpOwogICAgICAgIEgoZCwgYS5lKTsKICAgICAgICBIKGUsIGIpOwogICAgICAgIGQuYSA9IGEuYi5hOwogICAgICAgIGUuYSA9IGIuYTsKICAgICAgICBkLmQgPSBlLmQgPSBhLmQ7CiAgICAgICAgYS5kLmEgPSBlOwogICAgICAgIGMgfHwgRChkLCBhLmQpOwogICAgICAgIHJldHVybiBkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEIoYSkgewogICAgICAgIHZhciBiID0gbmV3IE0oKSwgYyA9IG5ldyBNKCksIGQgPSBhLmIuaDsKICAgICAgICBjLmggPSBkOwogICAgICAgIGQuYi5oID0gYjsKICAgICAgICBiLmggPSBhOwogICAgICAgIGEuYi5oID0gYzsKICAgICAgICBiLmIgPSBjOwogICAgICAgIGIuYyA9IGI7CiAgICAgICAgYi5lID0gYzsKICAgICAgICBjLmIgPSBiOwogICAgICAgIGMuYyA9IGM7CiAgICAgICAgcmV0dXJuIGMuZSA9IGI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSChhLCBiKSB7CiAgICAgICAgdmFyIGMgPSBhLmMsIGQgPSBiLmM7CiAgICAgICAgYy5iLmUgPSBiOwogICAgICAgIGQuYi5lID0gYTsKICAgICAgICBhLmMgPSBkOwogICAgICAgIGIuYyA9IGM7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQyhhLCBiKSB7CiAgICAgICAgdmFyIGMgPSBiLmYsIGQgPSBuZXcgTihiLCBjKTsKICAgICAgICBjLmUgPSBkOwogICAgICAgIGIuZiA9IGQ7CiAgICAgICAgYyA9IGQuYyA9IGE7CiAgICAgICAgZG8KICAgICAgICAgIGMuYSA9IGQsIGMgPSBjLmM7CiAgICAgICAgd2hpbGUgKGMgIT09IGEpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEQoYSwgYikgewogICAgICAgIHZhciBjID0gYi5kLCBkID0gbmV3IGdhKGIsIGMpOwogICAgICAgIGMuYiA9IGQ7CiAgICAgICAgYi5kID0gZDsKICAgICAgICBkLmEgPSBhOwogICAgICAgIGQuYyA9IGIuYzsKICAgICAgICBjID0gYTsKICAgICAgICBkbwogICAgICAgICAgYy5kID0gZCwgYyA9IGMuZTsKICAgICAgICB3aGlsZSAoYyAhPT0gYSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZmEoYSkgewogICAgICAgIHZhciBiID0gYS5oOwogICAgICAgIGEgPSBhLmIuaDsKICAgICAgICBiLmIuaCA9IGE7CiAgICAgICAgYS5iLmggPSBiOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEYoYSwgYikgewogICAgICAgIHZhciBjID0gYS5jLCBkID0gYzsKICAgICAgICBkbwogICAgICAgICAgZC5hID0gYiwgZCA9IGQuYzsKICAgICAgICB3aGlsZSAoZCAhPT0gYyk7CiAgICAgICAgYyA9IGEuZjsKICAgICAgICBkID0gYS5lOwogICAgICAgIGQuZiA9IGM7CiAgICAgICAgYy5lID0gZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBHKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEuYSwgZCA9IGM7CiAgICAgICAgZG8KICAgICAgICAgIGQuZCA9IGIsIGQgPSBkLmU7CiAgICAgICAgd2hpbGUgKGQgIT09IGMpOwogICAgICAgIGMgPSBhLmQ7CiAgICAgICAgZCA9IGEuYjsKICAgICAgICBkLmQgPSBjOwogICAgICAgIGMuYiA9IGQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaGEoYSkgewogICAgICAgIHZhciBiID0gMDsKICAgICAgICBNYXRoLmFicyhhWzFdKSA+IE1hdGguYWJzKGFbMF0pICYmIChiID0gMSk7CiAgICAgICAgTWF0aC5hYnMoYVsyXSkgPiBNYXRoLmFicyhhW2JdKSAmJiAoYiA9IDIpOwogICAgICAgIHJldHVybiBiOwogICAgICB9CiAgICAgIHZhciBPID0gNCAqIDFlMTUwOwogICAgICBmdW5jdGlvbiBQKGEsIGIpIHsKICAgICAgICBhLmYgKz0gYi5mOwogICAgICAgIGEuYi5mICs9IGIuYi5mOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGlhKGEsIGIsIGMpIHsKICAgICAgICBhID0gYS5hOwogICAgICAgIGIgPSBiLmE7CiAgICAgICAgYyA9IGMuYTsKICAgICAgICBpZiAoYi5iLmEgPT09IGEpCiAgICAgICAgICByZXR1cm4gYy5iLmEgPT09IGEgPyB1KGIuYSwgYy5hKSA/IDAgPj0geChjLmIuYSwgYi5hLCBjLmEpIDogMCA8PSB4KGIuYi5hLCBjLmEsIGIuYSkgOiAwID49IHgoYy5iLmEsIGEsIGMuYSk7CiAgICAgICAgaWYgKGMuYi5hID09PSBhKQogICAgICAgICAgcmV0dXJuIDAgPD0geChiLmIuYSwgYSwgYi5hKTsKICAgICAgICBiID0gdihiLmIuYSwgYSwgYi5hKTsKICAgICAgICBhID0gdihjLmIuYSwgYSwgYy5hKTsKICAgICAgICByZXR1cm4gYiA+PSBhOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFEoYSkgewogICAgICAgIGEuYS5pID0gbnVsbDsKICAgICAgICB2YXIgYiA9IGEuZTsKICAgICAgICBiLmEuYyA9IGIuYzsKICAgICAgICBiLmMuYSA9IGIuYTsKICAgICAgICBhLmUgPSBudWxsOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGphKGEsIGIpIHsKICAgICAgICBJKGEuYSk7CiAgICAgICAgYS5jID0gZmFsc2U7CiAgICAgICAgYS5hID0gYjsKICAgICAgICBiLmkgPSBhOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGthKGEpIHsKICAgICAgICB2YXIgYiA9IGEuYS5hOwogICAgICAgIGRvCiAgICAgICAgICBhID0gUihhKTsKICAgICAgICB3aGlsZSAoYS5hLmEgPT09IGIpOwogICAgICAgIGEuYyAmJiAoYiA9IEwoUyhhKS5hLmIsIGEuYS5lKSwgamEoYSwgYiksIGEgPSBSKGEpKTsKICAgICAgICByZXR1cm4gYTsKICAgICAgfQogICAgICBmdW5jdGlvbiBsYShhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBuZXcgbWEoKTsKICAgICAgICBkLmEgPSBjOwogICAgICAgIGQuZSA9IG5hKGEuZiwgYi5lLCBkKTsKICAgICAgICByZXR1cm4gYy5pID0gZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBvYShhLCBiKSB7CiAgICAgICAgc3dpdGNoIChhLnMpIHsKICAgICAgICAgIGNhc2UgMTAwMTMwOgogICAgICAgICAgICByZXR1cm4gKGIgJiAxKSAhPT0gMDsKICAgICAgICAgIGNhc2UgMTAwMTMxOgogICAgICAgICAgICByZXR1cm4gYiAhPT0gMDsKICAgICAgICAgIGNhc2UgMTAwMTMyOgogICAgICAgICAgICByZXR1cm4gMCA8IGI7CiAgICAgICAgICBjYXNlIDEwMDEzMzoKICAgICAgICAgICAgcmV0dXJuIDAgPiBiOwogICAgICAgICAgY2FzZSAxMDAxMzQ6CiAgICAgICAgICAgIHJldHVybiAyIDw9IGIgfHwgLTIgPj0gYjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHBhKGEpIHsKICAgICAgICB2YXIgYiA9IGEuYSwgYyA9IGIuZDsKICAgICAgICBjLmMgPSBhLmQ7CiAgICAgICAgYy5hID0gYjsKICAgICAgICBRKGEpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFQoYSwgYiwgYykgewogICAgICAgIGEgPSBiOwogICAgICAgIGZvciAoYiA9IGIuYTsgYSAhPT0gYzsgKSB7CiAgICAgICAgICBhLmMgPSBmYWxzZTsKICAgICAgICAgIHZhciBkID0gUyhhKSwgZSA9IGQuYTsKICAgICAgICAgIGlmIChlLmEgIT09IGIuYSkgewogICAgICAgICAgICBpZiAoIWQuYykgewogICAgICAgICAgICAgIHBhKGEpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGUgPSBMKGIuYy5iLCBlLmIpOwogICAgICAgICAgICBqYShkLCBlKTsKICAgICAgICAgIH0KICAgICAgICAgIGIuYyAhPT0gZSAmJiAoRShKKGUpLCBlKSwgRShiLCBlKSk7CiAgICAgICAgICBwYShhKTsKICAgICAgICAgIGIgPSBkLmE7CiAgICAgICAgICBhID0gZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVShhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgdmFyIGcgPSB0cnVlOwogICAgICAgIGRvCiAgICAgICAgICBsYShhLCBiLCBjLmIpLCBjID0gYy5jOwogICAgICAgIHdoaWxlIChjICE9PSBkKTsKICAgICAgICBmb3IgKGUgPT09IG51bGwgJiYgKGUgPSBTKGIpLmEuYi5jKTsgOyApIHsKICAgICAgICAgIGQgPSBTKGIpOwogICAgICAgICAgYyA9IGQuYS5iOwogICAgICAgICAgaWYgKGMuYSAhPT0gZS5hKQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGMuYyAhPT0gZSAmJiAoRShKKGMpLCBjKSwgRShKKGUpLCBjKSk7CiAgICAgICAgICBkLmYgPSBiLmYgLSBjLmY7CiAgICAgICAgICBkLmQgPSBvYShhLCBkLmYpOwogICAgICAgICAgYi5iID0gdHJ1ZTsKICAgICAgICAgICFnICYmIHFhKGEsIGIpICYmIChQKGMsIGUpLCBRKGIpLCBJKGUpKTsKICAgICAgICAgIGcgPSBmYWxzZTsKICAgICAgICAgIGIgPSBkOwogICAgICAgICAgZSA9IGM7CiAgICAgICAgfQogICAgICAgIGIuYiA9IHRydWU7CiAgICAgICAgZiAmJiByYShhLCBiKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBzYShhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdmFyIGYgPSBbYi5nWzBdLCBiLmdbMV0sIGIuZ1syXV07CiAgICAgICAgYi5kID0gbnVsbDsKICAgICAgICBiLmQgPSBhLm8gPyBhLm8oZiwgYywgZCwgYS5jKSB8fCBudWxsIDogbnVsbDsKICAgICAgICBiLmQgPT09IG51bGwgJiYgKGUgPyBhLm4gfHwgKFYoYSwgMTAwMTU2KSwgYS5uID0gdHJ1ZSkgOiBiLmQgPSBjWzBdKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB0YShhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBbbnVsbCwgbnVsbCwgbnVsbCwgbnVsbF07CiAgICAgICAgZFswXSA9IGIuYS5kOwogICAgICAgIGRbMV0gPSBjLmEuZDsKICAgICAgICBzYShhLCBiLmEsIGQsIFswLjUsIDAuNSwgMCwgMF0sIGZhbHNlKTsKICAgICAgICBFKGIsIGMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVhKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICB2YXIgZiA9IE1hdGguYWJzKGIuYiAtIGEuYikgKyBNYXRoLmFicyhiLmEgLSBhLmEpLCBnID0gTWF0aC5hYnMoYy5iIC0gYS5iKSArIE1hdGguYWJzKGMuYSAtIGEuYSksIGggPSBlICsgMTsKICAgICAgICBkW2VdID0gMC41ICogZyAvIChmICsgZyk7CiAgICAgICAgZFtoXSA9IDAuNSAqIGYgLyAoZiArIGcpOwogICAgICAgIGEuZ1swXSArPSBkW2VdICogYi5nWzBdICsgZFtoXSAqIGMuZ1swXTsKICAgICAgICBhLmdbMV0gKz0gZFtlXSAqIGIuZ1sxXSArIGRbaF0gKiBjLmdbMV07CiAgICAgICAgYS5nWzJdICs9IGRbZV0gKiBiLmdbMl0gKyBkW2hdICogYy5nWzJdOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHFhKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IFMoYiksIGQgPSBiLmEsIGUgPSBjLmE7CiAgICAgICAgaWYgKHUoZC5hLCBlLmEpKSB7CiAgICAgICAgICBpZiAoMCA8IHgoZS5iLmEsIGQuYSwgZS5hKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgaWYgKCF0KGQuYSwgZS5hKSkKICAgICAgICAgICAgSyhlLmIpLCBFKGQsIEooZSkpLCBiLmIgPSBjLmIgPSB0cnVlOwogICAgICAgICAgZWxzZSBpZiAoZC5hICE9PSBlLmEpIHsKICAgICAgICAgICAgdmFyIGMgPSBhLmUsIGYgPSBkLmEuaDsKICAgICAgICAgICAgaWYgKDAgPD0gZikgewogICAgICAgICAgICAgIHZhciBjID0gYy5iLCBnID0gYy5kLCBoID0gYy5lLCBrID0gYy5jLCBsID0ga1tmXTsKICAgICAgICAgICAgICBnW2xdID0gZ1tjLmFdOwogICAgICAgICAgICAgIGtbZ1tsXV0gPSBsOwogICAgICAgICAgICAgIGwgPD0gLS1jLmEgJiYgKDEgPj0gbCA/IFcoYywgbCkgOiB1KGhbZ1tsID4+IDFdXSwgaFtnW2xdXSkgPyBXKGMsIGwpIDogdmEoYywgbCkpOwogICAgICAgICAgICAgIGhbZl0gPSBudWxsOwogICAgICAgICAgICAgIGtbZl0gPSBjLmI7CiAgICAgICAgICAgICAgYy5iID0gZjsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgZm9yIChjLmNbLShmICsgMSldID0gbnVsbDsgMCA8IGMuYSAmJiBjLmNbYy5kW2MuYSAtIDFdXSA9PT0gbnVsbDsgKQogICAgICAgICAgICAgICAgLS1jLmE7CiAgICAgICAgICAgIHRhKGEsIEooZSksIGQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoMCA+IHgoZC5iLmEsIGUuYSwgZC5hKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgUihiKS5iID0gYi5iID0gdHJ1ZTsKICAgICAgICAgIEsoZC5iKTsKICAgICAgICAgIEUoSihlKSwgZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHdhKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IFMoYiksIGQgPSBiLmEsIGUgPSBjLmEsIGYgPSBkLmEsIGcgPSBlLmEsIGggPSBkLmIuYSwgayA9IGUuYi5hLCBsID0gbmV3IE4oKTsKICAgICAgICB4KGgsIGEuYSwgZik7CiAgICAgICAgeChrLCBhLmEsIGcpOwogICAgICAgIGlmIChmID09PSBnIHx8IE1hdGgubWluKGYuYSwgaC5hKSA+IE1hdGgubWF4KGcuYSwgay5hKSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAodShmLCBnKSkgewogICAgICAgICAgaWYgKDAgPCB4KGssIGYsIGcpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmICgwID4geChoLCBnLCBmKSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB2YXIgciA9IGgsIHAgPSBmLCBxID0gaywgeSA9IGcsIG0sIHc7CiAgICAgICAgdShyLCBwKSB8fCAobSA9IHIsIHIgPSBwLCBwID0gbSk7CiAgICAgICAgdShxLCB5KSB8fCAobSA9IHEsIHEgPSB5LCB5ID0gbSk7CiAgICAgICAgdShyLCBxKSB8fCAobSA9IHIsIHIgPSBxLCBxID0gbSwgbSA9IHAsIHAgPSB5LCB5ID0gbSk7CiAgICAgICAgdShxLCBwKSA/IHUocCwgeSkgPyAobSA9IHYociwgcSwgcCksIHcgPSB2KHEsIHAsIHkpLCAwID4gbSArIHcgJiYgKG0gPSAtbSwgdyA9IC13KSwgbC5iID0gQShtLCBxLmIsIHcsIHAuYikpIDogKG0gPSB4KHIsIHEsIHApLCB3ID0gLXgociwgeSwgcCksIDAgPiBtICsgdyAmJiAobSA9IC1tLCB3ID0gLXcpLCBsLmIgPSBBKG0sIHEuYiwgdywgeS5iKSkgOiBsLmIgPSAocS5iICsgcC5iKSAvIDI7CiAgICAgICAgeihyLCBwKSB8fCAobSA9IHIsIHIgPSBwLCBwID0gbSk7CiAgICAgICAgeihxLCB5KSB8fCAobSA9IHEsIHEgPSB5LCB5ID0gbSk7CiAgICAgICAgeihyLCBxKSB8fCAobSA9IHIsIHIgPSBxLCBxID0gbSwgbSA9IHAsIHAgPSB5LCB5ID0gbSk7CiAgICAgICAgeihxLCBwKSA/IHoocCwgeSkgPyAobSA9IGFhKHIsIHEsIHApLCB3ID0gYWEocSwgcCwgeSksIDAgPiBtICsgdyAmJiAobSA9IC1tLCB3ID0gLXcpLCBsLmEgPSBBKG0sIHEuYSwgdywgcC5hKSkgOiAobSA9IGJhKHIsIHEsIHApLCB3ID0gLWJhKHIsIHksIHApLCAwID4gbSArIHcgJiYgKG0gPSAtbSwgdyA9IC13KSwgbC5hID0gQShtLCBxLmEsIHcsIHkuYSkpIDogbC5hID0gKHEuYSArIHAuYSkgLyAyOwogICAgICAgIHUobCwgYS5hKSAmJiAobC5iID0gYS5hLmIsIGwuYSA9IGEuYS5hKTsKICAgICAgICByID0gdShmLCBnKSA/IGYgOiBnOwogICAgICAgIHUociwgbCkgJiYgKGwuYiA9IHIuYiwgbC5hID0gci5hKTsKICAgICAgICBpZiAodChsLCBmKSB8fCB0KGwsIGcpKQogICAgICAgICAgcmV0dXJuIHFhKGEsIGIpLCBmYWxzZTsKICAgICAgICBpZiAoIXQoaCwgYS5hKSAmJiAwIDw9IHgoaCwgYS5hLCBsKSB8fCAhdChrLCBhLmEpICYmIDAgPj0geChrLCBhLmEsIGwpKSB7CiAgICAgICAgICBpZiAoayA9PT0gYS5hKQogICAgICAgICAgICByZXR1cm4gSyhkLmIpLCBFKGUuYiwgZCksIGIgPSBrYShiKSwgZCA9IFMoYikuYSwgVChhLCBTKGIpLCBjKSwgVShhLCBiLCBKKGQpLCBkLCBkLCB0cnVlKSwgdHJ1ZTsKICAgICAgICAgIGlmIChoID09PSBhLmEpIHsKICAgICAgICAgICAgSyhlLmIpOwogICAgICAgICAgICBFKGQuZSwgSihlKSk7CiAgICAgICAgICAgIGYgPSBjID0gYjsKICAgICAgICAgICAgZyA9IGYuYS5iLmE7CiAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgZiA9IFIoZik7CiAgICAgICAgICAgIHdoaWxlIChmLmEuYi5hID09PSBnKTsKICAgICAgICAgICAgYiA9IGY7CiAgICAgICAgICAgIGYgPSBTKGIpLmEuYi5jOwogICAgICAgICAgICBjLmEgPSBKKGUpOwogICAgICAgICAgICBlID0gVChhLCBjLCBudWxsKTsKICAgICAgICAgICAgVShhLCBiLCBlLmMsIGQuYi5jLCBmLCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICAwIDw9IHgoaCwgYS5hLCBsKSAmJiAoUihiKS5iID0gYi5iID0gdHJ1ZSwgSyhkLmIpLCBkLmEuYiA9IGEuYS5iLCBkLmEuYSA9IGEuYS5hKTsKICAgICAgICAgIDAgPj0geChrLCBhLmEsIGwpICYmIChiLmIgPSBjLmIgPSB0cnVlLCBLKGUuYiksIGUuYS5iID0gYS5hLmIsIGUuYS5hID0gYS5hLmEpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBLKGQuYik7CiAgICAgICAgSyhlLmIpOwogICAgICAgIEUoSihlKSwgZCk7CiAgICAgICAgZC5hLmIgPSBsLmI7CiAgICAgICAgZC5hLmEgPSBsLmE7CiAgICAgICAgZC5hLmggPSB4YShhLmUsIGQuYSk7CiAgICAgICAgZCA9IGQuYTsKICAgICAgICBlID0gWzAsIDAsIDAsIDBdOwogICAgICAgIGwgPSBbZi5kLCBoLmQsIGcuZCwgay5kXTsKICAgICAgICBkLmdbMF0gPSBkLmdbMV0gPSBkLmdbMl0gPSAwOwogICAgICAgIHVhKGQsIGYsIGgsIGUsIDApOwogICAgICAgIHVhKGQsIGcsIGssIGUsIDIpOwogICAgICAgIHNhKGEsIGQsIGwsIGUsIHRydWUpOwogICAgICAgIFIoYikuYiA9IGIuYiA9IGMuYiA9IHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJhKGEsIGIpIHsKICAgICAgICBmb3IgKHZhciBjID0gUyhiKTsgOyApIHsKICAgICAgICAgIGZvciAoOyBjLmI7ICkKICAgICAgICAgICAgYiA9IGMsIGMgPSBTKGMpOwogICAgICAgICAgaWYgKCFiLmIgJiYgKGMgPSBiLCBiID0gUihiKSwgYiA9PT0gbnVsbCB8fCAhYi5iKSkKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBiLmIgPSBmYWxzZTsKICAgICAgICAgIHZhciBkID0gYi5hLCBlID0gYy5hLCBmOwogICAgICAgICAgaWYgKGYgPSBkLmIuYSAhPT0gZS5iLmEpCiAgICAgICAgICAgIGE6IHsKICAgICAgICAgICAgICBmID0gYjsKICAgICAgICAgICAgICB2YXIgZyA9IFMoZiksIGggPSBmLmEsIGsgPSBnLmEsIGwgPSB2b2lkIDA7CiAgICAgICAgICAgICAgaWYgKHUoaC5iLmEsIGsuYi5hKSkgewogICAgICAgICAgICAgICAgaWYgKDAgPiB4KGguYi5hLCBrLmIuYSwgaC5hKSkgewogICAgICAgICAgICAgICAgICBmID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBSKGYpLmIgPSBmLmIgPSB0cnVlOwogICAgICAgICAgICAgICAgbCA9IEsoaCk7CiAgICAgICAgICAgICAgICBFKGsuYiwgbCk7CiAgICAgICAgICAgICAgICBsLmQuYyA9IGYuZDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKDAgPCB4KGsuYi5hLCBoLmIuYSwgay5hKSkgewogICAgICAgICAgICAgICAgICBmID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmLmIgPSBnLmIgPSB0cnVlOwogICAgICAgICAgICAgICAgbCA9IEsoayk7CiAgICAgICAgICAgICAgICBFKGguZSwgay5iKTsKICAgICAgICAgICAgICAgIGwuYi5kLmMgPSBmLmQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGYgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICBmICYmIChjLmMgPyAoUShjKSwgSShlKSwgYyA9IFMoYiksIGUgPSBjLmEpIDogYi5jICYmIChRKGIpLCBJKGQpLCBiID0gUihjKSwgZCA9IGIuYSkpOwogICAgICAgICAgaWYgKGQuYSAhPT0gZS5hKSB7CiAgICAgICAgICAgIGlmIChkLmIuYSA9PT0gZS5iLmEgfHwgYi5jIHx8IGMuYyB8fCBkLmIuYSAhPT0gYS5hICYmIGUuYi5hICE9PSBhLmEpCiAgICAgICAgICAgICAgcWEoYSwgYik7CiAgICAgICAgICAgIGVsc2UgaWYgKHdhKGEsIGIpKQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgZC5hID09PSBlLmEgJiYgZC5iLmEgPT09IGUuYi5hICYmIChQKGUsIGQpLCBRKGIpLCBJKGQpLCBiID0gUihjKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHlhKGEsIGIpIHsKICAgICAgICBhLmEgPSBiOwogICAgICAgIGZvciAodmFyIGMgPSBiLmM7IGMuaSA9PT0gbnVsbDsgKQogICAgICAgICAgaWYgKGMgPSBjLmMsIGMgPT09IGIuYykgewogICAgICAgICAgICB2YXIgYyA9IGEsIGQgPSBiLCBlID0gbmV3IG1hKCk7CiAgICAgICAgICAgIGUuYSA9IGQuYy5iOwogICAgICAgICAgICB2YXIgZiA9IGMuZiwgZyA9IGYuYTsKICAgICAgICAgICAgZG8KICAgICAgICAgICAgICBnID0gZy5hOwogICAgICAgICAgICB3aGlsZSAoZy5iICE9PSBudWxsICYmICFmLmMoZi5iLCBlLCBnLmIpKTsKICAgICAgICAgICAgdmFyIGYgPSBnLmIsIGggPSBTKGYpLCBlID0gZi5hLCBnID0gaC5hOwogICAgICAgICAgICBpZiAoeChlLmIuYSwgZCwgZS5hKSA9PT0gMCkKICAgICAgICAgICAgICBlID0gZi5hLCB0KGUuYSwgZCkgfHwgdChlLmIuYSwgZCkgfHwgKEsoZS5iKSwgZi5jICYmIChJKGUuYyksIGYuYyA9IGZhbHNlKSwgRShkLmMsIGUpLCB5YShjLCBkKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIHZhciBrID0gdShnLmIuYSwgZS5iLmEpID8gZiA6IGgsIGggPSB2b2lkIDA7CiAgICAgICAgICAgICAgZi5kIHx8IGsuYyA/IChrID09PSBmID8gaCA9IEwoZC5jLmIsIGUuZSkgOiBoID0gTChnLmIuYy5iLCBkLmMpLmIsIGsuYyA/IGphKGssIGgpIDogKGUgPSBjLCBmID0gbGEoYywgZiwgaCksIGYuZiA9IFIoZikuZiArIGYuYS5mLCBmLmQgPSBvYShlLCBmLmYpKSwgeWEoYywgZCkpIDogVShjLCBmLCBkLmMsIGQuYywgbnVsbCwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIGMgPSBrYShjLmkpOwogICAgICAgIGUgPSBTKGMpOwogICAgICAgIGYgPSBlLmE7CiAgICAgICAgZSA9IFQoYSwgZSwgbnVsbCk7CiAgICAgICAgaWYgKGUuYyA9PT0gZikgewogICAgICAgICAgdmFyIGYgPSBlLCBlID0gZi5jLCBnID0gUyhjKSwgaCA9IGMuYSwgayA9IGcuYSwgbCA9IGZhbHNlOwogICAgICAgICAgaC5iLmEgIT09IGsuYi5hICYmIHdhKGEsIGMpOwogICAgICAgICAgdChoLmEsIGEuYSkgJiYgKEUoSihlKSwgaCksIGMgPSBrYShjKSwgZSA9IFMoYykuYSwgVChhLCBTKGMpLCBnKSwgbCA9IHRydWUpOwogICAgICAgICAgdChrLmEsIGEuYSkgJiYgKEUoZiwgSihrKSksIGYgPSBUKGEsIGcsIG51bGwpLCBsID0gdHJ1ZSk7CiAgICAgICAgICBsID8gVShhLCBjLCBmLmMsIGUsIGUsIHRydWUpIDogKHUoay5hLCBoLmEpID8gZCA9IEooaykgOiBkID0gaCwgZCA9IEwoZi5jLmIsIGQpLCBVKGEsIGMsIGQsIGQuYywgZC5jLCBmYWxzZSksIGQuYi5pLmMgPSB0cnVlLCByYShhLCBjKSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICBVKGEsIGMsIGUuYywgZiwgZiwgdHJ1ZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gemEoYSwgYikgewogICAgICAgIHZhciBjID0gbmV3IG1hKCksIGQgPSBlYShhLmIpOwogICAgICAgIGQuYS5iID0gTzsKICAgICAgICBkLmEuYSA9IGI7CiAgICAgICAgZC5iLmEuYiA9IC1POwogICAgICAgIGQuYi5hLmEgPSBiOwogICAgICAgIGEuYSA9IGQuYi5hOwogICAgICAgIGMuYSA9IGQ7CiAgICAgICAgYy5mID0gMDsKICAgICAgICBjLmQgPSBmYWxzZTsKICAgICAgICBjLmMgPSBmYWxzZTsKICAgICAgICBjLmggPSB0cnVlOwogICAgICAgIGMuYiA9IGZhbHNlOwogICAgICAgIGQgPSBhLmY7CiAgICAgICAgZCA9IG5hKGQsIGQuYSwgYyk7CiAgICAgICAgYy5lID0gZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBBYShhKSB7CiAgICAgICAgdGhpcy5hID0gbmV3IEJhKCk7CiAgICAgICAgdGhpcy5iID0gYTsKICAgICAgICB0aGlzLmMgPSBpYTsKICAgICAgfQogICAgICBmdW5jdGlvbiBuYShhLCBiLCBjKSB7CiAgICAgICAgZG8KICAgICAgICAgIGIgPSBiLmM7CiAgICAgICAgd2hpbGUgKGIuYiAhPT0gbnVsbCAmJiAhYS5jKGEuYiwgYi5iLCBjKSk7CiAgICAgICAgYSA9IG5ldyBCYShjLCBiLmEsIGIpOwogICAgICAgIGIuYS5jID0gYTsKICAgICAgICByZXR1cm4gYi5hID0gYTsKICAgICAgfQogICAgICBmdW5jdGlvbiBCYShhLCBiLCBjKSB7CiAgICAgICAgdGhpcy5iID0gYSB8fCBudWxsOwogICAgICAgIHRoaXMuYSA9IGIgfHwgdGhpczsKICAgICAgICB0aGlzLmMgPSBjIHx8IHRoaXM7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWCgpIHsKICAgICAgICB0aGlzLmQgPSBZOwogICAgICAgIHRoaXMucCA9IHRoaXMuYiA9IHRoaXMucSA9IG51bGw7CiAgICAgICAgdGhpcy5qID0gWzAsIDAsIDBdOwogICAgICAgIHRoaXMucyA9IDEwMDEzMDsKICAgICAgICB0aGlzLm4gPSBmYWxzZTsKICAgICAgICB0aGlzLm8gPSB0aGlzLmEgPSB0aGlzLmUgPSB0aGlzLmYgPSBudWxsOwogICAgICAgIHRoaXMubSA9IGZhbHNlOwogICAgICAgIHRoaXMuYyA9IHRoaXMuciA9IHRoaXMuaSA9IHRoaXMuayA9IHRoaXMubCA9IHRoaXMuaCA9IG51bGw7CiAgICAgIH0KICAgICAgdmFyIFkgPSAwOwogICAgICBuID0gWC5wcm90b3R5cGU7CiAgICAgIG4ueCA9IGZ1bmN0aW9uKCkgewogICAgICAgIFoodGhpcywgWSk7CiAgICAgIH07CiAgICAgIG4uQiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgIGNhc2UgMTAwMTQyOgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjYXNlIDEwMDE0MDoKICAgICAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgICAgY2FzZSAxMDAxMzA6CiAgICAgICAgICAgICAgY2FzZSAxMDAxMzE6CiAgICAgICAgICAgICAgY2FzZSAxMDAxMzI6CiAgICAgICAgICAgICAgY2FzZSAxMDAxMzM6CiAgICAgICAgICAgICAgY2FzZSAxMDAxMzQ6CiAgICAgICAgICAgICAgICB0aGlzLnMgPSBiOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxMDAxNDE6CiAgICAgICAgICAgIHRoaXMubSA9ICEhYjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgVih0aGlzLCAxMDA5MDApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIFYodGhpcywgMTAwOTAxKTsKICAgICAgfTsKICAgICAgbi55ID0gZnVuY3Rpb24oYSkgewogICAgICAgIHN3aXRjaCAoYSkgewogICAgICAgICAgY2FzZSAxMDAxNDI6CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgY2FzZSAxMDAxNDA6CiAgICAgICAgICAgIHJldHVybiB0aGlzLnM7CiAgICAgICAgICBjYXNlIDEwMDE0MToKICAgICAgICAgICAgcmV0dXJuIHRoaXMubTsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIFYodGhpcywgMTAwOTAwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9OwogICAgICBuLkEgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdGhpcy5qWzBdID0gYTsKICAgICAgICB0aGlzLmpbMV0gPSBiOwogICAgICAgIHRoaXMualsyXSA9IGM7CiAgICAgIH07CiAgICAgIG4ueiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGIgPyBiIDogbnVsbDsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgIGNhc2UgMTAwMTAwOgogICAgICAgICAgY2FzZSAxMDAxMDY6CiAgICAgICAgICAgIHRoaXMuaCA9IGM7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxMDAxMDQ6CiAgICAgICAgICBjYXNlIDEwMDExMDoKICAgICAgICAgICAgdGhpcy5sID0gYzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDEwMDEwMToKICAgICAgICAgIGNhc2UgMTAwMTA3OgogICAgICAgICAgICB0aGlzLmsgPSBjOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTAwMTAyOgogICAgICAgICAgY2FzZSAxMDAxMDg6CiAgICAgICAgICAgIHRoaXMuaSA9IGM7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxMDAxMDM6CiAgICAgICAgICBjYXNlIDEwMDEwOToKICAgICAgICAgICAgdGhpcy5wID0gYzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDEwMDEwNToKICAgICAgICAgIGNhc2UgMTAwMTExOgogICAgICAgICAgICB0aGlzLm8gPSBjOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTAwMTEyOgogICAgICAgICAgICB0aGlzLnIgPSBjOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIFYodGhpcywgMTAwOTAwKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIG4uQyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGZhbHNlLCBkID0gWzAsIDAsIDBdOwogICAgICAgIFoodGhpcywgMik7CiAgICAgICAgZm9yICh2YXIgZSA9IDA7IDMgPiBlOyArK2UpIHsKICAgICAgICAgIHZhciBmID0gYVtlXTsKICAgICAgICAgIC0xZTE1MCA+IGYgJiYgKGYgPSAtMWUxNTAsIGMgPSB0cnVlKTsKICAgICAgICAgIDFlMTUwIDwgZiAmJiAoZiA9IDFlMTUwLCBjID0gdHJ1ZSk7CiAgICAgICAgICBkW2VdID0gZjsKICAgICAgICB9CiAgICAgICAgYyAmJiBWKHRoaXMsIDEwMDE1NSk7CiAgICAgICAgYyA9IHRoaXMucTsKICAgICAgICBjID09PSBudWxsID8gKGMgPSBlYSh0aGlzLmIpLCBFKGMsIGMuYikpIDogKEsoYyksIGMgPSBjLmUpOwogICAgICAgIGMuYS5kID0gYjsKICAgICAgICBjLmEuZ1swXSA9IGRbMF07CiAgICAgICAgYy5hLmdbMV0gPSBkWzFdOwogICAgICAgIGMuYS5nWzJdID0gZFsyXTsKICAgICAgICBjLmYgPSAxOwogICAgICAgIGMuYi5mID0gLTE7CiAgICAgICAgdGhpcy5xID0gYzsKICAgICAgfTsKICAgICAgbi51ID0gZnVuY3Rpb24oYSkgewogICAgICAgIFoodGhpcywgWSk7CiAgICAgICAgdGhpcy5kID0gMTsKICAgICAgICB0aGlzLmIgPSBuZXcgQ2EoKTsKICAgICAgICB0aGlzLmMgPSBhOwogICAgICB9OwogICAgICBuLnQgPSBmdW5jdGlvbigpIHsKICAgICAgICBaKHRoaXMsIDEpOwogICAgICAgIHRoaXMuZCA9IDI7CiAgICAgICAgdGhpcy5xID0gbnVsbDsKICAgICAgfTsKICAgICAgbi52ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgWih0aGlzLCAyKTsKICAgICAgICB0aGlzLmQgPSAxOwogICAgICB9OwogICAgICBuLncgPSBmdW5jdGlvbigpIHsKICAgICAgICBaKHRoaXMsIDEpOwogICAgICAgIHRoaXMuZCA9IFk7CiAgICAgICAgdmFyIGEgPSB0aGlzLmpbMF0sIGIgPSB0aGlzLmpbMV0sIGMgPSB0aGlzLmpbMl0sIGQgPSBmYWxzZSwgZSA9IFthLCBiLCBjXTsKICAgICAgICBpZiAoYSA9PT0gMCAmJiBiID09PSAwICYmIGMgPT09IDApIHsKICAgICAgICAgIGZvciAodmFyIGIgPSBbLTIgKiAxZTE1MCwgLTIgKiAxZTE1MCwgLTIgKiAxZTE1MF0sIGYgPSBbMiAqIDFlMTUwLCAyICogMWUxNTAsIDIgKiAxZTE1MF0sIGMgPSBbXSwgZyA9IFtdLCBkID0gdGhpcy5iLmMsIGEgPSBkLmU7IGEgIT09IGQ7IGEgPSBhLmUpCiAgICAgICAgICAgIGZvciAodmFyIGggPSAwOyAzID4gaDsgKytoKSB7CiAgICAgICAgICAgICAgdmFyIGsgPSBhLmdbaF07CiAgICAgICAgICAgICAgayA8IGZbaF0gJiYgKGZbaF0gPSBrLCBnW2hdID0gYSk7CiAgICAgICAgICAgICAgayA+IGJbaF0gJiYgKGJbaF0gPSBrLCBjW2hdID0gYSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIGEgPSAwOwogICAgICAgICAgYlsxXSAtIGZbMV0gPiBiWzBdIC0gZlswXSAmJiAoYSA9IDEpOwogICAgICAgICAgYlsyXSAtIGZbMl0gPiBiW2FdIC0gZlthXSAmJiAoYSA9IDIpOwogICAgICAgICAgaWYgKGZbYV0gPj0gYlthXSkKICAgICAgICAgICAgZVswXSA9IDAsIGVbMV0gPSAwLCBlWzJdID0gMTsKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBiID0gMDsKICAgICAgICAgICAgZiA9IGdbYV07CiAgICAgICAgICAgIGMgPSBjW2FdOwogICAgICAgICAgICBnID0gWzAsIDAsIDBdOwogICAgICAgICAgICBmID0gW2YuZ1swXSAtIGMuZ1swXSwgZi5nWzFdIC0gYy5nWzFdLCBmLmdbMl0gLSBjLmdbMl1dOwogICAgICAgICAgICBoID0gWzAsIDAsIDBdOwogICAgICAgICAgICBmb3IgKGEgPSBkLmU7IGEgIT09IGQ7IGEgPSBhLmUpCiAgICAgICAgICAgICAgaFswXSA9IGEuZ1swXSAtIGMuZ1swXSwgaFsxXSA9IGEuZ1sxXSAtIGMuZ1sxXSwgaFsyXSA9IGEuZ1syXSAtIGMuZ1syXSwgZ1swXSA9IGZbMV0gKiBoWzJdIC0gZlsyXSAqIGhbMV0sIGdbMV0gPSBmWzJdICogaFswXSAtIGZbMF0gKiBoWzJdLCBnWzJdID0gZlswXSAqIGhbMV0gLSBmWzFdICogaFswXSwgayA9IGdbMF0gKiBnWzBdICsgZ1sxXSAqIGdbMV0gKyBnWzJdICogZ1syXSwgayA+IGIgJiYgKGIgPSBrLCBlWzBdID0gZ1swXSwgZVsxXSA9IGdbMV0sIGVbMl0gPSBnWzJdKTsKICAgICAgICAgICAgMCA+PSBiICYmIChlWzBdID0gZVsxXSA9IGVbMl0gPSAwLCBlW2hhKGYpXSA9IDEpOwogICAgICAgICAgfQogICAgICAgICAgZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGcgPSBoYShlKTsKICAgICAgICBhID0gdGhpcy5iLmM7CiAgICAgICAgYiA9IChnICsgMSkgJSAzOwogICAgICAgIGMgPSAoZyArIDIpICUgMzsKICAgICAgICBnID0gMCA8IGVbZ10gPyAxIDogLTE7CiAgICAgICAgZm9yIChlID0gYS5lOyBlICE9PSBhOyBlID0gZS5lKQogICAgICAgICAgZS5iID0gZS5nW2JdLCBlLmEgPSBnICogZS5nW2NdOwogICAgICAgIGlmIChkKSB7CiAgICAgICAgICBlID0gMDsKICAgICAgICAgIGQgPSB0aGlzLmIuYTsKICAgICAgICAgIGZvciAoYSA9IGQuYjsgYSAhPT0gZDsgYSA9IGEuYikKICAgICAgICAgICAgaWYgKGIgPSBhLmEsICEoMCA+PSBiLmYpKSB7CiAgICAgICAgICAgICAgZG8KICAgICAgICAgICAgICAgIGUgKz0gKGIuYS5iIC0gYi5iLmEuYikgKiAoYi5hLmEgKyBiLmIuYS5hKSwgYiA9IGIuZTsKICAgICAgICAgICAgICB3aGlsZSAoYiAhPT0gYS5hKTsKICAgICAgICAgICAgfQogICAgICAgICAgaWYgKDAgPiBlKQogICAgICAgICAgICBmb3IgKGUgPSB0aGlzLmIuYywgZCA9IGUuZTsgZCAhPT0gZTsgZCA9IGQuZSkKICAgICAgICAgICAgICBkLmEgPSAtZC5hOwogICAgICAgIH0KICAgICAgICB0aGlzLm4gPSBmYWxzZTsKICAgICAgICBlID0gdGhpcy5iLmI7CiAgICAgICAgZm9yIChhID0gZS5oOyBhICE9PSBlOyBhID0gZCkKICAgICAgICAgIGlmIChkID0gYS5oLCBiID0gYS5lLCB0KGEuYSwgYS5iLmEpICYmIGEuZS5lICE9PSBhICYmICh0YSh0aGlzLCBiLCBhKSwgSShhKSwgYSA9IGIsIGIgPSBhLmUpLCBiLmUgPT09IGEpIHsKICAgICAgICAgICAgaWYgKGIgIT09IGEpIHsKICAgICAgICAgICAgICBpZiAoYiA9PT0gZCB8fCBiID09PSBkLmIpCiAgICAgICAgICAgICAgICBkID0gZC5oOwogICAgICAgICAgICAgIEkoYik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGEgPT09IGQgfHwgYSA9PT0gZC5iKQogICAgICAgICAgICAgIGQgPSBkLmg7CiAgICAgICAgICAgIEkoYSk7CiAgICAgICAgICB9CiAgICAgICAgdGhpcy5lID0gZSA9IG5ldyBEYSgpOwogICAgICAgIGQgPSB0aGlzLmIuYzsKICAgICAgICBmb3IgKGEgPSBkLmU7IGEgIT09IGQ7IGEgPSBhLmUpCiAgICAgICAgICBhLmggPSB4YShlLCBhKTsKICAgICAgICBFYShlKTsKICAgICAgICB0aGlzLmYgPSBuZXcgQWEodGhpcyk7CiAgICAgICAgemEodGhpcywgLU8pOwogICAgICAgIGZvciAoemEodGhpcywgTyk7IChlID0gRmEodGhpcy5lKSkgIT09IG51bGw7ICkgewogICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgIGE6CiAgICAgICAgICAgICAgaWYgKGEgPSB0aGlzLmUsIGEuYSA9PT0gMCkKICAgICAgICAgICAgICAgIGQgPSBHYShhLmIpOwogICAgICAgICAgICAgIGVsc2UgaWYgKGQgPSBhLmNbYS5kW2EuYSAtIDFdXSwgYS5iLmEgIT09IDAgJiYgKGEgPSBHYShhLmIpLCB1KGEsIGQpKSkgewogICAgICAgICAgICAgICAgZCA9IGE7CiAgICAgICAgICAgICAgICBicmVhayBhOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGQgPT09IG51bGwgfHwgIXQoZCwgZSkpCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGQgPSBGYSh0aGlzLmUpOwogICAgICAgICAgICB0YSh0aGlzLCBlLmMsIGQuYyk7CiAgICAgICAgICB9CiAgICAgICAgICB5YSh0aGlzLCBlKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5hID0gdGhpcy5mLmEuYS5iLmEuYTsKICAgICAgICBmb3IgKGUgPSAwOyAoZCA9IHRoaXMuZi5hLmEuYikgIT09IG51bGw7ICkKICAgICAgICAgIGQuaCB8fCArK2UsIFEoZCk7CiAgICAgICAgdGhpcy5mID0gbnVsbDsKICAgICAgICBlID0gdGhpcy5lOwogICAgICAgIGUuYiA9IG51bGw7CiAgICAgICAgZS5kID0gbnVsbDsKICAgICAgICB0aGlzLmUgPSBlLmMgPSBudWxsOwogICAgICAgIGUgPSB0aGlzLmI7CiAgICAgICAgZm9yIChhID0gZS5hLmI7IGEgIT09IGUuYTsgYSA9IGQpCiAgICAgICAgICBkID0gYS5iLCBhID0gYS5hLCBhLmUuZSA9PT0gYSAmJiAoUChhLmMsIGEpLCBJKGEpKTsKICAgICAgICBpZiAoIXRoaXMubikgewogICAgICAgICAgZSA9IHRoaXMuYjsKICAgICAgICAgIGlmICh0aGlzLm0pCiAgICAgICAgICAgIGZvciAoYSA9IGUuYi5oOyBhICE9PSBlLmI7IGEgPSBkKQogICAgICAgICAgICAgIGQgPSBhLmgsIGEuYi5kLmMgIT09IGEuZC5jID8gYS5mID0gYS5kLmMgPyAxIDogLTEgOiBJKGEpOwogICAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGEgPSBlLmEuYjsgYSAhPT0gZS5hOyBhID0gZCkKICAgICAgICAgICAgICBpZiAoZCA9IGEuYiwgYS5jKSB7CiAgICAgICAgICAgICAgICBmb3IgKGEgPSBhLmE7IHUoYS5iLmEsIGEuYSk7IGEgPSBhLmMuYikKICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgZm9yICg7IHUoYS5hLCBhLmIuYSk7IGEgPSBhLmUpCiAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgIGIgPSBhLmMuYjsKICAgICAgICAgICAgICAgIGZvciAoYyA9IHZvaWQgMDsgYS5lICE9PSBiOyApCiAgICAgICAgICAgICAgICAgIGlmICh1KGEuYi5hLCBiLmEpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICg7IGIuZSAhPT0gYSAmJiAoY2EoYi5lKSB8fCAwID49IHgoYi5hLCBiLmIuYSwgYi5lLmIuYSkpOyApCiAgICAgICAgICAgICAgICAgICAgICBjID0gTChiLmUsIGIpLCBiID0gYy5iOwogICAgICAgICAgICAgICAgICAgIGIgPSBiLmMuYjsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKDsgYi5lICE9PSBhICYmIChkYShhLmMuYikgfHwgMCA8PSB4KGEuYi5hLCBhLmEsIGEuYy5iLmEpKTsgKQogICAgICAgICAgICAgICAgICAgICAgYyA9IEwoYSwgYS5jLmIpLCBhID0gYy5iOwogICAgICAgICAgICAgICAgICAgIGEgPSBhLmU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoOyBiLmUuZSAhPT0gYTsgKQogICAgICAgICAgICAgICAgICBjID0gTChiLmUsIGIpLCBiID0gYy5iOwogICAgICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmggfHwgdGhpcy5pIHx8IHRoaXMuayB8fCB0aGlzLmwpCiAgICAgICAgICAgIGlmICh0aGlzLm0pCiAgICAgICAgICAgICAgZm9yIChlID0gdGhpcy5iLCBkID0gZS5hLmI7IGQgIT09IGUuYTsgZCA9IGQuYikgewogICAgICAgICAgICAgICAgaWYgKGQuYykgewogICAgICAgICAgICAgICAgICB0aGlzLmggJiYgdGhpcy5oKDIsIHRoaXMuYyk7CiAgICAgICAgICAgICAgICAgIGEgPSBkLmE7CiAgICAgICAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICAgICAgdGhpcy5rICYmIHRoaXMuayhhLmEuZCwgdGhpcy5jKSwgYSA9IGEuZTsKICAgICAgICAgICAgICAgICAgd2hpbGUgKGEgIT09IGQuYSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuaSAmJiB0aGlzLmkodGhpcy5jKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGUgPSB0aGlzLmI7CiAgICAgICAgICAgICAgZCA9ICEhdGhpcy5sOwogICAgICAgICAgICAgIGEgPSBmYWxzZTsKICAgICAgICAgICAgICBiID0gLTE7CiAgICAgICAgICAgICAgZm9yIChjID0gZS5hLmQ7IGMgIT09IGUuYTsgYyA9IGMuZCkKICAgICAgICAgICAgICAgIGlmIChjLmMpIHsKICAgICAgICAgICAgICAgICAgYSB8fCAodGhpcy5oICYmIHRoaXMuaCg0LCB0aGlzLmMpLCBhID0gdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIGcgPSBjLmE7CiAgICAgICAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICAgICAgZCAmJiAoZiA9IGcuYi5kLmMgPyAwIDogMSwgYiAhPT0gZiAmJiAoYiA9IGYsIHRoaXMubCAmJiB0aGlzLmwoISFiLCB0aGlzLmMpKSksIHRoaXMuayAmJiB0aGlzLmsoZy5hLmQsIHRoaXMuYyksIGcgPSBnLmU7CiAgICAgICAgICAgICAgICAgIHdoaWxlIChnICE9PSBjLmEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGEgJiYgdGhpcy5pICYmIHRoaXMuaSh0aGlzLmMpOwogICAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5yKSB7CiAgICAgICAgICAgIGUgPSB0aGlzLmI7CiAgICAgICAgICAgIGZvciAoYSA9IGUuYS5iOyBhICE9PSBlLmE7IGEgPSBkKQogICAgICAgICAgICAgIGlmIChkID0gYS5iLCAhYS5jKSB7CiAgICAgICAgICAgICAgICBiID0gYS5hOwogICAgICAgICAgICAgICAgYyA9IGIuZTsKICAgICAgICAgICAgICAgIGcgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICBnID0gYywgYyA9IGcuZSwgZy5kID0gbnVsbCwgZy5iLmQgPT09IG51bGwgJiYgKGcuYyA9PT0gZyA/IEYoZy5hLCBudWxsKSA6IChnLmEuYyA9IGcuYywgSChnLCBKKGcpKSksIGYgPSBnLmIsIGYuYyA9PT0gZiA/IEYoZi5hLCBudWxsKSA6IChmLmEuYyA9IGYuYywgSChmLCBKKGYpKSksIGZhKGcpKTsKICAgICAgICAgICAgICAgIHdoaWxlIChnICE9PSBiKTsKICAgICAgICAgICAgICAgIGIgPSBhLmQ7CiAgICAgICAgICAgICAgICBhID0gYS5iOwogICAgICAgICAgICAgICAgYS5kID0gYjsKICAgICAgICAgICAgICAgIGIuYiA9IGE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnIodGhpcy5iKTsKICAgICAgICAgICAgdGhpcy5jID0gdGhpcy5iID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLmIgPSB0aGlzLmMgPSBudWxsOwogICAgICB9OwogICAgICBmdW5jdGlvbiBaKGEsIGIpIHsKICAgICAgICBpZiAoYS5kICE9PSBiKQogICAgICAgICAgZm9yICg7IGEuZCAhPT0gYjsgKQogICAgICAgICAgICBpZiAoYS5kIDwgYikKICAgICAgICAgICAgICBzd2l0Y2ggKGEuZCkgewogICAgICAgICAgICAgICAgY2FzZSBZOgogICAgICAgICAgICAgICAgICBWKGEsIDEwMDE1MSk7CiAgICAgICAgICAgICAgICAgIGEudShudWxsKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgIFYoYSwgMTAwMTUyKSwgYS50KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgc3dpdGNoIChhLmQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgVihhLCAxMDAxNTQpOwogICAgICAgICAgICAgICAgICBhLnYoKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgIFYoYSwgMTAwMTUzKSwgYS53KCk7CiAgICAgICAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFYoYSwgYikgewogICAgICAgIGEucCAmJiBhLnAoYiwgYS5jKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBnYShhLCBiKSB7CiAgICAgICAgdGhpcy5iID0gYSB8fCB0aGlzOwogICAgICAgIHRoaXMuZCA9IGIgfHwgdGhpczsKICAgICAgICB0aGlzLmEgPSBudWxsOwogICAgICAgIHRoaXMuYyA9IGZhbHNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE0oKSB7CiAgICAgICAgdGhpcy5oID0gdGhpczsKICAgICAgICB0aGlzLmkgPSB0aGlzLmQgPSB0aGlzLmEgPSB0aGlzLmUgPSB0aGlzLmMgPSB0aGlzLmIgPSBudWxsOwogICAgICAgIHRoaXMuZiA9IDA7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSihhKSB7CiAgICAgICAgcmV0dXJuIGEuYi5lOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIENhKCkgewogICAgICAgIHRoaXMuYyA9IG5ldyBOKCk7CiAgICAgICAgdGhpcy5hID0gbmV3IGdhKCk7CiAgICAgICAgdGhpcy5iID0gbmV3IE0oKTsKICAgICAgICB0aGlzLmQgPSBuZXcgTSgpOwogICAgICAgIHRoaXMuYi5iID0gdGhpcy5kOwogICAgICAgIHRoaXMuZC5iID0gdGhpcy5iOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE4oYSwgYikgewogICAgICAgIHRoaXMuZSA9IGEgfHwgdGhpczsKICAgICAgICB0aGlzLmYgPSBiIHx8IHRoaXM7CiAgICAgICAgdGhpcy5kID0gdGhpcy5jID0gbnVsbDsKICAgICAgICB0aGlzLmcgPSBbMCwgMCwgMF07CiAgICAgICAgdGhpcy5oID0gdGhpcy5hID0gdGhpcy5iID0gMDsKICAgICAgfQogICAgICBmdW5jdGlvbiBEYSgpIHsKICAgICAgICB0aGlzLmMgPSBbXTsKICAgICAgICB0aGlzLmQgPSBudWxsOwogICAgICAgIHRoaXMuYSA9IDA7CiAgICAgICAgdGhpcy5lID0gZmFsc2U7CiAgICAgICAgdGhpcy5iID0gbmV3IEhhKCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRWEoYSkgewogICAgICAgIGEuZCA9IFtdOwogICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgYS5hOyBiKyspCiAgICAgICAgICBhLmRbYl0gPSBiOwogICAgICAgIGEuZC5zb3J0KGZ1bmN0aW9uKGEyKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYjIsIGUpIHsKICAgICAgICAgICAgcmV0dXJuIHUoYTJbYjJdLCBhMltlXSkgPyAxIDogLTE7CiAgICAgICAgICB9OwogICAgICAgIH0oYS5jKSk7CiAgICAgICAgYS5lID0gdHJ1ZTsKICAgICAgICBJYShhLmIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHhhKGEsIGIpIHsKICAgICAgICBpZiAoYS5lKSB7CiAgICAgICAgICB2YXIgYyA9IGEuYiwgZCA9ICsrYy5hOwogICAgICAgICAgMiAqIGQgPiBjLmYgJiYgKGMuZiAqPSAyLCBjLmMgPSBKYShjLmMsIGMuZiArIDEpKTsKICAgICAgICAgIHZhciBlOwogICAgICAgICAgYy5iID09PSAwID8gZSA9IGQgOiAoZSA9IGMuYiwgYy5iID0gYy5jW2MuYl0pOwogICAgICAgICAgYy5lW2VdID0gYjsKICAgICAgICAgIGMuY1tlXSA9IGQ7CiAgICAgICAgICBjLmRbZF0gPSBlOwogICAgICAgICAgYy5oICYmIHZhKGMsIGQpOwogICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgfQogICAgICAgIGMgPSBhLmErKzsKICAgICAgICBhLmNbY10gPSBiOwogICAgICAgIHJldHVybiAtKGMgKyAxKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBGYShhKSB7CiAgICAgICAgaWYgKGEuYSA9PT0gMCkKICAgICAgICAgIHJldHVybiBLYShhLmIpOwogICAgICAgIHZhciBiID0gYS5jW2EuZFthLmEgLSAxXV07CiAgICAgICAgaWYgKGEuYi5hICE9PSAwICYmIHUoR2EoYS5iKSwgYikpCiAgICAgICAgICByZXR1cm4gS2EoYS5iKTsKICAgICAgICBkbwogICAgICAgICAgLS1hLmE7CiAgICAgICAgd2hpbGUgKDAgPCBhLmEgJiYgYS5jW2EuZFthLmEgLSAxXV0gPT09IG51bGwpOwogICAgICAgIHJldHVybiBiOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEhhKCkgewogICAgICAgIHRoaXMuZCA9IEphKFswXSwgMzMpOwogICAgICAgIHRoaXMuZSA9IFtudWxsLCBudWxsXTsKICAgICAgICB0aGlzLmMgPSBbMCwgMF07CiAgICAgICAgdGhpcy5hID0gMDsKICAgICAgICB0aGlzLmYgPSAzMjsKICAgICAgICB0aGlzLmIgPSAwOwogICAgICAgIHRoaXMuaCA9IGZhbHNlOwogICAgICAgIHRoaXMuZFsxXSA9IDE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSmEoYSwgYikgewogICAgICAgIGZvciAodmFyIGMgPSBBcnJheShiKSwgZCA9IDA7IGQgPCBhLmxlbmd0aDsgZCsrKQogICAgICAgICAgY1tkXSA9IGFbZF07CiAgICAgICAgZm9yICg7IGQgPCBiOyBkKyspCiAgICAgICAgICBjW2RdID0gMDsKICAgICAgICByZXR1cm4gYzsKICAgICAgfQogICAgICBmdW5jdGlvbiBJYShhKSB7CiAgICAgICAgZm9yICh2YXIgYiA9IGEuYTsgMSA8PSBiOyAtLWIpCiAgICAgICAgICBXKGEsIGIpOwogICAgICAgIGEuaCA9IHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gR2EoYSkgewogICAgICAgIHJldHVybiBhLmVbYS5kWzFdXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBLYShhKSB7CiAgICAgICAgdmFyIGIgPSBhLmQsIGMgPSBhLmUsIGQgPSBhLmMsIGUgPSBiWzFdLCBmID0gY1tlXTsKICAgICAgICAwIDwgYS5hICYmIChiWzFdID0gYlthLmFdLCBkW2JbMV1dID0gMSwgY1tlXSA9IG51bGwsIGRbZV0gPSBhLmIsIGEuYiA9IGUsIDAgPCAtLWEuYSAmJiBXKGEsIDEpKTsKICAgICAgICByZXR1cm4gZjsKICAgICAgfQogICAgICBmdW5jdGlvbiBXKGEsIGIpIHsKICAgICAgICBmb3IgKHZhciBjID0gYS5kLCBkID0gYS5lLCBlID0gYS5jLCBmID0gYiwgZyA9IGNbZl07IDsgKSB7CiAgICAgICAgICB2YXIgaCA9IGYgPDwgMTsKICAgICAgICAgIGggPCBhLmEgJiYgdShkW2NbaCArIDFdXSwgZFtjW2hdXSkgJiYgKGggKz0gMSk7CiAgICAgICAgICB2YXIgayA9IGNbaF07CiAgICAgICAgICBpZiAoaCA+IGEuYSB8fCB1KGRbZ10sIGRba10pKSB7CiAgICAgICAgICAgIGNbZl0gPSBnOwogICAgICAgICAgICBlW2ddID0gZjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjW2ZdID0gazsKICAgICAgICAgIGVba10gPSBmOwogICAgICAgICAgZiA9IGg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHZhKGEsIGIpIHsKICAgICAgICBmb3IgKHZhciBjID0gYS5kLCBkID0gYS5lLCBlID0gYS5jLCBmID0gYiwgZyA9IGNbZl07IDsgKSB7CiAgICAgICAgICB2YXIgaCA9IGYgPj4gMSwgayA9IGNbaF07CiAgICAgICAgICBpZiAoaCA9PT0gMCB8fCB1KGRba10sIGRbZ10pKSB7CiAgICAgICAgICAgIGNbZl0gPSBnOwogICAgICAgICAgICBlW2ddID0gZjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjW2ZdID0gazsKICAgICAgICAgIGVba10gPSBmOwogICAgICAgICAgZiA9IGg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIG1hKCkgewogICAgICAgIHRoaXMuZSA9IHRoaXMuYSA9IG51bGw7CiAgICAgICAgdGhpcy5mID0gMDsKICAgICAgICB0aGlzLmMgPSB0aGlzLmIgPSB0aGlzLmggPSB0aGlzLmQgPSBmYWxzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTKGEpIHsKICAgICAgICByZXR1cm4gYS5lLmMuYjsKICAgICAgfQogICAgICBmdW5jdGlvbiBSKGEpIHsKICAgICAgICByZXR1cm4gYS5lLmEuYjsKICAgICAgfQogICAgICBleHBvcnRzLmxpYnRlc3MgPSB7CiAgICAgICAgR2x1VGVzc2VsYXRvcjogWCwKICAgICAgICB3aW5kaW5nUnVsZTogeyBHTFVfVEVTU19XSU5ESU5HX09ERDogMTAwMTMwLCBHTFVfVEVTU19XSU5ESU5HX05PTlpFUk86IDEwMDEzMSwgR0xVX1RFU1NfV0lORElOR19QT1NJVElWRTogMTAwMTMyLCBHTFVfVEVTU19XSU5ESU5HX05FR0FUSVZFOiAxMDAxMzMsIEdMVV9URVNTX1dJTkRJTkdfQUJTX0dFUV9UV086IDEwMDEzNCB9LAogICAgICAgIHByaW1pdGl2ZVR5cGU6IHsgR0xfTElORV9MT09QOiAyLCBHTF9UUklBTkdMRVM6IDQsIEdMX1RSSUFOR0xFX1NUUklQOiA1LCBHTF9UUklBTkdMRV9GQU46IDYgfSwKICAgICAgICBlcnJvclR5cGU6IHsgR0xVX1RFU1NfTUlTU0lOR19CRUdJTl9QT0xZR09OOiAxMDAxNTEsIEdMVV9URVNTX01JU1NJTkdfRU5EX1BPTFlHT046IDEwMDE1MywgR0xVX1RFU1NfTUlTU0lOR19CRUdJTl9DT05UT1VSOiAxMDAxNTIsIEdMVV9URVNTX01JU1NJTkdfRU5EX0NPTlRPVVI6IDEwMDE1NCwgR0xVX1RFU1NfQ09PUkRfVE9PX0xBUkdFOiAxMDAxNTUsIEdMVV9URVNTX05FRURfQ09NQklORV9DQUxMQkFDSzogMTAwMTU2IH0sCiAgICAgICAgZ2x1RW51bTogeyBHTFVfVEVTU19NRVNIOiAxMDAxMTIsIEdMVV9URVNTX1RPTEVSQU5DRTogMTAwMTQyLCBHTFVfVEVTU19XSU5ESU5HX1JVTEU6IDEwMDE0MCwgR0xVX1RFU1NfQk9VTkRBUllfT05MWTogMTAwMTQxLCBHTFVfSU5WQUxJRF9FTlVNOiAxMDA5MDAsIEdMVV9JTlZBTElEX1ZBTFVFOiAxMDA5MDEsIEdMVV9URVNTX0JFR0lOOiAxMDAxMDAsIEdMVV9URVNTX1ZFUlRFWDogMTAwMTAxLCBHTFVfVEVTU19FTkQ6IDEwMDEwMiwgR0xVX1RFU1NfRVJST1I6IDEwMDEwMywgR0xVX1RFU1NfRURHRV9GTEFHOiAxMDAxMDQsIEdMVV9URVNTX0NPTUJJTkU6IDEwMDEwNSwgR0xVX1RFU1NfQkVHSU5fREFUQTogMTAwMTA2LCBHTFVfVEVTU19WRVJURVhfREFUQTogMTAwMTA3LCBHTFVfVEVTU19FTkRfREFUQTogMTAwMTA4LCBHTFVfVEVTU19FUlJPUl9EQVRBOiAxMDAxMDksIEdMVV9URVNTX0VER0VfRkxBR19EQVRBOiAxMDAxMTAsIEdMVV9URVNTX0NPTUJJTkVfREFUQTogMTAwMTExIH0KICAgICAgfTsKICAgICAgWC5wcm90b3R5cGUuZ2x1RGVsZXRlVGVzcyA9IFgucHJvdG90eXBlLng7CiAgICAgIFgucHJvdG90eXBlLmdsdVRlc3NQcm9wZXJ0eSA9IFgucHJvdG90eXBlLkI7CiAgICAgIFgucHJvdG90eXBlLmdsdUdldFRlc3NQcm9wZXJ0eSA9IFgucHJvdG90eXBlLnk7CiAgICAgIFgucHJvdG90eXBlLmdsdVRlc3NOb3JtYWwgPSBYLnByb3RvdHlwZS5BOwogICAgICBYLnByb3RvdHlwZS5nbHVUZXNzQ2FsbGJhY2sgPSBYLnByb3RvdHlwZS56OwogICAgICBYLnByb3RvdHlwZS5nbHVUZXNzVmVydGV4ID0gWC5wcm90b3R5cGUuQzsKICAgICAgWC5wcm90b3R5cGUuZ2x1VGVzc0JlZ2luUG9seWdvbiA9IFgucHJvdG90eXBlLnU7CiAgICAgIFgucHJvdG90eXBlLmdsdVRlc3NCZWdpbkNvbnRvdXIgPSBYLnByb3RvdHlwZS50OwogICAgICBYLnByb3RvdHlwZS5nbHVUZXNzRW5kQ29udG91ciA9IFgucHJvdG90eXBlLnY7CiAgICAgIFgucHJvdG90eXBlLmdsdVRlc3NFbmRQb2x5Z29uID0gWC5wcm90b3R5cGUudzsKICAgICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzLmxpYnRlc3M7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8gc291cmNlL2NhbnZhcy92ZW5kb3JzL3BvbHlnb24tdG9vbHMvdGVzc2VsYXRvci5qcwogIHZhciB0ZXNzZWxhdG9yX2V4cG9ydHMgPSB7fTsKICBfX2V4cG9ydCh0ZXNzZWxhdG9yX2V4cG9ydHMsIHsKICAgIERFRkFVTFRfT1BUSU9OUzogKCkgPT4gREVGQVVMVF9PUFRJT05TLAogICAgR0xVX1RFU1NfV0lORElOR19BQlNfR0VRX1RXTzogKCkgPT4gR0xVX1RFU1NfV0lORElOR19BQlNfR0VRX1RXTywKICAgIEdMVV9URVNTX1dJTkRJTkdfTkVHQVRJVkU6ICgpID0+IEdMVV9URVNTX1dJTkRJTkdfTkVHQVRJVkUsCiAgICBHTFVfVEVTU19XSU5ESU5HX05PTlpFUk86ICgpID0+IEdMVV9URVNTX1dJTkRJTkdfTk9OWkVSTywKICAgIEdMVV9URVNTX1dJTkRJTkdfT0REOiAoKSA9PiBHTFVfVEVTU19XSU5ESU5HX09ERCwKICAgIEdMVV9URVNTX1dJTkRJTkdfUE9TSVRJVkU6ICgpID0+IEdMVV9URVNTX1dJTkRJTkdfUE9TSVRJVkUsCiAgICBHTF9MSU5FX0xPT1A6ICgpID0+IEdMX0xJTkVfTE9PUCwKICAgIEdMX1RSSUFOR0xFUzogKCkgPT4gR0xfVFJJQU5HTEVTLAogICAgR0xfVFJJQU5HTEVfRkFOOiAoKSA9PiBHTF9UUklBTkdMRV9GQU4sCiAgICBHTF9UUklBTkdMRV9TVFJJUDogKCkgPT4gR0xfVFJJQU5HTEVfU1RSSVAsCiAgICBUZXNzZWxhdG9yOiAoKSA9PiBUZXNzZWxhdG9yLAogICAgcnVuOiAoKSA9PiBydW4KICB9KTsKICB2YXIgaW1wb3J0X2xpYnRlc3MgPSBfX3RvRVNNKHJlcXVpcmVfbGlidGVzc19taW4oKSk7CgogIC8vIHNvdXJjZS9jYW52YXMvdmVuZG9ycy9wb2x5Z29uLXRvb2xzL3BvbHlnb24uanMKICB2YXIgcG9seWdvbl9leHBvcnRzID0ge307CiAgX19leHBvcnQocG9seWdvbl9leHBvcnRzLCB7CiAgICBXSU5ESU5HX0NDVzogKCkgPT4gV0lORElOR19DQ1csCiAgICBXSU5ESU5HX0NXOiAoKSA9PiBXSU5ESU5HX0NXLAogICAgV0lORElOR19VTktOT1dOOiAoKSA9PiBXSU5ESU5HX1VOS05PV04sCiAgICBhcmVhOiAoKSA9PiBhcmVhLAogICAgYm91bmRzOiAoKSA9PiBib3VuZHMsCiAgICBjY3c6ICgpID0+IGNjdywKICAgIGNlbnRyb2lkOiAoKSA9PiBjZW50cm9pZCwKICAgIGVuc3VyZV9jY3c6ICgpID0+IGVuc3VyZV9jY3csCiAgICBlbnN1cmVfY3c6ICgpID0+IGVuc3VyZV9jdywKICAgIGludGVyc2VjdGlvbjogKCkgPT4gaW50ZXJzZWN0aW9uLAogICAgaXNfY2N3OiAoKSA9PiBpc19jY3csCiAgICBpc19jdzogKCkgPT4gaXNfY3csCiAgICBub3JtYWw6ICgpID0+IG5vcm1hbCwKICAgIHN1YnRyYWN0OiAoKSA9PiBzdWJ0cmFjdDMsCiAgICB0cmlhbmd1bGF0ZTogKCkgPT4gdHJpYW5ndWxhdGUsCiAgICB1bmlvbjogKCkgPT4gdW5pb24sCiAgICB3aW5kaW5nOiAoKSA9PiB3aW5kaW5nCiAgfSk7CgogIC8vIHNvdXJjZS9jYW52YXMvdmVuZG9ycy9wb2x5Z29uLXRvb2xzL3ZlYy5qcwogIGZ1bmN0aW9uIGNyb3NzKGEsIGIpIHsKICAgIGEgPSBhLmxlbmd0aCA9PT0gMiA/IFthWzBdLCBhWzFdLCAwXSA6IGE7CiAgICBiID0gYi5sZW5ndGggPT09IDIgPyBbYlswXSwgYlsxXSwgMF0gOiBiOwogICAgcmV0dXJuIFsKICAgICAgYVsxXSAqIGJbMl0gLSBhWzJdICogYlsxXSwKICAgICAgYVsyXSAqIGJbMF0gLSBhWzBdICogYlsyXSwKICAgICAgYVswXSAqIGJbMV0gLSBhWzFdICogYlswXQogICAgXTsKICB9CiAgZnVuY3Rpb24gbGVuZ3RoKHYpIHsKICAgIHJldHVybiBNYXRoLnNxcnQodi5zbGljZSgwLCAzKS5yZWR1Y2UoKHAsIHcsIGkpID0+IHsKICAgICAgcmV0dXJuIHAgKyB3ICogdzsKICAgIH0sIDApKTsKICB9CiAgZnVuY3Rpb24gZG90KGEsIGIpIHsKICAgIHJldHVybiBhLnJlZHVjZSgocCwgdiwgaSkgPT4gewogICAgICByZXR1cm4gcCArIHYgKiBiW2ldOwogICAgfSwgMCk7CiAgfQogIGZ1bmN0aW9uIG5vcm1hbGl6ZSh2KSB7CiAgICBsZXQgbGVuID0gbGVuZ3RoKHYpOwogICAgcmV0dXJuIHYuc2xpY2UoMCwgMykubWFwKChpKSA9PiBpIC8gbGVuKTsKICB9CiAgZnVuY3Rpb24gYWRkKGEsIGIpIHsKICAgIHJldHVybiBhLnNsaWNlKDAsIDMpLm1hcCgodiwgaSkgPT4gdiArIGJbaV0pOwogIH0KICBmdW5jdGlvbiBzdWJ0cmFjdDIoYSwgYikgewogICAgcmV0dXJuIGEuc2xpY2UoMCwgMykubWFwKCh2LCBpKSA9PiB2IC0gYltpXSk7CiAgfQoKICAvLyBzb3VyY2UvY2FudmFzL3ZlbmRvcnMvcG9seWdvbi10b29scy9wb2x5Z29uLmpzCiAgdmFyIFdJTkRJTkdfVU5LTk9XTiA9IDA7CiAgdmFyIFdJTkRJTkdfQ0NXID0gMTsKICB2YXIgV0lORElOR19DVyA9IDI7CiAgZnVuY3Rpb24gY2N3KGEsIGIsIGMpIHsKICAgIHJldHVybiAoYlswXSAtIGFbMF0pICogKGNbMV0gLSBhWzFdKSAtIChjWzBdIC0gYVswXSkgKiAoYlsxXSAtIGFbMV0pOwogIH0KICBmdW5jdGlvbiBub3JtYWwocHRzLCBmb3JjZU5ld2VsbCA9IGZhbHNlKSB7CiAgICBpZiAocHRzLmxlbmd0aCA8IDMpCiAgICAgIHJldHVybiBudWxsOwogICAgbGV0IHZzID0gcHRzLm1hcCgocCkgPT4gewogICAgICByZXR1cm4gcC5sZW5ndGggPj0gMyA/IHAgOiBbcFswXSwgcFsxXSwgMF07CiAgICB9KTsKICAgIGlmICghZm9yY2VOZXdlbGwpIHsKICAgICAgbGV0IFthLCBiLCBjXSA9IHZzLCBiYSA9IHN1YnRyYWN0MihiLCBhKSwgY2EgPSBzdWJ0cmFjdDIoYywgYSksIGNyID0gbm9ybWFsaXplKGNyb3NzKGJhLCBjYSkpOwogICAgICBpZiAoY3Iuc29tZSgodikgPT4gaXNOYU4odikpKSB7CiAgICAgICAgaWYgKHB0cy5sZW5ndGggPT09IDMpCiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gY3I7CiAgICAgIH0KICAgIH0KICAgIGxldCBuID0gWzAsIDAsIDBdOwogICAgdnMuZm9yRWFjaCgodiwgaSkgPT4gewogICAgICBsZXQgdyA9IHZzWyhpICsgMSkgJSBwdHMubGVuZ3RoXTsKICAgICAgblswXSA9IG5bMF0gKyAodlsxXSAtIHdbMV0pICogKHZbMl0gKyB3WzJdKTsKICAgICAgblsxXSA9IG5bMV0gKyAodlsyXSAtIHdbMl0pICogKHZbMF0gKyB3WzBdKTsKICAgICAgblsyXSA9IG5bMl0gKyAodlswXSAtIHdbMF0pICogKHZbMV0gKyB3WzFdKTsKICAgIH0pOwogICAgbiA9IG5vcm1hbGl6ZShuKTsKICAgIHJldHVybiBuLnNvbWUoKHYpID0+IGlzTmFOKHYpKSA/IG51bGwgOiBuOwogIH0KICBmdW5jdGlvbiBhcmVhKHB0cywgbiA9IG51bGwpIHsKICAgIGlmIChwdHMubGVuZ3RoIDwgMykKICAgICAgcmV0dXJuIDA7CiAgICBpZiAocHRzWzBdLmxlbmd0aCA8IDMpIHsKICAgICAgcmV0dXJuIHB0cy5yZWR1Y2UoKGEsIHAsIGkpID0+IHsKICAgICAgICBsZXQgcG4gPSBwdHNbaSArIDFdIHx8IHB0c1swXTsKICAgICAgICByZXR1cm4gYSArIHBbMF0gKiBwblsxXSAtIHBuWzBdICogcFsxXTsKICAgICAgfSwgMCkgLyAyOwogICAgfSBlbHNlIHsKICAgICAgbGV0IG51bSA9IHB0cy5sZW5ndGgsIG5ybSA9IG4gfHwgbm9ybWFsKHB0cyksIHRvdGFsID0gWzAsIDAsIDBdOwogICAgICBpZiAoIW5ybSkKICAgICAgICByZXR1cm4gMDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW07ICsraSkgewogICAgICAgIGxldCB2ID0gcHRzW2ldLCB3ID0gcHRzWyhpICsgMSkgJSBudW1dOwogICAgICAgIHRvdGFsID0gYWRkKHRvdGFsLCBjcm9zcyh2LCB3KSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGRvdCh0b3RhbCwgbnJtKSAvIDI7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGNlbnRyb2lkKHB0cykgewogICAgbGV0IFt4LCB5XSA9IHB0cy5yZWR1Y2UoKFt4MiwgeTJdLCBwLCBpKSA9PiB7CiAgICAgIGxldCBwbiA9IHB0c1tpICsgMV0gfHwgcHRzWzBdLCBjID0gcFswXSAqIHBuWzFdIC0gcG5bMF0gKiBwWzFdOwogICAgICByZXR1cm4gW3gyICsgKHBbMF0gKyBwblswXSkgKiBjLCB5MiArIChwWzFdICsgcG5bMV0pICogY107CiAgICB9LCBbMCwgMF0pOwogICAgbGV0IGFyID0gYXJlYShwdHMpOwogICAgaWYgKHggIT09IDApIHsKICAgICAgeCA9IHggLyAoTWF0aC5hYnMoYXIpICogNik7CiAgICB9CiAgICBpZiAoeSAhPT0gMCkgewogICAgICB5ID0geSAvIChNYXRoLmFicyhhcikgKiA2KTsKICAgIH0KICAgIGlmIChhciA8IDApIHsKICAgICAgeCA9IC14OwogICAgICB5ID0gLXk7CiAgICB9CiAgICByZXR1cm4gW3gsIHldOwogIH0KICBmdW5jdGlvbiBpc19jY3cocHRzLCBuID0gbnVsbCkgewogICAgcmV0dXJuIGFyZWEocHRzLCBuKSA+IDA7CiAgfQogIGZ1bmN0aW9uIGlzX2N3KHB0cywgbiA9IG51bGwpIHsKICAgIHJldHVybiBhcmVhKHB0cywgbikgPCAwOwogIH0KICBmdW5jdGlvbiB3aW5kaW5nKHB0cywgbiA9IG51bGwpIHsKICAgIGxldCBhID0gYXJlYShwdHMsIG4pOwogICAgaWYgKGEgPCAwKQogICAgICByZXR1cm4gV0lORElOR19DVzsKICAgIGlmIChhID4gMCkKICAgICAgcmV0dXJuIFdJTkRJTkdfQ0NXOwogICAgcmV0dXJuIFdJTkRJTkdfVU5LTk9XTjsKICB9CiAgZnVuY3Rpb24gYm91bmRzKHB0cykgewogICAgbGV0IG1pbiA9IFtOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFXSwgbWF4ID0gWy1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRV07CiAgICBwdHMuZm9yRWFjaCgocCkgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE1hdGgubWluKDMsIHAubGVuZ3RoKTsgKytpKSB7CiAgICAgICAgbWluW2ldID0gTWF0aC5taW4obWluW2ldLCBwW2ldKTsKICAgICAgICBtYXhbaV0gPSBNYXRoLm1heChtYXhbaV0sIHBbaV0pOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIHhNaW46IG1pblswXSwKICAgICAgeU1pbjogbWluWzFdLAogICAgICB4TWF4OiBtYXhbMF0sCiAgICAgIHlNYXg6IG1heFsxXQogICAgfTsKICB9CiAgZnVuY3Rpb24gZW5zdXJlX2N3KHB0cywgbiA9IG51bGwpIHsKICAgIGlmIChpc19jY3cocHRzLCBuKSkKICAgICAgcHRzLnJldmVyc2UoKTsKICAgIHJldHVybiBwdHM7CiAgfQogIGZ1bmN0aW9uIGVuc3VyZV9jY3cocHRzLCBuID0gbnVsbCkgewogICAgaWYgKGlzX2N3KHB0cywgbikpCiAgICAgIHB0cy5yZXZlcnNlKCk7CiAgICByZXR1cm4gcHRzOwogIH0KICBmdW5jdGlvbiB0cmlhbmd1bGF0ZShwb2x5Z29uMiwgaG9sZXMpIHsKICAgIGlmICghcG9seWdvbjIgfHwgcG9seWdvbjIubGVuZ3RoIDwgMykKICAgICAgcmV0dXJuIHBvbHlnb24yOwogICAgbGV0IGJwID0gYm91bmRzKHBvbHlnb24yKTsKICAgIGhvbGVzID0gaG9sZXMuZmlsdGVyKChob2xlKSA9PiB7CiAgICAgIGxldCBiID0gYm91bmRzKGhvbGUpLCBvdXQgPSBiLnhNaW4gPiBicC54TWF4IHx8IGIueU1pbiA+IGJwLnlNYXggfHwgYi54TWF4IDwgYnAueE1pbiB8fCBiLnlNYXggPCBicC55TWluOwogICAgICByZXR1cm4gIW91dDsKICAgIH0pOwogICAgbGV0IG9wdGlvbnMgPSB7IHBvbHlnb25zOiBbcG9seWdvbjJdLCBob2xlcyB9OwogICAgcmV0dXJuIHJ1bihvcHRpb25zKS5yZWR1Y2UoKHAsIHYpID0+IHsKICAgICAgcmV0dXJuIHAuY29uY2F0KHYpOwogICAgfSwgW10pOwogIH0KICBmdW5jdGlvbiBzdWJ0cmFjdDMoLi4ucG9seWdvbnMpIHsKICAgIGxldCBvcHRpb25zID0gewogICAgICBwb2x5Z29uczogW2Vuc3VyZV9jY3cocG9seWdvbnNbMF0pXSwKICAgICAgaG9sZXM6IHBvbHlnb25zLnNsaWNlKDEpLm1hcCgocCkgPT4gZW5zdXJlX2N3KHApKSwKICAgICAgYm91bmRhcnlPbmx5OiB0cnVlLAogICAgICBhdXRvV2luZGluZzogZmFsc2UKICAgIH07CiAgICByZXR1cm4gcnVuKG9wdGlvbnMpOwogIH0KICBmdW5jdGlvbiB1bmlvbiguLi5wb2x5Z29ucykgewogICAgbGV0IG9wdGlvbnMgPSB7CiAgICAgIHBvbHlnb25zOiBwb2x5Z29ucy5tYXAoKHApID0+IGVuc3VyZV9jY3cocCkpLAogICAgICBib3VuZGFyeU9ubHk6IHRydWUsCiAgICAgIGF1dG9XaW5kaW5nOiBmYWxzZQogICAgfTsKICAgIHJldHVybiBydW4ob3B0aW9ucyk7CiAgfQogIGZ1bmN0aW9uIGludGVyc2VjdGlvbihhLCBiKSB7CiAgICBsZXQgb3B0aW9ucyA9IHsKICAgICAgcG9seWdvbnM6IFtlbnN1cmVfY2N3KGEpLCBlbnN1cmVfY2N3KGIpXSwKICAgICAgYm91bmRhcnlPbmx5OiB0cnVlLAogICAgICB3aW5kaW5nUnVsZTogR0xVX1RFU1NfV0lORElOR19BQlNfR0VRX1RXTywKICAgICAgYXV0b1dpbmRpbmc6IGZhbHNlCiAgICB9OwogICAgcmV0dXJuIHJ1bihvcHRpb25zKTsKICB9CgogIC8vIHNvdXJjZS9jYW52YXMvdmVuZG9ycy9wb2x5Z29uLXRvb2xzL3Rlc3NlbGF0b3IuanMKICB2YXIgewogICAgR0xfTElORV9MT09QLAogICAgR0xfVFJJQU5HTEVTLAogICAgR0xfVFJJQU5HTEVfU1RSSVAsCiAgICBHTF9UUklBTkdMRV9GQU4KICB9ID0gaW1wb3J0X2xpYnRlc3MucHJpbWl0aXZlVHlwZTsKICB2YXIgewogICAgR0xVX1RFU1NfV0lORElOR19PREQsCiAgICBHTFVfVEVTU19XSU5ESU5HX05PTlpFUk8sCiAgICBHTFVfVEVTU19XSU5ESU5HX1BPU0lUSVZFLAogICAgR0xVX1RFU1NfV0lORElOR19ORUdBVElWRSwKICAgIEdMVV9URVNTX1dJTkRJTkdfQUJTX0dFUV9UV08KICB9ID0gaW1wb3J0X2xpYnRlc3Mud2luZGluZ1J1bGU7CiAgdmFyIERFRkFVTFRfT1BUSU9OUyA9IHsKICAgIHBvbHlnb25zOiBbXSwKICAgIGhvbGVzOiBbXSwKICAgIHdpbmRpbmdSdWxlOiBHTFVfVEVTU19XSU5ESU5HX1BPU0lUSVZFLAogICAgYm91bmRhcnlPbmx5OiBmYWxzZSwKICAgIG5vcm1hbDogbnVsbCwKICAgIGF1dG9XaW5kaW5nOiB0cnVlCiAgfTsKICB2YXIgVGVzc2VsYXRvciA9IGNsYXNzIGV4dGVuZHMgaW1wb3J0X2xpYnRlc3MuR2x1VGVzc2VsYXRvciB7CiAgICBjb25zdHJ1Y3Rvcih2c2l6ZSA9IDIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5fdnNpemUgPSB2c2l6ZTsKICAgICAgdGhpcy5fY3VycmVudCA9IFtdOwogICAgICB0aGlzLl9vdXQgPSBbXTsKICAgICAgdGhpcy5fcHJpbWl0aXZlVHlwZSA9IDA7CiAgICAgIHRoaXMuZ2x1VGVzc0NhbGxiYWNrKGltcG9ydF9saWJ0ZXNzLmdsdUVudW0uR0xVX1RFU1NfVkVSVEVYX0RBVEEsIHRoaXMuX3ZlcnRleCk7CiAgICAgIHRoaXMuZ2x1VGVzc0NhbGxiYWNrKGltcG9ydF9saWJ0ZXNzLmdsdUVudW0uR0xVX1RFU1NfQkVHSU4sIHRoaXMuX2JlZ2luKTsKICAgICAgdGhpcy5nbHVUZXNzQ2FsbGJhY2soaW1wb3J0X2xpYnRlc3MuZ2x1RW51bS5HTFVfVEVTU19FTkQsIHRoaXMuX2VuZCk7CiAgICAgIHRoaXMuZ2x1VGVzc0NhbGxiYWNrKGltcG9ydF9saWJ0ZXNzLmdsdUVudW0uR0xVX1RFU1NfRVJST1IsIHRoaXMuX2Vycm9yKTsKICAgICAgdGhpcy5nbHVUZXNzQ2FsbGJhY2soaW1wb3J0X2xpYnRlc3MuZ2x1RW51bS5HTFVfVEVTU19DT01CSU5FLCB0aGlzLl9jb21iaW5lKTsKICAgICAgdGhpcy5nbHVUZXNzQ2FsbGJhY2soaW1wb3J0X2xpYnRlc3MuZ2x1RW51bS5HTFVfVEVTU19FREdFX0ZMQUcsIHRoaXMuX2VkZ2UpOwogICAgfQogICAgc3RhcnQocG9seWdvbnMsIGhvbGVzKSB7CiAgICAgIHRoaXMuX2N1cnJlbnQgPSBbXTsKICAgICAgdGhpcy5fb3V0ID0gW107CiAgICAgIHRoaXMuZ2x1VGVzc0JlZ2luUG9seWdvbigpOwogICAgICBmb3IgKGxldCBwb2x5IG9mIHBvbHlnb25zKSB7CiAgICAgICAgdGhpcy5nbHVUZXNzQmVnaW5Db250b3VyKCk7CiAgICAgICAgZm9yIChsZXQgdiBvZiBwb2x5KSB7CiAgICAgICAgICB0aGlzLmdsdVRlc3NWZXJ0ZXgodiwgdik7CiAgICAgICAgfQogICAgICAgIHRoaXMuZ2x1VGVzc0VuZENvbnRvdXIoKTsKICAgICAgfQogICAgICBmb3IgKGxldCBwb2x5IG9mIGhvbGVzKSB7CiAgICAgICAgdGhpcy5nbHVUZXNzQmVnaW5Db250b3VyKCk7CiAgICAgICAgZm9yIChsZXQgdiBvZiBwb2x5KSB7CiAgICAgICAgICB0aGlzLmdsdVRlc3NWZXJ0ZXgodiwgdik7CiAgICAgICAgfQogICAgICAgIHRoaXMuZ2x1VGVzc0VuZENvbnRvdXIoKTsKICAgICAgfQogICAgICB0aGlzLmdsdVRlc3NFbmRQb2x5Z29uKCk7CiAgICB9CiAgICBydW4ob3B0aW9ucyA9IERFRkFVTFRfT1BUSU9OUykgewogICAgICBsZXQgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfT1BUSU9OUywgb3B0aW9ucyksIHsgcG9seWdvbnMsIGhvbGVzLCBhdXRvV2luZGluZywgYm91bmRhcnlPbmx5IH0gPSBvcHRzOwogICAgICBpZiAoIXBvbHlnb25zIHx8ICFwb2x5Z29ucy5sZW5ndGgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm5lZWQgYXQgbGVhc3QgYSBzaW5nbGUgcG9seWdvbiIpOwogICAgICB9CiAgICAgIGlmIChhdXRvV2luZGluZykgewogICAgICAgIHBvbHlnb25zID0gcG9seWdvbnMuZmlsdGVyKChwKSA9PiB7CiAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoYXJlYShwKSkgPiAwOwogICAgICAgIH0pLm1hcCgocCkgPT4gewogICAgICAgICAgaWYgKGlzX2N3KHApKQogICAgICAgICAgICBwLnJldmVyc2UoKTsKICAgICAgICAgIHJldHVybiBwOwogICAgICAgIH0pOwogICAgICAgIGhvbGVzID0gaG9sZXMuZmlsdGVyKChwKSA9PiB7CiAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoYXJlYShwKSkgPiAwOwogICAgICAgIH0pLm1hcCgocCkgPT4gewogICAgICAgICAgaWYgKGlzX2NjdyhwKSkKICAgICAgICAgICAgcC5yZXZlcnNlKCk7CiAgICAgICAgICByZXR1cm4gcDsKICAgICAgICB9KTsKICAgICAgfQogICAgICBsZXQgW254LCBueSwgbnpdID0gb3B0cy5ub3JtYWwgPyBvcHRzLm5vcm1hbCA6IG5vcm1hbChwb2x5Z29uc1swXSwgdHJ1ZSk7CiAgICAgIHRoaXMuZ2x1VGVzc05vcm1hbChueCwgbnksIG56KTsKICAgICAgdGhpcy5nbHVUZXNzUHJvcGVydHkoaW1wb3J0X2xpYnRlc3MuZ2x1RW51bS5HTFVfVEVTU19CT1VOREFSWV9PTkxZLCBib3VuZGFyeU9ubHkpOwogICAgICB0aGlzLmdsdVRlc3NQcm9wZXJ0eShpbXBvcnRfbGlidGVzcy5nbHVFbnVtLkdMVV9URVNTX1dJTkRJTkdfUlVMRSwgb3B0cy53aW5kaW5nUnVsZSk7CiAgICAgIHRoaXMuc3RhcnQocG9seWdvbnMsIGhvbGVzKTsKICAgICAgcmV0dXJuIHRoaXMuX291dDsKICAgIH0KICAgIF9iZWdpbih0eXBlKSB7CiAgICAgIHRoaXMuX3ByaW1pdGl2ZVR5cGUgPSB0eXBlOwogICAgICB0aGlzLl9jdXJyZW50ID0gW107CiAgICB9CiAgICBfZW5kX2ZhbigpIHsKICAgICAgbGV0IGMgPSB0aGlzLl9jdXJyZW50LnNoaWZ0KCksIHAxID0gdGhpcy5fY3VycmVudC5zaGlmdCgpOwogICAgICB3aGlsZSAodGhpcy5fY3VycmVudC5sZW5ndGgpIHsKICAgICAgICBsZXQgcDIgPSB0aGlzLl9jdXJyZW50LnNoaWZ0KCk7CiAgICAgICAgdGhpcy5fb3V0LnB1c2goYywgcDEsIHAyKTsKICAgICAgICBwMSA9IHAyOwogICAgICB9CiAgICB9CiAgICBfZW5kX3N0cmlwKCkgewogICAgICBsZXQgcDEgPSB0aGlzLl9jdXJyZW50LnNoaWZ0KCksIHAyID0gdGhpcy5fY3VycmVudC5zaGlmdCgpOwogICAgICB3aGlsZSAodGhpcy5fY3VycmVudC5sZW5ndGgpIHsKICAgICAgICBsZXQgcDMgPSB0aGlzLl9jdXJyZW50LnNoaWZ0KCk7CiAgICAgICAgdGhpcy5fb3V0LnB1c2gocDEsIHAyLCBwMyk7CiAgICAgICAgcDEgPSBwMjsKICAgICAgICBwMiA9IHAzOwogICAgICB9CiAgICB9CiAgICBfZW5kKCkgewogICAgICBzd2l0Y2ggKHRoaXMuX3ByaW1pdGl2ZVR5cGUpIHsKICAgICAgICBjYXNlIEdMX1RSSUFOR0xFX0ZBTjoKICAgICAgICAgIHRoaXMuX2VuZF9mYW4oKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgR0xfVFJJQU5HTEVfU1RSSVA6CiAgICAgICAgICB0aGlzLl9lbmRfc3RyaXAoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgR0xfVFJJQU5HTEVTOgogICAgICAgIGNhc2UgR0xfTElORV9MT09QOgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aGlzLl9vdXQucHVzaCh0aGlzLl9jdXJyZW50KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBfdmVydGV4KHYpIHsKICAgICAgdGhpcy5fY3VycmVudC5wdXNoKHYpOwogICAgfQogICAgX2VkZ2UoKSB7CiAgICB9CiAgICBfZXJyb3IoZXJybm8pIHsKICAgICAgY29uc29sZS5lcnJvcigiZXJyb3IgbnVtYmVyOiAiICsgZXJybm8pOwogICAgfQogICAgX2NvbWJpbmUodiwgZGF0YSwgdykgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7ICsraSkgewogICAgICAgIGlmICghZGF0YVtpXSkgewogICAgICAgICAgZGF0YVtpXSA9IG5ldyBBcnJheSh0aGlzLl92c2l6ZSk7CiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuX3ZzaXplOyArK2opIHsKICAgICAgICAgICAgZGF0YVtpXVtqXSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCByID0gbmV3IEFycmF5KHRoaXMuX3ZzaXplKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl92c2l6ZTsgKytpKSB7CiAgICAgICAgcltpXSA9IGRhdGFbMF1baV0gKiB3WzBdICsgZGF0YVsxXVtpXSAqIHdbMV0gKyBkYXRhWzJdW2ldICogd1syXSArIGRhdGFbM11baV0gKiB3WzNdOwogICAgICB9CiAgICAgIHJldHVybiByOwogICAgfQogIH07CiAgZnVuY3Rpb24gdG9fdHJpYW5nbGVzKGRhdGEpIHsKICAgIGxldCByZXN1bHQgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gMykgewogICAgICByZXN1bHQucHVzaChbZGF0YVtpXSwgZGF0YVtpICsgMV0sIGRhdGFbaSArIDJdXSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBmdW5jdGlvbiBydW4ob3B0aW9ucyA9IERFRkFVTFRfT1BUSU9OUykgewogICAgbGV0IHRlc3NlbGF0b3IgPSBuZXcgVGVzc2VsYXRvcihvcHRpb25zLnZlcnRleFNpemUpLCByZXN1bHQgPSB0ZXNzZWxhdG9yLnJ1bihvcHRpb25zKTsKICAgIHJldHVybiBvcHRpb25zLmJvdW5kYXJ5T25seSA/IHJlc3VsdCA6IHJlc3VsdC5tYXAodG9fdHJpYW5nbGVzKTsKICB9CgogIC8vIHNvdXJjZS9jYW52YXMvdmVuZG9ycy9wb2x5Z29uLXRvb2xzL2luZGV4LmpzCiAgdmFyIHBvbHlnb24gPSBwb2x5Z29uX2V4cG9ydHM7CiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiKSB7CiAgICB3aW5kb3cuUG9seWdvblRvb2xzID0gewogICAgICBwb2x5Z29uOiBwb2x5Z29uX2V4cG9ydHMsCiAgICAgIHRlc3NlbGF0b3I6IHRlc3NlbGF0b3JfZXhwb3J0cywKICAgICAgdmVyc2lvbjogd2luZG93LnBvbHlnb25fdG9vbHNfdmVyc2lvbiB8fCAiIiwKICAgICAgYnVpbGQ6IHdpbmRvdy5wb2x5Z29uX3Rvb2xzX3JldiB8fCAiIgogICAgfTsKICB9CgogIC8vIG5vZGVfbW9kdWxlcy90aHJlZS9idWlsZC90aHJlZS5tb2R1bGUuanMKICB2YXIgUkVWSVNJT04gPSAiMTMwIjsKICB2YXIgQ3VsbEZhY2VOb25lID0gMDsKICB2YXIgQ3VsbEZhY2VCYWNrID0gMTsKICB2YXIgQ3VsbEZhY2VGcm9udCA9IDI7CiAgdmFyIFBDRlNoYWRvd01hcCA9IDE7CiAgdmFyIFBDRlNvZnRTaGFkb3dNYXAgPSAyOwogIHZhciBWU01TaGFkb3dNYXAgPSAzOwogIHZhciBGcm9udFNpZGUgPSAwOwogIHZhciBCYWNrU2lkZSA9IDE7CiAgdmFyIERvdWJsZVNpZGUgPSAyOwogIHZhciBGbGF0U2hhZGluZyA9IDE7CiAgdmFyIE5vQmxlbmRpbmcgPSAwOwogIHZhciBOb3JtYWxCbGVuZGluZyA9IDE7CiAgdmFyIEFkZGl0aXZlQmxlbmRpbmcgPSAyOwogIHZhciBTdWJ0cmFjdGl2ZUJsZW5kaW5nID0gMzsKICB2YXIgTXVsdGlwbHlCbGVuZGluZyA9IDQ7CiAgdmFyIEN1c3RvbUJsZW5kaW5nID0gNTsKICB2YXIgQWRkRXF1YXRpb24gPSAxMDA7CiAgdmFyIFN1YnRyYWN0RXF1YXRpb24gPSAxMDE7CiAgdmFyIFJldmVyc2VTdWJ0cmFjdEVxdWF0aW9uID0gMTAyOwogIHZhciBNaW5FcXVhdGlvbiA9IDEwMzsKICB2YXIgTWF4RXF1YXRpb24gPSAxMDQ7CiAgdmFyIFplcm9GYWN0b3IgPSAyMDA7CiAgdmFyIE9uZUZhY3RvciA9IDIwMTsKICB2YXIgU3JjQ29sb3JGYWN0b3IgPSAyMDI7CiAgdmFyIE9uZU1pbnVzU3JjQ29sb3JGYWN0b3IgPSAyMDM7CiAgdmFyIFNyY0FscGhhRmFjdG9yID0gMjA0OwogIHZhciBPbmVNaW51c1NyY0FscGhhRmFjdG9yID0gMjA1OwogIHZhciBEc3RBbHBoYUZhY3RvciA9IDIwNjsKICB2YXIgT25lTWludXNEc3RBbHBoYUZhY3RvciA9IDIwNzsKICB2YXIgRHN0Q29sb3JGYWN0b3IgPSAyMDg7CiAgdmFyIE9uZU1pbnVzRHN0Q29sb3JGYWN0b3IgPSAyMDk7CiAgdmFyIFNyY0FscGhhU2F0dXJhdGVGYWN0b3IgPSAyMTA7CiAgdmFyIE5ldmVyRGVwdGggPSAwOwogIHZhciBBbHdheXNEZXB0aCA9IDE7CiAgdmFyIExlc3NEZXB0aCA9IDI7CiAgdmFyIExlc3NFcXVhbERlcHRoID0gMzsKICB2YXIgRXF1YWxEZXB0aCA9IDQ7CiAgdmFyIEdyZWF0ZXJFcXVhbERlcHRoID0gNTsKICB2YXIgR3JlYXRlckRlcHRoID0gNjsKICB2YXIgTm90RXF1YWxEZXB0aCA9IDc7CiAgdmFyIE11bHRpcGx5T3BlcmF0aW9uID0gMDsKICB2YXIgTWl4T3BlcmF0aW9uID0gMTsKICB2YXIgQWRkT3BlcmF0aW9uID0gMjsKICB2YXIgTm9Ub25lTWFwcGluZyA9IDA7CiAgdmFyIExpbmVhclRvbmVNYXBwaW5nID0gMTsKICB2YXIgUmVpbmhhcmRUb25lTWFwcGluZyA9IDI7CiAgdmFyIENpbmVvblRvbmVNYXBwaW5nID0gMzsKICB2YXIgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nID0gNDsKICB2YXIgQ3VzdG9tVG9uZU1hcHBpbmcgPSA1OwogIHZhciBVVk1hcHBpbmcgPSAzMDA7CiAgdmFyIEN1YmVSZWZsZWN0aW9uTWFwcGluZyA9IDMwMTsKICB2YXIgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nID0gMzAyOwogIHZhciBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyA9IDMwMzsKICB2YXIgRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgPSAzMDQ7CiAgdmFyIEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nID0gMzA2OwogIHZhciBDdWJlVVZSZWZyYWN0aW9uTWFwcGluZyA9IDMwNzsKICB2YXIgUmVwZWF0V3JhcHBpbmcgPSAxZTM7CiAgdmFyIENsYW1wVG9FZGdlV3JhcHBpbmcgPSAxMDAxOwogIHZhciBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nID0gMTAwMjsKICB2YXIgTmVhcmVzdEZpbHRlciA9IDEwMDM7CiAgdmFyIE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyID0gMTAwNDsKICB2YXIgTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciA9IDEwMDU7CiAgdmFyIExpbmVhckZpbHRlciA9IDEwMDY7CiAgdmFyIExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXIgPSAxMDA3OwogIHZhciBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgPSAxMDA4OwogIHZhciBVbnNpZ25lZEJ5dGVUeXBlID0gMTAwOTsKICB2YXIgQnl0ZVR5cGUgPSAxMDEwOwogIHZhciBTaG9ydFR5cGUgPSAxMDExOwogIHZhciBVbnNpZ25lZFNob3J0VHlwZSA9IDEwMTI7CiAgdmFyIEludFR5cGUgPSAxMDEzOwogIHZhciBVbnNpZ25lZEludFR5cGUgPSAxMDE0OwogIHZhciBGbG9hdFR5cGUgPSAxMDE1OwogIHZhciBIYWxmRmxvYXRUeXBlID0gMTAxNjsKICB2YXIgVW5zaWduZWRTaG9ydDQ0NDRUeXBlID0gMTAxNzsKICB2YXIgVW5zaWduZWRTaG9ydDU1NTFUeXBlID0gMTAxODsKICB2YXIgVW5zaWduZWRTaG9ydDU2NVR5cGUgPSAxMDE5OwogIHZhciBVbnNpZ25lZEludDI0OFR5cGUgPSAxMDIwOwogIHZhciBBbHBoYUZvcm1hdCA9IDEwMjE7CiAgdmFyIFJHQkZvcm1hdCA9IDEwMjI7CiAgdmFyIFJHQkFGb3JtYXQgPSAxMDIzOwogIHZhciBMdW1pbmFuY2VGb3JtYXQgPSAxMDI0OwogIHZhciBMdW1pbmFuY2VBbHBoYUZvcm1hdCA9IDEwMjU7CiAgdmFyIERlcHRoRm9ybWF0ID0gMTAyNjsKICB2YXIgRGVwdGhTdGVuY2lsRm9ybWF0ID0gMTAyNzsKICB2YXIgUmVkRm9ybWF0ID0gMTAyODsKICB2YXIgUmVkSW50ZWdlckZvcm1hdCA9IDEwMjk7CiAgdmFyIFJHRm9ybWF0ID0gMTAzMDsKICB2YXIgUkdJbnRlZ2VyRm9ybWF0ID0gMTAzMTsKICB2YXIgUkdCSW50ZWdlckZvcm1hdCA9IDEwMzI7CiAgdmFyIFJHQkFJbnRlZ2VyRm9ybWF0ID0gMTAzMzsKICB2YXIgUkdCX1MzVENfRFhUMV9Gb3JtYXQgPSAzMzc3NjsKICB2YXIgUkdCQV9TM1RDX0RYVDFfRm9ybWF0ID0gMzM3Nzc7CiAgdmFyIFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCA9IDMzNzc4OwogIHZhciBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgPSAzMzc3OTsKICB2YXIgUkdCX1BWUlRDXzRCUFBWMV9Gb3JtYXQgPSAzNTg0MDsKICB2YXIgUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgPSAzNTg0MTsKICB2YXIgUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDI7CiAgdmFyIFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCA9IDM1ODQzOwogIHZhciBSR0JfRVRDMV9Gb3JtYXQgPSAzNjE5NjsKICB2YXIgUkdCX0VUQzJfRm9ybWF0ID0gMzc0OTI7CiAgdmFyIFJHQkFfRVRDMl9FQUNfRm9ybWF0ID0gMzc0OTY7CiAgdmFyIFJHQkFfQVNUQ180eDRfRm9ybWF0ID0gMzc4MDg7CiAgdmFyIFJHQkFfQVNUQ181eDRfRm9ybWF0ID0gMzc4MDk7CiAgdmFyIFJHQkFfQVNUQ181eDVfRm9ybWF0ID0gMzc4MTA7CiAgdmFyIFJHQkFfQVNUQ182eDVfRm9ybWF0ID0gMzc4MTE7CiAgdmFyIFJHQkFfQVNUQ182eDZfRm9ybWF0ID0gMzc4MTI7CiAgdmFyIFJHQkFfQVNUQ184eDVfRm9ybWF0ID0gMzc4MTM7CiAgdmFyIFJHQkFfQVNUQ184eDZfRm9ybWF0ID0gMzc4MTQ7CiAgdmFyIFJHQkFfQVNUQ184eDhfRm9ybWF0ID0gMzc4MTU7CiAgdmFyIFJHQkFfQVNUQ18xMHg1X0Zvcm1hdCA9IDM3ODE2OwogIHZhciBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQgPSAzNzgxNzsKICB2YXIgUkdCQV9BU1RDXzEweDhfRm9ybWF0ID0gMzc4MTg7CiAgdmFyIFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgPSAzNzgxOTsKICB2YXIgUkdCQV9BU1RDXzEyeDEwX0Zvcm1hdCA9IDM3ODIwOwogIHZhciBSR0JBX0FTVENfMTJ4MTJfRm9ybWF0ID0gMzc4MjE7CiAgdmFyIFJHQkFfQlBUQ19Gb3JtYXQgPSAzNjQ5MjsKICB2YXIgU1JHQjhfQUxQSEE4X0FTVENfNHg0X0Zvcm1hdCA9IDM3ODQwOwogIHZhciBTUkdCOF9BTFBIQThfQVNUQ181eDRfRm9ybWF0ID0gMzc4NDE7CiAgdmFyIFNSR0I4X0FMUEhBOF9BU1RDXzV4NV9Gb3JtYXQgPSAzNzg0MjsKICB2YXIgU1JHQjhfQUxQSEE4X0FTVENfNng1X0Zvcm1hdCA9IDM3ODQzOwogIHZhciBTUkdCOF9BTFBIQThfQVNUQ182eDZfRm9ybWF0ID0gMzc4NDQ7CiAgdmFyIFNSR0I4X0FMUEhBOF9BU1RDXzh4NV9Gb3JtYXQgPSAzNzg0NTsKICB2YXIgU1JHQjhfQUxQSEE4X0FTVENfOHg2X0Zvcm1hdCA9IDM3ODQ2OwogIHZhciBTUkdCOF9BTFBIQThfQVNUQ184eDhfRm9ybWF0ID0gMzc4NDc7CiAgdmFyIFNSR0I4X0FMUEhBOF9BU1RDXzEweDVfRm9ybWF0ID0gMzc4NDg7CiAgdmFyIFNSR0I4X0FMUEhBOF9BU1RDXzEweDZfRm9ybWF0ID0gMzc4NDk7CiAgdmFyIFNSR0I4X0FMUEhBOF9BU1RDXzEweDhfRm9ybWF0ID0gMzc4NTA7CiAgdmFyIFNSR0I4X0FMUEhBOF9BU1RDXzEweDEwX0Zvcm1hdCA9IDM3ODUxOwogIHZhciBTUkdCOF9BTFBIQThfQVNUQ18xMngxMF9Gb3JtYXQgPSAzNzg1MjsKICB2YXIgU1JHQjhfQUxQSEE4X0FTVENfMTJ4MTJfRm9ybWF0ID0gMzc4NTM7CiAgdmFyIExvb3BPbmNlID0gMjIwMDsKICB2YXIgTG9vcFJlcGVhdCA9IDIyMDE7CiAgdmFyIExvb3BQaW5nUG9uZyA9IDIyMDI7CiAgdmFyIEludGVycG9sYXRlRGlzY3JldGUgPSAyMzAwOwogIHZhciBJbnRlcnBvbGF0ZUxpbmVhciA9IDIzMDE7CiAgdmFyIEludGVycG9sYXRlU21vb3RoID0gMjMwMjsKICB2YXIgWmVyb0N1cnZhdHVyZUVuZGluZyA9IDI0MDA7CiAgdmFyIFplcm9TbG9wZUVuZGluZyA9IDI0MDE7CiAgdmFyIFdyYXBBcm91bmRFbmRpbmcgPSAyNDAyOwogIHZhciBOb3JtYWxBbmltYXRpb25CbGVuZE1vZGUgPSAyNTAwOwogIHZhciBBZGRpdGl2ZUFuaW1hdGlvbkJsZW5kTW9kZSA9IDI1MDE7CiAgdmFyIFRyaWFuZ2xlc0RyYXdNb2RlID0gMDsKICB2YXIgTGluZWFyRW5jb2RpbmcgPSAzZTM7CiAgdmFyIHNSR0JFbmNvZGluZyA9IDMwMDE7CiAgdmFyIEdhbW1hRW5jb2RpbmcgPSAzMDA3OwogIHZhciBSR0JFRW5jb2RpbmcgPSAzMDAyOwogIHZhciBMb2dMdXZFbmNvZGluZyA9IDMwMDM7CiAgdmFyIFJHQk03RW5jb2RpbmcgPSAzMDA0OwogIHZhciBSR0JNMTZFbmNvZGluZyA9IDMwMDU7CiAgdmFyIFJHQkRFbmNvZGluZyA9IDMwMDY7CiAgdmFyIEJhc2ljRGVwdGhQYWNraW5nID0gMzIwMDsKICB2YXIgUkdCQURlcHRoUGFja2luZyA9IDMyMDE7CiAgdmFyIFRhbmdlbnRTcGFjZU5vcm1hbE1hcCA9IDA7CiAgdmFyIE9iamVjdFNwYWNlTm9ybWFsTWFwID0gMTsKICB2YXIgS2VlcFN0ZW5jaWxPcCA9IDc2ODA7CiAgdmFyIEFsd2F5c1N0ZW5jaWxGdW5jID0gNTE5OwogIHZhciBTdGF0aWNEcmF3VXNhZ2UgPSAzNTA0NDsKICB2YXIgRHluYW1pY0RyYXdVc2FnZSA9IDM1MDQ4OwogIHZhciBHTFNMMyA9ICIzMDAgZXMiOwogIHZhciBFdmVudERpc3BhdGNoZXIgPSBjbGFzcyB7CiAgICBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHZvaWQgMCkKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICBpZiAobGlzdGVuZXJzW3R5cGVdID09PSB2b2lkIDApIHsKICAgICAgICBsaXN0ZW5lcnNbdHlwZV0gPSBbXTsKICAgICAgfQogICAgICBpZiAobGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpID09PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQogICAgfQogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB2b2lkIDApCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CiAgICAgIHJldHVybiBsaXN0ZW5lcnNbdHlwZV0gIT09IHZvaWQgMCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5kZXhPZihsaXN0ZW5lcikgIT09IC0xOwogICAgfQogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB2b2lkIDApCiAgICAgICAgcmV0dXJuOwogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CiAgICAgIGNvbnN0IGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lcnNbdHlwZV07CiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB2b2lkIDApIHsKICAgICAgICBjb25zdCBpbmRleCA9IGxpc3RlbmVyQXJyYXkuaW5kZXhPZihsaXN0ZW5lcik7CiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgbGlzdGVuZXJBcnJheS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZGlzcGF0Y2hFdmVudChldmVudCkgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB2b2lkIDApCiAgICAgICAgcmV0dXJuOwogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CiAgICAgIGNvbnN0IGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lcnNbZXZlbnQudHlwZV07CiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB2b2lkIDApIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwogICAgICAgIGNvbnN0IGFycmF5ID0gbGlzdGVuZXJBcnJheS5zbGljZSgwKTsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgYXJyYXlbaV0uY2FsbCh0aGlzLCBldmVudCk7CiAgICAgICAgfQogICAgICAgIGV2ZW50LnRhcmdldCA9IG51bGw7CiAgICAgIH0KICAgIH0KICB9OwogIHZhciBfbHV0ID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7IGkrKykgewogICAgX2x1dFtpXSA9IChpIDwgMTYgPyAiMCIgOiAiIikgKyBpLnRvU3RyaW5nKDE2KTsKICB9CiAgdmFyIERFRzJSQUQgPSBNYXRoLlBJIC8gMTgwOwogIHZhciBSQUQyREVHID0gMTgwIC8gTWF0aC5QSTsKICBmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CiAgICBjb25zdCBkMCA9IE1hdGgucmFuZG9tKCkgKiA0Mjk0OTY3Mjk1IHwgMDsKICAgIGNvbnN0IGQxID0gTWF0aC5yYW5kb20oKSAqIDQyOTQ5NjcyOTUgfCAwOwogICAgY29uc3QgZDIgPSBNYXRoLnJhbmRvbSgpICogNDI5NDk2NzI5NSB8IDA7CiAgICBjb25zdCBkMyA9IE1hdGgucmFuZG9tKCkgKiA0Mjk0OTY3Mjk1IHwgMDsKICAgIGNvbnN0IHV1aWQgPSBfbHV0W2QwICYgMjU1XSArIF9sdXRbZDAgPj4gOCAmIDI1NV0gKyBfbHV0W2QwID4+IDE2ICYgMjU1XSArIF9sdXRbZDAgPj4gMjQgJiAyNTVdICsgIi0iICsgX2x1dFtkMSAmIDI1NV0gKyBfbHV0W2QxID4+IDggJiAyNTVdICsgIi0iICsgX2x1dFtkMSA+PiAxNiAmIDE1IHwgNjRdICsgX2x1dFtkMSA+PiAyNCAmIDI1NV0gKyAiLSIgKyBfbHV0W2QyICYgNjMgfCAxMjhdICsgX2x1dFtkMiA+PiA4ICYgMjU1XSArICItIiArIF9sdXRbZDIgPj4gMTYgJiAyNTVdICsgX2x1dFtkMiA+PiAyNCAmIDI1NV0gKyBfbHV0W2QzICYgMjU1XSArIF9sdXRbZDMgPj4gOCAmIDI1NV0gKyBfbHV0W2QzID4+IDE2ICYgMjU1XSArIF9sdXRbZDMgPj4gMjQgJiAyNTVdOwogICAgcmV0dXJuIHV1aWQudG9VcHBlckNhc2UoKTsKICB9CiAgZnVuY3Rpb24gY2xhbXAodmFsdWUsIG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5tYXgobWluLCBNYXRoLm1pbihtYXgsIHZhbHVlKSk7CiAgfQogIGZ1bmN0aW9uIGV1Y2xpZGVhbk1vZHVsbyhuLCBtKSB7CiAgICByZXR1cm4gKG4gJSBtICsgbSkgJSBtOwogIH0KICBmdW5jdGlvbiBsZXJwKHgsIHksIHQpIHsKICAgIHJldHVybiAoMSAtIHQpICogeCArIHQgKiB5OwogIH0KICBmdW5jdGlvbiBpc1Bvd2VyT2ZUd28odmFsdWUpIHsKICAgIHJldHVybiAodmFsdWUgJiB2YWx1ZSAtIDEpID09PSAwICYmIHZhbHVlICE9PSAwOwogIH0KICBmdW5jdGlvbiBmbG9vclBvd2VyT2ZUd28odmFsdWUpIHsKICAgIHJldHVybiBNYXRoLnBvdygyLCBNYXRoLmZsb29yKE1hdGgubG9nKHZhbHVlKSAvIE1hdGguTE4yKSk7CiAgfQogIHZhciBWZWN0b3IyID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoeCA9IDAsIHkgPSAwKSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICB9CiAgICBnZXQgd2lkdGgoKSB7CiAgICAgIHJldHVybiB0aGlzLng7CiAgICB9CiAgICBzZXQgd2lkdGgodmFsdWUpIHsKICAgICAgdGhpcy54ID0gdmFsdWU7CiAgICB9CiAgICBnZXQgaGVpZ2h0KCkgewogICAgICByZXR1cm4gdGhpcy55OwogICAgfQogICAgc2V0IGhlaWdodCh2YWx1ZSkgewogICAgICB0aGlzLnkgPSB2YWx1ZTsKICAgIH0KICAgIHNldCh4LCB5KSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0U2NhbGFyKHNjYWxhcikgewogICAgICB0aGlzLnggPSBzY2FsYXI7CiAgICAgIHRoaXMueSA9IHNjYWxhcjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRYKHgpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRZKHkpIHsKICAgICAgdGhpcy55ID0geTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRDb21wb25lbnQoaW5kZXgsIHZhbHVlKSB7CiAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICB0aGlzLnggPSB2YWx1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHRoaXMueSA9IHZhbHVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAiICsgaW5kZXgpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0Q29tcG9uZW50KGluZGV4KSB7CiAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICByZXR1cm4gdGhpcy54OwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHJldHVybiB0aGlzLnk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAiICsgaW5kZXgpOwogICAgICB9CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCwgdGhpcy55KTsKICAgIH0KICAgIGNvcHkodikgewogICAgICB0aGlzLnggPSB2Lng7CiAgICAgIHRoaXMueSA9IHYueTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBhZGQodiwgdykgewogICAgICBpZiAodyAhPT0gdm9pZCAwKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5WZWN0b3IyOiAuYWRkKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuYWRkVmVjdG9ycyggYSwgYiApIGluc3RlYWQuIik7CiAgICAgICAgcmV0dXJuIHRoaXMuYWRkVmVjdG9ycyh2LCB3KTsKICAgICAgfQogICAgICB0aGlzLnggKz0gdi54OwogICAgICB0aGlzLnkgKz0gdi55OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFkZFNjYWxhcihzKSB7CiAgICAgIHRoaXMueCArPSBzOwogICAgICB0aGlzLnkgKz0gczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBhZGRWZWN0b3JzKGEsIGIpIHsKICAgICAgdGhpcy54ID0gYS54ICsgYi54OwogICAgICB0aGlzLnkgPSBhLnkgKyBiLnk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWRkU2NhbGVkVmVjdG9yKHYsIHMpIHsKICAgICAgdGhpcy54ICs9IHYueCAqIHM7CiAgICAgIHRoaXMueSArPSB2LnkgKiBzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHN1Yih2LCB3KSB7CiAgICAgIGlmICh3ICE9PSB2b2lkIDApIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLlZlY3RvcjI6IC5zdWIoKSBub3cgb25seSBhY2NlcHRzIG9uZSBhcmd1bWVudC4gVXNlIC5zdWJWZWN0b3JzKCBhLCBiICkgaW5zdGVhZC4iKTsKICAgICAgICByZXR1cm4gdGhpcy5zdWJWZWN0b3JzKHYsIHcpOwogICAgICB9CiAgICAgIHRoaXMueCAtPSB2Lng7CiAgICAgIHRoaXMueSAtPSB2Lnk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc3ViU2NhbGFyKHMpIHsKICAgICAgdGhpcy54IC09IHM7CiAgICAgIHRoaXMueSAtPSBzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHN1YlZlY3RvcnMoYSwgYikgewogICAgICB0aGlzLnggPSBhLnggLSBiLng7CiAgICAgIHRoaXMueSA9IGEueSAtIGIueTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtdWx0aXBseSh2KSB7CiAgICAgIHRoaXMueCAqPSB2Lng7CiAgICAgIHRoaXMueSAqPSB2Lnk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbXVsdGlwbHlTY2FsYXIoc2NhbGFyKSB7CiAgICAgIHRoaXMueCAqPSBzY2FsYXI7CiAgICAgIHRoaXMueSAqPSBzY2FsYXI7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZGl2aWRlKHYpIHsKICAgICAgdGhpcy54IC89IHYueDsKICAgICAgdGhpcy55IC89IHYueTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBkaXZpZGVTY2FsYXIoc2NhbGFyKSB7CiAgICAgIHJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKDEgLyBzY2FsYXIpOwogICAgfQogICAgYXBwbHlNYXRyaXgzKG0pIHsKICAgICAgY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueTsKICAgICAgY29uc3QgZSA9IG0uZWxlbWVudHM7CiAgICAgIHRoaXMueCA9IGVbMF0gKiB4ICsgZVszXSAqIHkgKyBlWzZdOwogICAgICB0aGlzLnkgPSBlWzFdICogeCArIGVbNF0gKiB5ICsgZVs3XTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtaW4odikgewogICAgICB0aGlzLnggPSBNYXRoLm1pbih0aGlzLngsIHYueCk7CiAgICAgIHRoaXMueSA9IE1hdGgubWluKHRoaXMueSwgdi55KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtYXgodikgewogICAgICB0aGlzLnggPSBNYXRoLm1heCh0aGlzLngsIHYueCk7CiAgICAgIHRoaXMueSA9IE1hdGgubWF4KHRoaXMueSwgdi55KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbGFtcChtaW4sIG1heCkgewogICAgICB0aGlzLnggPSBNYXRoLm1heChtaW4ueCwgTWF0aC5taW4obWF4LngsIHRoaXMueCkpOwogICAgICB0aGlzLnkgPSBNYXRoLm1heChtaW4ueSwgTWF0aC5taW4obWF4LnksIHRoaXMueSkpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsYW1wU2NhbGFyKG1pblZhbCwgbWF4VmFsKSB7CiAgICAgIHRoaXMueCA9IE1hdGgubWF4KG1pblZhbCwgTWF0aC5taW4obWF4VmFsLCB0aGlzLngpKTsKICAgICAgdGhpcy55ID0gTWF0aC5tYXgobWluVmFsLCBNYXRoLm1pbihtYXhWYWwsIHRoaXMueSkpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsYW1wTGVuZ3RoKG1pbiwgbWF4KSB7CiAgICAgIGNvbnN0IGxlbmd0aDIgPSB0aGlzLmxlbmd0aCgpOwogICAgICByZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIobGVuZ3RoMiB8fCAxKS5tdWx0aXBseVNjYWxhcihNYXRoLm1heChtaW4sIE1hdGgubWluKG1heCwgbGVuZ3RoMikpKTsKICAgIH0KICAgIGZsb29yKCkgewogICAgICB0aGlzLnggPSBNYXRoLmZsb29yKHRoaXMueCk7CiAgICAgIHRoaXMueSA9IE1hdGguZmxvb3IodGhpcy55KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjZWlsKCkgewogICAgICB0aGlzLnggPSBNYXRoLmNlaWwodGhpcy54KTsKICAgICAgdGhpcy55ID0gTWF0aC5jZWlsKHRoaXMueSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcm91bmQoKSB7CiAgICAgIHRoaXMueCA9IE1hdGgucm91bmQodGhpcy54KTsKICAgICAgdGhpcy55ID0gTWF0aC5yb3VuZCh0aGlzLnkpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHJvdW5kVG9aZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnggPCAwID8gTWF0aC5jZWlsKHRoaXMueCkgOiBNYXRoLmZsb29yKHRoaXMueCk7CiAgICAgIHRoaXMueSA9IHRoaXMueSA8IDAgPyBNYXRoLmNlaWwodGhpcy55KSA6IE1hdGguZmxvb3IodGhpcy55KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBuZWdhdGUoKSB7CiAgICAgIHRoaXMueCA9IC10aGlzLng7CiAgICAgIHRoaXMueSA9IC10aGlzLnk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZG90KHYpIHsKICAgICAgcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueTsKICAgIH0KICAgIGNyb3NzKHYpIHsKICAgICAgcmV0dXJuIHRoaXMueCAqIHYueSAtIHRoaXMueSAqIHYueDsKICAgIH0KICAgIGxlbmd0aFNxKCkgewogICAgICByZXR1cm4gdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55OwogICAgfQogICAgbGVuZ3RoKCkgewogICAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSk7CiAgICB9CiAgICBtYW5oYXR0YW5MZW5ndGgoKSB7CiAgICAgIHJldHVybiBNYXRoLmFicyh0aGlzLngpICsgTWF0aC5hYnModGhpcy55KTsKICAgIH0KICAgIG5vcm1hbGl6ZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRoaXMubGVuZ3RoKCkgfHwgMSk7CiAgICB9CiAgICBhbmdsZSgpIHsKICAgICAgY29uc3QgYW5nbGUgPSBNYXRoLmF0YW4yKC10aGlzLnksIC10aGlzLngpICsgTWF0aC5QSTsKICAgICAgcmV0dXJuIGFuZ2xlOwogICAgfQogICAgZGlzdGFuY2VUbyh2KSB7CiAgICAgIHJldHVybiBNYXRoLnNxcnQodGhpcy5kaXN0YW5jZVRvU3F1YXJlZCh2KSk7CiAgICB9CiAgICBkaXN0YW5jZVRvU3F1YXJlZCh2KSB7CiAgICAgIGNvbnN0IGR4ID0gdGhpcy54IC0gdi54LCBkeSA9IHRoaXMueSAtIHYueTsKICAgICAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5OwogICAgfQogICAgbWFuaGF0dGFuRGlzdGFuY2VUbyh2KSB7CiAgICAgIHJldHVybiBNYXRoLmFicyh0aGlzLnggLSB2LngpICsgTWF0aC5hYnModGhpcy55IC0gdi55KTsKICAgIH0KICAgIHNldExlbmd0aChsZW5ndGgyKSB7CiAgICAgIHJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKGxlbmd0aDIpOwogICAgfQogICAgbGVycCh2LCBhbHBoYSkgewogICAgICB0aGlzLnggKz0gKHYueCAtIHRoaXMueCkgKiBhbHBoYTsKICAgICAgdGhpcy55ICs9ICh2LnkgLSB0aGlzLnkpICogYWxwaGE7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbGVycFZlY3RvcnModjEsIHYyLCBhbHBoYSkgewogICAgICB0aGlzLnggPSB2MS54ICsgKHYyLnggLSB2MS54KSAqIGFscGhhOwogICAgICB0aGlzLnkgPSB2MS55ICsgKHYyLnkgLSB2MS55KSAqIGFscGhhOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGVxdWFscyh2KSB7CiAgICAgIHJldHVybiB2LnggPT09IHRoaXMueCAmJiB2LnkgPT09IHRoaXMueTsKICAgIH0KICAgIGZyb21BcnJheShhcnJheSwgb2Zmc2V0ID0gMCkgewogICAgICB0aGlzLnggPSBhcnJheVtvZmZzZXRdOwogICAgICB0aGlzLnkgPSBhcnJheVtvZmZzZXQgKyAxXTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0b0FycmF5KGFycmF5ID0gW10sIG9mZnNldCA9IDApIHsKICAgICAgYXJyYXlbb2Zmc2V0XSA9IHRoaXMueDsKICAgICAgYXJyYXlbb2Zmc2V0ICsgMV0gPSB0aGlzLnk7CiAgICAgIHJldHVybiBhcnJheTsKICAgIH0KICAgIGZyb21CdWZmZXJBdHRyaWJ1dGUoYXR0cmlidXRlLCBpbmRleCwgb2Zmc2V0KSB7CiAgICAgIGlmIChvZmZzZXQgIT09IHZvaWQgMCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yMjogb2Zmc2V0IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSgpLiIpOwogICAgICB9CiAgICAgIHRoaXMueCA9IGF0dHJpYnV0ZS5nZXRYKGluZGV4KTsKICAgICAgdGhpcy55ID0gYXR0cmlidXRlLmdldFkoaW5kZXgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHJvdGF0ZUFyb3VuZChjZW50ZXIsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IGMgPSBNYXRoLmNvcyhhbmdsZSksIHMgPSBNYXRoLnNpbihhbmdsZSk7CiAgICAgIGNvbnN0IHggPSB0aGlzLnggLSBjZW50ZXIueDsKICAgICAgY29uc3QgeSA9IHRoaXMueSAtIGNlbnRlci55OwogICAgICB0aGlzLnggPSB4ICogYyAtIHkgKiBzICsgY2VudGVyLng7CiAgICAgIHRoaXMueSA9IHggKiBzICsgeSAqIGMgKyBjZW50ZXIueTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByYW5kb20oKSB7CiAgICAgIHRoaXMueCA9IE1hdGgucmFuZG9tKCk7CiAgICAgIHRoaXMueSA9IE1hdGgucmFuZG9tKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgVmVjdG9yMi5wcm90b3R5cGUuaXNWZWN0b3IyID0gdHJ1ZTsKICB2YXIgTWF0cml4MyA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmVsZW1lbnRzID0gWwogICAgICAgIDEsCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMSwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICAxCiAgICAgIF07CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLk1hdHJpeDM6IHRoZSBjb25zdHJ1Y3RvciBubyBsb25nZXIgcmVhZHMgYXJndW1lbnRzLiB1c2UgLnNldCgpIGluc3RlYWQuIik7CiAgICAgIH0KICAgIH0KICAgIHNldChuMTEsIG4xMiwgbjEzLCBuMjEsIG4yMiwgbjIzLCBuMzEsIG4zMiwgbjMzKSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGVbMF0gPSBuMTE7CiAgICAgIHRlWzFdID0gbjIxOwogICAgICB0ZVsyXSA9IG4zMTsKICAgICAgdGVbM10gPSBuMTI7CiAgICAgIHRlWzRdID0gbjIyOwogICAgICB0ZVs1XSA9IG4zMjsKICAgICAgdGVbNl0gPSBuMTM7CiAgICAgIHRlWzddID0gbjIzOwogICAgICB0ZVs4XSA9IG4zMzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBpZGVudGl0eSgpIHsKICAgICAgdGhpcy5zZXQoMSwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY29weShtKSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgbWUgPSBtLmVsZW1lbnRzOwogICAgICB0ZVswXSA9IG1lWzBdOwogICAgICB0ZVsxXSA9IG1lWzFdOwogICAgICB0ZVsyXSA9IG1lWzJdOwogICAgICB0ZVszXSA9IG1lWzNdOwogICAgICB0ZVs0XSA9IG1lWzRdOwogICAgICB0ZVs1XSA9IG1lWzVdOwogICAgICB0ZVs2XSA9IG1lWzZdOwogICAgICB0ZVs3XSA9IG1lWzddOwogICAgICB0ZVs4XSA9IG1lWzhdOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGV4dHJhY3RCYXNpcyh4QXhpcywgeUF4aXMsIHpBeGlzKSB7CiAgICAgIHhBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKHRoaXMsIDApOwogICAgICB5QXhpcy5zZXRGcm9tTWF0cml4M0NvbHVtbih0aGlzLCAxKTsKICAgICAgekF4aXMuc2V0RnJvbU1hdHJpeDNDb2x1bW4odGhpcywgMik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0RnJvbU1hdHJpeDQobSkgewogICAgICBjb25zdCBtZSA9IG0uZWxlbWVudHM7CiAgICAgIHRoaXMuc2V0KG1lWzBdLCBtZVs0XSwgbWVbOF0sIG1lWzFdLCBtZVs1XSwgbWVbOV0sIG1lWzJdLCBtZVs2XSwgbWVbMTBdKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtdWx0aXBseShtKSB7CiAgICAgIHJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXModGhpcywgbSk7CiAgICB9CiAgICBwcmVtdWx0aXBseShtKSB7CiAgICAgIHJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMobSwgdGhpcyk7CiAgICB9CiAgICBtdWx0aXBseU1hdHJpY2VzKGEsIGIpIHsKICAgICAgY29uc3QgYWUgPSBhLmVsZW1lbnRzOwogICAgICBjb25zdCBiZSA9IGIuZWxlbWVudHM7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gYWVbMF0sIGExMiA9IGFlWzNdLCBhMTMgPSBhZVs2XTsKICAgICAgY29uc3QgYTIxID0gYWVbMV0sIGEyMiA9IGFlWzRdLCBhMjMgPSBhZVs3XTsKICAgICAgY29uc3QgYTMxID0gYWVbMl0sIGEzMiA9IGFlWzVdLCBhMzMgPSBhZVs4XTsKICAgICAgY29uc3QgYjExID0gYmVbMF0sIGIxMiA9IGJlWzNdLCBiMTMgPSBiZVs2XTsKICAgICAgY29uc3QgYjIxID0gYmVbMV0sIGIyMiA9IGJlWzRdLCBiMjMgPSBiZVs3XTsKICAgICAgY29uc3QgYjMxID0gYmVbMl0sIGIzMiA9IGJlWzVdLCBiMzMgPSBiZVs4XTsKICAgICAgdGVbMF0gPSBhMTEgKiBiMTEgKyBhMTIgKiBiMjEgKyBhMTMgKiBiMzE7CiAgICAgIHRlWzNdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyOwogICAgICB0ZVs2XSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgdGVbMV0gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzE7CiAgICAgIHRlWzRdID0gYTIxICogYjEyICsgYTIyICogYjIyICsgYTIzICogYjMyOwogICAgICB0ZVs3XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgdGVbMl0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CiAgICAgIHRlWzVdID0gYTMxICogYjEyICsgYTMyICogYjIyICsgYTMzICogYjMyOwogICAgICB0ZVs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtdWx0aXBseVNjYWxhcihzKSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGVbMF0gKj0gczsKICAgICAgdGVbM10gKj0gczsKICAgICAgdGVbNl0gKj0gczsKICAgICAgdGVbMV0gKj0gczsKICAgICAgdGVbNF0gKj0gczsKICAgICAgdGVbN10gKj0gczsKICAgICAgdGVbMl0gKj0gczsKICAgICAgdGVbNV0gKj0gczsKICAgICAgdGVbOF0gKj0gczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBkZXRlcm1pbmFudCgpIHsKICAgICAgY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCBhID0gdGVbMF0sIGIgPSB0ZVsxXSwgYyA9IHRlWzJdLCBkID0gdGVbM10sIGUgPSB0ZVs0XSwgZiA9IHRlWzVdLCBnID0gdGVbNl0sIGggPSB0ZVs3XSwgaSA9IHRlWzhdOwogICAgICByZXR1cm4gYSAqIGUgKiBpIC0gYSAqIGYgKiBoIC0gYiAqIGQgKiBpICsgYiAqIGYgKiBnICsgYyAqIGQgKiBoIC0gYyAqIGUgKiBnOwogICAgfQogICAgaW52ZXJ0KCkgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHMsIG4xMSA9IHRlWzBdLCBuMjEgPSB0ZVsxXSwgbjMxID0gdGVbMl0sIG4xMiA9IHRlWzNdLCBuMjIgPSB0ZVs0XSwgbjMyID0gdGVbNV0sIG4xMyA9IHRlWzZdLCBuMjMgPSB0ZVs3XSwgbjMzID0gdGVbOF0sIHQxMSA9IG4zMyAqIG4yMiAtIG4zMiAqIG4yMywgdDEyID0gbjMyICogbjEzIC0gbjMzICogbjEyLCB0MTMgPSBuMjMgKiBuMTIgLSBuMjIgKiBuMTMsIGRldCA9IG4xMSAqIHQxMSArIG4yMSAqIHQxMiArIG4zMSAqIHQxMzsKICAgICAgaWYgKGRldCA9PT0gMCkKICAgICAgICByZXR1cm4gdGhpcy5zZXQoMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCk7CiAgICAgIGNvbnN0IGRldEludiA9IDEgLyBkZXQ7CiAgICAgIHRlWzBdID0gdDExICogZGV0SW52OwogICAgICB0ZVsxXSA9IChuMzEgKiBuMjMgLSBuMzMgKiBuMjEpICogZGV0SW52OwogICAgICB0ZVsyXSA9IChuMzIgKiBuMjEgLSBuMzEgKiBuMjIpICogZGV0SW52OwogICAgICB0ZVszXSA9IHQxMiAqIGRldEludjsKICAgICAgdGVbNF0gPSAobjMzICogbjExIC0gbjMxICogbjEzKSAqIGRldEludjsKICAgICAgdGVbNV0gPSAobjMxICogbjEyIC0gbjMyICogbjExKSAqIGRldEludjsKICAgICAgdGVbNl0gPSB0MTMgKiBkZXRJbnY7CiAgICAgIHRlWzddID0gKG4yMSAqIG4xMyAtIG4yMyAqIG4xMSkgKiBkZXRJbnY7CiAgICAgIHRlWzhdID0gKG4yMiAqIG4xMSAtIG4yMSAqIG4xMikgKiBkZXRJbnY7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdHJhbnNwb3NlKCkgewogICAgICBsZXQgdG1wMjsKICAgICAgY29uc3QgbSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIHRtcDIgPSBtWzFdOwogICAgICBtWzFdID0gbVszXTsKICAgICAgbVszXSA9IHRtcDI7CiAgICAgIHRtcDIgPSBtWzJdOwogICAgICBtWzJdID0gbVs2XTsKICAgICAgbVs2XSA9IHRtcDI7CiAgICAgIHRtcDIgPSBtWzVdOwogICAgICBtWzVdID0gbVs3XTsKICAgICAgbVs3XSA9IHRtcDI7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0Tm9ybWFsTWF0cml4KG1hdHJpeDQpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0RnJvbU1hdHJpeDQobWF0cml4NCkuaW52ZXJ0KCkudHJhbnNwb3NlKCk7CiAgICB9CiAgICB0cmFuc3Bvc2VJbnRvQXJyYXkocikgewogICAgICBjb25zdCBtID0gdGhpcy5lbGVtZW50czsKICAgICAgclswXSA9IG1bMF07CiAgICAgIHJbMV0gPSBtWzNdOwogICAgICByWzJdID0gbVs2XTsKICAgICAgclszXSA9IG1bMV07CiAgICAgIHJbNF0gPSBtWzRdOwogICAgICByWzVdID0gbVs3XTsKICAgICAgcls2XSA9IG1bMl07CiAgICAgIHJbN10gPSBtWzVdOwogICAgICByWzhdID0gbVs4XTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRVdlRyYW5zZm9ybSh0eCwgdHksIHN4LCBzeSwgcm90YXRpb24sIGN4LCBjeSkgewogICAgICBjb25zdCBjID0gTWF0aC5jb3Mocm90YXRpb24pOwogICAgICBjb25zdCBzID0gTWF0aC5zaW4ocm90YXRpb24pOwogICAgICB0aGlzLnNldChzeCAqIGMsIHN4ICogcywgLXN4ICogKGMgKiBjeCArIHMgKiBjeSkgKyBjeCArIHR4LCAtc3kgKiBzLCBzeSAqIGMsIC1zeSAqICgtcyAqIGN4ICsgYyAqIGN5KSArIGN5ICsgdHksIDAsIDAsIDEpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNjYWxlKHN4LCBzeSkgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIHRlWzBdICo9IHN4OwogICAgICB0ZVszXSAqPSBzeDsKICAgICAgdGVbNl0gKj0gc3g7CiAgICAgIHRlWzFdICo9IHN5OwogICAgICB0ZVs0XSAqPSBzeTsKICAgICAgdGVbN10gKj0gc3k7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcm90YXRlKHRoZXRhKSB7CiAgICAgIGNvbnN0IGMgPSBNYXRoLmNvcyh0aGV0YSk7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbih0aGV0YSk7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gdGVbMF0sIGExMiA9IHRlWzNdLCBhMTMgPSB0ZVs2XTsKICAgICAgY29uc3QgYTIxID0gdGVbMV0sIGEyMiA9IHRlWzRdLCBhMjMgPSB0ZVs3XTsKICAgICAgdGVbMF0gPSBjICogYTExICsgcyAqIGEyMTsKICAgICAgdGVbM10gPSBjICogYTEyICsgcyAqIGEyMjsKICAgICAgdGVbNl0gPSBjICogYTEzICsgcyAqIGEyMzsKICAgICAgdGVbMV0gPSAtcyAqIGExMSArIGMgKiBhMjE7CiAgICAgIHRlWzRdID0gLXMgKiBhMTIgKyBjICogYTIyOwogICAgICB0ZVs3XSA9IC1zICogYTEzICsgYyAqIGEyMzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0cmFuc2xhdGUodHgsIHR5KSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGVbMF0gKz0gdHggKiB0ZVsyXTsKICAgICAgdGVbM10gKz0gdHggKiB0ZVs1XTsKICAgICAgdGVbNl0gKz0gdHggKiB0ZVs4XTsKICAgICAgdGVbMV0gKz0gdHkgKiB0ZVsyXTsKICAgICAgdGVbNF0gKz0gdHkgKiB0ZVs1XTsKICAgICAgdGVbN10gKz0gdHkgKiB0ZVs4XTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBlcXVhbHMobWF0cml4KSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgbWUgPSBtYXRyaXguZWxlbWVudHM7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgOTsgaSsrKSB7CiAgICAgICAgaWYgKHRlW2ldICE9PSBtZVtpXSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZyb21BcnJheShhcnJheSwgb2Zmc2V0ID0gMCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDk7IGkrKykgewogICAgICAgIHRoaXMuZWxlbWVudHNbaV0gPSBhcnJheVtpICsgb2Zmc2V0XTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvQXJyYXkoYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCkgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGFycmF5W29mZnNldF0gPSB0ZVswXTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgMV0gPSB0ZVsxXTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgMl0gPSB0ZVsyXTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgM10gPSB0ZVszXTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgNF0gPSB0ZVs0XTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgNV0gPSB0ZVs1XTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgNl0gPSB0ZVs2XTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgN10gPSB0ZVs3XTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgOF0gPSB0ZVs4XTsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmZyb21BcnJheSh0aGlzLmVsZW1lbnRzKTsKICAgIH0KICB9OwogIE1hdHJpeDMucHJvdG90eXBlLmlzTWF0cml4MyA9IHRydWU7CiAgdmFyIF9jYW52YXM7CiAgdmFyIEltYWdlVXRpbHMgPSBjbGFzcyB7CiAgICBzdGF0aWMgZ2V0RGF0YVVSTChpbWFnZSkgewogICAgICBpZiAoL15kYXRhOi9pLnRlc3QoaW1hZ2Uuc3JjKSkgewogICAgICAgIHJldHVybiBpbWFnZS5zcmM7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCA9PSAidW5kZWZpbmVkIikgewogICAgICAgIHJldHVybiBpbWFnZS5zcmM7CiAgICAgIH0KICAgICAgbGV0IGNhbnZhczsKICAgICAgaWYgKGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpIHsKICAgICAgICBjYW52YXMgPSBpbWFnZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoX2NhbnZhcyA9PT0gdm9pZCAwKQogICAgICAgICAgX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIsICJjYW52YXMiKTsKICAgICAgICBfY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAgICAgX2NhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CiAgICAgICAgY29uc3QgY29udGV4dCA9IF9jYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICBpZiAoaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZURhdGEpIHsKICAgICAgICAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlLCAwLCAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICBjYW52YXMgPSBfY2FudmFzOwogICAgICB9CiAgICAgIGlmIChjYW52YXMud2lkdGggPiAyMDQ4IHx8IGNhbnZhcy5oZWlnaHQgPiAyMDQ4KSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5JbWFnZVV0aWxzLmdldERhdGFVUkw6IEltYWdlIGNvbnZlcnRlZCB0byBqcGcgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMiLCBpbWFnZSk7CiAgICAgICAgcmV0dXJuIGNhbnZhcy50b0RhdGFVUkwoImltYWdlL2pwZWciLCAwLjYpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBjYW52YXMudG9EYXRhVVJMKCJpbWFnZS9wbmciKTsKICAgICAgfQogICAgfQogIH07CiAgdmFyIHRleHR1cmVJZCA9IDA7CiAgdmFyIFRleHR1cmUgPSBjbGFzcyBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CiAgICBjb25zdHJ1Y3RvcihpbWFnZSA9IFRleHR1cmUuREVGQVVMVF9JTUFHRSwgbWFwcGluZyA9IFRleHR1cmUuREVGQVVMVF9NQVBQSU5HLCB3cmFwUyA9IENsYW1wVG9FZGdlV3JhcHBpbmcsIHdyYXBUID0gQ2xhbXBUb0VkZ2VXcmFwcGluZywgbWFnRmlsdGVyID0gTGluZWFyRmlsdGVyLCBtaW5GaWx0ZXIgPSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIsIGZvcm1hdCA9IFJHQkFGb3JtYXQsIHR5cGUgPSBVbnNpZ25lZEJ5dGVUeXBlLCBhbmlzb3Ryb3B5ID0gMSwgZW5jb2RpbmcgPSBMaW5lYXJFbmNvZGluZykgewogICAgICBzdXBlcigpOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgImlkIiwgeyB2YWx1ZTogdGV4dHVyZUlkKysgfSk7CiAgICAgIHRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwogICAgICB0aGlzLm5hbWUgPSAiIjsKICAgICAgdGhpcy5pbWFnZSA9IGltYWdlOwogICAgICB0aGlzLm1pcG1hcHMgPSBbXTsKICAgICAgdGhpcy5tYXBwaW5nID0gbWFwcGluZzsKICAgICAgdGhpcy53cmFwUyA9IHdyYXBTOwogICAgICB0aGlzLndyYXBUID0gd3JhcFQ7CiAgICAgIHRoaXMubWFnRmlsdGVyID0gbWFnRmlsdGVyOwogICAgICB0aGlzLm1pbkZpbHRlciA9IG1pbkZpbHRlcjsKICAgICAgdGhpcy5hbmlzb3Ryb3B5ID0gYW5pc290cm9weTsKICAgICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CiAgICAgIHRoaXMuaW50ZXJuYWxGb3JtYXQgPSBudWxsOwogICAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgICB0aGlzLm9mZnNldCA9IG5ldyBWZWN0b3IyKDAsIDApOwogICAgICB0aGlzLnJlcGVhdCA9IG5ldyBWZWN0b3IyKDEsIDEpOwogICAgICB0aGlzLmNlbnRlciA9IG5ldyBWZWN0b3IyKDAsIDApOwogICAgICB0aGlzLnJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4MygpOwogICAgICB0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IHRydWU7CiAgICAgIHRoaXMucHJlbXVsdGlwbHlBbHBoYSA9IGZhbHNlOwogICAgICB0aGlzLmZsaXBZID0gdHJ1ZTsKICAgICAgdGhpcy51bnBhY2tBbGlnbm1lbnQgPSA0OwogICAgICB0aGlzLmVuY29kaW5nID0gZW5jb2Rpbmc7CiAgICAgIHRoaXMudmVyc2lvbiA9IDA7CiAgICAgIHRoaXMub25VcGRhdGUgPSBudWxsOwogICAgfQogICAgdXBkYXRlTWF0cml4KCkgewogICAgICB0aGlzLm1hdHJpeC5zZXRVdlRyYW5zZm9ybSh0aGlzLm9mZnNldC54LCB0aGlzLm9mZnNldC55LCB0aGlzLnJlcGVhdC54LCB0aGlzLnJlcGVhdC55LCB0aGlzLnJvdGF0aW9uLCB0aGlzLmNlbnRlci54LCB0aGlzLmNlbnRlci55KTsKICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CiAgICAgIHRoaXMuaW1hZ2UgPSBzb3VyY2UuaW1hZ2U7CiAgICAgIHRoaXMubWlwbWFwcyA9IHNvdXJjZS5taXBtYXBzLnNsaWNlKDApOwogICAgICB0aGlzLm1hcHBpbmcgPSBzb3VyY2UubWFwcGluZzsKICAgICAgdGhpcy53cmFwUyA9IHNvdXJjZS53cmFwUzsKICAgICAgdGhpcy53cmFwVCA9IHNvdXJjZS53cmFwVDsKICAgICAgdGhpcy5tYWdGaWx0ZXIgPSBzb3VyY2UubWFnRmlsdGVyOwogICAgICB0aGlzLm1pbkZpbHRlciA9IHNvdXJjZS5taW5GaWx0ZXI7CiAgICAgIHRoaXMuYW5pc290cm9weSA9IHNvdXJjZS5hbmlzb3Ryb3B5OwogICAgICB0aGlzLmZvcm1hdCA9IHNvdXJjZS5mb3JtYXQ7CiAgICAgIHRoaXMuaW50ZXJuYWxGb3JtYXQgPSBzb3VyY2UuaW50ZXJuYWxGb3JtYXQ7CiAgICAgIHRoaXMudHlwZSA9IHNvdXJjZS50eXBlOwogICAgICB0aGlzLm9mZnNldC5jb3B5KHNvdXJjZS5vZmZzZXQpOwogICAgICB0aGlzLnJlcGVhdC5jb3B5KHNvdXJjZS5yZXBlYXQpOwogICAgICB0aGlzLmNlbnRlci5jb3B5KHNvdXJjZS5jZW50ZXIpOwogICAgICB0aGlzLnJvdGF0aW9uID0gc291cmNlLnJvdGF0aW9uOwogICAgICB0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKICAgICAgdGhpcy5tYXRyaXguY29weShzb3VyY2UubWF0cml4KTsKICAgICAgdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBzb3VyY2UuZ2VuZXJhdGVNaXBtYXBzOwogICAgICB0aGlzLnByZW11bHRpcGx5QWxwaGEgPSBzb3VyY2UucHJlbXVsdGlwbHlBbHBoYTsKICAgICAgdGhpcy5mbGlwWSA9IHNvdXJjZS5mbGlwWTsKICAgICAgdGhpcy51bnBhY2tBbGlnbm1lbnQgPSBzb3VyY2UudW5wYWNrQWxpZ25tZW50OwogICAgICB0aGlzLmVuY29kaW5nID0gc291cmNlLmVuY29kaW5nOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvSlNPTihtZXRhKSB7CiAgICAgIGNvbnN0IGlzUm9vdE9iamVjdCA9IG1ldGEgPT09IHZvaWQgMCB8fCB0eXBlb2YgbWV0YSA9PT0gInN0cmluZyI7CiAgICAgIGlmICghaXNSb290T2JqZWN0ICYmIG1ldGEudGV4dHVyZXNbdGhpcy51dWlkXSAhPT0gdm9pZCAwKSB7CiAgICAgICAgcmV0dXJuIG1ldGEudGV4dHVyZXNbdGhpcy51dWlkXTsKICAgICAgfQogICAgICBjb25zdCBvdXRwdXQgPSB7CiAgICAgICAgbWV0YWRhdGE6IHsKICAgICAgICAgIHZlcnNpb246IDQuNSwKICAgICAgICAgIHR5cGU6ICJUZXh0dXJlIiwKICAgICAgICAgIGdlbmVyYXRvcjogIlRleHR1cmUudG9KU09OIgogICAgICAgIH0sCiAgICAgICAgdXVpZDogdGhpcy51dWlkLAogICAgICAgIG5hbWU6IHRoaXMubmFtZSwKICAgICAgICBtYXBwaW5nOiB0aGlzLm1hcHBpbmcsCiAgICAgICAgcmVwZWF0OiBbdGhpcy5yZXBlYXQueCwgdGhpcy5yZXBlYXQueV0sCiAgICAgICAgb2Zmc2V0OiBbdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueV0sCiAgICAgICAgY2VudGVyOiBbdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueV0sCiAgICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24sCiAgICAgICAgd3JhcDogW3RoaXMud3JhcFMsIHRoaXMud3JhcFRdLAogICAgICAgIGZvcm1hdDogdGhpcy5mb3JtYXQsCiAgICAgICAgdHlwZTogdGhpcy50eXBlLAogICAgICAgIGVuY29kaW5nOiB0aGlzLmVuY29kaW5nLAogICAgICAgIG1pbkZpbHRlcjogdGhpcy5taW5GaWx0ZXIsCiAgICAgICAgbWFnRmlsdGVyOiB0aGlzLm1hZ0ZpbHRlciwKICAgICAgICBhbmlzb3Ryb3B5OiB0aGlzLmFuaXNvdHJvcHksCiAgICAgICAgZmxpcFk6IHRoaXMuZmxpcFksCiAgICAgICAgcHJlbXVsdGlwbHlBbHBoYTogdGhpcy5wcmVtdWx0aXBseUFscGhhLAogICAgICAgIHVucGFja0FsaWdubWVudDogdGhpcy51bnBhY2tBbGlnbm1lbnQKICAgICAgfTsKICAgICAgaWYgKHRoaXMuaW1hZ2UgIT09IHZvaWQgMCkgewogICAgICAgIGNvbnN0IGltYWdlID0gdGhpcy5pbWFnZTsKICAgICAgICBpZiAoaW1hZ2UudXVpZCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBpbWFnZS51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CiAgICAgICAgfQogICAgICAgIGlmICghaXNSb290T2JqZWN0ICYmIG1ldGEuaW1hZ2VzW2ltYWdlLnV1aWRdID09PSB2b2lkIDApIHsKICAgICAgICAgIGxldCB1cmw7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShpbWFnZSkpIHsKICAgICAgICAgICAgdXJsID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gaW1hZ2UubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKGltYWdlW2ldLmlzRGF0YVRleHR1cmUpIHsKICAgICAgICAgICAgICAgIHVybC5wdXNoKHNlcmlhbGl6ZUltYWdlKGltYWdlW2ldLmltYWdlKSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVybC5wdXNoKHNlcmlhbGl6ZUltYWdlKGltYWdlW2ldKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1cmwgPSBzZXJpYWxpemVJbWFnZShpbWFnZSk7CiAgICAgICAgICB9CiAgICAgICAgICBtZXRhLmltYWdlc1tpbWFnZS51dWlkXSA9IHsKICAgICAgICAgICAgdXVpZDogaW1hZ2UudXVpZCwKICAgICAgICAgICAgdXJsCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBvdXRwdXQuaW1hZ2UgPSBpbWFnZS51dWlkOwogICAgICB9CiAgICAgIGlmICghaXNSb290T2JqZWN0KSB7CiAgICAgICAgbWV0YS50ZXh0dXJlc1t0aGlzLnV1aWRdID0gb3V0cHV0OwogICAgICB9CiAgICAgIHJldHVybiBvdXRwdXQ7CiAgICB9CiAgICBkaXNwb3NlKCkgewogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoeyB0eXBlOiAiZGlzcG9zZSIgfSk7CiAgICB9CiAgICB0cmFuc2Zvcm1Vdih1dikgewogICAgICBpZiAodGhpcy5tYXBwaW5nICE9PSBVVk1hcHBpbmcpCiAgICAgICAgcmV0dXJuIHV2OwogICAgICB1di5hcHBseU1hdHJpeDModGhpcy5tYXRyaXgpOwogICAgICBpZiAodXYueCA8IDAgfHwgdXYueCA+IDEpIHsKICAgICAgICBzd2l0Y2ggKHRoaXMud3JhcFMpIHsKICAgICAgICAgIGNhc2UgUmVwZWF0V3JhcHBpbmc6CiAgICAgICAgICAgIHV2LnggPSB1di54IC0gTWF0aC5mbG9vcih1di54KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIENsYW1wVG9FZGdlV3JhcHBpbmc6CiAgICAgICAgICAgIHV2LnggPSB1di54IDwgMCA/IDAgOiAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgTWlycm9yZWRSZXBlYXRXcmFwcGluZzoKICAgICAgICAgICAgaWYgKE1hdGguYWJzKE1hdGguZmxvb3IodXYueCkgJSAyKSA9PT0gMSkgewogICAgICAgICAgICAgIHV2LnggPSBNYXRoLmNlaWwodXYueCkgLSB1di54OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHV2LnggPSB1di54IC0gTWF0aC5mbG9vcih1di54KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHV2LnkgPCAwIHx8IHV2LnkgPiAxKSB7CiAgICAgICAgc3dpdGNoICh0aGlzLndyYXBUKSB7CiAgICAgICAgICBjYXNlIFJlcGVhdFdyYXBwaW5nOgogICAgICAgICAgICB1di55ID0gdXYueSAtIE1hdGguZmxvb3IodXYueSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBDbGFtcFRvRWRnZVdyYXBwaW5nOgogICAgICAgICAgICB1di55ID0gdXYueSA8IDAgPyAwIDogMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE1pcnJvcmVkUmVwZWF0V3JhcHBpbmc6CiAgICAgICAgICAgIGlmIChNYXRoLmFicyhNYXRoLmZsb29yKHV2LnkpICUgMikgPT09IDEpIHsKICAgICAgICAgICAgICB1di55ID0gTWF0aC5jZWlsKHV2LnkpIC0gdXYueTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB1di55ID0gdXYueSAtIE1hdGguZmxvb3IodXYueSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLmZsaXBZKSB7CiAgICAgICAgdXYueSA9IDEgLSB1di55OwogICAgICB9CiAgICAgIHJldHVybiB1djsKICAgIH0KICAgIHNldCBuZWVkc1VwZGF0ZSh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHRydWUpCiAgICAgICAgdGhpcy52ZXJzaW9uKys7CiAgICB9CiAgfTsKICBUZXh0dXJlLkRFRkFVTFRfSU1BR0UgPSB2b2lkIDA7CiAgVGV4dHVyZS5ERUZBVUxUX01BUFBJTkcgPSBVVk1hcHBpbmc7CiAgVGV4dHVyZS5wcm90b3R5cGUuaXNUZXh0dXJlID0gdHJ1ZTsKICBmdW5jdGlvbiBzZXJpYWxpemVJbWFnZShpbWFnZSkgewogICAgaWYgKHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAidW5kZWZpbmVkIiAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgfHwgdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ICE9PSAidW5kZWZpbmVkIiAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50IHx8IHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gInVuZGVmaW5lZCIgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCkgewogICAgICByZXR1cm4gSW1hZ2VVdGlscy5nZXREYXRhVVJMKGltYWdlKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChpbWFnZS5kYXRhKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGRhdGE6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGltYWdlLmRhdGEpLAogICAgICAgICAgd2lkdGg6IGltYWdlLndpZHRoLAogICAgICAgICAgaGVpZ2h0OiBpbWFnZS5oZWlnaHQsCiAgICAgICAgICB0eXBlOiBpbWFnZS5kYXRhLmNvbnN0cnVjdG9yLm5hbWUKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuVGV4dHVyZTogVW5hYmxlIHRvIHNlcmlhbGl6ZSBUZXh0dXJlLiIpOwogICAgICAgIHJldHVybiB7fTsKICAgICAgfQogICAgfQogIH0KICB2YXIgVmVjdG9yNCA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKHggPSAwLCB5ID0gMCwgeiA9IDAsIHcgPSAxKSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICBnZXQgd2lkdGgoKSB7CiAgICAgIHJldHVybiB0aGlzLno7CiAgICB9CiAgICBzZXQgd2lkdGgodmFsdWUpIHsKICAgICAgdGhpcy56ID0gdmFsdWU7CiAgICB9CiAgICBnZXQgaGVpZ2h0KCkgewogICAgICByZXR1cm4gdGhpcy53OwogICAgfQogICAgc2V0IGhlaWdodCh2YWx1ZSkgewogICAgICB0aGlzLncgPSB2YWx1ZTsKICAgIH0KICAgIHNldCh4LCB5LCB6LCB3KSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0U2NhbGFyKHNjYWxhcikgewogICAgICB0aGlzLnggPSBzY2FsYXI7CiAgICAgIHRoaXMueSA9IHNjYWxhcjsKICAgICAgdGhpcy56ID0gc2NhbGFyOwogICAgICB0aGlzLncgPSBzY2FsYXI7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0WCh4KSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0WSh5KSB7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0Wih6KSB7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0Vyh3KSB7CiAgICAgIHRoaXMudyA9IHc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0Q29tcG9uZW50KGluZGV4LCB2YWx1ZSkgewogICAgICBzd2l0Y2ggKGluZGV4KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgdGhpcy54ID0gdmFsdWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICB0aGlzLnkgPSB2YWx1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHRoaXMueiA9IHZhbHVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgdGhpcy53ID0gdmFsdWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIgKyBpbmRleCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXRDb21wb25lbnQoaW5kZXgpIHsKICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJldHVybiB0aGlzLng7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIHRoaXMueTsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gdGhpcy56OwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHJldHVybiB0aGlzLnc7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAiICsgaW5kZXgpOwogICAgICB9CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMudyk7CiAgICB9CiAgICBjb3B5KHYpIHsKICAgICAgdGhpcy54ID0gdi54OwogICAgICB0aGlzLnkgPSB2Lnk7CiAgICAgIHRoaXMueiA9IHYuejsKICAgICAgdGhpcy53ID0gdi53ICE9PSB2b2lkIDAgPyB2LncgOiAxOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFkZCh2LCB3KSB7CiAgICAgIGlmICh3ICE9PSB2b2lkIDApIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLlZlY3RvcjQ6IC5hZGQoKSBub3cgb25seSBhY2NlcHRzIG9uZSBhcmd1bWVudC4gVXNlIC5hZGRWZWN0b3JzKCBhLCBiICkgaW5zdGVhZC4iKTsKICAgICAgICByZXR1cm4gdGhpcy5hZGRWZWN0b3JzKHYsIHcpOwogICAgICB9CiAgICAgIHRoaXMueCArPSB2Lng7CiAgICAgIHRoaXMueSArPSB2Lnk7CiAgICAgIHRoaXMueiArPSB2Lno7CiAgICAgIHRoaXMudyArPSB2Lnc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWRkU2NhbGFyKHMpIHsKICAgICAgdGhpcy54ICs9IHM7CiAgICAgIHRoaXMueSArPSBzOwogICAgICB0aGlzLnogKz0gczsKICAgICAgdGhpcy53ICs9IHM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWRkVmVjdG9ycyhhLCBiKSB7CiAgICAgIHRoaXMueCA9IGEueCArIGIueDsKICAgICAgdGhpcy55ID0gYS55ICsgYi55OwogICAgICB0aGlzLnogPSBhLnogKyBiLno7CiAgICAgIHRoaXMudyA9IGEudyArIGIudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBhZGRTY2FsZWRWZWN0b3IodiwgcykgewogICAgICB0aGlzLnggKz0gdi54ICogczsKICAgICAgdGhpcy55ICs9IHYueSAqIHM7CiAgICAgIHRoaXMueiArPSB2LnogKiBzOwogICAgICB0aGlzLncgKz0gdi53ICogczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzdWIodiwgdykgewogICAgICBpZiAodyAhPT0gdm9pZCAwKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5WZWN0b3I0OiAuc3ViKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuc3ViVmVjdG9ycyggYSwgYiApIGluc3RlYWQuIik7CiAgICAgICAgcmV0dXJuIHRoaXMuc3ViVmVjdG9ycyh2LCB3KTsKICAgICAgfQogICAgICB0aGlzLnggLT0gdi54OwogICAgICB0aGlzLnkgLT0gdi55OwogICAgICB0aGlzLnogLT0gdi56OwogICAgICB0aGlzLncgLT0gdi53OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHN1YlNjYWxhcihzKSB7CiAgICAgIHRoaXMueCAtPSBzOwogICAgICB0aGlzLnkgLT0gczsKICAgICAgdGhpcy56IC09IHM7CiAgICAgIHRoaXMudyAtPSBzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHN1YlZlY3RvcnMoYSwgYikgewogICAgICB0aGlzLnggPSBhLnggLSBiLng7CiAgICAgIHRoaXMueSA9IGEueSAtIGIueTsKICAgICAgdGhpcy56ID0gYS56IC0gYi56OwogICAgICB0aGlzLncgPSBhLncgLSBiLnc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbXVsdGlwbHkodikgewogICAgICB0aGlzLnggKj0gdi54OwogICAgICB0aGlzLnkgKj0gdi55OwogICAgICB0aGlzLnogKj0gdi56OwogICAgICB0aGlzLncgKj0gdi53OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG11bHRpcGx5U2NhbGFyKHNjYWxhcikgewogICAgICB0aGlzLnggKj0gc2NhbGFyOwogICAgICB0aGlzLnkgKj0gc2NhbGFyOwogICAgICB0aGlzLnogKj0gc2NhbGFyOwogICAgICB0aGlzLncgKj0gc2NhbGFyOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFwcGx5TWF0cml4NChtKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLnosIHcgPSB0aGlzLnc7CiAgICAgIGNvbnN0IGUgPSBtLmVsZW1lbnRzOwogICAgICB0aGlzLnggPSBlWzBdICogeCArIGVbNF0gKiB5ICsgZVs4XSAqIHogKyBlWzEyXSAqIHc7CiAgICAgIHRoaXMueSA9IGVbMV0gKiB4ICsgZVs1XSAqIHkgKyBlWzldICogeiArIGVbMTNdICogdzsKICAgICAgdGhpcy56ID0gZVsyXSAqIHggKyBlWzZdICogeSArIGVbMTBdICogeiArIGVbMTRdICogdzsKICAgICAgdGhpcy53ID0gZVszXSAqIHggKyBlWzddICogeSArIGVbMTFdICogeiArIGVbMTVdICogdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBkaXZpZGVTY2FsYXIoc2NhbGFyKSB7CiAgICAgIHJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKDEgLyBzY2FsYXIpOwogICAgfQogICAgc2V0QXhpc0FuZ2xlRnJvbVF1YXRlcm5pb24ocSkgewogICAgICB0aGlzLncgPSAyICogTWF0aC5hY29zKHEudyk7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNxcnQoMSAtIHEudyAqIHEudyk7CiAgICAgIGlmIChzIDwgMWUtNCkgewogICAgICAgIHRoaXMueCA9IDE7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMueCA9IHEueCAvIHM7CiAgICAgICAgdGhpcy55ID0gcS55IC8gczsKICAgICAgICB0aGlzLnogPSBxLnogLyBzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0QXhpc0FuZ2xlRnJvbVJvdGF0aW9uTWF0cml4KG0pIHsKICAgICAgbGV0IGFuZ2xlLCB4LCB5LCB6OwogICAgICBjb25zdCBlcHNpbG9uID0gMC4wMSwgZXBzaWxvbjIgPSAwLjEsIHRlID0gbS5lbGVtZW50cywgbTExID0gdGVbMF0sIG0xMiA9IHRlWzRdLCBtMTMgPSB0ZVs4XSwgbTIxID0gdGVbMV0sIG0yMiA9IHRlWzVdLCBtMjMgPSB0ZVs5XSwgbTMxID0gdGVbMl0sIG0zMiA9IHRlWzZdLCBtMzMgPSB0ZVsxMF07CiAgICAgIGlmIChNYXRoLmFicyhtMTIgLSBtMjEpIDwgZXBzaWxvbiAmJiBNYXRoLmFicyhtMTMgLSBtMzEpIDwgZXBzaWxvbiAmJiBNYXRoLmFicyhtMjMgLSBtMzIpIDwgZXBzaWxvbikgewogICAgICAgIGlmIChNYXRoLmFicyhtMTIgKyBtMjEpIDwgZXBzaWxvbjIgJiYgTWF0aC5hYnMobTEzICsgbTMxKSA8IGVwc2lsb24yICYmIE1hdGguYWJzKG0yMyArIG0zMikgPCBlcHNpbG9uMiAmJiBNYXRoLmFicyhtMTEgKyBtMjIgKyBtMzMgLSAzKSA8IGVwc2lsb24yKSB7CiAgICAgICAgICB0aGlzLnNldCgxLCAwLCAwLCAwKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBhbmdsZSA9IE1hdGguUEk7CiAgICAgICAgY29uc3QgeHggPSAobTExICsgMSkgLyAyOwogICAgICAgIGNvbnN0IHl5ID0gKG0yMiArIDEpIC8gMjsKICAgICAgICBjb25zdCB6eiA9IChtMzMgKyAxKSAvIDI7CiAgICAgICAgY29uc3QgeHkgPSAobTEyICsgbTIxKSAvIDQ7CiAgICAgICAgY29uc3QgeHogPSAobTEzICsgbTMxKSAvIDQ7CiAgICAgICAgY29uc3QgeXogPSAobTIzICsgbTMyKSAvIDQ7CiAgICAgICAgaWYgKHh4ID4geXkgJiYgeHggPiB6eikgewogICAgICAgICAgaWYgKHh4IDwgZXBzaWxvbikgewogICAgICAgICAgICB4ID0gMDsKICAgICAgICAgICAgeSA9IDAuNzA3MTA2NzgxOwogICAgICAgICAgICB6ID0gMC43MDcxMDY3ODE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB4ID0gTWF0aC5zcXJ0KHh4KTsKICAgICAgICAgICAgeSA9IHh5IC8geDsKICAgICAgICAgICAgeiA9IHh6IC8geDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHl5ID4genopIHsKICAgICAgICAgIGlmICh5eSA8IGVwc2lsb24pIHsKICAgICAgICAgICAgeCA9IDAuNzA3MTA2NzgxOwogICAgICAgICAgICB5ID0gMDsKICAgICAgICAgICAgeiA9IDAuNzA3MTA2NzgxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeSA9IE1hdGguc3FydCh5eSk7CiAgICAgICAgICAgIHggPSB4eSAvIHk7CiAgICAgICAgICAgIHogPSB5eiAvIHk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh6eiA8IGVwc2lsb24pIHsKICAgICAgICAgICAgeCA9IDAuNzA3MTA2NzgxOwogICAgICAgICAgICB5ID0gMC43MDcxMDY3ODE7CiAgICAgICAgICAgIHogPSAwOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeiA9IE1hdGguc3FydCh6eik7CiAgICAgICAgICAgIHggPSB4eiAvIHo7CiAgICAgICAgICAgIHkgPSB5eiAvIHo7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuc2V0KHgsIHksIHosIGFuZ2xlKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBsZXQgcyA9IE1hdGguc3FydCgobTMyIC0gbTIzKSAqIChtMzIgLSBtMjMpICsgKG0xMyAtIG0zMSkgKiAobTEzIC0gbTMxKSArIChtMjEgLSBtMTIpICogKG0yMSAtIG0xMikpOwogICAgICBpZiAoTWF0aC5hYnMocykgPCAxZS0zKQogICAgICAgIHMgPSAxOwogICAgICB0aGlzLnggPSAobTMyIC0gbTIzKSAvIHM7CiAgICAgIHRoaXMueSA9IChtMTMgLSBtMzEpIC8gczsKICAgICAgdGhpcy56ID0gKG0yMSAtIG0xMikgLyBzOwogICAgICB0aGlzLncgPSBNYXRoLmFjb3MoKG0xMSArIG0yMiArIG0zMyAtIDEpIC8gMik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbWluKHYpIHsKICAgICAgdGhpcy54ID0gTWF0aC5taW4odGhpcy54LCB2LngpOwogICAgICB0aGlzLnkgPSBNYXRoLm1pbih0aGlzLnksIHYueSk7CiAgICAgIHRoaXMueiA9IE1hdGgubWluKHRoaXMueiwgdi56KTsKICAgICAgdGhpcy53ID0gTWF0aC5taW4odGhpcy53LCB2LncpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG1heCh2KSB7CiAgICAgIHRoaXMueCA9IE1hdGgubWF4KHRoaXMueCwgdi54KTsKICAgICAgdGhpcy55ID0gTWF0aC5tYXgodGhpcy55LCB2LnkpOwogICAgICB0aGlzLnogPSBNYXRoLm1heCh0aGlzLnosIHYueik7CiAgICAgIHRoaXMudyA9IE1hdGgubWF4KHRoaXMudywgdi53KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbGFtcChtaW4sIG1heCkgewogICAgICB0aGlzLnggPSBNYXRoLm1heChtaW4ueCwgTWF0aC5taW4obWF4LngsIHRoaXMueCkpOwogICAgICB0aGlzLnkgPSBNYXRoLm1heChtaW4ueSwgTWF0aC5taW4obWF4LnksIHRoaXMueSkpOwogICAgICB0aGlzLnogPSBNYXRoLm1heChtaW4ueiwgTWF0aC5taW4obWF4LnosIHRoaXMueikpOwogICAgICB0aGlzLncgPSBNYXRoLm1heChtaW4udywgTWF0aC5taW4obWF4LncsIHRoaXMudykpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsYW1wU2NhbGFyKG1pblZhbCwgbWF4VmFsKSB7CiAgICAgIHRoaXMueCA9IE1hdGgubWF4KG1pblZhbCwgTWF0aC5taW4obWF4VmFsLCB0aGlzLngpKTsKICAgICAgdGhpcy55ID0gTWF0aC5tYXgobWluVmFsLCBNYXRoLm1pbihtYXhWYWwsIHRoaXMueSkpOwogICAgICB0aGlzLnogPSBNYXRoLm1heChtaW5WYWwsIE1hdGgubWluKG1heFZhbCwgdGhpcy56KSk7CiAgICAgIHRoaXMudyA9IE1hdGgubWF4KG1pblZhbCwgTWF0aC5taW4obWF4VmFsLCB0aGlzLncpKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbGFtcExlbmd0aChtaW4sIG1heCkgewogICAgICBjb25zdCBsZW5ndGgyID0gdGhpcy5sZW5ndGgoKTsKICAgICAgcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKGxlbmd0aDIgfHwgMSkubXVsdGlwbHlTY2FsYXIoTWF0aC5tYXgobWluLCBNYXRoLm1pbihtYXgsIGxlbmd0aDIpKSk7CiAgICB9CiAgICBmbG9vcigpIHsKICAgICAgdGhpcy54ID0gTWF0aC5mbG9vcih0aGlzLngpOwogICAgICB0aGlzLnkgPSBNYXRoLmZsb29yKHRoaXMueSk7CiAgICAgIHRoaXMueiA9IE1hdGguZmxvb3IodGhpcy56KTsKICAgICAgdGhpcy53ID0gTWF0aC5mbG9vcih0aGlzLncpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNlaWwoKSB7CiAgICAgIHRoaXMueCA9IE1hdGguY2VpbCh0aGlzLngpOwogICAgICB0aGlzLnkgPSBNYXRoLmNlaWwodGhpcy55KTsKICAgICAgdGhpcy56ID0gTWF0aC5jZWlsKHRoaXMueik7CiAgICAgIHRoaXMudyA9IE1hdGguY2VpbCh0aGlzLncpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHJvdW5kKCkgewogICAgICB0aGlzLnggPSBNYXRoLnJvdW5kKHRoaXMueCk7CiAgICAgIHRoaXMueSA9IE1hdGgucm91bmQodGhpcy55KTsKICAgICAgdGhpcy56ID0gTWF0aC5yb3VuZCh0aGlzLnopOwogICAgICB0aGlzLncgPSBNYXRoLnJvdW5kKHRoaXMudyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcm91bmRUb1plcm8oKSB7CiAgICAgIHRoaXMueCA9IHRoaXMueCA8IDAgPyBNYXRoLmNlaWwodGhpcy54KSA6IE1hdGguZmxvb3IodGhpcy54KTsKICAgICAgdGhpcy55ID0gdGhpcy55IDwgMCA/IE1hdGguY2VpbCh0aGlzLnkpIDogTWF0aC5mbG9vcih0aGlzLnkpOwogICAgICB0aGlzLnogPSB0aGlzLnogPCAwID8gTWF0aC5jZWlsKHRoaXMueikgOiBNYXRoLmZsb29yKHRoaXMueik7CiAgICAgIHRoaXMudyA9IHRoaXMudyA8IDAgPyBNYXRoLmNlaWwodGhpcy53KSA6IE1hdGguZmxvb3IodGhpcy53KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBuZWdhdGUoKSB7CiAgICAgIHRoaXMueCA9IC10aGlzLng7CiAgICAgIHRoaXMueSA9IC10aGlzLnk7CiAgICAgIHRoaXMueiA9IC10aGlzLno7CiAgICAgIHRoaXMudyA9IC10aGlzLnc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZG90KHYpIHsKICAgICAgcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYueiArIHRoaXMudyAqIHYudzsKICAgIH0KICAgIGxlbmd0aFNxKCkgewogICAgICByZXR1cm4gdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53OwogICAgfQogICAgbGVuZ3RoKCkgewogICAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyk7CiAgICB9CiAgICBtYW5oYXR0YW5MZW5ndGgoKSB7CiAgICAgIHJldHVybiBNYXRoLmFicyh0aGlzLngpICsgTWF0aC5hYnModGhpcy55KSArIE1hdGguYWJzKHRoaXMueikgKyBNYXRoLmFicyh0aGlzLncpOwogICAgfQogICAgbm9ybWFsaXplKCkgewogICAgICByZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIodGhpcy5sZW5ndGgoKSB8fCAxKTsKICAgIH0KICAgIHNldExlbmd0aChsZW5ndGgyKSB7CiAgICAgIHJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKGxlbmd0aDIpOwogICAgfQogICAgbGVycCh2LCBhbHBoYSkgewogICAgICB0aGlzLnggKz0gKHYueCAtIHRoaXMueCkgKiBhbHBoYTsKICAgICAgdGhpcy55ICs9ICh2LnkgLSB0aGlzLnkpICogYWxwaGE7CiAgICAgIHRoaXMueiArPSAodi56IC0gdGhpcy56KSAqIGFscGhhOwogICAgICB0aGlzLncgKz0gKHYudyAtIHRoaXMudykgKiBhbHBoYTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBsZXJwVmVjdG9ycyh2MSwgdjIsIGFscGhhKSB7CiAgICAgIHRoaXMueCA9IHYxLnggKyAodjIueCAtIHYxLngpICogYWxwaGE7CiAgICAgIHRoaXMueSA9IHYxLnkgKyAodjIueSAtIHYxLnkpICogYWxwaGE7CiAgICAgIHRoaXMueiA9IHYxLnogKyAodjIueiAtIHYxLnopICogYWxwaGE7CiAgICAgIHRoaXMudyA9IHYxLncgKyAodjIudyAtIHYxLncpICogYWxwaGE7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZXF1YWxzKHYpIHsKICAgICAgcmV0dXJuIHYueCA9PT0gdGhpcy54ICYmIHYueSA9PT0gdGhpcy55ICYmIHYueiA9PT0gdGhpcy56ICYmIHYudyA9PT0gdGhpcy53OwogICAgfQogICAgZnJvbUFycmF5KGFycmF5LCBvZmZzZXQgPSAwKSB7CiAgICAgIHRoaXMueCA9IGFycmF5W29mZnNldF07CiAgICAgIHRoaXMueSA9IGFycmF5W29mZnNldCArIDFdOwogICAgICB0aGlzLnogPSBhcnJheVtvZmZzZXQgKyAyXTsKICAgICAgdGhpcy53ID0gYXJyYXlbb2Zmc2V0ICsgM107CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9BcnJheShhcnJheSA9IFtdLCBvZmZzZXQgPSAwKSB7CiAgICAgIGFycmF5W29mZnNldF0gPSB0aGlzLng7CiAgICAgIGFycmF5W29mZnNldCArIDFdID0gdGhpcy55OwogICAgICBhcnJheVtvZmZzZXQgKyAyXSA9IHRoaXMuejsKICAgICAgYXJyYXlbb2Zmc2V0ICsgM10gPSB0aGlzLnc7CiAgICAgIHJldHVybiBhcnJheTsKICAgIH0KICAgIGZyb21CdWZmZXJBdHRyaWJ1dGUoYXR0cmlidXRlLCBpbmRleCwgb2Zmc2V0KSB7CiAgICAgIGlmIChvZmZzZXQgIT09IHZvaWQgMCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yNDogb2Zmc2V0IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSgpLiIpOwogICAgICB9CiAgICAgIHRoaXMueCA9IGF0dHJpYnV0ZS5nZXRYKGluZGV4KTsKICAgICAgdGhpcy55ID0gYXR0cmlidXRlLmdldFkoaW5kZXgpOwogICAgICB0aGlzLnogPSBhdHRyaWJ1dGUuZ2V0WihpbmRleCk7CiAgICAgIHRoaXMudyA9IGF0dHJpYnV0ZS5nZXRXKGluZGV4KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByYW5kb20oKSB7CiAgICAgIHRoaXMueCA9IE1hdGgucmFuZG9tKCk7CiAgICAgIHRoaXMueSA9IE1hdGgucmFuZG9tKCk7CiAgICAgIHRoaXMueiA9IE1hdGgucmFuZG9tKCk7CiAgICAgIHRoaXMudyA9IE1hdGgucmFuZG9tKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgVmVjdG9yNC5wcm90b3R5cGUuaXNWZWN0b3I0ID0gdHJ1ZTsKICB2YXIgV2ViR0xSZW5kZXJUYXJnZXQgPSBjbGFzcyBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CiAgICBjb25zdHJ1Y3Rvcih3aWR0aCwgaGVpZ2h0LCBvcHRpb25zID0ge30pIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICAgICAgdGhpcy5kZXB0aCA9IDE7CiAgICAgIHRoaXMuc2Npc3NvciA9IG5ldyBWZWN0b3I0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICB0aGlzLnNjaXNzb3JUZXN0ID0gZmFsc2U7CiAgICAgIHRoaXMudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgdGhpcy50ZXh0dXJlID0gbmV3IFRleHR1cmUodm9pZCAwLCBvcHRpb25zLm1hcHBpbmcsIG9wdGlvbnMud3JhcFMsIG9wdGlvbnMud3JhcFQsIG9wdGlvbnMubWFnRmlsdGVyLCBvcHRpb25zLm1pbkZpbHRlciwgb3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMudHlwZSwgb3B0aW9ucy5hbmlzb3Ryb3B5LCBvcHRpb25zLmVuY29kaW5nKTsKICAgICAgdGhpcy50ZXh0dXJlLmltYWdlID0geyB3aWR0aCwgaGVpZ2h0LCBkZXB0aDogMSB9OwogICAgICB0aGlzLnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gb3B0aW9ucy5nZW5lcmF0ZU1pcG1hcHMgIT09IHZvaWQgMCA/IG9wdGlvbnMuZ2VuZXJhdGVNaXBtYXBzIDogZmFsc2U7CiAgICAgIHRoaXMudGV4dHVyZS5taW5GaWx0ZXIgPSBvcHRpb25zLm1pbkZpbHRlciAhPT0gdm9pZCAwID8gb3B0aW9ucy5taW5GaWx0ZXIgOiBMaW5lYXJGaWx0ZXI7CiAgICAgIHRoaXMuZGVwdGhCdWZmZXIgPSBvcHRpb25zLmRlcHRoQnVmZmVyICE9PSB2b2lkIDAgPyBvcHRpb25zLmRlcHRoQnVmZmVyIDogdHJ1ZTsKICAgICAgdGhpcy5zdGVuY2lsQnVmZmVyID0gb3B0aW9ucy5zdGVuY2lsQnVmZmVyICE9PSB2b2lkIDAgPyBvcHRpb25zLnN0ZW5jaWxCdWZmZXIgOiBmYWxzZTsKICAgICAgdGhpcy5kZXB0aFRleHR1cmUgPSBvcHRpb25zLmRlcHRoVGV4dHVyZSAhPT0gdm9pZCAwID8gb3B0aW9ucy5kZXB0aFRleHR1cmUgOiBudWxsOwogICAgfQogICAgc2V0VGV4dHVyZSh0ZXh0dXJlKSB7CiAgICAgIHRleHR1cmUuaW1hZ2UgPSB7CiAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsCiAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCwKICAgICAgICBkZXB0aDogdGhpcy5kZXB0aAogICAgICB9OwogICAgICB0aGlzLnRleHR1cmUgPSB0ZXh0dXJlOwogICAgfQogICAgc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0LCBkZXB0aCA9IDEpIHsKICAgICAgaWYgKHRoaXMud2lkdGggIT09IHdpZHRoIHx8IHRoaXMuaGVpZ2h0ICE9PSBoZWlnaHQgfHwgdGhpcy5kZXB0aCAhPT0gZGVwdGgpIHsKICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgdGhpcy5kZXB0aCA9IGRlcHRoOwogICAgICAgIHRoaXMudGV4dHVyZS5pbWFnZS53aWR0aCA9IHdpZHRoOwogICAgICAgIHRoaXMudGV4dHVyZS5pbWFnZS5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgdGhpcy50ZXh0dXJlLmltYWdlLmRlcHRoID0gZGVwdGg7CiAgICAgICAgdGhpcy5kaXNwb3NlKCk7CiAgICAgIH0KICAgICAgdGhpcy52aWV3cG9ydC5zZXQoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIHRoaXMuc2Npc3Nvci5zZXQoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHRoaXMud2lkdGggPSBzb3VyY2Uud2lkdGg7CiAgICAgIHRoaXMuaGVpZ2h0ID0gc291cmNlLmhlaWdodDsKICAgICAgdGhpcy5kZXB0aCA9IHNvdXJjZS5kZXB0aDsKICAgICAgdGhpcy52aWV3cG9ydC5jb3B5KHNvdXJjZS52aWV3cG9ydCk7CiAgICAgIHRoaXMudGV4dHVyZSA9IHNvdXJjZS50ZXh0dXJlLmNsb25lKCk7CiAgICAgIHRoaXMudGV4dHVyZS5pbWFnZSA9IHsgLi4udGhpcy50ZXh0dXJlLmltYWdlIH07CiAgICAgIHRoaXMuZGVwdGhCdWZmZXIgPSBzb3VyY2UuZGVwdGhCdWZmZXI7CiAgICAgIHRoaXMuc3RlbmNpbEJ1ZmZlciA9IHNvdXJjZS5zdGVuY2lsQnVmZmVyOwogICAgICB0aGlzLmRlcHRoVGV4dHVyZSA9IHNvdXJjZS5kZXB0aFRleHR1cmU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZGlzcG9zZSgpIHsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHsgdHlwZTogImRpc3Bvc2UiIH0pOwogICAgfQogIH07CiAgV2ViR0xSZW5kZXJUYXJnZXQucHJvdG90eXBlLmlzV2ViR0xSZW5kZXJUYXJnZXQgPSB0cnVlOwogIHZhciBXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cyA9IGNsYXNzIGV4dGVuZHMgV2ViR0xSZW5kZXJUYXJnZXQgewogICAgY29uc3RydWN0b3Iod2lkdGgsIGhlaWdodCwgY291bnQpIHsKICAgICAgc3VwZXIod2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnN0IHRleHR1cmUgPSB0aGlzLnRleHR1cmU7CiAgICAgIHRoaXMudGV4dHVyZSA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICB0aGlzLnRleHR1cmVbaV0gPSB0ZXh0dXJlLmNsb25lKCk7CiAgICAgIH0KICAgIH0KICAgIHNldFNpemUod2lkdGgsIGhlaWdodCwgZGVwdGggPSAxKSB7CiAgICAgIGlmICh0aGlzLndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLmhlaWdodCAhPT0gaGVpZ2h0IHx8IHRoaXMuZGVwdGggIT09IGRlcHRoKSB7CiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgIHRoaXMuZGVwdGggPSBkZXB0aDsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSB0aGlzLnRleHR1cmUubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgdGhpcy50ZXh0dXJlW2ldLmltYWdlLndpZHRoID0gd2lkdGg7CiAgICAgICAgICB0aGlzLnRleHR1cmVbaV0uaW1hZ2UuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgdGhpcy50ZXh0dXJlW2ldLmltYWdlLmRlcHRoID0gZGVwdGg7CiAgICAgICAgfQogICAgICAgIHRoaXMuZGlzcG9zZSgpOwogICAgICB9CiAgICAgIHRoaXMudmlld3BvcnQuc2V0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICB0aGlzLnNjaXNzb3Iuc2V0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHRoaXMuZGlzcG9zZSgpOwogICAgICB0aGlzLndpZHRoID0gc291cmNlLndpZHRoOwogICAgICB0aGlzLmhlaWdodCA9IHNvdXJjZS5oZWlnaHQ7CiAgICAgIHRoaXMuZGVwdGggPSBzb3VyY2UuZGVwdGg7CiAgICAgIHRoaXMudmlld3BvcnQuc2V0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsKICAgICAgdGhpcy5zY2lzc29yLnNldCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7CiAgICAgIHRoaXMuZGVwdGhCdWZmZXIgPSBzb3VyY2UuZGVwdGhCdWZmZXI7CiAgICAgIHRoaXMuc3RlbmNpbEJ1ZmZlciA9IHNvdXJjZS5zdGVuY2lsQnVmZmVyOwogICAgICB0aGlzLmRlcHRoVGV4dHVyZSA9IHNvdXJjZS5kZXB0aFRleHR1cmU7CiAgICAgIHRoaXMudGV4dHVyZS5sZW5ndGggPSAwOwogICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBzb3VyY2UudGV4dHVyZS5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgdGhpcy50ZXh0dXJlW2ldID0gc291cmNlLnRleHR1cmVbaV0uY2xvbmUoKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIFdlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzLnByb3RvdHlwZS5pc1dlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzID0gdHJ1ZTsKICB2YXIgV2ViR0xNdWx0aXNhbXBsZVJlbmRlclRhcmdldCA9IGNsYXNzIGV4dGVuZHMgV2ViR0xSZW5kZXJUYXJnZXQgewogICAgY29uc3RydWN0b3Iod2lkdGgsIGhlaWdodCwgb3B0aW9ucykgewogICAgICBzdXBlcih3aWR0aCwgaGVpZ2h0LCBvcHRpb25zKTsKICAgICAgdGhpcy5zYW1wbGVzID0gNDsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkuY2FsbCh0aGlzLCBzb3VyY2UpOwogICAgICB0aGlzLnNhbXBsZXMgPSBzb3VyY2Uuc2FtcGxlczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBXZWJHTE11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0LnByb3RvdHlwZS5pc1dlYkdMTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQgPSB0cnVlOwogIHZhciBRdWF0ZXJuaW9uID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoeCA9IDAsIHkgPSAwLCB6ID0gMCwgdyA9IDEpIHsKICAgICAgdGhpcy5feCA9IHg7CiAgICAgIHRoaXMuX3kgPSB5OwogICAgICB0aGlzLl96ID0gejsKICAgICAgdGhpcy5fdyA9IHc7CiAgICB9CiAgICBzdGF0aWMgc2xlcnAocWEsIHFiLCBxbSwgdCkgewogICAgICBjb25zb2xlLndhcm4oIlRIUkVFLlF1YXRlcm5pb246IFN0YXRpYyAuc2xlcnAoKSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgcW0uc2xlcnBRdWF0ZXJuaW9ucyggcWEsIHFiLCB0ICkgaW5zdGVhZC4iKTsKICAgICAgcmV0dXJuIHFtLnNsZXJwUXVhdGVybmlvbnMocWEsIHFiLCB0KTsKICAgIH0KICAgIHN0YXRpYyBzbGVycEZsYXQoZHN0LCBkc3RPZmZzZXQsIHNyYzAsIHNyY09mZnNldDAsIHNyYzEsIHNyY09mZnNldDEsIHQpIHsKICAgICAgbGV0IHgwID0gc3JjMFtzcmNPZmZzZXQwICsgMF0sIHkwID0gc3JjMFtzcmNPZmZzZXQwICsgMV0sIHowID0gc3JjMFtzcmNPZmZzZXQwICsgMl0sIHcwID0gc3JjMFtzcmNPZmZzZXQwICsgM107CiAgICAgIGNvbnN0IHgxID0gc3JjMVtzcmNPZmZzZXQxICsgMF0sIHkxID0gc3JjMVtzcmNPZmZzZXQxICsgMV0sIHoxID0gc3JjMVtzcmNPZmZzZXQxICsgMl0sIHcxID0gc3JjMVtzcmNPZmZzZXQxICsgM107CiAgICAgIGlmICh0ID09PSAwKSB7CiAgICAgICAgZHN0W2RzdE9mZnNldCArIDBdID0geDA7CiAgICAgICAgZHN0W2RzdE9mZnNldCArIDFdID0geTA7CiAgICAgICAgZHN0W2RzdE9mZnNldCArIDJdID0gejA7CiAgICAgICAgZHN0W2RzdE9mZnNldCArIDNdID0gdzA7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0ID09PSAxKSB7CiAgICAgICAgZHN0W2RzdE9mZnNldCArIDBdID0geDE7CiAgICAgICAgZHN0W2RzdE9mZnNldCArIDFdID0geTE7CiAgICAgICAgZHN0W2RzdE9mZnNldCArIDJdID0gejE7CiAgICAgICAgZHN0W2RzdE9mZnNldCArIDNdID0gdzE7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh3MCAhPT0gdzEgfHwgeDAgIT09IHgxIHx8IHkwICE9PSB5MSB8fCB6MCAhPT0gejEpIHsKICAgICAgICBsZXQgcyA9IDEgLSB0OwogICAgICAgIGNvbnN0IGNvcyA9IHgwICogeDEgKyB5MCAqIHkxICsgejAgKiB6MSArIHcwICogdzEsIGRpciA9IGNvcyA+PSAwID8gMSA6IC0xLCBzcXJTaW4gPSAxIC0gY29zICogY29zOwogICAgICAgIGlmIChzcXJTaW4gPiBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgY29uc3Qgc2luID0gTWF0aC5zcXJ0KHNxclNpbiksIGxlbiA9IE1hdGguYXRhbjIoc2luLCBjb3MgKiBkaXIpOwogICAgICAgICAgcyA9IE1hdGguc2luKHMgKiBsZW4pIC8gc2luOwogICAgICAgICAgdCA9IE1hdGguc2luKHQgKiBsZW4pIC8gc2luOwogICAgICAgIH0KICAgICAgICBjb25zdCB0RGlyID0gdCAqIGRpcjsKICAgICAgICB4MCA9IHgwICogcyArIHgxICogdERpcjsKICAgICAgICB5MCA9IHkwICogcyArIHkxICogdERpcjsKICAgICAgICB6MCA9IHowICogcyArIHoxICogdERpcjsKICAgICAgICB3MCA9IHcwICogcyArIHcxICogdERpcjsKICAgICAgICBpZiAocyA9PT0gMSAtIHQpIHsKICAgICAgICAgIGNvbnN0IGYgPSAxIC8gTWF0aC5zcXJ0KHgwICogeDAgKyB5MCAqIHkwICsgejAgKiB6MCArIHcwICogdzApOwogICAgICAgICAgeDAgKj0gZjsKICAgICAgICAgIHkwICo9IGY7CiAgICAgICAgICB6MCAqPSBmOwogICAgICAgICAgdzAgKj0gZjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZHN0W2RzdE9mZnNldF0gPSB4MDsKICAgICAgZHN0W2RzdE9mZnNldCArIDFdID0geTA7CiAgICAgIGRzdFtkc3RPZmZzZXQgKyAyXSA9IHowOwogICAgICBkc3RbZHN0T2Zmc2V0ICsgM10gPSB3MDsKICAgIH0KICAgIHN0YXRpYyBtdWx0aXBseVF1YXRlcm5pb25zRmxhdChkc3QsIGRzdE9mZnNldCwgc3JjMCwgc3JjT2Zmc2V0MCwgc3JjMSwgc3JjT2Zmc2V0MSkgewogICAgICBjb25zdCB4MCA9IHNyYzBbc3JjT2Zmc2V0MF07CiAgICAgIGNvbnN0IHkwID0gc3JjMFtzcmNPZmZzZXQwICsgMV07CiAgICAgIGNvbnN0IHowID0gc3JjMFtzcmNPZmZzZXQwICsgMl07CiAgICAgIGNvbnN0IHcwID0gc3JjMFtzcmNPZmZzZXQwICsgM107CiAgICAgIGNvbnN0IHgxID0gc3JjMVtzcmNPZmZzZXQxXTsKICAgICAgY29uc3QgeTEgPSBzcmMxW3NyY09mZnNldDEgKyAxXTsKICAgICAgY29uc3QgejEgPSBzcmMxW3NyY09mZnNldDEgKyAyXTsKICAgICAgY29uc3QgdzEgPSBzcmMxW3NyY09mZnNldDEgKyAzXTsKICAgICAgZHN0W2RzdE9mZnNldF0gPSB4MCAqIHcxICsgdzAgKiB4MSArIHkwICogejEgLSB6MCAqIHkxOwogICAgICBkc3RbZHN0T2Zmc2V0ICsgMV0gPSB5MCAqIHcxICsgdzAgKiB5MSArIHowICogeDEgLSB4MCAqIHoxOwogICAgICBkc3RbZHN0T2Zmc2V0ICsgMl0gPSB6MCAqIHcxICsgdzAgKiB6MSArIHgwICogeTEgLSB5MCAqIHgxOwogICAgICBkc3RbZHN0T2Zmc2V0ICsgM10gPSB3MCAqIHcxIC0geDAgKiB4MSAtIHkwICogeTEgLSB6MCAqIHoxOwogICAgICByZXR1cm4gZHN0OwogICAgfQogICAgZ2V0IHgoKSB7CiAgICAgIHJldHVybiB0aGlzLl94OwogICAgfQogICAgc2V0IHgodmFsdWUpIHsKICAgICAgdGhpcy5feCA9IHZhbHVlOwogICAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CiAgICB9CiAgICBnZXQgeSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3k7CiAgICB9CiAgICBzZXQgeSh2YWx1ZSkgewogICAgICB0aGlzLl95ID0gdmFsdWU7CiAgICAgIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKICAgIH0KICAgIGdldCB6KCkgewogICAgICByZXR1cm4gdGhpcy5fejsKICAgIH0KICAgIHNldCB6KHZhbHVlKSB7CiAgICAgIHRoaXMuX3ogPSB2YWx1ZTsKICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwogICAgfQogICAgZ2V0IHcoKSB7CiAgICAgIHJldHVybiB0aGlzLl93OwogICAgfQogICAgc2V0IHcodmFsdWUpIHsKICAgICAgdGhpcy5fdyA9IHZhbHVlOwogICAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CiAgICB9CiAgICBzZXQoeCwgeSwgeiwgdykgewogICAgICB0aGlzLl94ID0geDsKICAgICAgdGhpcy5feSA9IHk7CiAgICAgIHRoaXMuX3ogPSB6OwogICAgICB0aGlzLl93ID0gdzsKICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5feCwgdGhpcy5feSwgdGhpcy5feiwgdGhpcy5fdyk7CiAgICB9CiAgICBjb3B5KHF1YXRlcm5pb24pIHsKICAgICAgdGhpcy5feCA9IHF1YXRlcm5pb24ueDsKICAgICAgdGhpcy5feSA9IHF1YXRlcm5pb24ueTsKICAgICAgdGhpcy5feiA9IHF1YXRlcm5pb24uejsKICAgICAgdGhpcy5fdyA9IHF1YXRlcm5pb24udzsKICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21FdWxlcihldWxlciwgdXBkYXRlKSB7CiAgICAgIGlmICghKGV1bGVyICYmIGV1bGVyLmlzRXVsZXIpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUSFJFRS5RdWF0ZXJuaW9uOiAuc2V0RnJvbUV1bGVyKCkgbm93IGV4cGVjdHMgYW4gRXVsZXIgcm90YXRpb24gcmF0aGVyIHRoYW4gYSBWZWN0b3IzIGFuZCBvcmRlci4iKTsKICAgICAgfQogICAgICBjb25zdCB4ID0gZXVsZXIuX3gsIHkgPSBldWxlci5feSwgeiA9IGV1bGVyLl96LCBvcmRlciA9IGV1bGVyLl9vcmRlcjsKICAgICAgY29uc3QgY29zID0gTWF0aC5jb3M7CiAgICAgIGNvbnN0IHNpbiA9IE1hdGguc2luOwogICAgICBjb25zdCBjMSA9IGNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gY29zKHkgLyAyKTsKICAgICAgY29uc3QgYzMgPSBjb3MoeiAvIDIpOwogICAgICBjb25zdCBzMSA9IHNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gc2luKHkgLyAyKTsKICAgICAgY29uc3QgczMgPSBzaW4oeiAvIDIpOwogICAgICBzd2l0Y2ggKG9yZGVyKSB7CiAgICAgICAgY2FzZSAiWFlaIjoKICAgICAgICAgIHRoaXMuX3ggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgICB0aGlzLl95ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgICAgdGhpcy5feiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICAgIHRoaXMuX3cgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJZWFoiOgogICAgICAgICAgdGhpcy5feCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICAgIHRoaXMuX3kgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgICB0aGlzLl96ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgICAgICAgdGhpcy5fdyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlpYWSI6CiAgICAgICAgICB0aGlzLl94ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgICAgICAgdGhpcy5feSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICAgIHRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAgICAgICB0aGlzLl93ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiWllYIjoKICAgICAgICAgIHRoaXMuX3ggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgICB0aGlzLl95ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgICAgdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICAgIHRoaXMuX3cgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJZWlgiOgogICAgICAgICAgdGhpcy5feCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICAgIHRoaXMuX3kgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgICB0aGlzLl96ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgICAgICAgdGhpcy5fdyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlhaWSI6CiAgICAgICAgICB0aGlzLl94ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgICAgICAgdGhpcy5feSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICAgIHRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAgICAgICB0aGlzLl93ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuUXVhdGVybmlvbjogLnNldEZyb21FdWxlcigpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICIgKyBvcmRlcik7CiAgICAgIH0KICAgICAgaWYgKHVwZGF0ZSAhPT0gZmFsc2UpCiAgICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21BeGlzQW5nbGUoYXhpcywgYW5nbGUpIHsKICAgICAgY29uc3QgaGFsZkFuZ2xlID0gYW5nbGUgLyAyLCBzID0gTWF0aC5zaW4oaGFsZkFuZ2xlKTsKICAgICAgdGhpcy5feCA9IGF4aXMueCAqIHM7CiAgICAgIHRoaXMuX3kgPSBheGlzLnkgKiBzOwogICAgICB0aGlzLl96ID0gYXhpcy56ICogczsKICAgICAgdGhpcy5fdyA9IE1hdGguY29zKGhhbGZBbmdsZSk7CiAgICAgIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRGcm9tUm90YXRpb25NYXRyaXgobSkgewogICAgICBjb25zdCB0ZSA9IG0uZWxlbWVudHMsIG0xMSA9IHRlWzBdLCBtMTIgPSB0ZVs0XSwgbTEzID0gdGVbOF0sIG0yMSA9IHRlWzFdLCBtMjIgPSB0ZVs1XSwgbTIzID0gdGVbOV0sIG0zMSA9IHRlWzJdLCBtMzIgPSB0ZVs2XSwgbTMzID0gdGVbMTBdLCB0cmFjZSA9IG0xMSArIG0yMiArIG0zMzsKICAgICAgaWYgKHRyYWNlID4gMCkgewogICAgICAgIGNvbnN0IHMgPSAwLjUgLyBNYXRoLnNxcnQodHJhY2UgKyAxKTsKICAgICAgICB0aGlzLl93ID0gMC4yNSAvIHM7CiAgICAgICAgdGhpcy5feCA9IChtMzIgLSBtMjMpICogczsKICAgICAgICB0aGlzLl95ID0gKG0xMyAtIG0zMSkgKiBzOwogICAgICAgIHRoaXMuX3ogPSAobTIxIC0gbTEyKSAqIHM7CiAgICAgIH0gZWxzZSBpZiAobTExID4gbTIyICYmIG0xMSA+IG0zMykgewogICAgICAgIGNvbnN0IHMgPSAyICogTWF0aC5zcXJ0KDEgKyBtMTEgLSBtMjIgLSBtMzMpOwogICAgICAgIHRoaXMuX3cgPSAobTMyIC0gbTIzKSAvIHM7CiAgICAgICAgdGhpcy5feCA9IDAuMjUgKiBzOwogICAgICAgIHRoaXMuX3kgPSAobTEyICsgbTIxKSAvIHM7CiAgICAgICAgdGhpcy5feiA9IChtMTMgKyBtMzEpIC8gczsKICAgICAgfSBlbHNlIGlmIChtMjIgPiBtMzMpIHsKICAgICAgICBjb25zdCBzID0gMiAqIE1hdGguc3FydCgxICsgbTIyIC0gbTExIC0gbTMzKTsKICAgICAgICB0aGlzLl93ID0gKG0xMyAtIG0zMSkgLyBzOwogICAgICAgIHRoaXMuX3ggPSAobTEyICsgbTIxKSAvIHM7CiAgICAgICAgdGhpcy5feSA9IDAuMjUgKiBzOwogICAgICAgIHRoaXMuX3ogPSAobTIzICsgbTMyKSAvIHM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgcyA9IDIgKiBNYXRoLnNxcnQoMSArIG0zMyAtIG0xMSAtIG0yMik7CiAgICAgICAgdGhpcy5fdyA9IChtMjEgLSBtMTIpIC8gczsKICAgICAgICB0aGlzLl94ID0gKG0xMyArIG0zMSkgLyBzOwogICAgICAgIHRoaXMuX3kgPSAobTIzICsgbTMyKSAvIHM7CiAgICAgICAgdGhpcy5feiA9IDAuMjUgKiBzOwogICAgICB9CiAgICAgIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRGcm9tVW5pdFZlY3RvcnModkZyb20sIHZUbykgewogICAgICBsZXQgciA9IHZGcm9tLmRvdCh2VG8pICsgMTsKICAgICAgaWYgKHIgPCBOdW1iZXIuRVBTSUxPTikgewogICAgICAgIHIgPSAwOwogICAgICAgIGlmIChNYXRoLmFicyh2RnJvbS54KSA+IE1hdGguYWJzKHZGcm9tLnopKSB7CiAgICAgICAgICB0aGlzLl94ID0gLXZGcm9tLnk7CiAgICAgICAgICB0aGlzLl95ID0gdkZyb20ueDsKICAgICAgICAgIHRoaXMuX3ogPSAwOwogICAgICAgICAgdGhpcy5fdyA9IHI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX3ggPSAwOwogICAgICAgICAgdGhpcy5feSA9IC12RnJvbS56OwogICAgICAgICAgdGhpcy5feiA9IHZGcm9tLnk7CiAgICAgICAgICB0aGlzLl93ID0gcjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5feCA9IHZGcm9tLnkgKiB2VG8ueiAtIHZGcm9tLnogKiB2VG8ueTsKICAgICAgICB0aGlzLl95ID0gdkZyb20ueiAqIHZUby54IC0gdkZyb20ueCAqIHZUby56OwogICAgICAgIHRoaXMuX3ogPSB2RnJvbS54ICogdlRvLnkgLSB2RnJvbS55ICogdlRvLng7CiAgICAgICAgdGhpcy5fdyA9IHI7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMubm9ybWFsaXplKCk7CiAgICB9CiAgICBhbmdsZVRvKHEpIHsKICAgICAgcmV0dXJuIDIgKiBNYXRoLmFjb3MoTWF0aC5hYnMoY2xhbXAodGhpcy5kb3QocSksIC0xLCAxKSkpOwogICAgfQogICAgcm90YXRlVG93YXJkcyhxLCBzdGVwKSB7CiAgICAgIGNvbnN0IGFuZ2xlID0gdGhpcy5hbmdsZVRvKHEpOwogICAgICBpZiAoYW5nbGUgPT09IDApCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIGNvbnN0IHQgPSBNYXRoLm1pbigxLCBzdGVwIC8gYW5nbGUpOwogICAgICB0aGlzLnNsZXJwKHEsIHQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGlkZW50aXR5KCkgewogICAgICByZXR1cm4gdGhpcy5zZXQoMCwgMCwgMCwgMSk7CiAgICB9CiAgICBpbnZlcnQoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbmp1Z2F0ZSgpOwogICAgfQogICAgY29uanVnYXRlKCkgewogICAgICB0aGlzLl94ICo9IC0xOwogICAgICB0aGlzLl95ICo9IC0xOwogICAgICB0aGlzLl96ICo9IC0xOwogICAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZG90KHYpIHsKICAgICAgcmV0dXJuIHRoaXMuX3ggKiB2Ll94ICsgdGhpcy5feSAqIHYuX3kgKyB0aGlzLl96ICogdi5feiArIHRoaXMuX3cgKiB2Ll93OwogICAgfQogICAgbGVuZ3RoU3EoKSB7CiAgICAgIHJldHVybiB0aGlzLl94ICogdGhpcy5feCArIHRoaXMuX3kgKiB0aGlzLl95ICsgdGhpcy5feiAqIHRoaXMuX3ogKyB0aGlzLl93ICogdGhpcy5fdzsKICAgIH0KICAgIGxlbmd0aCgpIHsKICAgICAgcmV0dXJuIE1hdGguc3FydCh0aGlzLl94ICogdGhpcy5feCArIHRoaXMuX3kgKiB0aGlzLl95ICsgdGhpcy5feiAqIHRoaXMuX3ogKyB0aGlzLl93ICogdGhpcy5fdyk7CiAgICB9CiAgICBub3JtYWxpemUoKSB7CiAgICAgIGxldCBsID0gdGhpcy5sZW5ndGgoKTsKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLl94ID0gMDsKICAgICAgICB0aGlzLl95ID0gMDsKICAgICAgICB0aGlzLl96ID0gMDsKICAgICAgICB0aGlzLl93ID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsID0gMSAvIGw7CiAgICAgICAgdGhpcy5feCA9IHRoaXMuX3ggKiBsOwogICAgICAgIHRoaXMuX3kgPSB0aGlzLl95ICogbDsKICAgICAgICB0aGlzLl96ID0gdGhpcy5feiAqIGw7CiAgICAgICAgdGhpcy5fdyA9IHRoaXMuX3cgKiBsOwogICAgICB9CiAgICAgIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtdWx0aXBseShxLCBwKSB7CiAgICAgIGlmIChwICE9PSB2b2lkIDApIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLlF1YXRlcm5pb246IC5tdWx0aXBseSgpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLm11bHRpcGx5UXVhdGVybmlvbnMoIGEsIGIgKSBpbnN0ZWFkLiIpOwogICAgICAgIHJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMocSwgcCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyh0aGlzLCBxKTsKICAgIH0KICAgIHByZW11bHRpcGx5KHEpIHsKICAgICAgcmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyhxLCB0aGlzKTsKICAgIH0KICAgIG11bHRpcGx5UXVhdGVybmlvbnMoYSwgYikgewogICAgICBjb25zdCBxYXggPSBhLl94LCBxYXkgPSBhLl95LCBxYXogPSBhLl96LCBxYXcgPSBhLl93OwogICAgICBjb25zdCBxYnggPSBiLl94LCBxYnkgPSBiLl95LCBxYnogPSBiLl96LCBxYncgPSBiLl93OwogICAgICB0aGlzLl94ID0gcWF4ICogcWJ3ICsgcWF3ICogcWJ4ICsgcWF5ICogcWJ6IC0gcWF6ICogcWJ5OwogICAgICB0aGlzLl95ID0gcWF5ICogcWJ3ICsgcWF3ICogcWJ5ICsgcWF6ICogcWJ4IC0gcWF4ICogcWJ6OwogICAgICB0aGlzLl96ID0gcWF6ICogcWJ3ICsgcWF3ICogcWJ6ICsgcWF4ICogcWJ5IC0gcWF5ICogcWJ4OwogICAgICB0aGlzLl93ID0gcWF3ICogcWJ3IC0gcWF4ICogcWJ4IC0gcWF5ICogcWJ5IC0gcWF6ICogcWJ6OwogICAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2xlcnAocWIsIHQpIHsKICAgICAgaWYgKHQgPT09IDApCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIGlmICh0ID09PSAxKQogICAgICAgIHJldHVybiB0aGlzLmNvcHkocWIpOwogICAgICBjb25zdCB4ID0gdGhpcy5feCwgeSA9IHRoaXMuX3ksIHogPSB0aGlzLl96LCB3ID0gdGhpcy5fdzsKICAgICAgbGV0IGNvc0hhbGZUaGV0YSA9IHcgKiBxYi5fdyArIHggKiBxYi5feCArIHkgKiBxYi5feSArIHogKiBxYi5fejsKICAgICAgaWYgKGNvc0hhbGZUaGV0YSA8IDApIHsKICAgICAgICB0aGlzLl93ID0gLXFiLl93OwogICAgICAgIHRoaXMuX3ggPSAtcWIuX3g7CiAgICAgICAgdGhpcy5feSA9IC1xYi5feTsKICAgICAgICB0aGlzLl96ID0gLXFiLl96OwogICAgICAgIGNvc0hhbGZUaGV0YSA9IC1jb3NIYWxmVGhldGE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb3B5KHFiKTsKICAgICAgfQogICAgICBpZiAoY29zSGFsZlRoZXRhID49IDEpIHsKICAgICAgICB0aGlzLl93ID0gdzsKICAgICAgICB0aGlzLl94ID0geDsKICAgICAgICB0aGlzLl95ID0geTsKICAgICAgICB0aGlzLl96ID0gejsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBjb25zdCBzcXJTaW5IYWxmVGhldGEgPSAxIC0gY29zSGFsZlRoZXRhICogY29zSGFsZlRoZXRhOwogICAgICBpZiAoc3FyU2luSGFsZlRoZXRhIDw9IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgY29uc3QgcyA9IDEgLSB0OwogICAgICAgIHRoaXMuX3cgPSBzICogdyArIHQgKiB0aGlzLl93OwogICAgICAgIHRoaXMuX3ggPSBzICogeCArIHQgKiB0aGlzLl94OwogICAgICAgIHRoaXMuX3kgPSBzICogeSArIHQgKiB0aGlzLl95OwogICAgICAgIHRoaXMuX3ogPSBzICogeiArIHQgKiB0aGlzLl96OwogICAgICAgIHRoaXMubm9ybWFsaXplKCk7CiAgICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIGNvbnN0IHNpbkhhbGZUaGV0YSA9IE1hdGguc3FydChzcXJTaW5IYWxmVGhldGEpOwogICAgICBjb25zdCBoYWxmVGhldGEgPSBNYXRoLmF0YW4yKHNpbkhhbGZUaGV0YSwgY29zSGFsZlRoZXRhKTsKICAgICAgY29uc3QgcmF0aW9BID0gTWF0aC5zaW4oKDEgLSB0KSAqIGhhbGZUaGV0YSkgLyBzaW5IYWxmVGhldGEsIHJhdGlvQiA9IE1hdGguc2luKHQgKiBoYWxmVGhldGEpIC8gc2luSGFsZlRoZXRhOwogICAgICB0aGlzLl93ID0gdyAqIHJhdGlvQSArIHRoaXMuX3cgKiByYXRpb0I7CiAgICAgIHRoaXMuX3ggPSB4ICogcmF0aW9BICsgdGhpcy5feCAqIHJhdGlvQjsKICAgICAgdGhpcy5feSA9IHkgKiByYXRpb0EgKyB0aGlzLl95ICogcmF0aW9COwogICAgICB0aGlzLl96ID0geiAqIHJhdGlvQSArIHRoaXMuX3ogKiByYXRpb0I7CiAgICAgIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzbGVycFF1YXRlcm5pb25zKHFhLCBxYiwgdCkgewogICAgICB0aGlzLmNvcHkocWEpLnNsZXJwKHFiLCB0KTsKICAgIH0KICAgIGVxdWFscyhxdWF0ZXJuaW9uKSB7CiAgICAgIHJldHVybiBxdWF0ZXJuaW9uLl94ID09PSB0aGlzLl94ICYmIHF1YXRlcm5pb24uX3kgPT09IHRoaXMuX3kgJiYgcXVhdGVybmlvbi5feiA9PT0gdGhpcy5feiAmJiBxdWF0ZXJuaW9uLl93ID09PSB0aGlzLl93OwogICAgfQogICAgZnJvbUFycmF5KGFycmF5LCBvZmZzZXQgPSAwKSB7CiAgICAgIHRoaXMuX3ggPSBhcnJheVtvZmZzZXRdOwogICAgICB0aGlzLl95ID0gYXJyYXlbb2Zmc2V0ICsgMV07CiAgICAgIHRoaXMuX3ogPSBhcnJheVtvZmZzZXQgKyAyXTsKICAgICAgdGhpcy5fdyA9IGFycmF5W29mZnNldCArIDNdOwogICAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9BcnJheShhcnJheSA9IFtdLCBvZmZzZXQgPSAwKSB7CiAgICAgIGFycmF5W29mZnNldF0gPSB0aGlzLl94OwogICAgICBhcnJheVtvZmZzZXQgKyAxXSA9IHRoaXMuX3k7CiAgICAgIGFycmF5W29mZnNldCArIDJdID0gdGhpcy5fejsKICAgICAgYXJyYXlbb2Zmc2V0ICsgM10gPSB0aGlzLl93OwogICAgICByZXR1cm4gYXJyYXk7CiAgICB9CiAgICBmcm9tQnVmZmVyQXR0cmlidXRlKGF0dHJpYnV0ZSwgaW5kZXgpIHsKICAgICAgdGhpcy5feCA9IGF0dHJpYnV0ZS5nZXRYKGluZGV4KTsKICAgICAgdGhpcy5feSA9IGF0dHJpYnV0ZS5nZXRZKGluZGV4KTsKICAgICAgdGhpcy5feiA9IGF0dHJpYnV0ZS5nZXRaKGluZGV4KTsKICAgICAgdGhpcy5fdyA9IGF0dHJpYnV0ZS5nZXRXKGluZGV4KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBfb25DaGFuZ2UoY2FsbGJhY2spIHsKICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIF9vbkNoYW5nZUNhbGxiYWNrKCkgewogICAgfQogIH07CiAgUXVhdGVybmlvbi5wcm90b3R5cGUuaXNRdWF0ZXJuaW9uID0gdHJ1ZTsKICB2YXIgVmVjdG9yMyA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKHggPSAwLCB5ID0gMCwgeiA9IDApIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgIH0KICAgIHNldCh4LCB5LCB6KSB7CiAgICAgIGlmICh6ID09PSB2b2lkIDApCiAgICAgICAgeiA9IHRoaXMuejsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRTY2FsYXIoc2NhbGFyKSB7CiAgICAgIHRoaXMueCA9IHNjYWxhcjsKICAgICAgdGhpcy55ID0gc2NhbGFyOwogICAgICB0aGlzLnogPSBzY2FsYXI7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0WCh4KSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0WSh5KSB7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0Wih6KSB7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0Q29tcG9uZW50KGluZGV4LCB2YWx1ZSkgewogICAgICBzd2l0Y2ggKGluZGV4KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgdGhpcy54ID0gdmFsdWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICB0aGlzLnkgPSB2YWx1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHRoaXMueiA9IHZhbHVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAiICsgaW5kZXgpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0Q29tcG9uZW50KGluZGV4KSB7CiAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICByZXR1cm4gdGhpcy54OwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHJldHVybiB0aGlzLnk7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgcmV0dXJuIHRoaXMuejsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIgKyBpbmRleCk7CiAgICAgIH0KICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CiAgICBjb3B5KHYpIHsKICAgICAgdGhpcy54ID0gdi54OwogICAgICB0aGlzLnkgPSB2Lnk7CiAgICAgIHRoaXMueiA9IHYuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBhZGQodiwgdykgewogICAgICBpZiAodyAhPT0gdm9pZCAwKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5WZWN0b3IzOiAuYWRkKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuYWRkVmVjdG9ycyggYSwgYiApIGluc3RlYWQuIik7CiAgICAgICAgcmV0dXJuIHRoaXMuYWRkVmVjdG9ycyh2LCB3KTsKICAgICAgfQogICAgICB0aGlzLnggKz0gdi54OwogICAgICB0aGlzLnkgKz0gdi55OwogICAgICB0aGlzLnogKz0gdi56OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFkZFNjYWxhcihzKSB7CiAgICAgIHRoaXMueCArPSBzOwogICAgICB0aGlzLnkgKz0gczsKICAgICAgdGhpcy56ICs9IHM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWRkVmVjdG9ycyhhLCBiKSB7CiAgICAgIHRoaXMueCA9IGEueCArIGIueDsKICAgICAgdGhpcy55ID0gYS55ICsgYi55OwogICAgICB0aGlzLnogPSBhLnogKyBiLno7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWRkU2NhbGVkVmVjdG9yKHYsIHMpIHsKICAgICAgdGhpcy54ICs9IHYueCAqIHM7CiAgICAgIHRoaXMueSArPSB2LnkgKiBzOwogICAgICB0aGlzLnogKz0gdi56ICogczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzdWIodiwgdykgewogICAgICBpZiAodyAhPT0gdm9pZCAwKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5WZWN0b3IzOiAuc3ViKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuc3ViVmVjdG9ycyggYSwgYiApIGluc3RlYWQuIik7CiAgICAgICAgcmV0dXJuIHRoaXMuc3ViVmVjdG9ycyh2LCB3KTsKICAgICAgfQogICAgICB0aGlzLnggLT0gdi54OwogICAgICB0aGlzLnkgLT0gdi55OwogICAgICB0aGlzLnogLT0gdi56OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHN1YlNjYWxhcihzKSB7CiAgICAgIHRoaXMueCAtPSBzOwogICAgICB0aGlzLnkgLT0gczsKICAgICAgdGhpcy56IC09IHM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc3ViVmVjdG9ycyhhLCBiKSB7CiAgICAgIHRoaXMueCA9IGEueCAtIGIueDsKICAgICAgdGhpcy55ID0gYS55IC0gYi55OwogICAgICB0aGlzLnogPSBhLnogLSBiLno7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbXVsdGlwbHkodiwgdykgewogICAgICBpZiAodyAhPT0gdm9pZCAwKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5WZWN0b3IzOiAubXVsdGlwbHkoKSBub3cgb25seSBhY2NlcHRzIG9uZSBhcmd1bWVudC4gVXNlIC5tdWx0aXBseVZlY3RvcnMoIGEsIGIgKSBpbnN0ZWFkLiIpOwogICAgICAgIHJldHVybiB0aGlzLm11bHRpcGx5VmVjdG9ycyh2LCB3KTsKICAgICAgfQogICAgICB0aGlzLnggKj0gdi54OwogICAgICB0aGlzLnkgKj0gdi55OwogICAgICB0aGlzLnogKj0gdi56OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG11bHRpcGx5U2NhbGFyKHNjYWxhcikgewogICAgICB0aGlzLnggKj0gc2NhbGFyOwogICAgICB0aGlzLnkgKj0gc2NhbGFyOwogICAgICB0aGlzLnogKj0gc2NhbGFyOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG11bHRpcGx5VmVjdG9ycyhhLCBiKSB7CiAgICAgIHRoaXMueCA9IGEueCAqIGIueDsKICAgICAgdGhpcy55ID0gYS55ICogYi55OwogICAgICB0aGlzLnogPSBhLnogKiBiLno7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYXBwbHlFdWxlcihldWxlcikgewogICAgICBpZiAoIShldWxlciAmJiBldWxlci5pc0V1bGVyKSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLlZlY3RvcjM6IC5hcHBseUV1bGVyKCkgbm93IGV4cGVjdHMgYW4gRXVsZXIgcm90YXRpb24gcmF0aGVyIHRoYW4gYSBWZWN0b3IzIGFuZCBvcmRlci4iKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5hcHBseVF1YXRlcm5pb24oX3F1YXRlcm5pb24kNC5zZXRGcm9tRXVsZXIoZXVsZXIpKTsKICAgIH0KICAgIGFwcGx5QXhpc0FuZ2xlKGF4aXMsIGFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLmFwcGx5UXVhdGVybmlvbihfcXVhdGVybmlvbiQ0LnNldEZyb21BeGlzQW5nbGUoYXhpcywgYW5nbGUpKTsKICAgIH0KICAgIGFwcGx5TWF0cml4MyhtKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CiAgICAgIGNvbnN0IGUgPSBtLmVsZW1lbnRzOwogICAgICB0aGlzLnggPSBlWzBdICogeCArIGVbM10gKiB5ICsgZVs2XSAqIHo7CiAgICAgIHRoaXMueSA9IGVbMV0gKiB4ICsgZVs0XSAqIHkgKyBlWzddICogejsKICAgICAgdGhpcy56ID0gZVsyXSAqIHggKyBlWzVdICogeSArIGVbOF0gKiB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFwcGx5Tm9ybWFsTWF0cml4KG0pIHsKICAgICAgcmV0dXJuIHRoaXMuYXBwbHlNYXRyaXgzKG0pLm5vcm1hbGl6ZSgpOwogICAgfQogICAgYXBwbHlNYXRyaXg0KG0pIHsKICAgICAgY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKICAgICAgY29uc3QgZSA9IG0uZWxlbWVudHM7CiAgICAgIGNvbnN0IHcgPSAxIC8gKGVbM10gKiB4ICsgZVs3XSAqIHkgKyBlWzExXSAqIHogKyBlWzE1XSk7CiAgICAgIHRoaXMueCA9IChlWzBdICogeCArIGVbNF0gKiB5ICsgZVs4XSAqIHogKyBlWzEyXSkgKiB3OwogICAgICB0aGlzLnkgPSAoZVsxXSAqIHggKyBlWzVdICogeSArIGVbOV0gKiB6ICsgZVsxM10pICogdzsKICAgICAgdGhpcy56ID0gKGVbMl0gKiB4ICsgZVs2XSAqIHkgKyBlWzEwXSAqIHogKyBlWzE0XSkgKiB3OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFwcGx5UXVhdGVybmlvbihxKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHF4ID0gcS54LCBxeSA9IHEueSwgcXogPSBxLnosIHF3ID0gcS53OwogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRoaXMueCA9IGl4ICogcXcgKyBpdyAqIC1xeCArIGl5ICogLXF6IC0gaXogKiAtcXk7CiAgICAgIHRoaXMueSA9IGl5ICogcXcgKyBpdyAqIC1xeSArIGl6ICogLXF4IC0gaXggKiAtcXo7CiAgICAgIHRoaXMueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcHJvamVjdChjYW1lcmEpIHsKICAgICAgcmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UpLmFwcGx5TWF0cml4NChjYW1lcmEucHJvamVjdGlvbk1hdHJpeCk7CiAgICB9CiAgICB1bnByb2plY3QoY2FtZXJhKSB7CiAgICAgIHJldHVybiB0aGlzLmFwcGx5TWF0cml4NChjYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UpLmFwcGx5TWF0cml4NChjYW1lcmEubWF0cml4V29ybGQpOwogICAgfQogICAgdHJhbnNmb3JtRGlyZWN0aW9uKG0pIHsKICAgICAgY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKICAgICAgY29uc3QgZSA9IG0uZWxlbWVudHM7CiAgICAgIHRoaXMueCA9IGVbMF0gKiB4ICsgZVs0XSAqIHkgKyBlWzhdICogejsKICAgICAgdGhpcy55ID0gZVsxXSAqIHggKyBlWzVdICogeSArIGVbOV0gKiB6OwogICAgICB0aGlzLnogPSBlWzJdICogeCArIGVbNl0gKiB5ICsgZVsxMF0gKiB6OwogICAgICByZXR1cm4gdGhpcy5ub3JtYWxpemUoKTsKICAgIH0KICAgIGRpdmlkZSh2KSB7CiAgICAgIHRoaXMueCAvPSB2Lng7CiAgICAgIHRoaXMueSAvPSB2Lnk7CiAgICAgIHRoaXMueiAvPSB2Lno7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZGl2aWRlU2NhbGFyKHNjYWxhcikgewogICAgICByZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhcigxIC8gc2NhbGFyKTsKICAgIH0KICAgIG1pbih2KSB7CiAgICAgIHRoaXMueCA9IE1hdGgubWluKHRoaXMueCwgdi54KTsKICAgICAgdGhpcy55ID0gTWF0aC5taW4odGhpcy55LCB2LnkpOwogICAgICB0aGlzLnogPSBNYXRoLm1pbih0aGlzLnosIHYueik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbWF4KHYpIHsKICAgICAgdGhpcy54ID0gTWF0aC5tYXgodGhpcy54LCB2LngpOwogICAgICB0aGlzLnkgPSBNYXRoLm1heCh0aGlzLnksIHYueSk7CiAgICAgIHRoaXMueiA9IE1hdGgubWF4KHRoaXMueiwgdi56KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbGFtcChtaW4sIG1heCkgewogICAgICB0aGlzLnggPSBNYXRoLm1heChtaW4ueCwgTWF0aC5taW4obWF4LngsIHRoaXMueCkpOwogICAgICB0aGlzLnkgPSBNYXRoLm1heChtaW4ueSwgTWF0aC5taW4obWF4LnksIHRoaXMueSkpOwogICAgICB0aGlzLnogPSBNYXRoLm1heChtaW4ueiwgTWF0aC5taW4obWF4LnosIHRoaXMueikpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsYW1wU2NhbGFyKG1pblZhbCwgbWF4VmFsKSB7CiAgICAgIHRoaXMueCA9IE1hdGgubWF4KG1pblZhbCwgTWF0aC5taW4obWF4VmFsLCB0aGlzLngpKTsKICAgICAgdGhpcy55ID0gTWF0aC5tYXgobWluVmFsLCBNYXRoLm1pbihtYXhWYWwsIHRoaXMueSkpOwogICAgICB0aGlzLnogPSBNYXRoLm1heChtaW5WYWwsIE1hdGgubWluKG1heFZhbCwgdGhpcy56KSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY2xhbXBMZW5ndGgobWluLCBtYXgpIHsKICAgICAgY29uc3QgbGVuZ3RoMiA9IHRoaXMubGVuZ3RoKCk7CiAgICAgIHJldHVybiB0aGlzLmRpdmlkZVNjYWxhcihsZW5ndGgyIHx8IDEpLm11bHRpcGx5U2NhbGFyKE1hdGgubWF4KG1pbiwgTWF0aC5taW4obWF4LCBsZW5ndGgyKSkpOwogICAgfQogICAgZmxvb3IoKSB7CiAgICAgIHRoaXMueCA9IE1hdGguZmxvb3IodGhpcy54KTsKICAgICAgdGhpcy55ID0gTWF0aC5mbG9vcih0aGlzLnkpOwogICAgICB0aGlzLnogPSBNYXRoLmZsb29yKHRoaXMueik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY2VpbCgpIHsKICAgICAgdGhpcy54ID0gTWF0aC5jZWlsKHRoaXMueCk7CiAgICAgIHRoaXMueSA9IE1hdGguY2VpbCh0aGlzLnkpOwogICAgICB0aGlzLnogPSBNYXRoLmNlaWwodGhpcy56KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByb3VuZCgpIHsKICAgICAgdGhpcy54ID0gTWF0aC5yb3VuZCh0aGlzLngpOwogICAgICB0aGlzLnkgPSBNYXRoLnJvdW5kKHRoaXMueSk7CiAgICAgIHRoaXMueiA9IE1hdGgucm91bmQodGhpcy56KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByb3VuZFRvWmVybygpIHsKICAgICAgdGhpcy54ID0gdGhpcy54IDwgMCA/IE1hdGguY2VpbCh0aGlzLngpIDogTWF0aC5mbG9vcih0aGlzLngpOwogICAgICB0aGlzLnkgPSB0aGlzLnkgPCAwID8gTWF0aC5jZWlsKHRoaXMueSkgOiBNYXRoLmZsb29yKHRoaXMueSk7CiAgICAgIHRoaXMueiA9IHRoaXMueiA8IDAgPyBNYXRoLmNlaWwodGhpcy56KSA6IE1hdGguZmxvb3IodGhpcy56KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBuZWdhdGUoKSB7CiAgICAgIHRoaXMueCA9IC10aGlzLng7CiAgICAgIHRoaXMueSA9IC10aGlzLnk7CiAgICAgIHRoaXMueiA9IC10aGlzLno7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZG90KHYpIHsKICAgICAgcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYuejsKICAgIH0KICAgIGxlbmd0aFNxKCkgewogICAgICByZXR1cm4gdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56OwogICAgfQogICAgbGVuZ3RoKCkgewogICAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueik7CiAgICB9CiAgICBtYW5oYXR0YW5MZW5ndGgoKSB7CiAgICAgIHJldHVybiBNYXRoLmFicyh0aGlzLngpICsgTWF0aC5hYnModGhpcy55KSArIE1hdGguYWJzKHRoaXMueik7CiAgICB9CiAgICBub3JtYWxpemUoKSB7CiAgICAgIHJldHVybiB0aGlzLmRpdmlkZVNjYWxhcih0aGlzLmxlbmd0aCgpIHx8IDEpOwogICAgfQogICAgc2V0TGVuZ3RoKGxlbmd0aDIpIHsKICAgICAgcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIobGVuZ3RoMik7CiAgICB9CiAgICBsZXJwKHYsIGFscGhhKSB7CiAgICAgIHRoaXMueCArPSAodi54IC0gdGhpcy54KSAqIGFscGhhOwogICAgICB0aGlzLnkgKz0gKHYueSAtIHRoaXMueSkgKiBhbHBoYTsKICAgICAgdGhpcy56ICs9ICh2LnogLSB0aGlzLnopICogYWxwaGE7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbGVycFZlY3RvcnModjEsIHYyLCBhbHBoYSkgewogICAgICB0aGlzLnggPSB2MS54ICsgKHYyLnggLSB2MS54KSAqIGFscGhhOwogICAgICB0aGlzLnkgPSB2MS55ICsgKHYyLnkgLSB2MS55KSAqIGFscGhhOwogICAgICB0aGlzLnogPSB2MS56ICsgKHYyLnogLSB2MS56KSAqIGFscGhhOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNyb3NzKHYsIHcpIHsKICAgICAgaWYgKHcgIT09IHZvaWQgMCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yMzogLmNyb3NzKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuY3Jvc3NWZWN0b3JzKCBhLCBiICkgaW5zdGVhZC4iKTsKICAgICAgICByZXR1cm4gdGhpcy5jcm9zc1ZlY3RvcnModiwgdyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuY3Jvc3NWZWN0b3JzKHRoaXMsIHYpOwogICAgfQogICAgY3Jvc3NWZWN0b3JzKGEsIGIpIHsKICAgICAgY29uc3QgYXggPSBhLngsIGF5ID0gYS55LCBheiA9IGEuejsKICAgICAgY29uc3QgYnggPSBiLngsIGJ5ID0gYi55LCBieiA9IGIuejsKICAgICAgdGhpcy54ID0gYXkgKiBieiAtIGF6ICogYnk7CiAgICAgIHRoaXMueSA9IGF6ICogYnggLSBheCAqIGJ6OwogICAgICB0aGlzLnogPSBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBwcm9qZWN0T25WZWN0b3IodikgewogICAgICBjb25zdCBkZW5vbWluYXRvciA9IHYubGVuZ3RoU3EoKTsKICAgICAgaWYgKGRlbm9taW5hdG9yID09PSAwKQogICAgICAgIHJldHVybiB0aGlzLnNldCgwLCAwLCAwKTsKICAgICAgY29uc3Qgc2NhbGFyID0gdi5kb3QodGhpcykgLyBkZW5vbWluYXRvcjsKICAgICAgcmV0dXJuIHRoaXMuY29weSh2KS5tdWx0aXBseVNjYWxhcihzY2FsYXIpOwogICAgfQogICAgcHJvamVjdE9uUGxhbmUocGxhbmVOb3JtYWwpIHsKICAgICAgX3ZlY3RvciRjLmNvcHkodGhpcykucHJvamVjdE9uVmVjdG9yKHBsYW5lTm9ybWFsKTsKICAgICAgcmV0dXJuIHRoaXMuc3ViKF92ZWN0b3IkYyk7CiAgICB9CiAgICByZWZsZWN0KG5vcm1hbDIpIHsKICAgICAgcmV0dXJuIHRoaXMuc3ViKF92ZWN0b3IkYy5jb3B5KG5vcm1hbDIpLm11bHRpcGx5U2NhbGFyKDIgKiB0aGlzLmRvdChub3JtYWwyKSkpOwogICAgfQogICAgYW5nbGVUbyh2KSB7CiAgICAgIGNvbnN0IGRlbm9taW5hdG9yID0gTWF0aC5zcXJ0KHRoaXMubGVuZ3RoU3EoKSAqIHYubGVuZ3RoU3EoKSk7CiAgICAgIGlmIChkZW5vbWluYXRvciA9PT0gMCkKICAgICAgICByZXR1cm4gTWF0aC5QSSAvIDI7CiAgICAgIGNvbnN0IHRoZXRhID0gdGhpcy5kb3QodikgLyBkZW5vbWluYXRvcjsKICAgICAgcmV0dXJuIE1hdGguYWNvcyhjbGFtcCh0aGV0YSwgLTEsIDEpKTsKICAgIH0KICAgIGRpc3RhbmNlVG8odikgewogICAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMuZGlzdGFuY2VUb1NxdWFyZWQodikpOwogICAgfQogICAgZGlzdGFuY2VUb1NxdWFyZWQodikgewogICAgICBjb25zdCBkeCA9IHRoaXMueCAtIHYueCwgZHkgPSB0aGlzLnkgLSB2LnksIGR6ID0gdGhpcy56IC0gdi56OwogICAgICByZXR1cm4gZHggKiBkeCArIGR5ICogZHkgKyBkeiAqIGR6OwogICAgfQogICAgbWFuaGF0dGFuRGlzdGFuY2VUbyh2KSB7CiAgICAgIHJldHVybiBNYXRoLmFicyh0aGlzLnggLSB2LngpICsgTWF0aC5hYnModGhpcy55IC0gdi55KSArIE1hdGguYWJzKHRoaXMueiAtIHYueik7CiAgICB9CiAgICBzZXRGcm9tU3BoZXJpY2FsKHMpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0RnJvbVNwaGVyaWNhbENvb3JkcyhzLnJhZGl1cywgcy5waGksIHMudGhldGEpOwogICAgfQogICAgc2V0RnJvbVNwaGVyaWNhbENvb3JkcyhyYWRpdXMsIHBoaSwgdGhldGEpIHsKICAgICAgY29uc3Qgc2luUGhpUmFkaXVzID0gTWF0aC5zaW4ocGhpKSAqIHJhZGl1czsKICAgICAgdGhpcy54ID0gc2luUGhpUmFkaXVzICogTWF0aC5zaW4odGhldGEpOwogICAgICB0aGlzLnkgPSBNYXRoLmNvcyhwaGkpICogcmFkaXVzOwogICAgICB0aGlzLnogPSBzaW5QaGlSYWRpdXMgKiBNYXRoLmNvcyh0aGV0YSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0RnJvbUN5bGluZHJpY2FsKGMpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0RnJvbUN5bGluZHJpY2FsQ29vcmRzKGMucmFkaXVzLCBjLnRoZXRhLCBjLnkpOwogICAgfQogICAgc2V0RnJvbUN5bGluZHJpY2FsQ29vcmRzKHJhZGl1cywgdGhldGEsIHkpIHsKICAgICAgdGhpcy54ID0gcmFkaXVzICogTWF0aC5zaW4odGhldGEpOwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSByYWRpdXMgKiBNYXRoLmNvcyh0aGV0YSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0RnJvbU1hdHJpeFBvc2l0aW9uKG0pIHsKICAgICAgY29uc3QgZSA9IG0uZWxlbWVudHM7CiAgICAgIHRoaXMueCA9IGVbMTJdOwogICAgICB0aGlzLnkgPSBlWzEzXTsKICAgICAgdGhpcy56ID0gZVsxNF07CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0RnJvbU1hdHJpeFNjYWxlKG0pIHsKICAgICAgY29uc3Qgc3ggPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4obSwgMCkubGVuZ3RoKCk7CiAgICAgIGNvbnN0IHN5ID0gdGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKG0sIDEpLmxlbmd0aCgpOwogICAgICBjb25zdCBzeiA9IHRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbihtLCAyKS5sZW5ndGgoKTsKICAgICAgdGhpcy54ID0gc3g7CiAgICAgIHRoaXMueSA9IHN5OwogICAgICB0aGlzLnogPSBzejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRGcm9tTWF0cml4Q29sdW1uKG0sIGluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLmZyb21BcnJheShtLmVsZW1lbnRzLCBpbmRleCAqIDQpOwogICAgfQogICAgc2V0RnJvbU1hdHJpeDNDb2x1bW4obSwgaW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMuZnJvbUFycmF5KG0uZWxlbWVudHMsIGluZGV4ICogMyk7CiAgICB9CiAgICBlcXVhbHModikgewogICAgICByZXR1cm4gdi54ID09PSB0aGlzLnggJiYgdi55ID09PSB0aGlzLnkgJiYgdi56ID09PSB0aGlzLno7CiAgICB9CiAgICBmcm9tQXJyYXkoYXJyYXksIG9mZnNldCA9IDApIHsKICAgICAgdGhpcy54ID0gYXJyYXlbb2Zmc2V0XTsKICAgICAgdGhpcy55ID0gYXJyYXlbb2Zmc2V0ICsgMV07CiAgICAgIHRoaXMueiA9IGFycmF5W29mZnNldCArIDJdOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvQXJyYXkoYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCkgewogICAgICBhcnJheVtvZmZzZXRdID0gdGhpcy54OwogICAgICBhcnJheVtvZmZzZXQgKyAxXSA9IHRoaXMueTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgMl0gPSB0aGlzLno7CiAgICAgIHJldHVybiBhcnJheTsKICAgIH0KICAgIGZyb21CdWZmZXJBdHRyaWJ1dGUoYXR0cmlidXRlLCBpbmRleCwgb2Zmc2V0KSB7CiAgICAgIGlmIChvZmZzZXQgIT09IHZvaWQgMCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yMzogb2Zmc2V0IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSgpLiIpOwogICAgICB9CiAgICAgIHRoaXMueCA9IGF0dHJpYnV0ZS5nZXRYKGluZGV4KTsKICAgICAgdGhpcy55ID0gYXR0cmlidXRlLmdldFkoaW5kZXgpOwogICAgICB0aGlzLnogPSBhdHRyaWJ1dGUuZ2V0WihpbmRleCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcmFuZG9tKCkgewogICAgICB0aGlzLnggPSBNYXRoLnJhbmRvbSgpOwogICAgICB0aGlzLnkgPSBNYXRoLnJhbmRvbSgpOwogICAgICB0aGlzLnogPSBNYXRoLnJhbmRvbSgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIFZlY3RvcjMucHJvdG90eXBlLmlzVmVjdG9yMyA9IHRydWU7CiAgdmFyIF92ZWN0b3IkYyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfcXVhdGVybmlvbiQ0ID0gLyogQF9fUFVSRV9fICovIG5ldyBRdWF0ZXJuaW9uKCk7CiAgdmFyIEJveDMgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihtaW4gPSBuZXcgVmVjdG9yMyhJbmZpbml0eSwgSW5maW5pdHksIEluZmluaXR5KSwgbWF4ID0gbmV3IFZlY3RvcjMoLUluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eSkpIHsKICAgICAgdGhpcy5taW4gPSBtaW47CiAgICAgIHRoaXMubWF4ID0gbWF4OwogICAgfQogICAgc2V0KG1pbiwgbWF4KSB7CiAgICAgIHRoaXMubWluLmNvcHkobWluKTsKICAgICAgdGhpcy5tYXguY29weShtYXgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21BcnJheShhcnJheSkgewogICAgICBsZXQgbWluWCA9IEluZmluaXR5OwogICAgICBsZXQgbWluWSA9IEluZmluaXR5OwogICAgICBsZXQgbWluWiA9IEluZmluaXR5OwogICAgICBsZXQgbWF4WCA9IC1JbmZpbml0eTsKICAgICAgbGV0IG1heFkgPSAtSW5maW5pdHk7CiAgICAgIGxldCBtYXhaID0gLUluZmluaXR5OwogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKz0gMykgewogICAgICAgIGNvbnN0IHggPSBhcnJheVtpXTsKICAgICAgICBjb25zdCB5ID0gYXJyYXlbaSArIDFdOwogICAgICAgIGNvbnN0IHogPSBhcnJheVtpICsgMl07CiAgICAgICAgaWYgKHggPCBtaW5YKQogICAgICAgICAgbWluWCA9IHg7CiAgICAgICAgaWYgKHkgPCBtaW5ZKQogICAgICAgICAgbWluWSA9IHk7CiAgICAgICAgaWYgKHogPCBtaW5aKQogICAgICAgICAgbWluWiA9IHo7CiAgICAgICAgaWYgKHggPiBtYXhYKQogICAgICAgICAgbWF4WCA9IHg7CiAgICAgICAgaWYgKHkgPiBtYXhZKQogICAgICAgICAgbWF4WSA9IHk7CiAgICAgICAgaWYgKHogPiBtYXhaKQogICAgICAgICAgbWF4WiA9IHo7CiAgICAgIH0KICAgICAgdGhpcy5taW4uc2V0KG1pblgsIG1pblksIG1pblopOwogICAgICB0aGlzLm1heC5zZXQobWF4WCwgbWF4WSwgbWF4Wik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZShhdHRyaWJ1dGUpIHsKICAgICAgbGV0IG1pblggPSBJbmZpbml0eTsKICAgICAgbGV0IG1pblkgPSBJbmZpbml0eTsKICAgICAgbGV0IG1pblogPSBJbmZpbml0eTsKICAgICAgbGV0IG1heFggPSAtSW5maW5pdHk7CiAgICAgIGxldCBtYXhZID0gLUluZmluaXR5OwogICAgICBsZXQgbWF4WiA9IC1JbmZpbml0eTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB4ID0gYXR0cmlidXRlLmdldFgoaSk7CiAgICAgICAgY29uc3QgeSA9IGF0dHJpYnV0ZS5nZXRZKGkpOwogICAgICAgIGNvbnN0IHogPSBhdHRyaWJ1dGUuZ2V0WihpKTsKICAgICAgICBpZiAoeCA8IG1pblgpCiAgICAgICAgICBtaW5YID0geDsKICAgICAgICBpZiAoeSA8IG1pblkpCiAgICAgICAgICBtaW5ZID0geTsKICAgICAgICBpZiAoeiA8IG1pblopCiAgICAgICAgICBtaW5aID0gejsKICAgICAgICBpZiAoeCA+IG1heFgpCiAgICAgICAgICBtYXhYID0geDsKICAgICAgICBpZiAoeSA+IG1heFkpCiAgICAgICAgICBtYXhZID0geTsKICAgICAgICBpZiAoeiA+IG1heFopCiAgICAgICAgICBtYXhaID0gejsKICAgICAgfQogICAgICB0aGlzLm1pbi5zZXQobWluWCwgbWluWSwgbWluWik7CiAgICAgIHRoaXMubWF4LnNldChtYXhYLCBtYXhZLCBtYXhaKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRGcm9tUG9pbnRzKHBvaW50cykgewogICAgICB0aGlzLm1ha2VFbXB0eSgpOwogICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBwb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgIHRoaXMuZXhwYW5kQnlQb2ludChwb2ludHNbaV0pOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0RnJvbUNlbnRlckFuZFNpemUoY2VudGVyLCBzaXplKSB7CiAgICAgIGNvbnN0IGhhbGZTaXplID0gX3ZlY3RvciRiLmNvcHkoc2l6ZSkubXVsdGlwbHlTY2FsYXIoMC41KTsKICAgICAgdGhpcy5taW4uY29weShjZW50ZXIpLnN1YihoYWxmU2l6ZSk7CiAgICAgIHRoaXMubWF4LmNvcHkoY2VudGVyKS5hZGQoaGFsZlNpemUpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21PYmplY3Qob2JqZWN0KSB7CiAgICAgIHRoaXMubWFrZUVtcHR5KCk7CiAgICAgIHJldHVybiB0aGlzLmV4cGFuZEJ5T2JqZWN0KG9iamVjdCk7CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKTsKICAgIH0KICAgIGNvcHkoYm94KSB7CiAgICAgIHRoaXMubWluLmNvcHkoYm94Lm1pbik7CiAgICAgIHRoaXMubWF4LmNvcHkoYm94Lm1heCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbWFrZUVtcHR5KCkgewogICAgICB0aGlzLm1pbi54ID0gdGhpcy5taW4ueSA9IHRoaXMubWluLnogPSBJbmZpbml0eTsKICAgICAgdGhpcy5tYXgueCA9IHRoaXMubWF4LnkgPSB0aGlzLm1heC56ID0gLUluZmluaXR5OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGlzRW1wdHkoKSB7CiAgICAgIHJldHVybiB0aGlzLm1heC54IDwgdGhpcy5taW4ueCB8fCB0aGlzLm1heC55IDwgdGhpcy5taW4ueSB8fCB0aGlzLm1heC56IDwgdGhpcy5taW4uejsKICAgIH0KICAgIGdldENlbnRlcih0YXJnZXQpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNFbXB0eSgpID8gdGFyZ2V0LnNldCgwLCAwLCAwKSA6IHRhcmdldC5hZGRWZWN0b3JzKHRoaXMubWluLCB0aGlzLm1heCkubXVsdGlwbHlTY2FsYXIoMC41KTsKICAgIH0KICAgIGdldFNpemUodGFyZ2V0KSB7CiAgICAgIHJldHVybiB0aGlzLmlzRW1wdHkoKSA/IHRhcmdldC5zZXQoMCwgMCwgMCkgOiB0YXJnZXQuc3ViVmVjdG9ycyh0aGlzLm1heCwgdGhpcy5taW4pOwogICAgfQogICAgZXhwYW5kQnlQb2ludChwb2ludCkgewogICAgICB0aGlzLm1pbi5taW4ocG9pbnQpOwogICAgICB0aGlzLm1heC5tYXgocG9pbnQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGV4cGFuZEJ5VmVjdG9yKHZlY3RvcikgewogICAgICB0aGlzLm1pbi5zdWIodmVjdG9yKTsKICAgICAgdGhpcy5tYXguYWRkKHZlY3Rvcik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZXhwYW5kQnlTY2FsYXIoc2NhbGFyKSB7CiAgICAgIHRoaXMubWluLmFkZFNjYWxhcigtc2NhbGFyKTsKICAgICAgdGhpcy5tYXguYWRkU2NhbGFyKHNjYWxhcik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZXhwYW5kQnlPYmplY3Qob2JqZWN0KSB7CiAgICAgIG9iamVjdC51cGRhdGVXb3JsZE1hdHJpeChmYWxzZSwgZmFsc2UpOwogICAgICBjb25zdCBnZW9tZXRyeSA9IG9iamVjdC5nZW9tZXRyeTsKICAgICAgaWYgKGdlb21ldHJ5ICE9PSB2b2lkIDApIHsKICAgICAgICBpZiAoZ2VvbWV0cnkuYm91bmRpbmdCb3ggPT09IG51bGwpIHsKICAgICAgICAgIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ0JveCgpOwogICAgICAgIH0KICAgICAgICBfYm94JDMuY29weShnZW9tZXRyeS5ib3VuZGluZ0JveCk7CiAgICAgICAgX2JveCQzLmFwcGx5TWF0cml4NChvYmplY3QubWF0cml4V29ybGQpOwogICAgICAgIHRoaXMudW5pb24oX2JveCQzKTsKICAgICAgfQogICAgICBjb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLmV4cGFuZEJ5T2JqZWN0KGNoaWxkcmVuW2ldKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvbnRhaW5zUG9pbnQocG9pbnQpIHsKICAgICAgcmV0dXJuIHBvaW50LnggPCB0aGlzLm1pbi54IHx8IHBvaW50LnggPiB0aGlzLm1heC54IHx8IHBvaW50LnkgPCB0aGlzLm1pbi55IHx8IHBvaW50LnkgPiB0aGlzLm1heC55IHx8IHBvaW50LnogPCB0aGlzLm1pbi56IHx8IHBvaW50LnogPiB0aGlzLm1heC56ID8gZmFsc2UgOiB0cnVlOwogICAgfQogICAgY29udGFpbnNCb3goYm94KSB7CiAgICAgIHJldHVybiB0aGlzLm1pbi54IDw9IGJveC5taW4ueCAmJiBib3gubWF4LnggPD0gdGhpcy5tYXgueCAmJiB0aGlzLm1pbi55IDw9IGJveC5taW4ueSAmJiBib3gubWF4LnkgPD0gdGhpcy5tYXgueSAmJiB0aGlzLm1pbi56IDw9IGJveC5taW4ueiAmJiBib3gubWF4LnogPD0gdGhpcy5tYXguejsKICAgIH0KICAgIGdldFBhcmFtZXRlcihwb2ludCwgdGFyZ2V0KSB7CiAgICAgIHJldHVybiB0YXJnZXQuc2V0KChwb2ludC54IC0gdGhpcy5taW4ueCkgLyAodGhpcy5tYXgueCAtIHRoaXMubWluLngpLCAocG9pbnQueSAtIHRoaXMubWluLnkpIC8gKHRoaXMubWF4LnkgLSB0aGlzLm1pbi55KSwgKHBvaW50LnogLSB0aGlzLm1pbi56KSAvICh0aGlzLm1heC56IC0gdGhpcy5taW4ueikpOwogICAgfQogICAgaW50ZXJzZWN0c0JveChib3gpIHsKICAgICAgcmV0dXJuIGJveC5tYXgueCA8IHRoaXMubWluLnggfHwgYm94Lm1pbi54ID4gdGhpcy5tYXgueCB8fCBib3gubWF4LnkgPCB0aGlzLm1pbi55IHx8IGJveC5taW4ueSA+IHRoaXMubWF4LnkgfHwgYm94Lm1heC56IDwgdGhpcy5taW4ueiB8fCBib3gubWluLnogPiB0aGlzLm1heC56ID8gZmFsc2UgOiB0cnVlOwogICAgfQogICAgaW50ZXJzZWN0c1NwaGVyZShzcGhlcmUpIHsKICAgICAgdGhpcy5jbGFtcFBvaW50KHNwaGVyZS5jZW50ZXIsIF92ZWN0b3IkYik7CiAgICAgIHJldHVybiBfdmVjdG9yJGIuZGlzdGFuY2VUb1NxdWFyZWQoc3BoZXJlLmNlbnRlcikgPD0gc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXM7CiAgICB9CiAgICBpbnRlcnNlY3RzUGxhbmUocGxhbmUpIHsKICAgICAgbGV0IG1pbiwgbWF4OwogICAgICBpZiAocGxhbmUubm9ybWFsLnggPiAwKSB7CiAgICAgICAgbWluID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1pbi54OwogICAgICAgIG1heCA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5tYXgueDsKICAgICAgfSBlbHNlIHsKICAgICAgICBtaW4gPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWF4Lng7CiAgICAgICAgbWF4ID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1pbi54OwogICAgICB9CiAgICAgIGlmIChwbGFuZS5ub3JtYWwueSA+IDApIHsKICAgICAgICBtaW4gKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1pbi55OwogICAgICAgIG1heCArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWF4Lnk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWluICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKICAgICAgICBtYXggKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1pbi55OwogICAgICB9CiAgICAgIGlmIChwbGFuZS5ub3JtYWwueiA+IDApIHsKICAgICAgICBtaW4gKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1pbi56OwogICAgICAgIG1heCArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWF4Lno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWluICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5tYXguejsKICAgICAgICBtYXggKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1pbi56OwogICAgICB9CiAgICAgIHJldHVybiBtaW4gPD0gLXBsYW5lLmNvbnN0YW50ICYmIG1heCA+PSAtcGxhbmUuY29uc3RhbnQ7CiAgICB9CiAgICBpbnRlcnNlY3RzVHJpYW5nbGUodHJpYW5nbGUpIHsKICAgICAgaWYgKHRoaXMuaXNFbXB0eSgpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHRoaXMuZ2V0Q2VudGVyKF9jZW50ZXIpOwogICAgICBfZXh0ZW50cy5zdWJWZWN0b3JzKHRoaXMubWF4LCBfY2VudGVyKTsKICAgICAgX3YwJDIuc3ViVmVjdG9ycyh0cmlhbmdsZS5hLCBfY2VudGVyKTsKICAgICAgX3YxJDcuc3ViVmVjdG9ycyh0cmlhbmdsZS5iLCBfY2VudGVyKTsKICAgICAgX3YyJDMuc3ViVmVjdG9ycyh0cmlhbmdsZS5jLCBfY2VudGVyKTsKICAgICAgX2YwLnN1YlZlY3RvcnMoX3YxJDcsIF92MCQyKTsKICAgICAgX2YxLnN1YlZlY3RvcnMoX3YyJDMsIF92MSQ3KTsKICAgICAgX2YyLnN1YlZlY3RvcnMoX3YwJDIsIF92MiQzKTsKICAgICAgbGV0IGF4ZXMgPSBbCiAgICAgICAgMCwKICAgICAgICAtX2YwLnosCiAgICAgICAgX2YwLnksCiAgICAgICAgMCwKICAgICAgICAtX2YxLnosCiAgICAgICAgX2YxLnksCiAgICAgICAgMCwKICAgICAgICAtX2YyLnosCiAgICAgICAgX2YyLnksCiAgICAgICAgX2YwLnosCiAgICAgICAgMCwKICAgICAgICAtX2YwLngsCiAgICAgICAgX2YxLnosCiAgICAgICAgMCwKICAgICAgICAtX2YxLngsCiAgICAgICAgX2YyLnosCiAgICAgICAgMCwKICAgICAgICAtX2YyLngsCiAgICAgICAgLV9mMC55LAogICAgICAgIF9mMC54LAogICAgICAgIDAsCiAgICAgICAgLV9mMS55LAogICAgICAgIF9mMS54LAogICAgICAgIDAsCiAgICAgICAgLV9mMi55LAogICAgICAgIF9mMi54LAogICAgICAgIDAKICAgICAgXTsKICAgICAgaWYgKCFzYXRGb3JBeGVzKGF4ZXMsIF92MCQyLCBfdjEkNywgX3YyJDMsIF9leHRlbnRzKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBheGVzID0gWzEsIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDFdOwogICAgICBpZiAoIXNhdEZvckF4ZXMoYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkMywgX2V4dGVudHMpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIF90cmlhbmdsZU5vcm1hbC5jcm9zc1ZlY3RvcnMoX2YwLCBfZjEpOwogICAgICBheGVzID0gW190cmlhbmdsZU5vcm1hbC54LCBfdHJpYW5nbGVOb3JtYWwueSwgX3RyaWFuZ2xlTm9ybWFsLnpdOwogICAgICByZXR1cm4gc2F0Rm9yQXhlcyhheGVzLCBfdjAkMiwgX3YxJDcsIF92MiQzLCBfZXh0ZW50cyk7CiAgICB9CiAgICBjbGFtcFBvaW50KHBvaW50LCB0YXJnZXQpIHsKICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KHBvaW50KS5jbGFtcCh0aGlzLm1pbiwgdGhpcy5tYXgpOwogICAgfQogICAgZGlzdGFuY2VUb1BvaW50KHBvaW50KSB7CiAgICAgIGNvbnN0IGNsYW1wZWRQb2ludCA9IF92ZWN0b3IkYi5jb3B5KHBvaW50KS5jbGFtcCh0aGlzLm1pbiwgdGhpcy5tYXgpOwogICAgICByZXR1cm4gY2xhbXBlZFBvaW50LnN1Yihwb2ludCkubGVuZ3RoKCk7CiAgICB9CiAgICBnZXRCb3VuZGluZ1NwaGVyZSh0YXJnZXQpIHsKICAgICAgdGhpcy5nZXRDZW50ZXIodGFyZ2V0LmNlbnRlcik7CiAgICAgIHRhcmdldC5yYWRpdXMgPSB0aGlzLmdldFNpemUoX3ZlY3RvciRiKS5sZW5ndGgoKSAqIDAuNTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGludGVyc2VjdChib3gpIHsKICAgICAgdGhpcy5taW4ubWF4KGJveC5taW4pOwogICAgICB0aGlzLm1heC5taW4oYm94Lm1heCk7CiAgICAgIGlmICh0aGlzLmlzRW1wdHkoKSkKICAgICAgICB0aGlzLm1ha2VFbXB0eSgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHVuaW9uKGJveCkgewogICAgICB0aGlzLm1pbi5taW4oYm94Lm1pbik7CiAgICAgIHRoaXMubWF4Lm1heChib3gubWF4KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBhcHBseU1hdHJpeDQobWF0cml4KSB7CiAgICAgIGlmICh0aGlzLmlzRW1wdHkoKSkKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgX3BvaW50c1swXS5zZXQodGhpcy5taW4ueCwgdGhpcy5taW4ueSwgdGhpcy5taW4ueikuYXBwbHlNYXRyaXg0KG1hdHJpeCk7CiAgICAgIF9wb2ludHNbMV0uc2V0KHRoaXMubWluLngsIHRoaXMubWluLnksIHRoaXMubWF4LnopLmFwcGx5TWF0cml4NChtYXRyaXgpOwogICAgICBfcG9pbnRzWzJdLnNldCh0aGlzLm1pbi54LCB0aGlzLm1heC55LCB0aGlzLm1pbi56KS5hcHBseU1hdHJpeDQobWF0cml4KTsKICAgICAgX3BvaW50c1szXS5zZXQodGhpcy5taW4ueCwgdGhpcy5tYXgueSwgdGhpcy5tYXgueikuYXBwbHlNYXRyaXg0KG1hdHJpeCk7CiAgICAgIF9wb2ludHNbNF0uc2V0KHRoaXMubWF4LngsIHRoaXMubWluLnksIHRoaXMubWluLnopLmFwcGx5TWF0cml4NChtYXRyaXgpOwogICAgICBfcG9pbnRzWzVdLnNldCh0aGlzLm1heC54LCB0aGlzLm1pbi55LCB0aGlzLm1heC56KS5hcHBseU1hdHJpeDQobWF0cml4KTsKICAgICAgX3BvaW50c1s2XS5zZXQodGhpcy5tYXgueCwgdGhpcy5tYXgueSwgdGhpcy5taW4ueikuYXBwbHlNYXRyaXg0KG1hdHJpeCk7CiAgICAgIF9wb2ludHNbN10uc2V0KHRoaXMubWF4LngsIHRoaXMubWF4LnksIHRoaXMubWF4LnopLmFwcGx5TWF0cml4NChtYXRyaXgpOwogICAgICB0aGlzLnNldEZyb21Qb2ludHMoX3BvaW50cyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdHJhbnNsYXRlKG9mZnNldCkgewogICAgICB0aGlzLm1pbi5hZGQob2Zmc2V0KTsKICAgICAgdGhpcy5tYXguYWRkKG9mZnNldCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZXF1YWxzKGJveCkgewogICAgICByZXR1cm4gYm94Lm1pbi5lcXVhbHModGhpcy5taW4pICYmIGJveC5tYXguZXF1YWxzKHRoaXMubWF4KTsKICAgIH0KICB9OwogIEJveDMucHJvdG90eXBlLmlzQm94MyA9IHRydWU7CiAgdmFyIF9wb2ludHMgPSBbCiAgICAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKSwKICAgIC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpLAogICAgLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCksCiAgICAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKSwKICAgIC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpLAogICAgLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCksCiAgICAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKSwKICAgIC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpCiAgXTsKICB2YXIgX3ZlY3RvciRiID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9ib3gkMyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgQm94MygpOwogIHZhciBfdjAkMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfdjEkNyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfdjIkMyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfZjAgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX2YxID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9mMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfY2VudGVyID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9leHRlbnRzID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF90cmlhbmdsZU5vcm1hbCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfdGVzdEF4aXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICBmdW5jdGlvbiBzYXRGb3JBeGVzKGF4ZXMsIHYwLCB2MSwgdjIsIGV4dGVudHMpIHsKICAgIGZvciAobGV0IGkgPSAwLCBqID0gYXhlcy5sZW5ndGggLSAzOyBpIDw9IGo7IGkgKz0gMykgewogICAgICBfdGVzdEF4aXMuZnJvbUFycmF5KGF4ZXMsIGkpOwogICAgICBjb25zdCByID0gZXh0ZW50cy54ICogTWF0aC5hYnMoX3Rlc3RBeGlzLngpICsgZXh0ZW50cy55ICogTWF0aC5hYnMoX3Rlc3RBeGlzLnkpICsgZXh0ZW50cy56ICogTWF0aC5hYnMoX3Rlc3RBeGlzLnopOwogICAgICBjb25zdCBwMCA9IHYwLmRvdChfdGVzdEF4aXMpOwogICAgICBjb25zdCBwMSA9IHYxLmRvdChfdGVzdEF4aXMpOwogICAgICBjb25zdCBwMiA9IHYyLmRvdChfdGVzdEF4aXMpOwogICAgICBpZiAoTWF0aC5tYXgoLU1hdGgubWF4KHAwLCBwMSwgcDIpLCBNYXRoLm1pbihwMCwgcDEsIHAyKSkgPiByKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgdmFyIF9ib3gkMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgQm94MygpOwogIHZhciBfdjEkNiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfdG9GYXJ0aGVzdFBvaW50ID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF90b1BvaW50ID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIFNwaGVyZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGNlbnRlciA9IG5ldyBWZWN0b3IzKCksIHJhZGl1cyA9IC0xKSB7CiAgICAgIHRoaXMuY2VudGVyID0gY2VudGVyOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1czsKICAgIH0KICAgIHNldChjZW50ZXIsIHJhZGl1cykgewogICAgICB0aGlzLmNlbnRlci5jb3B5KGNlbnRlcik7CiAgICAgIHRoaXMucmFkaXVzID0gcmFkaXVzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21Qb2ludHMocG9pbnRzLCBvcHRpb25hbENlbnRlcikgewogICAgICBjb25zdCBjZW50ZXIgPSB0aGlzLmNlbnRlcjsKICAgICAgaWYgKG9wdGlvbmFsQ2VudGVyICE9PSB2b2lkIDApIHsKICAgICAgICBjZW50ZXIuY29weShvcHRpb25hbENlbnRlcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX2JveCQyLnNldEZyb21Qb2ludHMocG9pbnRzKS5nZXRDZW50ZXIoY2VudGVyKTsKICAgICAgfQogICAgICBsZXQgbWF4UmFkaXVzU3EgPSAwOwogICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBwb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgIG1heFJhZGl1c1NxID0gTWF0aC5tYXgobWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZChwb2ludHNbaV0pKTsKICAgICAgfQogICAgICB0aGlzLnJhZGl1cyA9IE1hdGguc3FydChtYXhSYWRpdXNTcSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY29weShzcGhlcmUpIHsKICAgICAgdGhpcy5jZW50ZXIuY29weShzcGhlcmUuY2VudGVyKTsKICAgICAgdGhpcy5yYWRpdXMgPSBzcGhlcmUucmFkaXVzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGlzRW1wdHkoKSB7CiAgICAgIHJldHVybiB0aGlzLnJhZGl1cyA8IDA7CiAgICB9CiAgICBtYWtlRW1wdHkoKSB7CiAgICAgIHRoaXMuY2VudGVyLnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy5yYWRpdXMgPSAtMTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb250YWluc1BvaW50KHBvaW50KSB7CiAgICAgIHJldHVybiBwb2ludC5kaXN0YW5jZVRvU3F1YXJlZCh0aGlzLmNlbnRlcikgPD0gdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1czsKICAgIH0KICAgIGRpc3RhbmNlVG9Qb2ludChwb2ludCkgewogICAgICByZXR1cm4gcG9pbnQuZGlzdGFuY2VUbyh0aGlzLmNlbnRlcikgLSB0aGlzLnJhZGl1czsKICAgIH0KICAgIGludGVyc2VjdHNTcGhlcmUoc3BoZXJlKSB7CiAgICAgIGNvbnN0IHJhZGl1c1N1bSA9IHRoaXMucmFkaXVzICsgc3BoZXJlLnJhZGl1czsKICAgICAgcmV0dXJuIHNwaGVyZS5jZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQodGhpcy5jZW50ZXIpIDw9IHJhZGl1c1N1bSAqIHJhZGl1c1N1bTsKICAgIH0KICAgIGludGVyc2VjdHNCb3goYm94KSB7CiAgICAgIHJldHVybiBib3guaW50ZXJzZWN0c1NwaGVyZSh0aGlzKTsKICAgIH0KICAgIGludGVyc2VjdHNQbGFuZShwbGFuZSkgewogICAgICByZXR1cm4gTWF0aC5hYnMocGxhbmUuZGlzdGFuY2VUb1BvaW50KHRoaXMuY2VudGVyKSkgPD0gdGhpcy5yYWRpdXM7CiAgICB9CiAgICBjbGFtcFBvaW50KHBvaW50LCB0YXJnZXQpIHsKICAgICAgY29uc3QgZGVsdGFMZW5ndGhTcSA9IHRoaXMuY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKHBvaW50KTsKICAgICAgdGFyZ2V0LmNvcHkocG9pbnQpOwogICAgICBpZiAoZGVsdGFMZW5ndGhTcSA+IHRoaXMucmFkaXVzICogdGhpcy5yYWRpdXMpIHsKICAgICAgICB0YXJnZXQuc3ViKHRoaXMuY2VudGVyKS5ub3JtYWxpemUoKTsKICAgICAgICB0YXJnZXQubXVsdGlwbHlTY2FsYXIodGhpcy5yYWRpdXMpLmFkZCh0aGlzLmNlbnRlcik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGdldEJvdW5kaW5nQm94KHRhcmdldCkgewogICAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHsKICAgICAgICB0YXJnZXQubWFrZUVtcHR5KCk7CiAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgfQogICAgICB0YXJnZXQuc2V0KHRoaXMuY2VudGVyLCB0aGlzLmNlbnRlcik7CiAgICAgIHRhcmdldC5leHBhbmRCeVNjYWxhcih0aGlzLnJhZGl1cyk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICBhcHBseU1hdHJpeDQobWF0cml4KSB7CiAgICAgIHRoaXMuY2VudGVyLmFwcGx5TWF0cml4NChtYXRyaXgpOwogICAgICB0aGlzLnJhZGl1cyA9IHRoaXMucmFkaXVzICogbWF0cml4LmdldE1heFNjYWxlT25BeGlzKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdHJhbnNsYXRlKG9mZnNldCkgewogICAgICB0aGlzLmNlbnRlci5hZGQob2Zmc2V0KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBleHBhbmRCeVBvaW50KHBvaW50KSB7CiAgICAgIF90b1BvaW50LnN1YlZlY3RvcnMocG9pbnQsIHRoaXMuY2VudGVyKTsKICAgICAgY29uc3QgbGVuZ3RoU3EgPSBfdG9Qb2ludC5sZW5ndGhTcSgpOwogICAgICBpZiAobGVuZ3RoU3EgPiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzKSB7CiAgICAgICAgY29uc3QgbGVuZ3RoMiA9IE1hdGguc3FydChsZW5ndGhTcSk7CiAgICAgICAgY29uc3QgbWlzc2luZ1JhZGl1c0hhbGYgPSAobGVuZ3RoMiAtIHRoaXMucmFkaXVzKSAqIDAuNTsKICAgICAgICB0aGlzLmNlbnRlci5hZGQoX3RvUG9pbnQubXVsdGlwbHlTY2FsYXIobWlzc2luZ1JhZGl1c0hhbGYgLyBsZW5ndGgyKSk7CiAgICAgICAgdGhpcy5yYWRpdXMgKz0gbWlzc2luZ1JhZGl1c0hhbGY7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB1bmlvbihzcGhlcmUpIHsKICAgICAgX3RvRmFydGhlc3RQb2ludC5zdWJWZWN0b3JzKHNwaGVyZS5jZW50ZXIsIHRoaXMuY2VudGVyKS5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhcihzcGhlcmUucmFkaXVzKTsKICAgICAgdGhpcy5leHBhbmRCeVBvaW50KF92MSQ2LmNvcHkoc3BoZXJlLmNlbnRlcikuYWRkKF90b0ZhcnRoZXN0UG9pbnQpKTsKICAgICAgdGhpcy5leHBhbmRCeVBvaW50KF92MSQ2LmNvcHkoc3BoZXJlLmNlbnRlcikuc3ViKF90b0ZhcnRoZXN0UG9pbnQpKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBlcXVhbHMoc3BoZXJlKSB7CiAgICAgIHJldHVybiBzcGhlcmUuY2VudGVyLmVxdWFscyh0aGlzLmNlbnRlcikgJiYgc3BoZXJlLnJhZGl1cyA9PT0gdGhpcy5yYWRpdXM7CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKTsKICAgIH0KICB9OwogIHZhciBfdmVjdG9yJGEgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX3NlZ0NlbnRlciA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfc2VnRGlyID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9kaWZmID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9lZGdlMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfZWRnZTIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX25vcm1hbCQxID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIFJheSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKG9yaWdpbiA9IG5ldyBWZWN0b3IzKCksIGRpcmVjdGlvbiA9IG5ldyBWZWN0b3IzKDAsIDAsIC0xKSkgewogICAgICB0aGlzLm9yaWdpbiA9IG9yaWdpbjsKICAgICAgdGhpcy5kaXJlY3Rpb24gPSBkaXJlY3Rpb247CiAgICB9CiAgICBzZXQob3JpZ2luLCBkaXJlY3Rpb24pIHsKICAgICAgdGhpcy5vcmlnaW4uY29weShvcmlnaW4pOwogICAgICB0aGlzLmRpcmVjdGlvbi5jb3B5KGRpcmVjdGlvbik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY29weShyYXkpIHsKICAgICAgdGhpcy5vcmlnaW4uY29weShyYXkub3JpZ2luKTsKICAgICAgdGhpcy5kaXJlY3Rpb24uY29weShyYXkuZGlyZWN0aW9uKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBhdCh0LCB0YXJnZXQpIHsKICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KHRoaXMuZGlyZWN0aW9uKS5tdWx0aXBseVNjYWxhcih0KS5hZGQodGhpcy5vcmlnaW4pOwogICAgfQogICAgbG9va0F0KHYpIHsKICAgICAgdGhpcy5kaXJlY3Rpb24uY29weSh2KS5zdWIodGhpcy5vcmlnaW4pLm5vcm1hbGl6ZSgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHJlY2FzdCh0KSB7CiAgICAgIHRoaXMub3JpZ2luLmNvcHkodGhpcy5hdCh0LCBfdmVjdG9yJGEpKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbG9zZXN0UG9pbnRUb1BvaW50KHBvaW50LCB0YXJnZXQpIHsKICAgICAgdGFyZ2V0LnN1YlZlY3RvcnMocG9pbnQsIHRoaXMub3JpZ2luKTsKICAgICAgY29uc3QgZGlyZWN0aW9uRGlzdGFuY2UgPSB0YXJnZXQuZG90KHRoaXMuZGlyZWN0aW9uKTsKICAgICAgaWYgKGRpcmVjdGlvbkRpc3RhbmNlIDwgMCkgewogICAgICAgIHJldHVybiB0YXJnZXQuY29weSh0aGlzLm9yaWdpbik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KHRoaXMuZGlyZWN0aW9uKS5tdWx0aXBseVNjYWxhcihkaXJlY3Rpb25EaXN0YW5jZSkuYWRkKHRoaXMub3JpZ2luKTsKICAgIH0KICAgIGRpc3RhbmNlVG9Qb2ludChwb2ludCkgewogICAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMuZGlzdGFuY2VTcVRvUG9pbnQocG9pbnQpKTsKICAgIH0KICAgIGRpc3RhbmNlU3FUb1BvaW50KHBvaW50KSB7CiAgICAgIGNvbnN0IGRpcmVjdGlvbkRpc3RhbmNlID0gX3ZlY3RvciRhLnN1YlZlY3RvcnMocG9pbnQsIHRoaXMub3JpZ2luKS5kb3QodGhpcy5kaXJlY3Rpb24pOwogICAgICBpZiAoZGlyZWN0aW9uRGlzdGFuY2UgPCAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3JpZ2luLmRpc3RhbmNlVG9TcXVhcmVkKHBvaW50KTsKICAgICAgfQogICAgICBfdmVjdG9yJGEuY29weSh0aGlzLmRpcmVjdGlvbikubXVsdGlwbHlTY2FsYXIoZGlyZWN0aW9uRGlzdGFuY2UpLmFkZCh0aGlzLm9yaWdpbik7CiAgICAgIHJldHVybiBfdmVjdG9yJGEuZGlzdGFuY2VUb1NxdWFyZWQocG9pbnQpOwogICAgfQogICAgZGlzdGFuY2VTcVRvU2VnbWVudCh2MCwgdjEsIG9wdGlvbmFsUG9pbnRPblJheSwgb3B0aW9uYWxQb2ludE9uU2VnbWVudCkgewogICAgICBfc2VnQ2VudGVyLmNvcHkodjApLmFkZCh2MSkubXVsdGlwbHlTY2FsYXIoMC41KTsKICAgICAgX3NlZ0Rpci5jb3B5KHYxKS5zdWIodjApLm5vcm1hbGl6ZSgpOwogICAgICBfZGlmZi5jb3B5KHRoaXMub3JpZ2luKS5zdWIoX3NlZ0NlbnRlcik7CiAgICAgIGNvbnN0IHNlZ0V4dGVudCA9IHYwLmRpc3RhbmNlVG8odjEpICogMC41OwogICAgICBjb25zdCBhMDEgPSAtdGhpcy5kaXJlY3Rpb24uZG90KF9zZWdEaXIpOwogICAgICBjb25zdCBiMCA9IF9kaWZmLmRvdCh0aGlzLmRpcmVjdGlvbik7CiAgICAgIGNvbnN0IGIxID0gLV9kaWZmLmRvdChfc2VnRGlyKTsKICAgICAgY29uc3QgYyA9IF9kaWZmLmxlbmd0aFNxKCk7CiAgICAgIGNvbnN0IGRldCA9IE1hdGguYWJzKDEgLSBhMDEgKiBhMDEpOwogICAgICBsZXQgczAsIHMxLCBzcXJEaXN0LCBleHREZXQ7CiAgICAgIGlmIChkZXQgPiAwKSB7CiAgICAgICAgczAgPSBhMDEgKiBiMSAtIGIwOwogICAgICAgIHMxID0gYTAxICogYjAgLSBiMTsKICAgICAgICBleHREZXQgPSBzZWdFeHRlbnQgKiBkZXQ7CiAgICAgICAgaWYgKHMwID49IDApIHsKICAgICAgICAgIGlmIChzMSA+PSAtZXh0RGV0KSB7CiAgICAgICAgICAgIGlmIChzMSA8PSBleHREZXQpIHsKICAgICAgICAgICAgICBjb25zdCBpbnZEZXQgPSAxIC8gZGV0OwogICAgICAgICAgICAgIHMwICo9IGludkRldDsKICAgICAgICAgICAgICBzMSAqPSBpbnZEZXQ7CiAgICAgICAgICAgICAgc3FyRGlzdCA9IHMwICogKHMwICsgYTAxICogczEgKyAyICogYjApICsgczEgKiAoYTAxICogczAgKyBzMSArIDIgKiBiMSkgKyBjOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHMxID0gc2VnRXh0ZW50OwogICAgICAgICAgICAgIHMwID0gTWF0aC5tYXgoMCwgLShhMDEgKiBzMSArIGIwKSk7CiAgICAgICAgICAgICAgc3FyRGlzdCA9IC1zMCAqIHMwICsgczEgKiAoczEgKyAyICogYjEpICsgYzsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgczEgPSAtc2VnRXh0ZW50OwogICAgICAgICAgICBzMCA9IE1hdGgubWF4KDAsIC0oYTAxICogczEgKyBiMCkpOwogICAgICAgICAgICBzcXJEaXN0ID0gLXMwICogczAgKyBzMSAqIChzMSArIDIgKiBiMSkgKyBjOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoczEgPD0gLWV4dERldCkgewogICAgICAgICAgICBzMCA9IE1hdGgubWF4KDAsIC0oLWEwMSAqIHNlZ0V4dGVudCArIGIwKSk7CiAgICAgICAgICAgIHMxID0gczAgPiAwID8gLXNlZ0V4dGVudCA6IE1hdGgubWluKE1hdGgubWF4KC1zZWdFeHRlbnQsIC1iMSksIHNlZ0V4dGVudCk7CiAgICAgICAgICAgIHNxckRpc3QgPSAtczAgKiBzMCArIHMxICogKHMxICsgMiAqIGIxKSArIGM7CiAgICAgICAgICB9IGVsc2UgaWYgKHMxIDw9IGV4dERldCkgewogICAgICAgICAgICBzMCA9IDA7CiAgICAgICAgICAgIHMxID0gTWF0aC5taW4oTWF0aC5tYXgoLXNlZ0V4dGVudCwgLWIxKSwgc2VnRXh0ZW50KTsKICAgICAgICAgICAgc3FyRGlzdCA9IHMxICogKHMxICsgMiAqIGIxKSArIGM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzMCA9IE1hdGgubWF4KDAsIC0oYTAxICogc2VnRXh0ZW50ICsgYjApKTsKICAgICAgICAgICAgczEgPSBzMCA+IDAgPyBzZWdFeHRlbnQgOiBNYXRoLm1pbihNYXRoLm1heCgtc2VnRXh0ZW50LCAtYjEpLCBzZWdFeHRlbnQpOwogICAgICAgICAgICBzcXJEaXN0ID0gLXMwICogczAgKyBzMSAqIChzMSArIDIgKiBiMSkgKyBjOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzMSA9IGEwMSA+IDAgPyAtc2VnRXh0ZW50IDogc2VnRXh0ZW50OwogICAgICAgIHMwID0gTWF0aC5tYXgoMCwgLShhMDEgKiBzMSArIGIwKSk7CiAgICAgICAgc3FyRGlzdCA9IC1zMCAqIHMwICsgczEgKiAoczEgKyAyICogYjEpICsgYzsKICAgICAgfQogICAgICBpZiAob3B0aW9uYWxQb2ludE9uUmF5KSB7CiAgICAgICAgb3B0aW9uYWxQb2ludE9uUmF5LmNvcHkodGhpcy5kaXJlY3Rpb24pLm11bHRpcGx5U2NhbGFyKHMwKS5hZGQodGhpcy5vcmlnaW4pOwogICAgICB9CiAgICAgIGlmIChvcHRpb25hbFBvaW50T25TZWdtZW50KSB7CiAgICAgICAgb3B0aW9uYWxQb2ludE9uU2VnbWVudC5jb3B5KF9zZWdEaXIpLm11bHRpcGx5U2NhbGFyKHMxKS5hZGQoX3NlZ0NlbnRlcik7CiAgICAgIH0KICAgICAgcmV0dXJuIHNxckRpc3Q7CiAgICB9CiAgICBpbnRlcnNlY3RTcGhlcmUoc3BoZXJlLCB0YXJnZXQpIHsKICAgICAgX3ZlY3RvciRhLnN1YlZlY3RvcnMoc3BoZXJlLmNlbnRlciwgdGhpcy5vcmlnaW4pOwogICAgICBjb25zdCB0Y2EgPSBfdmVjdG9yJGEuZG90KHRoaXMuZGlyZWN0aW9uKTsKICAgICAgY29uc3QgZDIgPSBfdmVjdG9yJGEuZG90KF92ZWN0b3IkYSkgLSB0Y2EgKiB0Y2E7CiAgICAgIGNvbnN0IHJhZGl1czIgPSBzcGhlcmUucmFkaXVzICogc3BoZXJlLnJhZGl1czsKICAgICAgaWYgKGQyID4gcmFkaXVzMikKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgY29uc3QgdGhjID0gTWF0aC5zcXJ0KHJhZGl1czIgLSBkMik7CiAgICAgIGNvbnN0IHQwID0gdGNhIC0gdGhjOwogICAgICBjb25zdCB0MSA9IHRjYSArIHRoYzsKICAgICAgaWYgKHQwIDwgMCAmJiB0MSA8IDApCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIGlmICh0MCA8IDApCiAgICAgICAgcmV0dXJuIHRoaXMuYXQodDEsIHRhcmdldCk7CiAgICAgIHJldHVybiB0aGlzLmF0KHQwLCB0YXJnZXQpOwogICAgfQogICAgaW50ZXJzZWN0c1NwaGVyZShzcGhlcmUpIHsKICAgICAgcmV0dXJuIHRoaXMuZGlzdGFuY2VTcVRvUG9pbnQoc3BoZXJlLmNlbnRlcikgPD0gc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXM7CiAgICB9CiAgICBkaXN0YW5jZVRvUGxhbmUocGxhbmUpIHsKICAgICAgY29uc3QgZGVub21pbmF0b3IgPSBwbGFuZS5ub3JtYWwuZG90KHRoaXMuZGlyZWN0aW9uKTsKICAgICAgaWYgKGRlbm9taW5hdG9yID09PSAwKSB7CiAgICAgICAgaWYgKHBsYW5lLmRpc3RhbmNlVG9Qb2ludCh0aGlzLm9yaWdpbikgPT09IDApIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCB0ID0gLSh0aGlzLm9yaWdpbi5kb3QocGxhbmUubm9ybWFsKSArIHBsYW5lLmNvbnN0YW50KSAvIGRlbm9taW5hdG9yOwogICAgICByZXR1cm4gdCA+PSAwID8gdCA6IG51bGw7CiAgICB9CiAgICBpbnRlcnNlY3RQbGFuZShwbGFuZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHQgPSB0aGlzLmRpc3RhbmNlVG9QbGFuZShwbGFuZSk7CiAgICAgIGlmICh0ID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuYXQodCwgdGFyZ2V0KTsKICAgIH0KICAgIGludGVyc2VjdHNQbGFuZShwbGFuZSkgewogICAgICBjb25zdCBkaXN0VG9Qb2ludCA9IHBsYW5lLmRpc3RhbmNlVG9Qb2ludCh0aGlzLm9yaWdpbik7CiAgICAgIGlmIChkaXN0VG9Qb2ludCA9PT0gMCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGNvbnN0IGRlbm9taW5hdG9yID0gcGxhbmUubm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbik7CiAgICAgIGlmIChkZW5vbWluYXRvciAqIGRpc3RUb1BvaW50IDwgMCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGludGVyc2VjdEJveChib3gsIHRhcmdldCkgewogICAgICBsZXQgdG1pbiwgdG1heCwgdHltaW4sIHR5bWF4LCB0em1pbiwgdHptYXg7CiAgICAgIGNvbnN0IGludmRpcnggPSAxIC8gdGhpcy5kaXJlY3Rpb24ueCwgaW52ZGlyeSA9IDEgLyB0aGlzLmRpcmVjdGlvbi55LCBpbnZkaXJ6ID0gMSAvIHRoaXMuZGlyZWN0aW9uLno7CiAgICAgIGNvbnN0IG9yaWdpbiA9IHRoaXMub3JpZ2luOwogICAgICBpZiAoaW52ZGlyeCA+PSAwKSB7CiAgICAgICAgdG1pbiA9IChib3gubWluLnggLSBvcmlnaW4ueCkgKiBpbnZkaXJ4OwogICAgICAgIHRtYXggPSAoYm94Lm1heC54IC0gb3JpZ2luLngpICogaW52ZGlyeDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0bWluID0gKGJveC5tYXgueCAtIG9yaWdpbi54KSAqIGludmRpcng7CiAgICAgICAgdG1heCA9IChib3gubWluLnggLSBvcmlnaW4ueCkgKiBpbnZkaXJ4OwogICAgICB9CiAgICAgIGlmIChpbnZkaXJ5ID49IDApIHsKICAgICAgICB0eW1pbiA9IChib3gubWluLnkgLSBvcmlnaW4ueSkgKiBpbnZkaXJ5OwogICAgICAgIHR5bWF4ID0gKGJveC5tYXgueSAtIG9yaWdpbi55KSAqIGludmRpcnk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdHltaW4gPSAoYm94Lm1heC55IC0gb3JpZ2luLnkpICogaW52ZGlyeTsKICAgICAgICB0eW1heCA9IChib3gubWluLnkgLSBvcmlnaW4ueSkgKiBpbnZkaXJ5OwogICAgICB9CiAgICAgIGlmICh0bWluID4gdHltYXggfHwgdHltaW4gPiB0bWF4KQogICAgICAgIHJldHVybiBudWxsOwogICAgICBpZiAodHltaW4gPiB0bWluIHx8IHRtaW4gIT09IHRtaW4pCiAgICAgICAgdG1pbiA9IHR5bWluOwogICAgICBpZiAodHltYXggPCB0bWF4IHx8IHRtYXggIT09IHRtYXgpCiAgICAgICAgdG1heCA9IHR5bWF4OwogICAgICBpZiAoaW52ZGlyeiA+PSAwKSB7CiAgICAgICAgdHptaW4gPSAoYm94Lm1pbi56IC0gb3JpZ2luLnopICogaW52ZGlyejsKICAgICAgICB0em1heCA9IChib3gubWF4LnogLSBvcmlnaW4ueikgKiBpbnZkaXJ6OwogICAgICB9IGVsc2UgewogICAgICAgIHR6bWluID0gKGJveC5tYXgueiAtIG9yaWdpbi56KSAqIGludmRpcno7CiAgICAgICAgdHptYXggPSAoYm94Lm1pbi56IC0gb3JpZ2luLnopICogaW52ZGlyejsKICAgICAgfQogICAgICBpZiAodG1pbiA+IHR6bWF4IHx8IHR6bWluID4gdG1heCkKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgaWYgKHR6bWluID4gdG1pbiB8fCB0bWluICE9PSB0bWluKQogICAgICAgIHRtaW4gPSB0em1pbjsKICAgICAgaWYgKHR6bWF4IDwgdG1heCB8fCB0bWF4ICE9PSB0bWF4KQogICAgICAgIHRtYXggPSB0em1heDsKICAgICAgaWYgKHRtYXggPCAwKQogICAgICAgIHJldHVybiBudWxsOwogICAgICByZXR1cm4gdGhpcy5hdCh0bWluID49IDAgPyB0bWluIDogdG1heCwgdGFyZ2V0KTsKICAgIH0KICAgIGludGVyc2VjdHNCb3goYm94KSB7CiAgICAgIHJldHVybiB0aGlzLmludGVyc2VjdEJveChib3gsIF92ZWN0b3IkYSkgIT09IG51bGw7CiAgICB9CiAgICBpbnRlcnNlY3RUcmlhbmdsZShhLCBiLCBjLCBiYWNrZmFjZUN1bGxpbmcsIHRhcmdldCkgewogICAgICBfZWRnZTEuc3ViVmVjdG9ycyhiLCBhKTsKICAgICAgX2VkZ2UyLnN1YlZlY3RvcnMoYywgYSk7CiAgICAgIF9ub3JtYWwkMS5jcm9zc1ZlY3RvcnMoX2VkZ2UxLCBfZWRnZTIpOwogICAgICBsZXQgRGROID0gdGhpcy5kaXJlY3Rpb24uZG90KF9ub3JtYWwkMSk7CiAgICAgIGxldCBzaWduMjsKICAgICAgaWYgKERkTiA+IDApIHsKICAgICAgICBpZiAoYmFja2ZhY2VDdWxsaW5nKQogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgc2lnbjIgPSAxOwogICAgICB9IGVsc2UgaWYgKERkTiA8IDApIHsKICAgICAgICBzaWduMiA9IC0xOwogICAgICAgIERkTiA9IC1EZE47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgX2RpZmYuc3ViVmVjdG9ycyh0aGlzLm9yaWdpbiwgYSk7CiAgICAgIGNvbnN0IERkUXhFMiA9IHNpZ24yICogdGhpcy5kaXJlY3Rpb24uZG90KF9lZGdlMi5jcm9zc1ZlY3RvcnMoX2RpZmYsIF9lZGdlMikpOwogICAgICBpZiAoRGRReEUyIDwgMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IERkRTF4USA9IHNpZ24yICogdGhpcy5kaXJlY3Rpb24uZG90KF9lZGdlMS5jcm9zcyhfZGlmZikpOwogICAgICBpZiAoRGRFMXhRIDwgMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGlmIChEZFF4RTIgKyBEZEUxeFEgPiBEZE4pIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBRZE4gPSAtc2lnbjIgKiBfZGlmZi5kb3QoX25vcm1hbCQxKTsKICAgICAgaWYgKFFkTiA8IDApIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5hdChRZE4gLyBEZE4sIHRhcmdldCk7CiAgICB9CiAgICBhcHBseU1hdHJpeDQobWF0cml4NCkgewogICAgICB0aGlzLm9yaWdpbi5hcHBseU1hdHJpeDQobWF0cml4NCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbihtYXRyaXg0KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBlcXVhbHMocmF5KSB7CiAgICAgIHJldHVybiByYXkub3JpZ2luLmVxdWFscyh0aGlzLm9yaWdpbikgJiYgcmF5LmRpcmVjdGlvbi5lcXVhbHModGhpcy5kaXJlY3Rpb24pOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyk7CiAgICB9CiAgfTsKICB2YXIgTWF0cml4NCA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmVsZW1lbnRzID0gWwogICAgICAgIDEsCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICAxLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMSwKICAgICAgICAwLAogICAgICAgIDAsCiAgICAgICAgMCwKICAgICAgICAwLAogICAgICAgIDEKICAgICAgXTsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuTWF0cml4NDogdGhlIGNvbnN0cnVjdG9yIG5vIGxvbmdlciByZWFkcyBhcmd1bWVudHMuIHVzZSAuc2V0KCkgaW5zdGVhZC4iKTsKICAgICAgfQogICAgfQogICAgc2V0KG4xMSwgbjEyLCBuMTMsIG4xNCwgbjIxLCBuMjIsIG4yMywgbjI0LCBuMzEsIG4zMiwgbjMzLCBuMzQsIG40MSwgbjQyLCBuNDMsIG40NCkgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIHRlWzBdID0gbjExOwogICAgICB0ZVs0XSA9IG4xMjsKICAgICAgdGVbOF0gPSBuMTM7CiAgICAgIHRlWzEyXSA9IG4xNDsKICAgICAgdGVbMV0gPSBuMjE7CiAgICAgIHRlWzVdID0gbjIyOwogICAgICB0ZVs5XSA9IG4yMzsKICAgICAgdGVbMTNdID0gbjI0OwogICAgICB0ZVsyXSA9IG4zMTsKICAgICAgdGVbNl0gPSBuMzI7CiAgICAgIHRlWzEwXSA9IG4zMzsKICAgICAgdGVbMTRdID0gbjM0OwogICAgICB0ZVszXSA9IG40MTsKICAgICAgdGVbN10gPSBuNDI7CiAgICAgIHRlWzExXSA9IG40MzsKICAgICAgdGVbMTVdID0gbjQ0OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGlkZW50aXR5KCkgewogICAgICB0aGlzLnNldCgxLCAwLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAxKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyBNYXRyaXg0KCkuZnJvbUFycmF5KHRoaXMuZWxlbWVudHMpOwogICAgfQogICAgY29weShtKSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgbWUgPSBtLmVsZW1lbnRzOwogICAgICB0ZVswXSA9IG1lWzBdOwogICAgICB0ZVsxXSA9IG1lWzFdOwogICAgICB0ZVsyXSA9IG1lWzJdOwogICAgICB0ZVszXSA9IG1lWzNdOwogICAgICB0ZVs0XSA9IG1lWzRdOwogICAgICB0ZVs1XSA9IG1lWzVdOwogICAgICB0ZVs2XSA9IG1lWzZdOwogICAgICB0ZVs3XSA9IG1lWzddOwogICAgICB0ZVs4XSA9IG1lWzhdOwogICAgICB0ZVs5XSA9IG1lWzldOwogICAgICB0ZVsxMF0gPSBtZVsxMF07CiAgICAgIHRlWzExXSA9IG1lWzExXTsKICAgICAgdGVbMTJdID0gbWVbMTJdOwogICAgICB0ZVsxM10gPSBtZVsxM107CiAgICAgIHRlWzE0XSA9IG1lWzE0XTsKICAgICAgdGVbMTVdID0gbWVbMTVdOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvcHlQb3NpdGlvbihtKSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50cywgbWUgPSBtLmVsZW1lbnRzOwogICAgICB0ZVsxMl0gPSBtZVsxMl07CiAgICAgIHRlWzEzXSA9IG1lWzEzXTsKICAgICAgdGVbMTRdID0gbWVbMTRdOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21NYXRyaXgzKG0pIHsKICAgICAgY29uc3QgbWUgPSBtLmVsZW1lbnRzOwogICAgICB0aGlzLnNldChtZVswXSwgbWVbM10sIG1lWzZdLCAwLCBtZVsxXSwgbWVbNF0sIG1lWzddLCAwLCBtZVsyXSwgbWVbNV0sIG1lWzhdLCAwLCAwLCAwLCAwLCAxKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBleHRyYWN0QmFzaXMoeEF4aXMsIHlBeGlzLCB6QXhpcykgewogICAgICB4QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKHRoaXMsIDApOwogICAgICB5QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKHRoaXMsIDEpOwogICAgICB6QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKHRoaXMsIDIpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG1ha2VCYXNpcyh4QXhpcywgeUF4aXMsIHpBeGlzKSB7CiAgICAgIHRoaXMuc2V0KHhBeGlzLngsIHlBeGlzLngsIHpBeGlzLngsIDAsIHhBeGlzLnksIHlBeGlzLnksIHpBeGlzLnksIDAsIHhBeGlzLnosIHlBeGlzLnosIHpBeGlzLnosIDAsIDAsIDAsIDAsIDEpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGV4dHJhY3RSb3RhdGlvbihtKSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgbWUgPSBtLmVsZW1lbnRzOwogICAgICBjb25zdCBzY2FsZVggPSAxIC8gX3YxJDUuc2V0RnJvbU1hdHJpeENvbHVtbihtLCAwKS5sZW5ndGgoKTsKICAgICAgY29uc3Qgc2NhbGVZID0gMSAvIF92MSQ1LnNldEZyb21NYXRyaXhDb2x1bW4obSwgMSkubGVuZ3RoKCk7CiAgICAgIGNvbnN0IHNjYWxlWiA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKG0sIDIpLmxlbmd0aCgpOwogICAgICB0ZVswXSA9IG1lWzBdICogc2NhbGVYOwogICAgICB0ZVsxXSA9IG1lWzFdICogc2NhbGVYOwogICAgICB0ZVsyXSA9IG1lWzJdICogc2NhbGVYOwogICAgICB0ZVszXSA9IDA7CiAgICAgIHRlWzRdID0gbWVbNF0gKiBzY2FsZVk7CiAgICAgIHRlWzVdID0gbWVbNV0gKiBzY2FsZVk7CiAgICAgIHRlWzZdID0gbWVbNl0gKiBzY2FsZVk7CiAgICAgIHRlWzddID0gMDsKICAgICAgdGVbOF0gPSBtZVs4XSAqIHNjYWxlWjsKICAgICAgdGVbOV0gPSBtZVs5XSAqIHNjYWxlWjsKICAgICAgdGVbMTBdID0gbWVbMTBdICogc2NhbGVaOwogICAgICB0ZVsxMV0gPSAwOwogICAgICB0ZVsxMl0gPSAwOwogICAgICB0ZVsxM10gPSAwOwogICAgICB0ZVsxNF0gPSAwOwogICAgICB0ZVsxNV0gPSAxOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG1ha2VSb3RhdGlvbkZyb21FdWxlcihldWxlcikgewogICAgICBpZiAoIShldWxlciAmJiBldWxlci5pc0V1bGVyKSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLk1hdHJpeDQ6IC5tYWtlUm90YXRpb25Gcm9tRXVsZXIoKSBub3cgZXhwZWN0cyBhIEV1bGVyIHJvdGF0aW9uIHJhdGhlciB0aGFuIGEgVmVjdG9yMyBhbmQgb3JkZXIuIik7CiAgICAgIH0KICAgICAgY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB4ID0gZXVsZXIueCwgeSA9IGV1bGVyLnksIHogPSBldWxlci56OwogICAgICBjb25zdCBhID0gTWF0aC5jb3MoeCksIGIgPSBNYXRoLnNpbih4KTsKICAgICAgY29uc3QgYyA9IE1hdGguY29zKHkpLCBkID0gTWF0aC5zaW4oeSk7CiAgICAgIGNvbnN0IGUgPSBNYXRoLmNvcyh6KSwgZiA9IE1hdGguc2luKHopOwogICAgICBpZiAoZXVsZXIub3JkZXIgPT09ICJYWVoiKSB7CiAgICAgICAgY29uc3QgYWUgPSBhICogZSwgYWYgPSBhICogZiwgYmUgPSBiICogZSwgYmYgPSBiICogZjsKICAgICAgICB0ZVswXSA9IGMgKiBlOwogICAgICAgIHRlWzRdID0gLWMgKiBmOwogICAgICAgIHRlWzhdID0gZDsKICAgICAgICB0ZVsxXSA9IGFmICsgYmUgKiBkOwogICAgICAgIHRlWzVdID0gYWUgLSBiZiAqIGQ7CiAgICAgICAgdGVbOV0gPSAtYiAqIGM7CiAgICAgICAgdGVbMl0gPSBiZiAtIGFlICogZDsKICAgICAgICB0ZVs2XSA9IGJlICsgYWYgKiBkOwogICAgICAgIHRlWzEwXSA9IGEgKiBjOwogICAgICB9IGVsc2UgaWYgKGV1bGVyLm9yZGVyID09PSAiWVhaIikgewogICAgICAgIGNvbnN0IGNlID0gYyAqIGUsIGNmID0gYyAqIGYsIGRlID0gZCAqIGUsIGRmID0gZCAqIGY7CiAgICAgICAgdGVbMF0gPSBjZSArIGRmICogYjsKICAgICAgICB0ZVs0XSA9IGRlICogYiAtIGNmOwogICAgICAgIHRlWzhdID0gYSAqIGQ7CiAgICAgICAgdGVbMV0gPSBhICogZjsKICAgICAgICB0ZVs1XSA9IGEgKiBlOwogICAgICAgIHRlWzldID0gLWI7CiAgICAgICAgdGVbMl0gPSBjZiAqIGIgLSBkZTsKICAgICAgICB0ZVs2XSA9IGRmICsgY2UgKiBiOwogICAgICAgIHRlWzEwXSA9IGEgKiBjOwogICAgICB9IGVsc2UgaWYgKGV1bGVyLm9yZGVyID09PSAiWlhZIikgewogICAgICAgIGNvbnN0IGNlID0gYyAqIGUsIGNmID0gYyAqIGYsIGRlID0gZCAqIGUsIGRmID0gZCAqIGY7CiAgICAgICAgdGVbMF0gPSBjZSAtIGRmICogYjsKICAgICAgICB0ZVs0XSA9IC1hICogZjsKICAgICAgICB0ZVs4XSA9IGRlICsgY2YgKiBiOwogICAgICAgIHRlWzFdID0gY2YgKyBkZSAqIGI7CiAgICAgICAgdGVbNV0gPSBhICogZTsKICAgICAgICB0ZVs5XSA9IGRmIC0gY2UgKiBiOwogICAgICAgIHRlWzJdID0gLWEgKiBkOwogICAgICAgIHRlWzZdID0gYjsKICAgICAgICB0ZVsxMF0gPSBhICogYzsKICAgICAgfSBlbHNlIGlmIChldWxlci5vcmRlciA9PT0gIlpZWCIpIHsKICAgICAgICBjb25zdCBhZSA9IGEgKiBlLCBhZiA9IGEgKiBmLCBiZSA9IGIgKiBlLCBiZiA9IGIgKiBmOwogICAgICAgIHRlWzBdID0gYyAqIGU7CiAgICAgICAgdGVbNF0gPSBiZSAqIGQgLSBhZjsKICAgICAgICB0ZVs4XSA9IGFlICogZCArIGJmOwogICAgICAgIHRlWzFdID0gYyAqIGY7CiAgICAgICAgdGVbNV0gPSBiZiAqIGQgKyBhZTsKICAgICAgICB0ZVs5XSA9IGFmICogZCAtIGJlOwogICAgICAgIHRlWzJdID0gLWQ7CiAgICAgICAgdGVbNl0gPSBiICogYzsKICAgICAgICB0ZVsxMF0gPSBhICogYzsKICAgICAgfSBlbHNlIGlmIChldWxlci5vcmRlciA9PT0gIllaWCIpIHsKICAgICAgICBjb25zdCBhYyA9IGEgKiBjLCBhZCA9IGEgKiBkLCBiYyA9IGIgKiBjLCBiZCA9IGIgKiBkOwogICAgICAgIHRlWzBdID0gYyAqIGU7CiAgICAgICAgdGVbNF0gPSBiZCAtIGFjICogZjsKICAgICAgICB0ZVs4XSA9IGJjICogZiArIGFkOwogICAgICAgIHRlWzFdID0gZjsKICAgICAgICB0ZVs1XSA9IGEgKiBlOwogICAgICAgIHRlWzldID0gLWIgKiBlOwogICAgICAgIHRlWzJdID0gLWQgKiBlOwogICAgICAgIHRlWzZdID0gYWQgKiBmICsgYmM7CiAgICAgICAgdGVbMTBdID0gYWMgLSBiZCAqIGY7CiAgICAgIH0gZWxzZSBpZiAoZXVsZXIub3JkZXIgPT09ICJYWlkiKSB7CiAgICAgICAgY29uc3QgYWMgPSBhICogYywgYWQgPSBhICogZCwgYmMgPSBiICogYywgYmQgPSBiICogZDsKICAgICAgICB0ZVswXSA9IGMgKiBlOwogICAgICAgIHRlWzRdID0gLWY7CiAgICAgICAgdGVbOF0gPSBkICogZTsKICAgICAgICB0ZVsxXSA9IGFjICogZiArIGJkOwogICAgICAgIHRlWzVdID0gYSAqIGU7CiAgICAgICAgdGVbOV0gPSBhZCAqIGYgLSBiYzsKICAgICAgICB0ZVsyXSA9IGJjICogZiAtIGFkOwogICAgICAgIHRlWzZdID0gYiAqIGU7CiAgICAgICAgdGVbMTBdID0gYmQgKiBmICsgYWM7CiAgICAgIH0KICAgICAgdGVbM10gPSAwOwogICAgICB0ZVs3XSA9IDA7CiAgICAgIHRlWzExXSA9IDA7CiAgICAgIHRlWzEyXSA9IDA7CiAgICAgIHRlWzEzXSA9IDA7CiAgICAgIHRlWzE0XSA9IDA7CiAgICAgIHRlWzE1XSA9IDE7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICByZXR1cm4gdGhpcy5jb21wb3NlKF96ZXJvLCBxLCBfb25lKTsKICAgIH0KICAgIGxvb2tBdChleWUsIHRhcmdldCwgdXApIHsKICAgICAgY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBfei5zdWJWZWN0b3JzKGV5ZSwgdGFyZ2V0KTsKICAgICAgaWYgKF96Lmxlbmd0aFNxKCkgPT09IDApIHsKICAgICAgICBfei56ID0gMTsKICAgICAgfQogICAgICBfei5ub3JtYWxpemUoKTsKICAgICAgX3guY3Jvc3NWZWN0b3JzKHVwLCBfeik7CiAgICAgIGlmIChfeC5sZW5ndGhTcSgpID09PSAwKSB7CiAgICAgICAgaWYgKE1hdGguYWJzKHVwLnopID09PSAxKSB7CiAgICAgICAgICBfei54ICs9IDFlLTQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF96LnogKz0gMWUtNDsKICAgICAgICB9CiAgICAgICAgX3oubm9ybWFsaXplKCk7CiAgICAgICAgX3guY3Jvc3NWZWN0b3JzKHVwLCBfeik7CiAgICAgIH0KICAgICAgX3gubm9ybWFsaXplKCk7CiAgICAgIF95LmNyb3NzVmVjdG9ycyhfeiwgX3gpOwogICAgICB0ZVswXSA9IF94Lng7CiAgICAgIHRlWzRdID0gX3kueDsKICAgICAgdGVbOF0gPSBfei54OwogICAgICB0ZVsxXSA9IF94Lnk7CiAgICAgIHRlWzVdID0gX3kueTsKICAgICAgdGVbOV0gPSBfei55OwogICAgICB0ZVsyXSA9IF94Lno7CiAgICAgIHRlWzZdID0gX3kuejsKICAgICAgdGVbMTBdID0gX3ouejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtdWx0aXBseShtLCBuKSB7CiAgICAgIGlmIChuICE9PSB2b2lkIDApIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdHJpeDQ6IC5tdWx0aXBseSgpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLm11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSBpbnN0ZWFkLiIpOwogICAgICAgIHJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMobSwgbik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyh0aGlzLCBtKTsKICAgIH0KICAgIHByZW11bHRpcGx5KG0pIHsKICAgICAgcmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyhtLCB0aGlzKTsKICAgIH0KICAgIG11bHRpcGx5TWF0cmljZXMoYSwgYikgewogICAgICBjb25zdCBhZSA9IGEuZWxlbWVudHM7CiAgICAgIGNvbnN0IGJlID0gYi5lbGVtZW50czsKICAgICAgY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCBhMTEgPSBhZVswXSwgYTEyID0gYWVbNF0sIGExMyA9IGFlWzhdLCBhMTQgPSBhZVsxMl07CiAgICAgIGNvbnN0IGEyMSA9IGFlWzFdLCBhMjIgPSBhZVs1XSwgYTIzID0gYWVbOV0sIGEyNCA9IGFlWzEzXTsKICAgICAgY29uc3QgYTMxID0gYWVbMl0sIGEzMiA9IGFlWzZdLCBhMzMgPSBhZVsxMF0sIGEzNCA9IGFlWzE0XTsKICAgICAgY29uc3QgYTQxID0gYWVbM10sIGE0MiA9IGFlWzddLCBhNDMgPSBhZVsxMV0sIGE0NCA9IGFlWzE1XTsKICAgICAgY29uc3QgYjExID0gYmVbMF0sIGIxMiA9IGJlWzRdLCBiMTMgPSBiZVs4XSwgYjE0ID0gYmVbMTJdOwogICAgICBjb25zdCBiMjEgPSBiZVsxXSwgYjIyID0gYmVbNV0sIGIyMyA9IGJlWzldLCBiMjQgPSBiZVsxM107CiAgICAgIGNvbnN0IGIzMSA9IGJlWzJdLCBiMzIgPSBiZVs2XSwgYjMzID0gYmVbMTBdLCBiMzQgPSBiZVsxNF07CiAgICAgIGNvbnN0IGI0MSA9IGJlWzNdLCBiNDIgPSBiZVs3XSwgYjQzID0gYmVbMTFdLCBiNDQgPSBiZVsxNV07CiAgICAgIHRlWzBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxICsgYTE0ICogYjQxOwogICAgICB0ZVs0XSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMiArIGExNCAqIGI0MjsKICAgICAgdGVbOF0gPSBhMTEgKiBiMTMgKyBhMTIgKiBiMjMgKyBhMTMgKiBiMzMgKyBhMTQgKiBiNDM7CiAgICAgIHRlWzEyXSA9IGExMSAqIGIxNCArIGExMiAqIGIyNCArIGExMyAqIGIzNCArIGExNCAqIGI0NDsKICAgICAgdGVbMV0gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzEgKyBhMjQgKiBiNDE7CiAgICAgIHRlWzVdID0gYTIxICogYjEyICsgYTIyICogYjIyICsgYTIzICogYjMyICsgYTI0ICogYjQyOwogICAgICB0ZVs5XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMyArIGEyNCAqIGI0MzsKICAgICAgdGVbMTNdID0gYTIxICogYjE0ICsgYTIyICogYjI0ICsgYTIzICogYjM0ICsgYTI0ICogYjQ0OwogICAgICB0ZVsyXSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMSArIGEzNCAqIGI0MTsKICAgICAgdGVbNl0gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzIgKyBhMzQgKiBiNDI7CiAgICAgIHRlWzEwXSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMyArIGEzNCAqIGI0MzsKICAgICAgdGVbMTRdID0gYTMxICogYjE0ICsgYTMyICogYjI0ICsgYTMzICogYjM0ICsgYTM0ICogYjQ0OwogICAgICB0ZVszXSA9IGE0MSAqIGIxMSArIGE0MiAqIGIyMSArIGE0MyAqIGIzMSArIGE0NCAqIGI0MTsKICAgICAgdGVbN10gPSBhNDEgKiBiMTIgKyBhNDIgKiBiMjIgKyBhNDMgKiBiMzIgKyBhNDQgKiBiNDI7CiAgICAgIHRlWzExXSA9IGE0MSAqIGIxMyArIGE0MiAqIGIyMyArIGE0MyAqIGIzMyArIGE0NCAqIGI0MzsKICAgICAgdGVbMTVdID0gYTQxICogYjE0ICsgYTQyICogYjI0ICsgYTQzICogYjM0ICsgYTQ0ICogYjQ0OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG11bHRpcGx5U2NhbGFyKHMpIHsKICAgICAgY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICB0ZVswXSAqPSBzOwogICAgICB0ZVs0XSAqPSBzOwogICAgICB0ZVs4XSAqPSBzOwogICAgICB0ZVsxMl0gKj0gczsKICAgICAgdGVbMV0gKj0gczsKICAgICAgdGVbNV0gKj0gczsKICAgICAgdGVbOV0gKj0gczsKICAgICAgdGVbMTNdICo9IHM7CiAgICAgIHRlWzJdICo9IHM7CiAgICAgIHRlWzZdICo9IHM7CiAgICAgIHRlWzEwXSAqPSBzOwogICAgICB0ZVsxNF0gKj0gczsKICAgICAgdGVbM10gKj0gczsKICAgICAgdGVbN10gKj0gczsKICAgICAgdGVbMTFdICo9IHM7CiAgICAgIHRlWzE1XSAqPSBzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGRldGVybWluYW50KCkgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IG4xMSA9IHRlWzBdLCBuMTIgPSB0ZVs0XSwgbjEzID0gdGVbOF0sIG4xNCA9IHRlWzEyXTsKICAgICAgY29uc3QgbjIxID0gdGVbMV0sIG4yMiA9IHRlWzVdLCBuMjMgPSB0ZVs5XSwgbjI0ID0gdGVbMTNdOwogICAgICBjb25zdCBuMzEgPSB0ZVsyXSwgbjMyID0gdGVbNl0sIG4zMyA9IHRlWzEwXSwgbjM0ID0gdGVbMTRdOwogICAgICBjb25zdCBuNDEgPSB0ZVszXSwgbjQyID0gdGVbN10sIG40MyA9IHRlWzExXSwgbjQ0ID0gdGVbMTVdOwogICAgICByZXR1cm4gbjQxICogKCtuMTQgKiBuMjMgKiBuMzIgLSBuMTMgKiBuMjQgKiBuMzIgLSBuMTQgKiBuMjIgKiBuMzMgKyBuMTIgKiBuMjQgKiBuMzMgKyBuMTMgKiBuMjIgKiBuMzQgLSBuMTIgKiBuMjMgKiBuMzQpICsgbjQyICogKCtuMTEgKiBuMjMgKiBuMzQgLSBuMTEgKiBuMjQgKiBuMzMgKyBuMTQgKiBuMjEgKiBuMzMgLSBuMTMgKiBuMjEgKiBuMzQgKyBuMTMgKiBuMjQgKiBuMzEgLSBuMTQgKiBuMjMgKiBuMzEpICsgbjQzICogKCtuMTEgKiBuMjQgKiBuMzIgLSBuMTEgKiBuMjIgKiBuMzQgLSBuMTQgKiBuMjEgKiBuMzIgKyBuMTIgKiBuMjEgKiBuMzQgKyBuMTQgKiBuMjIgKiBuMzEgLSBuMTIgKiBuMjQgKiBuMzEpICsgbjQ0ICogKC1uMTMgKiBuMjIgKiBuMzEgLSBuMTEgKiBuMjMgKiBuMzIgKyBuMTEgKiBuMjIgKiBuMzMgKyBuMTMgKiBuMjEgKiBuMzIgLSBuMTIgKiBuMjEgKiBuMzMgKyBuMTIgKiBuMjMgKiBuMzEpOwogICAgfQogICAgdHJhbnNwb3NlKCkgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGxldCB0bXAyOwogICAgICB0bXAyID0gdGVbMV07CiAgICAgIHRlWzFdID0gdGVbNF07CiAgICAgIHRlWzRdID0gdG1wMjsKICAgICAgdG1wMiA9IHRlWzJdOwogICAgICB0ZVsyXSA9IHRlWzhdOwogICAgICB0ZVs4XSA9IHRtcDI7CiAgICAgIHRtcDIgPSB0ZVs2XTsKICAgICAgdGVbNl0gPSB0ZVs5XTsKICAgICAgdGVbOV0gPSB0bXAyOwogICAgICB0bXAyID0gdGVbM107CiAgICAgIHRlWzNdID0gdGVbMTJdOwogICAgICB0ZVsxMl0gPSB0bXAyOwogICAgICB0bXAyID0gdGVbN107CiAgICAgIHRlWzddID0gdGVbMTNdOwogICAgICB0ZVsxM10gPSB0bXAyOwogICAgICB0bXAyID0gdGVbMTFdOwogICAgICB0ZVsxMV0gPSB0ZVsxNF07CiAgICAgIHRlWzE0XSA9IHRtcDI7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0UG9zaXRpb24oeCwgeSwgeikgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGlmICh4LmlzVmVjdG9yMykgewogICAgICAgIHRlWzEyXSA9IHgueDsKICAgICAgICB0ZVsxM10gPSB4Lnk7CiAgICAgICAgdGVbMTRdID0geC56OwogICAgICB9IGVsc2UgewogICAgICAgIHRlWzEyXSA9IHg7CiAgICAgICAgdGVbMTNdID0geTsKICAgICAgICB0ZVsxNF0gPSB6OwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgaW52ZXJ0KCkgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHMsIG4xMSA9IHRlWzBdLCBuMjEgPSB0ZVsxXSwgbjMxID0gdGVbMl0sIG40MSA9IHRlWzNdLCBuMTIgPSB0ZVs0XSwgbjIyID0gdGVbNV0sIG4zMiA9IHRlWzZdLCBuNDIgPSB0ZVs3XSwgbjEzID0gdGVbOF0sIG4yMyA9IHRlWzldLCBuMzMgPSB0ZVsxMF0sIG40MyA9IHRlWzExXSwgbjE0ID0gdGVbMTJdLCBuMjQgPSB0ZVsxM10sIG4zNCA9IHRlWzE0XSwgbjQ0ID0gdGVbMTVdLCB0MTEgPSBuMjMgKiBuMzQgKiBuNDIgLSBuMjQgKiBuMzMgKiBuNDIgKyBuMjQgKiBuMzIgKiBuNDMgLSBuMjIgKiBuMzQgKiBuNDMgLSBuMjMgKiBuMzIgKiBuNDQgKyBuMjIgKiBuMzMgKiBuNDQsIHQxMiA9IG4xNCAqIG4zMyAqIG40MiAtIG4xMyAqIG4zNCAqIG40MiAtIG4xNCAqIG4zMiAqIG40MyArIG4xMiAqIG4zNCAqIG40MyArIG4xMyAqIG4zMiAqIG40NCAtIG4xMiAqIG4zMyAqIG40NCwgdDEzID0gbjEzICogbjI0ICogbjQyIC0gbjE0ICogbjIzICogbjQyICsgbjE0ICogbjIyICogbjQzIC0gbjEyICogbjI0ICogbjQzIC0gbjEzICogbjIyICogbjQ0ICsgbjEyICogbjIzICogbjQ0LCB0MTQgPSBuMTQgKiBuMjMgKiBuMzIgLSBuMTMgKiBuMjQgKiBuMzIgLSBuMTQgKiBuMjIgKiBuMzMgKyBuMTIgKiBuMjQgKiBuMzMgKyBuMTMgKiBuMjIgKiBuMzQgLSBuMTIgKiBuMjMgKiBuMzQ7CiAgICAgIGNvbnN0IGRldCA9IG4xMSAqIHQxMSArIG4yMSAqIHQxMiArIG4zMSAqIHQxMyArIG40MSAqIHQxNDsKICAgICAgaWYgKGRldCA9PT0gMCkKICAgICAgICByZXR1cm4gdGhpcy5zZXQoMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCk7CiAgICAgIGNvbnN0IGRldEludiA9IDEgLyBkZXQ7CiAgICAgIHRlWzBdID0gdDExICogZGV0SW52OwogICAgICB0ZVsxXSA9IChuMjQgKiBuMzMgKiBuNDEgLSBuMjMgKiBuMzQgKiBuNDEgLSBuMjQgKiBuMzEgKiBuNDMgKyBuMjEgKiBuMzQgKiBuNDMgKyBuMjMgKiBuMzEgKiBuNDQgLSBuMjEgKiBuMzMgKiBuNDQpICogZGV0SW52OwogICAgICB0ZVsyXSA9IChuMjIgKiBuMzQgKiBuNDEgLSBuMjQgKiBuMzIgKiBuNDEgKyBuMjQgKiBuMzEgKiBuNDIgLSBuMjEgKiBuMzQgKiBuNDIgLSBuMjIgKiBuMzEgKiBuNDQgKyBuMjEgKiBuMzIgKiBuNDQpICogZGV0SW52OwogICAgICB0ZVszXSA9IChuMjMgKiBuMzIgKiBuNDEgLSBuMjIgKiBuMzMgKiBuNDEgLSBuMjMgKiBuMzEgKiBuNDIgKyBuMjEgKiBuMzMgKiBuNDIgKyBuMjIgKiBuMzEgKiBuNDMgLSBuMjEgKiBuMzIgKiBuNDMpICogZGV0SW52OwogICAgICB0ZVs0XSA9IHQxMiAqIGRldEludjsKICAgICAgdGVbNV0gPSAobjEzICogbjM0ICogbjQxIC0gbjE0ICogbjMzICogbjQxICsgbjE0ICogbjMxICogbjQzIC0gbjExICogbjM0ICogbjQzIC0gbjEzICogbjMxICogbjQ0ICsgbjExICogbjMzICogbjQ0KSAqIGRldEludjsKICAgICAgdGVbNl0gPSAobjE0ICogbjMyICogbjQxIC0gbjEyICogbjM0ICogbjQxIC0gbjE0ICogbjMxICogbjQyICsgbjExICogbjM0ICogbjQyICsgbjEyICogbjMxICogbjQ0IC0gbjExICogbjMyICogbjQ0KSAqIGRldEludjsKICAgICAgdGVbN10gPSAobjEyICogbjMzICogbjQxIC0gbjEzICogbjMyICogbjQxICsgbjEzICogbjMxICogbjQyIC0gbjExICogbjMzICogbjQyIC0gbjEyICogbjMxICogbjQzICsgbjExICogbjMyICogbjQzKSAqIGRldEludjsKICAgICAgdGVbOF0gPSB0MTMgKiBkZXRJbnY7CiAgICAgIHRlWzldID0gKG4xNCAqIG4yMyAqIG40MSAtIG4xMyAqIG4yNCAqIG40MSAtIG4xNCAqIG4yMSAqIG40MyArIG4xMSAqIG4yNCAqIG40MyArIG4xMyAqIG4yMSAqIG40NCAtIG4xMSAqIG4yMyAqIG40NCkgKiBkZXRJbnY7CiAgICAgIHRlWzEwXSA9IChuMTIgKiBuMjQgKiBuNDEgLSBuMTQgKiBuMjIgKiBuNDEgKyBuMTQgKiBuMjEgKiBuNDIgLSBuMTEgKiBuMjQgKiBuNDIgLSBuMTIgKiBuMjEgKiBuNDQgKyBuMTEgKiBuMjIgKiBuNDQpICogZGV0SW52OwogICAgICB0ZVsxMV0gPSAobjEzICogbjIyICogbjQxIC0gbjEyICogbjIzICogbjQxIC0gbjEzICogbjIxICogbjQyICsgbjExICogbjIzICogbjQyICsgbjEyICogbjIxICogbjQzIC0gbjExICogbjIyICogbjQzKSAqIGRldEludjsKICAgICAgdGVbMTJdID0gdDE0ICogZGV0SW52OwogICAgICB0ZVsxM10gPSAobjEzICogbjI0ICogbjMxIC0gbjE0ICogbjIzICogbjMxICsgbjE0ICogbjIxICogbjMzIC0gbjExICogbjI0ICogbjMzIC0gbjEzICogbjIxICogbjM0ICsgbjExICogbjIzICogbjM0KSAqIGRldEludjsKICAgICAgdGVbMTRdID0gKG4xNCAqIG4yMiAqIG4zMSAtIG4xMiAqIG4yNCAqIG4zMSAtIG4xNCAqIG4yMSAqIG4zMiArIG4xMSAqIG4yNCAqIG4zMiArIG4xMiAqIG4yMSAqIG4zNCAtIG4xMSAqIG4yMiAqIG4zNCkgKiBkZXRJbnY7CiAgICAgIHRlWzE1XSA9IChuMTIgKiBuMjMgKiBuMzEgLSBuMTMgKiBuMjIgKiBuMzEgKyBuMTMgKiBuMjEgKiBuMzIgLSBuMTEgKiBuMjMgKiBuMzIgLSBuMTIgKiBuMjEgKiBuMzMgKyBuMTEgKiBuMjIgKiBuMzMpICogZGV0SW52OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNjYWxlKHYpIHsKICAgICAgY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB4ID0gdi54LCB5ID0gdi55LCB6ID0gdi56OwogICAgICB0ZVswXSAqPSB4OwogICAgICB0ZVs0XSAqPSB5OwogICAgICB0ZVs4XSAqPSB6OwogICAgICB0ZVsxXSAqPSB4OwogICAgICB0ZVs1XSAqPSB5OwogICAgICB0ZVs5XSAqPSB6OwogICAgICB0ZVsyXSAqPSB4OwogICAgICB0ZVs2XSAqPSB5OwogICAgICB0ZVsxMF0gKj0gejsKICAgICAgdGVbM10gKj0geDsKICAgICAgdGVbN10gKj0geTsKICAgICAgdGVbMTFdICo9IHo7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0TWF4U2NhbGVPbkF4aXMoKSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3Qgc2NhbGVYU3EgPSB0ZVswXSAqIHRlWzBdICsgdGVbMV0gKiB0ZVsxXSArIHRlWzJdICogdGVbMl07CiAgICAgIGNvbnN0IHNjYWxlWVNxID0gdGVbNF0gKiB0ZVs0XSArIHRlWzVdICogdGVbNV0gKyB0ZVs2XSAqIHRlWzZdOwogICAgICBjb25zdCBzY2FsZVpTcSA9IHRlWzhdICogdGVbOF0gKyB0ZVs5XSAqIHRlWzldICsgdGVbMTBdICogdGVbMTBdOwogICAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgubWF4KHNjYWxlWFNxLCBzY2FsZVlTcSwgc2NhbGVaU3EpKTsKICAgIH0KICAgIG1ha2VUcmFuc2xhdGlvbih4LCB5LCB6KSB7CiAgICAgIHRoaXMuc2V0KDEsIDAsIDAsIHgsIDAsIDEsIDAsIHksIDAsIDAsIDEsIHosIDAsIDAsIDAsIDEpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG1ha2VSb3RhdGlvblgodGhldGEpIHsKICAgICAgY29uc3QgYyA9IE1hdGguY29zKHRoZXRhKSwgcyA9IE1hdGguc2luKHRoZXRhKTsKICAgICAgdGhpcy5zZXQoMSwgMCwgMCwgMCwgMCwgYywgLXMsIDAsIDAsIHMsIGMsIDAsIDAsIDAsIDAsIDEpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG1ha2VSb3RhdGlvblkodGhldGEpIHsKICAgICAgY29uc3QgYyA9IE1hdGguY29zKHRoZXRhKSwgcyA9IE1hdGguc2luKHRoZXRhKTsKICAgICAgdGhpcy5zZXQoYywgMCwgcywgMCwgMCwgMSwgMCwgMCwgLXMsIDAsIGMsIDAsIDAsIDAsIDAsIDEpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG1ha2VSb3RhdGlvbloodGhldGEpIHsKICAgICAgY29uc3QgYyA9IE1hdGguY29zKHRoZXRhKSwgcyA9IE1hdGguc2luKHRoZXRhKTsKICAgICAgdGhpcy5zZXQoYywgLXMsIDAsIDAsIHMsIGMsIDAsIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDAsIDEpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG1ha2VSb3RhdGlvbkF4aXMoYXhpcywgYW5nbGUpIHsKICAgICAgY29uc3QgYyA9IE1hdGguY29zKGFuZ2xlKTsKICAgICAgY29uc3QgcyA9IE1hdGguc2luKGFuZ2xlKTsKICAgICAgY29uc3QgdCA9IDEgLSBjOwogICAgICBjb25zdCB4ID0gYXhpcy54LCB5ID0gYXhpcy55LCB6ID0gYXhpcy56OwogICAgICBjb25zdCB0eCA9IHQgKiB4LCB0eSA9IHQgKiB5OwogICAgICB0aGlzLnNldCh0eCAqIHggKyBjLCB0eCAqIHkgLSBzICogeiwgdHggKiB6ICsgcyAqIHksIDAsIHR4ICogeSArIHMgKiB6LCB0eSAqIHkgKyBjLCB0eSAqIHogLSBzICogeCwgMCwgdHggKiB6IC0gcyAqIHksIHR5ICogeiArIHMgKiB4LCB0ICogeiAqIHogKyBjLCAwLCAwLCAwLCAwLCAxKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtYWtlU2NhbGUoeCwgeSwgeikgewogICAgICB0aGlzLnNldCh4LCAwLCAwLCAwLCAwLCB5LCAwLCAwLCAwLCAwLCB6LCAwLCAwLCAwLCAwLCAxKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtYWtlU2hlYXIoeHksIHh6LCB5eCwgeXosIHp4LCB6eSkgewogICAgICB0aGlzLnNldCgxLCB5eCwgengsIDAsIHh5LCAxLCB6eSwgMCwgeHosIHl6LCAxLCAwLCAwLCAwLCAwLCAxKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb21wb3NlKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSkgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IHggPSBxdWF0ZXJuaW9uLl94LCB5ID0gcXVhdGVybmlvbi5feSwgeiA9IHF1YXRlcm5pb24uX3osIHcgPSBxdWF0ZXJuaW9uLl93OwogICAgICBjb25zdCB4MiA9IHggKyB4LCB5MiA9IHkgKyB5LCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MiwgeHkgPSB4ICogeTIsIHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MiwgeXogPSB5ICogejIsIHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4Miwgd3kgPSB3ICogeTIsIHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBzeCA9IHNjYWxlLngsIHN5ID0gc2NhbGUueSwgc3ogPSBzY2FsZS56OwogICAgICB0ZVswXSA9ICgxIC0gKHl5ICsgenopKSAqIHN4OwogICAgICB0ZVsxXSA9ICh4eSArIHd6KSAqIHN4OwogICAgICB0ZVsyXSA9ICh4eiAtIHd5KSAqIHN4OwogICAgICB0ZVszXSA9IDA7CiAgICAgIHRlWzRdID0gKHh5IC0gd3opICogc3k7CiAgICAgIHRlWzVdID0gKDEgLSAoeHggKyB6eikpICogc3k7CiAgICAgIHRlWzZdID0gKHl6ICsgd3gpICogc3k7CiAgICAgIHRlWzddID0gMDsKICAgICAgdGVbOF0gPSAoeHogKyB3eSkgKiBzejsKICAgICAgdGVbOV0gPSAoeXogLSB3eCkgKiBzejsKICAgICAgdGVbMTBdID0gKDEgLSAoeHggKyB5eSkpICogc3o7CiAgICAgIHRlWzExXSA9IDA7CiAgICAgIHRlWzEyXSA9IHBvc2l0aW9uLng7CiAgICAgIHRlWzEzXSA9IHBvc2l0aW9uLnk7CiAgICAgIHRlWzE0XSA9IHBvc2l0aW9uLno7CiAgICAgIHRlWzE1XSA9IDE7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZGVjb21wb3NlKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSkgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGxldCBzeCA9IF92MSQ1LnNldCh0ZVswXSwgdGVbMV0sIHRlWzJdKS5sZW5ndGgoKTsKICAgICAgY29uc3Qgc3kgPSBfdjEkNS5zZXQodGVbNF0sIHRlWzVdLCB0ZVs2XSkubGVuZ3RoKCk7CiAgICAgIGNvbnN0IHN6ID0gX3YxJDUuc2V0KHRlWzhdLCB0ZVs5XSwgdGVbMTBdKS5sZW5ndGgoKTsKICAgICAgY29uc3QgZGV0ID0gdGhpcy5kZXRlcm1pbmFudCgpOwogICAgICBpZiAoZGV0IDwgMCkKICAgICAgICBzeCA9IC1zeDsKICAgICAgcG9zaXRpb24ueCA9IHRlWzEyXTsKICAgICAgcG9zaXRpb24ueSA9IHRlWzEzXTsKICAgICAgcG9zaXRpb24ueiA9IHRlWzE0XTsKICAgICAgX20xJDIuY29weSh0aGlzKTsKICAgICAgY29uc3QgaW52U1ggPSAxIC8gc3g7CiAgICAgIGNvbnN0IGludlNZID0gMSAvIHN5OwogICAgICBjb25zdCBpbnZTWiA9IDEgLyBzejsKICAgICAgX20xJDIuZWxlbWVudHNbMF0gKj0gaW52U1g7CiAgICAgIF9tMSQyLmVsZW1lbnRzWzFdICo9IGludlNYOwogICAgICBfbTEkMi5lbGVtZW50c1syXSAqPSBpbnZTWDsKICAgICAgX20xJDIuZWxlbWVudHNbNF0gKj0gaW52U1k7CiAgICAgIF9tMSQyLmVsZW1lbnRzWzVdICo9IGludlNZOwogICAgICBfbTEkMi5lbGVtZW50c1s2XSAqPSBpbnZTWTsKICAgICAgX20xJDIuZWxlbWVudHNbOF0gKj0gaW52U1o7CiAgICAgIF9tMSQyLmVsZW1lbnRzWzldICo9IGludlNaOwogICAgICBfbTEkMi5lbGVtZW50c1sxMF0gKj0gaW52U1o7CiAgICAgIHF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KF9tMSQyKTsKICAgICAgc2NhbGUueCA9IHN4OwogICAgICBzY2FsZS55ID0gc3k7CiAgICAgIHNjYWxlLnogPSBzejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtYWtlUGVyc3BlY3RpdmUobGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCBuZWFyLCBmYXIpIHsKICAgICAgaWYgKGZhciA9PT0gdm9pZCAwKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5NYXRyaXg0OiAubWFrZVBlcnNwZWN0aXZlKCkgaGFzIGJlZW4gcmVkZWZpbmVkIGFuZCBoYXMgYSBuZXcgc2lnbmF0dXJlLiBQbGVhc2UgY2hlY2sgdGhlIGRvY3MuIik7CiAgICAgIH0KICAgICAgY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB4ID0gMiAqIG5lYXIgLyAocmlnaHQgLSBsZWZ0KTsKICAgICAgY29uc3QgeSA9IDIgKiBuZWFyIC8gKHRvcCAtIGJvdHRvbSk7CiAgICAgIGNvbnN0IGEgPSAocmlnaHQgKyBsZWZ0KSAvIChyaWdodCAtIGxlZnQpOwogICAgICBjb25zdCBiID0gKHRvcCArIGJvdHRvbSkgLyAodG9wIC0gYm90dG9tKTsKICAgICAgY29uc3QgYyA9IC0oZmFyICsgbmVhcikgLyAoZmFyIC0gbmVhcik7CiAgICAgIGNvbnN0IGQgPSAtMiAqIGZhciAqIG5lYXIgLyAoZmFyIC0gbmVhcik7CiAgICAgIHRlWzBdID0geDsKICAgICAgdGVbNF0gPSAwOwogICAgICB0ZVs4XSA9IGE7CiAgICAgIHRlWzEyXSA9IDA7CiAgICAgIHRlWzFdID0gMDsKICAgICAgdGVbNV0gPSB5OwogICAgICB0ZVs5XSA9IGI7CiAgICAgIHRlWzEzXSA9IDA7CiAgICAgIHRlWzJdID0gMDsKICAgICAgdGVbNl0gPSAwOwogICAgICB0ZVsxMF0gPSBjOwogICAgICB0ZVsxNF0gPSBkOwogICAgICB0ZVszXSA9IDA7CiAgICAgIHRlWzddID0gMDsKICAgICAgdGVbMTFdID0gLTE7CiAgICAgIHRlWzE1XSA9IDA7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbWFrZU9ydGhvZ3JhcGhpYyhsZWZ0LCByaWdodCwgdG9wLCBib3R0b20sIG5lYXIsIGZhcikgewogICAgICBjb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IHcgPSAxIC8gKHJpZ2h0IC0gbGVmdCk7CiAgICAgIGNvbnN0IGggPSAxIC8gKHRvcCAtIGJvdHRvbSk7CiAgICAgIGNvbnN0IHAgPSAxIC8gKGZhciAtIG5lYXIpOwogICAgICBjb25zdCB4ID0gKHJpZ2h0ICsgbGVmdCkgKiB3OwogICAgICBjb25zdCB5ID0gKHRvcCArIGJvdHRvbSkgKiBoOwogICAgICBjb25zdCB6ID0gKGZhciArIG5lYXIpICogcDsKICAgICAgdGVbMF0gPSAyICogdzsKICAgICAgdGVbNF0gPSAwOwogICAgICB0ZVs4XSA9IDA7CiAgICAgIHRlWzEyXSA9IC14OwogICAgICB0ZVsxXSA9IDA7CiAgICAgIHRlWzVdID0gMiAqIGg7CiAgICAgIHRlWzldID0gMDsKICAgICAgdGVbMTNdID0gLXk7CiAgICAgIHRlWzJdID0gMDsKICAgICAgdGVbNl0gPSAwOwogICAgICB0ZVsxMF0gPSAtMiAqIHA7CiAgICAgIHRlWzE0XSA9IC16OwogICAgICB0ZVszXSA9IDA7CiAgICAgIHRlWzddID0gMDsKICAgICAgdGVbMTFdID0gMDsKICAgICAgdGVbMTVdID0gMTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBlcXVhbHMobWF0cml4KSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgbWUgPSBtYXRyaXguZWxlbWVudHM7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykgewogICAgICAgIGlmICh0ZVtpXSAhPT0gbWVbaV0pCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmcm9tQXJyYXkoYXJyYXksIG9mZnNldCA9IDApIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IGFycmF5W2kgKyBvZmZzZXRdOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9BcnJheShhcnJheSA9IFtdLCBvZmZzZXQgPSAwKSB7CiAgICAgIGNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgICAgYXJyYXlbb2Zmc2V0XSA9IHRlWzBdOwogICAgICBhcnJheVtvZmZzZXQgKyAxXSA9IHRlWzFdOwogICAgICBhcnJheVtvZmZzZXQgKyAyXSA9IHRlWzJdOwogICAgICBhcnJheVtvZmZzZXQgKyAzXSA9IHRlWzNdOwogICAgICBhcnJheVtvZmZzZXQgKyA0XSA9IHRlWzRdOwogICAgICBhcnJheVtvZmZzZXQgKyA1XSA9IHRlWzVdOwogICAgICBhcnJheVtvZmZzZXQgKyA2XSA9IHRlWzZdOwogICAgICBhcnJheVtvZmZzZXQgKyA3XSA9IHRlWzddOwogICAgICBhcnJheVtvZmZzZXQgKyA4XSA9IHRlWzhdOwogICAgICBhcnJheVtvZmZzZXQgKyA5XSA9IHRlWzldOwogICAgICBhcnJheVtvZmZzZXQgKyAxMF0gPSB0ZVsxMF07CiAgICAgIGFycmF5W29mZnNldCArIDExXSA9IHRlWzExXTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgMTJdID0gdGVbMTJdOwogICAgICBhcnJheVtvZmZzZXQgKyAxM10gPSB0ZVsxM107CiAgICAgIGFycmF5W29mZnNldCArIDE0XSA9IHRlWzE0XTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgMTVdID0gdGVbMTVdOwogICAgICByZXR1cm4gYXJyYXk7CiAgICB9CiAgfTsKICBNYXRyaXg0LnByb3RvdHlwZS5pc01hdHJpeDQgPSB0cnVlOwogIHZhciBfdjEkNSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfbTEkMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWF0cml4NCgpOwogIHZhciBfemVybyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygwLCAwLCAwKTsKICB2YXIgX29uZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygxLCAxLCAxKTsKICB2YXIgX3ggPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX3kgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX3ogPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX21hdHJpeCQxID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXRyaXg0KCk7CiAgdmFyIF9xdWF0ZXJuaW9uJDMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFF1YXRlcm5pb24oKTsKICB2YXIgRXVsZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3Rvcih4ID0gMCwgeSA9IDAsIHogPSAwLCBvcmRlciA9IEV1bGVyLkRlZmF1bHRPcmRlcikgewogICAgICB0aGlzLl94ID0geDsKICAgICAgdGhpcy5feSA9IHk7CiAgICAgIHRoaXMuX3ogPSB6OwogICAgICB0aGlzLl9vcmRlciA9IG9yZGVyOwogICAgfQogICAgZ2V0IHgoKSB7CiAgICAgIHJldHVybiB0aGlzLl94OwogICAgfQogICAgc2V0IHgodmFsdWUpIHsKICAgICAgdGhpcy5feCA9IHZhbHVlOwogICAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CiAgICB9CiAgICBnZXQgeSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3k7CiAgICB9CiAgICBzZXQgeSh2YWx1ZSkgewogICAgICB0aGlzLl95ID0gdmFsdWU7CiAgICAgIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKICAgIH0KICAgIGdldCB6KCkgewogICAgICByZXR1cm4gdGhpcy5fejsKICAgIH0KICAgIHNldCB6KHZhbHVlKSB7CiAgICAgIHRoaXMuX3ogPSB2YWx1ZTsKICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwogICAgfQogICAgZ2V0IG9yZGVyKCkgewogICAgICByZXR1cm4gdGhpcy5fb3JkZXI7CiAgICB9CiAgICBzZXQgb3JkZXIodmFsdWUpIHsKICAgICAgdGhpcy5fb3JkZXIgPSB2YWx1ZTsKICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwogICAgfQogICAgc2V0KHgsIHksIHosIG9yZGVyID0gdGhpcy5fb3JkZXIpIHsKICAgICAgdGhpcy5feCA9IHg7CiAgICAgIHRoaXMuX3kgPSB5OwogICAgICB0aGlzLl96ID0gejsKICAgICAgdGhpcy5fb3JkZXIgPSBvcmRlcjsKICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5feCwgdGhpcy5feSwgdGhpcy5feiwgdGhpcy5fb3JkZXIpOwogICAgfQogICAgY29weShldWxlcikgewogICAgICB0aGlzLl94ID0gZXVsZXIuX3g7CiAgICAgIHRoaXMuX3kgPSBldWxlci5feTsKICAgICAgdGhpcy5feiA9IGV1bGVyLl96OwogICAgICB0aGlzLl9vcmRlciA9IGV1bGVyLl9vcmRlcjsKICAgICAgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21Sb3RhdGlvbk1hdHJpeChtLCBvcmRlciA9IHRoaXMuX29yZGVyLCB1cGRhdGUgPSB0cnVlKSB7CiAgICAgIGNvbnN0IHRlID0gbS5lbGVtZW50czsKICAgICAgY29uc3QgbTExID0gdGVbMF0sIG0xMiA9IHRlWzRdLCBtMTMgPSB0ZVs4XTsKICAgICAgY29uc3QgbTIxID0gdGVbMV0sIG0yMiA9IHRlWzVdLCBtMjMgPSB0ZVs5XTsKICAgICAgY29uc3QgbTMxID0gdGVbMl0sIG0zMiA9IHRlWzZdLCBtMzMgPSB0ZVsxMF07CiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICJYWVoiOgogICAgICAgICAgdGhpcy5feSA9IE1hdGguYXNpbihjbGFtcChtMTMsIC0xLCAxKSk7CiAgICAgICAgICBpZiAoTWF0aC5hYnMobTEzKSA8IDAuOTk5OTk5OSkgewogICAgICAgICAgICB0aGlzLl94ID0gTWF0aC5hdGFuMigtbTIzLCBtMzMpOwogICAgICAgICAgICB0aGlzLl96ID0gTWF0aC5hdGFuMigtbTEyLCBtMTEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5feCA9IE1hdGguYXRhbjIobTMyLCBtMjIpOwogICAgICAgICAgICB0aGlzLl96ID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIllYWiI6CiAgICAgICAgICB0aGlzLl94ID0gTWF0aC5hc2luKC1jbGFtcChtMjMsIC0xLCAxKSk7CiAgICAgICAgICBpZiAoTWF0aC5hYnMobTIzKSA8IDAuOTk5OTk5OSkgewogICAgICAgICAgICB0aGlzLl95ID0gTWF0aC5hdGFuMihtMTMsIG0zMyk7CiAgICAgICAgICAgIHRoaXMuX3ogPSBNYXRoLmF0YW4yKG0yMSwgbTIyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3kgPSBNYXRoLmF0YW4yKC1tMzEsIG0xMSk7CiAgICAgICAgICAgIHRoaXMuX3ogPSAwOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiWlhZIjoKICAgICAgICAgIHRoaXMuX3ggPSBNYXRoLmFzaW4oY2xhbXAobTMyLCAtMSwgMSkpOwogICAgICAgICAgaWYgKE1hdGguYWJzKG0zMikgPCAwLjk5OTk5OTkpIHsKICAgICAgICAgICAgdGhpcy5feSA9IE1hdGguYXRhbjIoLW0zMSwgbTMzKTsKICAgICAgICAgICAgdGhpcy5feiA9IE1hdGguYXRhbjIoLW0xMiwgbTIyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3kgPSAwOwogICAgICAgICAgICB0aGlzLl96ID0gTWF0aC5hdGFuMihtMjEsIG0xMSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJaWVgiOgogICAgICAgICAgdGhpcy5feSA9IE1hdGguYXNpbigtY2xhbXAobTMxLCAtMSwgMSkpOwogICAgICAgICAgaWYgKE1hdGguYWJzKG0zMSkgPCAwLjk5OTk5OTkpIHsKICAgICAgICAgICAgdGhpcy5feCA9IE1hdGguYXRhbjIobTMyLCBtMzMpOwogICAgICAgICAgICB0aGlzLl96ID0gTWF0aC5hdGFuMihtMjEsIG0xMSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl94ID0gMDsKICAgICAgICAgICAgdGhpcy5feiA9IE1hdGguYXRhbjIoLW0xMiwgbTIyKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIllaWCI6CiAgICAgICAgICB0aGlzLl96ID0gTWF0aC5hc2luKGNsYW1wKG0yMSwgLTEsIDEpKTsKICAgICAgICAgIGlmIChNYXRoLmFicyhtMjEpIDwgMC45OTk5OTk5KSB7CiAgICAgICAgICAgIHRoaXMuX3ggPSBNYXRoLmF0YW4yKC1tMjMsIG0yMik7CiAgICAgICAgICAgIHRoaXMuX3kgPSBNYXRoLmF0YW4yKC1tMzEsIG0xMSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl94ID0gMDsKICAgICAgICAgICAgdGhpcy5feSA9IE1hdGguYXRhbjIobTEzLCBtMzMpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiWFpZIjoKICAgICAgICAgIHRoaXMuX3ogPSBNYXRoLmFzaW4oLWNsYW1wKG0xMiwgLTEsIDEpKTsKICAgICAgICAgIGlmIChNYXRoLmFicyhtMTIpIDwgMC45OTk5OTk5KSB7CiAgICAgICAgICAgIHRoaXMuX3ggPSBNYXRoLmF0YW4yKG0zMiwgbTIyKTsKICAgICAgICAgICAgdGhpcy5feSA9IE1hdGguYXRhbjIobTEzLCBtMTEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5feCA9IE1hdGguYXRhbjIoLW0yMywgbTMzKTsKICAgICAgICAgICAgdGhpcy5feSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5FdWxlcjogLnNldEZyb21Sb3RhdGlvbk1hdHJpeCgpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICIgKyBvcmRlcik7CiAgICAgIH0KICAgICAgdGhpcy5fb3JkZXIgPSBvcmRlcjsKICAgICAgaWYgKHVwZGF0ZSA9PT0gdHJ1ZSkKICAgICAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0RnJvbVF1YXRlcm5pb24ocSwgb3JkZXIsIHVwZGF0ZSkgewogICAgICBfbWF0cml4JDEubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSk7CiAgICAgIHJldHVybiB0aGlzLnNldEZyb21Sb3RhdGlvbk1hdHJpeChfbWF0cml4JDEsIG9yZGVyLCB1cGRhdGUpOwogICAgfQogICAgc2V0RnJvbVZlY3RvcjModiwgb3JkZXIgPSB0aGlzLl9vcmRlcikgewogICAgICByZXR1cm4gdGhpcy5zZXQodi54LCB2LnksIHYueiwgb3JkZXIpOwogICAgfQogICAgcmVvcmRlcihuZXdPcmRlcikgewogICAgICBfcXVhdGVybmlvbiQzLnNldEZyb21FdWxlcih0aGlzKTsKICAgICAgcmV0dXJuIHRoaXMuc2V0RnJvbVF1YXRlcm5pb24oX3F1YXRlcm5pb24kMywgbmV3T3JkZXIpOwogICAgfQogICAgZXF1YWxzKGV1bGVyKSB7CiAgICAgIHJldHVybiBldWxlci5feCA9PT0gdGhpcy5feCAmJiBldWxlci5feSA9PT0gdGhpcy5feSAmJiBldWxlci5feiA9PT0gdGhpcy5feiAmJiBldWxlci5fb3JkZXIgPT09IHRoaXMuX29yZGVyOwogICAgfQogICAgZnJvbUFycmF5KGFycmF5KSB7CiAgICAgIHRoaXMuX3ggPSBhcnJheVswXTsKICAgICAgdGhpcy5feSA9IGFycmF5WzFdOwogICAgICB0aGlzLl96ID0gYXJyYXlbMl07CiAgICAgIGlmIChhcnJheVszXSAhPT0gdm9pZCAwKQogICAgICAgIHRoaXMuX29yZGVyID0gYXJyYXlbM107CiAgICAgIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0b0FycmF5KGFycmF5ID0gW10sIG9mZnNldCA9IDApIHsKICAgICAgYXJyYXlbb2Zmc2V0XSA9IHRoaXMuX3g7CiAgICAgIGFycmF5W29mZnNldCArIDFdID0gdGhpcy5feTsKICAgICAgYXJyYXlbb2Zmc2V0ICsgMl0gPSB0aGlzLl96OwogICAgICBhcnJheVtvZmZzZXQgKyAzXSA9IHRoaXMuX29yZGVyOwogICAgICByZXR1cm4gYXJyYXk7CiAgICB9CiAgICB0b1ZlY3RvcjMob3B0aW9uYWxSZXN1bHQpIHsKICAgICAgaWYgKG9wdGlvbmFsUmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIG9wdGlvbmFsUmVzdWx0LnNldCh0aGlzLl94LCB0aGlzLl95LCB0aGlzLl96KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjModGhpcy5feCwgdGhpcy5feSwgdGhpcy5feik7CiAgICAgIH0KICAgIH0KICAgIF9vbkNoYW5nZShjYWxsYmFjaykgewogICAgICB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgX29uQ2hhbmdlQ2FsbGJhY2soKSB7CiAgICB9CiAgfTsKICBFdWxlci5wcm90b3R5cGUuaXNFdWxlciA9IHRydWU7CiAgRXVsZXIuRGVmYXVsdE9yZGVyID0gIlhZWiI7CiAgRXVsZXIuUm90YXRpb25PcmRlcnMgPSBbIlhZWiIsICJZWlgiLCAiWlhZIiwgIlhaWSIsICJZWFoiLCAiWllYIl07CiAgdmFyIExheWVycyA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLm1hc2sgPSAxIHwgMDsKICAgIH0KICAgIHNldChjaGFubmVsKSB7CiAgICAgIHRoaXMubWFzayA9IDEgPDwgY2hhbm5lbCB8IDA7CiAgICB9CiAgICBlbmFibGUoY2hhbm5lbCkgewogICAgICB0aGlzLm1hc2sgfD0gMSA8PCBjaGFubmVsIHwgMDsKICAgIH0KICAgIGVuYWJsZUFsbCgpIHsKICAgICAgdGhpcy5tYXNrID0gNDI5NDk2NzI5NSB8IDA7CiAgICB9CiAgICB0b2dnbGUoY2hhbm5lbCkgewogICAgICB0aGlzLm1hc2sgXj0gMSA8PCBjaGFubmVsIHwgMDsKICAgIH0KICAgIGRpc2FibGUoY2hhbm5lbCkgewogICAgICB0aGlzLm1hc2sgJj0gfigxIDw8IGNoYW5uZWwgfCAwKTsKICAgIH0KICAgIGRpc2FibGVBbGwoKSB7CiAgICAgIHRoaXMubWFzayA9IDA7CiAgICB9CiAgICB0ZXN0KGxheWVycykgewogICAgICByZXR1cm4gKHRoaXMubWFzayAmIGxheWVycy5tYXNrKSAhPT0gMDsKICAgIH0KICB9OwogIHZhciBfb2JqZWN0M0RJZCA9IDA7CiAgdmFyIF92MSQ0ID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9xMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgUXVhdGVybmlvbigpOwogIHZhciBfbTEkMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWF0cml4NCgpOwogIHZhciBfdGFyZ2V0ID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9wb3NpdGlvbiQzID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9zY2FsZSQyID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9xdWF0ZXJuaW9uJDIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFF1YXRlcm5pb24oKTsKICB2YXIgX3hBeGlzID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKDEsIDAsIDApOwogIHZhciBfeUF4aXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoMCwgMSwgMCk7CiAgdmFyIF96QXhpcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygwLCAwLCAxKTsKICB2YXIgX2FkZGVkRXZlbnQgPSB7IHR5cGU6ICJhZGRlZCIgfTsKICB2YXIgX3JlbW92ZWRFdmVudCA9IHsgdHlwZTogInJlbW92ZWQiIH07CiAgdmFyIE9iamVjdDNEID0gY2xhc3MgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiaWQiLCB7IHZhbHVlOiBfb2JqZWN0M0RJZCsrIH0pOwogICAgICB0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKICAgICAgdGhpcy5uYW1lID0gIiI7CiAgICAgIHRoaXMudHlwZSA9ICJPYmplY3QzRCI7CiAgICAgIHRoaXMucGFyZW50ID0gbnVsbDsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgICB0aGlzLnVwID0gT2JqZWN0M0QuRGVmYXVsdFVwLmNsb25lKCk7CiAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IFZlY3RvcjMoKTsKICAgICAgY29uc3Qgcm90YXRpb24gPSBuZXcgRXVsZXIoKTsKICAgICAgY29uc3QgcXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIGNvbnN0IHNjYWxlID0gbmV3IFZlY3RvcjMoMSwgMSwgMSk7CiAgICAgIGZ1bmN0aW9uIG9uUm90YXRpb25DaGFuZ2UoKSB7CiAgICAgICAgcXVhdGVybmlvbi5zZXRGcm9tRXVsZXIocm90YXRpb24sIGZhbHNlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBvblF1YXRlcm5pb25DaGFuZ2UoKSB7CiAgICAgICAgcm90YXRpb24uc2V0RnJvbVF1YXRlcm5pb24ocXVhdGVybmlvbiwgdm9pZCAwLCBmYWxzZSk7CiAgICAgIH0KICAgICAgcm90YXRpb24uX29uQ2hhbmdlKG9uUm90YXRpb25DaGFuZ2UpOwogICAgICBxdWF0ZXJuaW9uLl9vbkNoYW5nZShvblF1YXRlcm5pb25DaGFuZ2UpOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7CiAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICB2YWx1ZTogcG9zaXRpb24KICAgICAgICB9LAogICAgICAgIHJvdGF0aW9uOiB7CiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgdmFsdWU6IHJvdGF0aW9uCiAgICAgICAgfSwKICAgICAgICBxdWF0ZXJuaW9uOiB7CiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgdmFsdWU6IHF1YXRlcm5pb24KICAgICAgICB9LAogICAgICAgIHNjYWxlOiB7CiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgdmFsdWU6IHNjYWxlCiAgICAgICAgfSwKICAgICAgICBtb2RlbFZpZXdNYXRyaXg6IHsKICAgICAgICAgIHZhbHVlOiBuZXcgTWF0cml4NCgpCiAgICAgICAgfSwKICAgICAgICBub3JtYWxNYXRyaXg6IHsKICAgICAgICAgIHZhbHVlOiBuZXcgTWF0cml4MygpCiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4NCgpOwogICAgICB0aGlzLm1hdHJpeFdvcmxkID0gbmV3IE1hdHJpeDQoKTsKICAgICAgdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gT2JqZWN0M0QuRGVmYXVsdE1hdHJpeEF1dG9VcGRhdGU7CiAgICAgIHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgICB0aGlzLmxheWVycyA9IG5ldyBMYXllcnMoKTsKICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTsKICAgICAgdGhpcy5jYXN0U2hhZG93ID0gZmFsc2U7CiAgICAgIHRoaXMucmVjZWl2ZVNoYWRvdyA9IGZhbHNlOwogICAgICB0aGlzLmZydXN0dW1DdWxsZWQgPSB0cnVlOwogICAgICB0aGlzLnJlbmRlck9yZGVyID0gMDsKICAgICAgdGhpcy5hbmltYXRpb25zID0gW107CiAgICAgIHRoaXMudXNlckRhdGEgPSB7fTsKICAgIH0KICAgIG9uQmVmb3JlUmVuZGVyKCkgewogICAgfQogICAgb25BZnRlclJlbmRlcigpIHsKICAgIH0KICAgIGFwcGx5TWF0cml4NChtYXRyaXgpIHsKICAgICAgaWYgKHRoaXMubWF0cml4QXV0b1VwZGF0ZSkKICAgICAgICB0aGlzLnVwZGF0ZU1hdHJpeCgpOwogICAgICB0aGlzLm1hdHJpeC5wcmVtdWx0aXBseShtYXRyaXgpOwogICAgICB0aGlzLm1hdHJpeC5kZWNvbXBvc2UodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCB0aGlzLnNjYWxlKTsKICAgIH0KICAgIGFwcGx5UXVhdGVybmlvbihxKSB7CiAgICAgIHRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseShxKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRSb3RhdGlvbkZyb21BeGlzQW5nbGUoYXhpcywgYW5nbGUpIHsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21BeGlzQW5nbGUoYXhpcywgYW5nbGUpOwogICAgfQogICAgc2V0Um90YXRpb25Gcm9tRXVsZXIoZXVsZXIpIHsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihldWxlciwgdHJ1ZSk7CiAgICB9CiAgICBzZXRSb3RhdGlvbkZyb21NYXRyaXgobSkgewogICAgICB0aGlzLnF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KG0pOwogICAgfQogICAgc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbihxKSB7CiAgICAgIHRoaXMucXVhdGVybmlvbi5jb3B5KHEpOwogICAgfQogICAgcm90YXRlT25BeGlzKGF4aXMsIGFuZ2xlKSB7CiAgICAgIF9xMS5zZXRGcm9tQXhpc0FuZ2xlKGF4aXMsIGFuZ2xlKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLm11bHRpcGx5KF9xMSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcm90YXRlT25Xb3JsZEF4aXMoYXhpcywgYW5nbGUpIHsKICAgICAgX3ExLnNldEZyb21BeGlzQW5nbGUoYXhpcywgYW5nbGUpOwogICAgICB0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkoX3ExKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByb3RhdGVYKGFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLnJvdGF0ZU9uQXhpcyhfeEF4aXMsIGFuZ2xlKTsKICAgIH0KICAgIHJvdGF0ZVkoYW5nbGUpIHsKICAgICAgcmV0dXJuIHRoaXMucm90YXRlT25BeGlzKF95QXhpcywgYW5nbGUpOwogICAgfQogICAgcm90YXRlWihhbmdsZSkgewogICAgICByZXR1cm4gdGhpcy5yb3RhdGVPbkF4aXMoX3pBeGlzLCBhbmdsZSk7CiAgICB9CiAgICB0cmFuc2xhdGVPbkF4aXMoYXhpcywgZGlzdGFuY2UpIHsKICAgICAgX3YxJDQuY29weShheGlzKS5hcHBseVF1YXRlcm5pb24odGhpcy5xdWF0ZXJuaW9uKTsKICAgICAgdGhpcy5wb3NpdGlvbi5hZGQoX3YxJDQubXVsdGlwbHlTY2FsYXIoZGlzdGFuY2UpKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0cmFuc2xhdGVYKGRpc3RhbmNlKSB7CiAgICAgIHJldHVybiB0aGlzLnRyYW5zbGF0ZU9uQXhpcyhfeEF4aXMsIGRpc3RhbmNlKTsKICAgIH0KICAgIHRyYW5zbGF0ZVkoZGlzdGFuY2UpIHsKICAgICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKF95QXhpcywgZGlzdGFuY2UpOwogICAgfQogICAgdHJhbnNsYXRlWihkaXN0YW5jZSkgewogICAgICByZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoX3pBeGlzLCBkaXN0YW5jZSk7CiAgICB9CiAgICBsb2NhbFRvV29ybGQodmVjdG9yKSB7CiAgICAgIHJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KHRoaXMubWF0cml4V29ybGQpOwogICAgfQogICAgd29ybGRUb0xvY2FsKHZlY3RvcikgewogICAgICByZXR1cm4gdmVjdG9yLmFwcGx5TWF0cml4NChfbTEkMS5jb3B5KHRoaXMubWF0cml4V29ybGQpLmludmVydCgpKTsKICAgIH0KICAgIGxvb2tBdCh4LCB5LCB6KSB7CiAgICAgIGlmICh4LmlzVmVjdG9yMykgewogICAgICAgIF90YXJnZXQuY29weSh4KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfdGFyZ2V0LnNldCh4LCB5LCB6KTsKICAgICAgfQogICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudDsKICAgICAgdGhpcy51cGRhdGVXb3JsZE1hdHJpeCh0cnVlLCBmYWxzZSk7CiAgICAgIF9wb3NpdGlvbiQzLnNldEZyb21NYXRyaXhQb3NpdGlvbih0aGlzLm1hdHJpeFdvcmxkKTsKICAgICAgaWYgKHRoaXMuaXNDYW1lcmEgfHwgdGhpcy5pc0xpZ2h0KSB7CiAgICAgICAgX20xJDEubG9va0F0KF9wb3NpdGlvbiQzLCBfdGFyZ2V0LCB0aGlzLnVwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfbTEkMS5sb29rQXQoX3RhcmdldCwgX3Bvc2l0aW9uJDMsIHRoaXMudXApOwogICAgICB9CiAgICAgIHRoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoX20xJDEpOwogICAgICBpZiAocGFyZW50KSB7CiAgICAgICAgX20xJDEuZXh0cmFjdFJvdGF0aW9uKHBhcmVudC5tYXRyaXhXb3JsZCk7CiAgICAgICAgX3ExLnNldEZyb21Sb3RhdGlvbk1hdHJpeChfbTEkMSk7CiAgICAgICAgdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KF9xMS5pbnZlcnQoKSk7CiAgICAgIH0KICAgIH0KICAgIGFkZChvYmplY3QpIHsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMuYWRkKGFyZ3VtZW50c1tpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIGlmIChvYmplY3QgPT09IHRoaXMpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBjYW4ndCBiZSBhZGRlZCBhcyBhIGNoaWxkIG9mIGl0c2VsZi4iLCBvYmplY3QpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIGlmIChvYmplY3QgJiYgb2JqZWN0LmlzT2JqZWN0M0QpIHsKICAgICAgICBpZiAob2JqZWN0LnBhcmVudCAhPT0gbnVsbCkgewogICAgICAgICAgb2JqZWN0LnBhcmVudC5yZW1vdmUob2JqZWN0KTsKICAgICAgICB9CiAgICAgICAgb2JqZWN0LnBhcmVudCA9IHRoaXM7CiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKG9iamVjdCk7CiAgICAgICAgb2JqZWN0LmRpc3BhdGNoRXZlbnQoX2FkZGVkRXZlbnQpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLk9iamVjdDNELmFkZDogb2JqZWN0IG5vdCBhbiBpbnN0YW5jZSBvZiBUSFJFRS5PYmplY3QzRC4iLCBvYmplY3QpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcmVtb3ZlKG9iamVjdCkgewogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdGhpcy5yZW1vdmUoYXJndW1lbnRzW2ldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmNoaWxkcmVuLmluZGV4T2Yob2JqZWN0KTsKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIG9iamVjdC5wYXJlbnQgPSBudWxsOwogICAgICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICBvYmplY3QuZGlzcGF0Y2hFdmVudChfcmVtb3ZlZEV2ZW50KTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHJlbW92ZUZyb21QYXJlbnQoKSB7CiAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwogICAgICBpZiAocGFyZW50ICE9PSBudWxsKSB7CiAgICAgICAgcGFyZW50LnJlbW92ZSh0aGlzKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsZWFyKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBvYmplY3QgPSB0aGlzLmNoaWxkcmVuW2ldOwogICAgICAgIG9iamVjdC5wYXJlbnQgPSBudWxsOwogICAgICAgIG9iamVjdC5kaXNwYXRjaEV2ZW50KF9yZW1vdmVkRXZlbnQpOwogICAgICB9CiAgICAgIHRoaXMuY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBhdHRhY2gob2JqZWN0KSB7CiAgICAgIHRoaXMudXBkYXRlV29ybGRNYXRyaXgodHJ1ZSwgZmFsc2UpOwogICAgICBfbTEkMS5jb3B5KHRoaXMubWF0cml4V29ybGQpLmludmVydCgpOwogICAgICBpZiAob2JqZWN0LnBhcmVudCAhPT0gbnVsbCkgewogICAgICAgIG9iamVjdC5wYXJlbnQudXBkYXRlV29ybGRNYXRyaXgodHJ1ZSwgZmFsc2UpOwogICAgICAgIF9tMSQxLm11bHRpcGx5KG9iamVjdC5wYXJlbnQubWF0cml4V29ybGQpOwogICAgICB9CiAgICAgIG9iamVjdC5hcHBseU1hdHJpeDQoX20xJDEpOwogICAgICB0aGlzLmFkZChvYmplY3QpOwogICAgICBvYmplY3QudXBkYXRlV29ybGRNYXRyaXgoZmFsc2UsIHRydWUpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGdldE9iamVjdEJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0T2JqZWN0QnlQcm9wZXJ0eSgiaWQiLCBpZCk7CiAgICB9CiAgICBnZXRPYmplY3RCeU5hbWUobmFtZSkgewogICAgICByZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCJuYW1lIiwgbmFtZSk7CiAgICB9CiAgICBnZXRPYmplY3RCeVByb3BlcnR5KG5hbWUsIHZhbHVlKSB7CiAgICAgIGlmICh0aGlzW25hbWVdID09PSB2YWx1ZSkKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlbltpXTsKICAgICAgICBjb25zdCBvYmplY3QgPSBjaGlsZC5nZXRPYmplY3RCeVByb3BlcnR5KG5hbWUsIHZhbHVlKTsKICAgICAgICBpZiAob2JqZWN0ICE9PSB2b2lkIDApIHsKICAgICAgICAgIHJldHVybiBvYmplY3Q7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB2b2lkIDA7CiAgICB9CiAgICBnZXRXb3JsZFBvc2l0aW9uKHRhcmdldCkgewogICAgICB0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KHRydWUsIGZhbHNlKTsKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tTWF0cml4UG9zaXRpb24odGhpcy5tYXRyaXhXb3JsZCk7CiAgICB9CiAgICBnZXRXb3JsZFF1YXRlcm5pb24odGFyZ2V0KSB7CiAgICAgIHRoaXMudXBkYXRlV29ybGRNYXRyaXgodHJ1ZSwgZmFsc2UpOwogICAgICB0aGlzLm1hdHJpeFdvcmxkLmRlY29tcG9zZShfcG9zaXRpb24kMywgdGFyZ2V0LCBfc2NhbGUkMik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICBnZXRXb3JsZFNjYWxlKHRhcmdldCkgewogICAgICB0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KHRydWUsIGZhbHNlKTsKICAgICAgdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoX3Bvc2l0aW9uJDMsIF9xdWF0ZXJuaW9uJDIsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICBnZXRXb3JsZERpcmVjdGlvbih0YXJnZXQpIHsKICAgICAgdGhpcy51cGRhdGVXb3JsZE1hdHJpeCh0cnVlLCBmYWxzZSk7CiAgICAgIGNvbnN0IGUgPSB0aGlzLm1hdHJpeFdvcmxkLmVsZW1lbnRzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldChlWzhdLCBlWzldLCBlWzEwXSkubm9ybWFsaXplKCk7CiAgICB9CiAgICByYXljYXN0KCkgewogICAgfQogICAgdHJhdmVyc2UoY2FsbGJhY2spIHsKICAgICAgY2FsbGJhY2sodGhpcyk7CiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjaGlsZHJlbltpXS50cmF2ZXJzZShjYWxsYmFjayk7CiAgICAgIH0KICAgIH0KICAgIHRyYXZlcnNlVmlzaWJsZShjYWxsYmFjaykgewogICAgICBpZiAodGhpcy52aXNpYmxlID09PSBmYWxzZSkKICAgICAgICByZXR1cm47CiAgICAgIGNhbGxiYWNrKHRoaXMpOwogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY2hpbGRyZW5baV0udHJhdmVyc2VWaXNpYmxlKGNhbGxiYWNrKTsKICAgICAgfQogICAgfQogICAgdHJhdmVyc2VBbmNlc3RvcnMoY2FsbGJhY2spIHsKICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CiAgICAgIGlmIChwYXJlbnQgIT09IG51bGwpIHsKICAgICAgICBjYWxsYmFjayhwYXJlbnQpOwogICAgICAgIHBhcmVudC50cmF2ZXJzZUFuY2VzdG9ycyhjYWxsYmFjayk7CiAgICAgIH0KICAgIH0KICAgIHVwZGF0ZU1hdHJpeCgpIHsKICAgICAgdGhpcy5tYXRyaXguY29tcG9zZSh0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHRoaXMuc2NhbGUpOwogICAgICB0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgfQogICAgdXBkYXRlTWF0cml4V29ybGQoZm9yY2UpIHsKICAgICAgaWYgKHRoaXMubWF0cml4QXV0b1VwZGF0ZSkKICAgICAgICB0aGlzLnVwZGF0ZU1hdHJpeCgpOwogICAgICBpZiAodGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlIHx8IGZvcmNlKSB7CiAgICAgICAgaWYgKHRoaXMucGFyZW50ID09PSBudWxsKSB7CiAgICAgICAgICB0aGlzLm1hdHJpeFdvcmxkLmNvcHkodGhpcy5tYXRyaXgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXModGhpcy5wYXJlbnQubWF0cml4V29ybGQsIHRoaXMubWF0cml4KTsKICAgICAgICB9CiAgICAgICAgdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICAgICAgZm9yY2UgPSB0cnVlOwogICAgICB9CiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjaGlsZHJlbltpXS51cGRhdGVNYXRyaXhXb3JsZChmb3JjZSk7CiAgICAgIH0KICAgIH0KICAgIHVwZGF0ZVdvcmxkTWF0cml4KHVwZGF0ZVBhcmVudHMsIHVwZGF0ZUNoaWxkcmVuKSB7CiAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwogICAgICBpZiAodXBkYXRlUGFyZW50cyA9PT0gdHJ1ZSAmJiBwYXJlbnQgIT09IG51bGwpIHsKICAgICAgICBwYXJlbnQudXBkYXRlV29ybGRNYXRyaXgodHJ1ZSwgZmFsc2UpOwogICAgICB9CiAgICAgIGlmICh0aGlzLm1hdHJpeEF1dG9VcGRhdGUpCiAgICAgICAgdGhpcy51cGRhdGVNYXRyaXgoKTsKICAgICAgaWYgKHRoaXMucGFyZW50ID09PSBudWxsKSB7CiAgICAgICAgdGhpcy5tYXRyaXhXb3JsZC5jb3B5KHRoaXMubWF0cml4KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXModGhpcy5wYXJlbnQubWF0cml4V29ybGQsIHRoaXMubWF0cml4KTsKICAgICAgfQogICAgICBpZiAodXBkYXRlQ2hpbGRyZW4gPT09IHRydWUpIHsKICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGNoaWxkcmVuW2ldLnVwZGF0ZVdvcmxkTWF0cml4KGZhbHNlLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRvSlNPTihtZXRhKSB7CiAgICAgIGNvbnN0IGlzUm9vdE9iamVjdCA9IG1ldGEgPT09IHZvaWQgMCB8fCB0eXBlb2YgbWV0YSA9PT0gInN0cmluZyI7CiAgICAgIGNvbnN0IG91dHB1dCA9IHt9OwogICAgICBpZiAoaXNSb290T2JqZWN0KSB7CiAgICAgICAgbWV0YSA9IHsKICAgICAgICAgIGdlb21ldHJpZXM6IHt9LAogICAgICAgICAgbWF0ZXJpYWxzOiB7fSwKICAgICAgICAgIHRleHR1cmVzOiB7fSwKICAgICAgICAgIGltYWdlczoge30sCiAgICAgICAgICBzaGFwZXM6IHt9LAogICAgICAgICAgc2tlbGV0b25zOiB7fSwKICAgICAgICAgIGFuaW1hdGlvbnM6IHt9CiAgICAgICAgfTsKICAgICAgICBvdXRwdXQubWV0YWRhdGEgPSB7CiAgICAgICAgICB2ZXJzaW9uOiA0LjUsCiAgICAgICAgICB0eXBlOiAiT2JqZWN0IiwKICAgICAgICAgIGdlbmVyYXRvcjogIk9iamVjdDNELnRvSlNPTiIKICAgICAgICB9OwogICAgICB9CiAgICAgIGNvbnN0IG9iamVjdCA9IHt9OwogICAgICBvYmplY3QudXVpZCA9IHRoaXMudXVpZDsKICAgICAgb2JqZWN0LnR5cGUgPSB0aGlzLnR5cGU7CiAgICAgIGlmICh0aGlzLm5hbWUgIT09ICIiKQogICAgICAgIG9iamVjdC5uYW1lID0gdGhpcy5uYW1lOwogICAgICBpZiAodGhpcy5jYXN0U2hhZG93ID09PSB0cnVlKQogICAgICAgIG9iamVjdC5jYXN0U2hhZG93ID0gdHJ1ZTsKICAgICAgaWYgKHRoaXMucmVjZWl2ZVNoYWRvdyA9PT0gdHJ1ZSkKICAgICAgICBvYmplY3QucmVjZWl2ZVNoYWRvdyA9IHRydWU7CiAgICAgIGlmICh0aGlzLnZpc2libGUgPT09IGZhbHNlKQogICAgICAgIG9iamVjdC52aXNpYmxlID0gZmFsc2U7CiAgICAgIGlmICh0aGlzLmZydXN0dW1DdWxsZWQgPT09IGZhbHNlKQogICAgICAgIG9iamVjdC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7CiAgICAgIGlmICh0aGlzLnJlbmRlck9yZGVyICE9PSAwKQogICAgICAgIG9iamVjdC5yZW5kZXJPcmRlciA9IHRoaXMucmVuZGVyT3JkZXI7CiAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLnVzZXJEYXRhKSAhPT0gInt9IikKICAgICAgICBvYmplY3QudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwogICAgICBvYmplY3QubGF5ZXJzID0gdGhpcy5sYXllcnMubWFzazsKICAgICAgb2JqZWN0Lm1hdHJpeCA9IHRoaXMubWF0cml4LnRvQXJyYXkoKTsKICAgICAgaWYgKHRoaXMubWF0cml4QXV0b1VwZGF0ZSA9PT0gZmFsc2UpCiAgICAgICAgb2JqZWN0Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKICAgICAgaWYgKHRoaXMuaXNJbnN0YW5jZWRNZXNoKSB7CiAgICAgICAgb2JqZWN0LnR5cGUgPSAiSW5zdGFuY2VkTWVzaCI7CiAgICAgICAgb2JqZWN0LmNvdW50ID0gdGhpcy5jb3VudDsKICAgICAgICBvYmplY3QuaW5zdGFuY2VNYXRyaXggPSB0aGlzLmluc3RhbmNlTWF0cml4LnRvSlNPTigpOwogICAgICAgIGlmICh0aGlzLmluc3RhbmNlQ29sb3IgIT09IG51bGwpCiAgICAgICAgICBvYmplY3QuaW5zdGFuY2VDb2xvciA9IHRoaXMuaW5zdGFuY2VDb2xvci50b0pTT04oKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBzZXJpYWxpemUobGlicmFyeSwgZWxlbWVudCkgewogICAgICAgIGlmIChsaWJyYXJ5W2VsZW1lbnQudXVpZF0gPT09IHZvaWQgMCkgewogICAgICAgICAgbGlicmFyeVtlbGVtZW50LnV1aWRdID0gZWxlbWVudC50b0pTT04obWV0YSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlbGVtZW50LnV1aWQ7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuaXNTY2VuZSkgewogICAgICAgIGlmICh0aGlzLmJhY2tncm91bmQpIHsKICAgICAgICAgIGlmICh0aGlzLmJhY2tncm91bmQuaXNDb2xvcikgewogICAgICAgICAgICBvYmplY3QuYmFja2dyb3VuZCA9IHRoaXMuYmFja2dyb3VuZC50b0pTT04oKTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5iYWNrZ3JvdW5kLmlzVGV4dHVyZSkgewogICAgICAgICAgICBvYmplY3QuYmFja2dyb3VuZCA9IHRoaXMuYmFja2dyb3VuZC50b0pTT04obWV0YSkudXVpZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuZW52aXJvbm1lbnQgJiYgdGhpcy5lbnZpcm9ubWVudC5pc1RleHR1cmUpIHsKICAgICAgICAgIG9iamVjdC5lbnZpcm9ubWVudCA9IHRoaXMuZW52aXJvbm1lbnQudG9KU09OKG1ldGEpLnV1aWQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNNZXNoIHx8IHRoaXMuaXNMaW5lIHx8IHRoaXMuaXNQb2ludHMpIHsKICAgICAgICBvYmplY3QuZ2VvbWV0cnkgPSBzZXJpYWxpemUobWV0YS5nZW9tZXRyaWVzLCB0aGlzLmdlb21ldHJ5KTsKICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5nZW9tZXRyeS5wYXJhbWV0ZXJzOwogICAgICAgIGlmIChwYXJhbWV0ZXJzICE9PSB2b2lkIDAgJiYgcGFyYW1ldGVycy5zaGFwZXMgIT09IHZvaWQgMCkgewogICAgICAgICAgY29uc3Qgc2hhcGVzID0gcGFyYW1ldGVycy5zaGFwZXM7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzaGFwZXMpKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc2hhcGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgICAgICAgIHNlcmlhbGl6ZShtZXRhLnNoYXBlcywgc2hhcGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXJpYWxpemUobWV0YS5zaGFwZXMsIHNoYXBlcyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLmlzU2tpbm5lZE1lc2gpIHsKICAgICAgICBvYmplY3QuYmluZE1vZGUgPSB0aGlzLmJpbmRNb2RlOwogICAgICAgIG9iamVjdC5iaW5kTWF0cml4ID0gdGhpcy5iaW5kTWF0cml4LnRvQXJyYXkoKTsKICAgICAgICBpZiAodGhpcy5za2VsZXRvbiAhPT0gdm9pZCAwKSB7CiAgICAgICAgICBzZXJpYWxpemUobWV0YS5za2VsZXRvbnMsIHRoaXMuc2tlbGV0b24pOwogICAgICAgICAgb2JqZWN0LnNrZWxldG9uID0gdGhpcy5za2VsZXRvbi51dWlkOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGhpcy5tYXRlcmlhbCAhPT0gdm9pZCAwKSB7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5tYXRlcmlhbCkpIHsKICAgICAgICAgIGNvbnN0IHV1aWRzID0gW107CiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHRoaXMubWF0ZXJpYWwubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIHV1aWRzLnB1c2goc2VyaWFsaXplKG1ldGEubWF0ZXJpYWxzLCB0aGlzLm1hdGVyaWFsW2ldKSk7CiAgICAgICAgICB9CiAgICAgICAgICBvYmplY3QubWF0ZXJpYWwgPSB1dWlkczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb2JqZWN0Lm1hdGVyaWFsID0gc2VyaWFsaXplKG1ldGEubWF0ZXJpYWxzLCB0aGlzLm1hdGVyaWFsKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgIG9iamVjdC5jaGlsZHJlbiA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgb2JqZWN0LmNoaWxkcmVuLnB1c2godGhpcy5jaGlsZHJlbltpXS50b0pTT04obWV0YSkub2JqZWN0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYW5pbWF0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgb2JqZWN0LmFuaW1hdGlvbnMgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYW5pbWF0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgY29uc3QgYW5pbWF0aW9uID0gdGhpcy5hbmltYXRpb25zW2ldOwogICAgICAgICAgb2JqZWN0LmFuaW1hdGlvbnMucHVzaChzZXJpYWxpemUobWV0YS5hbmltYXRpb25zLCBhbmltYXRpb24pKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGlzUm9vdE9iamVjdCkgewogICAgICAgIGNvbnN0IGdlb21ldHJpZXMgPSBleHRyYWN0RnJvbUNhY2hlKG1ldGEuZ2VvbWV0cmllcyk7CiAgICAgICAgY29uc3QgbWF0ZXJpYWxzID0gZXh0cmFjdEZyb21DYWNoZShtZXRhLm1hdGVyaWFscyk7CiAgICAgICAgY29uc3QgdGV4dHVyZXMgPSBleHRyYWN0RnJvbUNhY2hlKG1ldGEudGV4dHVyZXMpOwogICAgICAgIGNvbnN0IGltYWdlcyA9IGV4dHJhY3RGcm9tQ2FjaGUobWV0YS5pbWFnZXMpOwogICAgICAgIGNvbnN0IHNoYXBlcyA9IGV4dHJhY3RGcm9tQ2FjaGUobWV0YS5zaGFwZXMpOwogICAgICAgIGNvbnN0IHNrZWxldG9ucyA9IGV4dHJhY3RGcm9tQ2FjaGUobWV0YS5za2VsZXRvbnMpOwogICAgICAgIGNvbnN0IGFuaW1hdGlvbnMgPSBleHRyYWN0RnJvbUNhY2hlKG1ldGEuYW5pbWF0aW9ucyk7CiAgICAgICAgaWYgKGdlb21ldHJpZXMubGVuZ3RoID4gMCkKICAgICAgICAgIG91dHB1dC5nZW9tZXRyaWVzID0gZ2VvbWV0cmllczsKICAgICAgICBpZiAobWF0ZXJpYWxzLmxlbmd0aCA+IDApCiAgICAgICAgICBvdXRwdXQubWF0ZXJpYWxzID0gbWF0ZXJpYWxzOwogICAgICAgIGlmICh0ZXh0dXJlcy5sZW5ndGggPiAwKQogICAgICAgICAgb3V0cHV0LnRleHR1cmVzID0gdGV4dHVyZXM7CiAgICAgICAgaWYgKGltYWdlcy5sZW5ndGggPiAwKQogICAgICAgICAgb3V0cHV0LmltYWdlcyA9IGltYWdlczsKICAgICAgICBpZiAoc2hhcGVzLmxlbmd0aCA+IDApCiAgICAgICAgICBvdXRwdXQuc2hhcGVzID0gc2hhcGVzOwogICAgICAgIGlmIChza2VsZXRvbnMubGVuZ3RoID4gMCkKICAgICAgICAgIG91dHB1dC5za2VsZXRvbnMgPSBza2VsZXRvbnM7CiAgICAgICAgaWYgKGFuaW1hdGlvbnMubGVuZ3RoID4gMCkKICAgICAgICAgIG91dHB1dC5hbmltYXRpb25zID0gYW5pbWF0aW9uczsKICAgICAgfQogICAgICBvdXRwdXQub2JqZWN0ID0gb2JqZWN0OwogICAgICByZXR1cm4gb3V0cHV0OwogICAgICBmdW5jdGlvbiBleHRyYWN0RnJvbUNhY2hlKGNhY2hlKSB7CiAgICAgICAgY29uc3QgdmFsdWVzID0gW107CiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gY2FjaGUpIHsKICAgICAgICAgIGNvbnN0IGRhdGEgPSBjYWNoZVtrZXldOwogICAgICAgICAgZGVsZXRlIGRhdGEubWV0YWRhdGE7CiAgICAgICAgICB2YWx1ZXMucHVzaChkYXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlczsKICAgICAgfQogICAgfQogICAgY2xvbmUocmVjdXJzaXZlKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcywgcmVjdXJzaXZlKTsKICAgIH0KICAgIGNvcHkoc291cmNlLCByZWN1cnNpdmUgPSB0cnVlKSB7CiAgICAgIHRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwogICAgICB0aGlzLnVwLmNvcHkoc291cmNlLnVwKTsKICAgICAgdGhpcy5wb3NpdGlvbi5jb3B5KHNvdXJjZS5wb3NpdGlvbik7CiAgICAgIHRoaXMucm90YXRpb24ub3JkZXIgPSBzb3VyY2Uucm90YXRpb24ub3JkZXI7CiAgICAgIHRoaXMucXVhdGVybmlvbi5jb3B5KHNvdXJjZS5xdWF0ZXJuaW9uKTsKICAgICAgdGhpcy5zY2FsZS5jb3B5KHNvdXJjZS5zY2FsZSk7CiAgICAgIHRoaXMubWF0cml4LmNvcHkoc291cmNlLm1hdHJpeCk7CiAgICAgIHRoaXMubWF0cml4V29ybGQuY29weShzb3VyY2UubWF0cml4V29ybGQpOwogICAgICB0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKICAgICAgdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gc291cmNlLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGU7CiAgICAgIHRoaXMubGF5ZXJzLm1hc2sgPSBzb3VyY2UubGF5ZXJzLm1hc2s7CiAgICAgIHRoaXMudmlzaWJsZSA9IHNvdXJjZS52aXNpYmxlOwogICAgICB0aGlzLmNhc3RTaGFkb3cgPSBzb3VyY2UuY2FzdFNoYWRvdzsKICAgICAgdGhpcy5yZWNlaXZlU2hhZG93ID0gc291cmNlLnJlY2VpdmVTaGFkb3c7CiAgICAgIHRoaXMuZnJ1c3R1bUN1bGxlZCA9IHNvdXJjZS5mcnVzdHVtQ3VsbGVkOwogICAgICB0aGlzLnJlbmRlck9yZGVyID0gc291cmNlLnJlbmRlck9yZGVyOwogICAgICB0aGlzLnVzZXJEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShzb3VyY2UudXNlckRhdGEpKTsKICAgICAgaWYgKHJlY3Vyc2l2ZSA9PT0gdHJ1ZSkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjaGlsZCA9IHNvdXJjZS5jaGlsZHJlbltpXTsKICAgICAgICAgIHRoaXMuYWRkKGNoaWxkLmNsb25lKCkpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIE9iamVjdDNELkRlZmF1bHRVcCA9IG5ldyBWZWN0b3IzKDAsIDEsIDApOwogIE9iamVjdDNELkRlZmF1bHRNYXRyaXhBdXRvVXBkYXRlID0gdHJ1ZTsKICBPYmplY3QzRC5wcm90b3R5cGUuaXNPYmplY3QzRCA9IHRydWU7CiAgdmFyIF92MCQxID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF92MSQzID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF92MiQyID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF92MyQxID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF92YWIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX3ZhYyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfdmJjID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF92YXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX3ZicCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfdmNwID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIFRyaWFuZ2xlID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSA9IG5ldyBWZWN0b3IzKCksIGIgPSBuZXcgVmVjdG9yMygpLCBjID0gbmV3IFZlY3RvcjMoKSkgewogICAgICB0aGlzLmEgPSBhOwogICAgICB0aGlzLmIgPSBiOwogICAgICB0aGlzLmMgPSBjOwogICAgfQogICAgc3RhdGljIGdldE5vcm1hbChhLCBiLCBjLCB0YXJnZXQpIHsKICAgICAgdGFyZ2V0LnN1YlZlY3RvcnMoYywgYik7CiAgICAgIF92MCQxLnN1YlZlY3RvcnMoYSwgYik7CiAgICAgIHRhcmdldC5jcm9zcyhfdjAkMSk7CiAgICAgIGNvbnN0IHRhcmdldExlbmd0aFNxID0gdGFyZ2V0Lmxlbmd0aFNxKCk7CiAgICAgIGlmICh0YXJnZXRMZW5ndGhTcSA+IDApIHsKICAgICAgICByZXR1cm4gdGFyZ2V0Lm11bHRpcGx5U2NhbGFyKDEgLyBNYXRoLnNxcnQodGFyZ2V0TGVuZ3RoU3EpKTsKICAgICAgfQogICAgICByZXR1cm4gdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgIH0KICAgIHN0YXRpYyBnZXRCYXJ5Y29vcmQocG9pbnQsIGEsIGIsIGMsIHRhcmdldCkgewogICAgICBfdjAkMS5zdWJWZWN0b3JzKGMsIGEpOwogICAgICBfdjEkMy5zdWJWZWN0b3JzKGIsIGEpOwogICAgICBfdjIkMi5zdWJWZWN0b3JzKHBvaW50LCBhKTsKICAgICAgY29uc3QgZG90MDAgPSBfdjAkMS5kb3QoX3YwJDEpOwogICAgICBjb25zdCBkb3QwMSA9IF92MCQxLmRvdChfdjEkMyk7CiAgICAgIGNvbnN0IGRvdDAyID0gX3YwJDEuZG90KF92MiQyKTsKICAgICAgY29uc3QgZG90MTEgPSBfdjEkMy5kb3QoX3YxJDMpOwogICAgICBjb25zdCBkb3QxMiA9IF92MSQzLmRvdChfdjIkMik7CiAgICAgIGNvbnN0IGRlbm9tID0gZG90MDAgKiBkb3QxMSAtIGRvdDAxICogZG90MDE7CiAgICAgIGlmIChkZW5vbSA9PT0gMCkgewogICAgICAgIHJldHVybiB0YXJnZXQuc2V0KC0yLCAtMSwgLTEpOwogICAgICB9CiAgICAgIGNvbnN0IGludkRlbm9tID0gMSAvIGRlbm9tOwogICAgICBjb25zdCB1ID0gKGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyKSAqIGludkRlbm9tOwogICAgICBjb25zdCB2ID0gKGRvdDAwICogZG90MTIgLSBkb3QwMSAqIGRvdDAyKSAqIGludkRlbm9tOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxIC0gdSAtIHYsIHYsIHUpOwogICAgfQogICAgc3RhdGljIGNvbnRhaW5zUG9pbnQocG9pbnQsIGEsIGIsIGMpIHsKICAgICAgdGhpcy5nZXRCYXJ5Y29vcmQocG9pbnQsIGEsIGIsIGMsIF92MyQxKTsKICAgICAgcmV0dXJuIF92MyQxLnggPj0gMCAmJiBfdjMkMS55ID49IDAgJiYgX3YzJDEueCArIF92MyQxLnkgPD0gMTsKICAgIH0KICAgIHN0YXRpYyBnZXRVVihwb2ludCwgcDEsIHAyLCBwMywgdXYxLCB1djIsIHV2MywgdGFyZ2V0KSB7CiAgICAgIHRoaXMuZ2V0QmFyeWNvb3JkKHBvaW50LCBwMSwgcDIsIHAzLCBfdjMkMSk7CiAgICAgIHRhcmdldC5zZXQoMCwgMCk7CiAgICAgIHRhcmdldC5hZGRTY2FsZWRWZWN0b3IodXYxLCBfdjMkMS54KTsKICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3Rvcih1djIsIF92MyQxLnkpOwogICAgICB0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKHV2MywgX3YzJDEueik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICBzdGF0aWMgaXNGcm9udEZhY2luZyhhLCBiLCBjLCBkaXJlY3Rpb24pIHsKICAgICAgX3YwJDEuc3ViVmVjdG9ycyhjLCBiKTsKICAgICAgX3YxJDMuc3ViVmVjdG9ycyhhLCBiKTsKICAgICAgcmV0dXJuIF92MCQxLmNyb3NzKF92MSQzKS5kb3QoZGlyZWN0aW9uKSA8IDAgPyB0cnVlIDogZmFsc2U7CiAgICB9CiAgICBzZXQoYSwgYiwgYykgewogICAgICB0aGlzLmEuY29weShhKTsKICAgICAgdGhpcy5iLmNvcHkoYik7CiAgICAgIHRoaXMuYy5jb3B5KGMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21Qb2ludHNBbmRJbmRpY2VzKHBvaW50cywgaTAsIGkxLCBpMikgewogICAgICB0aGlzLmEuY29weShwb2ludHNbaTBdKTsKICAgICAgdGhpcy5iLmNvcHkocG9pbnRzW2kxXSk7CiAgICAgIHRoaXMuYy5jb3B5KHBvaW50c1tpMl0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpOwogICAgfQogICAgY29weSh0cmlhbmdsZSkgewogICAgICB0aGlzLmEuY29weSh0cmlhbmdsZS5hKTsKICAgICAgdGhpcy5iLmNvcHkodHJpYW5nbGUuYik7CiAgICAgIHRoaXMuYy5jb3B5KHRyaWFuZ2xlLmMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGdldEFyZWEoKSB7CiAgICAgIF92MCQxLnN1YlZlY3RvcnModGhpcy5jLCB0aGlzLmIpOwogICAgICBfdjEkMy5zdWJWZWN0b3JzKHRoaXMuYSwgdGhpcy5iKTsKICAgICAgcmV0dXJuIF92MCQxLmNyb3NzKF92MSQzKS5sZW5ndGgoKSAqIDAuNTsKICAgIH0KICAgIGdldE1pZHBvaW50KHRhcmdldCkgewogICAgICByZXR1cm4gdGFyZ2V0LmFkZFZlY3RvcnModGhpcy5hLCB0aGlzLmIpLmFkZCh0aGlzLmMpLm11bHRpcGx5U2NhbGFyKDEgLyAzKTsKICAgIH0KICAgIGdldE5vcm1hbCh0YXJnZXQpIHsKICAgICAgcmV0dXJuIFRyaWFuZ2xlLmdldE5vcm1hbCh0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB0YXJnZXQpOwogICAgfQogICAgZ2V0UGxhbmUodGFyZ2V0KSB7CiAgICAgIHJldHVybiB0YXJnZXQuc2V0RnJvbUNvcGxhbmFyUG9pbnRzKHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMpOwogICAgfQogICAgZ2V0QmFyeWNvb3JkKHBvaW50LCB0YXJnZXQpIHsKICAgICAgcmV0dXJuIFRyaWFuZ2xlLmdldEJhcnljb29yZChwb2ludCwgdGhpcy5hLCB0aGlzLmIsIHRoaXMuYywgdGFyZ2V0KTsKICAgIH0KICAgIGdldFVWKHBvaW50LCB1djEsIHV2MiwgdXYzLCB0YXJnZXQpIHsKICAgICAgcmV0dXJuIFRyaWFuZ2xlLmdldFVWKHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB1djEsIHV2MiwgdXYzLCB0YXJnZXQpOwogICAgfQogICAgY29udGFpbnNQb2ludChwb2ludCkgewogICAgICByZXR1cm4gVHJpYW5nbGUuY29udGFpbnNQb2ludChwb2ludCwgdGhpcy5hLCB0aGlzLmIsIHRoaXMuYyk7CiAgICB9CiAgICBpc0Zyb250RmFjaW5nKGRpcmVjdGlvbikgewogICAgICByZXR1cm4gVHJpYW5nbGUuaXNGcm9udEZhY2luZyh0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCBkaXJlY3Rpb24pOwogICAgfQogICAgaW50ZXJzZWN0c0JveChib3gpIHsKICAgICAgcmV0dXJuIGJveC5pbnRlcnNlY3RzVHJpYW5nbGUodGhpcyk7CiAgICB9CiAgICBjbG9zZXN0UG9pbnRUb1BvaW50KHAsIHRhcmdldCkgewogICAgICBjb25zdCBhID0gdGhpcy5hLCBiID0gdGhpcy5iLCBjID0gdGhpcy5jOwogICAgICBsZXQgdiwgdzsKICAgICAgX3ZhYi5zdWJWZWN0b3JzKGIsIGEpOwogICAgICBfdmFjLnN1YlZlY3RvcnMoYywgYSk7CiAgICAgIF92YXAuc3ViVmVjdG9ycyhwLCBhKTsKICAgICAgY29uc3QgZDEgPSBfdmFiLmRvdChfdmFwKTsKICAgICAgY29uc3QgZDIgPSBfdmFjLmRvdChfdmFwKTsKICAgICAgaWYgKGQxIDw9IDAgJiYgZDIgPD0gMCkgewogICAgICAgIHJldHVybiB0YXJnZXQuY29weShhKTsKICAgICAgfQogICAgICBfdmJwLnN1YlZlY3RvcnMocCwgYik7CiAgICAgIGNvbnN0IGQzID0gX3ZhYi5kb3QoX3ZicCk7CiAgICAgIGNvbnN0IGQ0ID0gX3ZhYy5kb3QoX3ZicCk7CiAgICAgIGlmIChkMyA+PSAwICYmIGQ0IDw9IGQzKSB7CiAgICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KGIpOwogICAgICB9CiAgICAgIGNvbnN0IHZjID0gZDEgKiBkNCAtIGQzICogZDI7CiAgICAgIGlmICh2YyA8PSAwICYmIGQxID49IDAgJiYgZDMgPD0gMCkgewogICAgICAgIHYgPSBkMSAvIChkMSAtIGQzKTsKICAgICAgICByZXR1cm4gdGFyZ2V0LmNvcHkoYSkuYWRkU2NhbGVkVmVjdG9yKF92YWIsIHYpOwogICAgICB9CiAgICAgIF92Y3Auc3ViVmVjdG9ycyhwLCBjKTsKICAgICAgY29uc3QgZDUgPSBfdmFiLmRvdChfdmNwKTsKICAgICAgY29uc3QgZDYgPSBfdmFjLmRvdChfdmNwKTsKICAgICAgaWYgKGQ2ID49IDAgJiYgZDUgPD0gZDYpIHsKICAgICAgICByZXR1cm4gdGFyZ2V0LmNvcHkoYyk7CiAgICAgIH0KICAgICAgY29uc3QgdmIgPSBkNSAqIGQyIC0gZDEgKiBkNjsKICAgICAgaWYgKHZiIDw9IDAgJiYgZDIgPj0gMCAmJiBkNiA8PSAwKSB7CiAgICAgICAgdyA9IGQyIC8gKGQyIC0gZDYpOwogICAgICAgIHJldHVybiB0YXJnZXQuY29weShhKS5hZGRTY2FsZWRWZWN0b3IoX3ZhYywgdyk7CiAgICAgIH0KICAgICAgY29uc3QgdmEgPSBkMyAqIGQ2IC0gZDUgKiBkNDsKICAgICAgaWYgKHZhIDw9IDAgJiYgZDQgLSBkMyA+PSAwICYmIGQ1IC0gZDYgPj0gMCkgewogICAgICAgIF92YmMuc3ViVmVjdG9ycyhjLCBiKTsKICAgICAgICB3ID0gKGQ0IC0gZDMpIC8gKGQ0IC0gZDMgKyAoZDUgLSBkNikpOwogICAgICAgIHJldHVybiB0YXJnZXQuY29weShiKS5hZGRTY2FsZWRWZWN0b3IoX3ZiYywgdyk7CiAgICAgIH0KICAgICAgY29uc3QgZGVub20gPSAxIC8gKHZhICsgdmIgKyB2Yyk7CiAgICAgIHYgPSB2YiAqIGRlbm9tOwogICAgICB3ID0gdmMgKiBkZW5vbTsKICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KGEpLmFkZFNjYWxlZFZlY3RvcihfdmFiLCB2KS5hZGRTY2FsZWRWZWN0b3IoX3ZhYywgdyk7CiAgICB9CiAgICBlcXVhbHModHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIHRyaWFuZ2xlLmEuZXF1YWxzKHRoaXMuYSkgJiYgdHJpYW5nbGUuYi5lcXVhbHModGhpcy5iKSAmJiB0cmlhbmdsZS5jLmVxdWFscyh0aGlzLmMpOwogICAgfQogIH07CiAgdmFyIG1hdGVyaWFsSWQgPSAwOwogIHZhciBNYXRlcmlhbCA9IGNsYXNzIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcigpOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgImlkIiwgeyB2YWx1ZTogbWF0ZXJpYWxJZCsrIH0pOwogICAgICB0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKICAgICAgdGhpcy5uYW1lID0gIiI7CiAgICAgIHRoaXMudHlwZSA9ICJNYXRlcmlhbCI7CiAgICAgIHRoaXMuZm9nID0gdHJ1ZTsKICAgICAgdGhpcy5ibGVuZGluZyA9IE5vcm1hbEJsZW5kaW5nOwogICAgICB0aGlzLnNpZGUgPSBGcm9udFNpZGU7CiAgICAgIHRoaXMudmVydGV4Q29sb3JzID0gZmFsc2U7CiAgICAgIHRoaXMub3BhY2l0eSA9IDE7CiAgICAgIHRoaXMudHJhbnNwYXJlbnQgPSBmYWxzZTsKICAgICAgdGhpcy5ibGVuZFNyYyA9IFNyY0FscGhhRmFjdG9yOwogICAgICB0aGlzLmJsZW5kRHN0ID0gT25lTWludXNTcmNBbHBoYUZhY3RvcjsKICAgICAgdGhpcy5ibGVuZEVxdWF0aW9uID0gQWRkRXF1YXRpb247CiAgICAgIHRoaXMuYmxlbmRTcmNBbHBoYSA9IG51bGw7CiAgICAgIHRoaXMuYmxlbmREc3RBbHBoYSA9IG51bGw7CiAgICAgIHRoaXMuYmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKICAgICAgdGhpcy5kZXB0aEZ1bmMgPSBMZXNzRXF1YWxEZXB0aDsKICAgICAgdGhpcy5kZXB0aFRlc3QgPSB0cnVlOwogICAgICB0aGlzLmRlcHRoV3JpdGUgPSB0cnVlOwogICAgICB0aGlzLnN0ZW5jaWxXcml0ZU1hc2sgPSAyNTU7CiAgICAgIHRoaXMuc3RlbmNpbEZ1bmMgPSBBbHdheXNTdGVuY2lsRnVuYzsKICAgICAgdGhpcy5zdGVuY2lsUmVmID0gMDsKICAgICAgdGhpcy5zdGVuY2lsRnVuY01hc2sgPSAyNTU7CiAgICAgIHRoaXMuc3RlbmNpbEZhaWwgPSBLZWVwU3RlbmNpbE9wOwogICAgICB0aGlzLnN0ZW5jaWxaRmFpbCA9IEtlZXBTdGVuY2lsT3A7CiAgICAgIHRoaXMuc3RlbmNpbFpQYXNzID0gS2VlcFN0ZW5jaWxPcDsKICAgICAgdGhpcy5zdGVuY2lsV3JpdGUgPSBmYWxzZTsKICAgICAgdGhpcy5jbGlwcGluZ1BsYW5lcyA9IG51bGw7CiAgICAgIHRoaXMuY2xpcEludGVyc2VjdGlvbiA9IGZhbHNlOwogICAgICB0aGlzLmNsaXBTaGFkb3dzID0gZmFsc2U7CiAgICAgIHRoaXMuc2hhZG93U2lkZSA9IG51bGw7CiAgICAgIHRoaXMuY29sb3JXcml0ZSA9IHRydWU7CiAgICAgIHRoaXMucHJlY2lzaW9uID0gbnVsbDsKICAgICAgdGhpcy5wb2x5Z29uT2Zmc2V0ID0gZmFsc2U7CiAgICAgIHRoaXMucG9seWdvbk9mZnNldEZhY3RvciA9IDA7CiAgICAgIHRoaXMucG9seWdvbk9mZnNldFVuaXRzID0gMDsKICAgICAgdGhpcy5kaXRoZXJpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5hbHBoYVRlc3QgPSAwOwogICAgICB0aGlzLmFscGhhVG9Db3ZlcmFnZSA9IGZhbHNlOwogICAgICB0aGlzLnByZW11bHRpcGxpZWRBbHBoYSA9IGZhbHNlOwogICAgICB0aGlzLnZpc2libGUgPSB0cnVlOwogICAgICB0aGlzLnRvbmVNYXBwZWQgPSB0cnVlOwogICAgICB0aGlzLnVzZXJEYXRhID0ge307CiAgICAgIHRoaXMudmVyc2lvbiA9IDA7CiAgICB9CiAgICBvbkJ1aWxkKCkgewogICAgfQogICAgb25CZWZvcmVDb21waWxlKCkgewogICAgfQogICAgY3VzdG9tUHJvZ3JhbUNhY2hlS2V5KCkgewogICAgICByZXR1cm4gdGhpcy5vbkJlZm9yZUNvbXBpbGUudG9TdHJpbmcoKTsKICAgIH0KICAgIHNldFZhbHVlcyh2YWx1ZXMpIHsKICAgICAgaWYgKHZhbHVlcyA9PT0gdm9pZCAwKQogICAgICAgIHJldHVybjsKICAgICAgZm9yIChjb25zdCBrZXkgaW4gdmFsdWVzKSB7CiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSB2YWx1ZXNba2V5XTsKICAgICAgICBpZiAobmV3VmFsdWUgPT09IHZvaWQgMCkgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5NYXRlcmlhbDogJyIgKyBrZXkgKyAiJyBwYXJhbWV0ZXIgaXMgdW5kZWZpbmVkLiIpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChrZXkgPT09ICJzaGFkaW5nIikgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS4iICsgdGhpcy50eXBlICsgIjogLnNoYWRpbmcgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIHRoZSBib29sZWFuIC5mbGF0U2hhZGluZyBpbnN0ZWFkLiIpOwogICAgICAgICAgdGhpcy5mbGF0U2hhZGluZyA9IG5ld1ZhbHVlID09PSBGbGF0U2hhZGluZyA/IHRydWUgOiBmYWxzZTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSB0aGlzW2tleV07CiAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLiIgKyB0aGlzLnR5cGUgKyAiOiAnIiArIGtleSArICInIGlzIG5vdCBhIHByb3BlcnR5IG9mIHRoaXMgbWF0ZXJpYWwuIik7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSAmJiBjdXJyZW50VmFsdWUuaXNDb2xvcikgewogICAgICAgICAgY3VycmVudFZhbHVlLnNldChuZXdWYWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzVmVjdG9yMyAmJiAobmV3VmFsdWUgJiYgbmV3VmFsdWUuaXNWZWN0b3IzKSkgewogICAgICAgICAgY3VycmVudFZhbHVlLmNvcHkobmV3VmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzW2tleV0gPSBuZXdWYWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRvSlNPTihtZXRhKSB7CiAgICAgIGNvbnN0IGlzUm9vdCA9IG1ldGEgPT09IHZvaWQgMCB8fCB0eXBlb2YgbWV0YSA9PT0gInN0cmluZyI7CiAgICAgIGlmIChpc1Jvb3QpIHsKICAgICAgICBtZXRhID0gewogICAgICAgICAgdGV4dHVyZXM6IHt9LAogICAgICAgICAgaW1hZ2VzOiB7fQogICAgICAgIH07CiAgICAgIH0KICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICBtZXRhZGF0YTogewogICAgICAgICAgdmVyc2lvbjogNC41LAogICAgICAgICAgdHlwZTogIk1hdGVyaWFsIiwKICAgICAgICAgIGdlbmVyYXRvcjogIk1hdGVyaWFsLnRvSlNPTiIKICAgICAgICB9CiAgICAgIH07CiAgICAgIGRhdGEudXVpZCA9IHRoaXMudXVpZDsKICAgICAgZGF0YS50eXBlID0gdGhpcy50eXBlOwogICAgICBpZiAodGhpcy5uYW1lICE9PSAiIikKICAgICAgICBkYXRhLm5hbWUgPSB0aGlzLm5hbWU7CiAgICAgIGlmICh0aGlzLmNvbG9yICYmIHRoaXMuY29sb3IuaXNDb2xvcikKICAgICAgICBkYXRhLmNvbG9yID0gdGhpcy5jb2xvci5nZXRIZXgoKTsKICAgICAgaWYgKHRoaXMucm91Z2huZXNzICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5yb3VnaG5lc3MgPSB0aGlzLnJvdWdobmVzczsKICAgICAgaWYgKHRoaXMubWV0YWxuZXNzICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5tZXRhbG5lc3MgPSB0aGlzLm1ldGFsbmVzczsKICAgICAgaWYgKHRoaXMuc2hlZW4gJiYgdGhpcy5zaGVlbi5pc0NvbG9yKQogICAgICAgIGRhdGEuc2hlZW4gPSB0aGlzLnNoZWVuLmdldEhleCgpOwogICAgICBpZiAodGhpcy5lbWlzc2l2ZSAmJiB0aGlzLmVtaXNzaXZlLmlzQ29sb3IpCiAgICAgICAgZGF0YS5lbWlzc2l2ZSA9IHRoaXMuZW1pc3NpdmUuZ2V0SGV4KCk7CiAgICAgIGlmICh0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ICYmIHRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgIT09IDEpCiAgICAgICAgZGF0YS5lbWlzc2l2ZUludGVuc2l0eSA9IHRoaXMuZW1pc3NpdmVJbnRlbnNpdHk7CiAgICAgIGlmICh0aGlzLnNwZWN1bGFyICYmIHRoaXMuc3BlY3VsYXIuaXNDb2xvcikKICAgICAgICBkYXRhLnNwZWN1bGFyID0gdGhpcy5zcGVjdWxhci5nZXRIZXgoKTsKICAgICAgaWYgKHRoaXMuc2hpbmluZXNzICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5zaGluaW5lc3MgPSB0aGlzLnNoaW5pbmVzczsKICAgICAgaWYgKHRoaXMuY2xlYXJjb2F0ICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5jbGVhcmNvYXQgPSB0aGlzLmNsZWFyY29hdDsKICAgICAgaWYgKHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5jbGVhcmNvYXRSb3VnaG5lc3MgPSB0aGlzLmNsZWFyY29hdFJvdWdobmVzczsKICAgICAgaWYgKHRoaXMuY2xlYXJjb2F0TWFwICYmIHRoaXMuY2xlYXJjb2F0TWFwLmlzVGV4dHVyZSkgewogICAgICAgIGRhdGEuY2xlYXJjb2F0TWFwID0gdGhpcy5jbGVhcmNvYXRNYXAudG9KU09OKG1ldGEpLnV1aWQ7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwICYmIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLmlzVGV4dHVyZSkgewogICAgICAgIGRhdGEuY2xlYXJjb2F0Um91Z2huZXNzTWFwID0gdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAudG9KU09OKG1ldGEpLnV1aWQ7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwICYmIHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwLmlzVGV4dHVyZSkgewogICAgICAgIGRhdGEuY2xlYXJjb2F0Tm9ybWFsTWFwID0gdGhpcy5jbGVhcmNvYXROb3JtYWxNYXAudG9KU09OKG1ldGEpLnV1aWQ7CiAgICAgICAgZGF0YS5jbGVhcmNvYXROb3JtYWxTY2FsZSA9IHRoaXMuY2xlYXJjb2F0Tm9ybWFsU2NhbGUudG9BcnJheSgpOwogICAgICB9CiAgICAgIGlmICh0aGlzLm1hcCAmJiB0aGlzLm1hcC5pc1RleHR1cmUpCiAgICAgICAgZGF0YS5tYXAgPSB0aGlzLm1hcC50b0pTT04obWV0YSkudXVpZDsKICAgICAgaWYgKHRoaXMubWF0Y2FwICYmIHRoaXMubWF0Y2FwLmlzVGV4dHVyZSkKICAgICAgICBkYXRhLm1hdGNhcCA9IHRoaXMubWF0Y2FwLnRvSlNPTihtZXRhKS51dWlkOwogICAgICBpZiAodGhpcy5hbHBoYU1hcCAmJiB0aGlzLmFscGhhTWFwLmlzVGV4dHVyZSkKICAgICAgICBkYXRhLmFscGhhTWFwID0gdGhpcy5hbHBoYU1hcC50b0pTT04obWV0YSkudXVpZDsKICAgICAgaWYgKHRoaXMubGlnaHRNYXAgJiYgdGhpcy5saWdodE1hcC5pc1RleHR1cmUpIHsKICAgICAgICBkYXRhLmxpZ2h0TWFwID0gdGhpcy5saWdodE1hcC50b0pTT04obWV0YSkudXVpZDsKICAgICAgICBkYXRhLmxpZ2h0TWFwSW50ZW5zaXR5ID0gdGhpcy5saWdodE1hcEludGVuc2l0eTsKICAgICAgfQogICAgICBpZiAodGhpcy5hb01hcCAmJiB0aGlzLmFvTWFwLmlzVGV4dHVyZSkgewogICAgICAgIGRhdGEuYW9NYXAgPSB0aGlzLmFvTWFwLnRvSlNPTihtZXRhKS51dWlkOwogICAgICAgIGRhdGEuYW9NYXBJbnRlbnNpdHkgPSB0aGlzLmFvTWFwSW50ZW5zaXR5OwogICAgICB9CiAgICAgIGlmICh0aGlzLmJ1bXBNYXAgJiYgdGhpcy5idW1wTWFwLmlzVGV4dHVyZSkgewogICAgICAgIGRhdGEuYnVtcE1hcCA9IHRoaXMuYnVtcE1hcC50b0pTT04obWV0YSkudXVpZDsKICAgICAgICBkYXRhLmJ1bXBTY2FsZSA9IHRoaXMuYnVtcFNjYWxlOwogICAgICB9CiAgICAgIGlmICh0aGlzLm5vcm1hbE1hcCAmJiB0aGlzLm5vcm1hbE1hcC5pc1RleHR1cmUpIHsKICAgICAgICBkYXRhLm5vcm1hbE1hcCA9IHRoaXMubm9ybWFsTWFwLnRvSlNPTihtZXRhKS51dWlkOwogICAgICAgIGRhdGEubm9ybWFsTWFwVHlwZSA9IHRoaXMubm9ybWFsTWFwVHlwZTsKICAgICAgICBkYXRhLm5vcm1hbFNjYWxlID0gdGhpcy5ub3JtYWxTY2FsZS50b0FycmF5KCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZGlzcGxhY2VtZW50TWFwICYmIHRoaXMuZGlzcGxhY2VtZW50TWFwLmlzVGV4dHVyZSkgewogICAgICAgIGRhdGEuZGlzcGxhY2VtZW50TWFwID0gdGhpcy5kaXNwbGFjZW1lbnRNYXAudG9KU09OKG1ldGEpLnV1aWQ7CiAgICAgICAgZGF0YS5kaXNwbGFjZW1lbnRTY2FsZSA9IHRoaXMuZGlzcGxhY2VtZW50U2NhbGU7CiAgICAgICAgZGF0YS5kaXNwbGFjZW1lbnRCaWFzID0gdGhpcy5kaXNwbGFjZW1lbnRCaWFzOwogICAgICB9CiAgICAgIGlmICh0aGlzLnJvdWdobmVzc01hcCAmJiB0aGlzLnJvdWdobmVzc01hcC5pc1RleHR1cmUpCiAgICAgICAgZGF0YS5yb3VnaG5lc3NNYXAgPSB0aGlzLnJvdWdobmVzc01hcC50b0pTT04obWV0YSkudXVpZDsKICAgICAgaWYgKHRoaXMubWV0YWxuZXNzTWFwICYmIHRoaXMubWV0YWxuZXNzTWFwLmlzVGV4dHVyZSkKICAgICAgICBkYXRhLm1ldGFsbmVzc01hcCA9IHRoaXMubWV0YWxuZXNzTWFwLnRvSlNPTihtZXRhKS51dWlkOwogICAgICBpZiAodGhpcy5lbWlzc2l2ZU1hcCAmJiB0aGlzLmVtaXNzaXZlTWFwLmlzVGV4dHVyZSkKICAgICAgICBkYXRhLmVtaXNzaXZlTWFwID0gdGhpcy5lbWlzc2l2ZU1hcC50b0pTT04obWV0YSkudXVpZDsKICAgICAgaWYgKHRoaXMuc3BlY3VsYXJNYXAgJiYgdGhpcy5zcGVjdWxhck1hcC5pc1RleHR1cmUpCiAgICAgICAgZGF0YS5zcGVjdWxhck1hcCA9IHRoaXMuc3BlY3VsYXJNYXAudG9KU09OKG1ldGEpLnV1aWQ7CiAgICAgIGlmICh0aGlzLmVudk1hcCAmJiB0aGlzLmVudk1hcC5pc1RleHR1cmUpIHsKICAgICAgICBkYXRhLmVudk1hcCA9IHRoaXMuZW52TWFwLnRvSlNPTihtZXRhKS51dWlkOwogICAgICAgIGlmICh0aGlzLmNvbWJpbmUgIT09IHZvaWQgMCkKICAgICAgICAgIGRhdGEuY29tYmluZSA9IHRoaXMuY29tYmluZTsKICAgICAgfQogICAgICBpZiAodGhpcy5lbnZNYXBJbnRlbnNpdHkgIT09IHZvaWQgMCkKICAgICAgICBkYXRhLmVudk1hcEludGVuc2l0eSA9IHRoaXMuZW52TWFwSW50ZW5zaXR5OwogICAgICBpZiAodGhpcy5yZWZsZWN0aXZpdHkgIT09IHZvaWQgMCkKICAgICAgICBkYXRhLnJlZmxlY3Rpdml0eSA9IHRoaXMucmVmbGVjdGl2aXR5OwogICAgICBpZiAodGhpcy5yZWZyYWN0aW9uUmF0aW8gIT09IHZvaWQgMCkKICAgICAgICBkYXRhLnJlZnJhY3Rpb25SYXRpbyA9IHRoaXMucmVmcmFjdGlvblJhdGlvOwogICAgICBpZiAodGhpcy5ncmFkaWVudE1hcCAmJiB0aGlzLmdyYWRpZW50TWFwLmlzVGV4dHVyZSkgewogICAgICAgIGRhdGEuZ3JhZGllbnRNYXAgPSB0aGlzLmdyYWRpZW50TWFwLnRvSlNPTihtZXRhKS51dWlkOwogICAgICB9CiAgICAgIGlmICh0aGlzLnRyYW5zbWlzc2lvbiAhPT0gdm9pZCAwKQogICAgICAgIGRhdGEudHJhbnNtaXNzaW9uID0gdGhpcy50cmFuc21pc3Npb247CiAgICAgIGlmICh0aGlzLnRyYW5zbWlzc2lvbk1hcCAmJiB0aGlzLnRyYW5zbWlzc2lvbk1hcC5pc1RleHR1cmUpCiAgICAgICAgZGF0YS50cmFuc21pc3Npb25NYXAgPSB0aGlzLnRyYW5zbWlzc2lvbk1hcC50b0pTT04obWV0YSkudXVpZDsKICAgICAgaWYgKHRoaXMudGhpY2tuZXNzICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS50aGlja25lc3MgPSB0aGlzLnRoaWNrbmVzczsKICAgICAgaWYgKHRoaXMudGhpY2tuZXNzTWFwICYmIHRoaXMudGhpY2tuZXNzTWFwLmlzVGV4dHVyZSkKICAgICAgICBkYXRhLnRoaWNrbmVzc01hcCA9IHRoaXMudGhpY2tuZXNzTWFwLnRvSlNPTihtZXRhKS51dWlkOwogICAgICBpZiAodGhpcy5hdHRlbnVhdGlvbkRpc3RhbmNlICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5hdHRlbnVhdGlvbkRpc3RhbmNlID0gdGhpcy5hdHRlbnVhdGlvbkRpc3RhbmNlOwogICAgICBpZiAodGhpcy5hdHRlbnVhdGlvbkNvbG9yICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5hdHRlbnVhdGlvbkNvbG9yID0gdGhpcy5hdHRlbnVhdGlvbkNvbG9yLmdldEhleCgpOwogICAgICBpZiAodGhpcy5zaXplICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5zaXplID0gdGhpcy5zaXplOwogICAgICBpZiAodGhpcy5zaGFkb3dTaWRlICE9PSBudWxsKQogICAgICAgIGRhdGEuc2hhZG93U2lkZSA9IHRoaXMuc2hhZG93U2lkZTsKICAgICAgaWYgKHRoaXMuc2l6ZUF0dGVudWF0aW9uICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5zaXplQXR0ZW51YXRpb24gPSB0aGlzLnNpemVBdHRlbnVhdGlvbjsKICAgICAgaWYgKHRoaXMuYmxlbmRpbmcgIT09IE5vcm1hbEJsZW5kaW5nKQogICAgICAgIGRhdGEuYmxlbmRpbmcgPSB0aGlzLmJsZW5kaW5nOwogICAgICBpZiAodGhpcy5zaWRlICE9PSBGcm9udFNpZGUpCiAgICAgICAgZGF0YS5zaWRlID0gdGhpcy5zaWRlOwogICAgICBpZiAodGhpcy52ZXJ0ZXhDb2xvcnMpCiAgICAgICAgZGF0YS52ZXJ0ZXhDb2xvcnMgPSB0cnVlOwogICAgICBpZiAodGhpcy5vcGFjaXR5IDwgMSkKICAgICAgICBkYXRhLm9wYWNpdHkgPSB0aGlzLm9wYWNpdHk7CiAgICAgIGlmICh0aGlzLnRyYW5zcGFyZW50ID09PSB0cnVlKQogICAgICAgIGRhdGEudHJhbnNwYXJlbnQgPSB0aGlzLnRyYW5zcGFyZW50OwogICAgICBkYXRhLmRlcHRoRnVuYyA9IHRoaXMuZGVwdGhGdW5jOwogICAgICBkYXRhLmRlcHRoVGVzdCA9IHRoaXMuZGVwdGhUZXN0OwogICAgICBkYXRhLmRlcHRoV3JpdGUgPSB0aGlzLmRlcHRoV3JpdGU7CiAgICAgIGRhdGEuY29sb3JXcml0ZSA9IHRoaXMuY29sb3JXcml0ZTsKICAgICAgZGF0YS5zdGVuY2lsV3JpdGUgPSB0aGlzLnN0ZW5jaWxXcml0ZTsKICAgICAgZGF0YS5zdGVuY2lsV3JpdGVNYXNrID0gdGhpcy5zdGVuY2lsV3JpdGVNYXNrOwogICAgICBkYXRhLnN0ZW5jaWxGdW5jID0gdGhpcy5zdGVuY2lsRnVuYzsKICAgICAgZGF0YS5zdGVuY2lsUmVmID0gdGhpcy5zdGVuY2lsUmVmOwogICAgICBkYXRhLnN0ZW5jaWxGdW5jTWFzayA9IHRoaXMuc3RlbmNpbEZ1bmNNYXNrOwogICAgICBkYXRhLnN0ZW5jaWxGYWlsID0gdGhpcy5zdGVuY2lsRmFpbDsKICAgICAgZGF0YS5zdGVuY2lsWkZhaWwgPSB0aGlzLnN0ZW5jaWxaRmFpbDsKICAgICAgZGF0YS5zdGVuY2lsWlBhc3MgPSB0aGlzLnN0ZW5jaWxaUGFzczsKICAgICAgaWYgKHRoaXMucm90YXRpb24gJiYgdGhpcy5yb3RhdGlvbiAhPT0gMCkKICAgICAgICBkYXRhLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbjsKICAgICAgaWYgKHRoaXMucG9seWdvbk9mZnNldCA9PT0gdHJ1ZSkKICAgICAgICBkYXRhLnBvbHlnb25PZmZzZXQgPSB0cnVlOwogICAgICBpZiAodGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yICE9PSAwKQogICAgICAgIGRhdGEucG9seWdvbk9mZnNldEZhY3RvciA9IHRoaXMucG9seWdvbk9mZnNldEZhY3RvcjsKICAgICAgaWYgKHRoaXMucG9seWdvbk9mZnNldFVuaXRzICE9PSAwKQogICAgICAgIGRhdGEucG9seWdvbk9mZnNldFVuaXRzID0gdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHM7CiAgICAgIGlmICh0aGlzLmxpbmV3aWR0aCAmJiB0aGlzLmxpbmV3aWR0aCAhPT0gMSkKICAgICAgICBkYXRhLmxpbmV3aWR0aCA9IHRoaXMubGluZXdpZHRoOwogICAgICBpZiAodGhpcy5kYXNoU2l6ZSAhPT0gdm9pZCAwKQogICAgICAgIGRhdGEuZGFzaFNpemUgPSB0aGlzLmRhc2hTaXplOwogICAgICBpZiAodGhpcy5nYXBTaXplICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5nYXBTaXplID0gdGhpcy5nYXBTaXplOwogICAgICBpZiAodGhpcy5zY2FsZSAhPT0gdm9pZCAwKQogICAgICAgIGRhdGEuc2NhbGUgPSB0aGlzLnNjYWxlOwogICAgICBpZiAodGhpcy5kaXRoZXJpbmcgPT09IHRydWUpCiAgICAgICAgZGF0YS5kaXRoZXJpbmcgPSB0cnVlOwogICAgICBpZiAodGhpcy5hbHBoYVRlc3QgPiAwKQogICAgICAgIGRhdGEuYWxwaGFUZXN0ID0gdGhpcy5hbHBoYVRlc3Q7CiAgICAgIGlmICh0aGlzLmFscGhhVG9Db3ZlcmFnZSA9PT0gdHJ1ZSkKICAgICAgICBkYXRhLmFscGhhVG9Db3ZlcmFnZSA9IHRoaXMuYWxwaGFUb0NvdmVyYWdlOwogICAgICBpZiAodGhpcy5wcmVtdWx0aXBsaWVkQWxwaGEgPT09IHRydWUpCiAgICAgICAgZGF0YS5wcmVtdWx0aXBsaWVkQWxwaGEgPSB0aGlzLnByZW11bHRpcGxpZWRBbHBoYTsKICAgICAgaWYgKHRoaXMud2lyZWZyYW1lID09PSB0cnVlKQogICAgICAgIGRhdGEud2lyZWZyYW1lID0gdGhpcy53aXJlZnJhbWU7CiAgICAgIGlmICh0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA+IDEpCiAgICAgICAgZGF0YS53aXJlZnJhbWVMaW5ld2lkdGggPSB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aDsKICAgICAgaWYgKHRoaXMud2lyZWZyYW1lTGluZWNhcCAhPT0gInJvdW5kIikKICAgICAgICBkYXRhLndpcmVmcmFtZUxpbmVjYXAgPSB0aGlzLndpcmVmcmFtZUxpbmVjYXA7CiAgICAgIGlmICh0aGlzLndpcmVmcmFtZUxpbmVqb2luICE9PSAicm91bmQiKQogICAgICAgIGRhdGEud2lyZWZyYW1lTGluZWpvaW4gPSB0aGlzLndpcmVmcmFtZUxpbmVqb2luOwogICAgICBpZiAodGhpcy5tb3JwaFRhcmdldHMgPT09IHRydWUpCiAgICAgICAgZGF0YS5tb3JwaFRhcmdldHMgPSB0cnVlOwogICAgICBpZiAodGhpcy5tb3JwaE5vcm1hbHMgPT09IHRydWUpCiAgICAgICAgZGF0YS5tb3JwaE5vcm1hbHMgPSB0cnVlOwogICAgICBpZiAodGhpcy5mbGF0U2hhZGluZyA9PT0gdHJ1ZSkKICAgICAgICBkYXRhLmZsYXRTaGFkaW5nID0gdGhpcy5mbGF0U2hhZGluZzsKICAgICAgaWYgKHRoaXMudmlzaWJsZSA9PT0gZmFsc2UpCiAgICAgICAgZGF0YS52aXNpYmxlID0gZmFsc2U7CiAgICAgIGlmICh0aGlzLnRvbmVNYXBwZWQgPT09IGZhbHNlKQogICAgICAgIGRhdGEudG9uZU1hcHBlZCA9IGZhbHNlOwogICAgICBpZiAoSlNPTi5zdHJpbmdpZnkodGhpcy51c2VyRGF0YSkgIT09ICJ7fSIpCiAgICAgICAgZGF0YS51c2VyRGF0YSA9IHRoaXMudXNlckRhdGE7CiAgICAgIGZ1bmN0aW9uIGV4dHJhY3RGcm9tQ2FjaGUoY2FjaGUpIHsKICAgICAgICBjb25zdCB2YWx1ZXMgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBjYWNoZSkgewogICAgICAgICAgY29uc3QgZGF0YTIgPSBjYWNoZVtrZXldOwogICAgICAgICAgZGVsZXRlIGRhdGEyLm1ldGFkYXRhOwogICAgICAgICAgdmFsdWVzLnB1c2goZGF0YTIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWVzOwogICAgICB9CiAgICAgIGlmIChpc1Jvb3QpIHsKICAgICAgICBjb25zdCB0ZXh0dXJlcyA9IGV4dHJhY3RGcm9tQ2FjaGUobWV0YS50ZXh0dXJlcyk7CiAgICAgICAgY29uc3QgaW1hZ2VzID0gZXh0cmFjdEZyb21DYWNoZShtZXRhLmltYWdlcyk7CiAgICAgICAgaWYgKHRleHR1cmVzLmxlbmd0aCA+IDApCiAgICAgICAgICBkYXRhLnRleHR1cmVzID0gdGV4dHVyZXM7CiAgICAgICAgaWYgKGltYWdlcy5sZW5ndGggPiAwKQogICAgICAgICAgZGF0YS5pbWFnZXMgPSBpbWFnZXM7CiAgICAgIH0KICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwogICAgICB0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CiAgICAgIHRoaXMuYmxlbmRpbmcgPSBzb3VyY2UuYmxlbmRpbmc7CiAgICAgIHRoaXMuc2lkZSA9IHNvdXJjZS5zaWRlOwogICAgICB0aGlzLnZlcnRleENvbG9ycyA9IHNvdXJjZS52ZXJ0ZXhDb2xvcnM7CiAgICAgIHRoaXMub3BhY2l0eSA9IHNvdXJjZS5vcGFjaXR5OwogICAgICB0aGlzLnRyYW5zcGFyZW50ID0gc291cmNlLnRyYW5zcGFyZW50OwogICAgICB0aGlzLmJsZW5kU3JjID0gc291cmNlLmJsZW5kU3JjOwogICAgICB0aGlzLmJsZW5kRHN0ID0gc291cmNlLmJsZW5kRHN0OwogICAgICB0aGlzLmJsZW5kRXF1YXRpb24gPSBzb3VyY2UuYmxlbmRFcXVhdGlvbjsKICAgICAgdGhpcy5ibGVuZFNyY0FscGhhID0gc291cmNlLmJsZW5kU3JjQWxwaGE7CiAgICAgIHRoaXMuYmxlbmREc3RBbHBoYSA9IHNvdXJjZS5ibGVuZERzdEFscGhhOwogICAgICB0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSA9IHNvdXJjZS5ibGVuZEVxdWF0aW9uQWxwaGE7CiAgICAgIHRoaXMuZGVwdGhGdW5jID0gc291cmNlLmRlcHRoRnVuYzsKICAgICAgdGhpcy5kZXB0aFRlc3QgPSBzb3VyY2UuZGVwdGhUZXN0OwogICAgICB0aGlzLmRlcHRoV3JpdGUgPSBzb3VyY2UuZGVwdGhXcml0ZTsKICAgICAgdGhpcy5zdGVuY2lsV3JpdGVNYXNrID0gc291cmNlLnN0ZW5jaWxXcml0ZU1hc2s7CiAgICAgIHRoaXMuc3RlbmNpbEZ1bmMgPSBzb3VyY2Uuc3RlbmNpbEZ1bmM7CiAgICAgIHRoaXMuc3RlbmNpbFJlZiA9IHNvdXJjZS5zdGVuY2lsUmVmOwogICAgICB0aGlzLnN0ZW5jaWxGdW5jTWFzayA9IHNvdXJjZS5zdGVuY2lsRnVuY01hc2s7CiAgICAgIHRoaXMuc3RlbmNpbEZhaWwgPSBzb3VyY2Uuc3RlbmNpbEZhaWw7CiAgICAgIHRoaXMuc3RlbmNpbFpGYWlsID0gc291cmNlLnN0ZW5jaWxaRmFpbDsKICAgICAgdGhpcy5zdGVuY2lsWlBhc3MgPSBzb3VyY2Uuc3RlbmNpbFpQYXNzOwogICAgICB0aGlzLnN0ZW5jaWxXcml0ZSA9IHNvdXJjZS5zdGVuY2lsV3JpdGU7CiAgICAgIGNvbnN0IHNyY1BsYW5lcyA9IHNvdXJjZS5jbGlwcGluZ1BsYW5lczsKICAgICAgbGV0IGRzdFBsYW5lcyA9IG51bGw7CiAgICAgIGlmIChzcmNQbGFuZXMgIT09IG51bGwpIHsKICAgICAgICBjb25zdCBuID0gc3JjUGxhbmVzLmxlbmd0aDsKICAgICAgICBkc3RQbGFuZXMgPSBuZXcgQXJyYXkobik7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47ICsraSkgewogICAgICAgICAgZHN0UGxhbmVzW2ldID0gc3JjUGxhbmVzW2ldLmNsb25lKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuY2xpcHBpbmdQbGFuZXMgPSBkc3RQbGFuZXM7CiAgICAgIHRoaXMuY2xpcEludGVyc2VjdGlvbiA9IHNvdXJjZS5jbGlwSW50ZXJzZWN0aW9uOwogICAgICB0aGlzLmNsaXBTaGFkb3dzID0gc291cmNlLmNsaXBTaGFkb3dzOwogICAgICB0aGlzLnNoYWRvd1NpZGUgPSBzb3VyY2Uuc2hhZG93U2lkZTsKICAgICAgdGhpcy5jb2xvcldyaXRlID0gc291cmNlLmNvbG9yV3JpdGU7CiAgICAgIHRoaXMucHJlY2lzaW9uID0gc291cmNlLnByZWNpc2lvbjsKICAgICAgdGhpcy5wb2x5Z29uT2Zmc2V0ID0gc291cmNlLnBvbHlnb25PZmZzZXQ7CiAgICAgIHRoaXMucG9seWdvbk9mZnNldEZhY3RvciA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0RmFjdG9yOwogICAgICB0aGlzLnBvbHlnb25PZmZzZXRVbml0cyA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0VW5pdHM7CiAgICAgIHRoaXMuZGl0aGVyaW5nID0gc291cmNlLmRpdGhlcmluZzsKICAgICAgdGhpcy5hbHBoYVRlc3QgPSBzb3VyY2UuYWxwaGFUZXN0OwogICAgICB0aGlzLmFscGhhVG9Db3ZlcmFnZSA9IHNvdXJjZS5hbHBoYVRvQ292ZXJhZ2U7CiAgICAgIHRoaXMucHJlbXVsdGlwbGllZEFscGhhID0gc291cmNlLnByZW11bHRpcGxpZWRBbHBoYTsKICAgICAgdGhpcy52aXNpYmxlID0gc291cmNlLnZpc2libGU7CiAgICAgIHRoaXMudG9uZU1hcHBlZCA9IHNvdXJjZS50b25lTWFwcGVkOwogICAgICB0aGlzLnVzZXJEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShzb3VyY2UudXNlckRhdGEpKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBkaXNwb3NlKCkgewogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoeyB0eXBlOiAiZGlzcG9zZSIgfSk7CiAgICB9CiAgICBzZXQgbmVlZHNVcGRhdGUodmFsdWUpIHsKICAgICAgaWYgKHZhbHVlID09PSB0cnVlKQogICAgICAgIHRoaXMudmVyc2lvbisrOwogICAgfQogIH07CiAgTWF0ZXJpYWwucHJvdG90eXBlLmlzTWF0ZXJpYWwgPSB0cnVlOwogIHZhciBfY29sb3JLZXl3b3JkcyA9IHsKICAgICJhbGljZWJsdWUiOiAxNTc5MjM4MywKICAgICJhbnRpcXVld2hpdGUiOiAxNjQ0NDM3NSwKICAgICJhcXVhIjogNjU1MzUsCiAgICAiYXF1YW1hcmluZSI6IDgzODg1NjQsCiAgICAiYXp1cmUiOiAxNTc5NDE3NSwKICAgICJiZWlnZSI6IDE2MTE5MjYwLAogICAgImJpc3F1ZSI6IDE2NzcwMjQ0LAogICAgImJsYWNrIjogMCwKICAgICJibGFuY2hlZGFsbW9uZCI6IDE2NzcyMDQ1LAogICAgImJsdWUiOiAyNTUsCiAgICAiYmx1ZXZpb2xldCI6IDkwNTUyMDIsCiAgICAiYnJvd24iOiAxMDgyNDIzNCwKICAgICJidXJseXdvb2QiOiAxNDU5NjIzMSwKICAgICJjYWRldGJsdWUiOiA2MjY2NTI4LAogICAgImNoYXJ0cmV1c2UiOiA4Mzg4MzUyLAogICAgImNob2NvbGF0ZSI6IDEzNzg5NDcwLAogICAgImNvcmFsIjogMTY3NDQyNzIsCiAgICAiY29ybmZsb3dlcmJsdWUiOiA2NTkxOTgxLAogICAgImNvcm5zaWxrIjogMTY3NzUzODgsCiAgICAiY3JpbXNvbiI6IDE0NDIzMTAwLAogICAgImN5YW4iOiA2NTUzNSwKICAgICJkYXJrYmx1ZSI6IDEzOSwKICAgICJkYXJrY3lhbiI6IDM1NzIzLAogICAgImRhcmtnb2xkZW5yb2QiOiAxMjA5MjkzOSwKICAgICJkYXJrZ3JheSI6IDExMTE5MDE3LAogICAgImRhcmtncmVlbiI6IDI1NjAwLAogICAgImRhcmtncmV5IjogMTExMTkwMTcsCiAgICAiZGFya2toYWtpIjogMTI0MzMyNTksCiAgICAiZGFya21hZ2VudGEiOiA5MTA5NjQzLAogICAgImRhcmtvbGl2ZWdyZWVuIjogNTU5Nzk5OSwKICAgICJkYXJrb3JhbmdlIjogMTY3NDc1MjAsCiAgICAiZGFya29yY2hpZCI6IDEwMDQwMDEyLAogICAgImRhcmtyZWQiOiA5MTA5NTA0LAogICAgImRhcmtzYWxtb24iOiAxNTMwODQxMCwKICAgICJkYXJrc2VhZ3JlZW4iOiA5NDE5OTE5LAogICAgImRhcmtzbGF0ZWJsdWUiOiA0NzM0MzQ3LAogICAgImRhcmtzbGF0ZWdyYXkiOiAzMTAwNDk1LAogICAgImRhcmtzbGF0ZWdyZXkiOiAzMTAwNDk1LAogICAgImRhcmt0dXJxdW9pc2UiOiA1Mjk0NSwKICAgICJkYXJrdmlvbGV0IjogOTY5OTUzOSwKICAgICJkZWVwcGluayI6IDE2NzE2OTQ3LAogICAgImRlZXBza3libHVlIjogNDkxNTEsCiAgICAiZGltZ3JheSI6IDY5MDgyNjUsCiAgICAiZGltZ3JleSI6IDY5MDgyNjUsCiAgICAiZG9kZ2VyYmx1ZSI6IDIwMDMxOTksCiAgICAiZmlyZWJyaWNrIjogMTE2NzQxNDYsCiAgICAiZmxvcmFsd2hpdGUiOiAxNjc3NTkyMCwKICAgICJmb3Jlc3RncmVlbiI6IDIyNjM4NDIsCiAgICAiZnVjaHNpYSI6IDE2NzExOTM1LAogICAgImdhaW5zYm9ybyI6IDE0NDc0NDYwLAogICAgImdob3N0d2hpdGUiOiAxNjMxNjY3MSwKICAgICJnb2xkIjogMTY3NjY3MjAsCiAgICAiZ29sZGVucm9kIjogMTQzMjkxMjAsCiAgICAiZ3JheSI6IDg0MjE1MDQsCiAgICAiZ3JlZW4iOiAzMjc2OCwKICAgICJncmVlbnllbGxvdyI6IDExNDAzMDU1LAogICAgImdyZXkiOiA4NDIxNTA0LAogICAgImhvbmV5ZGV3IjogMTU3OTQxNjAsCiAgICAiaG90cGluayI6IDE2NzM4NzQwLAogICAgImluZGlhbnJlZCI6IDEzNDU4NTI0LAogICAgImluZGlnbyI6IDQ5MTUzMzAsCiAgICAiaXZvcnkiOiAxNjc3NzIwMCwKICAgICJraGFraSI6IDE1Nzg3NjYwLAogICAgImxhdmVuZGVyIjogMTUxMzI0MTAsCiAgICAibGF2ZW5kZXJibHVzaCI6IDE2NzczMzY1LAogICAgImxhd25ncmVlbiI6IDgxOTA5NzYsCiAgICAibGVtb25jaGlmZm9uIjogMTY3NzU4ODUsCiAgICAibGlnaHRibHVlIjogMTEzOTMyNTQsCiAgICAibGlnaHRjb3JhbCI6IDE1NzYxNTM2LAogICAgImxpZ2h0Y3lhbiI6IDE0NzQ1NTk5LAogICAgImxpZ2h0Z29sZGVucm9keWVsbG93IjogMTY0NDgyMTAsCiAgICAibGlnaHRncmF5IjogMTM4ODIzMjMsCiAgICAibGlnaHRncmVlbiI6IDk0OTgyNTYsCiAgICAibGlnaHRncmV5IjogMTM4ODIzMjMsCiAgICAibGlnaHRwaW5rIjogMTY3NTg0NjUsCiAgICAibGlnaHRzYWxtb24iOiAxNjc1Mjc2MiwKICAgICJsaWdodHNlYWdyZWVuIjogMjE0Mjg5MCwKICAgICJsaWdodHNreWJsdWUiOiA4OTAwMzQ2LAogICAgImxpZ2h0c2xhdGVncmF5IjogNzgzMzc1MywKICAgICJsaWdodHNsYXRlZ3JleSI6IDc4MzM3NTMsCiAgICAibGlnaHRzdGVlbGJsdWUiOiAxMTU4NDczNCwKICAgICJsaWdodHllbGxvdyI6IDE2Nzc3MTg0LAogICAgImxpbWUiOiA2NTI4MCwKICAgICJsaW1lZ3JlZW4iOiAzMzI5MzMwLAogICAgImxpbmVuIjogMTY0NDU2NzAsCiAgICAibWFnZW50YSI6IDE2NzExOTM1LAogICAgIm1hcm9vbiI6IDgzODg2MDgsCiAgICAibWVkaXVtYXF1YW1hcmluZSI6IDY3MzczMjIsCiAgICAibWVkaXVtYmx1ZSI6IDIwNSwKICAgICJtZWRpdW1vcmNoaWQiOiAxMjIxMTY2NywKICAgICJtZWRpdW1wdXJwbGUiOiA5NjYyNjgzLAogICAgIm1lZGl1bXNlYWdyZWVuIjogMzk3ODA5NywKICAgICJtZWRpdW1zbGF0ZWJsdWUiOiA4MDg3NzkwLAogICAgIm1lZGl1bXNwcmluZ2dyZWVuIjogNjQxNTQsCiAgICAibWVkaXVtdHVycXVvaXNlIjogNDc3MjMwMCwKICAgICJtZWRpdW12aW9sZXRyZWQiOiAxMzA0NzE3MywKICAgICJtaWRuaWdodGJsdWUiOiAxNjQ0OTEyLAogICAgIm1pbnRjcmVhbSI6IDE2MTIxODUwLAogICAgIm1pc3R5cm9zZSI6IDE2NzcwMjczLAogICAgIm1vY2Nhc2luIjogMTY3NzAyMjksCiAgICAibmF2YWpvd2hpdGUiOiAxNjc2ODY4NSwKICAgICJuYXZ5IjogMTI4LAogICAgIm9sZGxhY2UiOiAxNjY0MzU1OCwKICAgICJvbGl2ZSI6IDg0MjEzNzYsCiAgICAib2xpdmVkcmFiIjogNzA0ODczOSwKICAgICJvcmFuZ2UiOiAxNjc1MzkyMCwKICAgICJvcmFuZ2VyZWQiOiAxNjcyOTM0NCwKICAgICJvcmNoaWQiOiAxNDMxNTczNCwKICAgICJwYWxlZ29sZGVucm9kIjogMTU2NTcxMzAsCiAgICAicGFsZWdyZWVuIjogMTAwMjU4ODAsCiAgICAicGFsZXR1cnF1b2lzZSI6IDExNTI5OTY2LAogICAgInBhbGV2aW9sZXRyZWQiOiAxNDM4MTIwMywKICAgICJwYXBheWF3aGlwIjogMTY3NzMwNzcsCiAgICAicGVhY2hwdWZmIjogMTY3Njc2NzMsCiAgICAicGVydSI6IDEzNDY4OTkxLAogICAgInBpbmsiOiAxNjc2MTAzNSwKICAgICJwbHVtIjogMTQ1MjQ2MzcsCiAgICAicG93ZGVyYmx1ZSI6IDExNTkxOTEwLAogICAgInB1cnBsZSI6IDgzODg3MzYsCiAgICAicmViZWNjYXB1cnBsZSI6IDY2OTc4ODEsCiAgICAicmVkIjogMTY3MTE2ODAsCiAgICAicm9zeWJyb3duIjogMTIzNTc1MTksCiAgICAicm95YWxibHVlIjogNDI4Njk0NSwKICAgICJzYWRkbGVicm93biI6IDkxMjcxODcsCiAgICAic2FsbW9uIjogMTY0MTY4ODIsCiAgICAic2FuZHlicm93biI6IDE2MDMyODY0LAogICAgInNlYWdyZWVuIjogMzA1MDMyNywKICAgICJzZWFzaGVsbCI6IDE2Nzc0NjM4LAogICAgInNpZW5uYSI6IDEwNTA2Nzk3LAogICAgInNpbHZlciI6IDEyNjMyMjU2LAogICAgInNreWJsdWUiOiA4OTAwMzMxLAogICAgInNsYXRlYmx1ZSI6IDY5NzAwNjEsCiAgICAic2xhdGVncmF5IjogNzM3Mjk0NCwKICAgICJzbGF0ZWdyZXkiOiA3MzcyOTQ0LAogICAgInNub3ciOiAxNjc3NTkzMCwKICAgICJzcHJpbmdncmVlbiI6IDY1NDA3LAogICAgInN0ZWVsYmx1ZSI6IDQ2MjA5ODAsCiAgICAidGFuIjogMTM4MDg3ODAsCiAgICAidGVhbCI6IDMyODk2LAogICAgInRoaXN0bGUiOiAxNDIwNDg4OCwKICAgICJ0b21hdG8iOiAxNjczNzA5NSwKICAgICJ0dXJxdW9pc2UiOiA0MjUxODU2LAogICAgInZpb2xldCI6IDE1NjMxMDg2LAogICAgIndoZWF0IjogMTYxMTMzMzEsCiAgICAid2hpdGUiOiAxNjc3NzIxNSwKICAgICJ3aGl0ZXNtb2tlIjogMTYxMTkyODUsCiAgICAieWVsbG93IjogMTY3NzY5NjAsCiAgICAieWVsbG93Z3JlZW4iOiAxMDE0NTA3NAogIH07CiAgdmFyIF9oc2xBID0geyBoOiAwLCBzOiAwLCBsOiAwIH07CiAgdmFyIF9oc2xCID0geyBoOiAwLCBzOiAwLCBsOiAwIH07CiAgZnVuY3Rpb24gaHVlMnJnYihwLCBxLCB0KSB7CiAgICBpZiAodCA8IDApCiAgICAgIHQgKz0gMTsKICAgIGlmICh0ID4gMSkKICAgICAgdCAtPSAxOwogICAgaWYgKHQgPCAxIC8gNikKICAgICAgcmV0dXJuIHAgKyAocSAtIHApICogNiAqIHQ7CiAgICBpZiAodCA8IDEgLyAyKQogICAgICByZXR1cm4gcTsKICAgIGlmICh0IDwgMiAvIDMpCiAgICAgIHJldHVybiBwICsgKHEgLSBwKSAqIDYgKiAoMiAvIDMgLSB0KTsKICAgIHJldHVybiBwOwogIH0KICBmdW5jdGlvbiBTUkdCVG9MaW5lYXIoYykgewogICAgcmV0dXJuIGMgPCAwLjA0MDQ1ID8gYyAqIDAuMDc3Mzk5MzgwOCA6IE1hdGgucG93KGMgKiAwLjk0Nzg2NzI5ODYgKyAwLjA1MjEzMjcwMTQsIDIuNCk7CiAgfQogIGZ1bmN0aW9uIExpbmVhclRvU1JHQihjKSB7CiAgICByZXR1cm4gYyA8IDMxMzA4ZS03ID8gYyAqIDEyLjkyIDogMS4wNTUgKiBNYXRoLnBvdyhjLCAwLjQxNjY2KSAtIDAuMDU1OwogIH0KICB2YXIgQ29sb3IgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihyLCBnLCBiKSB7CiAgICAgIGlmIChnID09PSB2b2lkIDAgJiYgYiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2V0KHIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLnNldFJHQihyLCBnLCBiKTsKICAgIH0KICAgIHNldCh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgJiYgdmFsdWUuaXNDb2xvcikgewogICAgICAgIHRoaXMuY29weSh2YWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAibnVtYmVyIikgewogICAgICAgIHRoaXMuc2V0SGV4KHZhbHVlKTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgdGhpcy5zZXRTdHlsZSh2YWx1ZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRTY2FsYXIoc2NhbGFyKSB7CiAgICAgIHRoaXMuciA9IHNjYWxhcjsKICAgICAgdGhpcy5nID0gc2NhbGFyOwogICAgICB0aGlzLmIgPSBzY2FsYXI7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0SGV4KGhleCkgewogICAgICBoZXggPSBNYXRoLmZsb29yKGhleCk7CiAgICAgIHRoaXMuciA9IChoZXggPj4gMTYgJiAyNTUpIC8gMjU1OwogICAgICB0aGlzLmcgPSAoaGV4ID4+IDggJiAyNTUpIC8gMjU1OwogICAgICB0aGlzLmIgPSAoaGV4ICYgMjU1KSAvIDI1NTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRSR0IociwgZywgYikgewogICAgICB0aGlzLnIgPSByOwogICAgICB0aGlzLmcgPSBnOwogICAgICB0aGlzLmIgPSBiOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEhTTChoLCBzLCBsKSB7CiAgICAgIGggPSBldWNsaWRlYW5Nb2R1bG8oaCwgMSk7CiAgICAgIHMgPSBjbGFtcChzLCAwLCAxKTsKICAgICAgbCA9IGNsYW1wKGwsIDAsIDEpOwogICAgICBpZiAocyA9PT0gMCkgewogICAgICAgIHRoaXMuciA9IHRoaXMuZyA9IHRoaXMuYiA9IGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgcCA9IGwgPD0gMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzOwogICAgICAgIGNvbnN0IHEgPSAyICogbCAtIHA7CiAgICAgICAgdGhpcy5yID0gaHVlMnJnYihxLCBwLCBoICsgMSAvIDMpOwogICAgICAgIHRoaXMuZyA9IGh1ZTJyZ2IocSwgcCwgaCk7CiAgICAgICAgdGhpcy5iID0gaHVlMnJnYihxLCBwLCBoIC0gMSAvIDMpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0U3R5bGUoc3R5bGUpIHsKICAgICAgZnVuY3Rpb24gaGFuZGxlQWxwaGEoc3RyaW5nKSB7CiAgICAgICAgaWYgKHN0cmluZyA9PT0gdm9pZCAwKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChwYXJzZUZsb2F0KHN0cmluZykgPCAxKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkNvbG9yOiBBbHBoYSBjb21wb25lbnQgb2YgIiArIHN0eWxlICsgIiB3aWxsIGJlIGlnbm9yZWQuIik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBtOwogICAgICBpZiAobSA9IC9eKCg/OnJnYnxoc2wpYT8pXCgoW15cKV0qKVwpLy5leGVjKHN0eWxlKSkgewogICAgICAgIGxldCBjb2xvcjsKICAgICAgICBjb25zdCBuYW1lID0gbVsxXTsKICAgICAgICBjb25zdCBjb21wb25lbnRzID0gbVsyXTsKICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgIGNhc2UgInJnYiI6CiAgICAgICAgICBjYXNlICJyZ2JhIjoKICAgICAgICAgICAgaWYgKGNvbG9yID0gL15ccyooXGQrKVxzKixccyooXGQrKVxzKixccyooXGQrKVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyhjb21wb25lbnRzKSkgewogICAgICAgICAgICAgIHRoaXMuciA9IE1hdGgubWluKDI1NSwgcGFyc2VJbnQoY29sb3JbMV0sIDEwKSkgLyAyNTU7CiAgICAgICAgICAgICAgdGhpcy5nID0gTWF0aC5taW4oMjU1LCBwYXJzZUludChjb2xvclsyXSwgMTApKSAvIDI1NTsKICAgICAgICAgICAgICB0aGlzLmIgPSBNYXRoLm1pbigyNTUsIHBhcnNlSW50KGNvbG9yWzNdLCAxMCkpIC8gMjU1OwogICAgICAgICAgICAgIGhhbmRsZUFscGhhKGNvbG9yWzRdKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29sb3IgPSAvXlxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKixccyooXGQrKVwlXHMqKD86LFxzKihcZCpcLj9cZCspXHMqKT8kLy5leGVjKGNvbXBvbmVudHMpKSB7CiAgICAgICAgICAgICAgdGhpcy5yID0gTWF0aC5taW4oMTAwLCBwYXJzZUludChjb2xvclsxXSwgMTApKSAvIDEwMDsKICAgICAgICAgICAgICB0aGlzLmcgPSBNYXRoLm1pbigxMDAsIHBhcnNlSW50KGNvbG9yWzJdLCAxMCkpIC8gMTAwOwogICAgICAgICAgICAgIHRoaXMuYiA9IE1hdGgubWluKDEwMCwgcGFyc2VJbnQoY29sb3JbM10sIDEwKSkgLyAxMDA7CiAgICAgICAgICAgICAgaGFuZGxlQWxwaGEoY29sb3JbNF0pOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiaHNsIjoKICAgICAgICAgIGNhc2UgImhzbGEiOgogICAgICAgICAgICBpZiAoY29sb3IgPSAvXlxzKihcZCpcLj9cZCspXHMqLFxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyhjb21wb25lbnRzKSkgewogICAgICAgICAgICAgIGNvbnN0IGggPSBwYXJzZUZsb2F0KGNvbG9yWzFdKSAvIDM2MDsKICAgICAgICAgICAgICBjb25zdCBzID0gcGFyc2VJbnQoY29sb3JbMl0sIDEwKSAvIDEwMDsKICAgICAgICAgICAgICBjb25zdCBsID0gcGFyc2VJbnQoY29sb3JbM10sIDEwKSAvIDEwMDsKICAgICAgICAgICAgICBoYW5kbGVBbHBoYShjb2xvcls0XSk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0SFNMKGgsIHMsIGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChtID0gL15cIyhbQS1GYS1mXGRdKykkLy5leGVjKHN0eWxlKSkgewogICAgICAgIGNvbnN0IGhleCA9IG1bMV07CiAgICAgICAgY29uc3Qgc2l6ZSA9IGhleC5sZW5ndGg7CiAgICAgICAgaWYgKHNpemUgPT09IDMpIHsKICAgICAgICAgIHRoaXMuciA9IHBhcnNlSW50KGhleC5jaGFyQXQoMCkgKyBoZXguY2hhckF0KDApLCAxNikgLyAyNTU7CiAgICAgICAgICB0aGlzLmcgPSBwYXJzZUludChoZXguY2hhckF0KDEpICsgaGV4LmNoYXJBdCgxKSwgMTYpIC8gMjU1OwogICAgICAgICAgdGhpcy5iID0gcGFyc2VJbnQoaGV4LmNoYXJBdCgyKSArIGhleC5jaGFyQXQoMiksIDE2KSAvIDI1NTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA9PT0gNikgewogICAgICAgICAgdGhpcy5yID0gcGFyc2VJbnQoaGV4LmNoYXJBdCgwKSArIGhleC5jaGFyQXQoMSksIDE2KSAvIDI1NTsKICAgICAgICAgIHRoaXMuZyA9IHBhcnNlSW50KGhleC5jaGFyQXQoMikgKyBoZXguY2hhckF0KDMpLCAxNikgLyAyNTU7CiAgICAgICAgICB0aGlzLmIgPSBwYXJzZUludChoZXguY2hhckF0KDQpICsgaGV4LmNoYXJBdCg1KSwgMTYpIC8gMjU1OwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChzdHlsZSAmJiBzdHlsZS5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2V0Q29sb3JOYW1lKHN0eWxlKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldENvbG9yTmFtZShzdHlsZSkgewogICAgICBjb25zdCBoZXggPSBfY29sb3JLZXl3b3Jkc1tzdHlsZS50b0xvd2VyQ2FzZSgpXTsKICAgICAgaWYgKGhleCAhPT0gdm9pZCAwKSB7CiAgICAgICAgdGhpcy5zZXRIZXgoaGV4KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkNvbG9yOiBVbmtub3duIGNvbG9yICIgKyBzdHlsZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuciwgdGhpcy5nLCB0aGlzLmIpOwogICAgfQogICAgY29weShjb2xvcikgewogICAgICB0aGlzLnIgPSBjb2xvci5yOwogICAgICB0aGlzLmcgPSBjb2xvci5nOwogICAgICB0aGlzLmIgPSBjb2xvci5iOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvcHlHYW1tYVRvTGluZWFyKGNvbG9yLCBnYW1tYUZhY3RvciA9IDIpIHsKICAgICAgdGhpcy5yID0gTWF0aC5wb3coY29sb3IuciwgZ2FtbWFGYWN0b3IpOwogICAgICB0aGlzLmcgPSBNYXRoLnBvdyhjb2xvci5nLCBnYW1tYUZhY3Rvcik7CiAgICAgIHRoaXMuYiA9IE1hdGgucG93KGNvbG9yLmIsIGdhbW1hRmFjdG9yKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb3B5TGluZWFyVG9HYW1tYShjb2xvciwgZ2FtbWFGYWN0b3IgPSAyKSB7CiAgICAgIGNvbnN0IHNhZmVJbnZlcnNlID0gZ2FtbWFGYWN0b3IgPiAwID8gMSAvIGdhbW1hRmFjdG9yIDogMTsKICAgICAgdGhpcy5yID0gTWF0aC5wb3coY29sb3Iuciwgc2FmZUludmVyc2UpOwogICAgICB0aGlzLmcgPSBNYXRoLnBvdyhjb2xvci5nLCBzYWZlSW52ZXJzZSk7CiAgICAgIHRoaXMuYiA9IE1hdGgucG93KGNvbG9yLmIsIHNhZmVJbnZlcnNlKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb252ZXJ0R2FtbWFUb0xpbmVhcihnYW1tYUZhY3RvcikgewogICAgICB0aGlzLmNvcHlHYW1tYVRvTGluZWFyKHRoaXMsIGdhbW1hRmFjdG9yKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb252ZXJ0TGluZWFyVG9HYW1tYShnYW1tYUZhY3RvcikgewogICAgICB0aGlzLmNvcHlMaW5lYXJUb0dhbW1hKHRoaXMsIGdhbW1hRmFjdG9yKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb3B5U1JHQlRvTGluZWFyKGNvbG9yKSB7CiAgICAgIHRoaXMuciA9IFNSR0JUb0xpbmVhcihjb2xvci5yKTsKICAgICAgdGhpcy5nID0gU1JHQlRvTGluZWFyKGNvbG9yLmcpOwogICAgICB0aGlzLmIgPSBTUkdCVG9MaW5lYXIoY29sb3IuYik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY29weUxpbmVhclRvU1JHQihjb2xvcikgewogICAgICB0aGlzLnIgPSBMaW5lYXJUb1NSR0IoY29sb3Iucik7CiAgICAgIHRoaXMuZyA9IExpbmVhclRvU1JHQihjb2xvci5nKTsKICAgICAgdGhpcy5iID0gTGluZWFyVG9TUkdCKGNvbG9yLmIpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvbnZlcnRTUkdCVG9MaW5lYXIoKSB7CiAgICAgIHRoaXMuY29weVNSR0JUb0xpbmVhcih0aGlzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb252ZXJ0TGluZWFyVG9TUkdCKCkgewogICAgICB0aGlzLmNvcHlMaW5lYXJUb1NSR0IodGhpcyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0SGV4KCkgewogICAgICByZXR1cm4gdGhpcy5yICogMjU1IDw8IDE2IF4gdGhpcy5nICogMjU1IDw8IDggXiB0aGlzLmIgKiAyNTUgPDwgMDsKICAgIH0KICAgIGdldEhleFN0cmluZygpIHsKICAgICAgcmV0dXJuICgiMDAwMDAwIiArIHRoaXMuZ2V0SGV4KCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNik7CiAgICB9CiAgICBnZXRIU0wodGFyZ2V0KSB7CiAgICAgIGNvbnN0IHIgPSB0aGlzLnIsIGcgPSB0aGlzLmcsIGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KHIsIGcsIGIpOwogICAgICBjb25zdCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTsKICAgICAgbGV0IGh1ZSwgc2F0dXJhdGlvbjsKICAgICAgY29uc3QgbGlnaHRuZXNzID0gKG1pbiArIG1heCkgLyAyOwogICAgICBpZiAobWluID09PSBtYXgpIHsKICAgICAgICBodWUgPSAwOwogICAgICAgIHNhdHVyYXRpb24gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGRlbHRhID0gbWF4IC0gbWluOwogICAgICAgIHNhdHVyYXRpb24gPSBsaWdodG5lc3MgPD0gMC41ID8gZGVsdGEgLyAobWF4ICsgbWluKSA6IGRlbHRhIC8gKDIgLSBtYXggLSBtaW4pOwogICAgICAgIHN3aXRjaCAobWF4KSB7CiAgICAgICAgICBjYXNlIHI6CiAgICAgICAgICAgIGh1ZSA9IChnIC0gYikgLyBkZWx0YSArIChnIDwgYiA/IDYgOiAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIGc6CiAgICAgICAgICAgIGh1ZSA9IChiIC0gcikgLyBkZWx0YSArIDI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBiOgogICAgICAgICAgICBodWUgPSAociAtIGcpIC8gZGVsdGEgKyA0OwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaHVlIC89IDY7CiAgICAgIH0KICAgICAgdGFyZ2V0LmggPSBodWU7CiAgICAgIHRhcmdldC5zID0gc2F0dXJhdGlvbjsKICAgICAgdGFyZ2V0LmwgPSBsaWdodG5lc3M7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICBnZXRTdHlsZSgpIHsKICAgICAgcmV0dXJuICJyZ2IoIiArICh0aGlzLnIgKiAyNTUgfCAwKSArICIsIiArICh0aGlzLmcgKiAyNTUgfCAwKSArICIsIiArICh0aGlzLmIgKiAyNTUgfCAwKSArICIpIjsKICAgIH0KICAgIG9mZnNldEhTTChoLCBzLCBsKSB7CiAgICAgIHRoaXMuZ2V0SFNMKF9oc2xBKTsKICAgICAgX2hzbEEuaCArPSBoOwogICAgICBfaHNsQS5zICs9IHM7CiAgICAgIF9oc2xBLmwgKz0gbDsKICAgICAgdGhpcy5zZXRIU0woX2hzbEEuaCwgX2hzbEEucywgX2hzbEEubCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWRkKGNvbG9yKSB7CiAgICAgIHRoaXMuciArPSBjb2xvci5yOwogICAgICB0aGlzLmcgKz0gY29sb3IuZzsKICAgICAgdGhpcy5iICs9IGNvbG9yLmI7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWRkQ29sb3JzKGNvbG9yMSwgY29sb3IyKSB7CiAgICAgIHRoaXMuciA9IGNvbG9yMS5yICsgY29sb3IyLnI7CiAgICAgIHRoaXMuZyA9IGNvbG9yMS5nICsgY29sb3IyLmc7CiAgICAgIHRoaXMuYiA9IGNvbG9yMS5iICsgY29sb3IyLmI7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWRkU2NhbGFyKHMpIHsKICAgICAgdGhpcy5yICs9IHM7CiAgICAgIHRoaXMuZyArPSBzOwogICAgICB0aGlzLmIgKz0gczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzdWIoY29sb3IpIHsKICAgICAgdGhpcy5yID0gTWF0aC5tYXgoMCwgdGhpcy5yIC0gY29sb3Iucik7CiAgICAgIHRoaXMuZyA9IE1hdGgubWF4KDAsIHRoaXMuZyAtIGNvbG9yLmcpOwogICAgICB0aGlzLmIgPSBNYXRoLm1heCgwLCB0aGlzLmIgLSBjb2xvci5iKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBtdWx0aXBseShjb2xvcikgewogICAgICB0aGlzLnIgKj0gY29sb3IucjsKICAgICAgdGhpcy5nICo9IGNvbG9yLmc7CiAgICAgIHRoaXMuYiAqPSBjb2xvci5iOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG11bHRpcGx5U2NhbGFyKHMpIHsKICAgICAgdGhpcy5yICo9IHM7CiAgICAgIHRoaXMuZyAqPSBzOwogICAgICB0aGlzLmIgKj0gczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBsZXJwKGNvbG9yLCBhbHBoYSkgewogICAgICB0aGlzLnIgKz0gKGNvbG9yLnIgLSB0aGlzLnIpICogYWxwaGE7CiAgICAgIHRoaXMuZyArPSAoY29sb3IuZyAtIHRoaXMuZykgKiBhbHBoYTsKICAgICAgdGhpcy5iICs9IChjb2xvci5iIC0gdGhpcy5iKSAqIGFscGhhOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGxlcnBDb2xvcnMoY29sb3IxLCBjb2xvcjIsIGFscGhhKSB7CiAgICAgIHRoaXMuciA9IGNvbG9yMS5yICsgKGNvbG9yMi5yIC0gY29sb3IxLnIpICogYWxwaGE7CiAgICAgIHRoaXMuZyA9IGNvbG9yMS5nICsgKGNvbG9yMi5nIC0gY29sb3IxLmcpICogYWxwaGE7CiAgICAgIHRoaXMuYiA9IGNvbG9yMS5iICsgKGNvbG9yMi5iIC0gY29sb3IxLmIpICogYWxwaGE7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgbGVycEhTTChjb2xvciwgYWxwaGEpIHsKICAgICAgdGhpcy5nZXRIU0woX2hzbEEpOwogICAgICBjb2xvci5nZXRIU0woX2hzbEIpOwogICAgICBjb25zdCBoID0gbGVycChfaHNsQS5oLCBfaHNsQi5oLCBhbHBoYSk7CiAgICAgIGNvbnN0IHMgPSBsZXJwKF9oc2xBLnMsIF9oc2xCLnMsIGFscGhhKTsKICAgICAgY29uc3QgbCA9IGxlcnAoX2hzbEEubCwgX2hzbEIubCwgYWxwaGEpOwogICAgICB0aGlzLnNldEhTTChoLCBzLCBsKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBlcXVhbHMoYykgewogICAgICByZXR1cm4gYy5yID09PSB0aGlzLnIgJiYgYy5nID09PSB0aGlzLmcgJiYgYy5iID09PSB0aGlzLmI7CiAgICB9CiAgICBmcm9tQXJyYXkoYXJyYXksIG9mZnNldCA9IDApIHsKICAgICAgdGhpcy5yID0gYXJyYXlbb2Zmc2V0XTsKICAgICAgdGhpcy5nID0gYXJyYXlbb2Zmc2V0ICsgMV07CiAgICAgIHRoaXMuYiA9IGFycmF5W29mZnNldCArIDJdOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvQXJyYXkoYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCkgewogICAgICBhcnJheVtvZmZzZXRdID0gdGhpcy5yOwogICAgICBhcnJheVtvZmZzZXQgKyAxXSA9IHRoaXMuZzsKICAgICAgYXJyYXlbb2Zmc2V0ICsgMl0gPSB0aGlzLmI7CiAgICAgIHJldHVybiBhcnJheTsKICAgIH0KICAgIGZyb21CdWZmZXJBdHRyaWJ1dGUoYXR0cmlidXRlLCBpbmRleCkgewogICAgICB0aGlzLnIgPSBhdHRyaWJ1dGUuZ2V0WChpbmRleCk7CiAgICAgIHRoaXMuZyA9IGF0dHJpYnV0ZS5nZXRZKGluZGV4KTsKICAgICAgdGhpcy5iID0gYXR0cmlidXRlLmdldFooaW5kZXgpOwogICAgICBpZiAoYXR0cmlidXRlLm5vcm1hbGl6ZWQgPT09IHRydWUpIHsKICAgICAgICB0aGlzLnIgLz0gMjU1OwogICAgICAgIHRoaXMuZyAvPSAyNTU7CiAgICAgICAgdGhpcy5iIC89IDI1NTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0SGV4KCk7CiAgICB9CiAgfTsKICBDb2xvci5OQU1FUyA9IF9jb2xvcktleXdvcmRzOwogIENvbG9yLnByb3RvdHlwZS5pc0NvbG9yID0gdHJ1ZTsKICBDb2xvci5wcm90b3R5cGUuciA9IDE7CiAgQ29sb3IucHJvdG90eXBlLmcgPSAxOwogIENvbG9yLnByb3RvdHlwZS5iID0gMTsKICB2YXIgTWVzaEJhc2ljTWF0ZXJpYWwgPSBjbGFzcyBleHRlbmRzIE1hdGVyaWFsIHsKICAgIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIk1lc2hCYXNpY01hdGVyaWFsIjsKICAgICAgdGhpcy5jb2xvciA9IG5ldyBDb2xvcigxNjc3NzIxNSk7CiAgICAgIHRoaXMubWFwID0gbnVsbDsKICAgICAgdGhpcy5saWdodE1hcCA9IG51bGw7CiAgICAgIHRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSAxOwogICAgICB0aGlzLmFvTWFwID0gbnVsbDsKICAgICAgdGhpcy5hb01hcEludGVuc2l0eSA9IDE7CiAgICAgIHRoaXMuc3BlY3VsYXJNYXAgPSBudWxsOwogICAgICB0aGlzLmFscGhhTWFwID0gbnVsbDsKICAgICAgdGhpcy5lbnZNYXAgPSBudWxsOwogICAgICB0aGlzLmNvbWJpbmUgPSBNdWx0aXBseU9wZXJhdGlvbjsKICAgICAgdGhpcy5yZWZsZWN0aXZpdHkgPSAxOwogICAgICB0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IDAuOTg7CiAgICAgIHRoaXMud2lyZWZyYW1lID0gZmFsc2U7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gInJvdW5kIjsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9ICJyb3VuZCI7CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gZmFsc2U7CiAgICAgIHRoaXMuc2V0VmFsdWVzKHBhcmFtZXRlcnMpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLmNvbG9yLmNvcHkoc291cmNlLmNvbG9yKTsKICAgICAgdGhpcy5tYXAgPSBzb3VyY2UubWFwOwogICAgICB0aGlzLmxpZ2h0TWFwID0gc291cmNlLmxpZ2h0TWFwOwogICAgICB0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwogICAgICB0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwogICAgICB0aGlzLmFvTWFwSW50ZW5zaXR5ID0gc291cmNlLmFvTWFwSW50ZW5zaXR5OwogICAgICB0aGlzLnNwZWN1bGFyTWFwID0gc291cmNlLnNwZWN1bGFyTWFwOwogICAgICB0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwogICAgICB0aGlzLmVudk1hcCA9IHNvdXJjZS5lbnZNYXA7CiAgICAgIHRoaXMuY29tYmluZSA9IHNvdXJjZS5jb21iaW5lOwogICAgICB0aGlzLnJlZmxlY3Rpdml0eSA9IHNvdXJjZS5yZWZsZWN0aXZpdHk7CiAgICAgIHRoaXMucmVmcmFjdGlvblJhdGlvID0gc291cmNlLnJlZnJhY3Rpb25SYXRpbzsKICAgICAgdGhpcy53aXJlZnJhbWUgPSBzb3VyY2Uud2lyZWZyYW1lOwogICAgICB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZWNhcCA9IHNvdXJjZS53aXJlZnJhbWVMaW5lY2FwOwogICAgICB0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gc291cmNlLndpcmVmcmFtZUxpbmVqb2luOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgTWVzaEJhc2ljTWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaEJhc2ljTWF0ZXJpYWwgPSB0cnVlOwogIHZhciBfdmVjdG9yJDkgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX3ZlY3RvcjIkMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMigpOwogIHZhciBCdWZmZXJBdHRyaWJ1dGUgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyYXkpKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiVEhSRUUuQnVmZmVyQXR0cmlidXRlOiBhcnJheSBzaG91bGQgYmUgYSBUeXBlZCBBcnJheS4iKTsKICAgICAgfQogICAgICB0aGlzLm5hbWUgPSAiIjsKICAgICAgdGhpcy5hcnJheSA9IGFycmF5OwogICAgICB0aGlzLml0ZW1TaXplID0gaXRlbVNpemU7CiAgICAgIHRoaXMuY291bnQgPSBhcnJheSAhPT0gdm9pZCAwID8gYXJyYXkubGVuZ3RoIC8gaXRlbVNpemUgOiAwOwogICAgICB0aGlzLm5vcm1hbGl6ZWQgPSBub3JtYWxpemVkID09PSB0cnVlOwogICAgICB0aGlzLnVzYWdlID0gU3RhdGljRHJhd1VzYWdlOwogICAgICB0aGlzLnVwZGF0ZVJhbmdlID0geyBvZmZzZXQ6IDAsIGNvdW50OiAtMSB9OwogICAgICB0aGlzLnZlcnNpb24gPSAwOwogICAgfQogICAgb25VcGxvYWRDYWxsYmFjaygpIHsKICAgIH0KICAgIHNldCBuZWVkc1VwZGF0ZSh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHRydWUpCiAgICAgICAgdGhpcy52ZXJzaW9uKys7CiAgICB9CiAgICBzZXRVc2FnZSh2YWx1ZSkgewogICAgICB0aGlzLnVzYWdlID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CiAgICAgIHRoaXMuYXJyYXkgPSBuZXcgc291cmNlLmFycmF5LmNvbnN0cnVjdG9yKHNvdXJjZS5hcnJheSk7CiAgICAgIHRoaXMuaXRlbVNpemUgPSBzb3VyY2UuaXRlbVNpemU7CiAgICAgIHRoaXMuY291bnQgPSBzb3VyY2UuY291bnQ7CiAgICAgIHRoaXMubm9ybWFsaXplZCA9IHNvdXJjZS5ub3JtYWxpemVkOwogICAgICB0aGlzLnVzYWdlID0gc291cmNlLnVzYWdlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvcHlBdChpbmRleDEsIGF0dHJpYnV0ZSwgaW5kZXgyKSB7CiAgICAgIGluZGV4MSAqPSB0aGlzLml0ZW1TaXplOwogICAgICBpbmRleDIgKj0gYXR0cmlidXRlLml0ZW1TaXplOwogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHRoaXMuaXRlbVNpemU7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLmFycmF5W2luZGV4MSArIGldID0gYXR0cmlidXRlLmFycmF5W2luZGV4MiArIGldOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY29weUFycmF5KGFycmF5KSB7CiAgICAgIHRoaXMuYXJyYXkuc2V0KGFycmF5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb3B5Q29sb3JzQXJyYXkoY29sb3JzKSB7CiAgICAgIGNvbnN0IGFycmF5ID0gdGhpcy5hcnJheTsKICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gY29sb3JzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGxldCBjb2xvciA9IGNvbG9yc1tpXTsKICAgICAgICBpZiAoY29sb3IgPT09IHZvaWQgMCkgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5CdWZmZXJBdHRyaWJ1dGUuY29weUNvbG9yc0FycmF5KCk6IGNvbG9yIGlzIHVuZGVmaW5lZCIsIGkpOwogICAgICAgICAgY29sb3IgPSBuZXcgQ29sb3IoKTsKICAgICAgICB9CiAgICAgICAgYXJyYXlbb2Zmc2V0KytdID0gY29sb3IucjsKICAgICAgICBhcnJheVtvZmZzZXQrK10gPSBjb2xvci5nOwogICAgICAgIGFycmF5W29mZnNldCsrXSA9IGNvbG9yLmI7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb3B5VmVjdG9yMnNBcnJheSh2ZWN0b3JzKSB7CiAgICAgIGNvbnN0IGFycmF5ID0gdGhpcy5hcnJheTsKICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdmVjdG9ycy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBsZXQgdmVjdG9yID0gdmVjdG9yc1tpXTsKICAgICAgICBpZiAodmVjdG9yID09PSB2b2lkIDApIHsKICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuQnVmZmVyQXR0cmlidXRlLmNvcHlWZWN0b3Iyc0FycmF5KCk6IHZlY3RvciBpcyB1bmRlZmluZWQiLCBpKTsKICAgICAgICAgIHZlY3RvciA9IG5ldyBWZWN0b3IyKCk7CiAgICAgICAgfQogICAgICAgIGFycmF5W29mZnNldCsrXSA9IHZlY3Rvci54OwogICAgICAgIGFycmF5W29mZnNldCsrXSA9IHZlY3Rvci55OwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY29weVZlY3RvcjNzQXJyYXkodmVjdG9ycykgewogICAgICBjb25zdCBhcnJheSA9IHRoaXMuYXJyYXk7CiAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHZlY3RvcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgbGV0IHZlY3RvciA9IHZlY3RvcnNbaV07CiAgICAgICAgaWYgKHZlY3RvciA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJ1ZmZlckF0dHJpYnV0ZS5jb3B5VmVjdG9yM3NBcnJheSgpOiB2ZWN0b3IgaXMgdW5kZWZpbmVkIiwgaSk7CiAgICAgICAgICB2ZWN0b3IgPSBuZXcgVmVjdG9yMygpOwogICAgICAgIH0KICAgICAgICBhcnJheVtvZmZzZXQrK10gPSB2ZWN0b3IueDsKICAgICAgICBhcnJheVtvZmZzZXQrK10gPSB2ZWN0b3IueTsKICAgICAgICBhcnJheVtvZmZzZXQrK10gPSB2ZWN0b3IuejsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvcHlWZWN0b3I0c0FycmF5KHZlY3RvcnMpIHsKICAgICAgY29uc3QgYXJyYXkgPSB0aGlzLmFycmF5OwogICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB2ZWN0b3JzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGxldCB2ZWN0b3IgPSB2ZWN0b3JzW2ldOwogICAgICAgIGlmICh2ZWN0b3IgPT09IHZvaWQgMCkgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5CdWZmZXJBdHRyaWJ1dGUuY29weVZlY3RvcjRzQXJyYXkoKTogdmVjdG9yIGlzIHVuZGVmaW5lZCIsIGkpOwogICAgICAgICAgdmVjdG9yID0gbmV3IFZlY3RvcjQoKTsKICAgICAgICB9CiAgICAgICAgYXJyYXlbb2Zmc2V0KytdID0gdmVjdG9yLng7CiAgICAgICAgYXJyYXlbb2Zmc2V0KytdID0gdmVjdG9yLnk7CiAgICAgICAgYXJyYXlbb2Zmc2V0KytdID0gdmVjdG9yLno7CiAgICAgICAgYXJyYXlbb2Zmc2V0KytdID0gdmVjdG9yLnc7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBhcHBseU1hdHJpeDMobSkgewogICAgICBpZiAodGhpcy5pdGVtU2l6ZSA9PT0gMikgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkrKykgewogICAgICAgICAgX3ZlY3RvcjIkMS5mcm9tQnVmZmVyQXR0cmlidXRlKHRoaXMsIGkpOwogICAgICAgICAgX3ZlY3RvcjIkMS5hcHBseU1hdHJpeDMobSk7CiAgICAgICAgICB0aGlzLnNldFhZKGksIF92ZWN0b3IyJDEueCwgX3ZlY3RvcjIkMS55KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5pdGVtU2l6ZSA9PT0gMykgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkrKykgewogICAgICAgICAgX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUodGhpcywgaSk7CiAgICAgICAgICBfdmVjdG9yJDkuYXBwbHlNYXRyaXgzKG0pOwogICAgICAgICAgdGhpcy5zZXRYWVooaSwgX3ZlY3RvciQ5LngsIF92ZWN0b3IkOS55LCBfdmVjdG9yJDkueik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYXBwbHlNYXRyaXg0KG0pIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSsrKSB7CiAgICAgICAgX3ZlY3RvciQ5LnggPSB0aGlzLmdldFgoaSk7CiAgICAgICAgX3ZlY3RvciQ5LnkgPSB0aGlzLmdldFkoaSk7CiAgICAgICAgX3ZlY3RvciQ5LnogPSB0aGlzLmdldFooaSk7CiAgICAgICAgX3ZlY3RvciQ5LmFwcGx5TWF0cml4NChtKTsKICAgICAgICB0aGlzLnNldFhZWihpLCBfdmVjdG9yJDkueCwgX3ZlY3RvciQ5LnksIF92ZWN0b3IkOS56KTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFwcGx5Tm9ybWFsTWF0cml4KG0pIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSsrKSB7CiAgICAgICAgX3ZlY3RvciQ5LnggPSB0aGlzLmdldFgoaSk7CiAgICAgICAgX3ZlY3RvciQ5LnkgPSB0aGlzLmdldFkoaSk7CiAgICAgICAgX3ZlY3RvciQ5LnogPSB0aGlzLmdldFooaSk7CiAgICAgICAgX3ZlY3RvciQ5LmFwcGx5Tm9ybWFsTWF0cml4KG0pOwogICAgICAgIHRoaXMuc2V0WFlaKGksIF92ZWN0b3IkOS54LCBfdmVjdG9yJDkueSwgX3ZlY3RvciQ5LnopOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdHJhbnNmb3JtRGlyZWN0aW9uKG0pIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSsrKSB7CiAgICAgICAgX3ZlY3RvciQ5LnggPSB0aGlzLmdldFgoaSk7CiAgICAgICAgX3ZlY3RvciQ5LnkgPSB0aGlzLmdldFkoaSk7CiAgICAgICAgX3ZlY3RvciQ5LnogPSB0aGlzLmdldFooaSk7CiAgICAgICAgX3ZlY3RvciQ5LnRyYW5zZm9ybURpcmVjdGlvbihtKTsKICAgICAgICB0aGlzLnNldFhZWihpLCBfdmVjdG9yJDkueCwgX3ZlY3RvciQ5LnksIF92ZWN0b3IkOS56KTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldCh2YWx1ZSwgb2Zmc2V0ID0gMCkgewogICAgICB0aGlzLmFycmF5LnNldCh2YWx1ZSwgb2Zmc2V0KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXRYKGluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLmFycmF5W2luZGV4ICogdGhpcy5pdGVtU2l6ZV07CiAgICB9CiAgICBzZXRYKGluZGV4LCB4KSB7CiAgICAgIHRoaXMuYXJyYXlbaW5kZXggKiB0aGlzLml0ZW1TaXplXSA9IHg7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0WShpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5hcnJheVtpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAxXTsKICAgIH0KICAgIHNldFkoaW5kZXgsIHkpIHsKICAgICAgdGhpcy5hcnJheVtpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAxXSA9IHk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0WihpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5hcnJheVtpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyXTsKICAgIH0KICAgIHNldFooaW5kZXgsIHopIHsKICAgICAgdGhpcy5hcnJheVtpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyXSA9IHo7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0VyhpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5hcnJheVtpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAzXTsKICAgIH0KICAgIHNldFcoaW5kZXgsIHcpIHsKICAgICAgdGhpcy5hcnJheVtpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAzXSA9IHc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0WFkoaW5kZXgsIHgsIHkpIHsKICAgICAgaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKICAgICAgdGhpcy5hcnJheVtpbmRleCArIDBdID0geDsKICAgICAgdGhpcy5hcnJheVtpbmRleCArIDFdID0geTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRYWVooaW5kZXgsIHgsIHksIHopIHsKICAgICAgaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKICAgICAgdGhpcy5hcnJheVtpbmRleCArIDBdID0geDsKICAgICAgdGhpcy5hcnJheVtpbmRleCArIDFdID0geTsKICAgICAgdGhpcy5hcnJheVtpbmRleCArIDJdID0gejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRYWVpXKGluZGV4LCB4LCB5LCB6LCB3KSB7CiAgICAgIGluZGV4ICo9IHRoaXMuaXRlbVNpemU7CiAgICAgIHRoaXMuYXJyYXlbaW5kZXggKyAwXSA9IHg7CiAgICAgIHRoaXMuYXJyYXlbaW5kZXggKyAxXSA9IHk7CiAgICAgIHRoaXMuYXJyYXlbaW5kZXggKyAyXSA9IHo7CiAgICAgIHRoaXMuYXJyYXlbaW5kZXggKyAzXSA9IHc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgb25VcGxvYWQoY2FsbGJhY2spIHsKICAgICAgdGhpcy5vblVwbG9hZENhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLmFycmF5LCB0aGlzLml0ZW1TaXplKS5jb3B5KHRoaXMpOwogICAgfQogICAgdG9KU09OKCkgewogICAgICBjb25zdCBkYXRhID0gewogICAgICAgIGl0ZW1TaXplOiB0aGlzLml0ZW1TaXplLAogICAgICAgIHR5cGU6IHRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSwKICAgICAgICBhcnJheTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5hcnJheSksCiAgICAgICAgbm9ybWFsaXplZDogdGhpcy5ub3JtYWxpemVkCiAgICAgIH07CiAgICAgIGlmICh0aGlzLm5hbWUgIT09ICIiKQogICAgICAgIGRhdGEubmFtZSA9IHRoaXMubmFtZTsKICAgICAgaWYgKHRoaXMudXNhZ2UgIT09IFN0YXRpY0RyYXdVc2FnZSkKICAgICAgICBkYXRhLnVzYWdlID0gdGhpcy51c2FnZTsKICAgICAgaWYgKHRoaXMudXBkYXRlUmFuZ2Uub2Zmc2V0ICE9PSAwIHx8IHRoaXMudXBkYXRlUmFuZ2UuY291bnQgIT09IC0xKQogICAgICAgIGRhdGEudXBkYXRlUmFuZ2UgPSB0aGlzLnVwZGF0ZVJhbmdlOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICB9OwogIEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUuaXNCdWZmZXJBdHRyaWJ1dGUgPSB0cnVlOwogIHZhciBVaW50MTZCdWZmZXJBdHRyaWJ1dGUgPSBjbGFzcyBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CiAgICBjb25zdHJ1Y3RvcihhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQpIHsKICAgICAgc3VwZXIobmV3IFVpbnQxNkFycmF5KGFycmF5KSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQpOwogICAgfQogIH07CiAgdmFyIFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA9IGNsYXNzIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKICAgIGNvbnN0cnVjdG9yKGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCkgewogICAgICBzdXBlcihuZXcgVWludDMyQXJyYXkoYXJyYXkpLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCk7CiAgICB9CiAgfTsKICB2YXIgRmxvYXQxNkJ1ZmZlckF0dHJpYnV0ZSA9IGNsYXNzIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKICAgIGNvbnN0cnVjdG9yKGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCkgewogICAgICBzdXBlcihuZXcgVWludDE2QXJyYXkoYXJyYXkpLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCk7CiAgICB9CiAgfTsKICBGbG9hdDE2QnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZS5pc0Zsb2F0MTZCdWZmZXJBdHRyaWJ1dGUgPSB0cnVlOwogIHZhciBGbG9hdDMyQnVmZmVyQXR0cmlidXRlID0gY2xhc3MgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewogICAgY29uc3RydWN0b3IoYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkKSB7CiAgICAgIHN1cGVyKG5ldyBGbG9hdDMyQXJyYXkoYXJyYXkpLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCk7CiAgICB9CiAgfTsKICBmdW5jdGlvbiBhcnJheU1heChhcnJheSkgewogICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gMCkKICAgICAgcmV0dXJuIC1JbmZpbml0eTsKICAgIGxldCBtYXggPSBhcnJheVswXTsKICAgIGZvciAobGV0IGkgPSAxLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgIGlmIChhcnJheVtpXSA+IG1heCkKICAgICAgICBtYXggPSBhcnJheVtpXTsKICAgIH0KICAgIHJldHVybiBtYXg7CiAgfQogIHZhciBfaWQgPSAwOwogIHZhciBfbTEgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hdHJpeDQoKTsKICB2YXIgX29iaiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgT2JqZWN0M0QoKTsKICB2YXIgX29mZnNldCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfYm94JDEgPSAvKiBAX19QVVJFX18gKi8gbmV3IEJveDMoKTsKICB2YXIgX2JveE1vcnBoVGFyZ2V0cyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgQm94MygpOwogIHZhciBfdmVjdG9yJDggPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgQnVmZmVyR2VvbWV0cnkgPSBjbGFzcyBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJpZCIsIHsgdmFsdWU6IF9pZCsrIH0pOwogICAgICB0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKICAgICAgdGhpcy5uYW1lID0gIiI7CiAgICAgIHRoaXMudHlwZSA9ICJCdWZmZXJHZW9tZXRyeSI7CiAgICAgIHRoaXMuaW5kZXggPSBudWxsOwogICAgICB0aGlzLmF0dHJpYnV0ZXMgPSB7fTsKICAgICAgdGhpcy5tb3JwaEF0dHJpYnV0ZXMgPSB7fTsKICAgICAgdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IGZhbHNlOwogICAgICB0aGlzLmdyb3VwcyA9IFtdOwogICAgICB0aGlzLmJvdW5kaW5nQm94ID0gbnVsbDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CiAgICAgIHRoaXMuZHJhd1JhbmdlID0geyBzdGFydDogMCwgY291bnQ6IEluZmluaXR5IH07CiAgICAgIHRoaXMudXNlckRhdGEgPSB7fTsKICAgIH0KICAgIGdldEluZGV4KCkgewogICAgICByZXR1cm4gdGhpcy5pbmRleDsKICAgIH0KICAgIHNldEluZGV4KGluZGV4KSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGluZGV4KSkgewogICAgICAgIHRoaXMuaW5kZXggPSBuZXcgKGFycmF5TWF4KGluZGV4KSA+IDY1NTM1ID8gVWludDMyQnVmZmVyQXR0cmlidXRlIDogVWludDE2QnVmZmVyQXR0cmlidXRlKShpbmRleCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbmRleCA9IGluZGV4OwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0QXR0cmlidXRlKG5hbWUpIHsKICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1tuYW1lXTsKICAgIH0KICAgIHNldEF0dHJpYnV0ZShuYW1lLCBhdHRyaWJ1dGUpIHsKICAgICAgdGhpcy5hdHRyaWJ1dGVzW25hbWVdID0gYXR0cmlidXRlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGRlbGV0ZUF0dHJpYnV0ZShuYW1lKSB7CiAgICAgIGRlbGV0ZSB0aGlzLmF0dHJpYnV0ZXNbbmFtZV07CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgaGFzQXR0cmlidXRlKG5hbWUpIHsKICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1tuYW1lXSAhPT0gdm9pZCAwOwogICAgfQogICAgYWRkR3JvdXAoc3RhcnQsIGNvdW50LCBtYXRlcmlhbEluZGV4ID0gMCkgewogICAgICB0aGlzLmdyb3Vwcy5wdXNoKHsKICAgICAgICBzdGFydCwKICAgICAgICBjb3VudCwKICAgICAgICBtYXRlcmlhbEluZGV4CiAgICAgIH0pOwogICAgfQogICAgY2xlYXJHcm91cHMoKSB7CiAgICAgIHRoaXMuZ3JvdXBzID0gW107CiAgICB9CiAgICBzZXREcmF3UmFuZ2Uoc3RhcnQsIGNvdW50KSB7CiAgICAgIHRoaXMuZHJhd1JhbmdlLnN0YXJ0ID0gc3RhcnQ7CiAgICAgIHRoaXMuZHJhd1JhbmdlLmNvdW50ID0gY291bnQ7CiAgICB9CiAgICBhcHBseU1hdHJpeDQobWF0cml4KSB7CiAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uOwogICAgICBpZiAocG9zaXRpb24gIT09IHZvaWQgMCkgewogICAgICAgIHBvc2l0aW9uLmFwcGx5TWF0cml4NChtYXRyaXgpOwogICAgICAgIHBvc2l0aW9uLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgfQogICAgICBjb25zdCBub3JtYWwyID0gdGhpcy5hdHRyaWJ1dGVzLm5vcm1hbDsKICAgICAgaWYgKG5vcm1hbDIgIT09IHZvaWQgMCkgewogICAgICAgIGNvbnN0IG5vcm1hbE1hdHJpeCA9IG5ldyBNYXRyaXgzKCkuZ2V0Tm9ybWFsTWF0cml4KG1hdHJpeCk7CiAgICAgICAgbm9ybWFsMi5hcHBseU5vcm1hbE1hdHJpeChub3JtYWxNYXRyaXgpOwogICAgICAgIG5vcm1hbDIubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB9CiAgICAgIGNvbnN0IHRhbmdlbnQgPSB0aGlzLmF0dHJpYnV0ZXMudGFuZ2VudDsKICAgICAgaWYgKHRhbmdlbnQgIT09IHZvaWQgMCkgewogICAgICAgIHRhbmdlbnQudHJhbnNmb3JtRGlyZWN0aW9uKG1hdHJpeCk7CiAgICAgICAgdGFuZ2VudC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYm91bmRpbmdCb3ggIT09IG51bGwpIHsKICAgICAgICB0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmJvdW5kaW5nU3BoZXJlICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFwcGx5UXVhdGVybmlvbihxKSB7CiAgICAgIF9tMS5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbihxKTsKICAgICAgdGhpcy5hcHBseU1hdHJpeDQoX20xKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByb3RhdGVYKGFuZ2xlKSB7CiAgICAgIF9tMS5tYWtlUm90YXRpb25YKGFuZ2xlKTsKICAgICAgdGhpcy5hcHBseU1hdHJpeDQoX20xKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByb3RhdGVZKGFuZ2xlKSB7CiAgICAgIF9tMS5tYWtlUm90YXRpb25ZKGFuZ2xlKTsKICAgICAgdGhpcy5hcHBseU1hdHJpeDQoX20xKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByb3RhdGVaKGFuZ2xlKSB7CiAgICAgIF9tMS5tYWtlUm90YXRpb25aKGFuZ2xlKTsKICAgICAgdGhpcy5hcHBseU1hdHJpeDQoX20xKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0cmFuc2xhdGUoeCwgeSwgeikgewogICAgICBfbTEubWFrZVRyYW5zbGF0aW9uKHgsIHksIHopOwogICAgICB0aGlzLmFwcGx5TWF0cml4NChfbTEpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNjYWxlKHgsIHksIHopIHsKICAgICAgX20xLm1ha2VTY2FsZSh4LCB5LCB6KTsKICAgICAgdGhpcy5hcHBseU1hdHJpeDQoX20xKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBsb29rQXQodmVjdG9yKSB7CiAgICAgIF9vYmoubG9va0F0KHZlY3Rvcik7CiAgICAgIF9vYmoudXBkYXRlTWF0cml4KCk7CiAgICAgIHRoaXMuYXBwbHlNYXRyaXg0KF9vYmoubWF0cml4KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjZW50ZXIoKSB7CiAgICAgIHRoaXMuY29tcHV0ZUJvdW5kaW5nQm94KCk7CiAgICAgIHRoaXMuYm91bmRpbmdCb3guZ2V0Q2VudGVyKF9vZmZzZXQpLm5lZ2F0ZSgpOwogICAgICB0aGlzLnRyYW5zbGF0ZShfb2Zmc2V0LngsIF9vZmZzZXQueSwgX29mZnNldC56KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRGcm9tUG9pbnRzKHBvaW50cykgewogICAgICBjb25zdCBwb3NpdGlvbiA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCBwb2ludCA9IHBvaW50c1tpXTsKICAgICAgICBwb3NpdGlvbi5wdXNoKHBvaW50LngsIHBvaW50LnksIHBvaW50LnogfHwgMCk7CiAgICAgIH0KICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoInBvc2l0aW9uIiwgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUocG9zaXRpb24sIDMpKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb21wdXRlQm91bmRpbmdCb3goKSB7CiAgICAgIGlmICh0aGlzLmJvdW5kaW5nQm94ID09PSBudWxsKSB7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveCA9IG5ldyBCb3gzKCk7CiAgICAgIH0KICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAgIGNvbnN0IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uID0gdGhpcy5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAgIGlmIChwb3NpdGlvbiAmJiBwb3NpdGlvbi5pc0dMQnVmZmVyQXR0cmlidXRlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk6IEdMQnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIGEgbWFudWFsIGJvdW5kaW5nIGJveC4gQWx0ZXJuYXRpdmVseSBzZXQgIm1lc2guZnJ1c3R1bUN1bGxlZCIgdG8gImZhbHNlIi4nLCB0aGlzKTsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnNldChuZXcgVmVjdG9yMygtSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5KSwgbmV3IFZlY3RvcjMoSW5maW5pdHksIEluZmluaXR5LCBJbmZpbml0eSkpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAocG9zaXRpb24gIT09IHZvaWQgMCkgewogICAgICAgIHRoaXMuYm91bmRpbmdCb3guc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZShwb3NpdGlvbik7CiAgICAgICAgaWYgKG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uKSB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbi5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb25baV07CiAgICAgICAgICAgIF9ib3gkMS5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKG1vcnBoQXR0cmlidXRlKTsKICAgICAgICAgICAgaWYgKHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmUpIHsKICAgICAgICAgICAgICBfdmVjdG9yJDguYWRkVmVjdG9ycyh0aGlzLmJvdW5kaW5nQm94Lm1pbiwgX2JveCQxLm1pbik7CiAgICAgICAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KF92ZWN0b3IkOCk7CiAgICAgICAgICAgICAgX3ZlY3RvciQ4LmFkZFZlY3RvcnModGhpcy5ib3VuZGluZ0JveC5tYXgsIF9ib3gkMS5tYXgpOwogICAgICAgICAgICAgIHRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludChfdmVjdG9yJDgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludChfYm94JDEubWluKTsKICAgICAgICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmV4cGFuZEJ5UG9pbnQoX2JveCQxLm1heCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5tYWtlRW1wdHkoKTsKICAgICAgfQogICAgICBpZiAoaXNOYU4odGhpcy5ib3VuZGluZ0JveC5taW4ueCkgfHwgaXNOYU4odGhpcy5ib3VuZGluZ0JveC5taW4ueSkgfHwgaXNOYU4odGhpcy5ib3VuZGluZ0JveC5taW4ueikpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTogQ29tcHV0ZWQgbWluL21heCBoYXZlIE5hTiB2YWx1ZXMuIFRoZSAicG9zaXRpb24iIGF0dHJpYnV0ZSBpcyBsaWtlbHkgdG8gaGF2ZSBOYU4gdmFsdWVzLicsIHRoaXMpOwogICAgICB9CiAgICB9CiAgICBjb21wdXRlQm91bmRpbmdTcGhlcmUoKSB7CiAgICAgIGlmICh0aGlzLmJvdW5kaW5nU3BoZXJlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG5ldyBTcGhlcmUoKTsKICAgICAgfQogICAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKICAgICAgY29uc3QgbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gPSB0aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKICAgICAgaWYgKHBvc2l0aW9uICYmIHBvc2l0aW9uLmlzR0xCdWZmZXJBdHRyaWJ1dGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTogR0xCdWZmZXJBdHRyaWJ1dGUgcmVxdWlyZXMgYSBtYW51YWwgYm91bmRpbmcgc3BoZXJlLiBBbHRlcm5hdGl2ZWx5IHNldCAibWVzaC5mcnVzdHVtQ3VsbGVkIiB0byAiZmFsc2UiLicsIHRoaXMpOwogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmUuc2V0KG5ldyBWZWN0b3IzKCksIEluZmluaXR5KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHBvc2l0aW9uKSB7CiAgICAgICAgY29uc3QgY2VudGVyID0gdGhpcy5ib3VuZGluZ1NwaGVyZS5jZW50ZXI7CiAgICAgICAgX2JveCQxLnNldEZyb21CdWZmZXJBdHRyaWJ1dGUocG9zaXRpb24pOwogICAgICAgIGlmIChtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbikgewogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgICBjb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uW2ldOwogICAgICAgICAgICBfYm94TW9ycGhUYXJnZXRzLnNldEZyb21CdWZmZXJBdHRyaWJ1dGUobW9ycGhBdHRyaWJ1dGUpOwogICAgICAgICAgICBpZiAodGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSkgewogICAgICAgICAgICAgIF92ZWN0b3IkOC5hZGRWZWN0b3JzKF9ib3gkMS5taW4sIF9ib3hNb3JwaFRhcmdldHMubWluKTsKICAgICAgICAgICAgICBfYm94JDEuZXhwYW5kQnlQb2ludChfdmVjdG9yJDgpOwogICAgICAgICAgICAgIF92ZWN0b3IkOC5hZGRWZWN0b3JzKF9ib3gkMS5tYXgsIF9ib3hNb3JwaFRhcmdldHMubWF4KTsKICAgICAgICAgICAgICBfYm94JDEuZXhwYW5kQnlQb2ludChfdmVjdG9yJDgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF9ib3gkMS5leHBhbmRCeVBvaW50KF9ib3hNb3JwaFRhcmdldHMubWluKTsKICAgICAgICAgICAgICBfYm94JDEuZXhwYW5kQnlQb2ludChfYm94TW9ycGhUYXJnZXRzLm1heCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX2JveCQxLmdldENlbnRlcihjZW50ZXIpOwogICAgICAgIGxldCBtYXhSYWRpdXNTcSA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gcG9zaXRpb24uY291bnQ7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgICBfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZShwb3NpdGlvbiwgaSk7CiAgICAgICAgICBtYXhSYWRpdXNTcSA9IE1hdGgubWF4KG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoX3ZlY3RvciQ4KSk7CiAgICAgICAgfQogICAgICAgIGlmIChtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbikgewogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgICBjb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uW2ldOwogICAgICAgICAgICBjb25zdCBtb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBqbCA9IG1vcnBoQXR0cmlidXRlLmNvdW50OyBqIDwgamw7IGorKykgewogICAgICAgICAgICAgIF92ZWN0b3IkOC5mcm9tQnVmZmVyQXR0cmlidXRlKG1vcnBoQXR0cmlidXRlLCBqKTsKICAgICAgICAgICAgICBpZiAobW9ycGhUYXJnZXRzUmVsYXRpdmUpIHsKICAgICAgICAgICAgICAgIF9vZmZzZXQuZnJvbUJ1ZmZlckF0dHJpYnV0ZShwb3NpdGlvbiwgaik7CiAgICAgICAgICAgICAgICBfdmVjdG9yJDguYWRkKF9vZmZzZXQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBtYXhSYWRpdXNTcSA9IE1hdGgubWF4KG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoX3ZlY3RvciQ4KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPSBNYXRoLnNxcnQobWF4UmFkaXVzU3EpOwogICAgICAgIGlmIChpc05hTih0aGlzLmJvdW5kaW5nU3BoZXJlLnJhZGl1cykpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOiBDb21wdXRlZCByYWRpdXMgaXMgTmFOLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLCB0aGlzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbXB1dGVGYWNlTm9ybWFscygpIHsKICAgIH0KICAgIGNvbXB1dGVUYW5nZW50cygpIHsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmluZGV4OwogICAgICBjb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzOwogICAgICBpZiAoaW5kZXggPT09IG51bGwgfHwgYXR0cmlidXRlcy5wb3NpdGlvbiA9PT0gdm9pZCAwIHx8IGF0dHJpYnV0ZXMubm9ybWFsID09PSB2b2lkIDAgfHwgYXR0cmlidXRlcy51diA9PT0gdm9pZCAwKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuQnVmZmVyR2VvbWV0cnk6IC5jb21wdXRlVGFuZ2VudHMoKSBmYWlsZWQuIE1pc3NpbmcgcmVxdWlyZWQgYXR0cmlidXRlcyAoaW5kZXgsIHBvc2l0aW9uLCBub3JtYWwgb3IgdXYpIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGluZGljZXMgPSBpbmRleC5hcnJheTsKICAgICAgY29uc3QgcG9zaXRpb25zID0gYXR0cmlidXRlcy5wb3NpdGlvbi5hcnJheTsKICAgICAgY29uc3Qgbm9ybWFscyA9IGF0dHJpYnV0ZXMubm9ybWFsLmFycmF5OwogICAgICBjb25zdCB1dnMgPSBhdHRyaWJ1dGVzLnV2LmFycmF5OwogICAgICBjb25zdCBuVmVydGljZXMgPSBwb3NpdGlvbnMubGVuZ3RoIC8gMzsKICAgICAgaWYgKGF0dHJpYnV0ZXMudGFuZ2VudCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoInRhbmdlbnQiLCBuZXcgQnVmZmVyQXR0cmlidXRlKG5ldyBGbG9hdDMyQXJyYXkoNCAqIG5WZXJ0aWNlcyksIDQpKTsKICAgICAgfQogICAgICBjb25zdCB0YW5nZW50cyA9IGF0dHJpYnV0ZXMudGFuZ2VudC5hcnJheTsKICAgICAgY29uc3QgdGFuMSA9IFtdLCB0YW4yID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgblZlcnRpY2VzOyBpKyspIHsKICAgICAgICB0YW4xW2ldID0gbmV3IFZlY3RvcjMoKTsKICAgICAgICB0YW4yW2ldID0gbmV3IFZlY3RvcjMoKTsKICAgICAgfQogICAgICBjb25zdCB2QSA9IG5ldyBWZWN0b3IzKCksIHZCID0gbmV3IFZlY3RvcjMoKSwgdkMgPSBuZXcgVmVjdG9yMygpLCB1dkEgPSBuZXcgVmVjdG9yMigpLCB1dkIgPSBuZXcgVmVjdG9yMigpLCB1dkMgPSBuZXcgVmVjdG9yMigpLCBzZGlyID0gbmV3IFZlY3RvcjMoKSwgdGRpciA9IG5ldyBWZWN0b3IzKCk7CiAgICAgIGZ1bmN0aW9uIGhhbmRsZVRyaWFuZ2xlKGEsIGIsIGMpIHsKICAgICAgICB2QS5mcm9tQXJyYXkocG9zaXRpb25zLCBhICogMyk7CiAgICAgICAgdkIuZnJvbUFycmF5KHBvc2l0aW9ucywgYiAqIDMpOwogICAgICAgIHZDLmZyb21BcnJheShwb3NpdGlvbnMsIGMgKiAzKTsKICAgICAgICB1dkEuZnJvbUFycmF5KHV2cywgYSAqIDIpOwogICAgICAgIHV2Qi5mcm9tQXJyYXkodXZzLCBiICogMik7CiAgICAgICAgdXZDLmZyb21BcnJheSh1dnMsIGMgKiAyKTsKICAgICAgICB2Qi5zdWIodkEpOwogICAgICAgIHZDLnN1Yih2QSk7CiAgICAgICAgdXZCLnN1Yih1dkEpOwogICAgICAgIHV2Qy5zdWIodXZBKTsKICAgICAgICBjb25zdCByID0gMSAvICh1dkIueCAqIHV2Qy55IC0gdXZDLnggKiB1dkIueSk7CiAgICAgICAgaWYgKCFpc0Zpbml0ZShyKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBzZGlyLmNvcHkodkIpLm11bHRpcGx5U2NhbGFyKHV2Qy55KS5hZGRTY2FsZWRWZWN0b3IodkMsIC11dkIueSkubXVsdGlwbHlTY2FsYXIocik7CiAgICAgICAgdGRpci5jb3B5KHZDKS5tdWx0aXBseVNjYWxhcih1dkIueCkuYWRkU2NhbGVkVmVjdG9yKHZCLCAtdXZDLngpLm11bHRpcGx5U2NhbGFyKHIpOwogICAgICAgIHRhbjFbYV0uYWRkKHNkaXIpOwogICAgICAgIHRhbjFbYl0uYWRkKHNkaXIpOwogICAgICAgIHRhbjFbY10uYWRkKHNkaXIpOwogICAgICAgIHRhbjJbYV0uYWRkKHRkaXIpOwogICAgICAgIHRhbjJbYl0uYWRkKHRkaXIpOwogICAgICAgIHRhbjJbY10uYWRkKHRkaXIpOwogICAgICB9CiAgICAgIGxldCBncm91cHMgPSB0aGlzLmdyb3VwczsKICAgICAgaWYgKGdyb3Vwcy5sZW5ndGggPT09IDApIHsKICAgICAgICBncm91cHMgPSBbewogICAgICAgICAgc3RhcnQ6IDAsCiAgICAgICAgICBjb3VudDogaW5kaWNlcy5sZW5ndGgKICAgICAgICB9XTsKICAgICAgfQogICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBncm91cHMubGVuZ3RoOyBpIDwgaWw7ICsraSkgewogICAgICAgIGNvbnN0IGdyb3VwID0gZ3JvdXBzW2ldOwogICAgICAgIGNvbnN0IHN0YXJ0ID0gZ3JvdXAuc3RhcnQ7CiAgICAgICAgY29uc3QgY291bnQgPSBncm91cC5jb3VudDsKICAgICAgICBmb3IgKGxldCBqID0gc3RhcnQsIGpsID0gc3RhcnQgKyBjb3VudDsgaiA8IGpsOyBqICs9IDMpIHsKICAgICAgICAgIGhhbmRsZVRyaWFuZ2xlKGluZGljZXNbaiArIDBdLCBpbmRpY2VzW2ogKyAxXSwgaW5kaWNlc1tqICsgMl0pOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCB0bXAyID0gbmV3IFZlY3RvcjMoKSwgdG1wMjIgPSBuZXcgVmVjdG9yMygpOwogICAgICBjb25zdCBuID0gbmV3IFZlY3RvcjMoKSwgbjIgPSBuZXcgVmVjdG9yMygpOwogICAgICBmdW5jdGlvbiBoYW5kbGVWZXJ0ZXgodikgewogICAgICAgIG4uZnJvbUFycmF5KG5vcm1hbHMsIHYgKiAzKTsKICAgICAgICBuMi5jb3B5KG4pOwogICAgICAgIGNvbnN0IHQgPSB0YW4xW3ZdOwogICAgICAgIHRtcDIuY29weSh0KTsKICAgICAgICB0bXAyLnN1YihuLm11bHRpcGx5U2NhbGFyKG4uZG90KHQpKSkubm9ybWFsaXplKCk7CiAgICAgICAgdG1wMjIuY3Jvc3NWZWN0b3JzKG4yLCB0KTsKICAgICAgICBjb25zdCB0ZXN0ID0gdG1wMjIuZG90KHRhbjJbdl0pOwogICAgICAgIGNvbnN0IHcgPSB0ZXN0IDwgMCA/IC0xIDogMTsKICAgICAgICB0YW5nZW50c1t2ICogNF0gPSB0bXAyLng7CiAgICAgICAgdGFuZ2VudHNbdiAqIDQgKyAxXSA9IHRtcDIueTsKICAgICAgICB0YW5nZW50c1t2ICogNCArIDJdID0gdG1wMi56OwogICAgICAgIHRhbmdlbnRzW3YgKiA0ICsgM10gPSB3OwogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgKytpKSB7CiAgICAgICAgY29uc3QgZ3JvdXAgPSBncm91cHNbaV07CiAgICAgICAgY29uc3Qgc3RhcnQgPSBncm91cC5zdGFydDsKICAgICAgICBjb25zdCBjb3VudCA9IGdyb3VwLmNvdW50OwogICAgICAgIGZvciAobGV0IGogPSBzdGFydCwgamwgPSBzdGFydCArIGNvdW50OyBqIDwgamw7IGogKz0gMykgewogICAgICAgICAgaGFuZGxlVmVydGV4KGluZGljZXNbaiArIDBdKTsKICAgICAgICAgIGhhbmRsZVZlcnRleChpbmRpY2VzW2ogKyAxXSk7CiAgICAgICAgICBoYW5kbGVWZXJ0ZXgoaW5kaWNlc1tqICsgMl0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29tcHV0ZVZlcnRleE5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5pbmRleDsKICAgICAgY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSB0aGlzLmdldEF0dHJpYnV0ZSgicG9zaXRpb24iKTsKICAgICAgaWYgKHBvc2l0aW9uQXR0cmlidXRlICE9PSB2b2lkIDApIHsKICAgICAgICBsZXQgbm9ybWFsQXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoIm5vcm1hbCIpOwogICAgICAgIGlmIChub3JtYWxBdHRyaWJ1dGUgPT09IHZvaWQgMCkgewogICAgICAgICAgbm9ybWFsQXR0cmlidXRlID0gbmV3IEJ1ZmZlckF0dHJpYnV0ZShuZXcgRmxvYXQzMkFycmF5KHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICogMyksIDMpOwogICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoIm5vcm1hbCIsIG5vcm1hbEF0dHJpYnV0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IG5vcm1hbEF0dHJpYnV0ZS5jb3VudDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgICAgbm9ybWFsQXR0cmlidXRlLnNldFhZWihpLCAwLCAwLCAwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3QgcEEgPSBuZXcgVmVjdG9yMygpLCBwQiA9IG5ldyBWZWN0b3IzKCksIHBDID0gbmV3IFZlY3RvcjMoKTsKICAgICAgICBjb25zdCBuQSA9IG5ldyBWZWN0b3IzKCksIG5CID0gbmV3IFZlY3RvcjMoKSwgbkMgPSBuZXcgVmVjdG9yMygpOwogICAgICAgIGNvbnN0IGNiID0gbmV3IFZlY3RvcjMoKSwgYWIgPSBuZXcgVmVjdG9yMygpOwogICAgICAgIGlmIChpbmRleCkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gaW5kZXguY291bnQ7IGkgPCBpbDsgaSArPSAzKSB7CiAgICAgICAgICAgIGNvbnN0IHZBID0gaW5kZXguZ2V0WChpICsgMCk7CiAgICAgICAgICAgIGNvbnN0IHZCID0gaW5kZXguZ2V0WChpICsgMSk7CiAgICAgICAgICAgIGNvbnN0IHZDID0gaW5kZXguZ2V0WChpICsgMik7CiAgICAgICAgICAgIHBBLmZyb21CdWZmZXJBdHRyaWJ1dGUocG9zaXRpb25BdHRyaWJ1dGUsIHZBKTsKICAgICAgICAgICAgcEIuZnJvbUJ1ZmZlckF0dHJpYnV0ZShwb3NpdGlvbkF0dHJpYnV0ZSwgdkIpOwogICAgICAgICAgICBwQy5mcm9tQnVmZmVyQXR0cmlidXRlKHBvc2l0aW9uQXR0cmlidXRlLCB2Qyk7CiAgICAgICAgICAgIGNiLnN1YlZlY3RvcnMocEMsIHBCKTsKICAgICAgICAgICAgYWIuc3ViVmVjdG9ycyhwQSwgcEIpOwogICAgICAgICAgICBjYi5jcm9zcyhhYik7CiAgICAgICAgICAgIG5BLmZyb21CdWZmZXJBdHRyaWJ1dGUobm9ybWFsQXR0cmlidXRlLCB2QSk7CiAgICAgICAgICAgIG5CLmZyb21CdWZmZXJBdHRyaWJ1dGUobm9ybWFsQXR0cmlidXRlLCB2Qik7CiAgICAgICAgICAgIG5DLmZyb21CdWZmZXJBdHRyaWJ1dGUobm9ybWFsQXR0cmlidXRlLCB2Qyk7CiAgICAgICAgICAgIG5BLmFkZChjYik7CiAgICAgICAgICAgIG5CLmFkZChjYik7CiAgICAgICAgICAgIG5DLmFkZChjYik7CiAgICAgICAgICAgIG5vcm1hbEF0dHJpYnV0ZS5zZXRYWVoodkEsIG5BLngsIG5BLnksIG5BLnopOwogICAgICAgICAgICBub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKHZCLCBuQi54LCBuQi55LCBuQi56KTsKICAgICAgICAgICAgbm9ybWFsQXR0cmlidXRlLnNldFhZWih2QywgbkMueCwgbkMueSwgbkMueik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKz0gMykgewogICAgICAgICAgICBwQS5mcm9tQnVmZmVyQXR0cmlidXRlKHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMCk7CiAgICAgICAgICAgIHBCLmZyb21CdWZmZXJBdHRyaWJ1dGUocG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAxKTsKICAgICAgICAgICAgcEMuZnJvbUJ1ZmZlckF0dHJpYnV0ZShwb3NpdGlvbkF0dHJpYnV0ZSwgaSArIDIpOwogICAgICAgICAgICBjYi5zdWJWZWN0b3JzKHBDLCBwQik7CiAgICAgICAgICAgIGFiLnN1YlZlY3RvcnMocEEsIHBCKTsKICAgICAgICAgICAgY2IuY3Jvc3MoYWIpOwogICAgICAgICAgICBub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKGkgKyAwLCBjYi54LCBjYi55LCBjYi56KTsKICAgICAgICAgICAgbm9ybWFsQXR0cmlidXRlLnNldFhZWihpICsgMSwgY2IueCwgY2IueSwgY2Iueik7CiAgICAgICAgICAgIG5vcm1hbEF0dHJpYnV0ZS5zZXRYWVooaSArIDIsIGNiLngsIGNiLnksIGNiLnopOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLm5vcm1hbGl6ZU5vcm1hbHMoKTsKICAgICAgICBub3JtYWxBdHRyaWJ1dGUubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB9CiAgICB9CiAgICBtZXJnZShnZW9tZXRyeSwgb2Zmc2V0KSB7CiAgICAgIGlmICghKGdlb21ldHJ5ICYmIGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkpKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuQnVmZmVyR2VvbWV0cnkubWVyZ2UoKTogZ2VvbWV0cnkgbm90IGFuIGluc3RhbmNlIG9mIFRIUkVFLkJ1ZmZlckdlb21ldHJ5LiIsIGdlb21ldHJ5KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKG9mZnNldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgb2Zmc2V0ID0gMDsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJ1ZmZlckdlb21ldHJ5Lm1lcmdlKCk6IE92ZXJ3cml0aW5nIG9yaWdpbmFsIGdlb21ldHJ5LCBzdGFydGluZyBhdCBvZmZzZXQ9MC4gVXNlIEJ1ZmZlckdlb21ldHJ5VXRpbHMubWVyZ2VCdWZmZXJHZW9tZXRyaWVzKCkgZm9yIGxvc3NsZXNzIG1lcmdlLiIpOwogICAgICB9CiAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CiAgICAgIGZvciAoY29uc3Qga2V5IGluIGF0dHJpYnV0ZXMpIHsKICAgICAgICBpZiAoZ2VvbWV0cnkuYXR0cmlidXRlc1trZXldID09PSB2b2lkIDApCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICBjb25zdCBhdHRyaWJ1dGUxID0gYXR0cmlidXRlc1trZXldOwogICAgICAgIGNvbnN0IGF0dHJpYnV0ZUFycmF5MSA9IGF0dHJpYnV0ZTEuYXJyYXk7CiAgICAgICAgY29uc3QgYXR0cmlidXRlMiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXNba2V5XTsKICAgICAgICBjb25zdCBhdHRyaWJ1dGVBcnJheTIgPSBhdHRyaWJ1dGUyLmFycmF5OwogICAgICAgIGNvbnN0IGF0dHJpYnV0ZU9mZnNldCA9IGF0dHJpYnV0ZTIuaXRlbVNpemUgKiBvZmZzZXQ7CiAgICAgICAgY29uc3QgbGVuZ3RoMiA9IE1hdGgubWluKGF0dHJpYnV0ZUFycmF5Mi5sZW5ndGgsIGF0dHJpYnV0ZUFycmF5MS5sZW5ndGggLSBhdHRyaWJ1dGVPZmZzZXQpOwogICAgICAgIGZvciAobGV0IGkgPSAwLCBqID0gYXR0cmlidXRlT2Zmc2V0OyBpIDwgbGVuZ3RoMjsgaSsrLCBqKyspIHsKICAgICAgICAgIGF0dHJpYnV0ZUFycmF5MVtqXSA9IGF0dHJpYnV0ZUFycmF5MltpXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBub3JtYWxpemVOb3JtYWxzKCkgewogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5hdHRyaWJ1dGVzLm5vcm1hbDsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gbm9ybWFscy5jb3VudDsgaSA8IGlsOyBpKyspIHsKICAgICAgICBfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZShub3JtYWxzLCBpKTsKICAgICAgICBfdmVjdG9yJDgubm9ybWFsaXplKCk7CiAgICAgICAgbm9ybWFscy5zZXRYWVooaSwgX3ZlY3RvciQ4LngsIF92ZWN0b3IkOC55LCBfdmVjdG9yJDgueik7CiAgICAgIH0KICAgIH0KICAgIHRvTm9uSW5kZXhlZCgpIHsKICAgICAgZnVuY3Rpb24gY29udmVydEJ1ZmZlckF0dHJpYnV0ZShhdHRyaWJ1dGUsIGluZGljZXMyKSB7CiAgICAgICAgY29uc3QgYXJyYXkgPSBhdHRyaWJ1dGUuYXJyYXk7CiAgICAgICAgY29uc3QgaXRlbVNpemUgPSBhdHRyaWJ1dGUuaXRlbVNpemU7CiAgICAgICAgY29uc3Qgbm9ybWFsaXplZCA9IGF0dHJpYnV0ZS5ub3JtYWxpemVkOwogICAgICAgIGNvbnN0IGFycmF5MiA9IG5ldyBhcnJheS5jb25zdHJ1Y3RvcihpbmRpY2VzMi5sZW5ndGggKiBpdGVtU2l6ZSk7CiAgICAgICAgbGV0IGluZGV4ID0gMCwgaW5kZXgyID0gMDsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGluZGljZXMyLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgaWYgKGF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKSB7CiAgICAgICAgICAgIGluZGV4ID0gaW5kaWNlczJbaV0gKiBhdHRyaWJ1dGUuZGF0YS5zdHJpZGUgKyBhdHRyaWJ1dGUub2Zmc2V0OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW5kZXggPSBpbmRpY2VzMltpXSAqIGl0ZW1TaXplOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpdGVtU2l6ZTsgaisrKSB7CiAgICAgICAgICAgIGFycmF5MltpbmRleDIrK10gPSBhcnJheVtpbmRleCsrXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJBdHRyaWJ1dGUoYXJyYXkyLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuaW5kZXggPT09IG51bGwpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJ1ZmZlckdlb21ldHJ5LnRvTm9uSW5kZXhlZCgpOiBCdWZmZXJHZW9tZXRyeSBpcyBhbHJlYWR5IG5vbi1pbmRleGVkLiIpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIGNvbnN0IGdlb21ldHJ5MiA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwogICAgICBjb25zdCBpbmRpY2VzID0gdGhpcy5pbmRleC5hcnJheTsKICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKICAgICAgZm9yIChjb25zdCBuYW1lIGluIGF0dHJpYnV0ZXMpIHsKICAgICAgICBjb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzW25hbWVdOwogICAgICAgIGNvbnN0IG5ld0F0dHJpYnV0ZSA9IGNvbnZlcnRCdWZmZXJBdHRyaWJ1dGUoYXR0cmlidXRlLCBpbmRpY2VzKTsKICAgICAgICBnZW9tZXRyeTIuc2V0QXR0cmlidXRlKG5hbWUsIG5ld0F0dHJpYnV0ZSk7CiAgICAgIH0KICAgICAgY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gdGhpcy5tb3JwaEF0dHJpYnV0ZXM7CiAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBtb3JwaEF0dHJpYnV0ZXMpIHsKICAgICAgICBjb25zdCBtb3JwaEFycmF5ID0gW107CiAgICAgICAgY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbbmFtZV07CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgY29uc3QgYXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVbaV07CiAgICAgICAgICBjb25zdCBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKGF0dHJpYnV0ZSwgaW5kaWNlcyk7CiAgICAgICAgICBtb3JwaEFycmF5LnB1c2gobmV3QXR0cmlidXRlKTsKICAgICAgICB9CiAgICAgICAgZ2VvbWV0cnkyLm1vcnBoQXR0cmlidXRlc1tuYW1lXSA9IG1vcnBoQXJyYXk7CiAgICAgIH0KICAgICAgZ2VvbWV0cnkyLm1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKICAgICAgY29uc3QgZ3JvdXBzID0gdGhpcy5ncm91cHM7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IGdyb3VwID0gZ3JvdXBzW2ldOwogICAgICAgIGdlb21ldHJ5Mi5hZGRHcm91cChncm91cC5zdGFydCwgZ3JvdXAuY291bnQsIGdyb3VwLm1hdGVyaWFsSW5kZXgpOwogICAgICB9CiAgICAgIHJldHVybiBnZW9tZXRyeTI7CiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgbWV0YWRhdGE6IHsKICAgICAgICAgIHZlcnNpb246IDQuNSwKICAgICAgICAgIHR5cGU6ICJCdWZmZXJHZW9tZXRyeSIsCiAgICAgICAgICBnZW5lcmF0b3I6ICJCdWZmZXJHZW9tZXRyeS50b0pTT04iCiAgICAgICAgfQogICAgICB9OwogICAgICBkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CiAgICAgIGRhdGEudHlwZSA9IHRoaXMudHlwZTsKICAgICAgaWYgKHRoaXMubmFtZSAhPT0gIiIpCiAgICAgICAgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwogICAgICBpZiAoT2JqZWN0LmtleXModGhpcy51c2VyRGF0YSkubGVuZ3RoID4gMCkKICAgICAgICBkYXRhLnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKICAgICAgaWYgKHRoaXMucGFyYW1ldGVycyAhPT0gdm9pZCAwKSB7CiAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRoaXMucGFyYW1ldGVyczsKICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXJhbWV0ZXJzKSB7CiAgICAgICAgICBpZiAocGFyYW1ldGVyc1trZXldICE9PSB2b2lkIDApCiAgICAgICAgICAgIGRhdGFba2V5XSA9IHBhcmFtZXRlcnNba2V5XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH0KICAgICAgZGF0YS5kYXRhID0geyBhdHRyaWJ1dGVzOiB7fSB9OwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7CiAgICAgIGlmIChpbmRleCAhPT0gbnVsbCkgewogICAgICAgIGRhdGEuZGF0YS5pbmRleCA9IHsKICAgICAgICAgIHR5cGU6IGluZGV4LmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCiAgICAgICAgICBhcnJheTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoaW5kZXguYXJyYXkpCiAgICAgICAgfTsKICAgICAgfQogICAgICBjb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzOwogICAgICBmb3IgKGNvbnN0IGtleSBpbiBhdHRyaWJ1dGVzKSB7CiAgICAgICAgY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlc1trZXldOwogICAgICAgIGRhdGEuZGF0YS5hdHRyaWJ1dGVzW2tleV0gPSBhdHRyaWJ1dGUudG9KU09OKGRhdGEuZGF0YSk7CiAgICAgIH0KICAgICAgY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0ge307CiAgICAgIGxldCBoYXNNb3JwaEF0dHJpYnV0ZXMgPSBmYWxzZTsKICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5tb3JwaEF0dHJpYnV0ZXMpIHsKICAgICAgICBjb25zdCBhdHRyaWJ1dGVBcnJheSA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzW2tleV07CiAgICAgICAgY29uc3QgYXJyYXkgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBhdHRyaWJ1dGVBcnJheS5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVBcnJheVtpXTsKICAgICAgICAgIGFycmF5LnB1c2goYXR0cmlidXRlLnRvSlNPTihkYXRhLmRhdGEpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgIG1vcnBoQXR0cmlidXRlc1trZXldID0gYXJyYXk7CiAgICAgICAgICBoYXNNb3JwaEF0dHJpYnV0ZXMgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaGFzTW9ycGhBdHRyaWJ1dGVzKSB7CiAgICAgICAgZGF0YS5kYXRhLm1vcnBoQXR0cmlidXRlcyA9IG1vcnBoQXR0cmlidXRlczsKICAgICAgICBkYXRhLmRhdGEubW9ycGhUYXJnZXRzUmVsYXRpdmUgPSB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwogICAgICB9CiAgICAgIGNvbnN0IGdyb3VwcyA9IHRoaXMuZ3JvdXBzOwogICAgICBpZiAoZ3JvdXBzLmxlbmd0aCA+IDApIHsKICAgICAgICBkYXRhLmRhdGEuZ3JvdXBzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShncm91cHMpKTsKICAgICAgfQogICAgICBjb25zdCBib3VuZGluZ1NwaGVyZSA9IHRoaXMuYm91bmRpbmdTcGhlcmU7CiAgICAgIGlmIChib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCkgewogICAgICAgIGRhdGEuZGF0YS5ib3VuZGluZ1NwaGVyZSA9IHsKICAgICAgICAgIGNlbnRlcjogYm91bmRpbmdTcGhlcmUuY2VudGVyLnRvQXJyYXkoKSwKICAgICAgICAgIHJhZGl1czogYm91bmRpbmdTcGhlcmUucmFkaXVzCiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEJ1ZmZlckdlb21ldHJ5KCkuY29weSh0aGlzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHRoaXMuaW5kZXggPSBudWxsOwogICAgICB0aGlzLmF0dHJpYnV0ZXMgPSB7fTsKICAgICAgdGhpcy5tb3JwaEF0dHJpYnV0ZXMgPSB7fTsKICAgICAgdGhpcy5ncm91cHMgPSBbXTsKICAgICAgdGhpcy5ib3VuZGluZ0JveCA9IG51bGw7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmUgPSBudWxsOwogICAgICBjb25zdCBkYXRhID0ge307CiAgICAgIHRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwogICAgICBjb25zdCBpbmRleCA9IHNvdXJjZS5pbmRleDsKICAgICAgaWYgKGluZGV4ICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5zZXRJbmRleChpbmRleC5jbG9uZShkYXRhKSk7CiAgICAgIH0KICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHNvdXJjZS5hdHRyaWJ1dGVzOwogICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gYXR0cmlidXRlcykgewogICAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbbmFtZV07CiAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUobmFtZSwgYXR0cmlidXRlLmNsb25lKGRhdGEpKTsKICAgICAgfQogICAgICBjb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBzb3VyY2UubW9ycGhBdHRyaWJ1dGVzOwogICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gbW9ycGhBdHRyaWJ1dGVzKSB7CiAgICAgICAgY29uc3QgYXJyYXkgPSBbXTsKICAgICAgICBjb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1tuYW1lXTsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgYXJyYXkucHVzaChtb3JwaEF0dHJpYnV0ZVtpXS5jbG9uZShkYXRhKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubW9ycGhBdHRyaWJ1dGVzW25hbWVdID0gYXJyYXk7CiAgICAgIH0KICAgICAgdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHNvdXJjZS5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKICAgICAgY29uc3QgZ3JvdXBzID0gc291cmNlLmdyb3VwczsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBncm91cHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgZ3JvdXAgPSBncm91cHNbaV07CiAgICAgICAgdGhpcy5hZGRHcm91cChncm91cC5zdGFydCwgZ3JvdXAuY291bnQsIGdyb3VwLm1hdGVyaWFsSW5kZXgpOwogICAgICB9CiAgICAgIGNvbnN0IGJvdW5kaW5nQm94ID0gc291cmNlLmJvdW5kaW5nQm94OwogICAgICBpZiAoYm91bmRpbmdCb3ggIT09IG51bGwpIHsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94ID0gYm91bmRpbmdCb3guY2xvbmUoKTsKICAgICAgfQogICAgICBjb25zdCBib3VuZGluZ1NwaGVyZSA9IHNvdXJjZS5ib3VuZGluZ1NwaGVyZTsKICAgICAgaWYgKGJvdW5kaW5nU3BoZXJlICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZSA9IGJvdW5kaW5nU3BoZXJlLmNsb25lKCk7CiAgICAgIH0KICAgICAgdGhpcy5kcmF3UmFuZ2Uuc3RhcnQgPSBzb3VyY2UuZHJhd1JhbmdlLnN0YXJ0OwogICAgICB0aGlzLmRyYXdSYW5nZS5jb3VudCA9IHNvdXJjZS5kcmF3UmFuZ2UuY291bnQ7CiAgICAgIHRoaXMudXNlckRhdGEgPSBzb3VyY2UudXNlckRhdGE7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZGlzcG9zZSgpIHsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHsgdHlwZTogImRpc3Bvc2UiIH0pOwogICAgfQogIH07CiAgQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmlzQnVmZmVyR2VvbWV0cnkgPSB0cnVlOwogIHZhciBfaW52ZXJzZU1hdHJpeCQyID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXRyaXg0KCk7CiAgdmFyIF9yYXkkMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgUmF5KCk7CiAgdmFyIF9zcGhlcmUkMyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU3BoZXJlKCk7CiAgdmFyIF92QSQxID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF92QiQxID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF92QyQxID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF90ZW1wQSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfdGVtcEIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX3RlbXBDID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9tb3JwaEEgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX21vcnBoQiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfbW9ycGhDID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF91dkEkMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMigpOwogIHZhciBfdXZCJDEgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjIoKTsKICB2YXIgX3V2QyQxID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IyKCk7CiAgdmFyIF9pbnRlcnNlY3Rpb25Qb2ludCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBNZXNoID0gY2xhc3MgZXh0ZW5kcyBPYmplY3QzRCB7CiAgICBjb25zdHJ1Y3RvcihnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpLCBtYXRlcmlhbCA9IG5ldyBNZXNoQmFzaWNNYXRlcmlhbCgpKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJNZXNoIjsKICAgICAgdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5OwogICAgICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7CiAgICAgIHRoaXMudXBkYXRlTW9ycGhUYXJnZXRzKCk7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIGlmIChzb3VyY2UubW9ycGhUYXJnZXRJbmZsdWVuY2VzICE9PSB2b2lkIDApIHsKICAgICAgICB0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyA9IHNvdXJjZS5tb3JwaFRhcmdldEluZmx1ZW5jZXMuc2xpY2UoKTsKICAgICAgfQogICAgICBpZiAoc291cmNlLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSAhPT0gdm9pZCAwKSB7CiAgICAgICAgdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSBPYmplY3QuYXNzaWduKHt9LCBzb3VyY2UubW9ycGhUYXJnZXREaWN0aW9uYXJ5KTsKICAgICAgfQogICAgICB0aGlzLm1hdGVyaWFsID0gc291cmNlLm1hdGVyaWFsOwogICAgICB0aGlzLmdlb21ldHJ5ID0gc291cmNlLmdlb21ldHJ5OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHVwZGF0ZU1vcnBoVGFyZ2V0cygpIHsKICAgICAgY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwogICAgICBpZiAoZ2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSkgewogICAgICAgIGNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlczsKICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMobW9ycGhBdHRyaWJ1dGVzKTsKICAgICAgICBpZiAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBjb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1trZXlzWzBdXTsKICAgICAgICAgIGlmIChtb3JwaEF0dHJpYnV0ZSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gW107CiAgICAgICAgICAgIHRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5ID0ge307CiAgICAgICAgICAgIGZvciAobGV0IG0gPSAwLCBtbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgbSA8IG1sOyBtKyspIHsKICAgICAgICAgICAgICBjb25zdCBuYW1lID0gbW9ycGhBdHRyaWJ1dGVbbV0ubmFtZSB8fCBTdHJpbmcobSk7CiAgICAgICAgICAgICAgdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMucHVzaCgwKTsKICAgICAgICAgICAgICB0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeVtuYW1lXSA9IG07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgbW9ycGhUYXJnZXRzID0gZ2VvbWV0cnkubW9ycGhUYXJnZXRzOwogICAgICAgIGlmIChtb3JwaFRhcmdldHMgIT09IHZvaWQgMCAmJiBtb3JwaFRhcmdldHMubGVuZ3RoID4gMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuTWVzaC51cGRhdGVNb3JwaFRhcmdldHMoKSBubyBsb25nZXIgc3VwcG9ydHMgVEhSRUUuR2VvbWV0cnkuIFVzZSBUSFJFRS5CdWZmZXJHZW9tZXRyeSBpbnN0ZWFkLiIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmF5Y2FzdChyYXljYXN0ZXIsIGludGVyc2VjdHMyKSB7CiAgICAgIGNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKICAgICAgY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwogICAgICBjb25zdCBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CiAgICAgIGlmIChtYXRlcmlhbCA9PT0gdm9pZCAwKQogICAgICAgIHJldHVybjsKICAgICAgaWYgKGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsKQogICAgICAgIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwogICAgICBfc3BoZXJlJDMuY29weShnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSk7CiAgICAgIF9zcGhlcmUkMy5hcHBseU1hdHJpeDQobWF0cml4V29ybGQpOwogICAgICBpZiAocmF5Y2FzdGVyLnJheS5pbnRlcnNlY3RzU3BoZXJlKF9zcGhlcmUkMykgPT09IGZhbHNlKQogICAgICAgIHJldHVybjsKICAgICAgX2ludmVyc2VNYXRyaXgkMi5jb3B5KG1hdHJpeFdvcmxkKS5pbnZlcnQoKTsKICAgICAgX3JheSQyLmNvcHkocmF5Y2FzdGVyLnJheSkuYXBwbHlNYXRyaXg0KF9pbnZlcnNlTWF0cml4JDIpOwogICAgICBpZiAoZ2VvbWV0cnkuYm91bmRpbmdCb3ggIT09IG51bGwpIHsKICAgICAgICBpZiAoX3JheSQyLmludGVyc2VjdHNCb3goZ2VvbWV0cnkuYm91bmRpbmdCb3gpID09PSBmYWxzZSkKICAgICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgaW50ZXJzZWN0aW9uMjsKICAgICAgaWYgKGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkpIHsKICAgICAgICBjb25zdCBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwogICAgICAgIGNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKICAgICAgICBjb25zdCBtb3JwaFBvc2l0aW9uID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uOwogICAgICAgIGNvbnN0IG1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gZ2VvbWV0cnkubW9ycGhUYXJnZXRzUmVsYXRpdmU7CiAgICAgICAgY29uc3QgdXYgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2OwogICAgICAgIGNvbnN0IHV2MiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudXYyOwogICAgICAgIGNvbnN0IGdyb3VwcyA9IGdlb21ldHJ5Lmdyb3VwczsKICAgICAgICBjb25zdCBkcmF3UmFuZ2UgPSBnZW9tZXRyeS5kcmF3UmFuZ2U7CiAgICAgICAgaWYgKGluZGV4ICE9PSBudWxsKSB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShtYXRlcmlhbCkpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBncm91cCA9IGdyb3Vwc1tpXTsKICAgICAgICAgICAgICBjb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbZ3JvdXAubWF0ZXJpYWxJbmRleF07CiAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heChncm91cC5zdGFydCwgZHJhd1JhbmdlLnN0YXJ0KTsKICAgICAgICAgICAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihncm91cC5zdGFydCArIGdyb3VwLmNvdW50LCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQpOwogICAgICAgICAgICAgIGZvciAobGV0IGogPSBzdGFydCwgamwgPSBlbmQ7IGogPCBqbDsgaiArPSAzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhID0gaW5kZXguZ2V0WChqKTsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBpbmRleC5nZXRYKGogKyAxKTsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBpbmRleC5nZXRYKGogKyAyKTsKICAgICAgICAgICAgICAgIGludGVyc2VjdGlvbjIgPSBjaGVja0J1ZmZlckdlb21ldHJ5SW50ZXJzZWN0aW9uKHRoaXMsIGdyb3VwTWF0ZXJpYWwsIHJheWNhc3RlciwgX3JheSQyLCBwb3NpdGlvbiwgbW9ycGhQb3NpdGlvbiwgbW9ycGhUYXJnZXRzUmVsYXRpdmUsIHV2LCB1djIsIGEsIGIsIGMpOwogICAgICAgICAgICAgICAgaWYgKGludGVyc2VjdGlvbjIpIHsKICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uMi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKGogLyAzKTsKICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uMi5mYWNlLm1hdGVyaWFsSW5kZXggPSBncm91cC5tYXRlcmlhbEluZGV4OwogICAgICAgICAgICAgICAgICBpbnRlcnNlY3RzMi5wdXNoKGludGVyc2VjdGlvbjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heCgwLCBkcmF3UmFuZ2Uuc3RhcnQpOwogICAgICAgICAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihpbmRleC5jb3VudCwgZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50KTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0LCBpbCA9IGVuZDsgaSA8IGlsOyBpICs9IDMpIHsKICAgICAgICAgICAgICBjb25zdCBhID0gaW5kZXguZ2V0WChpKTsKICAgICAgICAgICAgICBjb25zdCBiID0gaW5kZXguZ2V0WChpICsgMSk7CiAgICAgICAgICAgICAgY29uc3QgYyA9IGluZGV4LmdldFgoaSArIDIpOwogICAgICAgICAgICAgIGludGVyc2VjdGlvbjIgPSBjaGVja0J1ZmZlckdlb21ldHJ5SW50ZXJzZWN0aW9uKHRoaXMsIG1hdGVyaWFsLCByYXljYXN0ZXIsIF9yYXkkMiwgcG9zaXRpb24sIG1vcnBoUG9zaXRpb24sIG1vcnBoVGFyZ2V0c1JlbGF0aXZlLCB1diwgdXYyLCBhLCBiLCBjKTsKICAgICAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9uMikgewogICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uMi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKGkgLyAzKTsKICAgICAgICAgICAgICAgIGludGVyc2VjdHMyLnB1c2goaW50ZXJzZWN0aW9uMik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChwb3NpdGlvbiAhPT0gdm9pZCAwKSB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShtYXRlcmlhbCkpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBncm91cCA9IGdyb3Vwc1tpXTsKICAgICAgICAgICAgICBjb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbZ3JvdXAubWF0ZXJpYWxJbmRleF07CiAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heChncm91cC5zdGFydCwgZHJhd1JhbmdlLnN0YXJ0KTsKICAgICAgICAgICAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihncm91cC5zdGFydCArIGdyb3VwLmNvdW50LCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQpOwogICAgICAgICAgICAgIGZvciAobGV0IGogPSBzdGFydCwgamwgPSBlbmQ7IGogPCBqbDsgaiArPSAzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhID0gajsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBqICsgMTsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBqICsgMjsKICAgICAgICAgICAgICAgIGludGVyc2VjdGlvbjIgPSBjaGVja0J1ZmZlckdlb21ldHJ5SW50ZXJzZWN0aW9uKHRoaXMsIGdyb3VwTWF0ZXJpYWwsIHJheWNhc3RlciwgX3JheSQyLCBwb3NpdGlvbiwgbW9ycGhQb3NpdGlvbiwgbW9ycGhUYXJnZXRzUmVsYXRpdmUsIHV2LCB1djIsIGEsIGIsIGMpOwogICAgICAgICAgICAgICAgaWYgKGludGVyc2VjdGlvbjIpIHsKICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uMi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKGogLyAzKTsKICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uMi5mYWNlLm1hdGVyaWFsSW5kZXggPSBncm91cC5tYXRlcmlhbEluZGV4OwogICAgICAgICAgICAgICAgICBpbnRlcnNlY3RzMi5wdXNoKGludGVyc2VjdGlvbjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heCgwLCBkcmF3UmFuZ2Uuc3RhcnQpOwogICAgICAgICAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihwb3NpdGlvbi5jb3VudCwgZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50KTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0LCBpbCA9IGVuZDsgaSA8IGlsOyBpICs9IDMpIHsKICAgICAgICAgICAgICBjb25zdCBhID0gaTsKICAgICAgICAgICAgICBjb25zdCBiID0gaSArIDE7CiAgICAgICAgICAgICAgY29uc3QgYyA9IGkgKyAyOwogICAgICAgICAgICAgIGludGVyc2VjdGlvbjIgPSBjaGVja0J1ZmZlckdlb21ldHJ5SW50ZXJzZWN0aW9uKHRoaXMsIG1hdGVyaWFsLCByYXljYXN0ZXIsIF9yYXkkMiwgcG9zaXRpb24sIG1vcnBoUG9zaXRpb24sIG1vcnBoVGFyZ2V0c1JlbGF0aXZlLCB1diwgdXYyLCBhLCBiLCBjKTsKICAgICAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9uMikgewogICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9uMi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKGkgLyAzKTsKICAgICAgICAgICAgICAgIGludGVyc2VjdHMyLnB1c2goaW50ZXJzZWN0aW9uMik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGdlb21ldHJ5LmlzR2VvbWV0cnkpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5NZXNoLnJheWNhc3QoKSBubyBsb25nZXIgc3VwcG9ydHMgVEhSRUUuR2VvbWV0cnkuIFVzZSBUSFJFRS5CdWZmZXJHZW9tZXRyeSBpbnN0ZWFkLiIpOwogICAgICB9CiAgICB9CiAgfTsKICBNZXNoLnByb3RvdHlwZS5pc01lc2ggPSB0cnVlOwogIGZ1bmN0aW9uIGNoZWNrSW50ZXJzZWN0aW9uKG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBwQSwgcEIsIHBDLCBwb2ludCkgewogICAgbGV0IGludGVyc2VjdDsKICAgIGlmIChtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSkgewogICAgICBpbnRlcnNlY3QgPSByYXkuaW50ZXJzZWN0VHJpYW5nbGUocEMsIHBCLCBwQSwgdHJ1ZSwgcG9pbnQpOwogICAgfSBlbHNlIHsKICAgICAgaW50ZXJzZWN0ID0gcmF5LmludGVyc2VjdFRyaWFuZ2xlKHBBLCBwQiwgcEMsIG1hdGVyaWFsLnNpZGUgIT09IERvdWJsZVNpZGUsIHBvaW50KTsKICAgIH0KICAgIGlmIChpbnRlcnNlY3QgPT09IG51bGwpCiAgICAgIHJldHVybiBudWxsOwogICAgX2ludGVyc2VjdGlvblBvaW50V29ybGQuY29weShwb2ludCk7CiAgICBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZC5hcHBseU1hdHJpeDQob2JqZWN0Lm1hdHJpeFdvcmxkKTsKICAgIGNvbnN0IGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyhfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCk7CiAgICBpZiAoZGlzdGFuY2UgPCByYXljYXN0ZXIubmVhciB8fCBkaXN0YW5jZSA+IHJheWNhc3Rlci5mYXIpCiAgICAgIHJldHVybiBudWxsOwogICAgcmV0dXJuIHsKICAgICAgZGlzdGFuY2UsCiAgICAgIHBvaW50OiBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZC5jbG9uZSgpLAogICAgICBvYmplY3QKICAgIH07CiAgfQogIGZ1bmN0aW9uIGNoZWNrQnVmZmVyR2VvbWV0cnlJbnRlcnNlY3Rpb24ob2JqZWN0LCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHBvc2l0aW9uLCBtb3JwaFBvc2l0aW9uLCBtb3JwaFRhcmdldHNSZWxhdGl2ZSwgdXYsIHV2MiwgYSwgYiwgYykgewogICAgX3ZBJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZShwb3NpdGlvbiwgYSk7CiAgICBfdkIkMS5mcm9tQnVmZmVyQXR0cmlidXRlKHBvc2l0aW9uLCBiKTsKICAgIF92QyQxLmZyb21CdWZmZXJBdHRyaWJ1dGUocG9zaXRpb24sIGMpOwogICAgY29uc3QgbW9ycGhJbmZsdWVuY2VzID0gb2JqZWN0Lm1vcnBoVGFyZ2V0SW5mbHVlbmNlczsKICAgIGlmIChtYXRlcmlhbC5tb3JwaFRhcmdldHMgJiYgbW9ycGhQb3NpdGlvbiAmJiBtb3JwaEluZmx1ZW5jZXMpIHsKICAgICAgX21vcnBoQS5zZXQoMCwgMCwgMCk7CiAgICAgIF9tb3JwaEIuc2V0KDAsIDAsIDApOwogICAgICBfbW9ycGhDLnNldCgwLCAwLCAwKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gbW9ycGhQb3NpdGlvbi5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgY29uc3QgaW5mbHVlbmNlID0gbW9ycGhJbmZsdWVuY2VzW2ldOwogICAgICAgIGNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhQb3NpdGlvbltpXTsKICAgICAgICBpZiAoaW5mbHVlbmNlID09PSAwKQogICAgICAgICAgY29udGludWU7CiAgICAgICAgX3RlbXBBLmZyb21CdWZmZXJBdHRyaWJ1dGUobW9ycGhBdHRyaWJ1dGUsIGEpOwogICAgICAgIF90ZW1wQi5mcm9tQnVmZmVyQXR0cmlidXRlKG1vcnBoQXR0cmlidXRlLCBiKTsKICAgICAgICBfdGVtcEMuZnJvbUJ1ZmZlckF0dHJpYnV0ZShtb3JwaEF0dHJpYnV0ZSwgYyk7CiAgICAgICAgaWYgKG1vcnBoVGFyZ2V0c1JlbGF0aXZlKSB7CiAgICAgICAgICBfbW9ycGhBLmFkZFNjYWxlZFZlY3RvcihfdGVtcEEsIGluZmx1ZW5jZSk7CiAgICAgICAgICBfbW9ycGhCLmFkZFNjYWxlZFZlY3RvcihfdGVtcEIsIGluZmx1ZW5jZSk7CiAgICAgICAgICBfbW9ycGhDLmFkZFNjYWxlZFZlY3RvcihfdGVtcEMsIGluZmx1ZW5jZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF9tb3JwaEEuYWRkU2NhbGVkVmVjdG9yKF90ZW1wQS5zdWIoX3ZBJDEpLCBpbmZsdWVuY2UpOwogICAgICAgICAgX21vcnBoQi5hZGRTY2FsZWRWZWN0b3IoX3RlbXBCLnN1YihfdkIkMSksIGluZmx1ZW5jZSk7CiAgICAgICAgICBfbW9ycGhDLmFkZFNjYWxlZFZlY3RvcihfdGVtcEMuc3ViKF92QyQxKSwgaW5mbHVlbmNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgX3ZBJDEuYWRkKF9tb3JwaEEpOwogICAgICBfdkIkMS5hZGQoX21vcnBoQik7CiAgICAgIF92QyQxLmFkZChfbW9ycGhDKTsKICAgIH0KICAgIGlmIChvYmplY3QuaXNTa2lubmVkTWVzaCkgewogICAgICBvYmplY3QuYm9uZVRyYW5zZm9ybShhLCBfdkEkMSk7CiAgICAgIG9iamVjdC5ib25lVHJhbnNmb3JtKGIsIF92QiQxKTsKICAgICAgb2JqZWN0LmJvbmVUcmFuc2Zvcm0oYywgX3ZDJDEpOwogICAgfQogICAgY29uc3QgaW50ZXJzZWN0aW9uMiA9IGNoZWNrSW50ZXJzZWN0aW9uKG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBfaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgaWYgKGludGVyc2VjdGlvbjIpIHsKICAgICAgaWYgKHV2KSB7CiAgICAgICAgX3V2QSQxLmZyb21CdWZmZXJBdHRyaWJ1dGUodXYsIGEpOwogICAgICAgIF91dkIkMS5mcm9tQnVmZmVyQXR0cmlidXRlKHV2LCBiKTsKICAgICAgICBfdXZDJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh1diwgYyk7CiAgICAgICAgaW50ZXJzZWN0aW9uMi51diA9IFRyaWFuZ2xlLmdldFVWKF9pbnRlcnNlY3Rpb25Qb2ludCwgX3ZBJDEsIF92QiQxLCBfdkMkMSwgX3V2QSQxLCBfdXZCJDEsIF91dkMkMSwgbmV3IFZlY3RvcjIoKSk7CiAgICAgIH0KICAgICAgaWYgKHV2MikgewogICAgICAgIF91dkEkMS5mcm9tQnVmZmVyQXR0cmlidXRlKHV2MiwgYSk7CiAgICAgICAgX3V2QiQxLmZyb21CdWZmZXJBdHRyaWJ1dGUodXYyLCBiKTsKICAgICAgICBfdXZDJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh1djIsIGMpOwogICAgICAgIGludGVyc2VjdGlvbjIudXYyID0gVHJpYW5nbGUuZ2V0VVYoX2ludGVyc2VjdGlvblBvaW50LCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBfdXZBJDEsIF91dkIkMSwgX3V2QyQxLCBuZXcgVmVjdG9yMigpKTsKICAgICAgfQogICAgICBjb25zdCBmYWNlID0gewogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgICBjLAogICAgICAgIG5vcm1hbDogbmV3IFZlY3RvcjMoKSwKICAgICAgICBtYXRlcmlhbEluZGV4OiAwCiAgICAgIH07CiAgICAgIFRyaWFuZ2xlLmdldE5vcm1hbChfdkEkMSwgX3ZCJDEsIF92QyQxLCBmYWNlLm5vcm1hbCk7CiAgICAgIGludGVyc2VjdGlvbjIuZmFjZSA9IGZhY2U7CiAgICB9CiAgICByZXR1cm4gaW50ZXJzZWN0aW9uMjsKICB9CiAgdmFyIEJveEdlb21ldHJ5ID0gY2xhc3MgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CiAgICBjb25zdHJ1Y3Rvcih3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSwgd2lkdGhTZWdtZW50cyA9IDEsIGhlaWdodFNlZ21lbnRzID0gMSwgZGVwdGhTZWdtZW50cyA9IDEpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIkJveEdlb21ldHJ5IjsKICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gewogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodCwKICAgICAgICBkZXB0aCwKICAgICAgICB3aWR0aFNlZ21lbnRzLAogICAgICAgIGhlaWdodFNlZ21lbnRzLAogICAgICAgIGRlcHRoU2VnbWVudHMKICAgICAgfTsKICAgICAgY29uc3Qgc2NvcGUgPSB0aGlzOwogICAgICB3aWR0aFNlZ21lbnRzID0gTWF0aC5mbG9vcih3aWR0aFNlZ21lbnRzKTsKICAgICAgaGVpZ2h0U2VnbWVudHMgPSBNYXRoLmZsb29yKGhlaWdodFNlZ21lbnRzKTsKICAgICAgZGVwdGhTZWdtZW50cyA9IE1hdGguZmxvb3IoZGVwdGhTZWdtZW50cyk7CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKICAgICAgY29uc3QgdmVydGljZXMgPSBbXTsKICAgICAgY29uc3Qgbm9ybWFscyA9IFtdOwogICAgICBjb25zdCB1dnMgPSBbXTsKICAgICAgbGV0IG51bWJlck9mVmVydGljZXMgPSAwOwogICAgICBsZXQgZ3JvdXBTdGFydCA9IDA7CiAgICAgIGJ1aWxkUGxhbmUoInoiLCAieSIsICJ4IiwgLTEsIC0xLCBkZXB0aCwgaGVpZ2h0LCB3aWR0aCwgZGVwdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDApOwogICAgICBidWlsZFBsYW5lKCJ6IiwgInkiLCAieCIsIDEsIC0xLCBkZXB0aCwgaGVpZ2h0LCAtd2lkdGgsIGRlcHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCAxKTsKICAgICAgYnVpbGRQbGFuZSgieCIsICJ6IiwgInkiLCAxLCAxLCB3aWR0aCwgZGVwdGgsIGhlaWdodCwgd2lkdGhTZWdtZW50cywgZGVwdGhTZWdtZW50cywgMik7CiAgICAgIGJ1aWxkUGxhbmUoIngiLCAieiIsICJ5IiwgMSwgLTEsIHdpZHRoLCBkZXB0aCwgLWhlaWdodCwgd2lkdGhTZWdtZW50cywgZGVwdGhTZWdtZW50cywgMyk7CiAgICAgIGJ1aWxkUGxhbmUoIngiLCAieSIsICJ6IiwgMSwgLTEsIHdpZHRoLCBoZWlnaHQsIGRlcHRoLCB3aWR0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgNCk7CiAgICAgIGJ1aWxkUGxhbmUoIngiLCAieSIsICJ6IiwgLTEsIC0xLCB3aWR0aCwgaGVpZ2h0LCAtZGVwdGgsIHdpZHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCA1KTsKICAgICAgdGhpcy5zZXRJbmRleChpbmRpY2VzKTsKICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoInBvc2l0aW9uIiwgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUodmVydGljZXMsIDMpKTsKICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoIm5vcm1hbCIsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKG5vcm1hbHMsIDMpKTsKICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoInV2IiwgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUodXZzLCAyKSk7CiAgICAgIGZ1bmN0aW9uIGJ1aWxkUGxhbmUodSwgdiwgdywgdWRpciwgdmRpciwgd2lkdGgyLCBoZWlnaHQyLCBkZXB0aDIsIGdyaWRYLCBncmlkWSwgbWF0ZXJpYWxJbmRleCkgewogICAgICAgIGNvbnN0IHNlZ21lbnRXaWR0aCA9IHdpZHRoMiAvIGdyaWRYOwogICAgICAgIGNvbnN0IHNlZ21lbnRIZWlnaHQgPSBoZWlnaHQyIC8gZ3JpZFk7CiAgICAgICAgY29uc3Qgd2lkdGhIYWxmID0gd2lkdGgyIC8gMjsKICAgICAgICBjb25zdCBoZWlnaHRIYWxmID0gaGVpZ2h0MiAvIDI7CiAgICAgICAgY29uc3QgZGVwdGhIYWxmID0gZGVwdGgyIC8gMjsKICAgICAgICBjb25zdCBncmlkWDEgPSBncmlkWCArIDE7CiAgICAgICAgY29uc3QgZ3JpZFkxID0gZ3JpZFkgKyAxOwogICAgICAgIGxldCB2ZXJ0ZXhDb3VudGVyID0gMDsKICAgICAgICBsZXQgZ3JvdXBDb3VudCA9IDA7CiAgICAgICAgY29uc3QgdmVjdG9yID0gbmV3IFZlY3RvcjMoKTsKICAgICAgICBmb3IgKGxldCBpeSA9IDA7IGl5IDwgZ3JpZFkxOyBpeSsrKSB7CiAgICAgICAgICBjb25zdCB5ID0gaXkgKiBzZWdtZW50SGVpZ2h0IC0gaGVpZ2h0SGFsZjsKICAgICAgICAgIGZvciAobGV0IGl4ID0gMDsgaXggPCBncmlkWDE7IGl4KyspIHsKICAgICAgICAgICAgY29uc3QgeCA9IGl4ICogc2VnbWVudFdpZHRoIC0gd2lkdGhIYWxmOwogICAgICAgICAgICB2ZWN0b3JbdV0gPSB4ICogdWRpcjsKICAgICAgICAgICAgdmVjdG9yW3ZdID0geSAqIHZkaXI7CiAgICAgICAgICAgIHZlY3Rvclt3XSA9IGRlcHRoSGFsZjsKICAgICAgICAgICAgdmVydGljZXMucHVzaCh2ZWN0b3IueCwgdmVjdG9yLnksIHZlY3Rvci56KTsKICAgICAgICAgICAgdmVjdG9yW3VdID0gMDsKICAgICAgICAgICAgdmVjdG9yW3ZdID0gMDsKICAgICAgICAgICAgdmVjdG9yW3ddID0gZGVwdGgyID4gMCA/IDEgOiAtMTsKICAgICAgICAgICAgbm9ybWFscy5wdXNoKHZlY3Rvci54LCB2ZWN0b3IueSwgdmVjdG9yLnopOwogICAgICAgICAgICB1dnMucHVzaChpeCAvIGdyaWRYKTsKICAgICAgICAgICAgdXZzLnB1c2goMSAtIGl5IC8gZ3JpZFkpOwogICAgICAgICAgICB2ZXJ0ZXhDb3VudGVyICs9IDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGl5ID0gMDsgaXkgPCBncmlkWTsgaXkrKykgewogICAgICAgICAgZm9yIChsZXQgaXggPSAwOyBpeCA8IGdyaWRYOyBpeCsrKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBudW1iZXJPZlZlcnRpY2VzICsgaXggKyBncmlkWDEgKiBpeTsKICAgICAgICAgICAgY29uc3QgYiA9IG51bWJlck9mVmVydGljZXMgKyBpeCArIGdyaWRYMSAqIChpeSArIDEpOwogICAgICAgICAgICBjb25zdCBjID0gbnVtYmVyT2ZWZXJ0aWNlcyArIChpeCArIDEpICsgZ3JpZFgxICogKGl5ICsgMSk7CiAgICAgICAgICAgIGNvbnN0IGQgPSBudW1iZXJPZlZlcnRpY2VzICsgKGl4ICsgMSkgKyBncmlkWDEgKiBpeTsKICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgICBpbmRpY2VzLnB1c2goYiwgYywgZCk7CiAgICAgICAgICAgIGdyb3VwQ291bnQgKz0gNjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc2NvcGUuYWRkR3JvdXAoZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgbWF0ZXJpYWxJbmRleCk7CiAgICAgICAgZ3JvdXBTdGFydCArPSBncm91cENvdW50OwogICAgICAgIG51bWJlck9mVmVydGljZXMgKz0gdmVydGV4Q291bnRlcjsKICAgICAgfQogICAgfQogICAgc3RhdGljIGZyb21KU09OKGRhdGEpIHsKICAgICAgcmV0dXJuIG5ldyBCb3hHZW9tZXRyeShkYXRhLndpZHRoLCBkYXRhLmhlaWdodCwgZGF0YS5kZXB0aCwgZGF0YS53aWR0aFNlZ21lbnRzLCBkYXRhLmhlaWdodFNlZ21lbnRzLCBkYXRhLmRlcHRoU2VnbWVudHMpOwogICAgfQogIH07CiAgZnVuY3Rpb24gY2xvbmVVbmlmb3JtcyhzcmMpIHsKICAgIGNvbnN0IGRzdCA9IHt9OwogICAgZm9yIChjb25zdCB1IGluIHNyYykgewogICAgICBkc3RbdV0gPSB7fTsKICAgICAgZm9yIChjb25zdCBwIGluIHNyY1t1XSkgewogICAgICAgIGNvbnN0IHByb3BlcnR5ID0gc3JjW3VdW3BdOwogICAgICAgIGlmIChwcm9wZXJ0eSAmJiAocHJvcGVydHkuaXNDb2xvciB8fCBwcm9wZXJ0eS5pc01hdHJpeDMgfHwgcHJvcGVydHkuaXNNYXRyaXg0IHx8IHByb3BlcnR5LmlzVmVjdG9yMiB8fCBwcm9wZXJ0eS5pc1ZlY3RvcjMgfHwgcHJvcGVydHkuaXNWZWN0b3I0IHx8IHByb3BlcnR5LmlzVGV4dHVyZSB8fCBwcm9wZXJ0eS5pc1F1YXRlcm5pb24pKSB7CiAgICAgICAgICBkc3RbdV1bcF0gPSBwcm9wZXJ0eS5jbG9uZSgpOwogICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShwcm9wZXJ0eSkpIHsKICAgICAgICAgIGRzdFt1XVtwXSA9IHByb3BlcnR5LnNsaWNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRzdFt1XVtwXSA9IHByb3BlcnR5OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGRzdDsKICB9CiAgZnVuY3Rpb24gbWVyZ2VVbmlmb3Jtcyh1bmlmb3JtcykgewogICAgY29uc3QgbWVyZ2VkID0ge307CiAgICBmb3IgKGxldCB1ID0gMDsgdSA8IHVuaWZvcm1zLmxlbmd0aDsgdSsrKSB7CiAgICAgIGNvbnN0IHRtcDIgPSBjbG9uZVVuaWZvcm1zKHVuaWZvcm1zW3VdKTsKICAgICAgZm9yIChjb25zdCBwIGluIHRtcDIpIHsKICAgICAgICBtZXJnZWRbcF0gPSB0bXAyW3BdOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWVyZ2VkOwogIH0KICB2YXIgVW5pZm9ybXNVdGlscyA9IHsgY2xvbmU6IGNsb25lVW5pZm9ybXMsIG1lcmdlOiBtZXJnZVVuaWZvcm1zIH07CiAgdmFyIGRlZmF1bHRfdmVydGV4ID0gInZvaWQgbWFpbigpIHtcbglnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7XG59IjsKICB2YXIgZGVmYXVsdF9mcmFnbWVudCA9ICJ2b2lkIG1haW4oKSB7XG4JZ2xfRnJhZ0NvbG9yID0gdmVjNCggMS4wLCAwLjAsIDAuMCwgMS4wICk7XG59IjsKICB2YXIgU2hhZGVyTWF0ZXJpYWwgPSBjbGFzcyBleHRlbmRzIE1hdGVyaWFsIHsKICAgIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIlNoYWRlck1hdGVyaWFsIjsKICAgICAgdGhpcy5kZWZpbmVzID0ge307CiAgICAgIHRoaXMudW5pZm9ybXMgPSB7fTsKICAgICAgdGhpcy52ZXJ0ZXhTaGFkZXIgPSBkZWZhdWx0X3ZlcnRleDsKICAgICAgdGhpcy5mcmFnbWVudFNoYWRlciA9IGRlZmF1bHRfZnJhZ21lbnQ7CiAgICAgIHRoaXMubGluZXdpZHRoID0gMTsKICAgICAgdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwogICAgICB0aGlzLmZvZyA9IGZhbHNlOwogICAgICB0aGlzLmxpZ2h0cyA9IGZhbHNlOwogICAgICB0aGlzLmNsaXBwaW5nID0gZmFsc2U7CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gZmFsc2U7CiAgICAgIHRoaXMubW9ycGhOb3JtYWxzID0gZmFsc2U7CiAgICAgIHRoaXMuZXh0ZW5zaW9ucyA9IHsKICAgICAgICBkZXJpdmF0aXZlczogZmFsc2UsCiAgICAgICAgZnJhZ0RlcHRoOiBmYWxzZSwKICAgICAgICBkcmF3QnVmZmVyczogZmFsc2UsCiAgICAgICAgc2hhZGVyVGV4dHVyZUxPRDogZmFsc2UKICAgICAgfTsKICAgICAgdGhpcy5kZWZhdWx0QXR0cmlidXRlVmFsdWVzID0gewogICAgICAgICJjb2xvciI6IFsxLCAxLCAxXSwKICAgICAgICAidXYiOiBbMCwgMF0sCiAgICAgICAgInV2MiI6IFswLCAwXQogICAgICB9OwogICAgICB0aGlzLmluZGV4MEF0dHJpYnV0ZU5hbWUgPSB2b2lkIDA7CiAgICAgIHRoaXMudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CiAgICAgIHRoaXMuZ2xzbFZlcnNpb24gPSBudWxsOwogICAgICBpZiAocGFyYW1ldGVycyAhPT0gdm9pZCAwKSB7CiAgICAgICAgaWYgKHBhcmFtZXRlcnMuYXR0cmlidXRlcyAhPT0gdm9pZCAwKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5TaGFkZXJNYXRlcmlhbDogYXR0cmlidXRlcyBzaG91bGQgbm93IGJlIGRlZmluZWQgaW4gVEhSRUUuQnVmZmVyR2VvbWV0cnkgaW5zdGVhZC4iKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZXRWYWx1ZXMocGFyYW1ldGVycyk7CiAgICAgIH0KICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5mcmFnbWVudFNoYWRlciA9IHNvdXJjZS5mcmFnbWVudFNoYWRlcjsKICAgICAgdGhpcy52ZXJ0ZXhTaGFkZXIgPSBzb3VyY2UudmVydGV4U2hhZGVyOwogICAgICB0aGlzLnVuaWZvcm1zID0gY2xvbmVVbmlmb3Jtcyhzb3VyY2UudW5pZm9ybXMpOwogICAgICB0aGlzLmRlZmluZXMgPSBPYmplY3QuYXNzaWduKHt9LCBzb3VyY2UuZGVmaW5lcyk7CiAgICAgIHRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwogICAgICB0aGlzLmxpZ2h0cyA9IHNvdXJjZS5saWdodHM7CiAgICAgIHRoaXMuY2xpcHBpbmcgPSBzb3VyY2UuY2xpcHBpbmc7CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gc291cmNlLm1vcnBoVGFyZ2V0czsKICAgICAgdGhpcy5tb3JwaE5vcm1hbHMgPSBzb3VyY2UubW9ycGhOb3JtYWxzOwogICAgICB0aGlzLmV4dGVuc2lvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBzb3VyY2UuZXh0ZW5zaW9ucyk7CiAgICAgIHRoaXMuZ2xzbFZlcnNpb24gPSBzb3VyY2UuZ2xzbFZlcnNpb247CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKG1ldGEpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTihtZXRhKTsKICAgICAgZGF0YS5nbHNsVmVyc2lvbiA9IHRoaXMuZ2xzbFZlcnNpb247CiAgICAgIGRhdGEudW5pZm9ybXMgPSB7fTsKICAgICAgZm9yIChjb25zdCBuYW1lIGluIHRoaXMudW5pZm9ybXMpIHsKICAgICAgICBjb25zdCB1bmlmb3JtID0gdGhpcy51bmlmb3Jtc1tuYW1lXTsKICAgICAgICBjb25zdCB2YWx1ZSA9IHVuaWZvcm0udmFsdWU7CiAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLmlzVGV4dHVyZSkgewogICAgICAgICAgZGF0YS51bmlmb3Jtc1tuYW1lXSA9IHsKICAgICAgICAgICAgdHlwZTogInQiLAogICAgICAgICAgICB2YWx1ZTogdmFsdWUudG9KU09OKG1ldGEpLnV1aWQKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSAmJiB2YWx1ZS5pc0NvbG9yKSB7CiAgICAgICAgICBkYXRhLnVuaWZvcm1zW25hbWVdID0gewogICAgICAgICAgICB0eXBlOiAiYyIsCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZS5nZXRIZXgoKQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yMikgewogICAgICAgICAgZGF0YS51bmlmb3Jtc1tuYW1lXSA9IHsKICAgICAgICAgICAgdHlwZTogInYyIiwKICAgICAgICAgICAgdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yMykgewogICAgICAgICAgZGF0YS51bmlmb3Jtc1tuYW1lXSA9IHsKICAgICAgICAgICAgdHlwZTogInYzIiwKICAgICAgICAgICAgdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yNCkgewogICAgICAgICAgZGF0YS51bmlmb3Jtc1tuYW1lXSA9IHsKICAgICAgICAgICAgdHlwZTogInY0IiwKICAgICAgICAgICAgdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlICYmIHZhbHVlLmlzTWF0cml4MykgewogICAgICAgICAgZGF0YS51bmlmb3Jtc1tuYW1lXSA9IHsKICAgICAgICAgICAgdHlwZTogIm0zIiwKICAgICAgICAgICAgdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlICYmIHZhbHVlLmlzTWF0cml4NCkgewogICAgICAgICAgZGF0YS51bmlmb3Jtc1tuYW1lXSA9IHsKICAgICAgICAgICAgdHlwZTogIm00IiwKICAgICAgICAgICAgdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YS51bmlmb3Jtc1tuYW1lXSA9IHsKICAgICAgICAgICAgdmFsdWUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmRlZmluZXMpLmxlbmd0aCA+IDApCiAgICAgICAgZGF0YS5kZWZpbmVzID0gdGhpcy5kZWZpbmVzOwogICAgICBkYXRhLnZlcnRleFNoYWRlciA9IHRoaXMudmVydGV4U2hhZGVyOwogICAgICBkYXRhLmZyYWdtZW50U2hhZGVyID0gdGhpcy5mcmFnbWVudFNoYWRlcjsKICAgICAgY29uc3QgZXh0ZW5zaW9ucyA9IHt9OwogICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLmV4dGVuc2lvbnMpIHsKICAgICAgICBpZiAodGhpcy5leHRlbnNpb25zW2tleV0gPT09IHRydWUpCiAgICAgICAgICBleHRlbnNpb25zW2tleV0gPSB0cnVlOwogICAgICB9CiAgICAgIGlmIChPYmplY3Qua2V5cyhleHRlbnNpb25zKS5sZW5ndGggPiAwKQogICAgICAgIGRhdGEuZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbnM7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogIH07CiAgU2hhZGVyTWF0ZXJpYWwucHJvdG90eXBlLmlzU2hhZGVyTWF0ZXJpYWwgPSB0cnVlOwogIHZhciBDYW1lcmEgPSBjbGFzcyBleHRlbmRzIE9iamVjdDNEIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiQ2FtZXJhIjsKICAgICAgdGhpcy5tYXRyaXhXb3JsZEludmVyc2UgPSBuZXcgTWF0cml4NCgpOwogICAgICB0aGlzLnByb2plY3Rpb25NYXRyaXggPSBuZXcgTWF0cml4NCgpOwogICAgICB0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKICAgIH0KICAgIGNvcHkoc291cmNlLCByZWN1cnNpdmUpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UsIHJlY3Vyc2l2ZSk7CiAgICAgIHRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoc291cmNlLm1hdHJpeFdvcmxkSW52ZXJzZSk7CiAgICAgIHRoaXMucHJvamVjdGlvbk1hdHJpeC5jb3B5KHNvdXJjZS5wcm9qZWN0aW9uTWF0cml4KTsKICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KHNvdXJjZS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0V29ybGREaXJlY3Rpb24odGFyZ2V0KSB7CiAgICAgIHRoaXMudXBkYXRlV29ybGRNYXRyaXgodHJ1ZSwgZmFsc2UpOwogICAgICBjb25zdCBlID0gdGhpcy5tYXRyaXhXb3JsZC5lbGVtZW50czsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQoLWVbOF0sIC1lWzldLCAtZVsxMF0pLm5vcm1hbGl6ZSgpOwogICAgfQogICAgdXBkYXRlTWF0cml4V29ybGQoZm9yY2UpIHsKICAgICAgc3VwZXIudXBkYXRlTWF0cml4V29ybGQoZm9yY2UpOwogICAgICB0aGlzLm1hdHJpeFdvcmxkSW52ZXJzZS5jb3B5KHRoaXMubWF0cml4V29ybGQpLmludmVydCgpOwogICAgfQogICAgdXBkYXRlV29ybGRNYXRyaXgodXBkYXRlUGFyZW50cywgdXBkYXRlQ2hpbGRyZW4pIHsKICAgICAgc3VwZXIudXBkYXRlV29ybGRNYXRyaXgodXBkYXRlUGFyZW50cywgdXBkYXRlQ2hpbGRyZW4pOwogICAgICB0aGlzLm1hdHJpeFdvcmxkSW52ZXJzZS5jb3B5KHRoaXMubWF0cml4V29ybGQpLmludmVydCgpOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyk7CiAgICB9CiAgfTsKICBDYW1lcmEucHJvdG90eXBlLmlzQ2FtZXJhID0gdHJ1ZTsKICB2YXIgUGVyc3BlY3RpdmVDYW1lcmEgPSBjbGFzcyBleHRlbmRzIENhbWVyYSB7CiAgICBjb25zdHJ1Y3Rvcihmb3YyID0gNTAsIGFzcGVjdDIgPSAxLCBuZWFyID0gMC4xLCBmYXIgPSAyZTMpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIlBlcnNwZWN0aXZlQ2FtZXJhIjsKICAgICAgdGhpcy5mb3YgPSBmb3YyOwogICAgICB0aGlzLnpvb20gPSAxOwogICAgICB0aGlzLm5lYXIgPSBuZWFyOwogICAgICB0aGlzLmZhciA9IGZhcjsKICAgICAgdGhpcy5mb2N1cyA9IDEwOwogICAgICB0aGlzLmFzcGVjdCA9IGFzcGVjdDI7CiAgICAgIHRoaXMudmlldyA9IG51bGw7CiAgICAgIHRoaXMuZmlsbUdhdWdlID0gMzU7CiAgICAgIHRoaXMuZmlsbU9mZnNldCA9IDA7CiAgICAgIHRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwogICAgfQogICAgY29weShzb3VyY2UsIHJlY3Vyc2l2ZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSwgcmVjdXJzaXZlKTsKICAgICAgdGhpcy5mb3YgPSBzb3VyY2UuZm92OwogICAgICB0aGlzLnpvb20gPSBzb3VyY2Uuem9vbTsKICAgICAgdGhpcy5uZWFyID0gc291cmNlLm5lYXI7CiAgICAgIHRoaXMuZmFyID0gc291cmNlLmZhcjsKICAgICAgdGhpcy5mb2N1cyA9IHNvdXJjZS5mb2N1czsKICAgICAgdGhpcy5hc3BlY3QgPSBzb3VyY2UuYXNwZWN0OwogICAgICB0aGlzLnZpZXcgPSBzb3VyY2UudmlldyA9PT0gbnVsbCA/IG51bGwgOiBPYmplY3QuYXNzaWduKHt9LCBzb3VyY2Uudmlldyk7CiAgICAgIHRoaXMuZmlsbUdhdWdlID0gc291cmNlLmZpbG1HYXVnZTsKICAgICAgdGhpcy5maWxtT2Zmc2V0ID0gc291cmNlLmZpbG1PZmZzZXQ7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0Rm9jYWxMZW5ndGgoZm9jYWxMZW5ndGgpIHsKICAgICAgY29uc3QgdkV4dGVudFNsb3BlID0gMC41ICogdGhpcy5nZXRGaWxtSGVpZ2h0KCkgLyBmb2NhbExlbmd0aDsKICAgICAgdGhpcy5mb3YgPSBSQUQyREVHICogMiAqIE1hdGguYXRhbih2RXh0ZW50U2xvcGUpOwogICAgICB0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKICAgIH0KICAgIGdldEZvY2FsTGVuZ3RoKCkgewogICAgICBjb25zdCB2RXh0ZW50U2xvcGUgPSBNYXRoLnRhbihERUcyUkFEICogMC41ICogdGhpcy5mb3YpOwogICAgICByZXR1cm4gMC41ICogdGhpcy5nZXRGaWxtSGVpZ2h0KCkgLyB2RXh0ZW50U2xvcGU7CiAgICB9CiAgICBnZXRFZmZlY3RpdmVGT1YoKSB7CiAgICAgIHJldHVybiBSQUQyREVHICogMiAqIE1hdGguYXRhbihNYXRoLnRhbihERUcyUkFEICogMC41ICogdGhpcy5mb3YpIC8gdGhpcy56b29tKTsKICAgIH0KICAgIGdldEZpbG1XaWR0aCgpIHsKICAgICAgcmV0dXJuIHRoaXMuZmlsbUdhdWdlICogTWF0aC5taW4odGhpcy5hc3BlY3QsIDEpOwogICAgfQogICAgZ2V0RmlsbUhlaWdodCgpIHsKICAgICAgcmV0dXJuIHRoaXMuZmlsbUdhdWdlIC8gTWF0aC5tYXgodGhpcy5hc3BlY3QsIDEpOwogICAgfQogICAgc2V0Vmlld09mZnNldChmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgdGhpcy5hc3BlY3QgPSBmdWxsV2lkdGggLyBmdWxsSGVpZ2h0OwogICAgICBpZiAodGhpcy52aWV3ID09PSBudWxsKSB7CiAgICAgICAgdGhpcy52aWV3ID0gewogICAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgICAgIGZ1bGxXaWR0aDogMSwKICAgICAgICAgIGZ1bGxIZWlnaHQ6IDEsCiAgICAgICAgICBvZmZzZXRYOiAwLAogICAgICAgICAgb2Zmc2V0WTogMCwKICAgICAgICAgIHdpZHRoOiAxLAogICAgICAgICAgaGVpZ2h0OiAxCiAgICAgICAgfTsKICAgICAgfQogICAgICB0aGlzLnZpZXcuZW5hYmxlZCA9IHRydWU7CiAgICAgIHRoaXMudmlldy5mdWxsV2lkdGggPSBmdWxsV2lkdGg7CiAgICAgIHRoaXMudmlldy5mdWxsSGVpZ2h0ID0gZnVsbEhlaWdodDsKICAgICAgdGhpcy52aWV3Lm9mZnNldFggPSB4OwogICAgICB0aGlzLnZpZXcub2Zmc2V0WSA9IHk7CiAgICAgIHRoaXMudmlldy53aWR0aCA9IHdpZHRoOwogICAgICB0aGlzLnZpZXcuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICB0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKICAgIH0KICAgIGNsZWFyVmlld09mZnNldCgpIHsKICAgICAgaWYgKHRoaXMudmlldyAhPT0gbnVsbCkgewogICAgICAgIHRoaXMudmlldy5lbmFibGVkID0gZmFsc2U7CiAgICAgIH0KICAgICAgdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CiAgICB9CiAgICB1cGRhdGVQcm9qZWN0aW9uTWF0cml4KCkgewogICAgICBjb25zdCBuZWFyID0gdGhpcy5uZWFyOwogICAgICBsZXQgdG9wID0gbmVhciAqIE1hdGgudGFuKERFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdikgLyB0aGlzLnpvb207CiAgICAgIGxldCBoZWlnaHQgPSAyICogdG9wOwogICAgICBsZXQgd2lkdGggPSB0aGlzLmFzcGVjdCAqIGhlaWdodDsKICAgICAgbGV0IGxlZnQgPSAtMC41ICogd2lkdGg7CiAgICAgIGNvbnN0IHZpZXcgPSB0aGlzLnZpZXc7CiAgICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwgJiYgdGhpcy52aWV3LmVuYWJsZWQpIHsKICAgICAgICBjb25zdCBmdWxsV2lkdGggPSB2aWV3LmZ1bGxXaWR0aCwgZnVsbEhlaWdodCA9IHZpZXcuZnVsbEhlaWdodDsKICAgICAgICBsZWZ0ICs9IHZpZXcub2Zmc2V0WCAqIHdpZHRoIC8gZnVsbFdpZHRoOwogICAgICAgIHRvcCAtPSB2aWV3Lm9mZnNldFkgKiBoZWlnaHQgLyBmdWxsSGVpZ2h0OwogICAgICAgIHdpZHRoICo9IHZpZXcud2lkdGggLyBmdWxsV2lkdGg7CiAgICAgICAgaGVpZ2h0ICo9IHZpZXcuaGVpZ2h0IC8gZnVsbEhlaWdodDsKICAgICAgfQogICAgICBjb25zdCBza2V3ID0gdGhpcy5maWxtT2Zmc2V0OwogICAgICBpZiAoc2tldyAhPT0gMCkKICAgICAgICBsZWZ0ICs9IG5lYXIgKiBza2V3IC8gdGhpcy5nZXRGaWxtV2lkdGgoKTsKICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4Lm1ha2VQZXJzcGVjdGl2ZShsZWZ0LCBsZWZ0ICsgd2lkdGgsIHRvcCwgdG9wIC0gaGVpZ2h0LCBuZWFyLCB0aGlzLmZhcik7CiAgICAgIHRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSh0aGlzLnByb2plY3Rpb25NYXRyaXgpLmludmVydCgpOwogICAgfQogICAgdG9KU09OKG1ldGEpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTihtZXRhKTsKICAgICAgZGF0YS5vYmplY3QuZm92ID0gdGhpcy5mb3Y7CiAgICAgIGRhdGEub2JqZWN0Lnpvb20gPSB0aGlzLnpvb207CiAgICAgIGRhdGEub2JqZWN0Lm5lYXIgPSB0aGlzLm5lYXI7CiAgICAgIGRhdGEub2JqZWN0LmZhciA9IHRoaXMuZmFyOwogICAgICBkYXRhLm9iamVjdC5mb2N1cyA9IHRoaXMuZm9jdXM7CiAgICAgIGRhdGEub2JqZWN0LmFzcGVjdCA9IHRoaXMuYXNwZWN0OwogICAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKQogICAgICAgIGRhdGEub2JqZWN0LnZpZXcgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnZpZXcpOwogICAgICBkYXRhLm9iamVjdC5maWxtR2F1Z2UgPSB0aGlzLmZpbG1HYXVnZTsKICAgICAgZGF0YS5vYmplY3QuZmlsbU9mZnNldCA9IHRoaXMuZmlsbU9mZnNldDsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgfTsKICBQZXJzcGVjdGl2ZUNhbWVyYS5wcm90b3R5cGUuaXNQZXJzcGVjdGl2ZUNhbWVyYSA9IHRydWU7CiAgdmFyIGZvdiA9IDkwOwogIHZhciBhc3BlY3QgPSAxOwogIHZhciBDdWJlQ2FtZXJhID0gY2xhc3MgZXh0ZW5kcyBPYmplY3QzRCB7CiAgICBjb25zdHJ1Y3RvcihuZWFyLCBmYXIsIHJlbmRlclRhcmdldCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiQ3ViZUNhbWVyYSI7CiAgICAgIGlmIChyZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgIT09IHRydWUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5DdWJlQ2FtZXJhOiBUaGUgY29uc3RydWN0b3Igbm93IGV4cGVjdHMgYW4gaW5zdGFuY2Ugb2YgV2ViR0xDdWJlUmVuZGVyVGFyZ2V0IGFzIHRoaXJkIHBhcmFtZXRlci4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5yZW5kZXJUYXJnZXQgPSByZW5kZXJUYXJnZXQ7CiAgICAgIGNvbnN0IGNhbWVyYVBYID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIpOwogICAgICBjYW1lcmFQWC5sYXllcnMgPSB0aGlzLmxheWVyczsKICAgICAgY2FtZXJhUFgudXAuc2V0KDAsIC0xLCAwKTsKICAgICAgY2FtZXJhUFgubG9va0F0KG5ldyBWZWN0b3IzKDEsIDAsIDApKTsKICAgICAgdGhpcy5hZGQoY2FtZXJhUFgpOwogICAgICBjb25zdCBjYW1lcmFOWCA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYShmb3YsIGFzcGVjdCwgbmVhciwgZmFyKTsKICAgICAgY2FtZXJhTlgubGF5ZXJzID0gdGhpcy5sYXllcnM7CiAgICAgIGNhbWVyYU5YLnVwLnNldCgwLCAtMSwgMCk7CiAgICAgIGNhbWVyYU5YLmxvb2tBdChuZXcgVmVjdG9yMygtMSwgMCwgMCkpOwogICAgICB0aGlzLmFkZChjYW1lcmFOWCk7CiAgICAgIGNvbnN0IGNhbWVyYVBZID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIpOwogICAgICBjYW1lcmFQWS5sYXllcnMgPSB0aGlzLmxheWVyczsKICAgICAgY2FtZXJhUFkudXAuc2V0KDAsIDAsIDEpOwogICAgICBjYW1lcmFQWS5sb29rQXQobmV3IFZlY3RvcjMoMCwgMSwgMCkpOwogICAgICB0aGlzLmFkZChjYW1lcmFQWSk7CiAgICAgIGNvbnN0IGNhbWVyYU5ZID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIpOwogICAgICBjYW1lcmFOWS5sYXllcnMgPSB0aGlzLmxheWVyczsKICAgICAgY2FtZXJhTlkudXAuc2V0KDAsIDAsIC0xKTsKICAgICAgY2FtZXJhTlkubG9va0F0KG5ldyBWZWN0b3IzKDAsIC0xLCAwKSk7CiAgICAgIHRoaXMuYWRkKGNhbWVyYU5ZKTsKICAgICAgY29uc3QgY2FtZXJhUFogPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoZm92LCBhc3BlY3QsIG5lYXIsIGZhcik7CiAgICAgIGNhbWVyYVBaLmxheWVycyA9IHRoaXMubGF5ZXJzOwogICAgICBjYW1lcmFQWi51cC5zZXQoMCwgLTEsIDApOwogICAgICBjYW1lcmFQWi5sb29rQXQobmV3IFZlY3RvcjMoMCwgMCwgMSkpOwogICAgICB0aGlzLmFkZChjYW1lcmFQWik7CiAgICAgIGNvbnN0IGNhbWVyYU5aID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIpOwogICAgICBjYW1lcmFOWi5sYXllcnMgPSB0aGlzLmxheWVyczsKICAgICAgY2FtZXJhTloudXAuc2V0KDAsIC0xLCAwKTsKICAgICAgY2FtZXJhTloubG9va0F0KG5ldyBWZWN0b3IzKDAsIDAsIC0xKSk7CiAgICAgIHRoaXMuYWRkKGNhbWVyYU5aKTsKICAgIH0KICAgIHVwZGF0ZShyZW5kZXJlciwgc2NlbmUpIHsKICAgICAgaWYgKHRoaXMucGFyZW50ID09PSBudWxsKQogICAgICAgIHRoaXMudXBkYXRlTWF0cml4V29ybGQoKTsKICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0ID0gdGhpcy5yZW5kZXJUYXJnZXQ7CiAgICAgIGNvbnN0IFtjYW1lcmFQWCwgY2FtZXJhTlgsIGNhbWVyYVBZLCBjYW1lcmFOWSwgY2FtZXJhUFosIGNhbWVyYU5aXSA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IGN1cnJlbnRYckVuYWJsZWQgPSByZW5kZXJlci54ci5lbmFibGVkOwogICAgICBjb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAgIHJlbmRlcmVyLnhyLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgY29uc3QgZ2VuZXJhdGVNaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwogICAgICByZW5kZXJUYXJnZXQudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKICAgICAgcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCwgMCk7CiAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhUFgpOwogICAgICByZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0LCAxKTsKICAgICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBjYW1lcmFOWCk7CiAgICAgIHJlbmRlcmVyLnNldFJlbmRlclRhcmdldChyZW5kZXJUYXJnZXQsIDIpOwogICAgICByZW5kZXJlci5yZW5kZXIoc2NlbmUsIGNhbWVyYVBZKTsKICAgICAgcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCwgMyk7CiAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhTlkpOwogICAgICByZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0LCA0KTsKICAgICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBjYW1lcmFQWik7CiAgICAgIHJlbmRlclRhcmdldC50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGdlbmVyYXRlTWlwbWFwczsKICAgICAgcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCwgNSk7CiAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhTlopOwogICAgICByZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoY3VycmVudFJlbmRlclRhcmdldCk7CiAgICAgIHJlbmRlcmVyLnhyLmVuYWJsZWQgPSBjdXJyZW50WHJFbmFibGVkOwogICAgfQogIH07CiAgdmFyIEN1YmVUZXh0dXJlID0gY2xhc3MgZXh0ZW5kcyBUZXh0dXJlIHsKICAgIGNvbnN0cnVjdG9yKGltYWdlcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBlbmNvZGluZykgewogICAgICBpbWFnZXMgPSBpbWFnZXMgIT09IHZvaWQgMCA/IGltYWdlcyA6IFtdOwogICAgICBtYXBwaW5nID0gbWFwcGluZyAhPT0gdm9pZCAwID8gbWFwcGluZyA6IEN1YmVSZWZsZWN0aW9uTWFwcGluZzsKICAgICAgZm9ybWF0ID0gZm9ybWF0ICE9PSB2b2lkIDAgPyBmb3JtYXQgOiBSR0JGb3JtYXQ7CiAgICAgIHN1cGVyKGltYWdlcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBlbmNvZGluZyk7CiAgICAgIHRoaXMuX25lZWRzRmxpcEVudk1hcCA9IHRydWU7CiAgICAgIHRoaXMuZmxpcFkgPSBmYWxzZTsKICAgIH0KICAgIGdldCBpbWFnZXMoKSB7CiAgICAgIHJldHVybiB0aGlzLmltYWdlOwogICAgfQogICAgc2V0IGltYWdlcyh2YWx1ZSkgewogICAgICB0aGlzLmltYWdlID0gdmFsdWU7CiAgICB9CiAgfTsKICBDdWJlVGV4dHVyZS5wcm90b3R5cGUuaXNDdWJlVGV4dHVyZSA9IHRydWU7CiAgdmFyIFdlYkdMQ3ViZVJlbmRlclRhcmdldCA9IGNsYXNzIGV4dGVuZHMgV2ViR0xSZW5kZXJUYXJnZXQgewogICAgY29uc3RydWN0b3Ioc2l6ZSwgb3B0aW9ucywgZHVtbXkpIHsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIob3B0aW9ucykpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMQ3ViZVJlbmRlclRhcmdldDogY29uc3RydWN0b3Igc2lnbmF0dXJlIGlzIG5vdyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQoIHNpemUsIG9wdGlvbnMgKSIpOwogICAgICAgIG9wdGlvbnMgPSBkdW1teTsKICAgICAgfQogICAgICBzdXBlcihzaXplLCBzaXplLCBvcHRpb25zKTsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgIHRoaXMudGV4dHVyZSA9IG5ldyBDdWJlVGV4dHVyZSh2b2lkIDAsIG9wdGlvbnMubWFwcGluZywgb3B0aW9ucy53cmFwUywgb3B0aW9ucy53cmFwVCwgb3B0aW9ucy5tYWdGaWx0ZXIsIG9wdGlvbnMubWluRmlsdGVyLCBvcHRpb25zLmZvcm1hdCwgb3B0aW9ucy50eXBlLCBvcHRpb25zLmFuaXNvdHJvcHksIG9wdGlvbnMuZW5jb2RpbmcpOwogICAgICB0aGlzLnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gb3B0aW9ucy5nZW5lcmF0ZU1pcG1hcHMgIT09IHZvaWQgMCA/IG9wdGlvbnMuZ2VuZXJhdGVNaXBtYXBzIDogZmFsc2U7CiAgICAgIHRoaXMudGV4dHVyZS5taW5GaWx0ZXIgPSBvcHRpb25zLm1pbkZpbHRlciAhPT0gdm9pZCAwID8gb3B0aW9ucy5taW5GaWx0ZXIgOiBMaW5lYXJGaWx0ZXI7CiAgICAgIHRoaXMudGV4dHVyZS5fbmVlZHNGbGlwRW52TWFwID0gZmFsc2U7CiAgICB9CiAgICBmcm9tRXF1aXJlY3Rhbmd1bGFyVGV4dHVyZShyZW5kZXJlciwgdGV4dHVyZSkgewogICAgICB0aGlzLnRleHR1cmUudHlwZSA9IHRleHR1cmUudHlwZTsKICAgICAgdGhpcy50ZXh0dXJlLmZvcm1hdCA9IFJHQkFGb3JtYXQ7CiAgICAgIHRoaXMudGV4dHVyZS5lbmNvZGluZyA9IHRleHR1cmUuZW5jb2Rpbmc7CiAgICAgIHRoaXMudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSB0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwczsKICAgICAgdGhpcy50ZXh0dXJlLm1pbkZpbHRlciA9IHRleHR1cmUubWluRmlsdGVyOwogICAgICB0aGlzLnRleHR1cmUubWFnRmlsdGVyID0gdGV4dHVyZS5tYWdGaWx0ZXI7CiAgICAgIGNvbnN0IHNoYWRlciA9IHsKICAgICAgICB1bmlmb3JtczogewogICAgICAgICAgdEVxdWlyZWN0OiB7IHZhbHVlOiBudWxsIH0KICAgICAgICB9LAogICAgICAgIHZlcnRleFNoYWRlcjogYAoKCQkJCXZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247CgoJCQkJdmVjMyB0cmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHsKCgkJCQkJcmV0dXJuIG5vcm1hbGl6ZSggKCBtYXRyaXggKiB2ZWM0KCBkaXIsIDAuMCApICkueHl6ICk7CgoJCQkJfQoKCQkJCXZvaWQgbWFpbigpIHsKCgkJCQkJdldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTsKCgkJCQkJI2luY2x1ZGUgPGJlZ2luX3ZlcnRleD4KCQkJCQkjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+CgoJCQkJfQoJCQlgLAogICAgICAgIGZyYWdtZW50U2hhZGVyOiBgCgoJCQkJdW5pZm9ybSBzYW1wbGVyMkQgdEVxdWlyZWN0OwoKCQkJCXZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247CgoJCQkJI2luY2x1ZGUgPGNvbW1vbj4KCgkJCQl2b2lkIG1haW4oKSB7CgoJCQkJCXZlYzMgZGlyZWN0aW9uID0gbm9ybWFsaXplKCB2V29ybGREaXJlY3Rpb24gKTsKCgkJCQkJdmVjMiBzYW1wbGVVViA9IGVxdWlyZWN0VXYoIGRpcmVjdGlvbiApOwoKCQkJCQlnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoIHRFcXVpcmVjdCwgc2FtcGxlVVYgKTsKCgkJCQl9CgkJCWAKICAgICAgfTsKICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgQm94R2VvbWV0cnkoNSwgNSwgNSk7CiAgICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IFNoYWRlck1hdGVyaWFsKHsKICAgICAgICBuYW1lOiAiQ3ViZW1hcEZyb21FcXVpcmVjdCIsCiAgICAgICAgdW5pZm9ybXM6IGNsb25lVW5pZm9ybXMoc2hhZGVyLnVuaWZvcm1zKSwKICAgICAgICB2ZXJ0ZXhTaGFkZXI6IHNoYWRlci52ZXJ0ZXhTaGFkZXIsCiAgICAgICAgZnJhZ21lbnRTaGFkZXI6IHNoYWRlci5mcmFnbWVudFNoYWRlciwKICAgICAgICBzaWRlOiBCYWNrU2lkZSwKICAgICAgICBibGVuZGluZzogTm9CbGVuZGluZwogICAgICB9KTsKICAgICAgbWF0ZXJpYWwudW5pZm9ybXMudEVxdWlyZWN0LnZhbHVlID0gdGV4dHVyZTsKICAgICAgY29uc3QgbWVzaCA9IG5ldyBNZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgIGNvbnN0IGN1cnJlbnRNaW5GaWx0ZXIgPSB0ZXh0dXJlLm1pbkZpbHRlcjsKICAgICAgaWYgKHRleHR1cmUubWluRmlsdGVyID09PSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpCiAgICAgICAgdGV4dHVyZS5taW5GaWx0ZXIgPSBMaW5lYXJGaWx0ZXI7CiAgICAgIGNvbnN0IGNhbWVyYSA9IG5ldyBDdWJlQ2FtZXJhKDEsIDEwLCB0aGlzKTsKICAgICAgY2FtZXJhLnVwZGF0ZShyZW5kZXJlciwgbWVzaCk7CiAgICAgIHRleHR1cmUubWluRmlsdGVyID0gY3VycmVudE1pbkZpbHRlcjsKICAgICAgbWVzaC5nZW9tZXRyeS5kaXNwb3NlKCk7CiAgICAgIG1lc2gubWF0ZXJpYWwuZGlzcG9zZSgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsZWFyKHJlbmRlcmVyLCBjb2xvciwgZGVwdGgsIHN0ZW5jaWwpIHsKICAgICAgY29uc3QgY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIHJlbmRlcmVyLnNldFJlbmRlclRhcmdldCh0aGlzLCBpKTsKICAgICAgICByZW5kZXJlci5jbGVhcihjb2xvciwgZGVwdGgsIHN0ZW5jaWwpOwogICAgICB9CiAgICAgIHJlbmRlcmVyLnNldFJlbmRlclRhcmdldChjdXJyZW50UmVuZGVyVGFyZ2V0KTsKICAgIH0KICB9OwogIFdlYkdMQ3ViZVJlbmRlclRhcmdldC5wcm90b3R5cGUuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgPSB0cnVlOwogIHZhciBfdmVjdG9yMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfdmVjdG9yMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfbm9ybWFsTWF0cml4ID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXRyaXgzKCk7CiAgdmFyIFBsYW5lID0gY2xhc3MgewogICAgY29uc3RydWN0b3Iobm9ybWFsMiA9IG5ldyBWZWN0b3IzKDEsIDAsIDApLCBjb25zdGFudCA9IDApIHsKICAgICAgdGhpcy5ub3JtYWwgPSBub3JtYWwyOwogICAgICB0aGlzLmNvbnN0YW50ID0gY29uc3RhbnQ7CiAgICB9CiAgICBzZXQobm9ybWFsMiwgY29uc3RhbnQpIHsKICAgICAgdGhpcy5ub3JtYWwuY29weShub3JtYWwyKTsKICAgICAgdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldENvbXBvbmVudHMoeCwgeSwgeiwgdykgewogICAgICB0aGlzLm5vcm1hbC5zZXQoeCwgeSwgeik7CiAgICAgIHRoaXMuY29uc3RhbnQgPSB3OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21Ob3JtYWxBbmRDb3BsYW5hclBvaW50KG5vcm1hbDIsIHBvaW50KSB7CiAgICAgIHRoaXMubm9ybWFsLmNvcHkobm9ybWFsMik7CiAgICAgIHRoaXMuY29uc3RhbnQgPSAtcG9pbnQuZG90KHRoaXMubm9ybWFsKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRGcm9tQ29wbGFuYXJQb2ludHMoYSwgYiwgYykgewogICAgICBjb25zdCBub3JtYWwyID0gX3ZlY3RvcjEuc3ViVmVjdG9ycyhjLCBiKS5jcm9zcyhfdmVjdG9yMi5zdWJWZWN0b3JzKGEsIGIpKS5ub3JtYWxpemUoKTsKICAgICAgdGhpcy5zZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludChub3JtYWwyLCBhKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb3B5KHBsYW5lKSB7CiAgICAgIHRoaXMubm9ybWFsLmNvcHkocGxhbmUubm9ybWFsKTsKICAgICAgdGhpcy5jb25zdGFudCA9IHBsYW5lLmNvbnN0YW50OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG5vcm1hbGl6ZSgpIHsKICAgICAgY29uc3QgaW52ZXJzZU5vcm1hbExlbmd0aCA9IDEgLyB0aGlzLm5vcm1hbC5sZW5ndGgoKTsKICAgICAgdGhpcy5ub3JtYWwubXVsdGlwbHlTY2FsYXIoaW52ZXJzZU5vcm1hbExlbmd0aCk7CiAgICAgIHRoaXMuY29uc3RhbnQgKj0gaW52ZXJzZU5vcm1hbExlbmd0aDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBuZWdhdGUoKSB7CiAgICAgIHRoaXMuY29uc3RhbnQgKj0gLTE7CiAgICAgIHRoaXMubm9ybWFsLm5lZ2F0ZSgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGRpc3RhbmNlVG9Qb2ludChwb2ludCkgewogICAgICByZXR1cm4gdGhpcy5ub3JtYWwuZG90KHBvaW50KSArIHRoaXMuY29uc3RhbnQ7CiAgICB9CiAgICBkaXN0YW5jZVRvU3BoZXJlKHNwaGVyZSkgewogICAgICByZXR1cm4gdGhpcy5kaXN0YW5jZVRvUG9pbnQoc3BoZXJlLmNlbnRlcikgLSBzcGhlcmUucmFkaXVzOwogICAgfQogICAgcHJvamVjdFBvaW50KHBvaW50LCB0YXJnZXQpIHsKICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KHRoaXMubm9ybWFsKS5tdWx0aXBseVNjYWxhcigtdGhpcy5kaXN0YW5jZVRvUG9pbnQocG9pbnQpKS5hZGQocG9pbnQpOwogICAgfQogICAgaW50ZXJzZWN0TGluZShsaW5lLCB0YXJnZXQpIHsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gbGluZS5kZWx0YShfdmVjdG9yMSk7CiAgICAgIGNvbnN0IGRlbm9taW5hdG9yID0gdGhpcy5ub3JtYWwuZG90KGRpcmVjdGlvbik7CiAgICAgIGlmIChkZW5vbWluYXRvciA9PT0gMCkgewogICAgICAgIGlmICh0aGlzLmRpc3RhbmNlVG9Qb2ludChsaW5lLnN0YXJ0KSA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KGxpbmUuc3RhcnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCB0ID0gLShsaW5lLnN0YXJ0LmRvdCh0aGlzLm5vcm1hbCkgKyB0aGlzLmNvbnN0YW50KSAvIGRlbm9taW5hdG9yOwogICAgICBpZiAodCA8IDAgfHwgdCA+IDEpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gdGFyZ2V0LmNvcHkoZGlyZWN0aW9uKS5tdWx0aXBseVNjYWxhcih0KS5hZGQobGluZS5zdGFydCk7CiAgICB9CiAgICBpbnRlcnNlY3RzTGluZShsaW5lKSB7CiAgICAgIGNvbnN0IHN0YXJ0U2lnbiA9IHRoaXMuZGlzdGFuY2VUb1BvaW50KGxpbmUuc3RhcnQpOwogICAgICBjb25zdCBlbmRTaWduID0gdGhpcy5kaXN0YW5jZVRvUG9pbnQobGluZS5lbmQpOwogICAgICByZXR1cm4gc3RhcnRTaWduIDwgMCAmJiBlbmRTaWduID4gMCB8fCBlbmRTaWduIDwgMCAmJiBzdGFydFNpZ24gPiAwOwogICAgfQogICAgaW50ZXJzZWN0c0JveChib3gpIHsKICAgICAgcmV0dXJuIGJveC5pbnRlcnNlY3RzUGxhbmUodGhpcyk7CiAgICB9CiAgICBpbnRlcnNlY3RzU3BoZXJlKHNwaGVyZSkgewogICAgICByZXR1cm4gc3BoZXJlLmludGVyc2VjdHNQbGFuZSh0aGlzKTsKICAgIH0KICAgIGNvcGxhbmFyUG9pbnQodGFyZ2V0KSB7CiAgICAgIHJldHVybiB0YXJnZXQuY29weSh0aGlzLm5vcm1hbCkubXVsdGlwbHlTY2FsYXIoLXRoaXMuY29uc3RhbnQpOwogICAgfQogICAgYXBwbHlNYXRyaXg0KG1hdHJpeCwgb3B0aW9uYWxOb3JtYWxNYXRyaXgpIHsKICAgICAgY29uc3Qgbm9ybWFsTWF0cml4ID0gb3B0aW9uYWxOb3JtYWxNYXRyaXggfHwgX25vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgobWF0cml4KTsKICAgICAgY29uc3QgcmVmZXJlbmNlUG9pbnQgPSB0aGlzLmNvcGxhbmFyUG9pbnQoX3ZlY3RvcjEpLmFwcGx5TWF0cml4NChtYXRyaXgpOwogICAgICBjb25zdCBub3JtYWwyID0gdGhpcy5ub3JtYWwuYXBwbHlNYXRyaXgzKG5vcm1hbE1hdHJpeCkubm9ybWFsaXplKCk7CiAgICAgIHRoaXMuY29uc3RhbnQgPSAtcmVmZXJlbmNlUG9pbnQuZG90KG5vcm1hbDIpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRyYW5zbGF0ZShvZmZzZXQpIHsKICAgICAgdGhpcy5jb25zdGFudCAtPSBvZmZzZXQuZG90KHRoaXMubm9ybWFsKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBlcXVhbHMocGxhbmUpIHsKICAgICAgcmV0dXJuIHBsYW5lLm5vcm1hbC5lcXVhbHModGhpcy5ub3JtYWwpICYmIHBsYW5lLmNvbnN0YW50ID09PSB0aGlzLmNvbnN0YW50OwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyk7CiAgICB9CiAgfTsKICBQbGFuZS5wcm90b3R5cGUuaXNQbGFuZSA9IHRydWU7CiAgdmFyIF9zcGhlcmUkMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU3BoZXJlKCk7CiAgdmFyIF92ZWN0b3IkNyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBGcnVzdHVtID0gY2xhc3MgewogICAgY29uc3RydWN0b3IocDAgPSBuZXcgUGxhbmUoKSwgcDEgPSBuZXcgUGxhbmUoKSwgcDIgPSBuZXcgUGxhbmUoKSwgcDMgPSBuZXcgUGxhbmUoKSwgcDQgPSBuZXcgUGxhbmUoKSwgcDUgPSBuZXcgUGxhbmUoKSkgewogICAgICB0aGlzLnBsYW5lcyA9IFtwMCwgcDEsIHAyLCBwMywgcDQsIHA1XTsKICAgIH0KICAgIHNldChwMCwgcDEsIHAyLCBwMywgcDQsIHA1KSB7CiAgICAgIGNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwogICAgICBwbGFuZXNbMF0uY29weShwMCk7CiAgICAgIHBsYW5lc1sxXS5jb3B5KHAxKTsKICAgICAgcGxhbmVzWzJdLmNvcHkocDIpOwogICAgICBwbGFuZXNbM10uY29weShwMyk7CiAgICAgIHBsYW5lc1s0XS5jb3B5KHA0KTsKICAgICAgcGxhbmVzWzVdLmNvcHkocDUpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvcHkoZnJ1c3R1bSkgewogICAgICBjb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBwbGFuZXNbaV0uY29weShmcnVzdHVtLnBsYW5lc1tpXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRGcm9tUHJvamVjdGlvbk1hdHJpeChtKSB7CiAgICAgIGNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwogICAgICBjb25zdCBtZSA9IG0uZWxlbWVudHM7CiAgICAgIGNvbnN0IG1lMCA9IG1lWzBdLCBtZTEgPSBtZVsxXSwgbWUyID0gbWVbMl0sIG1lMyA9IG1lWzNdOwogICAgICBjb25zdCBtZTQgPSBtZVs0XSwgbWU1ID0gbWVbNV0sIG1lNiA9IG1lWzZdLCBtZTcgPSBtZVs3XTsKICAgICAgY29uc3QgbWU4ID0gbWVbOF0sIG1lOSA9IG1lWzldLCBtZTEwID0gbWVbMTBdLCBtZTExID0gbWVbMTFdOwogICAgICBjb25zdCBtZTEyID0gbWVbMTJdLCBtZTEzID0gbWVbMTNdLCBtZTE0ID0gbWVbMTRdLCBtZTE1ID0gbWVbMTVdOwogICAgICBwbGFuZXNbMF0uc2V0Q29tcG9uZW50cyhtZTMgLSBtZTAsIG1lNyAtIG1lNCwgbWUxMSAtIG1lOCwgbWUxNSAtIG1lMTIpLm5vcm1hbGl6ZSgpOwogICAgICBwbGFuZXNbMV0uc2V0Q29tcG9uZW50cyhtZTMgKyBtZTAsIG1lNyArIG1lNCwgbWUxMSArIG1lOCwgbWUxNSArIG1lMTIpLm5vcm1hbGl6ZSgpOwogICAgICBwbGFuZXNbMl0uc2V0Q29tcG9uZW50cyhtZTMgKyBtZTEsIG1lNyArIG1lNSwgbWUxMSArIG1lOSwgbWUxNSArIG1lMTMpLm5vcm1hbGl6ZSgpOwogICAgICBwbGFuZXNbM10uc2V0Q29tcG9uZW50cyhtZTMgLSBtZTEsIG1lNyAtIG1lNSwgbWUxMSAtIG1lOSwgbWUxNSAtIG1lMTMpLm5vcm1hbGl6ZSgpOwogICAgICBwbGFuZXNbNF0uc2V0Q29tcG9uZW50cyhtZTMgLSBtZTIsIG1lNyAtIG1lNiwgbWUxMSAtIG1lMTAsIG1lMTUgLSBtZTE0KS5ub3JtYWxpemUoKTsKICAgICAgcGxhbmVzWzVdLnNldENvbXBvbmVudHMobWUzICsgbWUyLCBtZTcgKyBtZTYsIG1lMTEgKyBtZTEwLCBtZTE1ICsgbWUxNCkubm9ybWFsaXplKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgaW50ZXJzZWN0c09iamVjdChvYmplY3QpIHsKICAgICAgY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CiAgICAgIGlmIChnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCkKICAgICAgICBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKICAgICAgX3NwaGVyZSQyLmNvcHkoZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUpLmFwcGx5TWF0cml4NChvYmplY3QubWF0cml4V29ybGQpOwogICAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3RzU3BoZXJlKF9zcGhlcmUkMik7CiAgICB9CiAgICBpbnRlcnNlY3RzU3ByaXRlKHNwcml0ZSkgewogICAgICBfc3BoZXJlJDIuY2VudGVyLnNldCgwLCAwLCAwKTsKICAgICAgX3NwaGVyZSQyLnJhZGl1cyA9IDAuNzA3MTA2NzgxMTg2NTQ3NjsKICAgICAgX3NwaGVyZSQyLmFwcGx5TWF0cml4NChzcHJpdGUubWF0cml4V29ybGQpOwogICAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3RzU3BoZXJlKF9zcGhlcmUkMik7CiAgICB9CiAgICBpbnRlcnNlY3RzU3BoZXJlKHNwaGVyZSkgewogICAgICBjb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKICAgICAgY29uc3QgY2VudGVyID0gc3BoZXJlLmNlbnRlcjsKICAgICAgY29uc3QgbmVnUmFkaXVzID0gLXNwaGVyZS5yYWRpdXM7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBwbGFuZXNbaV0uZGlzdGFuY2VUb1BvaW50KGNlbnRlcik7CiAgICAgICAgaWYgKGRpc3RhbmNlIDwgbmVnUmFkaXVzKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaW50ZXJzZWN0c0JveChib3gpIHsKICAgICAgY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgY29uc3QgcGxhbmUgPSBwbGFuZXNbaV07CiAgICAgICAgX3ZlY3RvciQ3LnggPSBwbGFuZS5ub3JtYWwueCA+IDAgPyBib3gubWF4LnggOiBib3gubWluLng7CiAgICAgICAgX3ZlY3RvciQ3LnkgPSBwbGFuZS5ub3JtYWwueSA+IDAgPyBib3gubWF4LnkgOiBib3gubWluLnk7CiAgICAgICAgX3ZlY3RvciQ3LnogPSBwbGFuZS5ub3JtYWwueiA+IDAgPyBib3gubWF4LnogOiBib3gubWluLno7CiAgICAgICAgaWYgKHBsYW5lLmRpc3RhbmNlVG9Qb2ludChfdmVjdG9yJDcpIDwgMCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGNvbnRhaW5zUG9pbnQocG9pbnQpIHsKICAgICAgY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgaWYgKHBsYW5lc1tpXS5kaXN0YW5jZVRvUG9pbnQocG9pbnQpIDwgMCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpOwogICAgfQogIH07CiAgZnVuY3Rpb24gV2ViR0xBbmltYXRpb24oKSB7CiAgICBsZXQgY29udGV4dCA9IG51bGw7CiAgICBsZXQgaXNBbmltYXRpbmcgPSBmYWxzZTsKICAgIGxldCBhbmltYXRpb25Mb29wID0gbnVsbDsKICAgIGxldCByZXF1ZXN0SWQgPSBudWxsOwogICAgZnVuY3Rpb24gb25BbmltYXRpb25GcmFtZSh0aW1lLCBmcmFtZSkgewogICAgICBhbmltYXRpb25Mb29wKHRpbWUsIGZyYW1lKTsKICAgICAgcmVxdWVzdElkID0gY29udGV4dC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUob25BbmltYXRpb25GcmFtZSk7CiAgICB9CiAgICByZXR1cm4gewogICAgICBzdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKGlzQW5pbWF0aW5nID09PSB0cnVlKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChhbmltYXRpb25Mb29wID09PSBudWxsKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHJlcXVlc3RJZCA9IGNvbnRleHQucmVxdWVzdEFuaW1hdGlvbkZyYW1lKG9uQW5pbWF0aW9uRnJhbWUpOwogICAgICAgIGlzQW5pbWF0aW5nID0gdHJ1ZTsKICAgICAgfSwKICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29udGV4dC5jYW5jZWxBbmltYXRpb25GcmFtZShyZXF1ZXN0SWQpOwogICAgICAgIGlzQW5pbWF0aW5nID0gZmFsc2U7CiAgICAgIH0sCiAgICAgIHNldEFuaW1hdGlvbkxvb3A6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICAgICAgYW5pbWF0aW9uTG9vcCA9IGNhbGxiYWNrOwogICAgICB9LAogICAgICBzZXRDb250ZXh0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnRleHQgPSB2YWx1ZTsKICAgICAgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gV2ViR0xBdHRyaWJ1dGVzKGdsLCBjYXBhYmlsaXRpZXMpIHsKICAgIGNvbnN0IGlzV2ViR0wyID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyOwogICAgY29uc3QgYnVmZmVycyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpOwogICAgZnVuY3Rpb24gY3JlYXRlQnVmZmVyKGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSkgewogICAgICBjb25zdCBhcnJheSA9IGF0dHJpYnV0ZS5hcnJheTsKICAgICAgY29uc3QgdXNhZ2UgPSBhdHRyaWJ1dGUudXNhZ2U7CiAgICAgIGNvbnN0IGJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpOwogICAgICBnbC5iaW5kQnVmZmVyKGJ1ZmZlclR5cGUsIGJ1ZmZlcik7CiAgICAgIGdsLmJ1ZmZlckRhdGEoYnVmZmVyVHlwZSwgYXJyYXksIHVzYWdlKTsKICAgICAgYXR0cmlidXRlLm9uVXBsb2FkQ2FsbGJhY2soKTsKICAgICAgbGV0IHR5cGUgPSA1MTI2OwogICAgICBpZiAoYXJyYXkgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkpIHsKICAgICAgICB0eXBlID0gNTEyNjsKICAgICAgfSBlbHNlIGlmIChhcnJheSBpbnN0YW5jZW9mIEZsb2F0NjRBcnJheSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xBdHRyaWJ1dGVzOiBVbnN1cHBvcnRlZCBkYXRhIGJ1ZmZlciBmb3JtYXQ6IEZsb2F0NjRBcnJheS4iKTsKICAgICAgfSBlbHNlIGlmIChhcnJheSBpbnN0YW5jZW9mIFVpbnQxNkFycmF5KSB7CiAgICAgICAgaWYgKGF0dHJpYnV0ZS5pc0Zsb2F0MTZCdWZmZXJBdHRyaWJ1dGUpIHsKICAgICAgICAgIGlmIChpc1dlYkdMMikgewogICAgICAgICAgICB0eXBlID0gNTEzMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xBdHRyaWJ1dGVzOiBVc2FnZSBvZiBGbG9hdDE2QnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIFdlYkdMMi4iKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdHlwZSA9IDUxMjM7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGFycmF5IGluc3RhbmNlb2YgSW50MTZBcnJheSkgewogICAgICAgIHR5cGUgPSA1MTIyOwogICAgICB9IGVsc2UgaWYgKGFycmF5IGluc3RhbmNlb2YgVWludDMyQXJyYXkpIHsKICAgICAgICB0eXBlID0gNTEyNTsKICAgICAgfSBlbHNlIGlmIChhcnJheSBpbnN0YW5jZW9mIEludDMyQXJyYXkpIHsKICAgICAgICB0eXBlID0gNTEyNDsKICAgICAgfSBlbHNlIGlmIChhcnJheSBpbnN0YW5jZW9mIEludDhBcnJheSkgewogICAgICAgIHR5cGUgPSA1MTIwOwogICAgICB9IGVsc2UgaWYgKGFycmF5IGluc3RhbmNlb2YgVWludDhBcnJheSkgewogICAgICAgIHR5cGUgPSA1MTIxOwogICAgICB9IGVsc2UgaWYgKGFycmF5IGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXkpIHsKICAgICAgICB0eXBlID0gNTEyMTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIGJ1ZmZlciwKICAgICAgICB0eXBlLAogICAgICAgIGJ5dGVzUGVyRWxlbWVudDogYXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCiAgICAgICAgdmVyc2lvbjogYXR0cmlidXRlLnZlcnNpb24KICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZUJ1ZmZlcihidWZmZXIsIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSkgewogICAgICBjb25zdCBhcnJheSA9IGF0dHJpYnV0ZS5hcnJheTsKICAgICAgY29uc3QgdXBkYXRlUmFuZ2UgPSBhdHRyaWJ1dGUudXBkYXRlUmFuZ2U7CiAgICAgIGdsLmJpbmRCdWZmZXIoYnVmZmVyVHlwZSwgYnVmZmVyKTsKICAgICAgaWYgKHVwZGF0ZVJhbmdlLmNvdW50ID09PSAtMSkgewogICAgICAgIGdsLmJ1ZmZlclN1YkRhdGEoYnVmZmVyVHlwZSwgMCwgYXJyYXkpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChpc1dlYkdMMikgewogICAgICAgICAgZ2wuYnVmZmVyU3ViRGF0YShidWZmZXJUeXBlLCB1cGRhdGVSYW5nZS5vZmZzZXQgKiBhcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgYXJyYXksIHVwZGF0ZVJhbmdlLm9mZnNldCwgdXBkYXRlUmFuZ2UuY291bnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBnbC5idWZmZXJTdWJEYXRhKGJ1ZmZlclR5cGUsIHVwZGF0ZVJhbmdlLm9mZnNldCAqIGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBhcnJheS5zdWJhcnJheSh1cGRhdGVSYW5nZS5vZmZzZXQsIHVwZGF0ZVJhbmdlLm9mZnNldCArIHVwZGF0ZVJhbmdlLmNvdW50KSk7CiAgICAgICAgfQogICAgICAgIHVwZGF0ZVJhbmdlLmNvdW50ID0gLTE7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGdldChhdHRyaWJ1dGUpIHsKICAgICAgaWYgKGF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKQogICAgICAgIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5kYXRhOwogICAgICByZXR1cm4gYnVmZmVycy5nZXQoYXR0cmlidXRlKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlbW92ZShhdHRyaWJ1dGUpIHsKICAgICAgaWYgKGF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKQogICAgICAgIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5kYXRhOwogICAgICBjb25zdCBkYXRhID0gYnVmZmVycy5nZXQoYXR0cmlidXRlKTsKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICBnbC5kZWxldGVCdWZmZXIoZGF0YS5idWZmZXIpOwogICAgICAgIGJ1ZmZlcnMuZGVsZXRlKGF0dHJpYnV0ZSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZShhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUpIHsKICAgICAgaWYgKGF0dHJpYnV0ZS5pc0dMQnVmZmVyQXR0cmlidXRlKSB7CiAgICAgICAgY29uc3QgY2FjaGVkID0gYnVmZmVycy5nZXQoYXR0cmlidXRlKTsKICAgICAgICBpZiAoIWNhY2hlZCB8fCBjYWNoZWQudmVyc2lvbiA8IGF0dHJpYnV0ZS52ZXJzaW9uKSB7CiAgICAgICAgICBidWZmZXJzLnNldChhdHRyaWJ1dGUsIHsKICAgICAgICAgICAgYnVmZmVyOiBhdHRyaWJ1dGUuYnVmZmVyLAogICAgICAgICAgICB0eXBlOiBhdHRyaWJ1dGUudHlwZSwKICAgICAgICAgICAgYnl0ZXNQZXJFbGVtZW50OiBhdHRyaWJ1dGUuZWxlbWVudFNpemUsCiAgICAgICAgICAgIHZlcnNpb246IGF0dHJpYnV0ZS52ZXJzaW9uCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSkKICAgICAgICBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKICAgICAgY29uc3QgZGF0YSA9IGJ1ZmZlcnMuZ2V0KGF0dHJpYnV0ZSk7CiAgICAgIGlmIChkYXRhID09PSB2b2lkIDApIHsKICAgICAgICBidWZmZXJzLnNldChhdHRyaWJ1dGUsIGNyZWF0ZUJ1ZmZlcihhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUpKTsKICAgICAgfSBlbHNlIGlmIChkYXRhLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbikgewogICAgICAgIHVwZGF0ZUJ1ZmZlcihkYXRhLmJ1ZmZlciwgYXR0cmlidXRlLCBidWZmZXJUeXBlKTsKICAgICAgICBkYXRhLnZlcnNpb24gPSBhdHRyaWJ1dGUudmVyc2lvbjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgZ2V0LAogICAgICByZW1vdmUsCiAgICAgIHVwZGF0ZQogICAgfTsKICB9CiAgdmFyIFBsYW5lR2VvbWV0cnkgPSBjbGFzcyBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKICAgIGNvbnN0cnVjdG9yKHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgd2lkdGhTZWdtZW50cyA9IDEsIGhlaWdodFNlZ21lbnRzID0gMSkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiUGxhbmVHZW9tZXRyeSI7CiAgICAgIHRoaXMucGFyYW1ldGVycyA9IHsKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgd2lkdGhTZWdtZW50cywKICAgICAgICBoZWlnaHRTZWdtZW50cwogICAgICB9OwogICAgICBjb25zdCB3aWR0aF9oYWxmID0gd2lkdGggLyAyOwogICAgICBjb25zdCBoZWlnaHRfaGFsZiA9IGhlaWdodCAvIDI7CiAgICAgIGNvbnN0IGdyaWRYID0gTWF0aC5mbG9vcih3aWR0aFNlZ21lbnRzKTsKICAgICAgY29uc3QgZ3JpZFkgPSBNYXRoLmZsb29yKGhlaWdodFNlZ21lbnRzKTsKICAgICAgY29uc3QgZ3JpZFgxID0gZ3JpZFggKyAxOwogICAgICBjb25zdCBncmlkWTEgPSBncmlkWSArIDE7CiAgICAgIGNvbnN0IHNlZ21lbnRfd2lkdGggPSB3aWR0aCAvIGdyaWRYOwogICAgICBjb25zdCBzZWdtZW50X2hlaWdodCA9IGhlaWdodCAvIGdyaWRZOwogICAgICBjb25zdCBpbmRpY2VzID0gW107CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IG5vcm1hbHMgPSBbXTsKICAgICAgY29uc3QgdXZzID0gW107CiAgICAgIGZvciAobGV0IGl5ID0gMDsgaXkgPCBncmlkWTE7IGl5KyspIHsKICAgICAgICBjb25zdCB5ID0gaXkgKiBzZWdtZW50X2hlaWdodCAtIGhlaWdodF9oYWxmOwogICAgICAgIGZvciAobGV0IGl4ID0gMDsgaXggPCBncmlkWDE7IGl4KyspIHsKICAgICAgICAgIGNvbnN0IHggPSBpeCAqIHNlZ21lbnRfd2lkdGggLSB3aWR0aF9oYWxmOwogICAgICAgICAgdmVydGljZXMucHVzaCh4LCAteSwgMCk7CiAgICAgICAgICBub3JtYWxzLnB1c2goMCwgMCwgMSk7CiAgICAgICAgICB1dnMucHVzaChpeCAvIGdyaWRYKTsKICAgICAgICAgIHV2cy5wdXNoKDEgLSBpeSAvIGdyaWRZKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChsZXQgaXkgPSAwOyBpeSA8IGdyaWRZOyBpeSsrKSB7CiAgICAgICAgZm9yIChsZXQgaXggPSAwOyBpeCA8IGdyaWRYOyBpeCsrKSB7CiAgICAgICAgICBjb25zdCBhID0gaXggKyBncmlkWDEgKiBpeTsKICAgICAgICAgIGNvbnN0IGIgPSBpeCArIGdyaWRYMSAqIChpeSArIDEpOwogICAgICAgICAgY29uc3QgYyA9IGl4ICsgMSArIGdyaWRYMSAqIChpeSArIDEpOwogICAgICAgICAgY29uc3QgZCA9IGl4ICsgMSArIGdyaWRYMSAqIGl5OwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnNldEluZGV4KGluZGljZXMpOwogICAgICB0aGlzLnNldEF0dHJpYnV0ZSgicG9zaXRpb24iLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSh2ZXJ0aWNlcywgMykpOwogICAgICB0aGlzLnNldEF0dHJpYnV0ZSgibm9ybWFsIiwgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUobm9ybWFscywgMykpOwogICAgICB0aGlzLnNldEF0dHJpYnV0ZSgidXYiLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSh1dnMsIDIpKTsKICAgIH0KICAgIHN0YXRpYyBmcm9tSlNPTihkYXRhKSB7CiAgICAgIHJldHVybiBuZXcgUGxhbmVHZW9tZXRyeShkYXRhLndpZHRoLCBkYXRhLmhlaWdodCwgZGF0YS53aWR0aFNlZ21lbnRzLCBkYXRhLmhlaWdodFNlZ21lbnRzKTsKICAgIH0KICB9OwogIHZhciBhbHBoYW1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBTUFQXG4JZGlmZnVzZUNvbG9yLmEgKj0gdGV4dHVyZTJEKCBhbHBoYU1hcCwgdlV2ICkuZztcbiNlbmRpZiI7CiAgdmFyIGFscGhhbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BTFBIQU1BUFxuCXVuaWZvcm0gc2FtcGxlcjJEIGFscGhhTWFwO1xuI2VuZGlmIjsKICB2YXIgYWxwaGF0ZXN0X2ZyYWdtZW50ID0gIiNpZmRlZiBBTFBIQVRFU1RcbglpZiAoIGRpZmZ1c2VDb2xvci5hIDwgQUxQSEFURVNUICkgZGlzY2FyZDtcbiNlbmRpZiI7CiAgdmFyIGFvbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQU9NQVBcbglmbG9hdCBhbWJpZW50T2NjbHVzaW9uID0gKCB0ZXh0dXJlMkQoIGFvTWFwLCB2VXYyICkuciAtIDEuMCApICogYW9NYXBJbnRlbnNpdHkgKyAxLjA7XG4JcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGFtYmllbnRPY2NsdXNpb247XG4JI2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSAmJiBkZWZpbmVkKCBTVEFOREFSRCApXG4JCWZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnkubm9ybWFsLCBnZW9tZXRyeS52aWV3RGlyICkgKTtcbgkJcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciAqPSBjb21wdXRlU3BlY3VsYXJPY2NsdXNpb24oIGRvdE5WLCBhbWJpZW50T2NjbHVzaW9uLCBtYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcyApO1xuCSNlbmRpZlxuI2VuZGlmIjsKICB2YXIgYW9tYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FPTUFQXG4JdW5pZm9ybSBzYW1wbGVyMkQgYW9NYXA7XG4JdW5pZm9ybSBmbG9hdCBhb01hcEludGVuc2l0eTtcbiNlbmRpZiI7CiAgdmFyIGJlZ2luX3ZlcnRleCA9ICJ2ZWMzIHRyYW5zZm9ybWVkID0gdmVjMyggcG9zaXRpb24gKTsiOwogIHZhciBiZWdpbm5vcm1hbF92ZXJ0ZXggPSAidmVjMyBvYmplY3ROb3JtYWwgPSB2ZWMzKCBub3JtYWwgKTtcbiNpZmRlZiBVU0VfVEFOR0VOVFxuCXZlYzMgb2JqZWN0VGFuZ2VudCA9IHZlYzMoIHRhbmdlbnQueHl6ICk7XG4jZW5kaWYiOwogIHZhciBic2RmcyA9ICJ2ZWMyIGludGVncmF0ZVNwZWN1bGFyQlJERiggY29uc3QgaW4gZmxvYXQgZG90TlYsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcbgljb25zdCB2ZWM0IGMwID0gdmVjNCggLSAxLCAtIDAuMDI3NSwgLSAwLjU3MiwgMC4wMjIgKTtcbgljb25zdCB2ZWM0IGMxID0gdmVjNCggMSwgMC4wNDI1LCAxLjA0LCAtIDAuMDQgKTtcbgl2ZWM0IHIgPSByb3VnaG5lc3MgKiBjMCArIGMxO1xuCWZsb2F0IGEwMDQgPSBtaW4oIHIueCAqIHIueCwgZXhwMiggLSA5LjI4ICogZG90TlYgKSApICogci54ICsgci55O1xuCXJldHVybiB2ZWMyKCAtMS4wNCwgMS4wNCApICogYTAwNCArIHIuenc7XG59XG5mbG9hdCBwdW5jdHVhbExpZ2h0SW50ZW5zaXR5VG9JcnJhZGlhbmNlRmFjdG9yKCBjb25zdCBpbiBmbG9hdCBsaWdodERpc3RhbmNlLCBjb25zdCBpbiBmbG9hdCBjdXRvZmZEaXN0YW5jZSwgY29uc3QgaW4gZmxvYXQgZGVjYXlFeHBvbmVudCApIHtcbiNpZiBkZWZpbmVkICggUEhZU0lDQUxMWV9DT1JSRUNUX0xJR0hUUyApXG4JZmxvYXQgZGlzdGFuY2VGYWxsb2ZmID0gMS4wIC8gbWF4KCBwb3coIGxpZ2h0RGlzdGFuY2UsIGRlY2F5RXhwb25lbnQgKSwgMC4wMSApO1xuCWlmKCBjdXRvZmZEaXN0YW5jZSA+IDAuMCApIHtcbgkJZGlzdGFuY2VGYWxsb2ZmICo9IHBvdzIoIHNhdHVyYXRlKCAxLjAgLSBwb3c0KCBsaWdodERpc3RhbmNlIC8gY3V0b2ZmRGlzdGFuY2UgKSApICk7XG4JfVxuCXJldHVybiBkaXN0YW5jZUZhbGxvZmY7XG4jZWxzZVxuCWlmKCBjdXRvZmZEaXN0YW5jZSA+IDAuMCAmJiBkZWNheUV4cG9uZW50ID4gMC4wICkge1xuCQlyZXR1cm4gcG93KCBzYXR1cmF0ZSggLWxpZ2h0RGlzdGFuY2UgLyBjdXRvZmZEaXN0YW5jZSArIDEuMCApLCBkZWNheUV4cG9uZW50ICk7XG4JfVxuCXJldHVybiAxLjA7XG4jZW5kaWZcbn1cbnZlYzMgQlJERl9EaWZmdXNlX0xhbWJlcnQoIGNvbnN0IGluIHZlYzMgZGlmZnVzZUNvbG9yICkge1xuCXJldHVybiBSRUNJUFJPQ0FMX1BJICogZGlmZnVzZUNvbG9yO1xufVxudmVjMyBGX1NjaGxpY2soIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgZG90VkggKSB7XG4JZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLTUuNTU0NzMgKiBkb3RWSCAtIDYuOTgzMTYgKSAqIGRvdFZIICk7XG4JcmV0dXJuICggMS4wIC0gc3BlY3VsYXJDb2xvciApICogZnJlc25lbCArIHNwZWN1bGFyQ29sb3I7XG59XG52ZWMzIEZfU2NobGlja19Sb3VnaG5lc3NEZXBlbmRlbnQoIGNvbnN0IGluIHZlYzMgRjAsIGNvbnN0IGluIGZsb2F0IGRvdE5WLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG4JZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLTUuNTU0NzMgKiBkb3ROViAtIDYuOTgzMTYgKSAqIGRvdE5WICk7XG4JdmVjMyBGciA9IG1heCggdmVjMyggMS4wIC0gcm91Z2huZXNzICksIEYwICkgLSBGMDtcbglyZXR1cm4gRnIgKiBmcmVzbmVsICsgRjA7XG59XG5mbG9hdCBHX0dHWF9TbWl0aCggY29uc3QgaW4gZmxvYXQgYWxwaGEsIGNvbnN0IGluIGZsb2F0IGRvdE5MLCBjb25zdCBpbiBmbG9hdCBkb3ROViApIHtcbglmbG9hdCBhMiA9IHBvdzIoIGFscGhhICk7XG4JZmxvYXQgZ2wgPSBkb3ROTCArIHNxcnQoIGEyICsgKCAxLjAgLSBhMiApICogcG93MiggZG90TkwgKSApO1xuCWZsb2F0IGd2ID0gZG90TlYgKyBzcXJ0KCBhMiArICggMS4wIC0gYTIgKSAqIHBvdzIoIGRvdE5WICkgKTtcbglyZXR1cm4gMS4wIC8gKCBnbCAqIGd2ICk7XG59XG5mbG9hdCBHX0dHWF9TbWl0aENvcnJlbGF0ZWQoIGNvbnN0IGluIGZsb2F0IGFscGhhLCBjb25zdCBpbiBmbG9hdCBkb3ROTCwgY29uc3QgaW4gZmxvYXQgZG90TlYgKSB7XG4JZmxvYXQgYTIgPSBwb3cyKCBhbHBoYSApO1xuCWZsb2F0IGd2ID0gZG90TkwgKiBzcXJ0KCBhMiArICggMS4wIC0gYTIgKSAqIHBvdzIoIGRvdE5WICkgKTtcbglmbG9hdCBnbCA9IGRvdE5WICogc3FydCggYTIgKyAoIDEuMCAtIGEyICkgKiBwb3cyKCBkb3ROTCApICk7XG4JcmV0dXJuIDAuNSAvIG1heCggZ3YgKyBnbCwgRVBTSUxPTiApO1xufVxuZmxvYXQgRF9HR1goIGNvbnN0IGluIGZsb2F0IGFscGhhLCBjb25zdCBpbiBmbG9hdCBkb3ROSCApIHtcbglmbG9hdCBhMiA9IHBvdzIoIGFscGhhICk7XG4JZmxvYXQgZGVub20gPSBwb3cyKCBkb3ROSCApICogKCBhMiAtIDEuMCApICsgMS4wO1xuCXJldHVybiBSRUNJUFJPQ0FMX1BJICogYTIgLyBwb3cyKCBkZW5vbSApO1xufVxudmVjMyBCUkRGX1NwZWN1bGFyX0dHWCggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBpbmNpZGVudExpZ2h0LCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHNwZWN1bGFyQ29sb3IsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcbglmbG9hdCBhbHBoYSA9IHBvdzIoIHJvdWdobmVzcyApO1xuCXZlYzMgaGFsZkRpciA9IG5vcm1hbGl6ZSggaW5jaWRlbnRMaWdodC5kaXJlY3Rpb24gKyB2aWV3RGlyICk7XG4JZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGluY2lkZW50TGlnaHQuZGlyZWN0aW9uICkgKTtcbglmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgdmlld0RpciApICk7XG4JZmxvYXQgZG90TkggPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGhhbGZEaXIgKSApO1xuCWZsb2F0IGRvdExIID0gc2F0dXJhdGUoIGRvdCggaW5jaWRlbnRMaWdodC5kaXJlY3Rpb24sIGhhbGZEaXIgKSApO1xuCXZlYzMgRiA9IEZfU2NobGljayggc3BlY3VsYXJDb2xvciwgZG90TEggKTtcbglmbG9hdCBHID0gR19HR1hfU21pdGhDb3JyZWxhdGVkKCBhbHBoYSwgZG90TkwsIGRvdE5WICk7XG4JZmxvYXQgRCA9IERfR0dYKCBhbHBoYSwgZG90TkggKTtcbglyZXR1cm4gRiAqICggRyAqIEQgKTtcbn1cbnZlYzIgTFRDX1V2KCBjb25zdCBpbiB2ZWMzIE4sIGNvbnN0IGluIHZlYzMgViwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuCWNvbnN0IGZsb2F0IExVVF9TSVpFID0gNjQuMDtcbgljb25zdCBmbG9hdCBMVVRfU0NBTEUgPSAoIExVVF9TSVpFIC0gMS4wICkgLyBMVVRfU0laRTtcbgljb25zdCBmbG9hdCBMVVRfQklBUyA9IDAuNSAvIExVVF9TSVpFO1xuCWZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggTiwgViApICk7XG4JdmVjMiB1diA9IHZlYzIoIHJvdWdobmVzcywgc3FydCggMS4wIC0gZG90TlYgKSApO1xuCXV2ID0gdXYgKiBMVVRfU0NBTEUgKyBMVVRfQklBUztcbglyZXR1cm4gdXY7XG59XG5mbG9hdCBMVENfQ2xpcHBlZFNwaGVyZUZvcm1GYWN0b3IoIGNvbnN0IGluIHZlYzMgZiApIHtcbglmbG9hdCBsID0gbGVuZ3RoKCBmICk7XG4JcmV0dXJuIG1heCggKCBsICogbCArIGYueiApIC8gKCBsICsgMS4wICksIDAuMCApO1xufVxudmVjMyBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvbnN0IGluIHZlYzMgdjEsIGNvbnN0IGluIHZlYzMgdjIgKSB7XG4JZmxvYXQgeCA9IGRvdCggdjEsIHYyICk7XG4JZmxvYXQgeSA9IGFicyggeCApO1xuCWZsb2F0IGEgPSAwLjg1NDM5ODUgKyAoIDAuNDk2NTE1NSArIDAuMDE0NTIwNiAqIHkgKSAqIHk7XG4JZmxvYXQgYiA9IDMuNDE3NTk0MCArICggNC4xNjE2NzI0ICsgeSApICogeTtcbglmbG9hdCB2ID0gYSAvIGI7XG4JZmxvYXQgdGhldGFfc2ludGhldGEgPSAoIHggPiAwLjAgKSA/IHYgOiAwLjUgKiBpbnZlcnNlc3FydCggbWF4KCAxLjAgLSB4ICogeCwgMWUtNyApICkgLSB2O1xuCXJldHVybiBjcm9zcyggdjEsIHYyICkgKiB0aGV0YV9zaW50aGV0YTtcbn1cbnZlYzMgTFRDX0V2YWx1YXRlKCBjb25zdCBpbiB2ZWMzIE4sIGNvbnN0IGluIHZlYzMgViwgY29uc3QgaW4gdmVjMyBQLCBjb25zdCBpbiBtYXQzIG1JbnYsIGNvbnN0IGluIHZlYzMgcmVjdENvb3Jkc1sgNCBdICkge1xuCXZlYzMgdjEgPSByZWN0Q29vcmRzWyAxIF0gLSByZWN0Q29vcmRzWyAwIF07XG4JdmVjMyB2MiA9IHJlY3RDb29yZHNbIDMgXSAtIHJlY3RDb29yZHNbIDAgXTtcbgl2ZWMzIGxpZ2h0Tm9ybWFsID0gY3Jvc3MoIHYxLCB2MiApO1xuCWlmKCBkb3QoIGxpZ2h0Tm9ybWFsLCBQIC0gcmVjdENvb3Jkc1sgMCBdICkgPCAwLjAgKSByZXR1cm4gdmVjMyggMC4wICk7XG4JdmVjMyBUMSwgVDI7XG4JVDEgPSBub3JtYWxpemUoIFYgLSBOICogZG90KCBWLCBOICkgKTtcbglUMiA9IC0gY3Jvc3MoIE4sIFQxICk7XG4JbWF0MyBtYXQgPSBtSW52ICogdHJhbnNwb3NlTWF0MyggbWF0MyggVDEsIFQyLCBOICkgKTtcbgl2ZWMzIGNvb3Jkc1sgNCBdO1xuCWNvb3Jkc1sgMCBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAwIF0gLSBQICk7XG4JY29vcmRzWyAxIF0gPSBtYXQgKiAoIHJlY3RDb29yZHNbIDEgXSAtIFAgKTtcbgljb29yZHNbIDIgXSA9IG1hdCAqICggcmVjdENvb3Jkc1sgMiBdIC0gUCApO1xuCWNvb3Jkc1sgMyBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAzIF0gLSBQICk7XG4JY29vcmRzWyAwIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMCBdICk7XG4JY29vcmRzWyAxIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMSBdICk7XG4JY29vcmRzWyAyIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMiBdICk7XG4JY29vcmRzWyAzIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMyBdICk7XG4JdmVjMyB2ZWN0b3JGb3JtRmFjdG9yID0gdmVjMyggMC4wICk7XG4JdmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMCBdLCBjb29yZHNbIDEgXSApO1xuCXZlY3RvckZvcm1GYWN0b3IgKz0gTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb29yZHNbIDEgXSwgY29vcmRzWyAyIF0gKTtcbgl2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAyIF0sIGNvb3Jkc1sgMyBdICk7XG4JdmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMyBdLCBjb29yZHNbIDAgXSApO1xuCWZsb2F0IHJlc3VsdCA9IExUQ19DbGlwcGVkU3BoZXJlRm9ybUZhY3RvciggdmVjdG9yRm9ybUZhY3RvciApO1xuCXJldHVybiB2ZWMzKCByZXN1bHQgKTtcbn1cbnZlYzMgQlJERl9TcGVjdWxhcl9HR1hfRW52aXJvbm1lbnQoIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuCWZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcbgl2ZWMyIGJyZGYgPSBpbnRlZ3JhdGVTcGVjdWxhckJSREYoIGRvdE5WLCByb3VnaG5lc3MgKTtcbglyZXR1cm4gc3BlY3VsYXJDb2xvciAqIGJyZGYueCArIGJyZGYueTtcbn1cbnZvaWQgQlJERl9TcGVjdWxhcl9NdWx0aXNjYXR0ZXJpbmdfRW52aXJvbm1lbnQoIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBpbm91dCB2ZWMzIHNpbmdsZVNjYXR0ZXIsIGlub3V0IHZlYzMgbXVsdGlTY2F0dGVyICkge1xuCWZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnkubm9ybWFsLCBnZW9tZXRyeS52aWV3RGlyICkgKTtcbgl2ZWMzIEYgPSBGX1NjaGxpY2tfUm91Z2huZXNzRGVwZW5kZW50KCBzcGVjdWxhckNvbG9yLCBkb3ROViwgcm91Z2huZXNzICk7XG4JdmVjMiBicmRmID0gaW50ZWdyYXRlU3BlY3VsYXJCUkRGKCBkb3ROViwgcm91Z2huZXNzICk7XG4JdmVjMyBGc3NFc3MgPSBGICogYnJkZi54ICsgYnJkZi55O1xuCWZsb2F0IEVzcyA9IGJyZGYueCArIGJyZGYueTtcbglmbG9hdCBFbXMgPSAxLjAgLSBFc3M7XG4JdmVjMyBGYXZnID0gc3BlY3VsYXJDb2xvciArICggMS4wIC0gc3BlY3VsYXJDb2xvciApICogMC4wNDc2MTk7CXZlYzMgRm1zID0gRnNzRXNzICogRmF2ZyAvICggMS4wIC0gRW1zICogRmF2ZyApO1xuCXNpbmdsZVNjYXR0ZXIgKz0gRnNzRXNzO1xuCW11bHRpU2NhdHRlciArPSBGbXMgKiBFbXM7XG59XG5mbG9hdCBHX0JsaW5uUGhvbmdfSW1wbGljaXQoICkge1xuCXJldHVybiAwLjI1O1xufVxuZmxvYXQgRF9CbGlublBob25nKCBjb25zdCBpbiBmbG9hdCBzaGluaW5lc3MsIGNvbnN0IGluIGZsb2F0IGRvdE5IICkge1xuCXJldHVybiBSRUNJUFJPQ0FMX1BJICogKCBzaGluaW5lc3MgKiAwLjUgKyAxLjAgKSAqIHBvdyggZG90TkgsIHNoaW5pbmVzcyApO1xufVxudmVjMyBCUkRGX1NwZWN1bGFyX0JsaW5uUGhvbmcoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgaW5jaWRlbnRMaWdodCwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCBzaGluaW5lc3MgKSB7XG4JdmVjMyBoYWxmRGlyID0gbm9ybWFsaXplKCBpbmNpZGVudExpZ2h0LmRpcmVjdGlvbiArIGdlb21ldHJ5LnZpZXdEaXIgKTtcbglmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgaGFsZkRpciApICk7XG4JZmxvYXQgZG90TEggPSBzYXR1cmF0ZSggZG90KCBpbmNpZGVudExpZ2h0LmRpcmVjdGlvbiwgaGFsZkRpciApICk7XG4JdmVjMyBGID0gRl9TY2hsaWNrKCBzcGVjdWxhckNvbG9yLCBkb3RMSCApO1xuCWZsb2F0IEcgPSBHX0JsaW5uUGhvbmdfSW1wbGljaXQoICk7XG4JZmxvYXQgRCA9IERfQmxpbm5QaG9uZyggc2hpbmluZXNzLCBkb3ROSCApO1xuCXJldHVybiBGICogKCBHICogRCApO1xufVxuZmxvYXQgR0dYUm91Z2huZXNzVG9CbGlubkV4cG9uZW50KCBjb25zdCBpbiBmbG9hdCBnZ3hSb3VnaG5lc3MgKSB7XG4JcmV0dXJuICggMi4wIC8gcG93MiggZ2d4Um91Z2huZXNzICsgMC4wMDAxICkgLSAyLjAgKTtcbn1cbmZsb2F0IEJsaW5uRXhwb25lbnRUb0dHWFJvdWdobmVzcyggY29uc3QgaW4gZmxvYXQgYmxpbm5FeHBvbmVudCApIHtcbglyZXR1cm4gc3FydCggMi4wIC8gKCBibGlubkV4cG9uZW50ICsgMi4wICkgKTtcbn1cbiNpZiBkZWZpbmVkKCBVU0VfU0hFRU4gKVxuZmxvYXQgRF9DaGFybGllKGZsb2F0IHJvdWdobmVzcywgZmxvYXQgTm9IKSB7XG4JZmxvYXQgaW52QWxwaGEgPSAxLjAgLyByb3VnaG5lc3M7XG4JZmxvYXQgY29zMmggPSBOb0ggKiBOb0g7XG4JZmxvYXQgc2luMmggPSBtYXgoMS4wIC0gY29zMmgsIDAuMDA3ODEyNSk7CXJldHVybiAoMi4wICsgaW52QWxwaGEpICogcG93KHNpbjJoLCBpbnZBbHBoYSAqIDAuNSkgLyAoMi4wICogUEkpO1xufVxuZmxvYXQgVl9OZXViZWx0KGZsb2F0IE5vViwgZmxvYXQgTm9MKSB7XG4JcmV0dXJuIHNhdHVyYXRlKDEuMCAvICg0LjAgKiAoTm9MICsgTm9WIC0gTm9MICogTm9WKSkpO1xufVxudmVjMyBCUkRGX1NwZWN1bGFyX1NoZWVuKCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGNvbnN0IGluIHZlYzMgTCwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgdmVjMyBzcGVjdWxhckNvbG9yICkge1xuCXZlYzMgTiA9IGdlb21ldHJ5Lm5vcm1hbDtcbgl2ZWMzIFYgPSBnZW9tZXRyeS52aWV3RGlyO1xuCXZlYzMgSCA9IG5vcm1hbGl6ZSggViArIEwgKTtcbglmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIE4sIEggKSApO1xuCXJldHVybiBzcGVjdWxhckNvbG9yICogRF9DaGFybGllKCByb3VnaG5lc3MsIGRvdE5IICkgKiBWX05ldWJlbHQoIGRvdChOLCBWKSwgZG90KE4sIEwpICk7XG59XG4jZW5kaWYiOwogIHZhciBidW1wbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9CVU1QTUFQXG4JdW5pZm9ybSBzYW1wbGVyMkQgYnVtcE1hcDtcbgl1bmlmb3JtIGZsb2F0IGJ1bXBTY2FsZTtcbgl2ZWMyIGRIZHh5X2Z3ZCgpIHtcbgkJdmVjMiBkU1RkeCA9IGRGZHgoIHZVdiApO1xuCQl2ZWMyIGRTVGR5ID0gZEZkeSggdlV2ICk7XG4JCWZsb2F0IEhsbCA9IGJ1bXBTY2FsZSAqIHRleHR1cmUyRCggYnVtcE1hcCwgdlV2ICkueDtcbgkJZmxvYXQgZEJ4ID0gYnVtcFNjYWxlICogdGV4dHVyZTJEKCBidW1wTWFwLCB2VXYgKyBkU1RkeCApLnggLSBIbGw7XG4JCWZsb2F0IGRCeSA9IGJ1bXBTY2FsZSAqIHRleHR1cmUyRCggYnVtcE1hcCwgdlV2ICsgZFNUZHkgKS54IC0gSGxsO1xuCQlyZXR1cm4gdmVjMiggZEJ4LCBkQnkgKTtcbgl9XG4JdmVjMyBwZXJ0dXJiTm9ybWFsQXJiKCB2ZWMzIHN1cmZfcG9zLCB2ZWMzIHN1cmZfbm9ybSwgdmVjMiBkSGR4eSwgZmxvYXQgZmFjZURpcmVjdGlvbiApIHtcbgkJdmVjMyB2U2lnbWFYID0gdmVjMyggZEZkeCggc3VyZl9wb3MueCApLCBkRmR4KCBzdXJmX3Bvcy55ICksIGRGZHgoIHN1cmZfcG9zLnogKSApO1xuCQl2ZWMzIHZTaWdtYVkgPSB2ZWMzKCBkRmR5KCBzdXJmX3Bvcy54ICksIGRGZHkoIHN1cmZfcG9zLnkgKSwgZEZkeSggc3VyZl9wb3MueiApICk7XG4JCXZlYzMgdk4gPSBzdXJmX25vcm07XG4JCXZlYzMgUjEgPSBjcm9zcyggdlNpZ21hWSwgdk4gKTtcbgkJdmVjMyBSMiA9IGNyb3NzKCB2TiwgdlNpZ21hWCApO1xuCQlmbG9hdCBmRGV0ID0gZG90KCB2U2lnbWFYLCBSMSApICogZmFjZURpcmVjdGlvbjtcbgkJdmVjMyB2R3JhZCA9IHNpZ24oIGZEZXQgKSAqICggZEhkeHkueCAqIFIxICsgZEhkeHkueSAqIFIyICk7XG4JCXJldHVybiBub3JtYWxpemUoIGFicyggZkRldCApICogc3VyZl9ub3JtIC0gdkdyYWQgKTtcbgl9XG4jZW5kaWYiOwogIHZhciBjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQgPSAiI2lmIE5VTV9DTElQUElOR19QTEFORVMgPiAwXG4JdmVjNCBwbGFuZTtcbgkjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG4JZm9yICggaW50IGkgPSAwOyBpIDwgVU5JT05fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuCQlwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG4JCWlmICggZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSBkaXNjYXJkO1xuCX1cbgkjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuCSNpZiBVTklPTl9DTElQUElOR19QTEFORVMgPCBOVU1fQ0xJUFBJTkdfUExBTkVTXG4JCWJvb2wgY2xpcHBlZCA9IHRydWU7XG4JCSNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcbgkJZm9yICggaW50IGkgPSBVTklPTl9DTElQUElOR19QTEFORVM7IGkgPCBOVU1fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuCQkJcGxhbmUgPSBjbGlwcGluZ1BsYW5lc1sgaSBdO1xuCQkJY2xpcHBlZCA9ICggZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSAmJiBjbGlwcGVkO1xuCQl9XG4JCSNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4JCWlmICggY2xpcHBlZCApIGRpc2NhcmQ7XG4JI2VuZGlmXG4jZW5kaWYiOwogIHZhciBjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcbgl2YXJ5aW5nIHZlYzMgdkNsaXBQb3NpdGlvbjtcbgl1bmlmb3JtIHZlYzQgY2xpcHBpbmdQbGFuZXNbIE5VTV9DTElQUElOR19QTEFORVMgXTtcbiNlbmRpZiI7CiAgdmFyIGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcbgl2YXJ5aW5nIHZlYzMgdkNsaXBQb3NpdGlvbjtcbiNlbmRpZiI7CiAgdmFyIGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXggPSAiI2lmIE5VTV9DTElQUElOR19QTEFORVMgPiAwXG4JdkNsaXBQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4jZW5kaWYiOwogIHZhciBjb2xvcl9mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcbglkaWZmdXNlQ29sb3IgKj0gdkNvbG9yO1xuI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SIClcbglkaWZmdXNlQ29sb3IucmdiICo9IHZDb2xvcjtcbiNlbmRpZiI7CiAgdmFyIGNvbG9yX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9DT0xPUl9BTFBIQSApXG4JdmFyeWluZyB2ZWM0IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG4JdmFyeWluZyB2ZWMzIHZDb2xvcjtcbiNlbmRpZiI7CiAgdmFyIGNvbG9yX3BhcnNfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuCXZhcnlpbmcgdmVjNCB2Q29sb3I7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKSB8fCBkZWZpbmVkKCBVU0VfSU5TVEFOQ0lOR19DT0xPUiApXG4JdmFyeWluZyB2ZWMzIHZDb2xvcjtcbiNlbmRpZiI7CiAgdmFyIGNvbG9yX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcbgl2Q29sb3IgPSB2ZWM0KCAxLjAgKTtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9JTlNUQU5DSU5HX0NPTE9SIClcbgl2Q29sb3IgPSB2ZWMzKCAxLjAgKTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DT0xPUlxuCXZDb2xvciAqPSBjb2xvcjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JTlNUQU5DSU5HX0NPTE9SXG4JdkNvbG9yLnh5eiAqPSBpbnN0YW5jZUNvbG9yLnh5ejtcbiNlbmRpZiI7CiAgdmFyIGNvbW1vbiA9ICIjZGVmaW5lIFBJIDMuMTQxNTkyNjUzNTg5NzkzXG4jZGVmaW5lIFBJMiA2LjI4MzE4NTMwNzE3OTU4NlxuI2RlZmluZSBQSV9IQUxGIDEuNTcwNzk2MzI2Nzk0ODk2NlxuI2RlZmluZSBSRUNJUFJPQ0FMX1BJIDAuMzE4MzA5ODg2MTgzNzkwN1xuI2RlZmluZSBSRUNJUFJPQ0FMX1BJMiAwLjE1OTE1NDk0MzA5MTg5NTM1XG4jZGVmaW5lIEVQU0lMT04gMWUtNlxuI2lmbmRlZiBzYXR1cmF0ZVxuI2RlZmluZSBzYXR1cmF0ZShhKSBjbGFtcCggYSwgMC4wLCAxLjAgKVxuI2VuZGlmXG4jZGVmaW5lIHdoaXRlQ29tcGxlbWVudChhKSAoIDEuMCAtIHNhdHVyYXRlKCBhICkgKVxuZmxvYXQgcG93MiggY29uc3QgaW4gZmxvYXQgeCApIHsgcmV0dXJuIHgqeDsgfVxuZmxvYXQgcG93MyggY29uc3QgaW4gZmxvYXQgeCApIHsgcmV0dXJuIHgqeCp4OyB9XG5mbG9hdCBwb3c0KCBjb25zdCBpbiBmbG9hdCB4ICkgeyBmbG9hdCB4MiA9IHgqeDsgcmV0dXJuIHgyKngyOyB9XG5mbG9hdCBhdmVyYWdlKCBjb25zdCBpbiB2ZWMzIGNvbG9yICkgeyByZXR1cm4gZG90KCBjb2xvciwgdmVjMyggMC4zMzMzICkgKTsgfVxuaGlnaHAgZmxvYXQgcmFuZCggY29uc3QgaW4gdmVjMiB1diApIHtcbgljb25zdCBoaWdocCBmbG9hdCBhID0gMTIuOTg5OCwgYiA9IDc4LjIzMywgYyA9IDQzNzU4LjU0NTM7XG4JaGlnaHAgZmxvYXQgZHQgPSBkb3QoIHV2Lnh5LCB2ZWMyKCBhLGIgKSApLCBzbiA9IG1vZCggZHQsIFBJICk7XG4JcmV0dXJuIGZyYWN0KHNpbihzbikgKiBjKTtcbn1cbiNpZmRlZiBISUdIX1BSRUNJU0lPTlxuCWZsb2F0IHByZWNpc2lvblNhZmVMZW5ndGgoIHZlYzMgdiApIHsgcmV0dXJuIGxlbmd0aCggdiApOyB9XG4jZWxzZVxuCWZsb2F0IG1heDMoIHZlYzMgdiApIHsgcmV0dXJuIG1heCggbWF4KCB2LngsIHYueSApLCB2LnogKTsgfVxuCWZsb2F0IHByZWNpc2lvblNhZmVMZW5ndGgoIHZlYzMgdiApIHtcbgkJZmxvYXQgbWF4Q29tcG9uZW50ID0gbWF4MyggYWJzKCB2ICkgKTtcbgkJcmV0dXJuIGxlbmd0aCggdiAvIG1heENvbXBvbmVudCApICogbWF4Q29tcG9uZW50O1xuCX1cbiNlbmRpZlxuc3RydWN0IEluY2lkZW50TGlnaHQge1xuCXZlYzMgY29sb3I7XG4JdmVjMyBkaXJlY3Rpb247XG4JYm9vbCB2aXNpYmxlO1xufTtcbnN0cnVjdCBSZWZsZWN0ZWRMaWdodCB7XG4JdmVjMyBkaXJlY3REaWZmdXNlO1xuCXZlYzMgZGlyZWN0U3BlY3VsYXI7XG4JdmVjMyBpbmRpcmVjdERpZmZ1c2U7XG4JdmVjMyBpbmRpcmVjdFNwZWN1bGFyO1xufTtcbnN0cnVjdCBHZW9tZXRyaWNDb250ZXh0IHtcbgl2ZWMzIHBvc2l0aW9uO1xuCXZlYzMgbm9ybWFsO1xuCXZlYzMgdmlld0RpcjtcbiNpZmRlZiBDTEVBUkNPQVRcbgl2ZWMzIGNsZWFyY29hdE5vcm1hbDtcbiNlbmRpZlxufTtcbnZlYzMgdHJhbnNmb3JtRGlyZWN0aW9uKCBpbiB2ZWMzIGRpciwgaW4gbWF0NCBtYXRyaXggKSB7XG4JcmV0dXJuIG5vcm1hbGl6ZSggKCBtYXRyaXggKiB2ZWM0KCBkaXIsIDAuMCApICkueHl6ICk7XG59XG52ZWMzIGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHtcbglyZXR1cm4gbm9ybWFsaXplKCAoIHZlYzQoIGRpciwgMC4wICkgKiBtYXRyaXggKS54eXogKTtcbn1cbnZlYzMgcHJvamVjdE9uUGxhbmUoaW4gdmVjMyBwb2ludCwgaW4gdmVjMyBwb2ludE9uUGxhbmUsIGluIHZlYzMgcGxhbmVOb3JtYWwgKSB7XG4JZmxvYXQgZGlzdGFuY2UgPSBkb3QoIHBsYW5lTm9ybWFsLCBwb2ludCAtIHBvaW50T25QbGFuZSApO1xuCXJldHVybiAtIGRpc3RhbmNlICogcGxhbmVOb3JtYWwgKyBwb2ludDtcbn1cbmZsb2F0IHNpZGVPZlBsYW5lKCBpbiB2ZWMzIHBvaW50LCBpbiB2ZWMzIHBvaW50T25QbGFuZSwgaW4gdmVjMyBwbGFuZU5vcm1hbCApIHtcbglyZXR1cm4gc2lnbiggZG90KCBwb2ludCAtIHBvaW50T25QbGFuZSwgcGxhbmVOb3JtYWwgKSApO1xufVxudmVjMyBsaW5lUGxhbmVJbnRlcnNlY3QoIGluIHZlYzMgcG9pbnRPbkxpbmUsIGluIHZlYzMgbGluZURpcmVjdGlvbiwgaW4gdmVjMyBwb2ludE9uUGxhbmUsIGluIHZlYzMgcGxhbmVOb3JtYWwgKSB7XG4JcmV0dXJuIGxpbmVEaXJlY3Rpb24gKiAoIGRvdCggcGxhbmVOb3JtYWwsIHBvaW50T25QbGFuZSAtIHBvaW50T25MaW5lICkgLyBkb3QoIHBsYW5lTm9ybWFsLCBsaW5lRGlyZWN0aW9uICkgKSArIHBvaW50T25MaW5lO1xufVxubWF0MyB0cmFuc3Bvc2VNYXQzKCBjb25zdCBpbiBtYXQzIG0gKSB7XG4JbWF0MyB0bXA7XG4JdG1wWyAwIF0gPSB2ZWMzKCBtWyAwIF0ueCwgbVsgMSBdLngsIG1bIDIgXS54ICk7XG4JdG1wWyAxIF0gPSB2ZWMzKCBtWyAwIF0ueSwgbVsgMSBdLnksIG1bIDIgXS55ICk7XG4JdG1wWyAyIF0gPSB2ZWMzKCBtWyAwIF0ueiwgbVsgMSBdLnosIG1bIDIgXS56ICk7XG4JcmV0dXJuIHRtcDtcbn1cbmZsb2F0IGxpbmVhclRvUmVsYXRpdmVMdW1pbmFuY2UoIGNvbnN0IGluIHZlYzMgY29sb3IgKSB7XG4JdmVjMyB3ZWlnaHRzID0gdmVjMyggMC4yMTI2LCAwLjcxNTIsIDAuMDcyMiApO1xuCXJldHVybiBkb3QoIHdlaWdodHMsIGNvbG9yLnJnYiApO1xufVxuYm9vbCBpc1BlcnNwZWN0aXZlTWF0cml4KCBtYXQ0IG0gKSB7XG4JcmV0dXJuIG1bIDIgXVsgMyBdID09IC0gMS4wO1xufVxudmVjMiBlcXVpcmVjdFV2KCBpbiB2ZWMzIGRpciApIHtcbglmbG9hdCB1ID0gYXRhbiggZGlyLnosIGRpci54ICkgKiBSRUNJUFJPQ0FMX1BJMiArIDAuNTtcbglmbG9hdCB2ID0gYXNpbiggY2xhbXAoIGRpci55LCAtIDEuMCwgMS4wICkgKSAqIFJFQ0lQUk9DQUxfUEkgKyAwLjU7XG4JcmV0dXJuIHZlYzIoIHUsIHYgKTtcbn0iOwogIHZhciBjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQgPSAiI2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVfVVZcbgkjZGVmaW5lIGN1YmVVVl9tYXhNaXBMZXZlbCA4LjBcbgkjZGVmaW5lIGN1YmVVVl9taW5NaXBMZXZlbCA0LjBcbgkjZGVmaW5lIGN1YmVVVl9tYXhUaWxlU2l6ZSAyNTYuMFxuCSNkZWZpbmUgY3ViZVVWX21pblRpbGVTaXplIDE2LjBcbglmbG9hdCBnZXRGYWNlKCB2ZWMzIGRpcmVjdGlvbiApIHtcbgkJdmVjMyBhYnNEaXJlY3Rpb24gPSBhYnMoIGRpcmVjdGlvbiApO1xuCQlmbG9hdCBmYWNlID0gLSAxLjA7XG4JCWlmICggYWJzRGlyZWN0aW9uLnggPiBhYnNEaXJlY3Rpb24ueiApIHtcbgkJCWlmICggYWJzRGlyZWN0aW9uLnggPiBhYnNEaXJlY3Rpb24ueSApXG4JCQkJZmFjZSA9IGRpcmVjdGlvbi54ID4gMC4wID8gMC4wIDogMy4wO1xuCQkJZWxzZVxuCQkJCWZhY2UgPSBkaXJlY3Rpb24ueSA+IDAuMCA/IDEuMCA6IDQuMDtcbgkJfSBlbHNlIHtcbgkJCWlmICggYWJzRGlyZWN0aW9uLnogPiBhYnNEaXJlY3Rpb24ueSApXG4JCQkJZmFjZSA9IGRpcmVjdGlvbi56ID4gMC4wID8gMi4wIDogNS4wO1xuCQkJZWxzZVxuCQkJCWZhY2UgPSBkaXJlY3Rpb24ueSA+IDAuMCA/IDEuMCA6IDQuMDtcbgkJfVxuCQlyZXR1cm4gZmFjZTtcbgl9XG4JdmVjMiBnZXRVViggdmVjMyBkaXJlY3Rpb24sIGZsb2F0IGZhY2UgKSB7XG4JCXZlYzIgdXY7XG4JCWlmICggZmFjZSA9PSAwLjAgKSB7XG4JCQl1diA9IHZlYzIoIGRpcmVjdGlvbi56LCBkaXJlY3Rpb24ueSApIC8gYWJzKCBkaXJlY3Rpb24ueCApO1xuCQl9IGVsc2UgaWYgKCBmYWNlID09IDEuMCApIHtcbgkJCXV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgLSBkaXJlY3Rpb24ueiApIC8gYWJzKCBkaXJlY3Rpb24ueSApO1xuCQl9IGVsc2UgaWYgKCBmYWNlID09IDIuMCApIHtcbgkJCXV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnogKTtcbgkJfSBlbHNlIGlmICggZmFjZSA9PSAzLjAgKSB7XG4JCQl1diA9IHZlYzIoIC0gZGlyZWN0aW9uLnosIGRpcmVjdGlvbi55ICkgLyBhYnMoIGRpcmVjdGlvbi54ICk7XG4JCX0gZWxzZSBpZiAoIGZhY2UgPT0gNC4wICkge1xuCQkJdXYgPSB2ZWMyKCAtIGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueiApIC8gYWJzKCBkaXJlY3Rpb24ueSApO1xuCQl9IGVsc2Uge1xuCQkJdXYgPSB2ZWMyKCBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnogKTtcbgkJfVxuCQlyZXR1cm4gMC41ICogKCB1diArIDEuMCApO1xuCX1cbgl2ZWMzIGJpbGluZWFyQ3ViZVVWKCBzYW1wbGVyMkQgZW52TWFwLCB2ZWMzIGRpcmVjdGlvbiwgZmxvYXQgbWlwSW50ICkge1xuCQlmbG9hdCBmYWNlID0gZ2V0RmFjZSggZGlyZWN0aW9uICk7XG4JCWZsb2F0IGZpbHRlckludCA9IG1heCggY3ViZVVWX21pbk1pcExldmVsIC0gbWlwSW50LCAwLjAgKTtcbgkJbWlwSW50ID0gbWF4KCBtaXBJbnQsIGN1YmVVVl9taW5NaXBMZXZlbCApO1xuCQlmbG9hdCBmYWNlU2l6ZSA9IGV4cDIoIG1pcEludCApO1xuCQlmbG9hdCB0ZXhlbFNpemUgPSAxLjAgLyAoIDMuMCAqIGN1YmVVVl9tYXhUaWxlU2l6ZSApO1xuCQl2ZWMyIHV2ID0gZ2V0VVYoIGRpcmVjdGlvbiwgZmFjZSApICogKCBmYWNlU2l6ZSAtIDEuMCApO1xuCQl2ZWMyIGYgPSBmcmFjdCggdXYgKTtcbgkJdXYgKz0gMC41IC0gZjtcbgkJaWYgKCBmYWNlID4gMi4wICkge1xuCQkJdXYueSArPSBmYWNlU2l6ZTtcbgkJCWZhY2UgLT0gMy4wO1xuCQl9XG4JCXV2LnggKz0gZmFjZSAqIGZhY2VTaXplO1xuCQlpZiAoIG1pcEludCA8IGN1YmVVVl9tYXhNaXBMZXZlbCApIHtcbgkJCXV2LnkgKz0gMi4wICogY3ViZVVWX21heFRpbGVTaXplO1xuCQl9XG4JCXV2LnkgKz0gZmlsdGVySW50ICogMi4wICogY3ViZVVWX21pblRpbGVTaXplO1xuCQl1di54ICs9IDMuMCAqIG1heCggMC4wLCBjdWJlVVZfbWF4VGlsZVNpemUgLSAyLjAgKiBmYWNlU2l6ZSApO1xuCQl1diAqPSB0ZXhlbFNpemU7XG4JCXZlYzMgdGwgPSBlbnZNYXBUZXhlbFRvTGluZWFyKCB0ZXh0dXJlMkQoIGVudk1hcCwgdXYgKSApLnJnYjtcbgkJdXYueCArPSB0ZXhlbFNpemU7XG4JCXZlYzMgdHIgPSBlbnZNYXBUZXhlbFRvTGluZWFyKCB0ZXh0dXJlMkQoIGVudk1hcCwgdXYgKSApLnJnYjtcbgkJdXYueSArPSB0ZXhlbFNpemU7XG4JCXZlYzMgYnIgPSBlbnZNYXBUZXhlbFRvTGluZWFyKCB0ZXh0dXJlMkQoIGVudk1hcCwgdXYgKSApLnJnYjtcbgkJdXYueCAtPSB0ZXhlbFNpemU7XG4JCXZlYzMgYmwgPSBlbnZNYXBUZXhlbFRvTGluZWFyKCB0ZXh0dXJlMkQoIGVudk1hcCwgdXYgKSApLnJnYjtcbgkJdmVjMyB0bSA9IG1peCggdGwsIHRyLCBmLnggKTtcbgkJdmVjMyBibSA9IG1peCggYmwsIGJyLCBmLnggKTtcbgkJcmV0dXJuIG1peCggdG0sIGJtLCBmLnkgKTtcbgl9XG4JI2RlZmluZSByMCAxLjBcbgkjZGVmaW5lIHYwIDAuMzM5XG4JI2RlZmluZSBtMCAtIDIuMFxuCSNkZWZpbmUgcjEgMC44XG4JI2RlZmluZSB2MSAwLjI3NlxuCSNkZWZpbmUgbTEgLSAxLjBcbgkjZGVmaW5lIHI0IDAuNFxuCSNkZWZpbmUgdjQgMC4wNDZcbgkjZGVmaW5lIG00IDIuMFxuCSNkZWZpbmUgcjUgMC4zMDVcbgkjZGVmaW5lIHY1IDAuMDE2XG4JI2RlZmluZSBtNSAzLjBcbgkjZGVmaW5lIHI2IDAuMjFcbgkjZGVmaW5lIHY2IDAuMDAzOFxuCSNkZWZpbmUgbTYgNC4wXG4JZmxvYXQgcm91Z2huZXNzVG9NaXAoIGZsb2F0IHJvdWdobmVzcyApIHtcbgkJZmxvYXQgbWlwID0gMC4wO1xuCQlpZiAoIHJvdWdobmVzcyA+PSByMSApIHtcbgkJCW1pcCA9ICggcjAgLSByb3VnaG5lc3MgKSAqICggbTEgLSBtMCApIC8gKCByMCAtIHIxICkgKyBtMDtcbgkJfSBlbHNlIGlmICggcm91Z2huZXNzID49IHI0ICkge1xuCQkJbWlwID0gKCByMSAtIHJvdWdobmVzcyApICogKCBtNCAtIG0xICkgLyAoIHIxIC0gcjQgKSArIG0xO1xuCQl9IGVsc2UgaWYgKCByb3VnaG5lc3MgPj0gcjUgKSB7XG4JCQltaXAgPSAoIHI0IC0gcm91Z2huZXNzICkgKiAoIG01IC0gbTQgKSAvICggcjQgLSByNSApICsgbTQ7XG4JCX0gZWxzZSBpZiAoIHJvdWdobmVzcyA+PSByNiApIHtcbgkJCW1pcCA9ICggcjUgLSByb3VnaG5lc3MgKSAqICggbTYgLSBtNSApIC8gKCByNSAtIHI2ICkgKyBtNTtcbgkJfSBlbHNlIHtcbgkJCW1pcCA9IC0gMi4wICogbG9nMiggMS4xNiAqIHJvdWdobmVzcyApOwkJfVxuCQlyZXR1cm4gbWlwO1xuCX1cbgl2ZWM0IHRleHR1cmVDdWJlVVYoIHNhbXBsZXIyRCBlbnZNYXAsIHZlYzMgc2FtcGxlRGlyLCBmbG9hdCByb3VnaG5lc3MgKSB7XG4JCWZsb2F0IG1pcCA9IGNsYW1wKCByb3VnaG5lc3NUb01pcCggcm91Z2huZXNzICksIG0wLCBjdWJlVVZfbWF4TWlwTGV2ZWwgKTtcbgkJZmxvYXQgbWlwRiA9IGZyYWN0KCBtaXAgKTtcbgkJZmxvYXQgbWlwSW50ID0gZmxvb3IoIG1pcCApO1xuCQl2ZWMzIGNvbG9yMCA9IGJpbGluZWFyQ3ViZVVWKCBlbnZNYXAsIHNhbXBsZURpciwgbWlwSW50ICk7XG4JCWlmICggbWlwRiA9PSAwLjAgKSB7XG4JCQlyZXR1cm4gdmVjNCggY29sb3IwLCAxLjAgKTtcbgkJfSBlbHNlIHtcbgkJCXZlYzMgY29sb3IxID0gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyLCBtaXBJbnQgKyAxLjAgKTtcbgkJCXJldHVybiB2ZWM0KCBtaXgoIGNvbG9yMCwgY29sb3IxLCBtaXBGICksIDEuMCApO1xuCQl9XG4JfVxuI2VuZGlmIjsKICB2YXIgZGVmYXVsdG5vcm1hbF92ZXJ0ZXggPSAidmVjMyB0cmFuc2Zvcm1lZE5vcm1hbCA9IG9iamVjdE5vcm1hbDtcbiNpZmRlZiBVU0VfSU5TVEFOQ0lOR1xuCW1hdDMgbSA9IG1hdDMoIGluc3RhbmNlTWF0cml4ICk7XG4JdHJhbnNmb3JtZWROb3JtYWwgLz0gdmVjMyggZG90KCBtWyAwIF0sIG1bIDAgXSApLCBkb3QoIG1bIDEgXSwgbVsgMSBdICksIGRvdCggbVsgMiBdLCBtWyAyIF0gKSApO1xuCXRyYW5zZm9ybWVkTm9ybWFsID0gbSAqIHRyYW5zZm9ybWVkTm9ybWFsO1xuI2VuZGlmXG50cmFuc2Zvcm1lZE5vcm1hbCA9IG5vcm1hbE1hdHJpeCAqIHRyYW5zZm9ybWVkTm9ybWFsO1xuI2lmZGVmIEZMSVBfU0lERURcbgl0cmFuc2Zvcm1lZE5vcm1hbCA9IC0gdHJhbnNmb3JtZWROb3JtYWw7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVEFOR0VOVFxuCXZlYzMgdHJhbnNmb3JtZWRUYW5nZW50ID0gKCBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCBvYmplY3RUYW5nZW50LCAwLjAgKSApLnh5ejtcbgkjaWZkZWYgRkxJUF9TSURFRFxuCQl0cmFuc2Zvcm1lZFRhbmdlbnQgPSAtIHRyYW5zZm9ybWVkVGFuZ2VudDtcbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuCXVuaWZvcm0gc2FtcGxlcjJEIGRpc3BsYWNlbWVudE1hcDtcbgl1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudFNjYWxlO1xuCXVuaWZvcm0gZmxvYXQgZGlzcGxhY2VtZW50QmlhcztcbiNlbmRpZiI7CiAgdmFyIGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcbgl0cmFuc2Zvcm1lZCArPSBub3JtYWxpemUoIG9iamVjdE5vcm1hbCApICogKCB0ZXh0dXJlMkQoIGRpc3BsYWNlbWVudE1hcCwgdlV2ICkueCAqIGRpc3BsYWNlbWVudFNjYWxlICsgZGlzcGxhY2VtZW50QmlhcyApO1xuI2VuZGlmIjsKICB2YXIgZW1pc3NpdmVtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuCXZlYzQgZW1pc3NpdmVDb2xvciA9IHRleHR1cmUyRCggZW1pc3NpdmVNYXAsIHZVdiApO1xuCWVtaXNzaXZlQ29sb3IucmdiID0gZW1pc3NpdmVNYXBUZXhlbFRvTGluZWFyKCBlbWlzc2l2ZUNvbG9yICkucmdiO1xuCXRvdGFsRW1pc3NpdmVSYWRpYW5jZSAqPSBlbWlzc2l2ZUNvbG9yLnJnYjtcbiNlbmRpZiI7CiAgdmFyIGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuCXVuaWZvcm0gc2FtcGxlcjJEIGVtaXNzaXZlTWFwO1xuI2VuZGlmIjsKICB2YXIgZW5jb2RpbmdzX2ZyYWdtZW50ID0gImdsX0ZyYWdDb2xvciA9IGxpbmVhclRvT3V0cHV0VGV4ZWwoIGdsX0ZyYWdDb2xvciApOyI7CiAgdmFyIGVuY29kaW5nc19wYXJzX2ZyYWdtZW50ID0gIlxudmVjNCBMaW5lYXJUb0xpbmVhciggaW4gdmVjNCB2YWx1ZSApIHtcbglyZXR1cm4gdmFsdWU7XG59XG52ZWM0IEdhbW1hVG9MaW5lYXIoIGluIHZlYzQgdmFsdWUsIGluIGZsb2F0IGdhbW1hRmFjdG9yICkge1xuCXJldHVybiB2ZWM0KCBwb3coIHZhbHVlLnJnYiwgdmVjMyggZ2FtbWFGYWN0b3IgKSApLCB2YWx1ZS5hICk7XG59XG52ZWM0IExpbmVhclRvR2FtbWEoIGluIHZlYzQgdmFsdWUsIGluIGZsb2F0IGdhbW1hRmFjdG9yICkge1xuCXJldHVybiB2ZWM0KCBwb3coIHZhbHVlLnJnYiwgdmVjMyggMS4wIC8gZ2FtbWFGYWN0b3IgKSApLCB2YWx1ZS5hICk7XG59XG52ZWM0IHNSR0JUb0xpbmVhciggaW4gdmVjNCB2YWx1ZSApIHtcbglyZXR1cm4gdmVjNCggbWl4KCBwb3coIHZhbHVlLnJnYiAqIDAuOTQ3ODY3Mjk4NiArIHZlYzMoIDAuMDUyMTMyNzAxNCApLCB2ZWMzKCAyLjQgKSApLCB2YWx1ZS5yZ2IgKiAwLjA3NzM5OTM4MDgsIHZlYzMoIGxlc3NUaGFuRXF1YWwoIHZhbHVlLnJnYiwgdmVjMyggMC4wNDA0NSApICkgKSApLCB2YWx1ZS5hICk7XG59XG52ZWM0IExpbmVhclRvc1JHQiggaW4gdmVjNCB2YWx1ZSApIHtcbglyZXR1cm4gdmVjNCggbWl4KCBwb3coIHZhbHVlLnJnYiwgdmVjMyggMC40MTY2NiApICkgKiAxLjA1NSAtIHZlYzMoIDAuMDU1ICksIHZhbHVlLnJnYiAqIDEyLjkyLCB2ZWMzKCBsZXNzVGhhbkVxdWFsKCB2YWx1ZS5yZ2IsIHZlYzMoIDAuMDAzMTMwOCApICkgKSApLCB2YWx1ZS5hICk7XG59XG52ZWM0IFJHQkVUb0xpbmVhciggaW4gdmVjNCB2YWx1ZSApIHtcbglyZXR1cm4gdmVjNCggdmFsdWUucmdiICogZXhwMiggdmFsdWUuYSAqIDI1NS4wIC0gMTI4LjAgKSwgMS4wICk7XG59XG52ZWM0IExpbmVhclRvUkdCRSggaW4gdmVjNCB2YWx1ZSApIHtcbglmbG9hdCBtYXhDb21wb25lbnQgPSBtYXgoIG1heCggdmFsdWUuciwgdmFsdWUuZyApLCB2YWx1ZS5iICk7XG4JZmxvYXQgZkV4cCA9IGNsYW1wKCBjZWlsKCBsb2cyKCBtYXhDb21wb25lbnQgKSApLCAtMTI4LjAsIDEyNy4wICk7XG4JcmV0dXJuIHZlYzQoIHZhbHVlLnJnYiAvIGV4cDIoIGZFeHAgKSwgKCBmRXhwICsgMTI4LjAgKSAvIDI1NS4wICk7XG59XG52ZWM0IFJHQk1Ub0xpbmVhciggaW4gdmVjNCB2YWx1ZSwgaW4gZmxvYXQgbWF4UmFuZ2UgKSB7XG4JcmV0dXJuIHZlYzQoIHZhbHVlLnJnYiAqIHZhbHVlLmEgKiBtYXhSYW5nZSwgMS4wICk7XG59XG52ZWM0IExpbmVhclRvUkdCTSggaW4gdmVjNCB2YWx1ZSwgaW4gZmxvYXQgbWF4UmFuZ2UgKSB7XG4JZmxvYXQgbWF4UkdCID0gbWF4KCB2YWx1ZS5yLCBtYXgoIHZhbHVlLmcsIHZhbHVlLmIgKSApO1xuCWZsb2F0IE0gPSBjbGFtcCggbWF4UkdCIC8gbWF4UmFuZ2UsIDAuMCwgMS4wICk7XG4JTSA9IGNlaWwoIE0gKiAyNTUuMCApIC8gMjU1LjA7XG4JcmV0dXJuIHZlYzQoIHZhbHVlLnJnYiAvICggTSAqIG1heFJhbmdlICksIE0gKTtcbn1cbnZlYzQgUkdCRFRvTGluZWFyKCBpbiB2ZWM0IHZhbHVlLCBpbiBmbG9hdCBtYXhSYW5nZSApIHtcbglyZXR1cm4gdmVjNCggdmFsdWUucmdiICogKCAoIG1heFJhbmdlIC8gMjU1LjAgKSAvIHZhbHVlLmEgKSwgMS4wICk7XG59XG52ZWM0IExpbmVhclRvUkdCRCggaW4gdmVjNCB2YWx1ZSwgaW4gZmxvYXQgbWF4UmFuZ2UgKSB7XG4JZmxvYXQgbWF4UkdCID0gbWF4KCB2YWx1ZS5yLCBtYXgoIHZhbHVlLmcsIHZhbHVlLmIgKSApO1xuCWZsb2F0IEQgPSBtYXgoIG1heFJhbmdlIC8gbWF4UkdCLCAxLjAgKTtcbglEID0gY2xhbXAoIGZsb29yKCBEICkgLyAyNTUuMCwgMC4wLCAxLjAgKTtcbglyZXR1cm4gdmVjNCggdmFsdWUucmdiICogKCBEICogKCAyNTUuMCAvIG1heFJhbmdlICkgKSwgRCApO1xufVxuY29uc3QgbWF0MyBjTG9nTHV2TSA9IG1hdDMoIDAuMjIwOSwgMC4zMzkwLCAwLjQxODQsIDAuMTEzOCwgMC42NzgwLCAwLjczMTksIDAuMDEwMiwgMC4xMTMwLCAwLjI5NjkgKTtcbnZlYzQgTGluZWFyVG9Mb2dMdXYoIGluIHZlYzQgdmFsdWUgKSB7XG4JdmVjMyBYcF9ZX1hZWnAgPSBjTG9nTHV2TSAqIHZhbHVlLnJnYjtcbglYcF9ZX1hZWnAgPSBtYXgoIFhwX1lfWFlacCwgdmVjMyggMWUtNiwgMWUtNiwgMWUtNiApICk7XG4JdmVjNCB2UmVzdWx0O1xuCXZSZXN1bHQueHkgPSBYcF9ZX1hZWnAueHkgLyBYcF9ZX1hZWnAuejtcbglmbG9hdCBMZSA9IDIuMCAqIGxvZzIoWHBfWV9YWVpwLnkpICsgMTI3LjA7XG4JdlJlc3VsdC53ID0gZnJhY3QoIExlICk7XG4JdlJlc3VsdC56ID0gKCBMZSAtICggZmxvb3IoIHZSZXN1bHQudyAqIDI1NS4wICkgKSAvIDI1NS4wICkgLyAyNTUuMDtcbglyZXR1cm4gdlJlc3VsdDtcbn1cbmNvbnN0IG1hdDMgY0xvZ0x1dkludmVyc2VNID0gbWF0MyggNi4wMDE0LCAtMi43MDA4LCAtMS43OTk2LCAtMS4zMzIwLCAzLjEwMjksIC01Ljc3MjEsIDAuMzAwOCwgLTEuMDg4MiwgNS42MjY4ICk7XG52ZWM0IExvZ0x1dlRvTGluZWFyKCBpbiB2ZWM0IHZhbHVlICkge1xuCWZsb2F0IExlID0gdmFsdWUueiAqIDI1NS4wICsgdmFsdWUudztcbgl2ZWMzIFhwX1lfWFlacDtcbglYcF9ZX1hZWnAueSA9IGV4cDIoICggTGUgLSAxMjcuMCApIC8gMi4wICk7XG4JWHBfWV9YWVpwLnogPSBYcF9ZX1hZWnAueSAvIHZhbHVlLnk7XG4JWHBfWV9YWVpwLnggPSB2YWx1ZS54ICogWHBfWV9YWVpwLno7XG4JdmVjMyB2UkdCID0gY0xvZ0x1dkludmVyc2VNICogWHBfWV9YWVpwLnJnYjtcbglyZXR1cm4gdmVjNCggbWF4KCB2UkdCLCAwLjAgKSwgMS4wICk7XG59IjsKICB2YXIgZW52bWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG4JI2lmZGVmIEVOVl9XT1JMRFBPU1xuCQl2ZWMzIGNhbWVyYVRvRnJhZztcbgkJaWYgKCBpc09ydGhvZ3JhcGhpYyApIHtcbgkJCWNhbWVyYVRvRnJhZyA9IG5vcm1hbGl6ZSggdmVjMyggLSB2aWV3TWF0cml4WyAwIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAxIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAyIF1bIDIgXSApICk7XG4JCX0gZWxzZSB7XG4JCQljYW1lcmFUb0ZyYWcgPSBub3JtYWxpemUoIHZXb3JsZFBvc2l0aW9uIC0gY2FtZXJhUG9zaXRpb24gKTtcbgkJfVxuCQl2ZWMzIHdvcmxkTm9ybWFsID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG4JCSNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG4JCQl2ZWMzIHJlZmxlY3RWZWMgPSByZWZsZWN0KCBjYW1lcmFUb0ZyYWcsIHdvcmxkTm9ybWFsICk7XG4JCSNlbHNlXG4JCQl2ZWMzIHJlZmxlY3RWZWMgPSByZWZyYWN0KCBjYW1lcmFUb0ZyYWcsIHdvcmxkTm9ybWFsLCByZWZyYWN0aW9uUmF0aW8gKTtcbgkJI2VuZGlmXG4JI2Vsc2VcbgkJdmVjMyByZWZsZWN0VmVjID0gdlJlZmxlY3Q7XG4JI2VuZGlmXG4JI2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcbgkJdmVjNCBlbnZDb2xvciA9IHRleHR1cmVDdWJlKCBlbnZNYXAsIHZlYzMoIGZsaXBFbnZNYXAgKiByZWZsZWN0VmVjLngsIHJlZmxlY3RWZWMueXogKSApO1xuCSNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuCQl2ZWM0IGVudkNvbG9yID0gdGV4dHVyZUN1YmVVViggZW52TWFwLCByZWZsZWN0VmVjLCAwLjAgKTtcbgkjZWxzZVxuCQl2ZWM0IGVudkNvbG9yID0gdmVjNCggMC4wICk7XG4JI2VuZGlmXG4JI2lmbmRlZiBFTlZNQVBfVFlQRV9DVUJFX1VWXG4JCWVudkNvbG9yID0gZW52TWFwVGV4ZWxUb0xpbmVhciggZW52Q29sb3IgKTtcbgkjZW5kaWZcbgkjaWZkZWYgRU5WTUFQX0JMRU5ESU5HX01VTFRJUExZXG4JCW91dGdvaW5nTGlnaHQgPSBtaXgoIG91dGdvaW5nTGlnaHQsIG91dGdvaW5nTGlnaHQgKiBlbnZDb2xvci54eXosIHNwZWN1bGFyU3RyZW5ndGggKiByZWZsZWN0aXZpdHkgKTtcbgkjZWxpZiBkZWZpbmVkKCBFTlZNQVBfQkxFTkRJTkdfTUlYIClcbgkJb3V0Z29pbmdMaWdodCA9IG1peCggb3V0Z29pbmdMaWdodCwgZW52Q29sb3IueHl6LCBzcGVjdWxhclN0cmVuZ3RoICogcmVmbGVjdGl2aXR5ICk7XG4JI2VsaWYgZGVmaW5lZCggRU5WTUFQX0JMRU5ESU5HX0FERCApXG4JCW91dGdvaW5nTGlnaHQgKz0gZW52Q29sb3IueHl6ICogc3BlY3VsYXJTdHJlbmd0aCAqIHJlZmxlY3Rpdml0eTtcbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuCXVuaWZvcm0gZmxvYXQgZW52TWFwSW50ZW5zaXR5O1xuCXVuaWZvcm0gZmxvYXQgZmxpcEVudk1hcDtcbgl1bmlmb3JtIGludCBtYXhNaXBMZXZlbDtcbgkjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuCQl1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDtcbgkjZWxzZVxuCQl1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7XG4JI2VuZGlmXG4JXG4jZW5kaWYiOwogIHZhciBlbnZtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuCXVuaWZvcm0gZmxvYXQgcmVmbGVjdGl2aXR5O1xuCSNpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBQSE9ORyApXG4JCSNkZWZpbmUgRU5WX1dPUkxEUE9TXG4JI2VuZGlmXG4JI2lmZGVmIEVOVl9XT1JMRFBPU1xuCQl2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG4JCXVuaWZvcm0gZmxvYXQgcmVmcmFjdGlvblJhdGlvO1xuCSNlbHNlXG4JCXZhcnlpbmcgdmVjMyB2UmVmbGVjdDtcbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIGVudm1hcF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuCSNpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fGRlZmluZWQoIFBIT05HIClcbgkJI2RlZmluZSBFTlZfV09STERQT1NcbgkjZW5kaWZcbgkjaWZkZWYgRU5WX1dPUkxEUE9TXG4JCVxuCQl2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG4JI2Vsc2VcbgkJdmFyeWluZyB2ZWMzIHZSZWZsZWN0O1xuCQl1bmlmb3JtIGZsb2F0IHJlZnJhY3Rpb25SYXRpbztcbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIGVudm1hcF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9FTlZNQVBcbgkjaWZkZWYgRU5WX1dPUkxEUE9TXG4JCXZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG4JI2Vsc2VcbgkJdmVjMyBjYW1lcmFUb1ZlcnRleDtcbgkJaWYgKCBpc09ydGhvZ3JhcGhpYyApIHtcbgkJCWNhbWVyYVRvVmVydGV4ID0gbm9ybWFsaXplKCB2ZWMzKCAtIHZpZXdNYXRyaXhbIDAgXVsgMiBdLCAtIHZpZXdNYXRyaXhbIDEgXVsgMiBdLCAtIHZpZXdNYXRyaXhbIDIgXVsgMiBdICkgKTtcbgkJfSBlbHNlIHtcbgkJCWNhbWVyYVRvVmVydGV4ID0gbm9ybWFsaXplKCB3b3JsZFBvc2l0aW9uLnh5eiAtIGNhbWVyYVBvc2l0aW9uICk7XG4JCX1cbgkJdmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHRyYW5zZm9ybWVkTm9ybWFsLCB2aWV3TWF0cml4ICk7XG4JCSNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG4JCQl2UmVmbGVjdCA9IHJlZmxlY3QoIGNhbWVyYVRvVmVydGV4LCB3b3JsZE5vcm1hbCApO1xuCQkjZWxzZVxuCQkJdlJlZmxlY3QgPSByZWZyYWN0KCBjYW1lcmFUb1ZlcnRleCwgd29ybGROb3JtYWwsIHJlZnJhY3Rpb25SYXRpbyApO1xuCQkjZW5kaWZcbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIGZvZ192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9GT0dcbglmb2dEZXB0aCA9IC0gbXZQb3NpdGlvbi56O1xuI2VuZGlmIjsKICB2YXIgZm9nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfRk9HXG4JdmFyeWluZyBmbG9hdCBmb2dEZXB0aDtcbiNlbmRpZiI7CiAgdmFyIGZvZ19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0ZPR1xuCSNpZmRlZiBGT0dfRVhQMlxuCQlmbG9hdCBmb2dGYWN0b3IgPSAxLjAgLSBleHAoIC0gZm9nRGVuc2l0eSAqIGZvZ0RlbnNpdHkgKiBmb2dEZXB0aCAqIGZvZ0RlcHRoICk7XG4JI2Vsc2VcbgkJZmxvYXQgZm9nRmFjdG9yID0gc21vb3Roc3RlcCggZm9nTmVhciwgZm9nRmFyLCBmb2dEZXB0aCApO1xuCSNlbmRpZlxuCWdsX0ZyYWdDb2xvci5yZ2IgPSBtaXgoIGdsX0ZyYWdDb2xvci5yZ2IsIGZvZ0NvbG9yLCBmb2dGYWN0b3IgKTtcbiNlbmRpZiI7CiAgdmFyIGZvZ19wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRk9HXG4JdW5pZm9ybSB2ZWMzIGZvZ0NvbG9yO1xuCXZhcnlpbmcgZmxvYXQgZm9nRGVwdGg7XG4JI2lmZGVmIEZPR19FWFAyXG4JCXVuaWZvcm0gZmxvYXQgZm9nRGVuc2l0eTtcbgkjZWxzZVxuCQl1bmlmb3JtIGZsb2F0IGZvZ05lYXI7XG4JCXVuaWZvcm0gZmxvYXQgZm9nRmFyO1xuCSNlbmRpZlxuI2VuZGlmIjsKICB2YXIgZ3JhZGllbnRtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0dSQURJRU5UTUFQXG4JdW5pZm9ybSBzYW1wbGVyMkQgZ3JhZGllbnRNYXA7XG4jZW5kaWZcbnZlYzMgZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCB2ZWMzIG5vcm1hbCwgdmVjMyBsaWdodERpcmVjdGlvbiApIHtcbglmbG9hdCBkb3ROTCA9IGRvdCggbm9ybWFsLCBsaWdodERpcmVjdGlvbiApO1xuCXZlYzIgY29vcmQgPSB2ZWMyKCBkb3ROTCAqIDAuNSArIDAuNSwgMC4wICk7XG4JI2lmZGVmIFVTRV9HUkFESUVOVE1BUFxuCQlyZXR1cm4gdGV4dHVyZTJEKCBncmFkaWVudE1hcCwgY29vcmQgKS5yZ2I7XG4JI2Vsc2VcbgkJcmV0dXJuICggY29vcmQueCA8IDAuNyApID8gdmVjMyggMC43ICkgOiB2ZWMzKCAxLjAgKTtcbgkjZW5kaWZcbn0iOwogIHZhciBsaWdodG1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0xJR0hUTUFQXG4JdmVjNCBsaWdodE1hcFRleGVsPSB0ZXh0dXJlMkQoIGxpZ2h0TWFwLCB2VXYyICk7XG4JcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IFBJICogbGlnaHRNYXBUZXhlbFRvTGluZWFyKCBsaWdodE1hcFRleGVsICkucmdiICogbGlnaHRNYXBJbnRlbnNpdHk7XG4jZW5kaWYiOwogIHZhciBsaWdodG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTElHSFRNQVBcbgl1bmlmb3JtIHNhbXBsZXIyRCBsaWdodE1hcDtcbgl1bmlmb3JtIGZsb2F0IGxpZ2h0TWFwSW50ZW5zaXR5O1xuI2VuZGlmIjsKICB2YXIgbGlnaHRzX2xhbWJlcnRfdmVydGV4ID0gInZlYzMgZGlmZnVzZSA9IHZlYzMoIDEuMCApO1xuR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeTtcbmdlb21ldHJ5LnBvc2l0aW9uID0gbXZQb3NpdGlvbi54eXo7XG5nZW9tZXRyeS5ub3JtYWwgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkTm9ybWFsICk7XG5nZW9tZXRyeS52aWV3RGlyID0gKCBpc09ydGhvZ3JhcGhpYyApID8gdmVjMyggMCwgMCwgMSApIDogbm9ybWFsaXplKCAtbXZQb3NpdGlvbi54eXogKTtcbkdlb21ldHJpY0NvbnRleHQgYmFja0dlb21ldHJ5O1xuYmFja0dlb21ldHJ5LnBvc2l0aW9uID0gZ2VvbWV0cnkucG9zaXRpb247XG5iYWNrR2VvbWV0cnkubm9ybWFsID0gLWdlb21ldHJ5Lm5vcm1hbDtcbmJhY2tHZW9tZXRyeS52aWV3RGlyID0gZ2VvbWV0cnkudmlld0RpcjtcbnZMaWdodEZyb250ID0gdmVjMyggMC4wICk7XG52SW5kaXJlY3RGcm9udCA9IHZlYzMoIDAuMCApO1xuI2lmZGVmIERPVUJMRV9TSURFRFxuCXZMaWdodEJhY2sgPSB2ZWMzKCAwLjAgKTtcbgl2SW5kaXJlY3RCYWNrID0gdmVjMyggMC4wICk7XG4jZW5kaWZcbkluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQ7XG5mbG9hdCBkb3ROTDtcbnZlYzMgZGlyZWN0TGlnaHRDb2xvcl9EaWZmdXNlO1xudkluZGlyZWN0RnJvbnQgKz0gZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggYW1iaWVudExpZ2h0Q29sb3IgKTtcbnZJbmRpcmVjdEZyb250ICs9IGdldExpZ2h0UHJvYmVJcnJhZGlhbmNlKCBsaWdodFByb2JlLCBnZW9tZXRyeSApO1xuI2lmZGVmIERPVUJMRV9TSURFRFxuCXZJbmRpcmVjdEJhY2sgKz0gZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggYW1iaWVudExpZ2h0Q29sb3IgKTtcbgl2SW5kaXJlY3RCYWNrICs9IGdldExpZ2h0UHJvYmVJcnJhZGlhbmNlKCBsaWdodFByb2JlLCBiYWNrR2VvbWV0cnkgKTtcbiNlbmRpZlxuI2lmIE5VTV9QT0lOVF9MSUdIVFMgPiAwXG4JI3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuCWZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVFM7IGkgKysgKSB7XG4JCWdldFBvaW50RGlyZWN0TGlnaHRJcnJhZGlhbmNlKCBwb2ludExpZ2h0c1sgaSBdLCBnZW9tZXRyeSwgZGlyZWN0TGlnaHQgKTtcbgkJZG90TkwgPSBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICk7XG4JCWRpcmVjdExpZ2h0Q29sb3JfRGlmZnVzZSA9IFBJICogZGlyZWN0TGlnaHQuY29sb3I7XG4JCXZMaWdodEZyb250ICs9IHNhdHVyYXRlKCBkb3ROTCApICogZGlyZWN0TGlnaHRDb2xvcl9EaWZmdXNlO1xuCQkjaWZkZWYgRE9VQkxFX1NJREVEXG4JCQl2TGlnaHRCYWNrICs9IHNhdHVyYXRlKCAtZG90TkwgKSAqIGRpcmVjdExpZ2h0Q29sb3JfRGlmZnVzZTtcbgkJI2VuZGlmXG4JfVxuCSNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiBOVU1fU1BPVF9MSUdIVFMgPiAwXG4JI3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuCWZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUUzsgaSArKyApIHtcbgkJZ2V0U3BvdERpcmVjdExpZ2h0SXJyYWRpYW5jZSggc3BvdExpZ2h0c1sgaSBdLCBnZW9tZXRyeSwgZGlyZWN0TGlnaHQgKTtcbgkJZG90TkwgPSBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICk7XG4JCWRpcmVjdExpZ2h0Q29sb3JfRGlmZnVzZSA9IFBJICogZGlyZWN0TGlnaHQuY29sb3I7XG4JCXZMaWdodEZyb250ICs9IHNhdHVyYXRlKCBkb3ROTCApICogZGlyZWN0TGlnaHRDb2xvcl9EaWZmdXNlO1xuCQkjaWZkZWYgRE9VQkxFX1NJREVEXG4JCQl2TGlnaHRCYWNrICs9IHNhdHVyYXRlKCAtZG90TkwgKSAqIGRpcmVjdExpZ2h0Q29sb3JfRGlmZnVzZTtcbgkJI2VuZGlmXG4JfVxuCSNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiBOVU1fRElSX0xJR0hUUyA+IDBcbgkjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG4JZm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVFM7IGkgKysgKSB7XG4JCWdldERpcmVjdGlvbmFsRGlyZWN0TGlnaHRJcnJhZGlhbmNlKCBkaXJlY3Rpb25hbExpZ2h0c1sgaSBdLCBnZW9tZXRyeSwgZGlyZWN0TGlnaHQgKTtcbgkJZG90TkwgPSBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICk7XG4JCWRpcmVjdExpZ2h0Q29sb3JfRGlmZnVzZSA9IFBJICogZGlyZWN0TGlnaHQuY29sb3I7XG4JCXZMaWdodEZyb250ICs9IHNhdHVyYXRlKCBkb3ROTCApICogZGlyZWN0TGlnaHRDb2xvcl9EaWZmdXNlO1xuCQkjaWZkZWYgRE9VQkxFX1NJREVEXG4JCQl2TGlnaHRCYWNrICs9IHNhdHVyYXRlKCAtZG90TkwgKSAqIGRpcmVjdExpZ2h0Q29sb3JfRGlmZnVzZTtcbgkJI2VuZGlmXG4JfVxuCSNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiBOVU1fSEVNSV9MSUdIVFMgPiAwXG4JI3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuCWZvciAoIGludCBpID0gMDsgaSA8IE5VTV9IRU1JX0xJR0hUUzsgaSArKyApIHtcbgkJdkluZGlyZWN0RnJvbnQgKz0gZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggaGVtaXNwaGVyZUxpZ2h0c1sgaSBdLCBnZW9tZXRyeSApO1xuCQkjaWZkZWYgRE9VQkxFX1NJREVEXG4JCQl2SW5kaXJlY3RCYWNrICs9IGdldEhlbWlzcGhlcmVMaWdodElycmFkaWFuY2UoIGhlbWlzcGhlcmVMaWdodHNbIGkgXSwgYmFja0dlb21ldHJ5ICk7XG4JCSNlbmRpZlxuCX1cbgkjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuI2VuZGlmIjsKICB2YXIgbGlnaHRzX3BhcnNfYmVnaW4gPSAidW5pZm9ybSBib29sIHJlY2VpdmVTaGFkb3c7XG51bmlmb3JtIHZlYzMgYW1iaWVudExpZ2h0Q29sb3I7XG51bmlmb3JtIHZlYzMgbGlnaHRQcm9iZVsgOSBdO1xudmVjMyBzaEdldElycmFkaWFuY2VBdCggaW4gdmVjMyBub3JtYWwsIGluIHZlYzMgc2hDb2VmZmljaWVudHNbIDkgXSApIHtcbglmbG9hdCB4ID0gbm9ybWFsLngsIHkgPSBub3JtYWwueSwgeiA9IG5vcm1hbC56O1xuCXZlYzMgcmVzdWx0ID0gc2hDb2VmZmljaWVudHNbIDAgXSAqIDAuODg2MjI3O1xuCXJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgMSBdICogMi4wICogMC41MTE2NjQgKiB5O1xuCXJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgMiBdICogMi4wICogMC41MTE2NjQgKiB6O1xuCXJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgMyBdICogMi4wICogMC41MTE2NjQgKiB4O1xuCXJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNCBdICogMi4wICogMC40MjkwNDMgKiB4ICogeTtcbglyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDUgXSAqIDIuMCAqIDAuNDI5MDQzICogeSAqIHo7XG4JcmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA2IF0gKiAoIDAuNzQzMTI1ICogeiAqIHogLSAwLjI0NzcwOCApO1xuCXJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNyBdICogMi4wICogMC40MjkwNDMgKiB4ICogejtcbglyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDggXSAqIDAuNDI5MDQzICogKCB4ICogeCAtIHkgKiB5ICk7XG4JcmV0dXJuIHJlc3VsdDtcbn1cbnZlYzMgZ2V0TGlnaHRQcm9iZUlycmFkaWFuY2UoIGNvbnN0IGluIHZlYzMgbGlnaHRQcm9iZVsgOSBdLCBjb25zdCBpbiBHZW9tZXRyaWNDb250ZXh0IGdlb21ldHJ5ICkge1xuCXZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBnZW9tZXRyeS5ub3JtYWwsIHZpZXdNYXRyaXggKTtcbgl2ZWMzIGlycmFkaWFuY2UgPSBzaEdldElycmFkaWFuY2VBdCggd29ybGROb3JtYWwsIGxpZ2h0UHJvYmUgKTtcbglyZXR1cm4gaXJyYWRpYW5jZTtcbn1cbnZlYzMgZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gdmVjMyBhbWJpZW50TGlnaHRDb2xvciApIHtcbgl2ZWMzIGlycmFkaWFuY2UgPSBhbWJpZW50TGlnaHRDb2xvcjtcbgkjaWZuZGVmIFBIWVNJQ0FMTFlfQ09SUkVDVF9MSUdIVFNcbgkJaXJyYWRpYW5jZSAqPSBQSTtcbgkjZW5kaWZcbglyZXR1cm4gaXJyYWRpYW5jZTtcbn1cbiNpZiBOVU1fRElSX0xJR0hUUyA+IDBcbglzdHJ1Y3QgRGlyZWN0aW9uYWxMaWdodCB7XG4JCXZlYzMgZGlyZWN0aW9uO1xuCQl2ZWMzIGNvbG9yO1xuCX07XG4JdW5pZm9ybSBEaXJlY3Rpb25hbExpZ2h0IGRpcmVjdGlvbmFsTGlnaHRzWyBOVU1fRElSX0xJR0hUUyBdO1xuCXZvaWQgZ2V0RGlyZWN0aW9uYWxEaXJlY3RMaWdodElycmFkaWFuY2UoIGNvbnN0IGluIERpcmVjdGlvbmFsTGlnaHQgZGlyZWN0aW9uYWxMaWdodCwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgb3V0IEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQgKSB7XG4JCWRpcmVjdExpZ2h0LmNvbG9yID0gZGlyZWN0aW9uYWxMaWdodC5jb2xvcjtcbgkJZGlyZWN0TGlnaHQuZGlyZWN0aW9uID0gZGlyZWN0aW9uYWxMaWdodC5kaXJlY3Rpb247XG4JCWRpcmVjdExpZ2h0LnZpc2libGUgPSB0cnVlO1xuCX1cbiNlbmRpZlxuI2lmIE5VTV9QT0lOVF9MSUdIVFMgPiAwXG4Jc3RydWN0IFBvaW50TGlnaHQge1xuCQl2ZWMzIHBvc2l0aW9uO1xuCQl2ZWMzIGNvbG9yO1xuCQlmbG9hdCBkaXN0YW5jZTtcbgkJZmxvYXQgZGVjYXk7XG4JfTtcbgl1bmlmb3JtIFBvaW50TGlnaHQgcG9pbnRMaWdodHNbIE5VTV9QT0lOVF9MSUdIVFMgXTtcbgl2b2lkIGdldFBvaW50RGlyZWN0TGlnaHRJcnJhZGlhbmNlKCBjb25zdCBpbiBQb2ludExpZ2h0IHBvaW50TGlnaHQsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIG91dCBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0ICkge1xuCQl2ZWMzIGxWZWN0b3IgPSBwb2ludExpZ2h0LnBvc2l0aW9uIC0gZ2VvbWV0cnkucG9zaXRpb247XG4JCWRpcmVjdExpZ2h0LmRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggbFZlY3RvciApO1xuCQlmbG9hdCBsaWdodERpc3RhbmNlID0gbGVuZ3RoKCBsVmVjdG9yICk7XG4JCWRpcmVjdExpZ2h0LmNvbG9yID0gcG9pbnRMaWdodC5jb2xvcjtcbgkJZGlyZWN0TGlnaHQuY29sb3IgKj0gcHVuY3R1YWxMaWdodEludGVuc2l0eVRvSXJyYWRpYW5jZUZhY3RvciggbGlnaHREaXN0YW5jZSwgcG9pbnRMaWdodC5kaXN0YW5jZSwgcG9pbnRMaWdodC5kZWNheSApO1xuCQlkaXJlY3RMaWdodC52aXNpYmxlID0gKCBkaXJlY3RMaWdodC5jb2xvciAhPSB2ZWMzKCAwLjAgKSApO1xuCX1cbiNlbmRpZlxuI2lmIE5VTV9TUE9UX0xJR0hUUyA+IDBcbglzdHJ1Y3QgU3BvdExpZ2h0IHtcbgkJdmVjMyBwb3NpdGlvbjtcbgkJdmVjMyBkaXJlY3Rpb247XG4JCXZlYzMgY29sb3I7XG4JCWZsb2F0IGRpc3RhbmNlO1xuCQlmbG9hdCBkZWNheTtcbgkJZmxvYXQgY29uZUNvcztcbgkJZmxvYXQgcGVudW1icmFDb3M7XG4JfTtcbgl1bmlmb3JtIFNwb3RMaWdodCBzcG90TGlnaHRzWyBOVU1fU1BPVF9MSUdIVFMgXTtcbgl2b2lkIGdldFNwb3REaXJlY3RMaWdodElycmFkaWFuY2UoIGNvbnN0IGluIFNwb3RMaWdodCBzcG90TGlnaHQsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIG91dCBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0ICkge1xuCQl2ZWMzIGxWZWN0b3IgPSBzcG90TGlnaHQucG9zaXRpb24gLSBnZW9tZXRyeS5wb3NpdGlvbjtcbgkJZGlyZWN0TGlnaHQuZGlyZWN0aW9uID0gbm9ybWFsaXplKCBsVmVjdG9yICk7XG4JCWZsb2F0IGxpZ2h0RGlzdGFuY2UgPSBsZW5ndGgoIGxWZWN0b3IgKTtcbgkJZmxvYXQgYW5nbGVDb3MgPSBkb3QoIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiwgc3BvdExpZ2h0LmRpcmVjdGlvbiApO1xuCQlpZiAoIGFuZ2xlQ29zID4gc3BvdExpZ2h0LmNvbmVDb3MgKSB7XG4JCQlmbG9hdCBzcG90RWZmZWN0ID0gc21vb3Roc3RlcCggc3BvdExpZ2h0LmNvbmVDb3MsIHNwb3RMaWdodC5wZW51bWJyYUNvcywgYW5nbGVDb3MgKTtcbgkJCWRpcmVjdExpZ2h0LmNvbG9yID0gc3BvdExpZ2h0LmNvbG9yO1xuCQkJZGlyZWN0TGlnaHQuY29sb3IgKj0gc3BvdEVmZmVjdCAqIHB1bmN0dWFsTGlnaHRJbnRlbnNpdHlUb0lycmFkaWFuY2VGYWN0b3IoIGxpZ2h0RGlzdGFuY2UsIHNwb3RMaWdodC5kaXN0YW5jZSwgc3BvdExpZ2h0LmRlY2F5ICk7XG4JCQlkaXJlY3RMaWdodC52aXNpYmxlID0gdHJ1ZTtcbgkJfSBlbHNlIHtcbgkJCWRpcmVjdExpZ2h0LmNvbG9yID0gdmVjMyggMC4wICk7XG4JCQlkaXJlY3RMaWdodC52aXNpYmxlID0gZmFsc2U7XG4JCX1cbgl9XG4jZW5kaWZcbiNpZiBOVU1fUkVDVF9BUkVBX0xJR0hUUyA+IDBcbglzdHJ1Y3QgUmVjdEFyZWFMaWdodCB7XG4JCXZlYzMgY29sb3I7XG4JCXZlYzMgcG9zaXRpb247XG4JCXZlYzMgaGFsZldpZHRoO1xuCQl2ZWMzIGhhbGZIZWlnaHQ7XG4JfTtcbgl1bmlmb3JtIHNhbXBsZXIyRCBsdGNfMTsJdW5pZm9ybSBzYW1wbGVyMkQgbHRjXzI7XG4JdW5pZm9ybSBSZWN0QXJlYUxpZ2h0IHJlY3RBcmVhTGlnaHRzWyBOVU1fUkVDVF9BUkVBX0xJR0hUUyBdO1xuI2VuZGlmXG4jaWYgTlVNX0hFTUlfTElHSFRTID4gMFxuCXN0cnVjdCBIZW1pc3BoZXJlTGlnaHQge1xuCQl2ZWMzIGRpcmVjdGlvbjtcbgkJdmVjMyBza3lDb2xvcjtcbgkJdmVjMyBncm91bmRDb2xvcjtcbgl9O1xuCXVuaWZvcm0gSGVtaXNwaGVyZUxpZ2h0IGhlbWlzcGhlcmVMaWdodHNbIE5VTV9IRU1JX0xJR0hUUyBdO1xuCXZlYzMgZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gSGVtaXNwaGVyZUxpZ2h0IGhlbWlMaWdodCwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSApIHtcbgkJZmxvYXQgZG90TkwgPSBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgaGVtaUxpZ2h0LmRpcmVjdGlvbiApO1xuCQlmbG9hdCBoZW1pRGlmZnVzZVdlaWdodCA9IDAuNSAqIGRvdE5MICsgMC41O1xuCQl2ZWMzIGlycmFkaWFuY2UgPSBtaXgoIGhlbWlMaWdodC5ncm91bmRDb2xvciwgaGVtaUxpZ2h0LnNreUNvbG9yLCBoZW1pRGlmZnVzZVdlaWdodCApO1xuCQkjaWZuZGVmIFBIWVNJQ0FMTFlfQ09SUkVDVF9MSUdIVFNcbgkJCWlycmFkaWFuY2UgKj0gUEk7XG4JCSNlbmRpZlxuCQlyZXR1cm4gaXJyYWRpYW5jZTtcbgl9XG4jZW5kaWYiOwogIHZhciBlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApXG4JI2lmZGVmIEVOVk1BUF9NT0RFX1JFRlJBQ1RJT05cbgkJdW5pZm9ybSBmbG9hdCByZWZyYWN0aW9uUmF0aW87XG4JI2VuZGlmXG4JdmVjMyBnZXRMaWdodFByb2JlSW5kaXJlY3RJcnJhZGlhbmNlKCBjb25zdCBpbiBHZW9tZXRyaWNDb250ZXh0IGdlb21ldHJ5LCBjb25zdCBpbiBpbnQgbWF4TUlQTGV2ZWwgKSB7XG4JCXZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBnZW9tZXRyeS5ub3JtYWwsIHZpZXdNYXRyaXggKTtcbgkJI2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcbgkJCXZlYzMgcXVlcnlWZWMgPSB2ZWMzKCBmbGlwRW52TWFwICogd29ybGROb3JtYWwueCwgd29ybGROb3JtYWwueXogKTtcbgkJCSNpZmRlZiBURVhUVVJFX0xPRF9FWFRcbgkJCQl2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmVMb2RFWFQoIGVudk1hcCwgcXVlcnlWZWMsIGZsb2F0KCBtYXhNSVBMZXZlbCApICk7XG4JCQkjZWxzZVxuCQkJCXZlYzQgZW52TWFwQ29sb3IgPSB0ZXh0dXJlQ3ViZSggZW52TWFwLCBxdWVyeVZlYywgZmxvYXQoIG1heE1JUExldmVsICkgKTtcbgkJCSNlbmRpZlxuCQkJZW52TWFwQ29sb3IucmdiID0gZW52TWFwVGV4ZWxUb0xpbmVhciggZW52TWFwQ29sb3IgKS5yZ2I7XG4JCSNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuCQkJdmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgd29ybGROb3JtYWwsIDEuMCApO1xuCQkjZWxzZVxuCQkJdmVjNCBlbnZNYXBDb2xvciA9IHZlYzQoIDAuMCApO1xuCQkjZW5kaWZcbgkJcmV0dXJuIFBJICogZW52TWFwQ29sb3IucmdiICogZW52TWFwSW50ZW5zaXR5O1xuCX1cbglmbG9hdCBnZXRTcGVjdWxhck1JUExldmVsKCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGNvbnN0IGluIGludCBtYXhNSVBMZXZlbCApIHtcbgkJZmxvYXQgbWF4TUlQTGV2ZWxTY2FsYXIgPSBmbG9hdCggbWF4TUlQTGV2ZWwgKTtcbgkJZmxvYXQgc2lnbWEgPSBQSSAqIHJvdWdobmVzcyAqIHJvdWdobmVzcyAvICggMS4wICsgcm91Z2huZXNzICk7XG4JCWZsb2F0IGRlc2lyZWRNSVBMZXZlbCA9IG1heE1JUExldmVsU2NhbGFyICsgbG9nMiggc2lnbWEgKTtcbgkJcmV0dXJuIGNsYW1wKCBkZXNpcmVkTUlQTGV2ZWwsIDAuMCwgbWF4TUlQTGV2ZWxTY2FsYXIgKTtcbgl9XG4JdmVjMyBnZXRMaWdodFByb2JlSW5kaXJlY3RSYWRpYW5jZSggY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiBpbnQgbWF4TUlQTGV2ZWwgKSB7XG4JCSNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG4JCQl2ZWMzIHJlZmxlY3RWZWMgPSByZWZsZWN0KCAtdmlld0Rpciwgbm9ybWFsICk7XG4JCQlyZWZsZWN0VmVjID0gbm9ybWFsaXplKCBtaXgoIHJlZmxlY3RWZWMsIG5vcm1hbCwgcm91Z2huZXNzICogcm91Z2huZXNzKSApO1xuCQkjZWxzZVxuCQkJdmVjMyByZWZsZWN0VmVjID0gcmVmcmFjdCggLXZpZXdEaXIsIG5vcm1hbCwgcmVmcmFjdGlvblJhdGlvICk7XG4JCSNlbmRpZlxuCQlyZWZsZWN0VmVjID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggcmVmbGVjdFZlYywgdmlld01hdHJpeCApO1xuCQlmbG9hdCBzcGVjdWxhck1JUExldmVsID0gZ2V0U3BlY3VsYXJNSVBMZXZlbCggcm91Z2huZXNzLCBtYXhNSVBMZXZlbCApO1xuCQkjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuCQkJdmVjMyBxdWVyeVJlZmxlY3RWZWMgPSB2ZWMzKCBmbGlwRW52TWFwICogcmVmbGVjdFZlYy54LCByZWZsZWN0VmVjLnl6ICk7XG4JCQkjaWZkZWYgVEVYVFVSRV9MT0RfRVhUXG4JCQkJdmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmVDdWJlTG9kRVhUKCBlbnZNYXAsIHF1ZXJ5UmVmbGVjdFZlYywgc3BlY3VsYXJNSVBMZXZlbCApO1xuCQkJI2Vsc2VcbgkJCQl2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgcXVlcnlSZWZsZWN0VmVjLCBzcGVjdWxhck1JUExldmVsICk7XG4JCQkjZW5kaWZcbgkJCWVudk1hcENvbG9yLnJnYiA9IGVudk1hcFRleGVsVG9MaW5lYXIoIGVudk1hcENvbG9yICkucmdiO1xuCQkjZWxpZiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcbgkJCXZlYzQgZW52TWFwQ29sb3IgPSB0ZXh0dXJlQ3ViZVVWKCBlbnZNYXAsIHJlZmxlY3RWZWMsIHJvdWdobmVzcyApO1xuCQkjZW5kaWZcbgkJcmV0dXJuIGVudk1hcENvbG9yLnJnYiAqIGVudk1hcEludGVuc2l0eTtcbgl9XG4jZW5kaWYiOwogIHZhciBsaWdodHNfdG9vbl9mcmFnbWVudCA9ICJUb29uTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiOyI7CiAgdmFyIGxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQgPSAidmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaWZuZGVmIEZMQVRfU0hBREVEXG4JdmFyeWluZyB2ZWMzIHZOb3JtYWw7XG4jZW5kaWZcbnN0cnVjdCBUb29uTWF0ZXJpYWwge1xuCXZlYzMgZGlmZnVzZUNvbG9yO1xufTtcbnZvaWQgUkVfRGlyZWN0X1Rvb24oIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIGNvbnN0IGluIFRvb25NYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG4JdmVjMyBpcnJhZGlhbmNlID0gZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCBnZW9tZXRyeS5ub3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICogZGlyZWN0TGlnaHQuY29sb3I7XG4JI2lmbmRlZiBQSFlTSUNBTExZX0NPUlJFQ1RfTElHSFRTXG4JCWlycmFkaWFuY2UgKj0gUEk7XG4JI2VuZGlmXG4JcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9EaWZmdXNlX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfVG9vbiggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiBHZW9tZXRyaWNDb250ZXh0IGdlb21ldHJ5LCBjb25zdCBpbiBUb29uTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuCXJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9EaWZmdXNlX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxuI2RlZmluZSBSRV9EaXJlY3QJCQkJUkVfRGlyZWN0X1Rvb25cbiNkZWZpbmUgUkVfSW5kaXJlY3REaWZmdXNlCQlSRV9JbmRpcmVjdERpZmZ1c2VfVG9vblxuI2RlZmluZSBNYXRlcmlhbF9MaWdodFByb2JlTE9EKCBtYXRlcmlhbCApCSgwKSI7CiAgdmFyIGxpZ2h0c19waG9uZ19mcmFnbWVudCA9ICJCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiO1xubWF0ZXJpYWwuc3BlY3VsYXJDb2xvciA9IHNwZWN1bGFyO1xubWF0ZXJpYWwuc3BlY3VsYXJTaGluaW5lc3MgPSBzaGluaW5lc3M7XG5tYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoID0gc3BlY3VsYXJTdHJlbmd0aDsiOwogIHZhciBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCA9ICJ2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpZm5kZWYgRkxBVF9TSEFERURcbgl2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbiNlbmRpZlxuc3RydWN0IEJsaW5uUGhvbmdNYXRlcmlhbCB7XG4JdmVjMyBkaWZmdXNlQ29sb3I7XG4JdmVjMyBzcGVjdWxhckNvbG9yO1xuCWZsb2F0IHNwZWN1bGFyU2hpbmluZXNzO1xuCWZsb2F0IHNwZWN1bGFyU3RyZW5ndGg7XG59O1xudm9pZCBSRV9EaXJlY3RfQmxpbm5QaG9uZyggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gQmxpbm5QaG9uZ01hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcbglmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKTtcbgl2ZWMzIGlycmFkaWFuY2UgPSBkb3ROTCAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuCSNpZm5kZWYgUEhZU0lDQUxMWV9DT1JSRUNUX0xJR0hUU1xuCQlpcnJhZGlhbmNlICo9IFBJO1xuCSNlbmRpZlxuCXJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfRGlmZnVzZV9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbglyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBpcnJhZGlhbmNlICogQlJERl9TcGVjdWxhcl9CbGlublBob25nKCBkaXJlY3RMaWdodCwgZ2VvbWV0cnksIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyU2hpbmluZXNzICkgKiBtYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfQmxpbm5QaG9uZyggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiBHZW9tZXRyaWNDb250ZXh0IGdlb21ldHJ5LCBjb25zdCBpbiBCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuCXJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9EaWZmdXNlX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxuI2RlZmluZSBSRV9EaXJlY3QJCQkJUkVfRGlyZWN0X0JsaW5uUGhvbmdcbiNkZWZpbmUgUkVfSW5kaXJlY3REaWZmdXNlCQlSRV9JbmRpcmVjdERpZmZ1c2VfQmxpbm5QaG9uZ1xuI2RlZmluZSBNYXRlcmlhbF9MaWdodFByb2JlTE9EKCBtYXRlcmlhbCApCSgwKSI7CiAgdmFyIGxpZ2h0c19waHlzaWNhbF9mcmFnbWVudCA9ICJQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsO1xubWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gZGlmZnVzZUNvbG9yLnJnYiAqICggMS4wIC0gbWV0YWxuZXNzRmFjdG9yICk7XG52ZWMzIGR4eSA9IG1heCggYWJzKCBkRmR4KCBnZW9tZXRyeU5vcm1hbCApICksIGFicyggZEZkeSggZ2VvbWV0cnlOb3JtYWwgKSApICk7XG5mbG9hdCBnZW9tZXRyeVJvdWdobmVzcyA9IG1heCggbWF4KCBkeHkueCwgZHh5LnkgKSwgZHh5LnogKTtcbm1hdGVyaWFsLnNwZWN1bGFyUm91Z2huZXNzID0gbWF4KCByb3VnaG5lc3NGYWN0b3IsIDAuMDUyNSApO21hdGVyaWFsLnNwZWN1bGFyUm91Z2huZXNzICs9IGdlb21ldHJ5Um91Z2huZXNzO1xubWF0ZXJpYWwuc3BlY3VsYXJSb3VnaG5lc3MgPSBtaW4oIG1hdGVyaWFsLnNwZWN1bGFyUm91Z2huZXNzLCAxLjAgKTtcbiNpZmRlZiBSRUZMRUNUSVZJVFlcbgltYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gbWl4KCB2ZWMzKCBNQVhJTVVNX1NQRUNVTEFSX0NPRUZGSUNJRU5UICogcG93MiggcmVmbGVjdGl2aXR5ICkgKSwgZGlmZnVzZUNvbG9yLnJnYiwgbWV0YWxuZXNzRmFjdG9yICk7XG4jZWxzZVxuCW1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgPSBtaXgoIHZlYzMoIERFRkFVTFRfU1BFQ1VMQVJfQ09FRkZJQ0lFTlQgKSwgZGlmZnVzZUNvbG9yLnJnYiwgbWV0YWxuZXNzRmFjdG9yICk7XG4jZW5kaWZcbiNpZmRlZiBDTEVBUkNPQVRcbgltYXRlcmlhbC5jbGVhcmNvYXQgPSBjbGVhcmNvYXQ7XG4JbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzID0gY2xlYXJjb2F0Um91Z2huZXNzO1xuCSNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG4JCW1hdGVyaWFsLmNsZWFyY29hdCAqPSB0ZXh0dXJlMkQoIGNsZWFyY29hdE1hcCwgdlV2ICkueDtcbgkjZW5kaWZcbgkjaWZkZWYgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVBcbgkJbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICo9IHRleHR1cmUyRCggY2xlYXJjb2F0Um91Z2huZXNzTWFwLCB2VXYgKS55O1xuCSNlbmRpZlxuCW1hdGVyaWFsLmNsZWFyY29hdCA9IHNhdHVyYXRlKCBtYXRlcmlhbC5jbGVhcmNvYXQgKTsJbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzID0gbWF4KCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MsIDAuMDUyNSApO1xuCW1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyArPSBnZW9tZXRyeVJvdWdobmVzcztcbgltYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgPSBtaW4oIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcywgMS4wICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5cbgltYXRlcmlhbC5zaGVlbkNvbG9yID0gc2hlZW47XG4jZW5kaWYiOwogIHZhciBsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudCA9ICJzdHJ1Y3QgUGh5c2ljYWxNYXRlcmlhbCB7XG4JdmVjMyBkaWZmdXNlQ29sb3I7XG4JZmxvYXQgc3BlY3VsYXJSb3VnaG5lc3M7XG4JdmVjMyBzcGVjdWxhckNvbG9yO1xuI2lmZGVmIENMRUFSQ09BVFxuCWZsb2F0IGNsZWFyY29hdDtcbglmbG9hdCBjbGVhcmNvYXRSb3VnaG5lc3M7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5cbgl2ZWMzIHNoZWVuQ29sb3I7XG4jZW5kaWZcbn07XG4jZGVmaW5lIE1BWElNVU1fU1BFQ1VMQVJfQ09FRkZJQ0lFTlQgMC4xNlxuI2RlZmluZSBERUZBVUxUX1NQRUNVTEFSX0NPRUZGSUNJRU5UIDAuMDRcbmZsb2F0IGNsZWFyY29hdERIUkFwcHJveCggY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiBmbG9hdCBkb3ROTCApIHtcbglyZXR1cm4gREVGQVVMVF9TUEVDVUxBUl9DT0VGRklDSUVOVCArICggMS4wIC0gREVGQVVMVF9TUEVDVUxBUl9DT0VGRklDSUVOVCApICogKCBwb3coIDEuMCAtIGRvdE5MLCA1LjAgKSAqIHBvdyggMS4wIC0gcm91Z2huZXNzLCAyLjAgKSApO1xufVxuI2lmIE5VTV9SRUNUX0FSRUFfTElHSFRTID4gMFxuCXZvaWQgUkVfRGlyZWN0X1JlY3RBcmVhX1BoeXNpY2FsKCBjb25zdCBpbiBSZWN0QXJlYUxpZ2h0IHJlY3RBcmVhTGlnaHQsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuCQl2ZWMzIG5vcm1hbCA9IGdlb21ldHJ5Lm5vcm1hbDtcbgkJdmVjMyB2aWV3RGlyID0gZ2VvbWV0cnkudmlld0RpcjtcbgkJdmVjMyBwb3NpdGlvbiA9IGdlb21ldHJ5LnBvc2l0aW9uO1xuCQl2ZWMzIGxpZ2h0UG9zID0gcmVjdEFyZWFMaWdodC5wb3NpdGlvbjtcbgkJdmVjMyBoYWxmV2lkdGggPSByZWN0QXJlYUxpZ2h0LmhhbGZXaWR0aDtcbgkJdmVjMyBoYWxmSGVpZ2h0ID0gcmVjdEFyZWFMaWdodC5oYWxmSGVpZ2h0O1xuCQl2ZWMzIGxpZ2h0Q29sb3IgPSByZWN0QXJlYUxpZ2h0LmNvbG9yO1xuCQlmbG9hdCByb3VnaG5lc3MgPSBtYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcztcbgkJdmVjMyByZWN0Q29vcmRzWyA0IF07XG4JCXJlY3RDb29yZHNbIDAgXSA9IGxpZ2h0UG9zICsgaGFsZldpZHRoIC0gaGFsZkhlaWdodDsJCXJlY3RDb29yZHNbIDEgXSA9IGxpZ2h0UG9zIC0gaGFsZldpZHRoIC0gaGFsZkhlaWdodDtcbgkJcmVjdENvb3Jkc1sgMiBdID0gbGlnaHRQb3MgLSBoYWxmV2lkdGggKyBoYWxmSGVpZ2h0O1xuCQlyZWN0Q29vcmRzWyAzIF0gPSBsaWdodFBvcyArIGhhbGZXaWR0aCArIGhhbGZIZWlnaHQ7XG4JCXZlYzIgdXYgPSBMVENfVXYoIG5vcm1hbCwgdmlld0Rpciwgcm91Z2huZXNzICk7XG4JCXZlYzQgdDEgPSB0ZXh0dXJlMkQoIGx0Y18xLCB1diApO1xuCQl2ZWM0IHQyID0gdGV4dHVyZTJEKCBsdGNfMiwgdXYgKTtcbgkJbWF0MyBtSW52ID0gbWF0MyhcbgkJCXZlYzMoIHQxLngsIDAsIHQxLnkgKSxcbgkJCXZlYzMoICAgIDAsIDEsICAgIDAgKSxcbgkJCXZlYzMoIHQxLnosIDAsIHQxLncgKVxuCQkpO1xuCQl2ZWMzIGZyZXNuZWwgPSAoIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgKiB0Mi54ICsgKCB2ZWMzKCAxLjAgKSAtIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgKSAqIHQyLnkgKTtcbgkJcmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKz0gbGlnaHRDb2xvciAqIGZyZXNuZWwgKiBMVENfRXZhbHVhdGUoIG5vcm1hbCwgdmlld0RpciwgcG9zaXRpb24sIG1JbnYsIHJlY3RDb29yZHMgKTtcbgkJcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBsaWdodENvbG9yICogbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICogTFRDX0V2YWx1YXRlKCBub3JtYWwsIHZpZXdEaXIsIHBvc2l0aW9uLCBtYXQzKCAxLjAgKSwgcmVjdENvb3JkcyApO1xuCX1cbiNlbmRpZlxudm9pZCBSRV9EaXJlY3RfUGh5c2ljYWwoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuCWZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnkubm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuCXZlYzMgaXJyYWRpYW5jZSA9IGRvdE5MICogZGlyZWN0TGlnaHQuY29sb3I7XG4JI2lmbmRlZiBQSFlTSUNBTExZX0NPUlJFQ1RfTElHSFRTXG4JCWlycmFkaWFuY2UgKj0gUEk7XG4JI2VuZGlmXG4JI2lmZGVmIENMRUFSQ09BVFxuCQlmbG9hdCBjY0RvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnkuY2xlYXJjb2F0Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuCQl2ZWMzIGNjSXJyYWRpYW5jZSA9IGNjRG90TkwgKiBkaXJlY3RMaWdodC5jb2xvcjtcbgkJI2lmbmRlZiBQSFlTSUNBTExZX0NPUlJFQ1RfTElHSFRTXG4JCQljY0lycmFkaWFuY2UgKj0gUEk7XG4JCSNlbmRpZlxuCQlmbG9hdCBjbGVhcmNvYXRESFIgPSBtYXRlcmlhbC5jbGVhcmNvYXQgKiBjbGVhcmNvYXRESFJBcHByb3goIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcywgY2NEb3ROTCApO1xuCQlyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBjY0lycmFkaWFuY2UgKiBtYXRlcmlhbC5jbGVhcmNvYXQgKiBCUkRGX1NwZWN1bGFyX0dHWCggZGlyZWN0TGlnaHQsIGdlb21ldHJ5LnZpZXdEaXIsIGdlb21ldHJ5LmNsZWFyY29hdE5vcm1hbCwgdmVjMyggREVGQVVMVF9TUEVDVUxBUl9DT0VGRklDSUVOVCApLCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgKTtcbgkjZWxzZVxuCQlmbG9hdCBjbGVhcmNvYXRESFIgPSAwLjA7XG4JI2VuZGlmXG4JI2lmZGVmIFVTRV9TSEVFTlxuCQlyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSAoIDEuMCAtIGNsZWFyY29hdERIUiApICogaXJyYWRpYW5jZSAqIEJSREZfU3BlY3VsYXJfU2hlZW4oXG4JCQltYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcyxcbgkJCWRpcmVjdExpZ2h0LmRpcmVjdGlvbixcbgkJCWdlb21ldHJ5LFxuCQkJbWF0ZXJpYWwuc2hlZW5Db2xvclxuCQkpO1xuCSNlbHNlXG4JCXJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICs9ICggMS4wIC0gY2xlYXJjb2F0REhSICkgKiBpcnJhZGlhbmNlICogQlJERl9TcGVjdWxhcl9HR1goIGRpcmVjdExpZ2h0LCBnZW9tZXRyeS52aWV3RGlyLCBnZW9tZXRyeS5ub3JtYWwsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyUm91Z2huZXNzKTtcbgkjZW5kaWZcbglyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9ICggMS4wIC0gY2xlYXJjb2F0REhSICkgKiBpcnJhZGlhbmNlICogQlJERl9EaWZmdXNlX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfUGh5c2ljYWwoIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG4JcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0RpZmZ1c2VfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG52b2lkIFJFX0luZGlyZWN0U3BlY3VsYXJfUGh5c2ljYWwoIGNvbnN0IGluIHZlYzMgcmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBjbGVhcmNvYXRSYWRpYW5jZSwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQpIHtcbgkjaWZkZWYgQ0xFQVJDT0FUXG4JCWZsb2F0IGNjRG90TlYgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeS5jbGVhcmNvYXROb3JtYWwsIGdlb21ldHJ5LnZpZXdEaXIgKSApO1xuCQlyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyICs9IGNsZWFyY29hdFJhZGlhbmNlICogbWF0ZXJpYWwuY2xlYXJjb2F0ICogQlJERl9TcGVjdWxhcl9HR1hfRW52aXJvbm1lbnQoIGdlb21ldHJ5LnZpZXdEaXIsIGdlb21ldHJ5LmNsZWFyY29hdE5vcm1hbCwgdmVjMyggREVGQVVMVF9TUEVDVUxBUl9DT0VGRklDSUVOVCApLCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgKTtcbgkJZmxvYXQgY2NEb3ROTCA9IGNjRG90TlY7XG4JCWZsb2F0IGNsZWFyY29hdERIUiA9IG1hdGVyaWFsLmNsZWFyY29hdCAqIGNsZWFyY29hdERIUkFwcHJveCggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzLCBjY0RvdE5MICk7XG4JI2Vsc2VcbgkJZmxvYXQgY2xlYXJjb2F0REhSID0gMC4wO1xuCSNlbmRpZlxuCWZsb2F0IGNsZWFyY29hdEludiA9IDEuMCAtIGNsZWFyY29hdERIUjtcbgl2ZWMzIHNpbmdsZVNjYXR0ZXJpbmcgPSB2ZWMzKCAwLjAgKTtcbgl2ZWMzIG11bHRpU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuCXZlYzMgY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlID0gaXJyYWRpYW5jZSAqIFJFQ0lQUk9DQUxfUEk7XG4JQlJERl9TcGVjdWxhcl9NdWx0aXNjYXR0ZXJpbmdfRW52aXJvbm1lbnQoIGdlb21ldHJ5LCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcywgc2luZ2xlU2NhdHRlcmluZywgbXVsdGlTY2F0dGVyaW5nICk7XG4JdmVjMyBkaWZmdXNlID0gbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICogKCAxLjAgLSAoIHNpbmdsZVNjYXR0ZXJpbmcgKyBtdWx0aVNjYXR0ZXJpbmcgKSApO1xuCXJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKz0gY2xlYXJjb2F0SW52ICogcmFkaWFuY2UgKiBzaW5nbGVTY2F0dGVyaW5nO1xuCXJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKz0gbXVsdGlTY2F0dGVyaW5nICogY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlO1xuCXJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBkaWZmdXNlICogY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlO1xufVxuI2RlZmluZSBSRV9EaXJlY3QJCQkJUkVfRGlyZWN0X1BoeXNpY2FsXG4jZGVmaW5lIFJFX0RpcmVjdF9SZWN0QXJlYQkJUkVfRGlyZWN0X1JlY3RBcmVhX1BoeXNpY2FsXG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZQkJUkVfSW5kaXJlY3REaWZmdXNlX1BoeXNpY2FsXG4jZGVmaW5lIFJFX0luZGlyZWN0U3BlY3VsYXIJCVJFX0luZGlyZWN0U3BlY3VsYXJfUGh5c2ljYWxcbmZsb2F0IGNvbXB1dGVTcGVjdWxhck9jY2x1c2lvbiggY29uc3QgaW4gZmxvYXQgZG90TlYsIGNvbnN0IGluIGZsb2F0IGFtYmllbnRPY2NsdXNpb24sIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcbglyZXR1cm4gc2F0dXJhdGUoIHBvdyggZG90TlYgKyBhbWJpZW50T2NjbHVzaW9uLCBleHAyKCAtIDE2LjAgKiByb3VnaG5lc3MgLSAxLjAgKSApIC0gMS4wICsgYW1iaWVudE9jY2x1c2lvbiApO1xufSI7CiAgdmFyIGxpZ2h0c19mcmFnbWVudF9iZWdpbiA9ICJcbkdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnk7XG5nZW9tZXRyeS5wb3NpdGlvbiA9IC0gdlZpZXdQb3NpdGlvbjtcbmdlb21ldHJ5Lm5vcm1hbCA9IG5vcm1hbDtcbmdlb21ldHJ5LnZpZXdEaXIgPSAoIGlzT3J0aG9ncmFwaGljICkgPyB2ZWMzKCAwLCAwLCAxICkgOiBub3JtYWxpemUoIHZWaWV3UG9zaXRpb24gKTtcbiNpZmRlZiBDTEVBUkNPQVRcbglnZW9tZXRyeS5jbGVhcmNvYXROb3JtYWwgPSBjbGVhcmNvYXROb3JtYWw7XG4jZW5kaWZcbkluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQ7XG4jaWYgKCBOVU1fUE9JTlRfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG4JUG9pbnRMaWdodCBwb2ludExpZ2h0O1xuCSNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG4JUG9pbnRMaWdodFNoYWRvdyBwb2ludExpZ2h0U2hhZG93O1xuCSNlbmRpZlxuCSNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcbglmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUE9JTlRfTElHSFRTOyBpICsrICkge1xuCQlwb2ludExpZ2h0ID0gcG9pbnRMaWdodHNbIGkgXTtcbgkJZ2V0UG9pbnREaXJlY3RMaWdodElycmFkaWFuY2UoIHBvaW50TGlnaHQsIGdlb21ldHJ5LCBkaXJlY3RMaWdodCApO1xuCQkjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIClcbgkJcG9pbnRMaWdodFNoYWRvdyA9IHBvaW50TGlnaHRTaGFkb3dzWyBpIF07XG4JCWRpcmVjdExpZ2h0LmNvbG9yICo9IGFsbCggYnZlYzIoIGRpcmVjdExpZ2h0LnZpc2libGUsIHJlY2VpdmVTaGFkb3cgKSApID8gZ2V0UG9pbnRTaGFkb3coIHBvaW50U2hhZG93TWFwWyBpIF0sIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dCaWFzLCBwb2ludExpZ2h0U2hhZG93LnNoYWRvd1JhZGl1cywgdlBvaW50U2hhZG93Q29vcmRbIGkgXSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dDYW1lcmFOZWFyLCBwb2ludExpZ2h0U2hhZG93LnNoYWRvd0NhbWVyYUZhciApIDogMS4wO1xuCQkjZW5kaWZcbgkJUkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuCX1cbgkjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuI2VuZGlmXG4jaWYgKCBOVU1fU1BPVF9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0IClcbglTcG90TGlnaHQgc3BvdExpZ2h0O1xuCSNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyA+IDBcbglTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93O1xuCSNlbmRpZlxuCSNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcbglmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fU1BPVF9MSUdIVFM7IGkgKysgKSB7XG4JCXNwb3RMaWdodCA9IHNwb3RMaWdodHNbIGkgXTtcbgkJZ2V0U3BvdERpcmVjdExpZ2h0SXJyYWRpYW5jZSggc3BvdExpZ2h0LCBnZW9tZXRyeSwgZGlyZWN0TGlnaHQgKTtcbgkJI2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcbgkJc3BvdExpZ2h0U2hhZG93ID0gc3BvdExpZ2h0U2hhZG93c1sgaSBdO1xuCQlkaXJlY3RMaWdodC5jb2xvciAqPSBhbGwoIGJ2ZWMyKCBkaXJlY3RMaWdodC52aXNpYmxlLCByZWNlaXZlU2hhZG93ICkgKSA/IGdldFNoYWRvdyggc3BvdFNoYWRvd01hcFsgaSBdLCBzcG90TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgc3BvdExpZ2h0U2hhZG93LnNoYWRvd0JpYXMsIHNwb3RMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZTcG90U2hhZG93Q29vcmRbIGkgXSApIDogMS4wO1xuCQkjZW5kaWZcbgkJUkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuCX1cbgkjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuI2VuZGlmXG4jaWYgKCBOVU1fRElSX0xJR0hUUyA+IDAgKSAmJiBkZWZpbmVkKCBSRV9EaXJlY3QgKVxuCURpcmVjdGlvbmFsTGlnaHQgZGlyZWN0aW9uYWxMaWdodDtcbgkjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIE5VTV9ESVJfTElHSFRfU0hBRE9XUyA+IDBcbglEaXJlY3Rpb25hbExpZ2h0U2hhZG93IGRpcmVjdGlvbmFsTGlnaHRTaGFkb3c7XG4JI2VuZGlmXG4JI3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuCWZvciAoIGludCBpID0gMDsgaSA8IE5VTV9ESVJfTElHSFRTOyBpICsrICkge1xuCQlkaXJlY3Rpb25hbExpZ2h0ID0gZGlyZWN0aW9uYWxMaWdodHNbIGkgXTtcbgkJZ2V0RGlyZWN0aW9uYWxEaXJlY3RMaWdodElycmFkaWFuY2UoIGRpcmVjdGlvbmFsTGlnaHQsIGdlb21ldHJ5LCBkaXJlY3RMaWdodCApO1xuCQkjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9ESVJfTElHSFRfU0hBRE9XUyApXG4JCWRpcmVjdGlvbmFsTGlnaHRTaGFkb3cgPSBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdO1xuCQlkaXJlY3RMaWdodC5jb2xvciAqPSBhbGwoIGJ2ZWMyKCBkaXJlY3RMaWdodC52aXNpYmxlLCByZWNlaXZlU2hhZG93ICkgKSA/IGdldFNoYWRvdyggZGlyZWN0aW9uYWxTaGFkb3dNYXBbIGkgXSwgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dNYXBTaXplLCBkaXJlY3Rpb25hbExpZ2h0U2hhZG93LnNoYWRvd0JpYXMsIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cuc2hhZG93UmFkaXVzLCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7XG4JCSNlbmRpZlxuCQlSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG4JfVxuCSNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiAoIE5VTV9SRUNUX0FSRUFfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdF9SZWN0QXJlYSApXG4JUmVjdEFyZWFMaWdodCByZWN0QXJlYUxpZ2h0O1xuCSNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcbglmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUkVDVF9BUkVBX0xJR0hUUzsgaSArKyApIHtcbgkJcmVjdEFyZWFMaWdodCA9IHJlY3RBcmVhTGlnaHRzWyBpIF07XG4JCVJFX0RpcmVjdF9SZWN0QXJlYSggcmVjdEFyZWFMaWdodCwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuCX1cbgkjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuI2VuZGlmXG4jaWYgZGVmaW5lZCggUkVfSW5kaXJlY3REaWZmdXNlIClcbgl2ZWMzIGlibElycmFkaWFuY2UgPSB2ZWMzKCAwLjAgKTtcbgl2ZWMzIGlycmFkaWFuY2UgPSBnZXRBbWJpZW50TGlnaHRJcnJhZGlhbmNlKCBhbWJpZW50TGlnaHRDb2xvciApO1xuCWlycmFkaWFuY2UgKz0gZ2V0TGlnaHRQcm9iZUlycmFkaWFuY2UoIGxpZ2h0UHJvYmUsIGdlb21ldHJ5ICk7XG4JI2lmICggTlVNX0hFTUlfTElHSFRTID4gMCApXG4JCSNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcbgkJZm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0hFTUlfTElHSFRTOyBpICsrICkge1xuCQkJaXJyYWRpYW5jZSArPSBnZXRIZW1pc3BoZXJlTGlnaHRJcnJhZGlhbmNlKCBoZW1pc3BoZXJlTGlnaHRzWyBpIF0sIGdlb21ldHJ5ICk7XG4JCX1cbgkJI3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbgkjZW5kaWZcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuCXZlYzMgcmFkaWFuY2UgPSB2ZWMzKCAwLjAgKTtcbgl2ZWMzIGNsZWFyY29hdFJhZGlhbmNlID0gdmVjMyggMC4wICk7XG4jZW5kaWYiOwogIHZhciBsaWdodHNfZnJhZ21lbnRfbWFwcyA9ICIjaWYgZGVmaW5lZCggUkVfSW5kaXJlY3REaWZmdXNlIClcbgkjaWZkZWYgVVNFX0xJR0hUTUFQXG4JCXZlYzQgbGlnaHRNYXBUZXhlbD0gdGV4dHVyZTJEKCBsaWdodE1hcCwgdlV2MiApO1xuCQl2ZWMzIGxpZ2h0TWFwSXJyYWRpYW5jZSA9IGxpZ2h0TWFwVGV4ZWxUb0xpbmVhciggbGlnaHRNYXBUZXhlbCApLnJnYiAqIGxpZ2h0TWFwSW50ZW5zaXR5O1xuCQkjaWZuZGVmIFBIWVNJQ0FMTFlfQ09SUkVDVF9MSUdIVFNcbgkJCWxpZ2h0TWFwSXJyYWRpYW5jZSAqPSBQSTtcbgkJI2VuZGlmXG4JCWlycmFkaWFuY2UgKz0gbGlnaHRNYXBJcnJhZGlhbmNlO1xuCSNlbmRpZlxuCSNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgJiYgZGVmaW5lZCggU1RBTkRBUkQgKSAmJiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcbgkJaWJsSXJyYWRpYW5jZSArPSBnZXRMaWdodFByb2JlSW5kaXJlY3RJcnJhZGlhbmNlKCBnZW9tZXRyeSwgbWF4TWlwTGV2ZWwgKTtcbgkjZW5kaWZcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSAmJiBkZWZpbmVkKCBSRV9JbmRpcmVjdFNwZWN1bGFyIClcbglyYWRpYW5jZSArPSBnZXRMaWdodFByb2JlSW5kaXJlY3RSYWRpYW5jZSggZ2VvbWV0cnkudmlld0RpciwgZ2VvbWV0cnkubm9ybWFsLCBtYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcywgbWF4TWlwTGV2ZWwgKTtcbgkjaWZkZWYgQ0xFQVJDT0FUXG4JCWNsZWFyY29hdFJhZGlhbmNlICs9IGdldExpZ2h0UHJvYmVJbmRpcmVjdFJhZGlhbmNlKCBnZW9tZXRyeS52aWV3RGlyLCBnZW9tZXRyeS5jbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcywgbWF4TWlwTGV2ZWwgKTtcbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIGxpZ2h0c19mcmFnbWVudF9lbmQgPSAiI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG4JUkVfSW5kaXJlY3REaWZmdXNlKCBpcnJhZGlhbmNlLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdFNwZWN1bGFyIClcbglSRV9JbmRpcmVjdFNwZWN1bGFyKCByYWRpYW5jZSwgaWJsSXJyYWRpYW5jZSwgY2xlYXJjb2F0UmFkaWFuY2UsIGdlb21ldHJ5LCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcbiNlbmRpZiI7CiAgdmFyIGxvZ2RlcHRoYnVmX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUYgKSAmJiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUZfRVhUIClcbglnbF9GcmFnRGVwdGhFWFQgPSB2SXNQZXJzcGVjdGl2ZSA9PSAwLjAgPyBnbF9GcmFnQ29vcmQueiA6IGxvZzIoIHZGcmFnRGVwdGggKSAqIGxvZ0RlcHRoQnVmRkMgKiAwLjU7XG4jZW5kaWYiOwogIHZhciBsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUYgKSAmJiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUZfRVhUIClcbgl1bmlmb3JtIGZsb2F0IGxvZ0RlcHRoQnVmRkM7XG4JdmFyeWluZyBmbG9hdCB2RnJhZ0RlcHRoO1xuCXZhcnlpbmcgZmxvYXQgdklzUGVyc3BlY3RpdmU7XG4jZW5kaWYiOwogIHZhciBsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0xPR0RFUFRIQlVGXG4JI2lmZGVmIFVTRV9MT0dERVBUSEJVRl9FWFRcbgkJdmFyeWluZyBmbG9hdCB2RnJhZ0RlcHRoO1xuCQl2YXJ5aW5nIGZsb2F0IHZJc1BlcnNwZWN0aXZlO1xuCSNlbHNlXG4JCXVuaWZvcm0gZmxvYXQgbG9nRGVwdGhCdWZGQztcbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIGxvZ2RlcHRoYnVmX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0xPR0RFUFRIQlVGXG4JI2lmZGVmIFVTRV9MT0dERVBUSEJVRl9FWFRcbgkJdkZyYWdEZXB0aCA9IDEuMCArIGdsX1Bvc2l0aW9uLnc7XG4JCXZJc1BlcnNwZWN0aXZlID0gZmxvYXQoIGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKSApO1xuCSNlbHNlXG4JCWlmICggaXNQZXJzcGVjdGl2ZU1hdHJpeCggcHJvamVjdGlvbk1hdHJpeCApICkge1xuCQkJZ2xfUG9zaXRpb24ueiA9IGxvZzIoIG1heCggRVBTSUxPTiwgZ2xfUG9zaXRpb24udyArIDEuMCApICkgKiBsb2dEZXB0aEJ1ZkZDIC0gMS4wO1xuCQkJZ2xfUG9zaXRpb24ueiAqPSBnbF9Qb3NpdGlvbi53O1xuCQl9XG4JI2VuZGlmXG4jZW5kaWYiOwogIHZhciBtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NQVBcbgl2ZWM0IHRleGVsQ29sb3IgPSB0ZXh0dXJlMkQoIG1hcCwgdlV2ICk7XG4JdGV4ZWxDb2xvciA9IG1hcFRleGVsVG9MaW5lYXIoIHRleGVsQ29sb3IgKTtcbglkaWZmdXNlQ29sb3IgKj0gdGV4ZWxDb2xvcjtcbiNlbmRpZiI7CiAgdmFyIG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUFQXG4JdW5pZm9ybSBzYW1wbGVyMkQgbWFwO1xuI2VuZGlmIjsKICB2YXIgbWFwX3BhcnRpY2xlX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTUFQICkgfHwgZGVmaW5lZCggVVNFX0FMUEhBTUFQIClcbgl2ZWMyIHV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIGdsX1BvaW50Q29vcmQueCwgMS4wIC0gZ2xfUG9pbnRDb29yZC55LCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcbgl2ZWM0IG1hcFRleGVsID0gdGV4dHVyZTJEKCBtYXAsIHV2ICk7XG4JZGlmZnVzZUNvbG9yICo9IG1hcFRleGVsVG9MaW5lYXIoIG1hcFRleGVsICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQUxQSEFNQVBcbglkaWZmdXNlQ29sb3IuYSAqPSB0ZXh0dXJlMkQoIGFscGhhTWFwLCB1diApLmc7XG4jZW5kaWYiOwogIHZhciBtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX01BUCApIHx8IGRlZmluZWQoIFVTRV9BTFBIQU1BUCApXG4JdW5pZm9ybSBtYXQzIHV2VHJhbnNmb3JtO1xuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuCXVuaWZvcm0gc2FtcGxlcjJEIG1hcDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuCXVuaWZvcm0gc2FtcGxlcjJEIGFscGhhTWFwO1xuI2VuZGlmIjsKICB2YXIgbWV0YWxuZXNzbWFwX2ZyYWdtZW50ID0gImZsb2F0IG1ldGFsbmVzc0ZhY3RvciA9IG1ldGFsbmVzcztcbiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG4JdmVjNCB0ZXhlbE1ldGFsbmVzcyA9IHRleHR1cmUyRCggbWV0YWxuZXNzTWFwLCB2VXYgKTtcbgltZXRhbG5lc3NGYWN0b3IgKj0gdGV4ZWxNZXRhbG5lc3MuYjtcbiNlbmRpZiI7CiAgdmFyIG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG4JdW5pZm9ybSBzYW1wbGVyMkQgbWV0YWxuZXNzTWFwO1xuI2VuZGlmIjsKICB2YXIgbW9ycGhub3JtYWxfdmVydGV4ID0gIiNpZmRlZiBVU0VfTU9SUEhOT1JNQUxTXG4Jb2JqZWN0Tm9ybWFsICo9IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcbglvYmplY3ROb3JtYWwgKz0gbW9ycGhOb3JtYWwwICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAwIF07XG4Jb2JqZWN0Tm9ybWFsICs9IG1vcnBoTm9ybWFsMSAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgMSBdO1xuCW9iamVjdE5vcm1hbCArPSBtb3JwaE5vcm1hbDIgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDIgXTtcbglvYmplY3ROb3JtYWwgKz0gbW9ycGhOb3JtYWwzICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAzIF07XG4jZW5kaWYiOwogIHZhciBtb3JwaHRhcmdldF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBIVEFSR0VUU1xuCXVuaWZvcm0gZmxvYXQgbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlO1xuCSNpZm5kZWYgVVNFX01PUlBITk9STUFMU1xuCQl1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgOCBdO1xuCSNlbHNlXG4JCXVuaWZvcm0gZmxvYXQgbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyA0IF07XG4JI2VuZGlmXG4jZW5kaWYiOwogIHZhciBtb3JwaHRhcmdldF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9NT1JQSFRBUkdFVFNcbgl0cmFuc2Zvcm1lZCAqPSBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2U7XG4JdHJhbnNmb3JtZWQgKz0gbW9ycGhUYXJnZXQwICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAwIF07XG4JdHJhbnNmb3JtZWQgKz0gbW9ycGhUYXJnZXQxICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAxIF07XG4JdHJhbnNmb3JtZWQgKz0gbW9ycGhUYXJnZXQyICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAyIF07XG4JdHJhbnNmb3JtZWQgKz0gbW9ycGhUYXJnZXQzICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAzIF07XG4JI2lmbmRlZiBVU0VfTU9SUEhOT1JNQUxTXG4JCXRyYW5zZm9ybWVkICs9IG1vcnBoVGFyZ2V0NCAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgNCBdO1xuCQl0cmFuc2Zvcm1lZCArPSBtb3JwaFRhcmdldDUgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDUgXTtcbgkJdHJhbnNmb3JtZWQgKz0gbW9ycGhUYXJnZXQ2ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyA2IF07XG4JCXRyYW5zZm9ybWVkICs9IG1vcnBoVGFyZ2V0NyAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgNyBdO1xuCSNlbmRpZlxuI2VuZGlmIjsKICB2YXIgbm9ybWFsX2ZyYWdtZW50X2JlZ2luID0gImZsb2F0IGZhY2VEaXJlY3Rpb24gPSBnbF9Gcm9udEZhY2luZyA/IDEuMCA6IC0gMS4wO1xuI2lmZGVmIEZMQVRfU0hBREVEXG4JdmVjMyBmZHggPSB2ZWMzKCBkRmR4KCB2Vmlld1Bvc2l0aW9uLnggKSwgZEZkeCggdlZpZXdQb3NpdGlvbi55ICksIGRGZHgoIHZWaWV3UG9zaXRpb24ueiApICk7XG4JdmVjMyBmZHkgPSB2ZWMzKCBkRmR5KCB2Vmlld1Bvc2l0aW9uLnggKSwgZEZkeSggdlZpZXdQb3NpdGlvbi55ICksIGRGZHkoIHZWaWV3UG9zaXRpb24ueiApICk7XG4JdmVjMyBub3JtYWwgPSBub3JtYWxpemUoIGNyb3NzKCBmZHgsIGZkeSApICk7XG4jZWxzZVxuCXZlYzMgbm9ybWFsID0gbm9ybWFsaXplKCB2Tm9ybWFsICk7XG4JI2lmZGVmIERPVUJMRV9TSURFRFxuCQlub3JtYWwgPSBub3JtYWwgKiBmYWNlRGlyZWN0aW9uO1xuCSNlbmRpZlxuCSNpZmRlZiBVU0VfVEFOR0VOVFxuCQl2ZWMzIHRhbmdlbnQgPSBub3JtYWxpemUoIHZUYW5nZW50ICk7XG4JCXZlYzMgYml0YW5nZW50ID0gbm9ybWFsaXplKCB2Qml0YW5nZW50ICk7XG4JCSNpZmRlZiBET1VCTEVfU0lERURcbgkJCXRhbmdlbnQgPSB0YW5nZW50ICogZmFjZURpcmVjdGlvbjtcbgkJCWJpdGFuZ2VudCA9IGJpdGFuZ2VudCAqIGZhY2VEaXJlY3Rpb247XG4JCSNlbmRpZlxuCQkjaWYgZGVmaW5lZCggVEFOR0VOVFNQQUNFX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQIClcbgkJCW1hdDMgdlRCTiA9IG1hdDMoIHRhbmdlbnQsIGJpdGFuZ2VudCwgbm9ybWFsICk7XG4JCSNlbmRpZlxuCSNlbmRpZlxuI2VuZGlmXG52ZWMzIGdlb21ldHJ5Tm9ybWFsID0gbm9ybWFsOyI7CiAgdmFyIG5vcm1hbF9mcmFnbWVudF9tYXBzID0gIiNpZmRlZiBPQkpFQ1RTUEFDRV9OT1JNQUxNQVBcbglub3JtYWwgPSB0ZXh0dXJlMkQoIG5vcm1hbE1hcCwgdlV2ICkueHl6ICogMi4wIC0gMS4wO1xuCSNpZmRlZiBGTElQX1NJREVEXG4JCW5vcm1hbCA9IC0gbm9ybWFsO1xuCSNlbmRpZlxuCSNpZmRlZiBET1VCTEVfU0lERURcbgkJbm9ybWFsID0gbm9ybWFsICogZmFjZURpcmVjdGlvbjtcbgkjZW5kaWZcbglub3JtYWwgPSBub3JtYWxpemUoIG5vcm1hbE1hdHJpeCAqIG5vcm1hbCApO1xuI2VsaWYgZGVmaW5lZCggVEFOR0VOVFNQQUNFX05PUk1BTE1BUCApXG4JdmVjMyBtYXBOID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZVdiApLnh5eiAqIDIuMCAtIDEuMDtcbgltYXBOLnh5ICo9IG5vcm1hbFNjYWxlO1xuCSNpZmRlZiBVU0VfVEFOR0VOVFxuCQlub3JtYWwgPSBub3JtYWxpemUoIHZUQk4gKiBtYXBOICk7XG4JI2Vsc2VcbgkJbm9ybWFsID0gcGVydHVyYk5vcm1hbDJBcmIoIC12Vmlld1Bvc2l0aW9uLCBub3JtYWwsIG1hcE4sIGZhY2VEaXJlY3Rpb24gKTtcbgkjZW5kaWZcbiNlbGlmIGRlZmluZWQoIFVTRV9CVU1QTUFQIClcbglub3JtYWwgPSBwZXJ0dXJiTm9ybWFsQXJiKCAtdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCBkSGR4eV9md2QoKSwgZmFjZURpcmVjdGlvbiApO1xuI2VuZGlmIjsKICB2YXIgbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9OT1JNQUxNQVBcbgl1bmlmb3JtIHNhbXBsZXIyRCBub3JtYWxNYXA7XG4JdW5pZm9ybSB2ZWMyIG5vcm1hbFNjYWxlO1xuI2VuZGlmXG4jaWZkZWYgT0JKRUNUU1BBQ0VfTk9STUFMTUFQXG4JdW5pZm9ybSBtYXQzIG5vcm1hbE1hdHJpeDtcbiNlbmRpZlxuI2lmICEgZGVmaW5lZCAoIFVTRV9UQU5HRU5UICkgJiYgKCBkZWZpbmVkICggVEFOR0VOVFNQQUNFX05PUk1BTE1BUCApIHx8IGRlZmluZWQgKCBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCApIClcbgl2ZWMzIHBlcnR1cmJOb3JtYWwyQXJiKCB2ZWMzIGV5ZV9wb3MsIHZlYzMgc3VyZl9ub3JtLCB2ZWMzIG1hcE4sIGZsb2F0IGZhY2VEaXJlY3Rpb24gKSB7XG4JCXZlYzMgcTAgPSB2ZWMzKCBkRmR4KCBleWVfcG9zLnggKSwgZEZkeCggZXllX3Bvcy55ICksIGRGZHgoIGV5ZV9wb3MueiApICk7XG4JCXZlYzMgcTEgPSB2ZWMzKCBkRmR5KCBleWVfcG9zLnggKSwgZEZkeSggZXllX3Bvcy55ICksIGRGZHkoIGV5ZV9wb3MueiApICk7XG4JCXZlYzIgc3QwID0gZEZkeCggdlV2LnN0ICk7XG4JCXZlYzIgc3QxID0gZEZkeSggdlV2LnN0ICk7XG4JCXZlYzMgTiA9IHN1cmZfbm9ybTtcbgkJdmVjMyBxMXBlcnAgPSBjcm9zcyggcTEsIE4gKTtcbgkJdmVjMyBxMHBlcnAgPSBjcm9zcyggTiwgcTAgKTtcbgkJdmVjMyBUID0gcTFwZXJwICogc3QwLnggKyBxMHBlcnAgKiBzdDEueDtcbgkJdmVjMyBCID0gcTFwZXJwICogc3QwLnkgKyBxMHBlcnAgKiBzdDEueTtcbgkJZmxvYXQgZGV0ID0gbWF4KCBkb3QoIFQsIFQgKSwgZG90KCBCLCBCICkgKTtcbgkJZmxvYXQgc2NhbGUgPSAoIGRldCA9PSAwLjAgKSA/IDAuMCA6IGZhY2VEaXJlY3Rpb24gKiBpbnZlcnNlc3FydCggZGV0ICk7XG4JCXJldHVybiBub3JtYWxpemUoIFQgKiAoIG1hcE4ueCAqIHNjYWxlICkgKyBCICogKCBtYXBOLnkgKiBzY2FsZSApICsgTiAqIG1hcE4ueiApO1xuCX1cbiNlbmRpZiI7CiAgdmFyIGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfYmVnaW4gPSAiI2lmZGVmIENMRUFSQ09BVFxuCXZlYzMgY2xlYXJjb2F0Tm9ybWFsID0gZ2VvbWV0cnlOb3JtYWw7XG4jZW5kaWYiOwogIHZhciBjbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X21hcHMgPSAiI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG4JdmVjMyBjbGVhcmNvYXRNYXBOID0gdGV4dHVyZTJEKCBjbGVhcmNvYXROb3JtYWxNYXAsIHZVdiApLnh5eiAqIDIuMCAtIDEuMDtcbgljbGVhcmNvYXRNYXBOLnh5ICo9IGNsZWFyY29hdE5vcm1hbFNjYWxlO1xuCSNpZmRlZiBVU0VfVEFOR0VOVFxuCQljbGVhcmNvYXROb3JtYWwgPSBub3JtYWxpemUoIHZUQk4gKiBjbGVhcmNvYXRNYXBOICk7XG4JI2Vsc2VcbgkJY2xlYXJjb2F0Tm9ybWFsID0gcGVydHVyYk5vcm1hbDJBcmIoIC0gdlZpZXdQb3NpdGlvbiwgY2xlYXJjb2F0Tm9ybWFsLCBjbGVhcmNvYXRNYXBOLCBmYWNlRGlyZWN0aW9uICk7XG4JI2VuZGlmXG4jZW5kaWYiOwogIHZhciBjbGVhcmNvYXRfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuCXVuaWZvcm0gc2FtcGxlcjJEIGNsZWFyY29hdE1hcDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQXG4JdW5pZm9ybSBzYW1wbGVyMkQgY2xlYXJjb2F0Um91Z2huZXNzTWFwO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcbgl1bmlmb3JtIHNhbXBsZXIyRCBjbGVhcmNvYXROb3JtYWxNYXA7XG4JdW5pZm9ybSB2ZWMyIGNsZWFyY29hdE5vcm1hbFNjYWxlO1xuI2VuZGlmIjsKICB2YXIgcGFja2luZyA9ICJ2ZWMzIHBhY2tOb3JtYWxUb1JHQiggY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG4JcmV0dXJuIG5vcm1hbGl6ZSggbm9ybWFsICkgKiAwLjUgKyAwLjU7XG59XG52ZWMzIHVucGFja1JHQlRvTm9ybWFsKCBjb25zdCBpbiB2ZWMzIHJnYiApIHtcbglyZXR1cm4gMi4wICogcmdiLnh5eiAtIDEuMDtcbn1cbmNvbnN0IGZsb2F0IFBhY2tVcHNjYWxlID0gMjU2LiAvIDI1NS47Y29uc3QgZmxvYXQgVW5wYWNrRG93bnNjYWxlID0gMjU1LiAvIDI1Ni47XG5jb25zdCB2ZWMzIFBhY2tGYWN0b3JzID0gdmVjMyggMjU2LiAqIDI1Ni4gKiAyNTYuLCAyNTYuICogMjU2LiwgMjU2LiApO1xuY29uc3QgdmVjNCBVbnBhY2tGYWN0b3JzID0gVW5wYWNrRG93bnNjYWxlIC8gdmVjNCggUGFja0ZhY3RvcnMsIDEuICk7XG5jb25zdCBmbG9hdCBTaGlmdFJpZ2h0OCA9IDEuIC8gMjU2LjtcbnZlYzQgcGFja0RlcHRoVG9SR0JBKCBjb25zdCBpbiBmbG9hdCB2ICkge1xuCXZlYzQgciA9IHZlYzQoIGZyYWN0KCB2ICogUGFja0ZhY3RvcnMgKSwgdiApO1xuCXIueXp3IC09IHIueHl6ICogU2hpZnRSaWdodDg7CXJldHVybiByICogUGFja1Vwc2NhbGU7XG59XG5mbG9hdCB1bnBhY2tSR0JBVG9EZXB0aCggY29uc3QgaW4gdmVjNCB2ICkge1xuCXJldHVybiBkb3QoIHYsIFVucGFja0ZhY3RvcnMgKTtcbn1cbnZlYzQgcGFjazJIYWxmVG9SR0JBKCB2ZWMyIHYgKSB7XG4JdmVjNCByID0gdmVjNCggdi54LCBmcmFjdCggdi54ICogMjU1LjAgKSwgdi55LCBmcmFjdCggdi55ICogMjU1LjAgKSk7XG4JcmV0dXJuIHZlYzQoIHIueCAtIHIueSAvIDI1NS4wLCByLnksIHIueiAtIHIudyAvIDI1NS4wLCByLncpO1xufVxudmVjMiB1bnBhY2tSR0JBVG8ySGFsZiggdmVjNCB2ICkge1xuCXJldHVybiB2ZWMyKCB2LnggKyAoIHYueSAvIDI1NS4wICksIHYueiArICggdi53IC8gMjU1LjAgKSApO1xufVxuZmxvYXQgdmlld1pUb09ydGhvZ3JhcGhpY0RlcHRoKCBjb25zdCBpbiBmbG9hdCB2aWV3WiwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuCXJldHVybiAoIHZpZXdaICsgbmVhciApIC8gKCBuZWFyIC0gZmFyICk7XG59XG5mbG9hdCBvcnRob2dyYXBoaWNEZXB0aFRvVmlld1ooIGNvbnN0IGluIGZsb2F0IGxpbmVhckNsaXBaLCBjb25zdCBpbiBmbG9hdCBuZWFyLCBjb25zdCBpbiBmbG9hdCBmYXIgKSB7XG4JcmV0dXJuIGxpbmVhckNsaXBaICogKCBuZWFyIC0gZmFyICkgLSBuZWFyO1xufVxuZmxvYXQgdmlld1pUb1BlcnNwZWN0aXZlRGVwdGgoIGNvbnN0IGluIGZsb2F0IHZpZXdaLCBjb25zdCBpbiBmbG9hdCBuZWFyLCBjb25zdCBpbiBmbG9hdCBmYXIgKSB7XG4JcmV0dXJuICgoIG5lYXIgKyB2aWV3WiApICogZmFyICkgLyAoKCBmYXIgLSBuZWFyICkgKiB2aWV3WiApO1xufVxuZmxvYXQgcGVyc3BlY3RpdmVEZXB0aFRvVmlld1ooIGNvbnN0IGluIGZsb2F0IGludkNsaXBaLCBjb25zdCBpbiBmbG9hdCBuZWFyLCBjb25zdCBpbiBmbG9hdCBmYXIgKSB7XG4JcmV0dXJuICggbmVhciAqIGZhciApIC8gKCAoIGZhciAtIG5lYXIgKSAqIGludkNsaXBaIC0gZmFyICk7XG59IjsKICB2YXIgcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudCA9ICIjaWZkZWYgUFJFTVVMVElQTElFRF9BTFBIQVxuCWdsX0ZyYWdDb2xvci5yZ2IgKj0gZ2xfRnJhZ0NvbG9yLmE7XG4jZW5kaWYiOwogIHZhciBwcm9qZWN0X3ZlcnRleCA9ICJ2ZWM0IG12UG9zaXRpb24gPSB2ZWM0KCB0cmFuc2Zvcm1lZCwgMS4wICk7XG4jaWZkZWYgVVNFX0lOU1RBTkNJTkdcbgltdlBvc2l0aW9uID0gaW5zdGFuY2VNYXRyaXggKiBtdlBvc2l0aW9uO1xuI2VuZGlmXG5tdlBvc2l0aW9uID0gbW9kZWxWaWV3TWF0cml4ICogbXZQb3NpdGlvbjtcbmdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG12UG9zaXRpb247IjsKICB2YXIgZGl0aGVyaW5nX2ZyYWdtZW50ID0gIiNpZmRlZiBESVRIRVJJTkdcbglnbF9GcmFnQ29sb3IucmdiID0gZGl0aGVyaW5nKCBnbF9GcmFnQ29sb3IucmdiICk7XG4jZW5kaWYiOwogIHZhciBkaXRoZXJpbmdfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgRElUSEVSSU5HXG4JdmVjMyBkaXRoZXJpbmcoIHZlYzMgY29sb3IgKSB7XG4JCWZsb2F0IGdyaWRfcG9zaXRpb24gPSByYW5kKCBnbF9GcmFnQ29vcmQueHkgKTtcbgkJdmVjMyBkaXRoZXJfc2hpZnRfUkdCID0gdmVjMyggMC4yNSAvIDI1NS4wLCAtMC4yNSAvIDI1NS4wLCAwLjI1IC8gMjU1LjAgKTtcbgkJZGl0aGVyX3NoaWZ0X1JHQiA9IG1peCggMi4wICogZGl0aGVyX3NoaWZ0X1JHQiwgLTIuMCAqIGRpdGhlcl9zaGlmdF9SR0IsIGdyaWRfcG9zaXRpb24gKTtcbgkJcmV0dXJuIGNvbG9yICsgZGl0aGVyX3NoaWZ0X1JHQjtcbgl9XG4jZW5kaWYiOwogIHZhciByb3VnaG5lc3NtYXBfZnJhZ21lbnQgPSAiZmxvYXQgcm91Z2huZXNzRmFjdG9yID0gcm91Z2huZXNzO1xuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcbgl2ZWM0IHRleGVsUm91Z2huZXNzID0gdGV4dHVyZTJEKCByb3VnaG5lc3NNYXAsIHZVdiApO1xuCXJvdWdobmVzc0ZhY3RvciAqPSB0ZXhlbFJvdWdobmVzcy5nO1xuI2VuZGlmIjsKICB2YXIgcm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcbgl1bmlmb3JtIHNhbXBsZXIyRCByb3VnaG5lc3NNYXA7XG4jZW5kaWYiOwogIHZhciBzaGFkb3dtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1NIQURPV01BUFxuCSNpZiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG4JCXVuaWZvcm0gc2FtcGxlcjJEIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcbgkJdmFyeWluZyB2ZWM0IHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcbgkJc3RydWN0IERpcmVjdGlvbmFsTGlnaHRTaGFkb3cge1xuCQkJZmxvYXQgc2hhZG93QmlhcztcbgkJCWZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG4JCQlmbG9hdCBzaGFkb3dSYWRpdXM7XG4JCQl2ZWMyIHNoYWRvd01hcFNpemU7XG4JCX07XG4JCXVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG4JI2VuZGlmXG4JI2lmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG4JCXVuaWZvcm0gc2FtcGxlcjJEIHNwb3RTaGFkb3dNYXBbIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgXTtcbgkJdmFyeWluZyB2ZWM0IHZTcG90U2hhZG93Q29vcmRbIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgXTtcbgkJc3RydWN0IFNwb3RMaWdodFNoYWRvdyB7XG4JCQlmbG9hdCBzaGFkb3dCaWFzO1xuCQkJZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcbgkJCWZsb2F0IHNoYWRvd1JhZGl1cztcbgkJCXZlYzIgc2hhZG93TWFwU2l6ZTtcbgkJfTtcbgkJdW5pZm9ybSBTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93c1sgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuCSNlbmRpZlxuCSNpZiBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyA+IDBcbgkJdW5pZm9ybSBzYW1wbGVyMkQgcG9pbnRTaGFkb3dNYXBbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG4JCXZhcnlpbmcgdmVjNCB2UG9pbnRTaGFkb3dDb29yZFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcbgkJc3RydWN0IFBvaW50TGlnaHRTaGFkb3cge1xuCQkJZmxvYXQgc2hhZG93QmlhcztcbgkJCWZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG4JCQlmbG9hdCBzaGFkb3dSYWRpdXM7XG4JCQl2ZWMyIHNoYWRvd01hcFNpemU7XG4JCQlmbG9hdCBzaGFkb3dDYW1lcmFOZWFyO1xuCQkJZmxvYXQgc2hhZG93Q2FtZXJhRmFyO1xuCQl9O1xuCQl1bmlmb3JtIFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodFNoYWRvd3NbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG4JI2VuZGlmXG4JZmxvYXQgdGV4dHVyZTJEQ29tcGFyZSggc2FtcGxlcjJEIGRlcHRocywgdmVjMiB1diwgZmxvYXQgY29tcGFyZSApIHtcbgkJcmV0dXJuIHN0ZXAoIGNvbXBhcmUsIHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIGRlcHRocywgdXYgKSApICk7XG4JfVxuCXZlYzIgdGV4dHVyZTJERGlzdHJpYnV0aW9uKCBzYW1wbGVyMkQgc2hhZG93LCB2ZWMyIHV2ICkge1xuCQlyZXR1cm4gdW5wYWNrUkdCQVRvMkhhbGYoIHRleHR1cmUyRCggc2hhZG93LCB1diApICk7XG4JfVxuCWZsb2F0IFZTTVNoYWRvdyAoc2FtcGxlcjJEIHNoYWRvdywgdmVjMiB1diwgZmxvYXQgY29tcGFyZSApe1xuCQlmbG9hdCBvY2NsdXNpb24gPSAxLjA7XG4JCXZlYzIgZGlzdHJpYnV0aW9uID0gdGV4dHVyZTJERGlzdHJpYnV0aW9uKCBzaGFkb3csIHV2ICk7XG4JCWZsb2F0IGhhcmRfc2hhZG93ID0gc3RlcCggY29tcGFyZSAsIGRpc3RyaWJ1dGlvbi54ICk7XG4JCWlmIChoYXJkX3NoYWRvdyAhPSAxLjAgKSB7XG4JCQlmbG9hdCBkaXN0YW5jZSA9IGNvbXBhcmUgLSBkaXN0cmlidXRpb24ueCA7XG4JCQlmbG9hdCB2YXJpYW5jZSA9IG1heCggMC4wMDAwMCwgZGlzdHJpYnV0aW9uLnkgKiBkaXN0cmlidXRpb24ueSApO1xuCQkJZmxvYXQgc29mdG5lc3NfcHJvYmFiaWxpdHkgPSB2YXJpYW5jZSAvICh2YXJpYW5jZSArIGRpc3RhbmNlICogZGlzdGFuY2UgKTsJCQlzb2Z0bmVzc19wcm9iYWJpbGl0eSA9IGNsYW1wKCAoIHNvZnRuZXNzX3Byb2JhYmlsaXR5IC0gMC4zICkgLyAoIDAuOTUgLSAwLjMgKSwgMC4wLCAxLjAgKTsJCQlvY2NsdXNpb24gPSBjbGFtcCggbWF4KCBoYXJkX3NoYWRvdywgc29mdG5lc3NfcHJvYmFiaWxpdHkgKSwgMC4wLCAxLjAgKTtcbgkJfVxuCQlyZXR1cm4gb2NjbHVzaW9uO1xuCX1cbglmbG9hdCBnZXRTaGFkb3coIHNhbXBsZXIyRCBzaGFkb3dNYXAsIHZlYzIgc2hhZG93TWFwU2l6ZSwgZmxvYXQgc2hhZG93QmlhcywgZmxvYXQgc2hhZG93UmFkaXVzLCB2ZWM0IHNoYWRvd0Nvb3JkICkge1xuCQlmbG9hdCBzaGFkb3cgPSAxLjA7XG4JCXNoYWRvd0Nvb3JkLnh5eiAvPSBzaGFkb3dDb29yZC53O1xuCQlzaGFkb3dDb29yZC56ICs9IHNoYWRvd0JpYXM7XG4JCWJ2ZWM0IGluRnJ1c3R1bVZlYyA9IGJ2ZWM0ICggc2hhZG93Q29vcmQueCA+PSAwLjAsIHNoYWRvd0Nvb3JkLnggPD0gMS4wLCBzaGFkb3dDb29yZC55ID49IDAuMCwgc2hhZG93Q29vcmQueSA8PSAxLjAgKTtcbgkJYm9vbCBpbkZydXN0dW0gPSBhbGwoIGluRnJ1c3R1bVZlYyApO1xuCQlidmVjMiBmcnVzdHVtVGVzdFZlYyA9IGJ2ZWMyKCBpbkZydXN0dW0sIHNoYWRvd0Nvb3JkLnogPD0gMS4wICk7XG4JCWJvb2wgZnJ1c3R1bVRlc3QgPSBhbGwoIGZydXN0dW1UZXN0VmVjICk7XG4JCWlmICggZnJ1c3R1bVRlc3QgKSB7XG4JCSNpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0YgKVxuCQkJdmVjMiB0ZXhlbFNpemUgPSB2ZWMyKCAxLjAgKSAvIHNoYWRvd01hcFNpemU7XG4JCQlmbG9hdCBkeDAgPSAtIHRleGVsU2l6ZS54ICogc2hhZG93UmFkaXVzO1xuCQkJZmxvYXQgZHkwID0gLSB0ZXhlbFNpemUueSAqIHNoYWRvd1JhZGl1cztcbgkJCWZsb2F0IGR4MSA9ICsgdGV4ZWxTaXplLnggKiBzaGFkb3dSYWRpdXM7XG4JCQlmbG9hdCBkeTEgPSArIHRleGVsU2l6ZS55ICogc2hhZG93UmFkaXVzO1xuCQkJZmxvYXQgZHgyID0gZHgwIC8gMi4wO1xuCQkJZmxvYXQgZHkyID0gZHkwIC8gMi4wO1xuCQkJZmxvYXQgZHgzID0gZHgxIC8gMi4wO1xuCQkJZmxvYXQgZHkzID0gZHkxIC8gMi4wO1xuCQkJc2hhZG93ID0gKFxuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDAsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDEsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIGR5MiApLCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MiApLCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDMsIGR5MiApLCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDAsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHksIHNoYWRvd0Nvb3JkLnogKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MywgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MiwgZHkzICksIHNoYWRvd0Nvb3JkLnogKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIDAuMCwgZHkzICksIHNoYWRvd0Nvb3JkLnogKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MywgZHkzICksIHNoYWRvd0Nvb3JkLnogKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgZHkxICksIHNoYWRvd0Nvb3JkLnogKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIDAuMCwgZHkxICksIHNoYWRvd0Nvb3JkLnogKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgZHkxICksIHNoYWRvd0Nvb3JkLnogKVxuCQkJKSAqICggMS4wIC8gMTcuMCApO1xuCQkjZWxpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCApXG4JCQl2ZWMyIHRleGVsU2l6ZSA9IHZlYzIoIDEuMCApIC8gc2hhZG93TWFwU2l6ZTtcbgkJCWZsb2F0IGR4ID0gdGV4ZWxTaXplLng7XG4JCQlmbG9hdCBkeSA9IHRleGVsU2l6ZS55O1xuCQkJdmVjMiB1diA9IHNoYWRvd0Nvb3JkLnh5O1xuCQkJdmVjMiBmID0gZnJhY3QoIHV2ICogc2hhZG93TWFwU2l6ZSArIDAuNSApO1xuCQkJdXYgLT0gZiAqIHRleGVsU2l6ZTtcbgkJCXNoYWRvdyA9IChcbgkJCQl0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2LCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCBkeCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDAuMCwgZHkgKSwgc2hhZG93Q29vcmQueiApICtcbgkJCQl0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdGV4ZWxTaXplLCBzaGFkb3dDb29yZC56ICkgK1xuCQkJCW1peCggdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIC1keCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSwgXG4JCQkJCSB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMi4wICogZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICksXG4JCQkJCSBmLnggKSArXG4JCQkJbWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggLWR4LCBkeSApLCBzaGFkb3dDb29yZC56ICksIFxuCQkJCQkgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCBkeSApLCBzaGFkb3dDb29yZC56ICksXG4JCQkJCSBmLnggKSArXG4JCQkJbWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAtZHkgKSwgc2hhZG93Q29vcmQueiApLCBcbgkJCQkJIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAwLjAsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcbgkJCQkJIGYueSApICtcbgkJCQltaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCBkeCwgLWR5ICksIHNoYWRvd0Nvb3JkLnogKSwgXG4JCQkJCSB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcbgkJCQkJIGYueSApICtcbgkJCQltaXgoIG1peCggdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIC1keCwgLWR5ICksIHNoYWRvd0Nvb3JkLnogKSwgXG4JCQkJCQkgIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAyLjAgKiBkeCwgLWR5ICksIHNoYWRvd0Nvb3JkLnogKSxcbgkJCQkJCSAgZi54ICksXG4JCQkJCSBtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSwgXG4JCQkJCQkgIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAyLjAgKiBkeCwgMi4wICogZHkgKSwgc2hhZG93Q29vcmQueiApLFxuCQkJCQkJICBmLnggKSxcbgkJCQkJIGYueSApXG4JCQkpICogKCAxLjAgLyA5LjAgKTtcbgkJI2VsaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfVlNNIClcbgkJCXNoYWRvdyA9IFZTTVNoYWRvdyggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSwgc2hhZG93Q29vcmQueiApO1xuCQkjZWxzZVxuCQkJc2hhZG93ID0gdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSwgc2hhZG93Q29vcmQueiApO1xuCQkjZW5kaWZcbgkJfVxuCQlyZXR1cm4gc2hhZG93O1xuCX1cbgl2ZWMyIGN1YmVUb1VWKCB2ZWMzIHYsIGZsb2F0IHRleGVsU2l6ZVkgKSB7XG4JCXZlYzMgYWJzViA9IGFicyggdiApO1xuCQlmbG9hdCBzY2FsZVRvQ3ViZSA9IDEuMCAvIG1heCggYWJzVi54LCBtYXgoIGFic1YueSwgYWJzVi56ICkgKTtcbgkJYWJzViAqPSBzY2FsZVRvQ3ViZTtcbgkJdiAqPSBzY2FsZVRvQ3ViZSAqICggMS4wIC0gMi4wICogdGV4ZWxTaXplWSApO1xuCQl2ZWMyIHBsYW5hciA9IHYueHk7XG4JCWZsb2F0IGFsbW9zdEFUZXhlbCA9IDEuNSAqIHRleGVsU2l6ZVk7XG4JCWZsb2F0IGFsbW9zdE9uZSA9IDEuMCAtIGFsbW9zdEFUZXhlbDtcbgkJaWYgKCBhYnNWLnogPj0gYWxtb3N0T25lICkge1xuCQkJaWYgKCB2LnogPiAwLjAgKVxuCQkJCXBsYW5hci54ID0gNC4wIC0gdi54O1xuCQl9IGVsc2UgaWYgKCBhYnNWLnggPj0gYWxtb3N0T25lICkge1xuCQkJZmxvYXQgc2lnblggPSBzaWduKCB2LnggKTtcbgkJCXBsYW5hci54ID0gdi56ICogc2lnblggKyAyLjAgKiBzaWduWDtcbgkJfSBlbHNlIGlmICggYWJzVi55ID49IGFsbW9zdE9uZSApIHtcbgkJCWZsb2F0IHNpZ25ZID0gc2lnbiggdi55ICk7XG4JCQlwbGFuYXIueCA9IHYueCArIDIuMCAqIHNpZ25ZICsgMi4wO1xuCQkJcGxhbmFyLnkgPSB2LnogKiBzaWduWSAtIDIuMDtcbgkJfVxuCQlyZXR1cm4gdmVjMiggMC4xMjUsIDAuMjUgKSAqIHBsYW5hciArIHZlYzIoIDAuMzc1LCAwLjc1ICk7XG4JfVxuCWZsb2F0IGdldFBvaW50U2hhZG93KCBzYW1wbGVyMkQgc2hhZG93TWFwLCB2ZWMyIHNoYWRvd01hcFNpemUsIGZsb2F0IHNoYWRvd0JpYXMsIGZsb2F0IHNoYWRvd1JhZGl1cywgdmVjNCBzaGFkb3dDb29yZCwgZmxvYXQgc2hhZG93Q2FtZXJhTmVhciwgZmxvYXQgc2hhZG93Q2FtZXJhRmFyICkge1xuCQl2ZWMyIHRleGVsU2l6ZSA9IHZlYzIoIDEuMCApIC8gKCBzaGFkb3dNYXBTaXplICogdmVjMiggNC4wLCAyLjAgKSApO1xuCQl2ZWMzIGxpZ2h0VG9Qb3NpdGlvbiA9IHNoYWRvd0Nvb3JkLnh5ejtcbgkJZmxvYXQgZHAgPSAoIGxlbmd0aCggbGlnaHRUb1Bvc2l0aW9uICkgLSBzaGFkb3dDYW1lcmFOZWFyICkgLyAoIHNoYWRvd0NhbWVyYUZhciAtIHNoYWRvd0NhbWVyYU5lYXIgKTsJCWRwICs9IHNoYWRvd0JpYXM7XG4JCXZlYzMgYmQzRCA9IG5vcm1hbGl6ZSggbGlnaHRUb1Bvc2l0aW9uICk7XG4JCSNpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0YgKSB8fCBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCApIHx8IGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1ZTTSApXG4JCQl2ZWMyIG9mZnNldCA9IHZlYzIoIC0gMSwgMSApICogc2hhZG93UmFkaXVzICogdGV4ZWxTaXplLnk7XG4JCQlyZXR1cm4gKFxuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHl5LCB0ZXhlbFNpemUueSApLCBkcCApICtcbgkJCQl0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl5eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eXgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueXl4LCB0ZXhlbFNpemUueSApLCBkcCApICtcbgkJCQl0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNELCB0ZXhlbFNpemUueSApLCBkcCApICtcbgkJCQl0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnh4eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG4JCQkJdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC55eHksIHRleGVsU2l6ZS55ICksIGRwICkgK1xuCQkJCXRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHh4LCB0ZXhlbFNpemUueSApLCBkcCApICtcbgkJCQl0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl4eCwgdGV4ZWxTaXplLnkgKSwgZHAgKVxuCQkJKSAqICggMS4wIC8gOS4wICk7XG4JCSNlbHNlXG4JCQlyZXR1cm4gdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCwgdGV4ZWxTaXplLnkgKSwgZHAgKTtcbgkJI2VuZGlmXG4JfVxuI2VuZGlmIjsKICB2YXIgc2hhZG93bWFwX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0hBRE9XTUFQXG4JI2lmIE5VTV9ESVJfTElHSFRfU0hBRE9XUyA+IDBcbgkJdW5pZm9ybSBtYXQ0IGRpcmVjdGlvbmFsU2hhZG93TWF0cml4WyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcbgkJdmFyeWluZyB2ZWM0IHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcbgkJc3RydWN0IERpcmVjdGlvbmFsTGlnaHRTaGFkb3cge1xuCQkJZmxvYXQgc2hhZG93QmlhcztcbgkJCWZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG4JCQlmbG9hdCBzaGFkb3dSYWRpdXM7XG4JCQl2ZWMyIHNoYWRvd01hcFNpemU7XG4JCX07XG4JCXVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG4JI2VuZGlmXG4JI2lmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG4JCXVuaWZvcm0gbWF0NCBzcG90U2hhZG93TWF0cml4WyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIF07XG4JCXZhcnlpbmcgdmVjNCB2U3BvdFNoYWRvd0Nvb3JkWyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIF07XG4JCXN0cnVjdCBTcG90TGlnaHRTaGFkb3cge1xuCQkJZmxvYXQgc2hhZG93QmlhcztcbgkJCWZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG4JCQlmbG9hdCBzaGFkb3dSYWRpdXM7XG4JCQl2ZWMyIHNoYWRvd01hcFNpemU7XG4JCX07XG4JCXVuaWZvcm0gU3BvdExpZ2h0U2hhZG93IHNwb3RMaWdodFNoYWRvd3NbIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgXTtcbgkjZW5kaWZcbgkjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG4JCXVuaWZvcm0gbWF0NCBwb2ludFNoYWRvd01hdHJpeFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcbgkJdmFyeWluZyB2ZWM0IHZQb2ludFNoYWRvd0Nvb3JkWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuCQlzdHJ1Y3QgUG9pbnRMaWdodFNoYWRvdyB7XG4JCQlmbG9hdCBzaGFkb3dCaWFzO1xuCQkJZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcbgkJCWZsb2F0IHNoYWRvd1JhZGl1cztcbgkJCXZlYzIgc2hhZG93TWFwU2l6ZTtcbgkJCWZsb2F0IHNoYWRvd0NhbWVyYU5lYXI7XG4JCQlmbG9hdCBzaGFkb3dDYW1lcmFGYXI7XG4JCX07XG4JCXVuaWZvcm0gUG9pbnRMaWdodFNoYWRvdyBwb2ludExpZ2h0U2hhZG93c1sgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIHNoYWRvd21hcF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TSEFET1dNQVBcbgkjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMCB8fCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMCB8fCBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyA+IDBcbgkJdmVjMyBzaGFkb3dXb3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHRyYW5zZm9ybWVkTm9ybWFsLCB2aWV3TWF0cml4ICk7XG4JCXZlYzQgc2hhZG93V29ybGRQb3NpdGlvbjtcbgkjZW5kaWZcbgkjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuCSNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcbglmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fRElSX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG4JCXNoYWRvd1dvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uICsgdmVjNCggc2hhZG93V29ybGROb3JtYWwgKiBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdLnNoYWRvd05vcm1hbEJpYXMsIDAgKTtcbgkJdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIGkgXSA9IGRpcmVjdGlvbmFsU2hhZG93TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuCX1cbgkjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuCSNlbmRpZlxuCSNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuCSNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcbglmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuCQlzaGFkb3dXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbiArIHZlYzQoIHNoYWRvd1dvcmxkTm9ybWFsICogc3BvdExpZ2h0U2hhZG93c1sgaSBdLnNoYWRvd05vcm1hbEJpYXMsIDAgKTtcbgkJdlNwb3RTaGFkb3dDb29yZFsgaSBdID0gc3BvdFNoYWRvd01hdHJpeFsgaSBdICogc2hhZG93V29ybGRQb3NpdGlvbjtcbgl9XG4JI3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbgkjZW5kaWZcbgkjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG4JI3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuCWZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuCQlzaGFkb3dXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbiArIHZlYzQoIHNoYWRvd1dvcmxkTm9ybWFsICogcG9pbnRMaWdodFNoYWRvd3NbIGkgXS5zaGFkb3dOb3JtYWxCaWFzLCAwICk7XG4JCXZQb2ludFNoYWRvd0Nvb3JkWyBpIF0gPSBwb2ludFNoYWRvd01hdHJpeFsgaSBdICogc2hhZG93V29ybGRQb3NpdGlvbjtcbgl9XG4JI3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIHNoYWRvd21hc2tfcGFyc19mcmFnbWVudCA9ICJmbG9hdCBnZXRTaGFkb3dNYXNrKCkge1xuCWZsb2F0IHNoYWRvdyA9IDEuMDtcbgkjaWZkZWYgVVNFX1NIQURPV01BUFxuCSNpZiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG4JRGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0O1xuCSNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcbglmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fRElSX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG4JCWRpcmVjdGlvbmFsTGlnaHQgPSBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdO1xuCQlzaGFkb3cgKj0gcmVjZWl2ZVNoYWRvdyA/IGdldFNoYWRvdyggZGlyZWN0aW9uYWxTaGFkb3dNYXBbIGkgXSwgZGlyZWN0aW9uYWxMaWdodC5zaGFkb3dNYXBTaXplLCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd0JpYXMsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93UmFkaXVzLCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7XG4JfVxuCSNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4JI2VuZGlmXG4JI2lmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG4JU3BvdExpZ2h0U2hhZG93IHNwb3RMaWdodDtcbgkjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG4JZm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRfU0hBRE9XUzsgaSArKyApIHtcbgkJc3BvdExpZ2h0ID0gc3BvdExpZ2h0U2hhZG93c1sgaSBdO1xuCQlzaGFkb3cgKj0gcmVjZWl2ZVNoYWRvdyA/IGdldFNoYWRvdyggc3BvdFNoYWRvd01hcFsgaSBdLCBzcG90TGlnaHQuc2hhZG93TWFwU2l6ZSwgc3BvdExpZ2h0LnNoYWRvd0JpYXMsIHNwb3RMaWdodC5zaGFkb3dSYWRpdXMsIHZTcG90U2hhZG93Q29vcmRbIGkgXSApIDogMS4wO1xuCX1cbgkjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuCSNlbmRpZlxuCSNpZiBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyA+IDBcbglQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHQ7XG4JI3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuCWZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuCQlwb2ludExpZ2h0ID0gcG9pbnRMaWdodFNoYWRvd3NbIGkgXTtcbgkJc2hhZG93ICo9IHJlY2VpdmVTaGFkb3cgPyBnZXRQb2ludFNoYWRvdyggcG9pbnRTaGFkb3dNYXBbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dNYXBTaXplLCBwb2ludExpZ2h0LnNoYWRvd0JpYXMsIHBvaW50TGlnaHQuc2hhZG93UmFkaXVzLCB2UG9pbnRTaGFkb3dDb29yZFsgaSBdLCBwb2ludExpZ2h0LnNoYWRvd0NhbWVyYU5lYXIsIHBvaW50TGlnaHQuc2hhZG93Q2FtZXJhRmFyICkgOiAxLjA7XG4JfVxuCSNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4JI2VuZGlmXG4JI2VuZGlmXG4JcmV0dXJuIHNoYWRvdztcbn0iOwogIHZhciBza2luYmFzZV92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuCW1hdDQgYm9uZU1hdFggPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueCApO1xuCW1hdDQgYm9uZU1hdFkgPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueSApO1xuCW1hdDQgYm9uZU1hdFogPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueiApO1xuCW1hdDQgYm9uZU1hdFcgPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgudyApO1xuI2VuZGlmIjsKICB2YXIgc2tpbm5pbmdfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuCXVuaWZvcm0gbWF0NCBiaW5kTWF0cml4O1xuCXVuaWZvcm0gbWF0NCBiaW5kTWF0cml4SW52ZXJzZTtcbgkjaWZkZWYgQk9ORV9URVhUVVJFXG4JCXVuaWZvcm0gaGlnaHAgc2FtcGxlcjJEIGJvbmVUZXh0dXJlO1xuCQl1bmlmb3JtIGludCBib25lVGV4dHVyZVNpemU7XG4JCW1hdDQgZ2V0Qm9uZU1hdHJpeCggY29uc3QgaW4gZmxvYXQgaSApIHtcbgkJCWZsb2F0IGogPSBpICogNC4wO1xuCQkJZmxvYXQgeCA9IG1vZCggaiwgZmxvYXQoIGJvbmVUZXh0dXJlU2l6ZSApICk7XG4JCQlmbG9hdCB5ID0gZmxvb3IoIGogLyBmbG9hdCggYm9uZVRleHR1cmVTaXplICkgKTtcbgkJCWZsb2F0IGR4ID0gMS4wIC8gZmxvYXQoIGJvbmVUZXh0dXJlU2l6ZSApO1xuCQkJZmxvYXQgZHkgPSAxLjAgLyBmbG9hdCggYm9uZVRleHR1cmVTaXplICk7XG4JCQl5ID0gZHkgKiAoIHkgKyAwLjUgKTtcbgkJCXZlYzQgdjEgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDAuNSApLCB5ICkgKTtcbgkJCXZlYzQgdjIgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDEuNSApLCB5ICkgKTtcbgkJCXZlYzQgdjMgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDIuNSApLCB5ICkgKTtcbgkJCXZlYzQgdjQgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDMuNSApLCB5ICkgKTtcbgkJCW1hdDQgYm9uZSA9IG1hdDQoIHYxLCB2MiwgdjMsIHY0ICk7XG4JCQlyZXR1cm4gYm9uZTtcbgkJfVxuCSNlbHNlXG4JCXVuaWZvcm0gbWF0NCBib25lTWF0cmljZXNbIE1BWF9CT05FUyBdO1xuCQltYXQ0IGdldEJvbmVNYXRyaXgoIGNvbnN0IGluIGZsb2F0IGkgKSB7XG4JCQltYXQ0IGJvbmUgPSBib25lTWF0cmljZXNbIGludChpKSBdO1xuCQkJcmV0dXJuIGJvbmU7XG4JCX1cbgkjZW5kaWZcbiNlbmRpZiI7CiAgdmFyIHNraW5uaW5nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG4JdmVjNCBza2luVmVydGV4ID0gYmluZE1hdHJpeCAqIHZlYzQoIHRyYW5zZm9ybWVkLCAxLjAgKTtcbgl2ZWM0IHNraW5uZWQgPSB2ZWM0KCAwLjAgKTtcbglza2lubmVkICs9IGJvbmVNYXRYICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQueDtcbglza2lubmVkICs9IGJvbmVNYXRZICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQueTtcbglza2lubmVkICs9IGJvbmVNYXRaICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQuejtcbglza2lubmVkICs9IGJvbmVNYXRXICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQudztcbgl0cmFuc2Zvcm1lZCA9ICggYmluZE1hdHJpeEludmVyc2UgKiBza2lubmVkICkueHl6O1xuI2VuZGlmIjsKICB2YXIgc2tpbm5vcm1hbF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuCW1hdDQgc2tpbk1hdHJpeCA9IG1hdDQoIDAuMCApO1xuCXNraW5NYXRyaXggKz0gc2tpbldlaWdodC54ICogYm9uZU1hdFg7XG4Jc2tpbk1hdHJpeCArPSBza2luV2VpZ2h0LnkgKiBib25lTWF0WTtcbglza2luTWF0cml4ICs9IHNraW5XZWlnaHQueiAqIGJvbmVNYXRaO1xuCXNraW5NYXRyaXggKz0gc2tpbldlaWdodC53ICogYm9uZU1hdFc7XG4Jc2tpbk1hdHJpeCA9IGJpbmRNYXRyaXhJbnZlcnNlICogc2tpbk1hdHJpeCAqIGJpbmRNYXRyaXg7XG4Jb2JqZWN0Tm9ybWFsID0gdmVjNCggc2tpbk1hdHJpeCAqIHZlYzQoIG9iamVjdE5vcm1hbCwgMC4wICkgKS54eXo7XG4JI2lmZGVmIFVTRV9UQU5HRU5UXG4JCW9iamVjdFRhbmdlbnQgPSB2ZWM0KCBza2luTWF0cml4ICogdmVjNCggb2JqZWN0VGFuZ2VudCwgMC4wICkgKS54eXo7XG4JI2VuZGlmXG4jZW5kaWYiOwogIHZhciBzcGVjdWxhcm1hcF9mcmFnbWVudCA9ICJmbG9hdCBzcGVjdWxhclN0cmVuZ3RoO1xuI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuCXZlYzQgdGV4ZWxTcGVjdWxhciA9IHRleHR1cmUyRCggc3BlY3VsYXJNYXAsIHZVdiApO1xuCXNwZWN1bGFyU3RyZW5ndGggPSB0ZXhlbFNwZWN1bGFyLnI7XG4jZWxzZVxuCXNwZWN1bGFyU3RyZW5ndGggPSAxLjA7XG4jZW5kaWYiOwogIHZhciBzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcbgl1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhck1hcDtcbiNlbmRpZiI7CiAgdmFyIHRvbmVtYXBwaW5nX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBUT05FX01BUFBJTkcgKVxuCWdsX0ZyYWdDb2xvci5yZ2IgPSB0b25lTWFwcGluZyggZ2xfRnJhZ0NvbG9yLnJnYiApO1xuI2VuZGlmIjsKICB2YXIgdG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudCA9ICIjaWZuZGVmIHNhdHVyYXRlXG4jZGVmaW5lIHNhdHVyYXRlKGEpIGNsYW1wKCBhLCAwLjAsIDEuMCApXG4jZW5kaWZcbnVuaWZvcm0gZmxvYXQgdG9uZU1hcHBpbmdFeHBvc3VyZTtcbnZlYzMgTGluZWFyVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG4JcmV0dXJuIHRvbmVNYXBwaW5nRXhwb3N1cmUgKiBjb2xvcjtcbn1cbnZlYzMgUmVpbmhhcmRUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcbgljb2xvciAqPSB0b25lTWFwcGluZ0V4cG9zdXJlO1xuCXJldHVybiBzYXR1cmF0ZSggY29sb3IgLyAoIHZlYzMoIDEuMCApICsgY29sb3IgKSApO1xufVxudmVjMyBPcHRpbWl6ZWRDaW5lb25Ub25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcbgljb2xvciAqPSB0b25lTWFwcGluZ0V4cG9zdXJlO1xuCWNvbG9yID0gbWF4KCB2ZWMzKCAwLjAgKSwgY29sb3IgLSAwLjAwNCApO1xuCXJldHVybiBwb3coICggY29sb3IgKiAoIDYuMiAqIGNvbG9yICsgMC41ICkgKSAvICggY29sb3IgKiAoIDYuMiAqIGNvbG9yICsgMS43ICkgKyAwLjA2ICksIHZlYzMoIDIuMiApICk7XG59XG52ZWMzIFJSVEFuZE9EVEZpdCggdmVjMyB2ICkge1xuCXZlYzMgYSA9IHYgKiAoIHYgKyAwLjAyNDU3ODYgKSAtIDAuMDAwMDkwNTM3O1xuCXZlYzMgYiA9IHYgKiAoIDAuOTgzNzI5ICogdiArIDAuNDMyOTUxMCApICsgMC4yMzgwODE7XG4JcmV0dXJuIGEgLyBiO1xufVxudmVjMyBBQ0VTRmlsbWljVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG4JY29uc3QgbWF0MyBBQ0VTSW5wdXRNYXQgPSBtYXQzKFxuCQl2ZWMzKCAwLjU5NzE5LCAwLjA3NjAwLCAwLjAyODQwICksCQl2ZWMzKCAwLjM1NDU4LCAwLjkwODM0LCAwLjEzMzgzICksXG4JCXZlYzMoIDAuMDQ4MjMsIDAuMDE1NjYsIDAuODM3NzcgKVxuCSk7XG4JY29uc3QgbWF0MyBBQ0VTT3V0cHV0TWF0ID0gbWF0MyhcbgkJdmVjMyggIDEuNjA0NzUsIC0wLjEwMjA4LCAtMC4wMDMyNyApLAkJdmVjMyggLTAuNTMxMDgsICAxLjEwODEzLCAtMC4wNzI3NiApLFxuCQl2ZWMzKCAtMC4wNzM2NywgLTAuMDA2MDUsICAxLjA3NjAyIClcbgkpO1xuCWNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmUgLyAwLjY7XG4JY29sb3IgPSBBQ0VTSW5wdXRNYXQgKiBjb2xvcjtcbgljb2xvciA9IFJSVEFuZE9EVEZpdCggY29sb3IgKTtcbgljb2xvciA9IEFDRVNPdXRwdXRNYXQgKiBjb2xvcjtcbglyZXR1cm4gc2F0dXJhdGUoIGNvbG9yICk7XG59XG52ZWMzIEN1c3RvbVRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkgeyByZXR1cm4gY29sb3I7IH0iOwogIHZhciB0cmFuc21pc3Npb25fZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cbglmbG9hdCB0cmFuc21pc3Npb25GYWN0b3IgPSB0cmFuc21pc3Npb247XG4JZmxvYXQgdGhpY2tuZXNzRmFjdG9yID0gdGhpY2tuZXNzO1xuCSNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OTUFQXG4JCXRyYW5zbWlzc2lvbkZhY3RvciAqPSB0ZXh0dXJlMkQoIHRyYW5zbWlzc2lvbk1hcCwgdlV2ICkucjtcbgkjZW5kaWZcbgkjaWZkZWYgVVNFX1RISUNLTkVTU05NQVBcbgkJdGhpY2tuZXNzRmFjdG9yICo9IHRleHR1cmUyRCggdGhpY2tuZXNzTWFwLCB2VXYgKS5nO1xuCSNlbmRpZlxuCXZlYzMgcG9zID0gdldvcmxkUG9zaXRpb24ueHl6IC8gdldvcmxkUG9zaXRpb24udztcbgl2ZWMzIHYgPSBub3JtYWxpemUoIGNhbWVyYVBvc2l0aW9uIC0gcG9zICk7XG4JZmxvYXQgaW9yID0gKCAxLjAgKyAwLjQgKiByZWZsZWN0aXZpdHkgKSAvICggMS4wIC0gMC40ICogcmVmbGVjdGl2aXR5ICk7XG4JdmVjMyB0cmFuc21pc3Npb24gPSB0cmFuc21pc3Npb25GYWN0b3IgKiBnZXRJQkxWb2x1bWVSZWZyYWN0aW9uKFxuCQlub3JtYWwsIHYsIHJvdWdobmVzc0ZhY3RvciwgbWF0ZXJpYWwuZGlmZnVzZUNvbG9yLCB0b3RhbFNwZWN1bGFyLFxuCQlwb3MsIG1vZGVsTWF0cml4LCB2aWV3TWF0cml4LCBwcm9qZWN0aW9uTWF0cml4LCBpb3IsIHRoaWNrbmVzc0ZhY3RvcixcbgkJYXR0ZW51YXRpb25Db2xvciwgYXR0ZW51YXRpb25EaXN0YW5jZSApO1xuCXRvdGFsRGlmZnVzZSA9IG1peCggdG90YWxEaWZmdXNlLCB0cmFuc21pc3Npb24sIHRyYW5zbWlzc2lvbkZhY3RvciApO1xuI2VuZGlmIjsKICB2YXIgdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cbgkjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuCQl1bmlmb3JtIHNhbXBsZXIyRCB0cmFuc21pc3Npb25NYXA7XG4JI2VuZGlmXG4JI2lmZGVmIFVTRV9USElDS05FU1NNQVBcbgkJdW5pZm9ybSBzYW1wbGVyMkQgdGhpY2tuZXNzTWFwO1xuCSNlbmRpZlxuCXVuaWZvcm0gdmVjMiB0cmFuc21pc3Npb25TYW1wbGVyU2l6ZTtcbgl1bmlmb3JtIHNhbXBsZXIyRCB0cmFuc21pc3Npb25TYW1wbGVyTWFwO1xuCXVuaWZvcm0gbWF0NCBtb2RlbE1hdHJpeDtcbgl1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDtcbgl2YXJ5aW5nIHZlYzQgdldvcmxkUG9zaXRpb247XG4JdmVjMyBnZXRWb2x1bWVUcmFuc21pc3Npb25SYXkodmVjMyBuLCB2ZWMzIHYsIGZsb2F0IHRoaWNrbmVzcywgZmxvYXQgaW9yLCBtYXQ0IG1vZGVsTWF0cml4KSB7XG4JCXZlYzMgcmVmcmFjdGlvblZlY3RvciA9IHJlZnJhY3QoLXYsIG5vcm1hbGl6ZShuKSwgMS4wIC8gaW9yKTtcbgkJdmVjMyBtb2RlbFNjYWxlO1xuCQltb2RlbFNjYWxlLnggPSBsZW5ndGgodmVjMyhtb2RlbE1hdHJpeFswXS54eXopKTtcbgkJbW9kZWxTY2FsZS55ID0gbGVuZ3RoKHZlYzMobW9kZWxNYXRyaXhbMV0ueHl6KSk7XG4JCW1vZGVsU2NhbGUueiA9IGxlbmd0aCh2ZWMzKG1vZGVsTWF0cml4WzJdLnh5eikpO1xuCQlyZXR1cm4gbm9ybWFsaXplKHJlZnJhY3Rpb25WZWN0b3IpICogdGhpY2tuZXNzICogbW9kZWxTY2FsZTtcbgl9XG4JZmxvYXQgYXBwbHlJb3JUb1JvdWdobmVzcyhmbG9hdCByb3VnaG5lc3MsIGZsb2F0IGlvcikge1xuCQlyZXR1cm4gcm91Z2huZXNzICogY2xhbXAoaW9yICogMi4wIC0gMi4wLCAwLjAsIDEuMCk7XG4JfVxuCXZlYzMgZ2V0VHJhbnNtaXNzaW9uU2FtcGxlKHZlYzIgZnJhZ0Nvb3JkLCBmbG9hdCByb3VnaG5lc3MsIGZsb2F0IGlvcikge1xuCQlmbG9hdCBmcmFtZWJ1ZmZlckxvZCA9IGxvZzIodHJhbnNtaXNzaW9uU2FtcGxlclNpemUueCkgKiBhcHBseUlvclRvUm91Z2huZXNzKHJvdWdobmVzcywgaW9yKTtcbgkJcmV0dXJuIHRleHR1cmUyRExvZEVYVCh0cmFuc21pc3Npb25TYW1wbGVyTWFwLCBmcmFnQ29vcmQueHksIGZyYW1lYnVmZmVyTG9kKS5yZ2I7XG4JfVxuCXZlYzMgYXBwbHlWb2x1bWVBdHRlbnVhdGlvbih2ZWMzIHJhZGlhbmNlLCBmbG9hdCB0cmFuc21pc3Npb25EaXN0YW5jZSwgdmVjMyBhdHRlbnVhdGlvbkNvbG9yLCBmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlKSB7XG4JCWlmIChhdHRlbnVhdGlvbkRpc3RhbmNlID09IDAuMCkge1xuCQkJcmV0dXJuIHJhZGlhbmNlO1xuCQl9IGVsc2Uge1xuCQkJdmVjMyBhdHRlbnVhdGlvbkNvZWZmaWNpZW50ID0gLWxvZyhhdHRlbnVhdGlvbkNvbG9yKSAvIGF0dGVudWF0aW9uRGlzdGFuY2U7XG4JCQl2ZWMzIHRyYW5zbWl0dGFuY2UgPSBleHAoLWF0dGVudWF0aW9uQ29lZmZpY2llbnQgKiB0cmFuc21pc3Npb25EaXN0YW5jZSk7CQkJcmV0dXJuIHRyYW5zbWl0dGFuY2UgKiByYWRpYW5jZTtcbgkJfVxuCX1cbgl2ZWMzIGdldElCTFZvbHVtZVJlZnJhY3Rpb24odmVjMyBuLCB2ZWMzIHYsIGZsb2F0IHBlcmNlcHR1YWxSb3VnaG5lc3MsIHZlYzMgYmFzZUNvbG9yLCB2ZWMzIHNwZWN1bGFyQ29sb3IsXG4JCXZlYzMgcG9zaXRpb24sIG1hdDQgbW9kZWxNYXRyaXgsIG1hdDQgdmlld01hdHJpeCwgbWF0NCBwcm9qTWF0cml4LCBmbG9hdCBpb3IsIGZsb2F0IHRoaWNrbmVzcyxcbgkJdmVjMyBhdHRlbnVhdGlvbkNvbG9yLCBmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlKSB7XG4JCXZlYzMgdHJhbnNtaXNzaW9uUmF5ID0gZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KG4sIHYsIHRoaWNrbmVzcywgaW9yLCBtb2RlbE1hdHJpeCk7XG4JCXZlYzMgcmVmcmFjdGVkUmF5RXhpdCA9IHBvc2l0aW9uICsgdHJhbnNtaXNzaW9uUmF5O1xuCQl2ZWM0IG5kY1BvcyA9IHByb2pNYXRyaXggKiB2aWV3TWF0cml4ICogdmVjNChyZWZyYWN0ZWRSYXlFeGl0LCAxLjApO1xuCQl2ZWMyIHJlZnJhY3Rpb25Db29yZHMgPSBuZGNQb3MueHkgLyBuZGNQb3MudztcbgkJcmVmcmFjdGlvbkNvb3JkcyArPSAxLjA7XG4JCXJlZnJhY3Rpb25Db29yZHMgLz0gMi4wO1xuCQl2ZWMzIHRyYW5zbWl0dGVkTGlnaHQgPSBnZXRUcmFuc21pc3Npb25TYW1wbGUocmVmcmFjdGlvbkNvb3JkcywgcGVyY2VwdHVhbFJvdWdobmVzcywgaW9yKTtcbgkJdmVjMyBhdHRlbnVhdGVkQ29sb3IgPSBhcHBseVZvbHVtZUF0dGVudWF0aW9uKHRyYW5zbWl0dGVkTGlnaHQsIGxlbmd0aCh0cmFuc21pc3Npb25SYXkpLCBhdHRlbnVhdGlvbkNvbG9yLCBhdHRlbnVhdGlvbkRpc3RhbmNlKTtcbgkJcmV0dXJuICgxLjAgLSBzcGVjdWxhckNvbG9yKSAqIGF0dGVudWF0ZWRDb2xvciAqIGJhc2VDb2xvcjtcbgl9XG4jZW5kaWYiOwogIHZhciB1dl9wYXJzX2ZyYWdtZW50ID0gIiNpZiAoIGRlZmluZWQoIFVTRV9VViApICYmICEgZGVmaW5lZCggVVZTX1ZFUlRFWF9PTkxZICkgKVxuCXZhcnlpbmcgdmVjMiB2VXY7XG4jZW5kaWYiOwogIHZhciB1dl9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1VWXG4JI2lmZGVmIFVWU19WRVJURVhfT05MWVxuCQl2ZWMyIHZVdjtcbgkjZWxzZVxuCQl2YXJ5aW5nIHZlYzIgdlV2O1xuCSNlbmRpZlxuCXVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcbiNlbmRpZiI7CiAgdmFyIHV2X3ZlcnRleCA9ICIjaWZkZWYgVVNFX1VWXG4JdlV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIHV2LCAxICkgKS54eTtcbiNlbmRpZiI7CiAgdmFyIHV2Ml9wYXJzX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTElHSFRNQVAgKSB8fCBkZWZpbmVkKCBVU0VfQU9NQVAgKVxuCXZhcnlpbmcgdmVjMiB2VXYyO1xuI2VuZGlmIjsKICB2YXIgdXYyX3BhcnNfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfTElHSFRNQVAgKSB8fCBkZWZpbmVkKCBVU0VfQU9NQVAgKVxuCWF0dHJpYnV0ZSB2ZWMyIHV2Mjtcbgl2YXJ5aW5nIHZlYzIgdlV2Mjtcbgl1bmlmb3JtIG1hdDMgdXYyVHJhbnNmb3JtO1xuI2VuZGlmIjsKICB2YXIgdXYyX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0xJR0hUTUFQICkgfHwgZGVmaW5lZCggVVNFX0FPTUFQIClcbgl2VXYyID0gKCB1djJUcmFuc2Zvcm0gKiB2ZWMzKCB1djIsIDEgKSApLnh5O1xuI2VuZGlmIjsKICB2YXIgd29ybGRwb3NfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgfHwgZGVmaW5lZCggRElTVEFOQ0UgKSB8fCBkZWZpbmVkICggVVNFX1NIQURPV01BUCApIHx8IGRlZmluZWQgKCBVU0VfVFJBTlNNSVNTSU9OIClcbgl2ZWM0IHdvcmxkUG9zaXRpb24gPSB2ZWM0KCB0cmFuc2Zvcm1lZCwgMS4wICk7XG4JI2lmZGVmIFVTRV9JTlNUQU5DSU5HXG4JCXdvcmxkUG9zaXRpb24gPSBpbnN0YW5jZU1hdHJpeCAqIHdvcmxkUG9zaXRpb247XG4JI2VuZGlmXG4Jd29ybGRQb3NpdGlvbiA9IG1vZGVsTWF0cml4ICogd29ybGRQb3NpdGlvbjtcbiNlbmRpZiI7CiAgdmFyIGJhY2tncm91bmRfZnJhZyA9ICJ1bmlmb3JtIHNhbXBsZXIyRCB0MkQ7XG52YXJ5aW5nIHZlYzIgdlV2O1xudm9pZCBtYWluKCkge1xuCXZlYzQgdGV4Q29sb3IgPSB0ZXh0dXJlMkQoIHQyRCwgdlV2ICk7XG4JZ2xfRnJhZ0NvbG9yID0gbWFwVGV4ZWxUb0xpbmVhciggdGV4Q29sb3IgKTtcbgkjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGVuY29kaW5nc19mcmFnbWVudD5cbn0iOwogIHZhciBiYWNrZ3JvdW5kX3ZlcnQgPSAidmFyeWluZyB2ZWMyIHZVdjtcbnVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcbnZvaWQgbWFpbigpIHtcbgl2VXYgPSAoIHV2VHJhbnNmb3JtICogdmVjMyggdXYsIDEgKSApLnh5O1xuCWdsX1Bvc2l0aW9uID0gdmVjNCggcG9zaXRpb24ueHksIDEuMCwgMS4wICk7XG59IjsKICB2YXIgY3ViZV9mcmFnID0gIiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG52YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcbgl2ZWMzIHZSZWZsZWN0ID0gdldvcmxkRGlyZWN0aW9uO1xuCSNpbmNsdWRlIDxlbnZtYXBfZnJhZ21lbnQ+XG4JZ2xfRnJhZ0NvbG9yID0gZW52Q29sb3I7XG4JZ2xfRnJhZ0NvbG9yLmEgKj0gb3BhY2l0eTtcbgkjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGVuY29kaW5nc19mcmFnbWVudD5cbn0iOwogIHZhciBjdWJlX3ZlcnQgPSAidmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG52b2lkIG1haW4oKSB7XG4JdldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcbgkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuCSNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cbglnbF9Qb3NpdGlvbi56ID0gZ2xfUG9zaXRpb24udztcbn0iOwogIHZhciBkZXB0aF9mcmFnID0gIiNpZiBERVBUSF9QQUNLSU5HID09IDMyMDBcbgl1bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZhcnlpbmcgdmVjMiB2SGlnaFByZWNpc2lvblpXO1xudm9pZCBtYWluKCkge1xuCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG4JdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCAxLjAgKTtcbgkjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG4JCWRpZmZ1c2VDb2xvci5hID0gb3BhY2l0eTtcbgkjZW5kaWZcbgkjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cbglmbG9hdCBmcmFnQ29vcmRaID0gMC41ICogdkhpZ2hQcmVjaXNpb25aV1swXSAvIHZIaWdoUHJlY2lzaW9uWldbMV0gKyAwLjU7XG4JI2lmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMFxuCQlnbF9GcmFnQ29sb3IgPSB2ZWM0KCB2ZWMzKCAxLjAgLSBmcmFnQ29vcmRaICksIG9wYWNpdHkgKTtcbgkjZWxpZiBERVBUSF9QQUNLSU5HID09IDMyMDFcbgkJZ2xfRnJhZ0NvbG9yID0gcGFja0RlcHRoVG9SR0JBKCBmcmFnQ29vcmRaICk7XG4JI2VuZGlmXG59IjsKICB2YXIgZGVwdGhfdmVydCA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52YXJ5aW5nIHZlYzIgdkhpZ2hQcmVjaXNpb25aVztcbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8dXZfdmVydGV4PlxuCSNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG4JI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcbgkJI2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cbgkJI2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cbgkJI2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuCSNlbmRpZlxuCSNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cbgkjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuCSNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfdmVydGV4PlxuCSNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cbgkjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuCXZIaWdoUHJlY2lzaW9uWlcgPSBnbF9Qb3NpdGlvbi56dztcbn0iOwogIHZhciBkaXN0YW5jZVJHQkFfZnJhZyA9ICIjZGVmaW5lIERJU1RBTkNFXG51bmlmb3JtIHZlYzMgcmVmZXJlbmNlUG9zaXRpb247XG51bmlmb3JtIGZsb2F0IG5lYXJEaXN0YW5jZTtcbnVuaWZvcm0gZmxvYXQgZmFyRGlzdGFuY2U7XG52YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluICgpIHtcbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuCXZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggMS4wICk7XG4JI2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cbglmbG9hdCBkaXN0ID0gbGVuZ3RoKCB2V29ybGRQb3NpdGlvbiAtIHJlZmVyZW5jZVBvc2l0aW9uICk7XG4JZGlzdCA9ICggZGlzdCAtIG5lYXJEaXN0YW5jZSApIC8gKCBmYXJEaXN0YW5jZSAtIG5lYXJEaXN0YW5jZSApO1xuCWRpc3QgPSBzYXR1cmF0ZSggZGlzdCApO1xuCWdsX0ZyYWdDb2xvciA9IHBhY2tEZXB0aFRvUkdCQSggZGlzdCApO1xufSI7CiAgdmFyIGRpc3RhbmNlUkdCQV92ZXJ0ID0gIiNkZWZpbmUgRElTVEFOQ0VcbnZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8dXZfdmVydGV4PlxuCSNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG4JI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcbgkJI2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cbgkJI2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cbgkJI2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuCSNlbmRpZlxuCSNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cbgkjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuCSNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfdmVydGV4PlxuCSNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cbgkjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuCXZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG59IjsKICB2YXIgZXF1aXJlY3RfZnJhZyA9ICJ1bmlmb3JtIHNhbXBsZXIyRCB0RXF1aXJlY3Q7XG52YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcbgl2ZWMzIGRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggdldvcmxkRGlyZWN0aW9uICk7XG4JdmVjMiBzYW1wbGVVViA9IGVxdWlyZWN0VXYoIGRpcmVjdGlvbiApO1xuCXZlYzQgdGV4Q29sb3IgPSB0ZXh0dXJlMkQoIHRFcXVpcmVjdCwgc2FtcGxlVVYgKTtcbglnbF9GcmFnQ29sb3IgPSBtYXBUZXhlbFRvTGluZWFyKCB0ZXhDb2xvciApO1xuCSNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cbgkjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxufSI7CiAgdmFyIGVxdWlyZWN0X3ZlcnQgPSAidmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG52b2lkIG1haW4oKSB7XG4JdldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcbgkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuCSNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cbn0iOwogIHZhciBsaW5lZGFzaGVkX2ZyYWcgPSAidW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG51bmlmb3JtIGZsb2F0IGRhc2hTaXplO1xudW5pZm9ybSBmbG9hdCB0b3RhbFNpemU7XG52YXJ5aW5nIGZsb2F0IHZMaW5lRGlzdGFuY2U7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuCWlmICggbW9kKCB2TGluZURpc3RhbmNlLCB0b3RhbFNpemUgKSA+IGRhc2hTaXplICkge1xuCQlkaXNjYXJkO1xuCX1cbgl2ZWMzIG91dGdvaW5nTGlnaHQgPSB2ZWMzKCAwLjAgKTtcbgl2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcbgkjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuCW91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiO1xuCWdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7XG4JI2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxlbmNvZGluZ3NfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbgkjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cbn0iOwogIHZhciBsaW5lZGFzaGVkX3ZlcnQgPSAidW5pZm9ybSBmbG9hdCBzY2FsZTtcbmF0dHJpYnV0ZSBmbG9hdCBsaW5lRGlzdGFuY2U7XG52YXJ5aW5nIGZsb2F0IHZMaW5lRGlzdGFuY2U7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG4JdkxpbmVEaXN0YW5jZSA9IHNjYWxlICogbGluZURpc3RhbmNlO1xuCSNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cbgkjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuCSNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cbgkjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuCSNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CiAgdmFyIG1lc2hiYXNpY19mcmFnID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuCXZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1djJfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuCXZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuCSNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8c3BlY3VsYXJtYXBfZnJhZ21lbnQ+XG4JUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcbgkjaWZkZWYgVVNFX0xJR0hUTUFQXG4JXG4JCXZlYzQgbGlnaHRNYXBUZXhlbD0gdGV4dHVyZTJEKCBsaWdodE1hcCwgdlV2MiApO1xuCQlyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gbGlnaHRNYXBUZXhlbFRvTGluZWFyKCBsaWdodE1hcFRleGVsICkucmdiICogbGlnaHRNYXBJbnRlbnNpdHk7XG4JI2Vsc2VcbgkJcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IHZlYzMoIDEuMCApO1xuCSNlbmRpZlxuCSNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cbglyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKj0gZGlmZnVzZUNvbG9yLnJnYjtcbgl2ZWMzIG91dGdvaW5nTGlnaHQgPSByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2U7XG4JI2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cbglnbF9GcmFnQ29sb3IgPSB2ZWM0KCBvdXRnb2luZ0xpZ2h0LCBkaWZmdXNlQ29sb3IuYSApO1xuCSNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cbgkjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwogIHZhciBtZXNoYmFzaWNfdmVydCA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2Ml9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8dXZfdmVydGV4PlxuCSNpbmNsdWRlIDx1djJfdmVydGV4PlxuCSNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cbgkjaWZkZWYgVVNFX0VOVk1BUFxuCSNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cbgkjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuCSNlbmRpZlxuCSNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cbgkjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuCSNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cbgkjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuCSNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG4JI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG4JI2luY2x1ZGUgPGVudm1hcF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKICB2YXIgbWVzaGxhbWJlcnRfZnJhZyA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gdmVjMyBlbWlzc2l2ZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnZhcnlpbmcgdmVjMyB2TGlnaHRGcm9udDtcbnZhcnlpbmcgdmVjMyB2SW5kaXJlY3RGcm9udDtcbiNpZmRlZiBET1VCTEVfU0lERURcbgl2YXJ5aW5nIHZlYzMgdkxpZ2h0QmFjaztcbgl2YXJ5aW5nIHZlYzMgdkluZGlyZWN0QmFjaztcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1djJfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFza19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuCXZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuCVJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG4JdmVjMyB0b3RhbEVtaXNzaXZlUmFkaWFuY2UgPSBlbWlzc2l2ZTtcbgkjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPHNwZWN1bGFybWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9mcmFnbWVudD5cbgkjaWZkZWYgRE9VQkxFX1NJREVEXG4JCXJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSAoIGdsX0Zyb250RmFjaW5nICkgPyB2SW5kaXJlY3RGcm9udCA6IHZJbmRpcmVjdEJhY2s7XG4JI2Vsc2VcbgkJcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IHZJbmRpcmVjdEZyb250O1xuCSNlbmRpZlxuCSNpbmNsdWRlIDxsaWdodG1hcF9mcmFnbWVudD5cbglyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKj0gQlJERl9EaWZmdXNlX0xhbWJlcnQoIGRpZmZ1c2VDb2xvci5yZ2IgKTtcbgkjaWZkZWYgRE9VQkxFX1NJREVEXG4JCXJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgPSAoIGdsX0Zyb250RmFjaW5nICkgPyB2TGlnaHRGcm9udCA6IHZMaWdodEJhY2s7XG4JI2Vsc2VcbgkJcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSA9IHZMaWdodEZyb250O1xuCSNlbmRpZlxuCXJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKj0gQlJERl9EaWZmdXNlX0xhbWJlcnQoIGRpZmZ1c2VDb2xvci5yZ2IgKSAqIGdldFNoYWRvd01hc2soKTtcbgkjaW5jbHVkZSA8YW9tYXBfZnJhZ21lbnQ+XG4JdmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcbgkjaW5jbHVkZSA8ZW52bWFwX2ZyYWdtZW50PlxuCWdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7XG4JI2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxlbmNvZGluZ3NfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbgkjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cbgkjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PlxufSI7CiAgdmFyIG1lc2hsYW1iZXJ0X3ZlcnQgPSAiI2RlZmluZSBMQU1CRVJUXG52YXJ5aW5nIHZlYzMgdkxpZ2h0RnJvbnQ7XG52YXJ5aW5nIHZlYzMgdkluZGlyZWN0RnJvbnQ7XG4jaWZkZWYgRE9VQkxFX1NJREVEXG4JdmFyeWluZyB2ZWMzIHZMaWdodEJhY2s7XG4JdmFyeWluZyB2ZWMzIHZJbmRpcmVjdEJhY2s7XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXYyX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8dXZfdmVydGV4PlxuCSNpbmNsdWRlIDx1djJfdmVydGV4PlxuCSNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cbgkjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cbgkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuCSNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cbgkjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cbgkjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuCSNpbmNsdWRlIDxlbnZtYXBfdmVydGV4PlxuCSNpbmNsdWRlIDxsaWdodHNfbGFtYmVydF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKICB2YXIgbWVzaG1hdGNhcF9mcmFnID0gIiNkZWZpbmUgTUFUQ0FQXG51bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnVuaWZvcm0gc2FtcGxlcjJEIG1hdGNhcDtcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuCXZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG4JdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG4JI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG4JI2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuCXZlYzMgdmlld0RpciA9IG5vcm1hbGl6ZSggdlZpZXdQb3NpdGlvbiApO1xuCXZlYzMgeCA9IG5vcm1hbGl6ZSggdmVjMyggdmlld0Rpci56LCAwLjAsIC0gdmlld0Rpci54ICkgKTtcbgl2ZWMzIHkgPSBjcm9zcyggdmlld0RpciwgeCApO1xuCXZlYzIgdXYgPSB2ZWMyKCBkb3QoIHgsIG5vcm1hbCApLCBkb3QoIHksIG5vcm1hbCApICkgKiAwLjQ5NSArIDAuNTtcbgkjaWZkZWYgVVNFX01BVENBUFxuCQl2ZWM0IG1hdGNhcENvbG9yID0gdGV4dHVyZTJEKCBtYXRjYXAsIHV2ICk7XG4JCW1hdGNhcENvbG9yID0gbWF0Y2FwVGV4ZWxUb0xpbmVhciggbWF0Y2FwQ29sb3IgKTtcbgkjZWxzZVxuCQl2ZWM0IG1hdGNhcENvbG9yID0gdmVjNCggMS4wICk7XG4JI2VuZGlmXG4JdmVjMyBvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYiAqIG1hdGNhcENvbG9yLnJnYjtcbglnbF9GcmFnQ29sb3IgPSB2ZWM0KCBvdXRnb2luZ0xpZ2h0LCBkaWZmdXNlQ29sb3IuYSApO1xuCSNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cbgkjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwogIHZhciBtZXNobWF0Y2FwX3ZlcnQgPSAiI2RlZmluZSBNQVRDQVBcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuCXZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuCSNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cbgkjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cbgkjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuCSNpZm5kZWYgRkxBVF9TSEFERURcbgkJdk5vcm1hbCA9IG5vcm1hbGl6ZSggdHJhbnNmb3JtZWROb3JtYWwgKTtcbgkjZW5kaWZcbgkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuCSNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cbgkjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cbgkjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cbgkjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbgl2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbn0iOwogIHZhciBtZXNodG9vbl9mcmFnID0gIiNkZWZpbmUgVE9PTlxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2Ml9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Z3JhZGllbnRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG4JdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG4JUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcbgl2ZWMzIHRvdGFsRW1pc3NpdmVSYWRpYW5jZSA9IGVtaXNzaXZlO1xuCSNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuCSNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cbgkjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGxpZ2h0c190b29uX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG4JI2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuCSNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfZW5kPlxuCSNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cbgl2ZWMzIG91dGdvaW5nTGlnaHQgPSByZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuCWdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7XG4JI2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxlbmNvZGluZ3NfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbgkjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cbgkjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PlxufSI7CiAgdmFyIG1lc2h0b29uX3ZlcnQgPSAiI2RlZmluZSBUT09OXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpZm5kZWYgRkxBVF9TSEFERURcbgl2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1djJfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuCSNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHV2Ml92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cbgkjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cbgkjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuI2lmbmRlZiBGTEFUX1NIQURFRFxuCXZOb3JtYWwgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkTm9ybWFsICk7XG4jZW5kaWZcbgkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuCSNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cbgkjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cbgkjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cbgl2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbgkjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuCSNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuCSNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CiAgdmFyIG1lc2hwaG9uZ19mcmFnID0gIiNkZWZpbmUgUEhPTkdcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSB2ZWMzIGVtaXNzaXZlO1xudW5pZm9ybSB2ZWMzIHNwZWN1bGFyO1xudW5pZm9ybSBmbG9hdCBzaGluaW5lc3M7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2Ml9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG4JdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG4JUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcbgl2ZWMzIHRvdGFsRW1pc3NpdmVSYWRpYW5jZSA9IGVtaXNzaXZlO1xuCSNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8c3BlY3VsYXJtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cbgkjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG4JI2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxsaWdodHNfcGhvbmdfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cbgkjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X21hcHM+XG4JI2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG4JI2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuCXZlYzMgb3V0Z29pbmdMaWdodCA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKyByZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKyB0b3RhbEVtaXNzaXZlUmFkaWFuY2U7XG4JI2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cbglnbF9GcmFnQ29sb3IgPSB2ZWM0KCBvdXRnb2luZ0xpZ2h0LCBkaWZmdXNlQ29sb3IuYSApO1xuCSNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cbgkjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwogIHZhciBtZXNocGhvbmdfdmVydCA9ICIjZGVmaW5lIFBIT05HXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpZm5kZWYgRkxBVF9TSEFERURcbgl2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1djJfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8dXZfdmVydGV4PlxuCSNpbmNsdWRlIDx1djJfdmVydGV4PlxuCSNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cbgkjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cbiNpZm5kZWYgRkxBVF9TSEFERURcbgl2Tm9ybWFsID0gbm9ybWFsaXplKCB0cmFuc2Zvcm1lZE5vcm1hbCApO1xuI2VuZGlmXG4JI2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cbgkjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuCSNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG4JI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuCSNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG4JdlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4JI2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cbgkjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cbgkjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cbgkjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwogIHZhciBtZXNocGh5c2ljYWxfZnJhZyA9ICIjZGVmaW5lIFNUQU5EQVJEXG4jaWZkZWYgUEhZU0lDQUxcbgkjZGVmaW5lIFJFRkxFQ1RJVklUWVxuCSNkZWZpbmUgQ0xFQVJDT0FUXG4jZW5kaWZcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSB2ZWMzIGVtaXNzaXZlO1xudW5pZm9ybSBmbG9hdCByb3VnaG5lc3M7XG51bmlmb3JtIGZsb2F0IG1ldGFsbmVzcztcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG4JdW5pZm9ybSBmbG9hdCB0cmFuc21pc3Npb247XG4JdW5pZm9ybSBmbG9hdCB0aGlja25lc3M7XG4JdW5pZm9ybSB2ZWMzIGF0dGVudWF0aW9uQ29sb3I7XG4JdW5pZm9ybSBmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlO1xuI2VuZGlmXG4jaWZkZWYgUkVGTEVDVElWSVRZXG4JdW5pZm9ybSBmbG9hdCByZWZsZWN0aXZpdHk7XG4jZW5kaWZcbiNpZmRlZiBDTEVBUkNPQVRcbgl1bmlmb3JtIGZsb2F0IGNsZWFyY29hdDtcbgl1bmlmb3JtIGZsb2F0IGNsZWFyY29hdFJvdWdobmVzcztcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTlxuCXVuaWZvcm0gdmVjMyBzaGVlbjtcbiNlbmRpZlxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaWZuZGVmIEZMQVRfU0hBREVEXG4JdmFyeWluZyB2ZWMzIHZOb3JtYWw7XG4JI2lmZGVmIFVTRV9UQU5HRU5UXG4JCXZhcnlpbmcgdmVjMyB2VGFuZ2VudDtcbgkJdmFyeWluZyB2ZWMzIHZCaXRhbmdlbnQ7XG4JI2VuZGlmXG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXYyX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDx0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9waHlzaWNhbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0c19wYXJzX2JlZ2luPlxuI2luY2x1ZGUgPGxpZ2h0c19waHlzaWNhbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGVhcmNvYXRfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxyb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtZXRhbG5lc3NtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG4JdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG4JUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcbgl2ZWMzIHRvdGFsRW1pc3NpdmVSYWRpYW5jZSA9IGVtaXNzaXZlO1xuCSNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8cm91Z2huZXNzbWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxtZXRhbG5lc3NtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cbgkjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG4JI2luY2x1ZGUgPGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG4JI2luY2x1ZGUgPGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcz5cbgkjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGxpZ2h0c19waHlzaWNhbF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2JlZ2luPlxuCSNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cbgkjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cbgkjaW5jbHVkZSA8YW9tYXBfZnJhZ21lbnQ+XG4JdmVjMyB0b3RhbERpZmZ1c2UgPSByZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlO1xuCXZlYzMgdG90YWxTcGVjdWxhciA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhcjtcbgkjaW5jbHVkZSA8dHJhbnNtaXNzaW9uX2ZyYWdtZW50PlxuCXZlYzMgb3V0Z29pbmdMaWdodCA9IHRvdGFsRGlmZnVzZSArIHRvdGFsU3BlY3VsYXIgKyB0b3RhbEVtaXNzaXZlUmFkaWFuY2U7XG4JZ2xfRnJhZ0NvbG9yID0gdmVjNCggb3V0Z29pbmdMaWdodCwgZGlmZnVzZUNvbG9yLmEgKTtcbgkjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGVuY29kaW5nc19mcmFnbWVudD5cbgkjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKICB2YXIgbWVzaHBoeXNpY2FsX3ZlcnQgPSAiI2RlZmluZSBTVEFOREFSRFxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaWZuZGVmIEZMQVRfU0hBREVEXG4JdmFyeWluZyB2ZWMzIHZOb3JtYWw7XG4JI2lmZGVmIFVTRV9UQU5HRU5UXG4JCXZhcnlpbmcgdmVjMyB2VGFuZ2VudDtcbgkJdmFyeWluZyB2ZWMzIHZCaXRhbmdlbnQ7XG4JI2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG4JdmFyeWluZyB2ZWM0IHZXb3JsZFBvc2l0aW9uO1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2Ml9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG4JI2luY2x1ZGUgPHV2X3ZlcnRleD5cbgkjaW5jbHVkZSA8dXYyX3ZlcnRleD5cbgkjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuCSNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cbgkjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuCSNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cbgkjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG4jaWZuZGVmIEZMQVRfU0hBREVEXG4Jdk5vcm1hbCA9IG5vcm1hbGl6ZSggdHJhbnNmb3JtZWROb3JtYWwgKTtcbgkjaWZkZWYgVVNFX1RBTkdFTlRcbgkJdlRhbmdlbnQgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkVGFuZ2VudCApO1xuCQl2Qml0YW5nZW50ID0gbm9ybWFsaXplKCBjcm9zcyggdk5vcm1hbCwgdlRhbmdlbnQgKSAqIHRhbmdlbnQudyApO1xuCSNlbmRpZlxuI2VuZGlmXG4JI2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cbgkjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuCSNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG4JI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuCSNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG4JdlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4JI2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cbgkjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cbgkjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG4JdldvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uO1xuI2VuZGlmXG59IjsKICB2YXIgbm9ybWFsX2ZyYWcgPSAiI2RlZmluZSBOT1JNQUxcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpZiBkZWZpbmVkKCBGTEFUX1NIQURFRCApIHx8IGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVEFOR0VOVFNQQUNFX05PUk1BTE1BUCApXG4JdmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jZW5kaWZcbiNpZm5kZWYgRkxBVF9TSEFERURcbgl2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbgkjaWZkZWYgVVNFX1RBTkdFTlRcbgkJdmFyeWluZyB2ZWMzIHZUYW5nZW50O1xuCQl2YXJ5aW5nIHZlYzMgdkJpdGFuZ2VudDtcbgkjZW5kaWZcbiNlbmRpZlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuCSNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cbglnbF9GcmFnQ29sb3IgPSB2ZWM0KCBwYWNrTm9ybWFsVG9SR0IoIG5vcm1hbCApLCBvcGFjaXR5ICk7XG59IjsKICB2YXIgbm9ybWFsX3ZlcnQgPSAiI2RlZmluZSBOT1JNQUxcbiNpZiBkZWZpbmVkKCBGTEFUX1NIQURFRCApIHx8IGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVEFOR0VOVFNQQUNFX05PUk1BTE1BUCApXG4JdmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jZW5kaWZcbiNpZm5kZWYgRkxBVF9TSEFERURcbgl2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbgkjaWZkZWYgVVNFX1RBTkdFTlRcbgkJdmFyeWluZyB2ZWMzIHZUYW5nZW50O1xuCQl2YXJ5aW5nIHZlYzMgdkJpdGFuZ2VudDtcbgkjZW5kaWZcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuCSNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cbgkjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cbiNpZm5kZWYgRkxBVF9TSEFERURcbgl2Tm9ybWFsID0gbm9ybWFsaXplKCB0cmFuc2Zvcm1lZE5vcm1hbCApO1xuCSNpZmRlZiBVU0VfVEFOR0VOVFxuCQl2VGFuZ2VudCA9IG5vcm1hbGl6ZSggdHJhbnNmb3JtZWRUYW5nZW50ICk7XG4JCXZCaXRhbmdlbnQgPSBub3JtYWxpemUoIGNyb3NzKCB2Tm9ybWFsLCB2VGFuZ2VudCApICogdGFuZ2VudC53ICk7XG4JI2VuZGlmXG4jZW5kaWZcbgkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuCSNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cbgkjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cbgkjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cbiNpZiBkZWZpbmVkKCBGTEFUX1NIQURFRCApIHx8IGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVEFOR0VOVFNQQUNFX05PUk1BTE1BUCApXG4JdlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4jZW5kaWZcbn0iOwogIHZhciBwb2ludHNfZnJhZyA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG4JdmVjMyBvdXRnb2luZ0xpZ2h0ID0gdmVjMyggMC4wICk7XG4JdmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG4JI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxtYXBfcGFydGljbGVfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG4Jb3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2I7XG4JZ2xfRnJhZ0NvbG9yID0gdmVjNCggb3V0Z29pbmdMaWdodCwgZGlmZnVzZUNvbG9yLmEgKTtcbgkjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGVuY29kaW5nc19mcmFnbWVudD5cbgkjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxufSI7CiAgdmFyIHBvaW50c192ZXJ0ID0gInVuaWZvcm0gZmxvYXQgc2l6ZTtcbnVuaWZvcm0gZmxvYXQgc2NhbGU7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG4JI2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cbgkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuCSNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuCWdsX1BvaW50U2l6ZSA9IHNpemU7XG4JI2lmZGVmIFVTRV9TSVpFQVRURU5VQVRJT05cbgkJYm9vbCBpc1BlcnNwZWN0aXZlID0gaXNQZXJzcGVjdGl2ZU1hdHJpeCggcHJvamVjdGlvbk1hdHJpeCApO1xuCQlpZiAoIGlzUGVyc3BlY3RpdmUgKSBnbF9Qb2ludFNpemUgKj0gKCBzY2FsZSAvIC0gbXZQb3NpdGlvbi56ICk7XG4JI2VuZGlmXG4JI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cbgkjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuCSNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CiAgdmFyIHNoYWRvd19mcmFnID0gInVuaWZvcm0gdmVjMyBjb2xvcjtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG4JZ2xfRnJhZ0NvbG9yID0gdmVjNCggY29sb3IsIG9wYWNpdHkgKiAoIDEuMCAtIGdldFNoYWRvd01hc2soKSApICk7XG4JI2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxlbmNvZGluZ3NfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbn0iOwogIHZhciBzaGFkb3dfdmVydCA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG4JI2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cbgkjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cbgkjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cbgkjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG4JI2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuCSNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuCSNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CiAgdmFyIHNwcml0ZV9mcmFnID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuCXZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuCXZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuCSNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cbgkjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cbgkjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuCW91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiO1xuCWdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7XG4JI2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuCSNpbmNsdWRlIDxlbmNvZGluZ3NfZnJhZ21lbnQ+XG4JI2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbn0iOwogIHZhciBzcHJpdGVfdmVydCA9ICJ1bmlmb3JtIGZsb2F0IHJvdGF0aW9uO1xudW5pZm9ybSB2ZWMyIGNlbnRlcjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcbgkjaW5jbHVkZSA8dXZfdmVydGV4PlxuCXZlYzQgbXZQb3NpdGlvbiA9IG1vZGVsVmlld01hdHJpeCAqIHZlYzQoIDAuMCwgMC4wLCAwLjAsIDEuMCApO1xuCXZlYzIgc2NhbGU7XG4Jc2NhbGUueCA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDAgXS54LCBtb2RlbE1hdHJpeFsgMCBdLnksIG1vZGVsTWF0cml4WyAwIF0ueiApICk7XG4Jc2NhbGUueSA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDEgXS54LCBtb2RlbE1hdHJpeFsgMSBdLnksIG1vZGVsTWF0cml4WyAxIF0ueiApICk7XG4JI2lmbmRlZiBVU0VfU0laRUFUVEVOVUFUSU9OXG4JCWJvb2wgaXNQZXJzcGVjdGl2ZSA9IGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKTtcbgkJaWYgKCBpc1BlcnNwZWN0aXZlICkgc2NhbGUgKj0gLSBtdlBvc2l0aW9uLno7XG4JI2VuZGlmXG4JdmVjMiBhbGlnbmVkUG9zaXRpb24gPSAoIHBvc2l0aW9uLnh5IC0gKCBjZW50ZXIgLSB2ZWMyKCAwLjUgKSApICkgKiBzY2FsZTtcbgl2ZWMyIHJvdGF0ZWRQb3NpdGlvbjtcbglyb3RhdGVkUG9zaXRpb24ueCA9IGNvcyggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi54IC0gc2luKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnk7XG4Jcm90YXRlZFBvc2l0aW9uLnkgPSBzaW4oIHJvdGF0aW9uICkgKiBhbGlnbmVkUG9zaXRpb24ueCArIGNvcyggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi55O1xuCW12UG9zaXRpb24ueHkgKz0gcm90YXRlZFBvc2l0aW9uO1xuCWdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG12UG9zaXRpb247XG4JI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cbgkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cbgkjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwogIHZhciBTaGFkZXJDaHVuayA9IHsKICAgIGFscGhhbWFwX2ZyYWdtZW50LAogICAgYWxwaGFtYXBfcGFyc19mcmFnbWVudCwKICAgIGFscGhhdGVzdF9mcmFnbWVudCwKICAgIGFvbWFwX2ZyYWdtZW50LAogICAgYW9tYXBfcGFyc19mcmFnbWVudCwKICAgIGJlZ2luX3ZlcnRleCwKICAgIGJlZ2lubm9ybWFsX3ZlcnRleCwKICAgIGJzZGZzLAogICAgYnVtcG1hcF9wYXJzX2ZyYWdtZW50LAogICAgY2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50LAogICAgY2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQsCiAgICBjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXgsCiAgICBjbGlwcGluZ19wbGFuZXNfdmVydGV4LAogICAgY29sb3JfZnJhZ21lbnQsCiAgICBjb2xvcl9wYXJzX2ZyYWdtZW50LAogICAgY29sb3JfcGFyc192ZXJ0ZXgsCiAgICBjb2xvcl92ZXJ0ZXgsCiAgICBjb21tb24sCiAgICBjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQsCiAgICBkZWZhdWx0bm9ybWFsX3ZlcnRleCwKICAgIGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleCwKICAgIGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXgsCiAgICBlbWlzc2l2ZW1hcF9mcmFnbWVudCwKICAgIGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQsCiAgICBlbmNvZGluZ3NfZnJhZ21lbnQsCiAgICBlbmNvZGluZ3NfcGFyc19mcmFnbWVudCwKICAgIGVudm1hcF9mcmFnbWVudCwKICAgIGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudCwKICAgIGVudm1hcF9wYXJzX2ZyYWdtZW50LAogICAgZW52bWFwX3BhcnNfdmVydGV4LAogICAgZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQsCiAgICBlbnZtYXBfdmVydGV4LAogICAgZm9nX3ZlcnRleCwKICAgIGZvZ19wYXJzX3ZlcnRleCwKICAgIGZvZ19mcmFnbWVudCwKICAgIGZvZ19wYXJzX2ZyYWdtZW50LAogICAgZ3JhZGllbnRtYXBfcGFyc19mcmFnbWVudCwKICAgIGxpZ2h0bWFwX2ZyYWdtZW50LAogICAgbGlnaHRtYXBfcGFyc19mcmFnbWVudCwKICAgIGxpZ2h0c19sYW1iZXJ0X3ZlcnRleCwKICAgIGxpZ2h0c19wYXJzX2JlZ2luLAogICAgbGlnaHRzX3Rvb25fZnJhZ21lbnQsCiAgICBsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50LAogICAgbGlnaHRzX3Bob25nX2ZyYWdtZW50LAogICAgbGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQsCiAgICBsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQsCiAgICBsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudCwKICAgIGxpZ2h0c19mcmFnbWVudF9iZWdpbiwKICAgIGxpZ2h0c19mcmFnbWVudF9tYXBzLAogICAgbGlnaHRzX2ZyYWdtZW50X2VuZCwKICAgIGxvZ2RlcHRoYnVmX2ZyYWdtZW50LAogICAgbG9nZGVwdGhidWZfcGFyc19mcmFnbWVudCwKICAgIGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4LAogICAgbG9nZGVwdGhidWZfdmVydGV4LAogICAgbWFwX2ZyYWdtZW50LAogICAgbWFwX3BhcnNfZnJhZ21lbnQsCiAgICBtYXBfcGFydGljbGVfZnJhZ21lbnQsCiAgICBtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudCwKICAgIG1ldGFsbmVzc21hcF9mcmFnbWVudCwKICAgIG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50LAogICAgbW9ycGhub3JtYWxfdmVydGV4LAogICAgbW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXgsCiAgICBtb3JwaHRhcmdldF92ZXJ0ZXgsCiAgICBub3JtYWxfZnJhZ21lbnRfYmVnaW4sCiAgICBub3JtYWxfZnJhZ21lbnRfbWFwcywKICAgIG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50LAogICAgY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbiwKICAgIGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcywKICAgIGNsZWFyY29hdF9wYXJzX2ZyYWdtZW50LAogICAgcGFja2luZywKICAgIHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQsCiAgICBwcm9qZWN0X3ZlcnRleCwKICAgIGRpdGhlcmluZ19mcmFnbWVudCwKICAgIGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50LAogICAgcm91Z2huZXNzbWFwX2ZyYWdtZW50LAogICAgcm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQsCiAgICBzaGFkb3dtYXBfcGFyc19mcmFnbWVudCwKICAgIHNoYWRvd21hcF9wYXJzX3ZlcnRleCwKICAgIHNoYWRvd21hcF92ZXJ0ZXgsCiAgICBzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQsCiAgICBza2luYmFzZV92ZXJ0ZXgsCiAgICBza2lubmluZ19wYXJzX3ZlcnRleCwKICAgIHNraW5uaW5nX3ZlcnRleCwKICAgIHNraW5ub3JtYWxfdmVydGV4LAogICAgc3BlY3VsYXJtYXBfZnJhZ21lbnQsCiAgICBzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50LAogICAgdG9uZW1hcHBpbmdfZnJhZ21lbnQsCiAgICB0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50LAogICAgdHJhbnNtaXNzaW9uX2ZyYWdtZW50LAogICAgdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQsCiAgICB1dl9wYXJzX2ZyYWdtZW50LAogICAgdXZfcGFyc192ZXJ0ZXgsCiAgICB1dl92ZXJ0ZXgsCiAgICB1djJfcGFyc19mcmFnbWVudCwKICAgIHV2Ml9wYXJzX3ZlcnRleCwKICAgIHV2Ml92ZXJ0ZXgsCiAgICB3b3JsZHBvc192ZXJ0ZXgsCiAgICBiYWNrZ3JvdW5kX2ZyYWcsCiAgICBiYWNrZ3JvdW5kX3ZlcnQsCiAgICBjdWJlX2ZyYWcsCiAgICBjdWJlX3ZlcnQsCiAgICBkZXB0aF9mcmFnLAogICAgZGVwdGhfdmVydCwKICAgIGRpc3RhbmNlUkdCQV9mcmFnLAogICAgZGlzdGFuY2VSR0JBX3ZlcnQsCiAgICBlcXVpcmVjdF9mcmFnLAogICAgZXF1aXJlY3RfdmVydCwKICAgIGxpbmVkYXNoZWRfZnJhZywKICAgIGxpbmVkYXNoZWRfdmVydCwKICAgIG1lc2hiYXNpY19mcmFnLAogICAgbWVzaGJhc2ljX3ZlcnQsCiAgICBtZXNobGFtYmVydF9mcmFnLAogICAgbWVzaGxhbWJlcnRfdmVydCwKICAgIG1lc2htYXRjYXBfZnJhZywKICAgIG1lc2htYXRjYXBfdmVydCwKICAgIG1lc2h0b29uX2ZyYWcsCiAgICBtZXNodG9vbl92ZXJ0LAogICAgbWVzaHBob25nX2ZyYWcsCiAgICBtZXNocGhvbmdfdmVydCwKICAgIG1lc2hwaHlzaWNhbF9mcmFnLAogICAgbWVzaHBoeXNpY2FsX3ZlcnQsCiAgICBub3JtYWxfZnJhZywKICAgIG5vcm1hbF92ZXJ0LAogICAgcG9pbnRzX2ZyYWcsCiAgICBwb2ludHNfdmVydCwKICAgIHNoYWRvd19mcmFnLAogICAgc2hhZG93X3ZlcnQsCiAgICBzcHJpdGVfZnJhZywKICAgIHNwcml0ZV92ZXJ0CiAgfTsKICB2YXIgVW5pZm9ybXNMaWIgPSB7CiAgICBjb21tb246IHsKICAgICAgZGlmZnVzZTogeyB2YWx1ZTogbmV3IENvbG9yKDE2Nzc3MjE1KSB9LAogICAgICBvcGFjaXR5OiB7IHZhbHVlOiAxIH0sCiAgICAgIG1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgICB1dlRyYW5zZm9ybTogeyB2YWx1ZTogbmV3IE1hdHJpeDMoKSB9LAogICAgICB1djJUcmFuc2Zvcm06IHsgdmFsdWU6IG5ldyBNYXRyaXgzKCkgfSwKICAgICAgYWxwaGFNYXA6IHsgdmFsdWU6IG51bGwgfQogICAgfSwKICAgIHNwZWN1bGFybWFwOiB7CiAgICAgIHNwZWN1bGFyTWFwOiB7IHZhbHVlOiBudWxsIH0KICAgIH0sCiAgICBlbnZtYXA6IHsKICAgICAgZW52TWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAgIGZsaXBFbnZNYXA6IHsgdmFsdWU6IC0xIH0sCiAgICAgIHJlZmxlY3Rpdml0eTogeyB2YWx1ZTogMSB9LAogICAgICByZWZyYWN0aW9uUmF0aW86IHsgdmFsdWU6IDAuOTggfSwKICAgICAgbWF4TWlwTGV2ZWw6IHsgdmFsdWU6IDAgfQogICAgfSwKICAgIGFvbWFwOiB7CiAgICAgIGFvTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAgIGFvTWFwSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0KICAgIH0sCiAgICBsaWdodG1hcDogewogICAgICBsaWdodE1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgICBsaWdodE1hcEludGVuc2l0eTogeyB2YWx1ZTogMSB9CiAgICB9LAogICAgZW1pc3NpdmVtYXA6IHsKICAgICAgZW1pc3NpdmVNYXA6IHsgdmFsdWU6IG51bGwgfQogICAgfSwKICAgIGJ1bXBtYXA6IHsKICAgICAgYnVtcE1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgICBidW1wU2NhbGU6IHsgdmFsdWU6IDEgfQogICAgfSwKICAgIG5vcm1hbG1hcDogewogICAgICBub3JtYWxNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgICAgbm9ybWFsU2NhbGU6IHsgdmFsdWU6IG5ldyBWZWN0b3IyKDEsIDEpIH0KICAgIH0sCiAgICBkaXNwbGFjZW1lbnRtYXA6IHsKICAgICAgZGlzcGxhY2VtZW50TWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAgIGRpc3BsYWNlbWVudFNjYWxlOiB7IHZhbHVlOiAxIH0sCiAgICAgIGRpc3BsYWNlbWVudEJpYXM6IHsgdmFsdWU6IDAgfQogICAgfSwKICAgIHJvdWdobmVzc21hcDogewogICAgICByb3VnaG5lc3NNYXA6IHsgdmFsdWU6IG51bGwgfQogICAgfSwKICAgIG1ldGFsbmVzc21hcDogewogICAgICBtZXRhbG5lc3NNYXA6IHsgdmFsdWU6IG51bGwgfQogICAgfSwKICAgIGdyYWRpZW50bWFwOiB7CiAgICAgIGdyYWRpZW50TWFwOiB7IHZhbHVlOiBudWxsIH0KICAgIH0sCiAgICBmb2c6IHsKICAgICAgZm9nRGVuc2l0eTogeyB2YWx1ZTogMjVlLTUgfSwKICAgICAgZm9nTmVhcjogeyB2YWx1ZTogMSB9LAogICAgICBmb2dGYXI6IHsgdmFsdWU6IDJlMyB9LAogICAgICBmb2dDb2xvcjogeyB2YWx1ZTogbmV3IENvbG9yKDE2Nzc3MjE1KSB9CiAgICB9LAogICAgbGlnaHRzOiB7CiAgICAgIGFtYmllbnRMaWdodENvbG9yOiB7IHZhbHVlOiBbXSB9LAogICAgICBsaWdodFByb2JlOiB7IHZhbHVlOiBbXSB9LAogICAgICBkaXJlY3Rpb25hbExpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKICAgICAgICBkaXJlY3Rpb246IHt9LAogICAgICAgIGNvbG9yOiB7fQogICAgICB9IH0sCiAgICAgIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewogICAgICAgIHNoYWRvd0JpYXM6IHt9LAogICAgICAgIHNoYWRvd05vcm1hbEJpYXM6IHt9LAogICAgICAgIHNoYWRvd1JhZGl1czoge30sCiAgICAgICAgc2hhZG93TWFwU2l6ZToge30KICAgICAgfSB9LAogICAgICBkaXJlY3Rpb25hbFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKICAgICAgZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXg6IHsgdmFsdWU6IFtdIH0sCiAgICAgIHNwb3RMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAgICAgY29sb3I6IHt9LAogICAgICAgIHBvc2l0aW9uOiB7fSwKICAgICAgICBkaXJlY3Rpb246IHt9LAogICAgICAgIGRpc3RhbmNlOiB7fSwKICAgICAgICBjb25lQ29zOiB7fSwKICAgICAgICBwZW51bWJyYUNvczoge30sCiAgICAgICAgZGVjYXk6IHt9CiAgICAgIH0gfSwKICAgICAgc3BvdExpZ2h0U2hhZG93czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKICAgICAgICBzaGFkb3dCaWFzOiB7fSwKICAgICAgICBzaGFkb3dOb3JtYWxCaWFzOiB7fSwKICAgICAgICBzaGFkb3dSYWRpdXM6IHt9LAogICAgICAgIHNoYWRvd01hcFNpemU6IHt9CiAgICAgIH0gfSwKICAgICAgc3BvdFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKICAgICAgc3BvdFNoYWRvd01hdHJpeDogeyB2YWx1ZTogW10gfSwKICAgICAgcG9pbnRMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAgICAgY29sb3I6IHt9LAogICAgICAgIHBvc2l0aW9uOiB7fSwKICAgICAgICBkZWNheToge30sCiAgICAgICAgZGlzdGFuY2U6IHt9CiAgICAgIH0gfSwKICAgICAgcG9pbnRMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAgICAgc2hhZG93Qmlhczoge30sCiAgICAgICAgc2hhZG93Tm9ybWFsQmlhczoge30sCiAgICAgICAgc2hhZG93UmFkaXVzOiB7fSwKICAgICAgICBzaGFkb3dNYXBTaXplOiB7fSwKICAgICAgICBzaGFkb3dDYW1lcmFOZWFyOiB7fSwKICAgICAgICBzaGFkb3dDYW1lcmFGYXI6IHt9CiAgICAgIH0gfSwKICAgICAgcG9pbnRTaGFkb3dNYXA6IHsgdmFsdWU6IFtdIH0sCiAgICAgIHBvaW50U2hhZG93TWF0cml4OiB7IHZhbHVlOiBbXSB9LAogICAgICBoZW1pc3BoZXJlTGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewogICAgICAgIGRpcmVjdGlvbjoge30sCiAgICAgICAgc2t5Q29sb3I6IHt9LAogICAgICAgIGdyb3VuZENvbG9yOiB7fQogICAgICB9IH0sCiAgICAgIHJlY3RBcmVhTGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewogICAgICAgIGNvbG9yOiB7fSwKICAgICAgICBwb3NpdGlvbjoge30sCiAgICAgICAgd2lkdGg6IHt9LAogICAgICAgIGhlaWdodDoge30KICAgICAgfSB9LAogICAgICBsdGNfMTogeyB2YWx1ZTogbnVsbCB9LAogICAgICBsdGNfMjogeyB2YWx1ZTogbnVsbCB9CiAgICB9LAogICAgcG9pbnRzOiB7CiAgICAgIGRpZmZ1c2U6IHsgdmFsdWU6IG5ldyBDb2xvcigxNjc3NzIxNSkgfSwKICAgICAgb3BhY2l0eTogeyB2YWx1ZTogMSB9LAogICAgICBzaXplOiB7IHZhbHVlOiAxIH0sCiAgICAgIHNjYWxlOiB7IHZhbHVlOiAxIH0sCiAgICAgIG1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgICBhbHBoYU1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgICB1dlRyYW5zZm9ybTogeyB2YWx1ZTogbmV3IE1hdHJpeDMoKSB9CiAgICB9LAogICAgc3ByaXRlOiB7CiAgICAgIGRpZmZ1c2U6IHsgdmFsdWU6IG5ldyBDb2xvcigxNjc3NzIxNSkgfSwKICAgICAgb3BhY2l0eTogeyB2YWx1ZTogMSB9LAogICAgICBjZW50ZXI6IHsgdmFsdWU6IG5ldyBWZWN0b3IyKDAuNSwgMC41KSB9LAogICAgICByb3RhdGlvbjogeyB2YWx1ZTogMCB9LAogICAgICBtYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgICAgYWxwaGFNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgICAgdXZUcmFuc2Zvcm06IHsgdmFsdWU6IG5ldyBNYXRyaXgzKCkgfQogICAgfQogIH07CiAgdmFyIFNoYWRlckxpYiA9IHsKICAgIGJhc2ljOiB7CiAgICAgIHVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKFsKICAgICAgICBVbmlmb3Jtc0xpYi5jb21tb24sCiAgICAgICAgVW5pZm9ybXNMaWIuc3BlY3VsYXJtYXAsCiAgICAgICAgVW5pZm9ybXNMaWIuZW52bWFwLAogICAgICAgIFVuaWZvcm1zTGliLmFvbWFwLAogICAgICAgIFVuaWZvcm1zTGliLmxpZ2h0bWFwLAogICAgICAgIFVuaWZvcm1zTGliLmZvZwogICAgICBdKSwKICAgICAgdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNoYmFzaWNfdmVydCwKICAgICAgZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hiYXNpY19mcmFnCiAgICB9LAogICAgbGFtYmVydDogewogICAgICB1bmlmb3JtczogbWVyZ2VVbmlmb3JtcyhbCiAgICAgICAgVW5pZm9ybXNMaWIuY29tbW9uLAogICAgICAgIFVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAogICAgICAgIFVuaWZvcm1zTGliLmVudm1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5hb21hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5saWdodG1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5mb2csCiAgICAgICAgVW5pZm9ybXNMaWIubGlnaHRzLAogICAgICAgIHsKICAgICAgICAgIGVtaXNzaXZlOiB7IHZhbHVlOiBuZXcgQ29sb3IoMCkgfQogICAgICAgIH0KICAgICAgXSksCiAgICAgIHZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaGxhbWJlcnRfdmVydCwKICAgICAgZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hsYW1iZXJ0X2ZyYWcKICAgIH0sCiAgICBwaG9uZzogewogICAgICB1bmlmb3JtczogbWVyZ2VVbmlmb3JtcyhbCiAgICAgICAgVW5pZm9ybXNMaWIuY29tbW9uLAogICAgICAgIFVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAogICAgICAgIFVuaWZvcm1zTGliLmVudm1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5hb21hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5saWdodG1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5idW1wbWFwLAogICAgICAgIFVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCiAgICAgICAgVW5pZm9ybXNMaWIuZm9nLAogICAgICAgIFVuaWZvcm1zTGliLmxpZ2h0cywKICAgICAgICB7CiAgICAgICAgICBlbWlzc2l2ZTogeyB2YWx1ZTogbmV3IENvbG9yKDApIH0sCiAgICAgICAgICBzcGVjdWxhcjogeyB2YWx1ZTogbmV3IENvbG9yKDExMTg0ODEpIH0sCiAgICAgICAgICBzaGluaW5lc3M6IHsgdmFsdWU6IDMwIH0KICAgICAgICB9CiAgICAgIF0pLAogICAgICB2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaG9uZ192ZXJ0LAogICAgICBmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBob25nX2ZyYWcKICAgIH0sCiAgICBzdGFuZGFyZDogewogICAgICB1bmlmb3JtczogbWVyZ2VVbmlmb3JtcyhbCiAgICAgICAgVW5pZm9ybXNMaWIuY29tbW9uLAogICAgICAgIFVuaWZvcm1zTGliLmVudm1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5hb21hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5saWdodG1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5idW1wbWFwLAogICAgICAgIFVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCiAgICAgICAgVW5pZm9ybXNMaWIucm91Z2huZXNzbWFwLAogICAgICAgIFVuaWZvcm1zTGliLm1ldGFsbmVzc21hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5mb2csCiAgICAgICAgVW5pZm9ybXNMaWIubGlnaHRzLAogICAgICAgIHsKICAgICAgICAgIGVtaXNzaXZlOiB7IHZhbHVlOiBuZXcgQ29sb3IoMCkgfSwKICAgICAgICAgIHJvdWdobmVzczogeyB2YWx1ZTogMSB9LAogICAgICAgICAgbWV0YWxuZXNzOiB7IHZhbHVlOiAwIH0sCiAgICAgICAgICBlbnZNYXBJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfQogICAgICAgIH0KICAgICAgXSksCiAgICAgIHZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBoeXNpY2FsX3ZlcnQsCiAgICAgIGZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfZnJhZwogICAgfSwKICAgIHRvb246IHsKICAgICAgdW5pZm9ybXM6IG1lcmdlVW5pZm9ybXMoWwogICAgICAgIFVuaWZvcm1zTGliLmNvbW1vbiwKICAgICAgICBVbmlmb3Jtc0xpYi5hb21hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5saWdodG1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5idW1wbWFwLAogICAgICAgIFVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCiAgICAgICAgVW5pZm9ybXNMaWIuZ3JhZGllbnRtYXAsCiAgICAgICAgVW5pZm9ybXNMaWIuZm9nLAogICAgICAgIFVuaWZvcm1zTGliLmxpZ2h0cywKICAgICAgICB7CiAgICAgICAgICBlbWlzc2l2ZTogeyB2YWx1ZTogbmV3IENvbG9yKDApIH0KICAgICAgICB9CiAgICAgIF0pLAogICAgICB2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2h0b29uX3ZlcnQsCiAgICAgIGZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNodG9vbl9mcmFnCiAgICB9LAogICAgbWF0Y2FwOiB7CiAgICAgIHVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKFsKICAgICAgICBVbmlmb3Jtc0xpYi5jb21tb24sCiAgICAgICAgVW5pZm9ybXNMaWIuYnVtcG1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCiAgICAgICAgVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAogICAgICAgIFVuaWZvcm1zTGliLmZvZywKICAgICAgICB7CiAgICAgICAgICBtYXRjYXA6IHsgdmFsdWU6IG51bGwgfQogICAgICAgIH0KICAgICAgXSksCiAgICAgIHZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaG1hdGNhcF92ZXJ0LAogICAgICBmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaG1hdGNhcF9mcmFnCiAgICB9LAogICAgcG9pbnRzOiB7CiAgICAgIHVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKFsKICAgICAgICBVbmlmb3Jtc0xpYi5wb2ludHMsCiAgICAgICAgVW5pZm9ybXNMaWIuZm9nCiAgICAgIF0pLAogICAgICB2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnBvaW50c192ZXJ0LAogICAgICBmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsucG9pbnRzX2ZyYWcKICAgIH0sCiAgICBkYXNoZWQ6IHsKICAgICAgdW5pZm9ybXM6IG1lcmdlVW5pZm9ybXMoWwogICAgICAgIFVuaWZvcm1zTGliLmNvbW1vbiwKICAgICAgICBVbmlmb3Jtc0xpYi5mb2csCiAgICAgICAgewogICAgICAgICAgc2NhbGU6IHsgdmFsdWU6IDEgfSwKICAgICAgICAgIGRhc2hTaXplOiB7IHZhbHVlOiAxIH0sCiAgICAgICAgICB0b3RhbFNpemU6IHsgdmFsdWU6IDIgfQogICAgICAgIH0KICAgICAgXSksCiAgICAgIHZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubGluZWRhc2hlZF92ZXJ0LAogICAgICBmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubGluZWRhc2hlZF9mcmFnCiAgICB9LAogICAgZGVwdGg6IHsKICAgICAgdW5pZm9ybXM6IG1lcmdlVW5pZm9ybXMoWwogICAgICAgIFVuaWZvcm1zTGliLmNvbW1vbiwKICAgICAgICBVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAKICAgICAgXSksCiAgICAgIHZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuZGVwdGhfdmVydCwKICAgICAgZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmRlcHRoX2ZyYWcKICAgIH0sCiAgICBub3JtYWw6IHsKICAgICAgdW5pZm9ybXM6IG1lcmdlVW5pZm9ybXMoWwogICAgICAgIFVuaWZvcm1zTGliLmNvbW1vbiwKICAgICAgICBVbmlmb3Jtc0xpYi5idW1wbWFwLAogICAgICAgIFVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgICAgICBVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCiAgICAgICAgewogICAgICAgICAgb3BhY2l0eTogeyB2YWx1ZTogMSB9CiAgICAgICAgfQogICAgICBdKSwKICAgICAgdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5ub3JtYWxfdmVydCwKICAgICAgZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm5vcm1hbF9mcmFnCiAgICB9LAogICAgc3ByaXRlOiB7CiAgICAgIHVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKFsKICAgICAgICBVbmlmb3Jtc0xpYi5zcHJpdGUsCiAgICAgICAgVW5pZm9ybXNMaWIuZm9nCiAgICAgIF0pLAogICAgICB2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnNwcml0ZV92ZXJ0LAogICAgICBmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuc3ByaXRlX2ZyYWcKICAgIH0sCiAgICBiYWNrZ3JvdW5kOiB7CiAgICAgIHVuaWZvcm1zOiB7CiAgICAgICAgdXZUcmFuc2Zvcm06IHsgdmFsdWU6IG5ldyBNYXRyaXgzKCkgfSwKICAgICAgICB0MkQ6IHsgdmFsdWU6IG51bGwgfQogICAgICB9LAogICAgICB2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRfdmVydCwKICAgICAgZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRfZnJhZwogICAgfSwKICAgIGN1YmU6IHsKICAgICAgdW5pZm9ybXM6IG1lcmdlVW5pZm9ybXMoWwogICAgICAgIFVuaWZvcm1zTGliLmVudm1hcCwKICAgICAgICB7CiAgICAgICAgICBvcGFjaXR5OiB7IHZhbHVlOiAxIH0KICAgICAgICB9CiAgICAgIF0pLAogICAgICB2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmN1YmVfdmVydCwKICAgICAgZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmN1YmVfZnJhZwogICAgfSwKICAgIGVxdWlyZWN0OiB7CiAgICAgIHVuaWZvcm1zOiB7CiAgICAgICAgdEVxdWlyZWN0OiB7IHZhbHVlOiBudWxsIH0KICAgICAgfSwKICAgICAgdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5lcXVpcmVjdF92ZXJ0LAogICAgICBmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZXF1aXJlY3RfZnJhZwogICAgfSwKICAgIGRpc3RhbmNlUkdCQTogewogICAgICB1bmlmb3JtczogbWVyZ2VVbmlmb3JtcyhbCiAgICAgICAgVW5pZm9ybXNMaWIuY29tbW9uLAogICAgICAgIFVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKICAgICAgICB7CiAgICAgICAgICByZWZlcmVuY2VQb3NpdGlvbjogeyB2YWx1ZTogbmV3IFZlY3RvcjMoKSB9LAogICAgICAgICAgbmVhckRpc3RhbmNlOiB7IHZhbHVlOiAxIH0sCiAgICAgICAgICBmYXJEaXN0YW5jZTogeyB2YWx1ZTogMWUzIH0KICAgICAgICB9CiAgICAgIF0pLAogICAgICB2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmRpc3RhbmNlUkdCQV92ZXJ0LAogICAgICBmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZGlzdGFuY2VSR0JBX2ZyYWcKICAgIH0sCiAgICBzaGFkb3c6IHsKICAgICAgdW5pZm9ybXM6IG1lcmdlVW5pZm9ybXMoWwogICAgICAgIFVuaWZvcm1zTGliLmxpZ2h0cywKICAgICAgICBVbmlmb3Jtc0xpYi5mb2csCiAgICAgICAgewogICAgICAgICAgY29sb3I6IHsgdmFsdWU6IG5ldyBDb2xvcigwKSB9LAogICAgICAgICAgb3BhY2l0eTogeyB2YWx1ZTogMSB9CiAgICAgICAgfQogICAgICBdKSwKICAgICAgdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5zaGFkb3dfdmVydCwKICAgICAgZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLnNoYWRvd19mcmFnCiAgICB9CiAgfTsKICBTaGFkZXJMaWIucGh5c2ljYWwgPSB7CiAgICB1bmlmb3JtczogbWVyZ2VVbmlmb3JtcyhbCiAgICAgIFNoYWRlckxpYi5zdGFuZGFyZC51bmlmb3JtcywKICAgICAgewogICAgICAgIGNsZWFyY29hdDogeyB2YWx1ZTogMCB9LAogICAgICAgIGNsZWFyY29hdE1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgICAgIGNsZWFyY29hdFJvdWdobmVzczogeyB2YWx1ZTogMCB9LAogICAgICAgIGNsZWFyY29hdFJvdWdobmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgICAgIGNsZWFyY29hdE5vcm1hbFNjYWxlOiB7IHZhbHVlOiBuZXcgVmVjdG9yMigxLCAxKSB9LAogICAgICAgIGNsZWFyY29hdE5vcm1hbE1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgICAgIHNoZWVuOiB7IHZhbHVlOiBuZXcgQ29sb3IoMCkgfSwKICAgICAgICB0cmFuc21pc3Npb246IHsgdmFsdWU6IDAgfSwKICAgICAgICB0cmFuc21pc3Npb25NYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgICAgICB0cmFuc21pc3Npb25TYW1wbGVyU2l6ZTogeyB2YWx1ZTogbmV3IFZlY3RvcjIoKSB9LAogICAgICAgIHRyYW5zbWlzc2lvblNhbXBsZXJNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgICAgICB0aGlja25lc3M6IHsgdmFsdWU6IDAgfSwKICAgICAgICB0aGlja25lc3NNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgICAgICBhdHRlbnVhdGlvbkRpc3RhbmNlOiB7IHZhbHVlOiAwIH0sCiAgICAgICAgYXR0ZW51YXRpb25Db2xvcjogeyB2YWx1ZTogbmV3IENvbG9yKDApIH0KICAgICAgfQogICAgXSksCiAgICB2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF92ZXJ0LAogICAgZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF9mcmFnCiAgfTsKICBmdW5jdGlvbiBXZWJHTEJhY2tncm91bmQocmVuZGVyZXIsIGN1YmVtYXBzLCBzdGF0ZSwgb2JqZWN0cywgcHJlbXVsdGlwbGllZEFscGhhKSB7CiAgICBjb25zdCBjbGVhckNvbG9yID0gbmV3IENvbG9yKDApOwogICAgbGV0IGNsZWFyQWxwaGEgPSAwOwogICAgbGV0IHBsYW5lTWVzaDsKICAgIGxldCBib3hNZXNoOwogICAgbGV0IGN1cnJlbnRCYWNrZ3JvdW5kID0gbnVsbDsKICAgIGxldCBjdXJyZW50QmFja2dyb3VuZFZlcnNpb24gPSAwOwogICAgbGV0IGN1cnJlbnRUb25lbWFwcGluZyA9IG51bGw7CiAgICBmdW5jdGlvbiByZW5kZXIocmVuZGVyTGlzdCwgc2NlbmUpIHsKICAgICAgbGV0IGZvcmNlQ2xlYXIgPSBmYWxzZTsKICAgICAgbGV0IGJhY2tncm91bmQgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUuYmFja2dyb3VuZCA6IG51bGw7CiAgICAgIGlmIChiYWNrZ3JvdW5kICYmIGJhY2tncm91bmQuaXNUZXh0dXJlKSB7CiAgICAgICAgYmFja2dyb3VuZCA9IGN1YmVtYXBzLmdldChiYWNrZ3JvdW5kKTsKICAgICAgfQogICAgICBjb25zdCB4ciA9IHJlbmRlcmVyLnhyOwogICAgICBjb25zdCBzZXNzaW9uID0geHIuZ2V0U2Vzc2lvbiAmJiB4ci5nZXRTZXNzaW9uKCk7CiAgICAgIGlmIChzZXNzaW9uICYmIHNlc3Npb24uZW52aXJvbm1lbnRCbGVuZE1vZGUgPT09ICJhZGRpdGl2ZSIpIHsKICAgICAgICBiYWNrZ3JvdW5kID0gbnVsbDsKICAgICAgfQogICAgICBpZiAoYmFja2dyb3VuZCA9PT0gbnVsbCkgewogICAgICAgIHNldENsZWFyKGNsZWFyQ29sb3IsIGNsZWFyQWxwaGEpOwogICAgICB9IGVsc2UgaWYgKGJhY2tncm91bmQgJiYgYmFja2dyb3VuZC5pc0NvbG9yKSB7CiAgICAgICAgc2V0Q2xlYXIoYmFja2dyb3VuZCwgMSk7CiAgICAgICAgZm9yY2VDbGVhciA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKHJlbmRlcmVyLmF1dG9DbGVhciB8fCBmb3JjZUNsZWFyKSB7CiAgICAgICAgcmVuZGVyZXIuY2xlYXIocmVuZGVyZXIuYXV0b0NsZWFyQ29sb3IsIHJlbmRlcmVyLmF1dG9DbGVhckRlcHRoLCByZW5kZXJlci5hdXRvQ2xlYXJTdGVuY2lsKTsKICAgICAgfQogICAgICBpZiAoYmFja2dyb3VuZCAmJiAoYmFja2dyb3VuZC5pc0N1YmVUZXh0dXJlIHx8IGJhY2tncm91bmQubWFwcGluZyA9PT0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcpKSB7CiAgICAgICAgaWYgKGJveE1lc2ggPT09IHZvaWQgMCkgewogICAgICAgICAgYm94TWVzaCA9IG5ldyBNZXNoKG5ldyBCb3hHZW9tZXRyeSgxLCAxLCAxKSwgbmV3IFNoYWRlck1hdGVyaWFsKHsKICAgICAgICAgICAgbmFtZTogIkJhY2tncm91bmRDdWJlTWF0ZXJpYWwiLAogICAgICAgICAgICB1bmlmb3JtczogY2xvbmVVbmlmb3JtcyhTaGFkZXJMaWIuY3ViZS51bmlmb3JtcyksCiAgICAgICAgICAgIHZlcnRleFNoYWRlcjogU2hhZGVyTGliLmN1YmUudmVydGV4U2hhZGVyLAogICAgICAgICAgICBmcmFnbWVudFNoYWRlcjogU2hhZGVyTGliLmN1YmUuZnJhZ21lbnRTaGFkZXIsCiAgICAgICAgICAgIHNpZGU6IEJhY2tTaWRlLAogICAgICAgICAgICBkZXB0aFRlc3Q6IGZhbHNlLAogICAgICAgICAgICBkZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgZm9nOiBmYWxzZQogICAgICAgICAgfSkpOwogICAgICAgICAgYm94TWVzaC5nZW9tZXRyeS5kZWxldGVBdHRyaWJ1dGUoIm5vcm1hbCIpOwogICAgICAgICAgYm94TWVzaC5nZW9tZXRyeS5kZWxldGVBdHRyaWJ1dGUoInV2Iik7CiAgICAgICAgICBib3hNZXNoLm9uQmVmb3JlUmVuZGVyID0gZnVuY3Rpb24ocmVuZGVyZXIyLCBzY2VuZTIsIGNhbWVyYSkgewogICAgICAgICAgICB0aGlzLm1hdHJpeFdvcmxkLmNvcHlQb3NpdGlvbihjYW1lcmEubWF0cml4V29ybGQpOwogICAgICAgICAgfTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShib3hNZXNoLm1hdGVyaWFsLCAiZW52TWFwIiwgewogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLnVuaWZvcm1zLmVudk1hcC52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBvYmplY3RzLnVwZGF0ZShib3hNZXNoKTsKICAgICAgICB9CiAgICAgICAgYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBiYWNrZ3JvdW5kOwogICAgICAgIGJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9IGJhY2tncm91bmQuaXNDdWJlVGV4dHVyZSAmJiBiYWNrZ3JvdW5kLl9uZWVkc0ZsaXBFbnZNYXAgPyAtMSA6IDE7CiAgICAgICAgaWYgKGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8IGN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiAhPT0gYmFja2dyb3VuZC52ZXJzaW9uIHx8IGN1cnJlbnRUb25lbWFwcGluZyAhPT0gcmVuZGVyZXIudG9uZU1hcHBpbmcpIHsKICAgICAgICAgIGJveE1lc2gubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgY3VycmVudEJhY2tncm91bmQgPSBiYWNrZ3JvdW5kOwogICAgICAgICAgY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gYmFja2dyb3VuZC52ZXJzaW9uOwogICAgICAgICAgY3VycmVudFRvbmVtYXBwaW5nID0gcmVuZGVyZXIudG9uZU1hcHBpbmc7CiAgICAgICAgfQogICAgICAgIHJlbmRlckxpc3QudW5zaGlmdChib3hNZXNoLCBib3hNZXNoLmdlb21ldHJ5LCBib3hNZXNoLm1hdGVyaWFsLCAwLCAwLCBudWxsKTsKICAgICAgfSBlbHNlIGlmIChiYWNrZ3JvdW5kICYmIGJhY2tncm91bmQuaXNUZXh0dXJlKSB7CiAgICAgICAgaWYgKHBsYW5lTWVzaCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBwbGFuZU1lc2ggPSBuZXcgTWVzaChuZXcgUGxhbmVHZW9tZXRyeSgyLCAyKSwgbmV3IFNoYWRlck1hdGVyaWFsKHsKICAgICAgICAgICAgbmFtZTogIkJhY2tncm91bmRNYXRlcmlhbCIsCiAgICAgICAgICAgIHVuaWZvcm1zOiBjbG9uZVVuaWZvcm1zKFNoYWRlckxpYi5iYWNrZ3JvdW5kLnVuaWZvcm1zKSwKICAgICAgICAgICAgdmVydGV4U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZC52ZXJ0ZXhTaGFkZXIsCiAgICAgICAgICAgIGZyYWdtZW50U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZC5mcmFnbWVudFNoYWRlciwKICAgICAgICAgICAgc2lkZTogRnJvbnRTaWRlLAogICAgICAgICAgICBkZXB0aFRlc3Q6IGZhbHNlLAogICAgICAgICAgICBkZXB0aFdyaXRlOiBmYWxzZSwKICAgICAgICAgICAgZm9nOiBmYWxzZQogICAgICAgICAgfSkpOwogICAgICAgICAgcGxhbmVNZXNoLmdlb21ldHJ5LmRlbGV0ZUF0dHJpYnV0ZSgibm9ybWFsIik7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocGxhbmVNZXNoLm1hdGVyaWFsLCAibWFwIiwgewogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLnVuaWZvcm1zLnQyRC52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBvYmplY3RzLnVwZGF0ZShwbGFuZU1lc2gpOwogICAgICAgIH0KICAgICAgICBwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMudDJELnZhbHVlID0gYmFja2dyb3VuZDsKICAgICAgICBpZiAoYmFja2dyb3VuZC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlKSB7CiAgICAgICAgICBiYWNrZ3JvdW5kLnVwZGF0ZU1hdHJpeCgpOwogICAgICAgIH0KICAgICAgICBwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMudXZUcmFuc2Zvcm0udmFsdWUuY29weShiYWNrZ3JvdW5kLm1hdHJpeCk7CiAgICAgICAgaWYgKGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8IGN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiAhPT0gYmFja2dyb3VuZC52ZXJzaW9uIHx8IGN1cnJlbnRUb25lbWFwcGluZyAhPT0gcmVuZGVyZXIudG9uZU1hcHBpbmcpIHsKICAgICAgICAgIHBsYW5lTWVzaC5tYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgICBjdXJyZW50QmFja2dyb3VuZCA9IGJhY2tncm91bmQ7CiAgICAgICAgICBjdXJyZW50QmFja2dyb3VuZFZlcnNpb24gPSBiYWNrZ3JvdW5kLnZlcnNpb247CiAgICAgICAgICBjdXJyZW50VG9uZW1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKICAgICAgICB9CiAgICAgICAgcmVuZGVyTGlzdC51bnNoaWZ0KHBsYW5lTWVzaCwgcGxhbmVNZXNoLmdlb21ldHJ5LCBwbGFuZU1lc2gubWF0ZXJpYWwsIDAsIDAsIG51bGwpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzZXRDbGVhcihjb2xvciwgYWxwaGEpIHsKICAgICAgc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhcihjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iLCBhbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGdldENsZWFyQ29sb3I6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBjbGVhckNvbG9yOwogICAgICB9LAogICAgICBzZXRDbGVhckNvbG9yOiBmdW5jdGlvbihjb2xvciwgYWxwaGEgPSAxKSB7CiAgICAgICAgY2xlYXJDb2xvci5zZXQoY29sb3IpOwogICAgICAgIGNsZWFyQWxwaGEgPSBhbHBoYTsKICAgICAgICBzZXRDbGVhcihjbGVhckNvbG9yLCBjbGVhckFscGhhKTsKICAgICAgfSwKICAgICAgZ2V0Q2xlYXJBbHBoYTogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGNsZWFyQWxwaGE7CiAgICAgIH0sCiAgICAgIHNldENsZWFyQWxwaGE6IGZ1bmN0aW9uKGFscGhhKSB7CiAgICAgICAgY2xlYXJBbHBoYSA9IGFscGhhOwogICAgICAgIHNldENsZWFyKGNsZWFyQ29sb3IsIGNsZWFyQWxwaGEpOwogICAgICB9LAogICAgICByZW5kZXIKICAgIH07CiAgfQogIGZ1bmN0aW9uIFdlYkdMQmluZGluZ1N0YXRlcyhnbCwgZXh0ZW5zaW9ucywgYXR0cmlidXRlcywgY2FwYWJpbGl0aWVzKSB7CiAgICBjb25zdCBtYXhWZXJ0ZXhBdHRyaWJ1dGVzID0gZ2wuZ2V0UGFyYW1ldGVyKDM0OTIxKTsKICAgIGNvbnN0IGV4dGVuc2lvbiA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMiA/IG51bGwgOiBleHRlbnNpb25zLmdldCgiT0VTX3ZlcnRleF9hcnJheV9vYmplY3QiKTsKICAgIGNvbnN0IHZhb0F2YWlsYWJsZSA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMiB8fCBleHRlbnNpb24gIT09IG51bGw7CiAgICBjb25zdCBiaW5kaW5nU3RhdGVzID0ge307CiAgICBjb25zdCBkZWZhdWx0U3RhdGUgPSBjcmVhdGVCaW5kaW5nU3RhdGUobnVsbCk7CiAgICBsZXQgY3VycmVudFN0YXRlID0gZGVmYXVsdFN0YXRlOwogICAgZnVuY3Rpb24gc2V0dXAob2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnksIGluZGV4KSB7CiAgICAgIGxldCB1cGRhdGVCdWZmZXJzID0gZmFsc2U7CiAgICAgIGlmICh2YW9BdmFpbGFibGUpIHsKICAgICAgICBjb25zdCBzdGF0ZSA9IGdldEJpbmRpbmdTdGF0ZShnZW9tZXRyeSwgcHJvZ3JhbSwgbWF0ZXJpYWwpOwogICAgICAgIGlmIChjdXJyZW50U3RhdGUgIT09IHN0YXRlKSB7CiAgICAgICAgICBjdXJyZW50U3RhdGUgPSBzdGF0ZTsKICAgICAgICAgIGJpbmRWZXJ0ZXhBcnJheU9iamVjdChjdXJyZW50U3RhdGUub2JqZWN0KTsKICAgICAgICB9CiAgICAgICAgdXBkYXRlQnVmZmVycyA9IG5lZWRzVXBkYXRlKGdlb21ldHJ5LCBpbmRleCk7CiAgICAgICAgaWYgKHVwZGF0ZUJ1ZmZlcnMpCiAgICAgICAgICBzYXZlQ2FjaGUoZ2VvbWV0cnksIGluZGV4KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB3aXJlZnJhbWUgPSBtYXRlcmlhbC53aXJlZnJhbWUgPT09IHRydWU7CiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZS5nZW9tZXRyeSAhPT0gZ2VvbWV0cnkuaWQgfHwgY3VycmVudFN0YXRlLnByb2dyYW0gIT09IHByb2dyYW0uaWQgfHwgY3VycmVudFN0YXRlLndpcmVmcmFtZSAhPT0gd2lyZWZyYW1lKSB7CiAgICAgICAgICBjdXJyZW50U3RhdGUuZ2VvbWV0cnkgPSBnZW9tZXRyeS5pZDsKICAgICAgICAgIGN1cnJlbnRTdGF0ZS5wcm9ncmFtID0gcHJvZ3JhbS5pZDsKICAgICAgICAgIGN1cnJlbnRTdGF0ZS53aXJlZnJhbWUgPSB3aXJlZnJhbWU7CiAgICAgICAgICB1cGRhdGVCdWZmZXJzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG9iamVjdC5pc0luc3RhbmNlZE1lc2ggPT09IHRydWUpIHsKICAgICAgICB1cGRhdGVCdWZmZXJzID0gdHJ1ZTsKICAgICAgfQogICAgICBpZiAoaW5kZXggIT09IG51bGwpIHsKICAgICAgICBhdHRyaWJ1dGVzLnVwZGF0ZShpbmRleCwgMzQ5NjMpOwogICAgICB9CiAgICAgIGlmICh1cGRhdGVCdWZmZXJzKSB7CiAgICAgICAgc2V0dXBWZXJ0ZXhBdHRyaWJ1dGVzKG9iamVjdCwgbWF0ZXJpYWwsIHByb2dyYW0sIGdlb21ldHJ5KTsKICAgICAgICBpZiAoaW5kZXggIT09IG51bGwpIHsKICAgICAgICAgIGdsLmJpbmRCdWZmZXIoMzQ5NjMsIGF0dHJpYnV0ZXMuZ2V0KGluZGV4KS5idWZmZXIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlVmVydGV4QXJyYXlPYmplY3QoKSB7CiAgICAgIGlmIChjYXBhYmlsaXRpZXMuaXNXZWJHTDIpCiAgICAgICAgcmV0dXJuIGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7CiAgICAgIHJldHVybiBleHRlbnNpb24uY3JlYXRlVmVydGV4QXJyYXlPRVMoKTsKICAgIH0KICAgIGZ1bmN0aW9uIGJpbmRWZXJ0ZXhBcnJheU9iamVjdCh2YW8pIHsKICAgICAgaWYgKGNhcGFiaWxpdGllcy5pc1dlYkdMMikKICAgICAgICByZXR1cm4gZ2wuYmluZFZlcnRleEFycmF5KHZhbyk7CiAgICAgIHJldHVybiBleHRlbnNpb24uYmluZFZlcnRleEFycmF5T0VTKHZhbyk7CiAgICB9CiAgICBmdW5jdGlvbiBkZWxldGVWZXJ0ZXhBcnJheU9iamVjdCh2YW8pIHsKICAgICAgaWYgKGNhcGFiaWxpdGllcy5pc1dlYkdMMikKICAgICAgICByZXR1cm4gZ2wuZGVsZXRlVmVydGV4QXJyYXkodmFvKTsKICAgICAgcmV0dXJuIGV4dGVuc2lvbi5kZWxldGVWZXJ0ZXhBcnJheU9FUyh2YW8pOwogICAgfQogICAgZnVuY3Rpb24gZ2V0QmluZGluZ1N0YXRlKGdlb21ldHJ5LCBwcm9ncmFtLCBtYXRlcmlhbCkgewogICAgICBjb25zdCB3aXJlZnJhbWUgPSBtYXRlcmlhbC53aXJlZnJhbWUgPT09IHRydWU7CiAgICAgIGxldCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1tnZW9tZXRyeS5pZF07CiAgICAgIGlmIChwcm9ncmFtTWFwID09PSB2b2lkIDApIHsKICAgICAgICBwcm9ncmFtTWFwID0ge307CiAgICAgICAgYmluZGluZ1N0YXRlc1tnZW9tZXRyeS5pZF0gPSBwcm9ncmFtTWFwOwogICAgICB9CiAgICAgIGxldCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbcHJvZ3JhbS5pZF07CiAgICAgIGlmIChzdGF0ZU1hcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgc3RhdGVNYXAgPSB7fTsKICAgICAgICBwcm9ncmFtTWFwW3Byb2dyYW0uaWRdID0gc3RhdGVNYXA7CiAgICAgIH0KICAgICAgbGV0IHN0YXRlID0gc3RhdGVNYXBbd2lyZWZyYW1lXTsKICAgICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHsKICAgICAgICBzdGF0ZSA9IGNyZWF0ZUJpbmRpbmdTdGF0ZShjcmVhdGVWZXJ0ZXhBcnJheU9iamVjdCgpKTsKICAgICAgICBzdGF0ZU1hcFt3aXJlZnJhbWVdID0gc3RhdGU7CiAgICAgIH0KICAgICAgcmV0dXJuIHN0YXRlOwogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlQmluZGluZ1N0YXRlKHZhbykgewogICAgICBjb25zdCBuZXdBdHRyaWJ1dGVzID0gW107CiAgICAgIGNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gW107CiAgICAgIGNvbnN0IGF0dHJpYnV0ZURpdmlzb3JzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4VmVydGV4QXR0cmlidXRlczsgaSsrKSB7CiAgICAgICAgbmV3QXR0cmlidXRlc1tpXSA9IDA7CiAgICAgICAgZW5hYmxlZEF0dHJpYnV0ZXNbaV0gPSAwOwogICAgICAgIGF0dHJpYnV0ZURpdmlzb3JzW2ldID0gMDsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIGdlb21ldHJ5OiBudWxsLAogICAgICAgIHByb2dyYW06IG51bGwsCiAgICAgICAgd2lyZWZyYW1lOiBmYWxzZSwKICAgICAgICBuZXdBdHRyaWJ1dGVzLAogICAgICAgIGVuYWJsZWRBdHRyaWJ1dGVzLAogICAgICAgIGF0dHJpYnV0ZURpdmlzb3JzLAogICAgICAgIG9iamVjdDogdmFvLAogICAgICAgIGF0dHJpYnV0ZXM6IHt9LAogICAgICAgIGluZGV4OiBudWxsCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBuZWVkc1VwZGF0ZShnZW9tZXRyeSwgaW5kZXgpIHsKICAgICAgY29uc3QgY2FjaGVkQXR0cmlidXRlcyA9IGN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVzOwogICAgICBjb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwogICAgICBsZXQgYXR0cmlidXRlc051bSA9IDA7CiAgICAgIGZvciAoY29uc3Qga2V5IGluIGdlb21ldHJ5QXR0cmlidXRlcykgewogICAgICAgIGNvbnN0IGNhY2hlZEF0dHJpYnV0ZSA9IGNhY2hlZEF0dHJpYnV0ZXNba2V5XTsKICAgICAgICBjb25zdCBnZW9tZXRyeUF0dHJpYnV0ZSA9IGdlb21ldHJ5QXR0cmlidXRlc1trZXldOwogICAgICAgIGlmIChjYWNoZWRBdHRyaWJ1dGUgPT09IHZvaWQgMCkKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChjYWNoZWRBdHRyaWJ1dGUuYXR0cmlidXRlICE9PSBnZW9tZXRyeUF0dHJpYnV0ZSkKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChjYWNoZWRBdHRyaWJ1dGUuZGF0YSAhPT0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YSkKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGF0dHJpYnV0ZXNOdW0rKzsKICAgICAgfQogICAgICBpZiAoY3VycmVudFN0YXRlLmF0dHJpYnV0ZXNOdW0gIT09IGF0dHJpYnV0ZXNOdW0pCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIGlmIChjdXJyZW50U3RhdGUuaW5kZXggIT09IGluZGV4KQogICAgICAgIHJldHVybiB0cnVlOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBmdW5jdGlvbiBzYXZlQ2FjaGUoZ2VvbWV0cnksIGluZGV4KSB7CiAgICAgIGNvbnN0IGNhY2hlID0ge307CiAgICAgIGNvbnN0IGF0dHJpYnV0ZXMyID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKICAgICAgbGV0IGF0dHJpYnV0ZXNOdW0gPSAwOwogICAgICBmb3IgKGNvbnN0IGtleSBpbiBhdHRyaWJ1dGVzMikgewogICAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMyW2tleV07CiAgICAgICAgY29uc3QgZGF0YSA9IHt9OwogICAgICAgIGRhdGEuYXR0cmlidXRlID0gYXR0cmlidXRlOwogICAgICAgIGlmIChhdHRyaWJ1dGUuZGF0YSkgewogICAgICAgICAgZGF0YS5kYXRhID0gYXR0cmlidXRlLmRhdGE7CiAgICAgICAgfQogICAgICAgIGNhY2hlW2tleV0gPSBkYXRhOwogICAgICAgIGF0dHJpYnV0ZXNOdW0rKzsKICAgICAgfQogICAgICBjdXJyZW50U3RhdGUuYXR0cmlidXRlcyA9IGNhY2hlOwogICAgICBjdXJyZW50U3RhdGUuYXR0cmlidXRlc051bSA9IGF0dHJpYnV0ZXNOdW07CiAgICAgIGN1cnJlbnRTdGF0ZS5pbmRleCA9IGluZGV4OwogICAgfQogICAgZnVuY3Rpb24gaW5pdEF0dHJpYnV0ZXMoKSB7CiAgICAgIGNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gbmV3QXR0cmlidXRlcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgbmV3QXR0cmlidXRlc1tpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGVuYWJsZUF0dHJpYnV0ZShhdHRyaWJ1dGUpIHsKICAgICAgZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvcihhdHRyaWJ1dGUsIDApOwogICAgfQogICAgZnVuY3Rpb24gZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvcihhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUpIHsKICAgICAgY29uc3QgbmV3QXR0cmlidXRlcyA9IGN1cnJlbnRTdGF0ZS5uZXdBdHRyaWJ1dGVzOwogICAgICBjb25zdCBlbmFibGVkQXR0cmlidXRlcyA9IGN1cnJlbnRTdGF0ZS5lbmFibGVkQXR0cmlidXRlczsKICAgICAgY29uc3QgYXR0cmlidXRlRGl2aXNvcnMgPSBjdXJyZW50U3RhdGUuYXR0cmlidXRlRGl2aXNvcnM7CiAgICAgIG5ld0F0dHJpYnV0ZXNbYXR0cmlidXRlXSA9IDE7CiAgICAgIGlmIChlbmFibGVkQXR0cmlidXRlc1thdHRyaWJ1dGVdID09PSAwKSB7CiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoYXR0cmlidXRlKTsKICAgICAgICBlbmFibGVkQXR0cmlidXRlc1thdHRyaWJ1dGVdID0gMTsKICAgICAgfQogICAgICBpZiAoYXR0cmlidXRlRGl2aXNvcnNbYXR0cmlidXRlXSAhPT0gbWVzaFBlckF0dHJpYnV0ZSkgewogICAgICAgIGNvbnN0IGV4dGVuc2lvbjIgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPyBnbCA6IGV4dGVuc2lvbnMuZ2V0KCJBTkdMRV9pbnN0YW5jZWRfYXJyYXlzIik7CiAgICAgICAgZXh0ZW5zaW9uMltjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPyAidmVydGV4QXR0cmliRGl2aXNvciIgOiAidmVydGV4QXR0cmliRGl2aXNvckFOR0xFIl0oYXR0cmlidXRlLCBtZXNoUGVyQXR0cmlidXRlKTsKICAgICAgICBhdHRyaWJ1dGVEaXZpc29yc1thdHRyaWJ1dGVdID0gbWVzaFBlckF0dHJpYnV0ZTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMoKSB7CiAgICAgIGNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKICAgICAgY29uc3QgZW5hYmxlZEF0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUuZW5hYmxlZEF0dHJpYnV0ZXM7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IGVuYWJsZWRBdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICBpZiAoZW5hYmxlZEF0dHJpYnV0ZXNbaV0gIT09IG5ld0F0dHJpYnV0ZXNbaV0pIHsKICAgICAgICAgIGdsLmRpc2FibGVWZXJ0ZXhBdHRyaWJBcnJheShpKTsKICAgICAgICAgIGVuYWJsZWRBdHRyaWJ1dGVzW2ldID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHZlcnRleEF0dHJpYlBvaW50ZXIoaW5kZXgsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSwgb2Zmc2V0KSB7CiAgICAgIGlmIChjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPT09IHRydWUgJiYgKHR5cGUgPT09IDUxMjQgfHwgdHlwZSA9PT0gNTEyNSkpIHsKICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJJUG9pbnRlcihpbmRleCwgc2l6ZSwgdHlwZSwgc3RyaWRlLCBvZmZzZXQpOwogICAgICB9IGVsc2UgewogICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoaW5kZXgsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSwgb2Zmc2V0KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2V0dXBWZXJ0ZXhBdHRyaWJ1dGVzKG9iamVjdCwgbWF0ZXJpYWwsIHByb2dyYW0sIGdlb21ldHJ5KSB7CiAgICAgIGlmIChjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPT09IGZhbHNlICYmIChvYmplY3QuaXNJbnN0YW5jZWRNZXNoIHx8IGdlb21ldHJ5LmlzSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkpKSB7CiAgICAgICAgaWYgKGV4dGVuc2lvbnMuZ2V0KCJBTkdMRV9pbnN0YW5jZWRfYXJyYXlzIikgPT09IG51bGwpCiAgICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaW5pdEF0dHJpYnV0ZXMoKTsKICAgICAgY29uc3QgZ2VvbWV0cnlBdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKICAgICAgY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKICAgICAgY29uc3QgbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzID0gbWF0ZXJpYWwuZGVmYXVsdEF0dHJpYnV0ZVZhbHVlczsKICAgICAgZm9yIChjb25zdCBuYW1lIGluIHByb2dyYW1BdHRyaWJ1dGVzKSB7CiAgICAgICAgY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZSA9IHByb2dyYW1BdHRyaWJ1dGVzW25hbWVdOwogICAgICAgIGlmIChwcm9ncmFtQXR0cmlidXRlID49IDApIHsKICAgICAgICAgIGNvbnN0IGdlb21ldHJ5QXR0cmlidXRlID0gZ2VvbWV0cnlBdHRyaWJ1dGVzW25hbWVdOwogICAgICAgICAgaWYgKGdlb21ldHJ5QXR0cmlidXRlICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZCA9IGdlb21ldHJ5QXR0cmlidXRlLm5vcm1hbGl6ZWQ7CiAgICAgICAgICAgIGNvbnN0IHNpemUgPSBnZW9tZXRyeUF0dHJpYnV0ZS5pdGVtU2l6ZTsKICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlcy5nZXQoZ2VvbWV0cnlBdHRyaWJ1dGUpOwogICAgICAgICAgICBpZiAoYXR0cmlidXRlID09PSB2b2lkIDApCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IGF0dHJpYnV0ZS5idWZmZXI7CiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBhdHRyaWJ1dGUudHlwZTsKICAgICAgICAgICAgY29uc3QgYnl0ZXNQZXJFbGVtZW50ID0gYXR0cmlidXRlLmJ5dGVzUGVyRWxlbWVudDsKICAgICAgICAgICAgaWYgKGdlb21ldHJ5QXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUpIHsKICAgICAgICAgICAgICBjb25zdCBkYXRhID0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YTsKICAgICAgICAgICAgICBjb25zdCBzdHJpZGUgPSBkYXRhLnN0cmlkZTsKICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBnZW9tZXRyeUF0dHJpYnV0ZS5vZmZzZXQ7CiAgICAgICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5pc0luc3RhbmNlZEludGVybGVhdmVkQnVmZmVyKSB7CiAgICAgICAgICAgICAgICBlbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKHByb2dyYW1BdHRyaWJ1dGUsIGRhdGEubWVzaFBlckF0dHJpYnV0ZSk7CiAgICAgICAgICAgICAgICBpZiAoZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA9IGRhdGEubWVzaFBlckF0dHJpYnV0ZSAqIGRhdGEuY291bnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVuYWJsZUF0dHJpYnV0ZShwcm9ncmFtQXR0cmlidXRlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcigzNDk2MiwgYnVmZmVyKTsKICAgICAgICAgICAgICB2ZXJ0ZXhBdHRyaWJQb2ludGVyKHByb2dyYW1BdHRyaWJ1dGUsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSAqIGJ5dGVzUGVyRWxlbWVudCwgb2Zmc2V0ICogYnl0ZXNQZXJFbGVtZW50KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoZ2VvbWV0cnlBdHRyaWJ1dGUuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUpIHsKICAgICAgICAgICAgICAgIGVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IocHJvZ3JhbUF0dHJpYnV0ZSwgZ2VvbWV0cnlBdHRyaWJ1dGUubWVzaFBlckF0dHJpYnV0ZSk7CiAgICAgICAgICAgICAgICBpZiAoZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA9IGdlb21ldHJ5QXR0cmlidXRlLm1lc2hQZXJBdHRyaWJ1dGUgKiBnZW9tZXRyeUF0dHJpYnV0ZS5jb3VudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZW5hYmxlQXR0cmlidXRlKHByb2dyYW1BdHRyaWJ1dGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBnbC5iaW5kQnVmZmVyKDM0OTYyLCBidWZmZXIpOwogICAgICAgICAgICAgIHZlcnRleEF0dHJpYlBvaW50ZXIocHJvZ3JhbUF0dHJpYnV0ZSwgc2l6ZSwgdHlwZSwgbm9ybWFsaXplZCwgMCwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAobmFtZSA9PT0gImluc3RhbmNlTWF0cml4IikgewogICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzLmdldChvYmplY3QuaW5zdGFuY2VNYXRyaXgpOwogICAgICAgICAgICBpZiAoYXR0cmlidXRlID09PSB2b2lkIDApCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IGF0dHJpYnV0ZS5idWZmZXI7CiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBhdHRyaWJ1dGUudHlwZTsKICAgICAgICAgICAgZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvcihwcm9ncmFtQXR0cmlidXRlICsgMCwgMSk7CiAgICAgICAgICAgIGVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IocHJvZ3JhbUF0dHJpYnV0ZSArIDEsIDEpOwogICAgICAgICAgICBlbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKHByb2dyYW1BdHRyaWJ1dGUgKyAyLCAxKTsKICAgICAgICAgICAgZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvcihwcm9ncmFtQXR0cmlidXRlICsgMywgMSk7CiAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoMzQ5NjIsIGJ1ZmZlcik7CiAgICAgICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIocHJvZ3JhbUF0dHJpYnV0ZSArIDAsIDQsIHR5cGUsIGZhbHNlLCA2NCwgMCk7CiAgICAgICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIocHJvZ3JhbUF0dHJpYnV0ZSArIDEsIDQsIHR5cGUsIGZhbHNlLCA2NCwgMTYpOwogICAgICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHByb2dyYW1BdHRyaWJ1dGUgKyAyLCA0LCB0eXBlLCBmYWxzZSwgNjQsIDMyKTsKICAgICAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihwcm9ncmFtQXR0cmlidXRlICsgMywgNCwgdHlwZSwgZmFsc2UsIDY0LCA0OCk7CiAgICAgICAgICB9IGVsc2UgaWYgKG5hbWUgPT09ICJpbnN0YW5jZUNvbG9yIikgewogICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzLmdldChvYmplY3QuaW5zdGFuY2VDb2xvcik7CiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUgPT09IHZvaWQgMCkKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gYXR0cmlidXRlLmJ1ZmZlcjsKICAgICAgICAgICAgY29uc3QgdHlwZSA9IGF0dHJpYnV0ZS50eXBlOwogICAgICAgICAgICBlbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKHByb2dyYW1BdHRyaWJ1dGUsIDEpOwogICAgICAgICAgICBnbC5iaW5kQnVmZmVyKDM0OTYyLCBidWZmZXIpOwogICAgICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHByb2dyYW1BdHRyaWJ1dGUsIDMsIHR5cGUsIGZhbHNlLCAxMiwgMCk7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlcyAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzW25hbWVdOwogICAgICAgICAgICBpZiAodmFsdWUgIT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgIGdsLnZlcnRleEF0dHJpYjJmdihwcm9ncmFtQXR0cmlidXRlLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICBnbC52ZXJ0ZXhBdHRyaWIzZnYocHJvZ3JhbUF0dHJpYnV0ZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgZ2wudmVydGV4QXR0cmliNGZ2KHByb2dyYW1BdHRyaWJ1dGUsIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICBnbC52ZXJ0ZXhBdHRyaWIxZnYocHJvZ3JhbUF0dHJpYnV0ZSwgdmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBkaXNhYmxlVW51c2VkQXR0cmlidXRlcygpOwogICAgfQogICAgZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgcmVzZXQoKTsKICAgICAgZm9yIChjb25zdCBnZW9tZXRyeUlkIGluIGJpbmRpbmdTdGF0ZXMpIHsKICAgICAgICBjb25zdCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1tnZW9tZXRyeUlkXTsKICAgICAgICBmb3IgKGNvbnN0IHByb2dyYW1JZCBpbiBwcm9ncmFtTWFwKSB7CiAgICAgICAgICBjb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbcHJvZ3JhbUlkXTsKICAgICAgICAgIGZvciAoY29uc3Qgd2lyZWZyYW1lIGluIHN0YXRlTWFwKSB7CiAgICAgICAgICAgIGRlbGV0ZVZlcnRleEFycmF5T2JqZWN0KHN0YXRlTWFwW3dpcmVmcmFtZV0ub2JqZWN0KTsKICAgICAgICAgICAgZGVsZXRlIHN0YXRlTWFwW3dpcmVmcmFtZV07CiAgICAgICAgICB9CiAgICAgICAgICBkZWxldGUgcHJvZ3JhbU1hcFtwcm9ncmFtSWRdOwogICAgICAgIH0KICAgICAgICBkZWxldGUgYmluZGluZ1N0YXRlc1tnZW9tZXRyeUlkXTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVsZWFzZVN0YXRlc09mR2VvbWV0cnkoZ2VvbWV0cnkpIHsKICAgICAgaWYgKGJpbmRpbmdTdGF0ZXNbZ2VvbWV0cnkuaWRdID09PSB2b2lkIDApCiAgICAgICAgcmV0dXJuOwogICAgICBjb25zdCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1tnZW9tZXRyeS5pZF07CiAgICAgIGZvciAoY29uc3QgcHJvZ3JhbUlkIGluIHByb2dyYW1NYXApIHsKICAgICAgICBjb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbcHJvZ3JhbUlkXTsKICAgICAgICBmb3IgKGNvbnN0IHdpcmVmcmFtZSBpbiBzdGF0ZU1hcCkgewogICAgICAgICAgZGVsZXRlVmVydGV4QXJyYXlPYmplY3Qoc3RhdGVNYXBbd2lyZWZyYW1lXS5vYmplY3QpOwogICAgICAgICAgZGVsZXRlIHN0YXRlTWFwW3dpcmVmcmFtZV07CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBwcm9ncmFtTWFwW3Byb2dyYW1JZF07CiAgICAgIH0KICAgICAgZGVsZXRlIGJpbmRpbmdTdGF0ZXNbZ2VvbWV0cnkuaWRdOwogICAgfQogICAgZnVuY3Rpb24gcmVsZWFzZVN0YXRlc09mUHJvZ3JhbShwcm9ncmFtKSB7CiAgICAgIGZvciAoY29uc3QgZ2VvbWV0cnlJZCBpbiBiaW5kaW5nU3RhdGVzKSB7CiAgICAgICAgY29uc3QgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbZ2VvbWV0cnlJZF07CiAgICAgICAgaWYgKHByb2dyYW1NYXBbcHJvZ3JhbS5pZF0gPT09IHZvaWQgMCkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGNvbnN0IHN0YXRlTWFwID0gcHJvZ3JhbU1hcFtwcm9ncmFtLmlkXTsKICAgICAgICBmb3IgKGNvbnN0IHdpcmVmcmFtZSBpbiBzdGF0ZU1hcCkgewogICAgICAgICAgZGVsZXRlVmVydGV4QXJyYXlPYmplY3Qoc3RhdGVNYXBbd2lyZWZyYW1lXS5vYmplY3QpOwogICAgICAgICAgZGVsZXRlIHN0YXRlTWFwW3dpcmVmcmFtZV07CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBwcm9ncmFtTWFwW3Byb2dyYW0uaWRdOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgcmVzZXREZWZhdWx0U3RhdGUoKTsKICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gZGVmYXVsdFN0YXRlKQogICAgICAgIHJldHVybjsKICAgICAgY3VycmVudFN0YXRlID0gZGVmYXVsdFN0YXRlOwogICAgICBiaW5kVmVydGV4QXJyYXlPYmplY3QoY3VycmVudFN0YXRlLm9iamVjdCk7CiAgICB9CiAgICBmdW5jdGlvbiByZXNldERlZmF1bHRTdGF0ZSgpIHsKICAgICAgZGVmYXVsdFN0YXRlLmdlb21ldHJ5ID0gbnVsbDsKICAgICAgZGVmYXVsdFN0YXRlLnByb2dyYW0gPSBudWxsOwogICAgICBkZWZhdWx0U3RhdGUud2lyZWZyYW1lID0gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gewogICAgICBzZXR1cCwKICAgICAgcmVzZXQsCiAgICAgIHJlc2V0RGVmYXVsdFN0YXRlLAogICAgICBkaXNwb3NlLAogICAgICByZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeSwKICAgICAgcmVsZWFzZVN0YXRlc09mUHJvZ3JhbSwKICAgICAgaW5pdEF0dHJpYnV0ZXMsCiAgICAgIGVuYWJsZUF0dHJpYnV0ZSwKICAgICAgZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMKICAgIH07CiAgfQogIGZ1bmN0aW9uIFdlYkdMQnVmZmVyUmVuZGVyZXIoZ2wsIGV4dGVuc2lvbnMsIGluZm8sIGNhcGFiaWxpdGllcykgewogICAgY29uc3QgaXNXZWJHTDIgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDI7CiAgICBsZXQgbW9kZTsKICAgIGZ1bmN0aW9uIHNldE1vZGUodmFsdWUpIHsKICAgICAgbW9kZSA9IHZhbHVlOwogICAgfQogICAgZnVuY3Rpb24gcmVuZGVyKHN0YXJ0LCBjb3VudCkgewogICAgICBnbC5kcmF3QXJyYXlzKG1vZGUsIHN0YXJ0LCBjb3VudCk7CiAgICAgIGluZm8udXBkYXRlKGNvdW50LCBtb2RlLCAxKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlbmRlckluc3RhbmNlcyhzdGFydCwgY291bnQsIHByaW1jb3VudCkgewogICAgICBpZiAocHJpbWNvdW50ID09PSAwKQogICAgICAgIHJldHVybjsKICAgICAgbGV0IGV4dGVuc2lvbiwgbWV0aG9kTmFtZTsKICAgICAgaWYgKGlzV2ViR0wyKSB7CiAgICAgICAgZXh0ZW5zaW9uID0gZ2w7CiAgICAgICAgbWV0aG9kTmFtZSA9ICJkcmF3QXJyYXlzSW5zdGFuY2VkIjsKICAgICAgfSBlbHNlIHsKICAgICAgICBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCgiQU5HTEVfaW5zdGFuY2VkX2FycmF5cyIpOwogICAgICAgIG1ldGhvZE5hbWUgPSAiZHJhd0FycmF5c0luc3RhbmNlZEFOR0xFIjsKICAgICAgICBpZiAoZXh0ZW5zaW9uID09PSBudWxsKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5XZWJHTEJ1ZmZlclJlbmRlcmVyOiB1c2luZyBUSFJFRS5JbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSBidXQgaGFyZHdhcmUgZG9lcyBub3Qgc3VwcG9ydCBleHRlbnNpb24gQU5HTEVfaW5zdGFuY2VkX2FycmF5cy4iKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZXh0ZW5zaW9uW21ldGhvZE5hbWVdKG1vZGUsIHN0YXJ0LCBjb3VudCwgcHJpbWNvdW50KTsKICAgICAgaW5mby51cGRhdGUoY291bnQsIG1vZGUsIHByaW1jb3VudCk7CiAgICB9CiAgICB0aGlzLnNldE1vZGUgPSBzZXRNb2RlOwogICAgdGhpcy5yZW5kZXIgPSByZW5kZXI7CiAgICB0aGlzLnJlbmRlckluc3RhbmNlcyA9IHJlbmRlckluc3RhbmNlczsKICB9CiAgZnVuY3Rpb24gV2ViR0xDYXBhYmlsaXRpZXMoZ2wsIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMpIHsKICAgIGxldCBtYXhBbmlzb3Ryb3B5OwogICAgZnVuY3Rpb24gZ2V0TWF4QW5pc290cm9weSgpIHsKICAgICAgaWYgKG1heEFuaXNvdHJvcHkgIT09IHZvaWQgMCkKICAgICAgICByZXR1cm4gbWF4QW5pc290cm9weTsKICAgICAgaWYgKGV4dGVuc2lvbnMuaGFzKCJFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMiKSA9PT0gdHJ1ZSkgewogICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCJFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMiKTsKICAgICAgICBtYXhBbmlzb3Ryb3B5ID0gZ2wuZ2V0UGFyYW1ldGVyKGV4dGVuc2lvbi5NQVhfVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQpOwogICAgICB9IGVsc2UgewogICAgICAgIG1heEFuaXNvdHJvcHkgPSAwOwogICAgICB9CiAgICAgIHJldHVybiBtYXhBbmlzb3Ryb3B5OwogICAgfQogICAgZnVuY3Rpb24gZ2V0TWF4UHJlY2lzaW9uKHByZWNpc2lvbjIpIHsKICAgICAgaWYgKHByZWNpc2lvbjIgPT09ICJoaWdocCIpIHsKICAgICAgICBpZiAoZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KDM1NjMzLCAzNjMzOCkucHJlY2lzaW9uID4gMCAmJiBnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoMzU2MzIsIDM2MzM4KS5wcmVjaXNpb24gPiAwKSB7CiAgICAgICAgICByZXR1cm4gImhpZ2hwIjsKICAgICAgICB9CiAgICAgICAgcHJlY2lzaW9uMiA9ICJtZWRpdW1wIjsKICAgICAgfQogICAgICBpZiAocHJlY2lzaW9uMiA9PT0gIm1lZGl1bXAiKSB7CiAgICAgICAgaWYgKGdsLmdldFNoYWRlclByZWNpc2lvbkZvcm1hdCgzNTYzMywgMzYzMzcpLnByZWNpc2lvbiA+IDAgJiYgZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KDM1NjMyLCAzNjMzNykucHJlY2lzaW9uID4gMCkgewogICAgICAgICAgcmV0dXJuICJtZWRpdW1wIjsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuICJsb3dwIjsKICAgIH0KICAgIGNvbnN0IGlzV2ViR0wyID0gdHlwZW9mIFdlYkdMMlJlbmRlcmluZ0NvbnRleHQgIT09ICJ1bmRlZmluZWQiICYmIGdsIGluc3RhbmNlb2YgV2ViR0wyUmVuZGVyaW5nQ29udGV4dCB8fCB0eXBlb2YgV2ViR0wyQ29tcHV0ZVJlbmRlcmluZ0NvbnRleHQgIT09ICJ1bmRlZmluZWQiICYmIGdsIGluc3RhbmNlb2YgV2ViR0wyQ29tcHV0ZVJlbmRlcmluZ0NvbnRleHQ7CiAgICBsZXQgcHJlY2lzaW9uID0gcGFyYW1ldGVycy5wcmVjaXNpb24gIT09IHZvaWQgMCA/IHBhcmFtZXRlcnMucHJlY2lzaW9uIDogImhpZ2hwIjsKICAgIGNvbnN0IG1heFByZWNpc2lvbiA9IGdldE1heFByZWNpc2lvbihwcmVjaXNpb24pOwogICAgaWYgKG1heFByZWNpc2lvbiAhPT0gcHJlY2lzaW9uKSB7CiAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjoiLCBwcmVjaXNpb24sICJub3Qgc3VwcG9ydGVkLCB1c2luZyIsIG1heFByZWNpc2lvbiwgImluc3RlYWQuIik7CiAgICAgIHByZWNpc2lvbiA9IG1heFByZWNpc2lvbjsKICAgIH0KICAgIGNvbnN0IGRyYXdCdWZmZXJzID0gaXNXZWJHTDIgfHwgZXh0ZW5zaW9ucy5oYXMoIldFQkdMX2RyYXdfYnVmZmVycyIpOwogICAgY29uc3QgbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9IHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9PT0gdHJ1ZTsKICAgIGNvbnN0IG1heFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKDM0OTMwKTsKICAgIGNvbnN0IG1heFZlcnRleFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKDM1NjYwKTsKICAgIGNvbnN0IG1heFRleHR1cmVTaXplID0gZ2wuZ2V0UGFyYW1ldGVyKDMzNzkpOwogICAgY29uc3QgbWF4Q3ViZW1hcFNpemUgPSBnbC5nZXRQYXJhbWV0ZXIoMzQwNzYpOwogICAgY29uc3QgbWF4QXR0cmlidXRlcyA9IGdsLmdldFBhcmFtZXRlcigzNDkyMSk7CiAgICBjb25zdCBtYXhWZXJ0ZXhVbmlmb3JtcyA9IGdsLmdldFBhcmFtZXRlcigzNjM0Nyk7CiAgICBjb25zdCBtYXhWYXJ5aW5ncyA9IGdsLmdldFBhcmFtZXRlcigzNjM0OCk7CiAgICBjb25zdCBtYXhGcmFnbWVudFVuaWZvcm1zID0gZ2wuZ2V0UGFyYW1ldGVyKDM2MzQ5KTsKICAgIGNvbnN0IHZlcnRleFRleHR1cmVzID0gbWF4VmVydGV4VGV4dHVyZXMgPiAwOwogICAgY29uc3QgZmxvYXRGcmFnbWVudFRleHR1cmVzID0gaXNXZWJHTDIgfHwgZXh0ZW5zaW9ucy5oYXMoIk9FU190ZXh0dXJlX2Zsb2F0Iik7CiAgICBjb25zdCBmbG9hdFZlcnRleFRleHR1cmVzID0gdmVydGV4VGV4dHVyZXMgJiYgZmxvYXRGcmFnbWVudFRleHR1cmVzOwogICAgY29uc3QgbWF4U2FtcGxlcyA9IGlzV2ViR0wyID8gZ2wuZ2V0UGFyYW1ldGVyKDM2MTgzKSA6IDA7CiAgICByZXR1cm4gewogICAgICBpc1dlYkdMMiwKICAgICAgZHJhd0J1ZmZlcnMsCiAgICAgIGdldE1heEFuaXNvdHJvcHksCiAgICAgIGdldE1heFByZWNpc2lvbiwKICAgICAgcHJlY2lzaW9uLAogICAgICBsb2dhcml0aG1pY0RlcHRoQnVmZmVyLAogICAgICBtYXhUZXh0dXJlcywKICAgICAgbWF4VmVydGV4VGV4dHVyZXMsCiAgICAgIG1heFRleHR1cmVTaXplLAogICAgICBtYXhDdWJlbWFwU2l6ZSwKICAgICAgbWF4QXR0cmlidXRlcywKICAgICAgbWF4VmVydGV4VW5pZm9ybXMsCiAgICAgIG1heFZhcnlpbmdzLAogICAgICBtYXhGcmFnbWVudFVuaWZvcm1zLAogICAgICB2ZXJ0ZXhUZXh0dXJlcywKICAgICAgZmxvYXRGcmFnbWVudFRleHR1cmVzLAogICAgICBmbG9hdFZlcnRleFRleHR1cmVzLAogICAgICBtYXhTYW1wbGVzCiAgICB9OwogIH0KICBmdW5jdGlvbiBXZWJHTENsaXBwaW5nKHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IHNjb3BlID0gdGhpczsKICAgIGxldCBnbG9iYWxTdGF0ZSA9IG51bGwsIG51bUdsb2JhbFBsYW5lcyA9IDAsIGxvY2FsQ2xpcHBpbmdFbmFibGVkID0gZmFsc2UsIHJlbmRlcmluZ1NoYWRvd3MgPSBmYWxzZTsKICAgIGNvbnN0IHBsYW5lID0gbmV3IFBsYW5lKCksIHZpZXdOb3JtYWxNYXRyaXggPSBuZXcgTWF0cml4MygpLCB1bmlmb3JtID0geyB2YWx1ZTogbnVsbCwgbmVlZHNVcGRhdGU6IGZhbHNlIH07CiAgICB0aGlzLnVuaWZvcm0gPSB1bmlmb3JtOwogICAgdGhpcy5udW1QbGFuZXMgPSAwOwogICAgdGhpcy5udW1JbnRlcnNlY3Rpb24gPSAwOwogICAgdGhpcy5pbml0ID0gZnVuY3Rpb24ocGxhbmVzLCBlbmFibGVMb2NhbENsaXBwaW5nLCBjYW1lcmEpIHsKICAgICAgY29uc3QgZW5hYmxlZCA9IHBsYW5lcy5sZW5ndGggIT09IDAgfHwgZW5hYmxlTG9jYWxDbGlwcGluZyB8fCBudW1HbG9iYWxQbGFuZXMgIT09IDAgfHwgbG9jYWxDbGlwcGluZ0VuYWJsZWQ7CiAgICAgIGxvY2FsQ2xpcHBpbmdFbmFibGVkID0gZW5hYmxlTG9jYWxDbGlwcGluZzsKICAgICAgZ2xvYmFsU3RhdGUgPSBwcm9qZWN0UGxhbmVzKHBsYW5lcywgY2FtZXJhLCAwKTsKICAgICAgbnVtR2xvYmFsUGxhbmVzID0gcGxhbmVzLmxlbmd0aDsKICAgICAgcmV0dXJuIGVuYWJsZWQ7CiAgICB9OwogICAgdGhpcy5iZWdpblNoYWRvd3MgPSBmdW5jdGlvbigpIHsKICAgICAgcmVuZGVyaW5nU2hhZG93cyA9IHRydWU7CiAgICAgIHByb2plY3RQbGFuZXMobnVsbCk7CiAgICB9OwogICAgdGhpcy5lbmRTaGFkb3dzID0gZnVuY3Rpb24oKSB7CiAgICAgIHJlbmRlcmluZ1NoYWRvd3MgPSBmYWxzZTsKICAgICAgcmVzZXRHbG9iYWxTdGF0ZSgpOwogICAgfTsKICAgIHRoaXMuc2V0U3RhdGUgPSBmdW5jdGlvbihtYXRlcmlhbCwgY2FtZXJhLCB1c2VDYWNoZSkgewogICAgICBjb25zdCBwbGFuZXMgPSBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lcywgY2xpcEludGVyc2VjdGlvbiA9IG1hdGVyaWFsLmNsaXBJbnRlcnNlY3Rpb24sIGNsaXBTaGFkb3dzID0gbWF0ZXJpYWwuY2xpcFNoYWRvd3M7CiAgICAgIGNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KG1hdGVyaWFsKTsKICAgICAgaWYgKCFsb2NhbENsaXBwaW5nRW5hYmxlZCB8fCBwbGFuZXMgPT09IG51bGwgfHwgcGxhbmVzLmxlbmd0aCA9PT0gMCB8fCByZW5kZXJpbmdTaGFkb3dzICYmICFjbGlwU2hhZG93cykgewogICAgICAgIGlmIChyZW5kZXJpbmdTaGFkb3dzKSB7CiAgICAgICAgICBwcm9qZWN0UGxhbmVzKG51bGwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNldEdsb2JhbFN0YXRlKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IG5HbG9iYWwgPSByZW5kZXJpbmdTaGFkb3dzID8gMCA6IG51bUdsb2JhbFBsYW5lcywgbEdsb2JhbCA9IG5HbG9iYWwgKiA0OwogICAgICAgIGxldCBkc3RBcnJheSA9IG1hdGVyaWFsUHJvcGVydGllcy5jbGlwcGluZ1N0YXRlIHx8IG51bGw7CiAgICAgICAgdW5pZm9ybS52YWx1ZSA9IGRzdEFycmF5OwogICAgICAgIGRzdEFycmF5ID0gcHJvamVjdFBsYW5lcyhwbGFuZXMsIGNhbWVyYSwgbEdsb2JhbCwgdXNlQ2FjaGUpOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBsR2xvYmFsOyArK2kpIHsKICAgICAgICAgIGRzdEFycmF5W2ldID0gZ2xvYmFsU3RhdGVbaV07CiAgICAgICAgfQogICAgICAgIG1hdGVyaWFsUHJvcGVydGllcy5jbGlwcGluZ1N0YXRlID0gZHN0QXJyYXk7CiAgICAgICAgdGhpcy5udW1JbnRlcnNlY3Rpb24gPSBjbGlwSW50ZXJzZWN0aW9uID8gdGhpcy5udW1QbGFuZXMgOiAwOwogICAgICAgIHRoaXMubnVtUGxhbmVzICs9IG5HbG9iYWw7CiAgICAgIH0KICAgIH07CiAgICBmdW5jdGlvbiByZXNldEdsb2JhbFN0YXRlKCkgewogICAgICBpZiAodW5pZm9ybS52YWx1ZSAhPT0gZ2xvYmFsU3RhdGUpIHsKICAgICAgICB1bmlmb3JtLnZhbHVlID0gZ2xvYmFsU3RhdGU7CiAgICAgICAgdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IG51bUdsb2JhbFBsYW5lcyA+IDA7CiAgICAgIH0KICAgICAgc2NvcGUubnVtUGxhbmVzID0gbnVtR2xvYmFsUGxhbmVzOwogICAgICBzY29wZS5udW1JbnRlcnNlY3Rpb24gPSAwOwogICAgfQogICAgZnVuY3Rpb24gcHJvamVjdFBsYW5lcyhwbGFuZXMsIGNhbWVyYSwgZHN0T2Zmc2V0LCBza2lwVHJhbnNmb3JtKSB7CiAgICAgIGNvbnN0IG5QbGFuZXMgPSBwbGFuZXMgIT09IG51bGwgPyBwbGFuZXMubGVuZ3RoIDogMDsKICAgICAgbGV0IGRzdEFycmF5ID0gbnVsbDsKICAgICAgaWYgKG5QbGFuZXMgIT09IDApIHsKICAgICAgICBkc3RBcnJheSA9IHVuaWZvcm0udmFsdWU7CiAgICAgICAgaWYgKHNraXBUcmFuc2Zvcm0gIT09IHRydWUgfHwgZHN0QXJyYXkgPT09IG51bGwpIHsKICAgICAgICAgIGNvbnN0IGZsYXRTaXplID0gZHN0T2Zmc2V0ICsgblBsYW5lcyAqIDQsIHZpZXdNYXRyaXggPSBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlOwogICAgICAgICAgdmlld05vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgodmlld01hdHJpeCk7CiAgICAgICAgICBpZiAoZHN0QXJyYXkgPT09IG51bGwgfHwgZHN0QXJyYXkubGVuZ3RoIDwgZmxhdFNpemUpIHsKICAgICAgICAgICAgZHN0QXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KGZsYXRTaXplKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpNCA9IGRzdE9mZnNldDsgaSAhPT0gblBsYW5lczsgKytpLCBpNCArPSA0KSB7CiAgICAgICAgICAgIHBsYW5lLmNvcHkocGxhbmVzW2ldKS5hcHBseU1hdHJpeDQodmlld01hdHJpeCwgdmlld05vcm1hbE1hdHJpeCk7CiAgICAgICAgICAgIHBsYW5lLm5vcm1hbC50b0FycmF5KGRzdEFycmF5LCBpNCk7CiAgICAgICAgICAgIGRzdEFycmF5W2k0ICsgM10gPSBwbGFuZS5jb25zdGFudDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdW5pZm9ybS52YWx1ZSA9IGRzdEFycmF5OwogICAgICAgIHVuaWZvcm0ubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB9CiAgICAgIHNjb3BlLm51bVBsYW5lcyA9IG5QbGFuZXM7CiAgICAgIHNjb3BlLm51bUludGVyc2VjdGlvbiA9IDA7CiAgICAgIHJldHVybiBkc3RBcnJheTsKICAgIH0KICB9CiAgZnVuY3Rpb24gV2ViR0xDdWJlTWFwcyhyZW5kZXJlcikgewogICAgbGV0IGN1YmVtYXBzID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICBmdW5jdGlvbiBtYXBUZXh0dXJlTWFwcGluZyh0ZXh0dXJlLCBtYXBwaW5nKSB7CiAgICAgIGlmIChtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZykgewogICAgICAgIHRleHR1cmUubWFwcGluZyA9IEN1YmVSZWZsZWN0aW9uTWFwcGluZzsKICAgICAgfSBlbHNlIGlmIChtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZykgewogICAgICAgIHRleHR1cmUubWFwcGluZyA9IEN1YmVSZWZyYWN0aW9uTWFwcGluZzsKICAgICAgfQogICAgICByZXR1cm4gdGV4dHVyZTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldCh0ZXh0dXJlKSB7CiAgICAgIGlmICh0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlKSB7CiAgICAgICAgY29uc3QgbWFwcGluZyA9IHRleHR1cmUubWFwcGluZzsKICAgICAgICBpZiAobWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgfHwgbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcpIHsKICAgICAgICAgIGlmIChjdWJlbWFwcy5oYXModGV4dHVyZSkpIHsKICAgICAgICAgICAgY29uc3QgY3ViZW1hcCA9IGN1YmVtYXBzLmdldCh0ZXh0dXJlKS50ZXh0dXJlOwogICAgICAgICAgICByZXR1cm4gbWFwVGV4dHVyZU1hcHBpbmcoY3ViZW1hcCwgdGV4dHVyZS5tYXBwaW5nKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGltYWdlID0gdGV4dHVyZS5pbWFnZTsKICAgICAgICAgICAgaWYgKGltYWdlICYmIGltYWdlLmhlaWdodCA+IDApIHsKICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0ID0gbmV3IFdlYkdMQ3ViZVJlbmRlclRhcmdldChpbWFnZS5oZWlnaHQgLyAyKTsKICAgICAgICAgICAgICByZW5kZXJUYXJnZXQuZnJvbUVxdWlyZWN0YW5ndWxhclRleHR1cmUocmVuZGVyZXIsIHRleHR1cmUpOwogICAgICAgICAgICAgIGN1YmVtYXBzLnNldCh0ZXh0dXJlLCByZW5kZXJUYXJnZXQpOwogICAgICAgICAgICAgIHJlbmRlcmVyLnNldFJlbmRlclRhcmdldChjdXJyZW50UmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgICB0ZXh0dXJlLmFkZEV2ZW50TGlzdGVuZXIoImRpc3Bvc2UiLCBvblRleHR1cmVEaXNwb3NlKTsKICAgICAgICAgICAgICByZXR1cm4gbWFwVGV4dHVyZU1hcHBpbmcocmVuZGVyVGFyZ2V0LnRleHR1cmUsIHRleHR1cmUubWFwcGluZyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRleHR1cmU7CiAgICB9CiAgICBmdW5jdGlvbiBvblRleHR1cmVEaXNwb3NlKGV2ZW50KSB7CiAgICAgIGNvbnN0IHRleHR1cmUgPSBldmVudC50YXJnZXQ7CiAgICAgIHRleHR1cmUucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGlzcG9zZSIsIG9uVGV4dHVyZURpc3Bvc2UpOwogICAgICBjb25zdCBjdWJlbWFwID0gY3ViZW1hcHMuZ2V0KHRleHR1cmUpOwogICAgICBpZiAoY3ViZW1hcCAhPT0gdm9pZCAwKSB7CiAgICAgICAgY3ViZW1hcHMuZGVsZXRlKHRleHR1cmUpOwogICAgICAgIGN1YmVtYXAuZGlzcG9zZSgpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICBjdWJlbWFwcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgZ2V0LAogICAgICBkaXNwb3NlCiAgICB9OwogIH0KICBmdW5jdGlvbiBXZWJHTEV4dGVuc2lvbnMoZ2wpIHsKICAgIGNvbnN0IGV4dGVuc2lvbnMgPSB7fTsKICAgIGZ1bmN0aW9uIGdldEV4dGVuc2lvbihuYW1lKSB7CiAgICAgIGlmIChleHRlbnNpb25zW25hbWVdICE9PSB2b2lkIDApIHsKICAgICAgICByZXR1cm4gZXh0ZW5zaW9uc1tuYW1lXTsKICAgICAgfQogICAgICBsZXQgZXh0ZW5zaW9uOwogICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICBjYXNlICJXRUJHTF9kZXB0aF90ZXh0dXJlIjoKICAgICAgICAgIGV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbigiV0VCR0xfZGVwdGhfdGV4dHVyZSIpIHx8IGdsLmdldEV4dGVuc2lvbigiTU9aX1dFQkdMX2RlcHRoX3RleHR1cmUiKSB8fCBnbC5nZXRFeHRlbnNpb24oIldFQktJVF9XRUJHTF9kZXB0aF90ZXh0dXJlIik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMiOgogICAgICAgICAgZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCJFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMiKSB8fCBnbC5nZXRFeHRlbnNpb24oIk1PWl9FWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMiKSB8fCBnbC5nZXRFeHRlbnNpb24oIldFQktJVF9FWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIldFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjIjoKICAgICAgICAgIGV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbigiV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMiKSB8fCBnbC5nZXRFeHRlbnNpb24oIk1PWl9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YyIpIHx8IGdsLmdldEV4dGVuc2lvbigiV0VCS0lUX1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjIik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMiOgogICAgICAgICAgZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCJXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMiKSB8fCBnbC5nZXRFeHRlbnNpb24oIldFQktJVF9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24obmFtZSk7CiAgICAgIH0KICAgICAgZXh0ZW5zaW9uc1tuYW1lXSA9IGV4dGVuc2lvbjsKICAgICAgcmV0dXJuIGV4dGVuc2lvbjsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGhhczogZnVuY3Rpb24obmFtZSkgewogICAgICAgIHJldHVybiBnZXRFeHRlbnNpb24obmFtZSkgIT09IG51bGw7CiAgICAgIH0sCiAgICAgIGluaXQ6IGZ1bmN0aW9uKGNhcGFiaWxpdGllcykgewogICAgICAgIGlmIChjYXBhYmlsaXRpZXMuaXNXZWJHTDIpIHsKICAgICAgICAgIGdldEV4dGVuc2lvbigiRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBnZXRFeHRlbnNpb24oIldFQkdMX2RlcHRoX3RleHR1cmUiKTsKICAgICAgICAgIGdldEV4dGVuc2lvbigiT0VTX3RleHR1cmVfZmxvYXQiKTsKICAgICAgICAgIGdldEV4dGVuc2lvbigiT0VTX3RleHR1cmVfaGFsZl9mbG9hdCIpOwogICAgICAgICAgZ2V0RXh0ZW5zaW9uKCJPRVNfdGV4dHVyZV9oYWxmX2Zsb2F0X2xpbmVhciIpOwogICAgICAgICAgZ2V0RXh0ZW5zaW9uKCJPRVNfc3RhbmRhcmRfZGVyaXZhdGl2ZXMiKTsKICAgICAgICAgIGdldEV4dGVuc2lvbigiT0VTX2VsZW1lbnRfaW5kZXhfdWludCIpOwogICAgICAgICAgZ2V0RXh0ZW5zaW9uKCJPRVNfdmVydGV4X2FycmF5X29iamVjdCIpOwogICAgICAgICAgZ2V0RXh0ZW5zaW9uKCJBTkdMRV9pbnN0YW5jZWRfYXJyYXlzIik7CiAgICAgICAgfQogICAgICAgIGdldEV4dGVuc2lvbigiT0VTX3RleHR1cmVfZmxvYXRfbGluZWFyIik7CiAgICAgICAgZ2V0RXh0ZW5zaW9uKCJFWFRfY29sb3JfYnVmZmVyX2hhbGZfZmxvYXQiKTsKICAgICAgfSwKICAgICAgZ2V0OiBmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gZ2V0RXh0ZW5zaW9uKG5hbWUpOwogICAgICAgIGlmIChleHRlbnNpb24gPT09IG51bGwpIHsKICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogIiArIG5hbWUgKyAiIGV4dGVuc2lvbiBub3Qgc3VwcG9ydGVkLiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZXh0ZW5zaW9uOwogICAgICB9CiAgICB9OwogIH0KICBmdW5jdGlvbiBXZWJHTEdlb21ldHJpZXMoZ2wsIGF0dHJpYnV0ZXMsIGluZm8sIGJpbmRpbmdTdGF0ZXMpIHsKICAgIGNvbnN0IGdlb21ldHJpZXMgPSB7fTsKICAgIGNvbnN0IHdpcmVmcmFtZUF0dHJpYnV0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtNYXAoKTsKICAgIGZ1bmN0aW9uIG9uR2VvbWV0cnlEaXNwb3NlKGV2ZW50KSB7CiAgICAgIGNvbnN0IGdlb21ldHJ5ID0gZXZlbnQudGFyZ2V0OwogICAgICBpZiAoZ2VvbWV0cnkuaW5kZXggIT09IG51bGwpIHsKICAgICAgICBhdHRyaWJ1dGVzLnJlbW92ZShnZW9tZXRyeS5pbmRleCk7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBuYW1lIGluIGdlb21ldHJ5LmF0dHJpYnV0ZXMpIHsKICAgICAgICBhdHRyaWJ1dGVzLnJlbW92ZShnZW9tZXRyeS5hdHRyaWJ1dGVzW25hbWVdKTsKICAgICAgfQogICAgICBnZW9tZXRyeS5yZW1vdmVFdmVudExpc3RlbmVyKCJkaXNwb3NlIiwgb25HZW9tZXRyeURpc3Bvc2UpOwogICAgICBkZWxldGUgZ2VvbWV0cmllc1tnZW9tZXRyeS5pZF07CiAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IHdpcmVmcmFtZUF0dHJpYnV0ZXMuZ2V0KGdlb21ldHJ5KTsKICAgICAgaWYgKGF0dHJpYnV0ZSkgewogICAgICAgIGF0dHJpYnV0ZXMucmVtb3ZlKGF0dHJpYnV0ZSk7CiAgICAgICAgd2lyZWZyYW1lQXR0cmlidXRlcy5kZWxldGUoZ2VvbWV0cnkpOwogICAgICB9CiAgICAgIGJpbmRpbmdTdGF0ZXMucmVsZWFzZVN0YXRlc09mR2VvbWV0cnkoZ2VvbWV0cnkpOwogICAgICBpZiAoZ2VvbWV0cnkuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSA9PT0gdHJ1ZSkgewogICAgICAgIGRlbGV0ZSBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudDsKICAgICAgfQogICAgICBpbmZvLm1lbW9yeS5nZW9tZXRyaWVzLS07CiAgICB9CiAgICBmdW5jdGlvbiBnZXQob2JqZWN0LCBnZW9tZXRyeSkgewogICAgICBpZiAoZ2VvbWV0cmllc1tnZW9tZXRyeS5pZF0gPT09IHRydWUpCiAgICAgICAgcmV0dXJuIGdlb21ldHJ5OwogICAgICBnZW9tZXRyeS5hZGRFdmVudExpc3RlbmVyKCJkaXNwb3NlIiwgb25HZW9tZXRyeURpc3Bvc2UpOwogICAgICBnZW9tZXRyaWVzW2dlb21ldHJ5LmlkXSA9IHRydWU7CiAgICAgIGluZm8ubWVtb3J5Lmdlb21ldHJpZXMrKzsKICAgICAgcmV0dXJuIGdlb21ldHJ5OwogICAgfQogICAgZnVuY3Rpb24gdXBkYXRlKGdlb21ldHJ5KSB7CiAgICAgIGNvbnN0IGdlb21ldHJ5QXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CiAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBnZW9tZXRyeUF0dHJpYnV0ZXMpIHsKICAgICAgICBhdHRyaWJ1dGVzLnVwZGF0ZShnZW9tZXRyeUF0dHJpYnV0ZXNbbmFtZV0sIDM0OTYyKTsKICAgICAgfQogICAgICBjb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXM7CiAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBtb3JwaEF0dHJpYnV0ZXMpIHsKICAgICAgICBjb25zdCBhcnJheSA9IG1vcnBoQXR0cmlidXRlc1tuYW1lXTsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgYXR0cmlidXRlcy51cGRhdGUoYXJyYXlbaV0sIDM0OTYyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZShnZW9tZXRyeSkgewogICAgICBjb25zdCBpbmRpY2VzID0gW107CiAgICAgIGNvbnN0IGdlb21ldHJ5SW5kZXggPSBnZW9tZXRyeS5pbmRleDsKICAgICAgY29uc3QgZ2VvbWV0cnlQb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAgIGxldCB2ZXJzaW9uID0gMDsKICAgICAgaWYgKGdlb21ldHJ5SW5kZXggIT09IG51bGwpIHsKICAgICAgICBjb25zdCBhcnJheSA9IGdlb21ldHJ5SW5kZXguYXJyYXk7CiAgICAgICAgdmVyc2lvbiA9IGdlb21ldHJ5SW5kZXgudmVyc2lvbjsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKz0gMykgewogICAgICAgICAgY29uc3QgYSA9IGFycmF5W2kgKyAwXTsKICAgICAgICAgIGNvbnN0IGIgPSBhcnJheVtpICsgMV07CiAgICAgICAgICBjb25zdCBjID0gYXJyYXlbaSArIDJdOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGIsIGMsIGMsIGEpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBhcnJheSA9IGdlb21ldHJ5UG9zaXRpb24uYXJyYXk7CiAgICAgICAgdmVyc2lvbiA9IGdlb21ldHJ5UG9zaXRpb24udmVyc2lvbjsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aCAvIDMgLSAxOyBpIDwgbDsgaSArPSAzKSB7CiAgICAgICAgICBjb25zdCBhID0gaSArIDA7CiAgICAgICAgICBjb25zdCBiID0gaSArIDE7CiAgICAgICAgICBjb25zdCBjID0gaSArIDI7CiAgICAgICAgICBpbmRpY2VzLnB1c2goYSwgYiwgYiwgYywgYywgYSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IG5ldyAoYXJyYXlNYXgoaW5kaWNlcykgPiA2NTUzNSA/IFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA6IFVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSkoaW5kaWNlcywgMSk7CiAgICAgIGF0dHJpYnV0ZS52ZXJzaW9uID0gdmVyc2lvbjsKICAgICAgY29uc3QgcHJldmlvdXNBdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldChnZW9tZXRyeSk7CiAgICAgIGlmIChwcmV2aW91c0F0dHJpYnV0ZSkKICAgICAgICBhdHRyaWJ1dGVzLnJlbW92ZShwcmV2aW91c0F0dHJpYnV0ZSk7CiAgICAgIHdpcmVmcmFtZUF0dHJpYnV0ZXMuc2V0KGdlb21ldHJ5LCBhdHRyaWJ1dGUpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0V2lyZWZyYW1lQXR0cmlidXRlKGdlb21ldHJ5KSB7CiAgICAgIGNvbnN0IGN1cnJlbnRBdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldChnZW9tZXRyeSk7CiAgICAgIGlmIChjdXJyZW50QXR0cmlidXRlKSB7CiAgICAgICAgY29uc3QgZ2VvbWV0cnlJbmRleCA9IGdlb21ldHJ5LmluZGV4OwogICAgICAgIGlmIChnZW9tZXRyeUluZGV4ICE9PSBudWxsKSB7CiAgICAgICAgICBpZiAoY3VycmVudEF0dHJpYnV0ZS52ZXJzaW9uIDwgZ2VvbWV0cnlJbmRleC52ZXJzaW9uKSB7CiAgICAgICAgICAgIHVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZShnZW9tZXRyeSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZShnZW9tZXRyeSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHdpcmVmcmFtZUF0dHJpYnV0ZXMuZ2V0KGdlb21ldHJ5KTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGdldCwKICAgICAgdXBkYXRlLAogICAgICBnZXRXaXJlZnJhbWVBdHRyaWJ1dGUKICAgIH07CiAgfQogIGZ1bmN0aW9uIFdlYkdMSW5kZXhlZEJ1ZmZlclJlbmRlcmVyKGdsLCBleHRlbnNpb25zLCBpbmZvLCBjYXBhYmlsaXRpZXMpIHsKICAgIGNvbnN0IGlzV2ViR0wyID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyOwogICAgbGV0IG1vZGU7CiAgICBmdW5jdGlvbiBzZXRNb2RlKHZhbHVlKSB7CiAgICAgIG1vZGUgPSB2YWx1ZTsKICAgIH0KICAgIGxldCB0eXBlLCBieXRlc1BlckVsZW1lbnQ7CiAgICBmdW5jdGlvbiBzZXRJbmRleCh2YWx1ZSkgewogICAgICB0eXBlID0gdmFsdWUudHlwZTsKICAgICAgYnl0ZXNQZXJFbGVtZW50ID0gdmFsdWUuYnl0ZXNQZXJFbGVtZW50OwogICAgfQogICAgZnVuY3Rpb24gcmVuZGVyKHN0YXJ0LCBjb3VudCkgewogICAgICBnbC5kcmF3RWxlbWVudHMobW9kZSwgY291bnQsIHR5cGUsIHN0YXJ0ICogYnl0ZXNQZXJFbGVtZW50KTsKICAgICAgaW5mby51cGRhdGUoY291bnQsIG1vZGUsIDEpOwogICAgfQogICAgZnVuY3Rpb24gcmVuZGVySW5zdGFuY2VzKHN0YXJ0LCBjb3VudCwgcHJpbWNvdW50KSB7CiAgICAgIGlmIChwcmltY291bnQgPT09IDApCiAgICAgICAgcmV0dXJuOwogICAgICBsZXQgZXh0ZW5zaW9uLCBtZXRob2ROYW1lOwogICAgICBpZiAoaXNXZWJHTDIpIHsKICAgICAgICBleHRlbnNpb24gPSBnbDsKICAgICAgICBtZXRob2ROYW1lID0gImRyYXdFbGVtZW50c0luc3RhbmNlZCI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoIkFOR0xFX2luc3RhbmNlZF9hcnJheXMiKTsKICAgICAgICBtZXRob2ROYW1lID0gImRyYXdFbGVtZW50c0luc3RhbmNlZEFOR0xFIjsKICAgICAgICBpZiAoZXh0ZW5zaW9uID09PSBudWxsKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5XZWJHTEluZGV4ZWRCdWZmZXJSZW5kZXJlcjogdXNpbmcgVEhSRUUuSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgYnV0IGhhcmR3YXJlIGRvZXMgbm90IHN1cHBvcnQgZXh0ZW5zaW9uIEFOR0xFX2luc3RhbmNlZF9hcnJheXMuIik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICAgIGV4dGVuc2lvblttZXRob2ROYW1lXShtb2RlLCBjb3VudCwgdHlwZSwgc3RhcnQgKiBieXRlc1BlckVsZW1lbnQsIHByaW1jb3VudCk7CiAgICAgIGluZm8udXBkYXRlKGNvdW50LCBtb2RlLCBwcmltY291bnQpOwogICAgfQogICAgdGhpcy5zZXRNb2RlID0gc2V0TW9kZTsKICAgIHRoaXMuc2V0SW5kZXggPSBzZXRJbmRleDsKICAgIHRoaXMucmVuZGVyID0gcmVuZGVyOwogICAgdGhpcy5yZW5kZXJJbnN0YW5jZXMgPSByZW5kZXJJbnN0YW5jZXM7CiAgfQogIGZ1bmN0aW9uIFdlYkdMSW5mbyhnbCkgewogICAgY29uc3QgbWVtb3J5ID0gewogICAgICBnZW9tZXRyaWVzOiAwLAogICAgICB0ZXh0dXJlczogMAogICAgfTsKICAgIGNvbnN0IHJlbmRlciA9IHsKICAgICAgZnJhbWU6IDAsCiAgICAgIGNhbGxzOiAwLAogICAgICB0cmlhbmdsZXM6IDAsCiAgICAgIHBvaW50czogMCwKICAgICAgbGluZXM6IDAKICAgIH07CiAgICBmdW5jdGlvbiB1cGRhdGUoY291bnQsIG1vZGUsIGluc3RhbmNlQ291bnQpIHsKICAgICAgcmVuZGVyLmNhbGxzKys7CiAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgIGNhc2UgNDoKICAgICAgICAgIHJlbmRlci50cmlhbmdsZXMgKz0gaW5zdGFuY2VDb3VudCAqIChjb3VudCAvIDMpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmVuZGVyLmxpbmVzICs9IGluc3RhbmNlQ291bnQgKiAoY291bnQgLyAyKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHJlbmRlci5saW5lcyArPSBpbnN0YW5jZUNvdW50ICogKGNvdW50IC0gMSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZW5kZXIubGluZXMgKz0gaW5zdGFuY2VDb3VudCAqIGNvdW50OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcmVuZGVyLnBvaW50cyArPSBpbnN0YW5jZUNvdW50ICogY291bnQ7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuV2ViR0xJbmZvOiBVbmtub3duIGRyYXcgbW9kZToiLCBtb2RlKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgcmVuZGVyLmZyYW1lKys7CiAgICAgIHJlbmRlci5jYWxscyA9IDA7CiAgICAgIHJlbmRlci50cmlhbmdsZXMgPSAwOwogICAgICByZW5kZXIucG9pbnRzID0gMDsKICAgICAgcmVuZGVyLmxpbmVzID0gMDsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG1lbW9yeSwKICAgICAgcmVuZGVyLAogICAgICBwcm9ncmFtczogbnVsbCwKICAgICAgYXV0b1Jlc2V0OiB0cnVlLAogICAgICByZXNldCwKICAgICAgdXBkYXRlCiAgICB9OwogIH0KICBmdW5jdGlvbiBudW1lcmljYWxTb3J0KGEsIGIpIHsKICAgIHJldHVybiBhWzBdIC0gYlswXTsKICB9CiAgZnVuY3Rpb24gYWJzTnVtZXJpY2FsU29ydChhLCBiKSB7CiAgICByZXR1cm4gTWF0aC5hYnMoYlsxXSkgLSBNYXRoLmFicyhhWzFdKTsKICB9CiAgZnVuY3Rpb24gV2ViR0xNb3JwaHRhcmdldHMoZ2wpIHsKICAgIGNvbnN0IGluZmx1ZW5jZXNMaXN0ID0ge307CiAgICBjb25zdCBtb3JwaEluZmx1ZW5jZXMgPSBuZXcgRmxvYXQzMkFycmF5KDgpOwogICAgY29uc3Qgd29ya0luZmx1ZW5jZXMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7CiAgICAgIHdvcmtJbmZsdWVuY2VzW2ldID0gW2ksIDBdOwogICAgfQogICAgZnVuY3Rpb24gdXBkYXRlKG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBwcm9ncmFtKSB7CiAgICAgIGNvbnN0IG9iamVjdEluZmx1ZW5jZXMgPSBvYmplY3QubW9ycGhUYXJnZXRJbmZsdWVuY2VzOwogICAgICBjb25zdCBsZW5ndGgyID0gb2JqZWN0SW5mbHVlbmNlcyA9PT0gdm9pZCAwID8gMCA6IG9iamVjdEluZmx1ZW5jZXMubGVuZ3RoOwogICAgICBsZXQgaW5mbHVlbmNlcyA9IGluZmx1ZW5jZXNMaXN0W2dlb21ldHJ5LmlkXTsKICAgICAgaWYgKGluZmx1ZW5jZXMgPT09IHZvaWQgMCB8fCBpbmZsdWVuY2VzLmxlbmd0aCAhPT0gbGVuZ3RoMikgewogICAgICAgIGluZmx1ZW5jZXMgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDI7IGkrKykgewogICAgICAgICAgaW5mbHVlbmNlc1tpXSA9IFtpLCAwXTsKICAgICAgICB9CiAgICAgICAgaW5mbHVlbmNlc0xpc3RbZ2VvbWV0cnkuaWRdID0gaW5mbHVlbmNlczsKICAgICAgfQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDI7IGkrKykgewogICAgICAgIGNvbnN0IGluZmx1ZW5jZSA9IGluZmx1ZW5jZXNbaV07CiAgICAgICAgaW5mbHVlbmNlWzBdID0gaTsKICAgICAgICBpbmZsdWVuY2VbMV0gPSBvYmplY3RJbmZsdWVuY2VzW2ldOwogICAgICB9CiAgICAgIGluZmx1ZW5jZXMuc29ydChhYnNOdW1lcmljYWxTb3J0KTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHsKICAgICAgICBpZiAoaSA8IGxlbmd0aDIgJiYgaW5mbHVlbmNlc1tpXVsxXSkgewogICAgICAgICAgd29ya0luZmx1ZW5jZXNbaV1bMF0gPSBpbmZsdWVuY2VzW2ldWzBdOwogICAgICAgICAgd29ya0luZmx1ZW5jZXNbaV1bMV0gPSBpbmZsdWVuY2VzW2ldWzFdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3b3JrSW5mbHVlbmNlc1tpXVswXSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwogICAgICAgICAgd29ya0luZmx1ZW5jZXNbaV1bMV0gPSAwOwogICAgICAgIH0KICAgICAgfQogICAgICB3b3JrSW5mbHVlbmNlcy5zb3J0KG51bWVyaWNhbFNvcnQpOwogICAgICBjb25zdCBtb3JwaFRhcmdldHMgPSBtYXRlcmlhbC5tb3JwaFRhcmdldHMgJiYgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uOwogICAgICBjb25zdCBtb3JwaE5vcm1hbHMgPSBtYXRlcmlhbC5tb3JwaE5vcm1hbHMgJiYgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbDsKICAgICAgbGV0IG1vcnBoSW5mbHVlbmNlc1N1bSA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7CiAgICAgICAgY29uc3QgaW5mbHVlbmNlID0gd29ya0luZmx1ZW5jZXNbaV07CiAgICAgICAgY29uc3QgaW5kZXggPSBpbmZsdWVuY2VbMF07CiAgICAgICAgY29uc3QgdmFsdWUgPSBpbmZsdWVuY2VbMV07CiAgICAgICAgaWYgKGluZGV4ICE9PSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiAmJiB2YWx1ZSkgewogICAgICAgICAgaWYgKG1vcnBoVGFyZ2V0cyAmJiBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoIm1vcnBoVGFyZ2V0IiArIGkpICE9PSBtb3JwaFRhcmdldHNbaW5kZXhdKSB7CiAgICAgICAgICAgIGdlb21ldHJ5LnNldEF0dHJpYnV0ZSgibW9ycGhUYXJnZXQiICsgaSwgbW9ycGhUYXJnZXRzW2luZGV4XSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobW9ycGhOb3JtYWxzICYmIGdlb21ldHJ5LmdldEF0dHJpYnV0ZSgibW9ycGhOb3JtYWwiICsgaSkgIT09IG1vcnBoTm9ybWFsc1tpbmRleF0pIHsKICAgICAgICAgICAgZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCJtb3JwaE5vcm1hbCIgKyBpLCBtb3JwaE5vcm1hbHNbaW5kZXhdKTsKICAgICAgICAgIH0KICAgICAgICAgIG1vcnBoSW5mbHVlbmNlc1tpXSA9IHZhbHVlOwogICAgICAgICAgbW9ycGhJbmZsdWVuY2VzU3VtICs9IHZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAobW9ycGhUYXJnZXRzICYmIGdlb21ldHJ5Lmhhc0F0dHJpYnV0ZSgibW9ycGhUYXJnZXQiICsgaSkgPT09IHRydWUpIHsKICAgICAgICAgICAgZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCJtb3JwaFRhcmdldCIgKyBpKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChtb3JwaE5vcm1hbHMgJiYgZ2VvbWV0cnkuaGFzQXR0cmlidXRlKCJtb3JwaE5vcm1hbCIgKyBpKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBnZW9tZXRyeS5kZWxldGVBdHRyaWJ1dGUoIm1vcnBoTm9ybWFsIiArIGkpOwogICAgICAgICAgfQogICAgICAgICAgbW9ycGhJbmZsdWVuY2VzW2ldID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgbW9ycGhCYXNlSW5mbHVlbmNlID0gZ2VvbWV0cnkubW9ycGhUYXJnZXRzUmVsYXRpdmUgPyAxIDogMSAtIG1vcnBoSW5mbHVlbmNlc1N1bTsKICAgICAgcHJvZ3JhbS5nZXRVbmlmb3JtcygpLnNldFZhbHVlKGdsLCAibW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlIiwgbW9ycGhCYXNlSW5mbHVlbmNlKTsKICAgICAgcHJvZ3JhbS5nZXRVbmlmb3JtcygpLnNldFZhbHVlKGdsLCAibW9ycGhUYXJnZXRJbmZsdWVuY2VzIiwgbW9ycGhJbmZsdWVuY2VzKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIHVwZGF0ZQogICAgfTsKICB9CiAgZnVuY3Rpb24gV2ViR0xPYmplY3RzKGdsLCBnZW9tZXRyaWVzLCBhdHRyaWJ1dGVzLCBpbmZvKSB7CiAgICBsZXQgdXBkYXRlTWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICBmdW5jdGlvbiB1cGRhdGUob2JqZWN0KSB7CiAgICAgIGNvbnN0IGZyYW1lID0gaW5mby5yZW5kZXIuZnJhbWU7CiAgICAgIGNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwogICAgICBjb25zdCBidWZmZXJnZW9tZXRyeSA9IGdlb21ldHJpZXMuZ2V0KG9iamVjdCwgZ2VvbWV0cnkpOwogICAgICBpZiAodXBkYXRlTWFwLmdldChidWZmZXJnZW9tZXRyeSkgIT09IGZyYW1lKSB7CiAgICAgICAgZ2VvbWV0cmllcy51cGRhdGUoYnVmZmVyZ2VvbWV0cnkpOwogICAgICAgIHVwZGF0ZU1hcC5zZXQoYnVmZmVyZ2VvbWV0cnksIGZyYW1lKTsKICAgICAgfQogICAgICBpZiAob2JqZWN0LmlzSW5zdGFuY2VkTWVzaCkgewogICAgICAgIGlmIChvYmplY3QuaGFzRXZlbnRMaXN0ZW5lcigiZGlzcG9zZSIsIG9uSW5zdGFuY2VkTWVzaERpc3Bvc2UpID09PSBmYWxzZSkgewogICAgICAgICAgb2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoImRpc3Bvc2UiLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlKTsKICAgICAgICB9CiAgICAgICAgYXR0cmlidXRlcy51cGRhdGUob2JqZWN0Lmluc3RhbmNlTWF0cml4LCAzNDk2Mik7CiAgICAgICAgaWYgKG9iamVjdC5pbnN0YW5jZUNvbG9yICE9PSBudWxsKSB7CiAgICAgICAgICBhdHRyaWJ1dGVzLnVwZGF0ZShvYmplY3QuaW5zdGFuY2VDb2xvciwgMzQ5NjIpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gYnVmZmVyZ2VvbWV0cnk7CiAgICB9CiAgICBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICB1cGRhdGVNYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtNYXAoKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9uSW5zdGFuY2VkTWVzaERpc3Bvc2UoZXZlbnQpIHsKICAgICAgY29uc3QgaW5zdGFuY2VkTWVzaCA9IGV2ZW50LnRhcmdldDsKICAgICAgaW5zdGFuY2VkTWVzaC5yZW1vdmVFdmVudExpc3RlbmVyKCJkaXNwb3NlIiwgb25JbnN0YW5jZWRNZXNoRGlzcG9zZSk7CiAgICAgIGF0dHJpYnV0ZXMucmVtb3ZlKGluc3RhbmNlZE1lc2guaW5zdGFuY2VNYXRyaXgpOwogICAgICBpZiAoaW5zdGFuY2VkTWVzaC5pbnN0YW5jZUNvbG9yICE9PSBudWxsKQogICAgICAgIGF0dHJpYnV0ZXMucmVtb3ZlKGluc3RhbmNlZE1lc2guaW5zdGFuY2VDb2xvcik7CiAgICB9CiAgICByZXR1cm4gewogICAgICB1cGRhdGUsCiAgICAgIGRpc3Bvc2UKICAgIH07CiAgfQogIHZhciBEYXRhVGV4dHVyZTJEQXJyYXkgPSBjbGFzcyBleHRlbmRzIFRleHR1cmUgewogICAgY29uc3RydWN0b3IoZGF0YSA9IG51bGwsIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgZGVwdGggPSAxKSB7CiAgICAgIHN1cGVyKG51bGwpOwogICAgICB0aGlzLmltYWdlID0geyBkYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCB9OwogICAgICB0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CiAgICAgIHRoaXMubWluRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKICAgICAgdGhpcy53cmFwUiA9IENsYW1wVG9FZGdlV3JhcHBpbmc7CiAgICAgIHRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CiAgICAgIHRoaXMuZmxpcFkgPSBmYWxzZTsKICAgICAgdGhpcy51bnBhY2tBbGlnbm1lbnQgPSAxOwogICAgICB0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIH0KICB9OwogIERhdGFUZXh0dXJlMkRBcnJheS5wcm90b3R5cGUuaXNEYXRhVGV4dHVyZTJEQXJyYXkgPSB0cnVlOwogIHZhciBEYXRhVGV4dHVyZTNEID0gY2xhc3MgZXh0ZW5kcyBUZXh0dXJlIHsKICAgIGNvbnN0cnVjdG9yKGRhdGEgPSBudWxsLCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSkgewogICAgICBzdXBlcihudWxsKTsKICAgICAgdGhpcy5pbWFnZSA9IHsgZGF0YSwgd2lkdGgsIGhlaWdodCwgZGVwdGggfTsKICAgICAgdGhpcy5tYWdGaWx0ZXIgPSBOZWFyZXN0RmlsdGVyOwogICAgICB0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CiAgICAgIHRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwogICAgICB0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwogICAgICB0aGlzLmZsaXBZID0gZmFsc2U7CiAgICAgIHRoaXMudW5wYWNrQWxpZ25tZW50ID0gMTsKICAgICAgdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICB9CiAgfTsKICBEYXRhVGV4dHVyZTNELnByb3RvdHlwZS5pc0RhdGFUZXh0dXJlM0QgPSB0cnVlOwogIHZhciBlbXB0eVRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwogIHZhciBlbXB0eVRleHR1cmUyZEFycmF5ID0gbmV3IERhdGFUZXh0dXJlMkRBcnJheSgpOwogIHZhciBlbXB0eVRleHR1cmUzZCA9IG5ldyBEYXRhVGV4dHVyZTNEKCk7CiAgdmFyIGVtcHR5Q3ViZVRleHR1cmUgPSBuZXcgQ3ViZVRleHR1cmUoKTsKICB2YXIgYXJyYXlDYWNoZUYzMiA9IFtdOwogIHZhciBhcnJheUNhY2hlSTMyID0gW107CiAgdmFyIG1hdDRhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogIHZhciBtYXQzYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KDkpOwogIHZhciBtYXQyYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KDQpOwogIGZ1bmN0aW9uIGZsYXR0ZW4oYXJyYXksIG5CbG9ja3MsIGJsb2NrU2l6ZSkgewogICAgY29uc3QgZmlyc3RFbGVtID0gYXJyYXlbMF07CiAgICBpZiAoZmlyc3RFbGVtIDw9IDAgfHwgZmlyc3RFbGVtID4gMCkKICAgICAgcmV0dXJuIGFycmF5OwogICAgY29uc3QgbiA9IG5CbG9ja3MgKiBibG9ja1NpemU7CiAgICBsZXQgciA9IGFycmF5Q2FjaGVGMzJbbl07CiAgICBpZiAociA9PT0gdm9pZCAwKSB7CiAgICAgIHIgPSBuZXcgRmxvYXQzMkFycmF5KG4pOwogICAgICBhcnJheUNhY2hlRjMyW25dID0gcjsKICAgIH0KICAgIGlmIChuQmxvY2tzICE9PSAwKSB7CiAgICAgIGZpcnN0RWxlbS50b0FycmF5KHIsIDApOwogICAgICBmb3IgKGxldCBpID0gMSwgb2Zmc2V0ID0gMDsgaSAhPT0gbkJsb2NrczsgKytpKSB7CiAgICAgICAgb2Zmc2V0ICs9IGJsb2NrU2l6ZTsKICAgICAgICBhcnJheVtpXS50b0FycmF5KHIsIG9mZnNldCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByOwogIH0KICBmdW5jdGlvbiBhcnJheXNFcXVhbChhLCBiKSB7CiAgICBpZiAoYS5sZW5ndGggIT09IGIubGVuZ3RoKQogICAgICByZXR1cm4gZmFsc2U7CiAgICBmb3IgKGxldCBpID0gMCwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIGlmIChhW2ldICE9PSBiW2ldKQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBmdW5jdGlvbiBjb3B5QXJyYXkoYSwgYikgewogICAgZm9yIChsZXQgaSA9IDAsIGwgPSBiLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBhW2ldID0gYltpXTsKICAgIH0KICB9CiAgZnVuY3Rpb24gYWxsb2NUZXhVbml0cyh0ZXh0dXJlcywgbikgewogICAgbGV0IHIgPSBhcnJheUNhY2hlSTMyW25dOwogICAgaWYgKHIgPT09IHZvaWQgMCkgewogICAgICByID0gbmV3IEludDMyQXJyYXkobik7CiAgICAgIGFycmF5Q2FjaGVJMzJbbl0gPSByOwogICAgfQogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47ICsraSkgewogICAgICByW2ldID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwogICAgfQogICAgcmV0dXJuIHI7CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVjFmKGdsLCB2KSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBpZiAoY2FjaGVbMF0gPT09IHYpCiAgICAgIHJldHVybjsKICAgIGdsLnVuaWZvcm0xZih0aGlzLmFkZHIsIHYpOwogICAgY2FjaGVbMF0gPSB2OwogIH0KICBmdW5jdGlvbiBzZXRWYWx1ZVYyZihnbCwgdikgewogICAgY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwogICAgaWYgKHYueCAhPT0gdm9pZCAwKSB7CiAgICAgIGlmIChjYWNoZVswXSAhPT0gdi54IHx8IGNhY2hlWzFdICE9PSB2LnkpIHsKICAgICAgICBnbC51bmlmb3JtMmYodGhpcy5hZGRyLCB2LngsIHYueSk7CiAgICAgICAgY2FjaGVbMF0gPSB2Lng7CiAgICAgICAgY2FjaGVbMV0gPSB2Lnk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChhcnJheXNFcXVhbChjYWNoZSwgdikpCiAgICAgICAgcmV0dXJuOwogICAgICBnbC51bmlmb3JtMmZ2KHRoaXMuYWRkciwgdik7CiAgICAgIGNvcHlBcnJheShjYWNoZSwgdik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVjNmKGdsLCB2KSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBpZiAodi54ICE9PSB2b2lkIDApIHsKICAgICAgaWYgKGNhY2hlWzBdICE9PSB2LnggfHwgY2FjaGVbMV0gIT09IHYueSB8fCBjYWNoZVsyXSAhPT0gdi56KSB7CiAgICAgICAgZ2wudW5pZm9ybTNmKHRoaXMuYWRkciwgdi54LCB2LnksIHYueik7CiAgICAgICAgY2FjaGVbMF0gPSB2Lng7CiAgICAgICAgY2FjaGVbMV0gPSB2Lnk7CiAgICAgICAgY2FjaGVbMl0gPSB2Lno7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodi5yICE9PSB2b2lkIDApIHsKICAgICAgaWYgKGNhY2hlWzBdICE9PSB2LnIgfHwgY2FjaGVbMV0gIT09IHYuZyB8fCBjYWNoZVsyXSAhPT0gdi5iKSB7CiAgICAgICAgZ2wudW5pZm9ybTNmKHRoaXMuYWRkciwgdi5yLCB2LmcsIHYuYik7CiAgICAgICAgY2FjaGVbMF0gPSB2LnI7CiAgICAgICAgY2FjaGVbMV0gPSB2Lmc7CiAgICAgICAgY2FjaGVbMl0gPSB2LmI7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChhcnJheXNFcXVhbChjYWNoZSwgdikpCiAgICAgICAgcmV0dXJuOwogICAgICBnbC51bmlmb3JtM2Z2KHRoaXMuYWRkciwgdik7CiAgICAgIGNvcHlBcnJheShjYWNoZSwgdik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVjRmKGdsLCB2KSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBpZiAodi54ICE9PSB2b2lkIDApIHsKICAgICAgaWYgKGNhY2hlWzBdICE9PSB2LnggfHwgY2FjaGVbMV0gIT09IHYueSB8fCBjYWNoZVsyXSAhPT0gdi56IHx8IGNhY2hlWzNdICE9PSB2LncpIHsKICAgICAgICBnbC51bmlmb3JtNGYodGhpcy5hZGRyLCB2LngsIHYueSwgdi56LCB2LncpOwogICAgICAgIGNhY2hlWzBdID0gdi54OwogICAgICAgIGNhY2hlWzFdID0gdi55OwogICAgICAgIGNhY2hlWzJdID0gdi56OwogICAgICAgIGNhY2hlWzNdID0gdi53OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoYXJyYXlzRXF1YWwoY2FjaGUsIHYpKQogICAgICAgIHJldHVybjsKICAgICAgZ2wudW5pZm9ybTRmdih0aGlzLmFkZHIsIHYpOwogICAgICBjb3B5QXJyYXkoY2FjaGUsIHYpOwogICAgfQogIH0KICBmdW5jdGlvbiBzZXRWYWx1ZU0yKGdsLCB2KSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBjb25zdCBlbGVtZW50cyA9IHYuZWxlbWVudHM7CiAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICBpZiAoYXJyYXlzRXF1YWwoY2FjaGUsIHYpKQogICAgICAgIHJldHVybjsKICAgICAgZ2wudW5pZm9ybU1hdHJpeDJmdih0aGlzLmFkZHIsIGZhbHNlLCB2KTsKICAgICAgY29weUFycmF5KGNhY2hlLCB2KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChhcnJheXNFcXVhbChjYWNoZSwgZWxlbWVudHMpKQogICAgICAgIHJldHVybjsKICAgICAgbWF0MmFycmF5LnNldChlbGVtZW50cyk7CiAgICAgIGdsLnVuaWZvcm1NYXRyaXgyZnYodGhpcy5hZGRyLCBmYWxzZSwgbWF0MmFycmF5KTsKICAgICAgY29weUFycmF5KGNhY2hlLCBlbGVtZW50cyk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlTTMoZ2wsIHYpIHsKICAgIGNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKICAgIGNvbnN0IGVsZW1lbnRzID0gdi5lbGVtZW50czsKICAgIGlmIChlbGVtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgIGlmIChhcnJheXNFcXVhbChjYWNoZSwgdikpCiAgICAgICAgcmV0dXJuOwogICAgICBnbC51bmlmb3JtTWF0cml4M2Z2KHRoaXMuYWRkciwgZmFsc2UsIHYpOwogICAgICBjb3B5QXJyYXkoY2FjaGUsIHYpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGFycmF5c0VxdWFsKGNhY2hlLCBlbGVtZW50cykpCiAgICAgICAgcmV0dXJuOwogICAgICBtYXQzYXJyYXkuc2V0KGVsZW1lbnRzKTsKICAgICAgZ2wudW5pZm9ybU1hdHJpeDNmdih0aGlzLmFkZHIsIGZhbHNlLCBtYXQzYXJyYXkpOwogICAgICBjb3B5QXJyYXkoY2FjaGUsIGVsZW1lbnRzKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVNNChnbCwgdikgewogICAgY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwogICAgY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwogICAgaWYgKGVsZW1lbnRzID09PSB2b2lkIDApIHsKICAgICAgaWYgKGFycmF5c0VxdWFsKGNhY2hlLCB2KSkKICAgICAgICByZXR1cm47CiAgICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodGhpcy5hZGRyLCBmYWxzZSwgdik7CiAgICAgIGNvcHlBcnJheShjYWNoZSwgdik7CiAgICB9IGVsc2UgewogICAgICBpZiAoYXJyYXlzRXF1YWwoY2FjaGUsIGVsZW1lbnRzKSkKICAgICAgICByZXR1cm47CiAgICAgIG1hdDRhcnJheS5zZXQoZWxlbWVudHMpOwogICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMuYWRkciwgZmFsc2UsIG1hdDRhcnJheSk7CiAgICAgIGNvcHlBcnJheShjYWNoZSwgZWxlbWVudHMpOwogICAgfQogIH0KICBmdW5jdGlvbiBzZXRWYWx1ZVYxaShnbCwgdikgewogICAgY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwogICAgaWYgKGNhY2hlWzBdID09PSB2KQogICAgICByZXR1cm47CiAgICBnbC51bmlmb3JtMWkodGhpcy5hZGRyLCB2KTsKICAgIGNhY2hlWzBdID0gdjsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWMmkoZ2wsIHYpIHsKICAgIGNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKICAgIGlmIChhcnJheXNFcXVhbChjYWNoZSwgdikpCiAgICAgIHJldHVybjsKICAgIGdsLnVuaWZvcm0yaXYodGhpcy5hZGRyLCB2KTsKICAgIGNvcHlBcnJheShjYWNoZSwgdik7CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVjNpKGdsLCB2KSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBpZiAoYXJyYXlzRXF1YWwoY2FjaGUsIHYpKQogICAgICByZXR1cm47CiAgICBnbC51bmlmb3JtM2l2KHRoaXMuYWRkciwgdik7CiAgICBjb3B5QXJyYXkoY2FjaGUsIHYpOwogIH0KICBmdW5jdGlvbiBzZXRWYWx1ZVY0aShnbCwgdikgewogICAgY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwogICAgaWYgKGFycmF5c0VxdWFsKGNhY2hlLCB2KSkKICAgICAgcmV0dXJuOwogICAgZ2wudW5pZm9ybTRpdih0aGlzLmFkZHIsIHYpOwogICAgY29weUFycmF5KGNhY2hlLCB2KTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWMXVpKGdsLCB2KSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBpZiAoY2FjaGVbMF0gPT09IHYpCiAgICAgIHJldHVybjsKICAgIGdsLnVuaWZvcm0xdWkodGhpcy5hZGRyLCB2KTsKICAgIGNhY2hlWzBdID0gdjsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWMnVpKGdsLCB2KSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBpZiAoYXJyYXlzRXF1YWwoY2FjaGUsIHYpKQogICAgICByZXR1cm47CiAgICBnbC51bmlmb3JtMnVpdih0aGlzLmFkZHIsIHYpOwogICAgY29weUFycmF5KGNhY2hlLCB2KTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWM3VpKGdsLCB2KSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBpZiAoYXJyYXlzRXF1YWwoY2FjaGUsIHYpKQogICAgICByZXR1cm47CiAgICBnbC51bmlmb3JtM3Vpdih0aGlzLmFkZHIsIHYpOwogICAgY29weUFycmF5KGNhY2hlLCB2KTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWNHVpKGdsLCB2KSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBpZiAoYXJyYXlzRXF1YWwoY2FjaGUsIHYpKQogICAgICByZXR1cm47CiAgICBnbC51bmlmb3JtNHVpdih0aGlzLmFkZHIsIHYpOwogICAgY29weUFycmF5KGNhY2hlLCB2KTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVUMShnbCwgdiwgdGV4dHVyZXMpIHsKICAgIGNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKICAgIGNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CiAgICBpZiAoY2FjaGVbMF0gIT09IHVuaXQpIHsKICAgICAgZ2wudW5pZm9ybTFpKHRoaXMuYWRkciwgdW5pdCk7CiAgICAgIGNhY2hlWzBdID0gdW5pdDsKICAgIH0KICAgIHRleHR1cmVzLnNhZmVTZXRUZXh0dXJlMkQodiB8fCBlbXB0eVRleHR1cmUsIHVuaXQpOwogIH0KICBmdW5jdGlvbiBzZXRWYWx1ZVQzRDEoZ2wsIHYsIHRleHR1cmVzKSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBjb25zdCB1bml0ID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwogICAgaWYgKGNhY2hlWzBdICE9PSB1bml0KSB7CiAgICAgIGdsLnVuaWZvcm0xaSh0aGlzLmFkZHIsIHVuaXQpOwogICAgICBjYWNoZVswXSA9IHVuaXQ7CiAgICB9CiAgICB0ZXh0dXJlcy5zZXRUZXh0dXJlM0QodiB8fCBlbXB0eVRleHR1cmUzZCwgdW5pdCk7CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVDYoZ2wsIHYsIHRleHR1cmVzKSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBjb25zdCB1bml0ID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwogICAgaWYgKGNhY2hlWzBdICE9PSB1bml0KSB7CiAgICAgIGdsLnVuaWZvcm0xaSh0aGlzLmFkZHIsIHVuaXQpOwogICAgICBjYWNoZVswXSA9IHVuaXQ7CiAgICB9CiAgICB0ZXh0dXJlcy5zYWZlU2V0VGV4dHVyZUN1YmUodiB8fCBlbXB0eUN1YmVUZXh0dXJlLCB1bml0KTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVUMkRBcnJheTEoZ2wsIHYsIHRleHR1cmVzKSB7CiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICBjb25zdCB1bml0ID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwogICAgaWYgKGNhY2hlWzBdICE9PSB1bml0KSB7CiAgICAgIGdsLnVuaWZvcm0xaSh0aGlzLmFkZHIsIHVuaXQpOwogICAgICBjYWNoZVswXSA9IHVuaXQ7CiAgICB9CiAgICB0ZXh0dXJlcy5zZXRUZXh0dXJlMkRBcnJheSh2IHx8IGVtcHR5VGV4dHVyZTJkQXJyYXksIHVuaXQpOwogIH0KICBmdW5jdGlvbiBnZXRTaW5ndWxhclNldHRlcih0eXBlKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSA1MTI2OgogICAgICAgIHJldHVybiBzZXRWYWx1ZVYxZjsKICAgICAgY2FzZSAzNTY2NDoKICAgICAgICByZXR1cm4gc2V0VmFsdWVWMmY7CiAgICAgIGNhc2UgMzU2NjU6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVjNmOwogICAgICBjYXNlIDM1NjY2OgogICAgICAgIHJldHVybiBzZXRWYWx1ZVY0ZjsKICAgICAgY2FzZSAzNTY3NDoKICAgICAgICByZXR1cm4gc2V0VmFsdWVNMjsKICAgICAgY2FzZSAzNTY3NToKICAgICAgICByZXR1cm4gc2V0VmFsdWVNMzsKICAgICAgY2FzZSAzNTY3NjoKICAgICAgICByZXR1cm4gc2V0VmFsdWVNNDsKICAgICAgY2FzZSA1MTI0OgogICAgICBjYXNlIDM1NjcwOgogICAgICAgIHJldHVybiBzZXRWYWx1ZVYxaTsKICAgICAgY2FzZSAzNTY2NzoKICAgICAgY2FzZSAzNTY3MToKICAgICAgICByZXR1cm4gc2V0VmFsdWVWMmk7CiAgICAgIGNhc2UgMzU2Njg6CiAgICAgIGNhc2UgMzU2NzI6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVjNpOwogICAgICBjYXNlIDM1NjY5OgogICAgICBjYXNlIDM1NjczOgogICAgICAgIHJldHVybiBzZXRWYWx1ZVY0aTsKICAgICAgY2FzZSA1MTI1OgogICAgICAgIHJldHVybiBzZXRWYWx1ZVYxdWk7CiAgICAgIGNhc2UgMzYyOTQ6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVjJ1aTsKICAgICAgY2FzZSAzNjI5NToKICAgICAgICByZXR1cm4gc2V0VmFsdWVWM3VpOwogICAgICBjYXNlIDM2Mjk2OgogICAgICAgIHJldHVybiBzZXRWYWx1ZVY0dWk7CiAgICAgIGNhc2UgMzU2Nzg6CiAgICAgIGNhc2UgMzYxOTg6CiAgICAgIGNhc2UgMzYyOTg6CiAgICAgIGNhc2UgMzYzMDY6CiAgICAgIGNhc2UgMzU2ODI6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVDE7CiAgICAgIGNhc2UgMzU2Nzk6CiAgICAgIGNhc2UgMzYyOTk6CiAgICAgIGNhc2UgMzYzMDc6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVDNEMTsKICAgICAgY2FzZSAzNTY4MDoKICAgICAgY2FzZSAzNjMwMDoKICAgICAgY2FzZSAzNjMwODoKICAgICAgY2FzZSAzNjI5MzoKICAgICAgICByZXR1cm4gc2V0VmFsdWVUNjsKICAgICAgY2FzZSAzNjI4OToKICAgICAgY2FzZSAzNjMwMzoKICAgICAgY2FzZSAzNjMxMToKICAgICAgY2FzZSAzNjI5MjoKICAgICAgICByZXR1cm4gc2V0VmFsdWVUMkRBcnJheTE7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVjFmQXJyYXkoZ2wsIHYpIHsKICAgIGdsLnVuaWZvcm0xZnYodGhpcy5hZGRyLCB2KTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWMmZBcnJheShnbCwgdikgewogICAgY29uc3QgZGF0YSA9IGZsYXR0ZW4odiwgdGhpcy5zaXplLCAyKTsKICAgIGdsLnVuaWZvcm0yZnYodGhpcy5hZGRyLCBkYXRhKTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWM2ZBcnJheShnbCwgdikgewogICAgY29uc3QgZGF0YSA9IGZsYXR0ZW4odiwgdGhpcy5zaXplLCAzKTsKICAgIGdsLnVuaWZvcm0zZnYodGhpcy5hZGRyLCBkYXRhKTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWNGZBcnJheShnbCwgdikgewogICAgY29uc3QgZGF0YSA9IGZsYXR0ZW4odiwgdGhpcy5zaXplLCA0KTsKICAgIGdsLnVuaWZvcm00ZnYodGhpcy5hZGRyLCBkYXRhKTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVNMkFycmF5KGdsLCB2KSB7CiAgICBjb25zdCBkYXRhID0gZmxhdHRlbih2LCB0aGlzLnNpemUsIDQpOwogICAgZ2wudW5pZm9ybU1hdHJpeDJmdih0aGlzLmFkZHIsIGZhbHNlLCBkYXRhKTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVNM0FycmF5KGdsLCB2KSB7CiAgICBjb25zdCBkYXRhID0gZmxhdHRlbih2LCB0aGlzLnNpemUsIDkpOwogICAgZ2wudW5pZm9ybU1hdHJpeDNmdih0aGlzLmFkZHIsIGZhbHNlLCBkYXRhKTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVNNEFycmF5KGdsLCB2KSB7CiAgICBjb25zdCBkYXRhID0gZmxhdHRlbih2LCB0aGlzLnNpemUsIDE2KTsKICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodGhpcy5hZGRyLCBmYWxzZSwgZGF0YSk7CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVjFpQXJyYXkoZ2wsIHYpIHsKICAgIGdsLnVuaWZvcm0xaXYodGhpcy5hZGRyLCB2KTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWMmlBcnJheShnbCwgdikgewogICAgZ2wudW5pZm9ybTJpdih0aGlzLmFkZHIsIHYpOwogIH0KICBmdW5jdGlvbiBzZXRWYWx1ZVYzaUFycmF5KGdsLCB2KSB7CiAgICBnbC51bmlmb3JtM2l2KHRoaXMuYWRkciwgdik7CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVjRpQXJyYXkoZ2wsIHYpIHsKICAgIGdsLnVuaWZvcm00aXYodGhpcy5hZGRyLCB2KTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWMXVpQXJyYXkoZ2wsIHYpIHsKICAgIGdsLnVuaWZvcm0xdWl2KHRoaXMuYWRkciwgdik7CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVjJ1aUFycmF5KGdsLCB2KSB7CiAgICBnbC51bmlmb3JtMnVpdih0aGlzLmFkZHIsIHYpOwogIH0KICBmdW5jdGlvbiBzZXRWYWx1ZVYzdWlBcnJheShnbCwgdikgewogICAgZ2wudW5pZm9ybTN1aXYodGhpcy5hZGRyLCB2KTsKICB9CiAgZnVuY3Rpb24gc2V0VmFsdWVWNHVpQXJyYXkoZ2wsIHYpIHsKICAgIGdsLnVuaWZvcm00dWl2KHRoaXMuYWRkciwgdik7CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVDFBcnJheShnbCwgdiwgdGV4dHVyZXMpIHsKICAgIGNvbnN0IG4gPSB2Lmxlbmd0aDsKICAgIGNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyh0ZXh0dXJlcywgbik7CiAgICBnbC51bmlmb3JtMWl2KHRoaXMuYWRkciwgdW5pdHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47ICsraSkgewogICAgICB0ZXh0dXJlcy5zYWZlU2V0VGV4dHVyZTJEKHZbaV0gfHwgZW1wdHlUZXh0dXJlLCB1bml0c1tpXSk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHNldFZhbHVlVDZBcnJheShnbCwgdiwgdGV4dHVyZXMpIHsKICAgIGNvbnN0IG4gPSB2Lmxlbmd0aDsKICAgIGNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyh0ZXh0dXJlcywgbik7CiAgICBnbC51bmlmb3JtMWl2KHRoaXMuYWRkciwgdW5pdHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47ICsraSkgewogICAgICB0ZXh0dXJlcy5zYWZlU2V0VGV4dHVyZUN1YmUodltpXSB8fCBlbXB0eUN1YmVUZXh0dXJlLCB1bml0c1tpXSk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGdldFB1cmVBcnJheVNldHRlcih0eXBlKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSA1MTI2OgogICAgICAgIHJldHVybiBzZXRWYWx1ZVYxZkFycmF5OwogICAgICBjYXNlIDM1NjY0OgogICAgICAgIHJldHVybiBzZXRWYWx1ZVYyZkFycmF5OwogICAgICBjYXNlIDM1NjY1OgogICAgICAgIHJldHVybiBzZXRWYWx1ZVYzZkFycmF5OwogICAgICBjYXNlIDM1NjY2OgogICAgICAgIHJldHVybiBzZXRWYWx1ZVY0ZkFycmF5OwogICAgICBjYXNlIDM1Njc0OgogICAgICAgIHJldHVybiBzZXRWYWx1ZU0yQXJyYXk7CiAgICAgIGNhc2UgMzU2NzU6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlTTNBcnJheTsKICAgICAgY2FzZSAzNTY3NjoKICAgICAgICByZXR1cm4gc2V0VmFsdWVNNEFycmF5OwogICAgICBjYXNlIDUxMjQ6CiAgICAgIGNhc2UgMzU2NzA6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVjFpQXJyYXk7CiAgICAgIGNhc2UgMzU2Njc6CiAgICAgIGNhc2UgMzU2NzE6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVjJpQXJyYXk7CiAgICAgIGNhc2UgMzU2Njg6CiAgICAgIGNhc2UgMzU2NzI6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVjNpQXJyYXk7CiAgICAgIGNhc2UgMzU2Njk6CiAgICAgIGNhc2UgMzU2NzM6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVjRpQXJyYXk7CiAgICAgIGNhc2UgNTEyNToKICAgICAgICByZXR1cm4gc2V0VmFsdWVWMXVpQXJyYXk7CiAgICAgIGNhc2UgMzYyOTQ6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVjJ1aUFycmF5OwogICAgICBjYXNlIDM2Mjk1OgogICAgICAgIHJldHVybiBzZXRWYWx1ZVYzdWlBcnJheTsKICAgICAgY2FzZSAzNjI5NjoKICAgICAgICByZXR1cm4gc2V0VmFsdWVWNHVpQXJyYXk7CiAgICAgIGNhc2UgMzU2Nzg6CiAgICAgIGNhc2UgMzYxOTg6CiAgICAgIGNhc2UgMzYyOTg6CiAgICAgIGNhc2UgMzYzMDY6CiAgICAgIGNhc2UgMzU2ODI6CiAgICAgICAgcmV0dXJuIHNldFZhbHVlVDFBcnJheTsKICAgICAgY2FzZSAzNTY4MDoKICAgICAgY2FzZSAzNjMwMDoKICAgICAgY2FzZSAzNjMwODoKICAgICAgY2FzZSAzNjI5MzoKICAgICAgICByZXR1cm4gc2V0VmFsdWVUNkFycmF5OwogICAgfQogIH0KICBmdW5jdGlvbiBTaW5nbGVVbmlmb3JtKGlkLCBhY3RpdmVJbmZvLCBhZGRyKSB7CiAgICB0aGlzLmlkID0gaWQ7CiAgICB0aGlzLmFkZHIgPSBhZGRyOwogICAgdGhpcy5jYWNoZSA9IFtdOwogICAgdGhpcy5zZXRWYWx1ZSA9IGdldFNpbmd1bGFyU2V0dGVyKGFjdGl2ZUluZm8udHlwZSk7CiAgfQogIGZ1bmN0aW9uIFB1cmVBcnJheVVuaWZvcm0oaWQsIGFjdGl2ZUluZm8sIGFkZHIpIHsKICAgIHRoaXMuaWQgPSBpZDsKICAgIHRoaXMuYWRkciA9IGFkZHI7CiAgICB0aGlzLmNhY2hlID0gW107CiAgICB0aGlzLnNpemUgPSBhY3RpdmVJbmZvLnNpemU7CiAgICB0aGlzLnNldFZhbHVlID0gZ2V0UHVyZUFycmF5U2V0dGVyKGFjdGl2ZUluZm8udHlwZSk7CiAgfQogIFB1cmVBcnJheVVuaWZvcm0ucHJvdG90eXBlLnVwZGF0ZUNhY2hlID0gZnVuY3Rpb24oZGF0YSkgewogICAgY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwogICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkgJiYgY2FjaGUubGVuZ3RoICE9PSBkYXRhLmxlbmd0aCkgewogICAgICB0aGlzLmNhY2hlID0gbmV3IEZsb2F0MzJBcnJheShkYXRhLmxlbmd0aCk7CiAgICB9CiAgICBjb3B5QXJyYXkoY2FjaGUsIGRhdGEpOwogIH07CiAgZnVuY3Rpb24gU3RydWN0dXJlZFVuaWZvcm0oaWQpIHsKICAgIHRoaXMuaWQgPSBpZDsKICAgIHRoaXMuc2VxID0gW107CiAgICB0aGlzLm1hcCA9IHt9OwogIH0KICBTdHJ1Y3R1cmVkVW5pZm9ybS5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbihnbCwgdmFsdWUsIHRleHR1cmVzKSB7CiAgICBjb25zdCBzZXEgPSB0aGlzLnNlcTsKICAgIGZvciAobGV0IGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKytpKSB7CiAgICAgIGNvbnN0IHUgPSBzZXFbaV07CiAgICAgIHUuc2V0VmFsdWUoZ2wsIHZhbHVlW3UuaWRdLCB0ZXh0dXJlcyk7CiAgICB9CiAgfTsKICB2YXIgUmVQYXRoUGFydCA9IC8oXHcrKShcXSk/KFxbfFwuKT8vZzsKICBmdW5jdGlvbiBhZGRVbmlmb3JtKGNvbnRhaW5lciwgdW5pZm9ybU9iamVjdCkgewogICAgY29udGFpbmVyLnNlcS5wdXNoKHVuaWZvcm1PYmplY3QpOwogICAgY29udGFpbmVyLm1hcFt1bmlmb3JtT2JqZWN0LmlkXSA9IHVuaWZvcm1PYmplY3Q7CiAgfQogIGZ1bmN0aW9uIHBhcnNlVW5pZm9ybShhY3RpdmVJbmZvLCBhZGRyLCBjb250YWluZXIpIHsKICAgIGNvbnN0IHBhdGggPSBhY3RpdmVJbmZvLm5hbWUsIHBhdGhMZW5ndGggPSBwYXRoLmxlbmd0aDsKICAgIFJlUGF0aFBhcnQubGFzdEluZGV4ID0gMDsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IG1hdGNoID0gUmVQYXRoUGFydC5leGVjKHBhdGgpLCBtYXRjaEVuZCA9IFJlUGF0aFBhcnQubGFzdEluZGV4OwogICAgICBsZXQgaWQgPSBtYXRjaFsxXTsKICAgICAgY29uc3QgaWRJc0luZGV4ID0gbWF0Y2hbMl0gPT09ICJdIiwgc3Vic2NyaXB0ID0gbWF0Y2hbM107CiAgICAgIGlmIChpZElzSW5kZXgpCiAgICAgICAgaWQgPSBpZCB8IDA7CiAgICAgIGlmIChzdWJzY3JpcHQgPT09IHZvaWQgMCB8fCBzdWJzY3JpcHQgPT09ICJbIiAmJiBtYXRjaEVuZCArIDIgPT09IHBhdGhMZW5ndGgpIHsKICAgICAgICBhZGRVbmlmb3JtKGNvbnRhaW5lciwgc3Vic2NyaXB0ID09PSB2b2lkIDAgPyBuZXcgU2luZ2xlVW5pZm9ybShpZCwgYWN0aXZlSW5mbywgYWRkcikgOiBuZXcgUHVyZUFycmF5VW5pZm9ybShpZCwgYWN0aXZlSW5mbywgYWRkcikpOwogICAgICAgIGJyZWFrOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IG1hcCA9IGNvbnRhaW5lci5tYXA7CiAgICAgICAgbGV0IG5leHQgPSBtYXBbaWRdOwogICAgICAgIGlmIChuZXh0ID09PSB2b2lkIDApIHsKICAgICAgICAgIG5leHQgPSBuZXcgU3RydWN0dXJlZFVuaWZvcm0oaWQpOwogICAgICAgICAgYWRkVW5pZm9ybShjb250YWluZXIsIG5leHQpOwogICAgICAgIH0KICAgICAgICBjb250YWluZXIgPSBuZXh0OwogICAgICB9CiAgICB9CiAgfQogIGZ1bmN0aW9uIFdlYkdMVW5pZm9ybXMoZ2wsIHByb2dyYW0pIHsKICAgIHRoaXMuc2VxID0gW107CiAgICB0aGlzLm1hcCA9IHt9OwogICAgY29uc3QgbiA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgMzU3MTgpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgY29uc3QgaW5mbyA9IGdsLmdldEFjdGl2ZVVuaWZvcm0ocHJvZ3JhbSwgaSksIGFkZHIgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgaW5mby5uYW1lKTsKICAgICAgcGFyc2VVbmlmb3JtKGluZm8sIGFkZHIsIHRoaXMpOwogICAgfQogIH0KICBXZWJHTFVuaWZvcm1zLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uKGdsLCBuYW1lLCB2YWx1ZSwgdGV4dHVyZXMpIHsKICAgIGNvbnN0IHUgPSB0aGlzLm1hcFtuYW1lXTsKICAgIGlmICh1ICE9PSB2b2lkIDApCiAgICAgIHUuc2V0VmFsdWUoZ2wsIHZhbHVlLCB0ZXh0dXJlcyk7CiAgfTsKICBXZWJHTFVuaWZvcm1zLnByb3RvdHlwZS5zZXRPcHRpb25hbCA9IGZ1bmN0aW9uKGdsLCBvYmplY3QsIG5hbWUpIHsKICAgIGNvbnN0IHYgPSBvYmplY3RbbmFtZV07CiAgICBpZiAodiAhPT0gdm9pZCAwKQogICAgICB0aGlzLnNldFZhbHVlKGdsLCBuYW1lLCB2KTsKICB9OwogIFdlYkdMVW5pZm9ybXMudXBsb2FkID0gZnVuY3Rpb24oZ2wsIHNlcSwgdmFsdWVzLCB0ZXh0dXJlcykgewogICAgZm9yIChsZXQgaSA9IDAsIG4gPSBzZXEubGVuZ3RoOyBpICE9PSBuOyArK2kpIHsKICAgICAgY29uc3QgdSA9IHNlcVtpXSwgdiA9IHZhbHVlc1t1LmlkXTsKICAgICAgaWYgKHYubmVlZHNVcGRhdGUgIT09IGZhbHNlKSB7CiAgICAgICAgdS5zZXRWYWx1ZShnbCwgdi52YWx1ZSwgdGV4dHVyZXMpOwogICAgICB9CiAgICB9CiAgfTsKICBXZWJHTFVuaWZvcm1zLnNlcVdpdGhWYWx1ZSA9IGZ1bmN0aW9uKHNlcSwgdmFsdWVzKSB7CiAgICBjb25zdCByID0gW107CiAgICBmb3IgKGxldCBpID0gMCwgbiA9IHNlcS5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICBjb25zdCB1ID0gc2VxW2ldOwogICAgICBpZiAodS5pZCBpbiB2YWx1ZXMpCiAgICAgICAgci5wdXNoKHUpOwogICAgfQogICAgcmV0dXJuIHI7CiAgfTsKICBmdW5jdGlvbiBXZWJHTFNoYWRlcihnbCwgdHlwZSwgc3RyaW5nKSB7CiAgICBjb25zdCBzaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIodHlwZSk7CiAgICBnbC5zaGFkZXJTb3VyY2Uoc2hhZGVyLCBzdHJpbmcpOwogICAgZ2wuY29tcGlsZVNoYWRlcihzaGFkZXIpOwogICAgcmV0dXJuIHNoYWRlcjsKICB9CiAgdmFyIHByb2dyYW1JZENvdW50ID0gMDsKICBmdW5jdGlvbiBhZGRMaW5lTnVtYmVycyhzdHJpbmcpIHsKICAgIGNvbnN0IGxpbmVzID0gc3RyaW5nLnNwbGl0KCJcbiIpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykgewogICAgICBsaW5lc1tpXSA9IGkgKyAxICsgIjogIiArIGxpbmVzW2ldOwogICAgfQogICAgcmV0dXJuIGxpbmVzLmpvaW4oIlxuIik7CiAgfQogIGZ1bmN0aW9uIGdldEVuY29kaW5nQ29tcG9uZW50cyhlbmNvZGluZykgewogICAgc3dpdGNoIChlbmNvZGluZykgewogICAgICBjYXNlIExpbmVhckVuY29kaW5nOgogICAgICAgIHJldHVybiBbIkxpbmVhciIsICIoIHZhbHVlICkiXTsKICAgICAgY2FzZSBzUkdCRW5jb2Rpbmc6CiAgICAgICAgcmV0dXJuIFsic1JHQiIsICIoIHZhbHVlICkiXTsKICAgICAgY2FzZSBSR0JFRW5jb2Rpbmc6CiAgICAgICAgcmV0dXJuIFsiUkdCRSIsICIoIHZhbHVlICkiXTsKICAgICAgY2FzZSBSR0JNN0VuY29kaW5nOgogICAgICAgIHJldHVybiBbIlJHQk0iLCAiKCB2YWx1ZSwgNy4wICkiXTsKICAgICAgY2FzZSBSR0JNMTZFbmNvZGluZzoKICAgICAgICByZXR1cm4gWyJSR0JNIiwgIiggdmFsdWUsIDE2LjAgKSJdOwogICAgICBjYXNlIFJHQkRFbmNvZGluZzoKICAgICAgICByZXR1cm4gWyJSR0JEIiwgIiggdmFsdWUsIDI1Ni4wICkiXTsKICAgICAgY2FzZSBHYW1tYUVuY29kaW5nOgogICAgICAgIHJldHVybiBbIkdhbW1hIiwgIiggdmFsdWUsIGZsb2F0KCBHQU1NQV9GQUNUT1IgKSApIl07CiAgICAgIGNhc2UgTG9nTHV2RW5jb2Rpbmc6CiAgICAgICAgcmV0dXJuIFsiTG9nTHV2IiwgIiggdmFsdWUgKSJdOwogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xQcm9ncmFtOiBVbnN1cHBvcnRlZCBlbmNvZGluZzoiLCBlbmNvZGluZyk7CiAgICAgICAgcmV0dXJuIFsiTGluZWFyIiwgIiggdmFsdWUgKSJdOwogICAgfQogIH0KICBmdW5jdGlvbiBnZXRTaGFkZXJFcnJvcnMoZ2wsIHNoYWRlciwgdHlwZSkgewogICAgY29uc3Qgc3RhdHVzID0gZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKHNoYWRlciwgMzU3MTMpOwogICAgY29uc3QgbG9nID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyhzaGFkZXIpLnRyaW0oKTsKICAgIGlmIChzdGF0dXMgJiYgbG9nID09PSAiIikKICAgICAgcmV0dXJuICIiOwogICAgY29uc3Qgc291cmNlID0gZ2wuZ2V0U2hhZGVyU291cmNlKHNoYWRlcik7CiAgICByZXR1cm4gIlRIUkVFLldlYkdMU2hhZGVyOiBnbC5nZXRTaGFkZXJJbmZvTG9nKCkgIiArIHR5cGUgKyAiXG4iICsgbG9nICsgYWRkTGluZU51bWJlcnMoc291cmNlKTsKICB9CiAgZnVuY3Rpb24gZ2V0VGV4ZWxEZWNvZGluZ0Z1bmN0aW9uKGZ1bmN0aW9uTmFtZSwgZW5jb2RpbmcpIHsKICAgIGNvbnN0IGNvbXBvbmVudHMgPSBnZXRFbmNvZGluZ0NvbXBvbmVudHMoZW5jb2RpbmcpOwogICAgcmV0dXJuICJ2ZWM0ICIgKyBmdW5jdGlvbk5hbWUgKyAiKCB2ZWM0IHZhbHVlICkgeyByZXR1cm4gIiArIGNvbXBvbmVudHNbMF0gKyAiVG9MaW5lYXIiICsgY29tcG9uZW50c1sxXSArICI7IH0iOwogIH0KICBmdW5jdGlvbiBnZXRUZXhlbEVuY29kaW5nRnVuY3Rpb24oZnVuY3Rpb25OYW1lLCBlbmNvZGluZykgewogICAgY29uc3QgY29tcG9uZW50cyA9IGdldEVuY29kaW5nQ29tcG9uZW50cyhlbmNvZGluZyk7CiAgICByZXR1cm4gInZlYzQgIiArIGZ1bmN0aW9uTmFtZSArICIoIHZlYzQgdmFsdWUgKSB7IHJldHVybiBMaW5lYXJUbyIgKyBjb21wb25lbnRzWzBdICsgY29tcG9uZW50c1sxXSArICI7IH0iOwogIH0KICBmdW5jdGlvbiBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKGZ1bmN0aW9uTmFtZSwgdG9uZU1hcHBpbmcpIHsKICAgIGxldCB0b25lTWFwcGluZ05hbWU7CiAgICBzd2l0Y2ggKHRvbmVNYXBwaW5nKSB7CiAgICAgIGNhc2UgTGluZWFyVG9uZU1hcHBpbmc6CiAgICAgICAgdG9uZU1hcHBpbmdOYW1lID0gIkxpbmVhciI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgUmVpbmhhcmRUb25lTWFwcGluZzoKICAgICAgICB0b25lTWFwcGluZ05hbWUgPSAiUmVpbmhhcmQiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIENpbmVvblRvbmVNYXBwaW5nOgogICAgICAgIHRvbmVNYXBwaW5nTmFtZSA9ICJPcHRpbWl6ZWRDaW5lb24iOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIEFDRVNGaWxtaWNUb25lTWFwcGluZzoKICAgICAgICB0b25lTWFwcGluZ05hbWUgPSAiQUNFU0ZpbG1pYyI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgQ3VzdG9tVG9uZU1hcHBpbmc6CiAgICAgICAgdG9uZU1hcHBpbmdOYW1lID0gIkN1c3RvbSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFByb2dyYW06IFVuc3VwcG9ydGVkIHRvbmVNYXBwaW5nOiIsIHRvbmVNYXBwaW5nKTsKICAgICAgICB0b25lTWFwcGluZ05hbWUgPSAiTGluZWFyIjsKICAgIH0KICAgIHJldHVybiAidmVjMyAiICsgZnVuY3Rpb25OYW1lICsgIiggdmVjMyBjb2xvciApIHsgcmV0dXJuICIgKyB0b25lTWFwcGluZ05hbWUgKyAiVG9uZU1hcHBpbmcoIGNvbG9yICk7IH0iOwogIH0KICBmdW5jdGlvbiBnZW5lcmF0ZUV4dGVuc2lvbnMocGFyYW1ldGVycykgewogICAgY29uc3QgY2h1bmtzID0gWwogICAgICBwYXJhbWV0ZXJzLmV4dGVuc2lvbkRlcml2YXRpdmVzIHx8IHBhcmFtZXRlcnMuZW52TWFwQ3ViZVVWIHx8IHBhcmFtZXRlcnMuYnVtcE1hcCB8fCBwYXJhbWV0ZXJzLnRhbmdlbnRTcGFjZU5vcm1hbE1hcCB8fCBwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcCB8fCBwYXJhbWV0ZXJzLmZsYXRTaGFkaW5nIHx8IHBhcmFtZXRlcnMuc2hhZGVySUQgPT09ICJwaHlzaWNhbCIgPyAiI2V4dGVuc2lvbiBHTF9PRVNfc3RhbmRhcmRfZGVyaXZhdGl2ZXMgOiBlbmFibGUiIDogIiIsCiAgICAgIChwYXJhbWV0ZXJzLmV4dGVuc2lvbkZyYWdEZXB0aCB8fCBwYXJhbWV0ZXJzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIpICYmIHBhcmFtZXRlcnMucmVuZGVyZXJFeHRlbnNpb25GcmFnRGVwdGggPyAiI2V4dGVuc2lvbiBHTF9FWFRfZnJhZ19kZXB0aCA6IGVuYWJsZSIgOiAiIiwKICAgICAgcGFyYW1ldGVycy5leHRlbnNpb25EcmF3QnVmZmVycyAmJiBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uRHJhd0J1ZmZlcnMgPyAiI2V4dGVuc2lvbiBHTF9FWFRfZHJhd19idWZmZXJzIDogcmVxdWlyZSIgOiAiIiwKICAgICAgKHBhcmFtZXRlcnMuZXh0ZW5zaW9uU2hhZGVyVGV4dHVyZUxPRCB8fCBwYXJhbWV0ZXJzLmVudk1hcCB8fCBwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiA+IDApICYmIHBhcmFtZXRlcnMucmVuZGVyZXJFeHRlbnNpb25TaGFkZXJUZXh0dXJlTG9kID8gIiNleHRlbnNpb24gR0xfRVhUX3NoYWRlcl90ZXh0dXJlX2xvZCA6IGVuYWJsZSIgOiAiIgogICAgXTsKICAgIHJldHVybiBjaHVua3MuZmlsdGVyKGZpbHRlckVtcHR5TGluZSkuam9pbigiXG4iKTsKICB9CiAgZnVuY3Rpb24gZ2VuZXJhdGVEZWZpbmVzKGRlZmluZXMpIHsKICAgIGNvbnN0IGNodW5rcyA9IFtdOwogICAgZm9yIChjb25zdCBuYW1lIGluIGRlZmluZXMpIHsKICAgICAgY29uc3QgdmFsdWUgPSBkZWZpbmVzW25hbWVdOwogICAgICBpZiAodmFsdWUgPT09IGZhbHNlKQogICAgICAgIGNvbnRpbnVlOwogICAgICBjaHVua3MucHVzaCgiI2RlZmluZSAiICsgbmFtZSArICIgIiArIHZhbHVlKTsKICAgIH0KICAgIHJldHVybiBjaHVua3Muam9pbigiXG4iKTsKICB9CiAgZnVuY3Rpb24gZmV0Y2hBdHRyaWJ1dGVMb2NhdGlvbnMoZ2wsIHByb2dyYW0pIHsKICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7fTsKICAgIGNvbnN0IG4gPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKHByb2dyYW0sIDM1NzIxKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgIGNvbnN0IGluZm8gPSBnbC5nZXRBY3RpdmVBdHRyaWIocHJvZ3JhbSwgaSk7CiAgICAgIGNvbnN0IG5hbWUgPSBpbmZvLm5hbWU7CiAgICAgIGF0dHJpYnV0ZXNbbmFtZV0gPSBnbC5nZXRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCBuYW1lKTsKICAgIH0KICAgIHJldHVybiBhdHRyaWJ1dGVzOwogIH0KICBmdW5jdGlvbiBmaWx0ZXJFbXB0eUxpbmUoc3RyaW5nKSB7CiAgICByZXR1cm4gc3RyaW5nICE9PSAiIjsKICB9CiAgZnVuY3Rpb24gcmVwbGFjZUxpZ2h0TnVtcyhzdHJpbmcsIHBhcmFtZXRlcnMpIHsKICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvTlVNX0RJUl9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1EaXJMaWdodHMpLnJlcGxhY2UoL05VTV9TUE9UX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodHMpLnJlcGxhY2UoL05VTV9SRUNUX0FSRUFfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtUmVjdEFyZWFMaWdodHMpLnJlcGxhY2UoL05VTV9QT0lOVF9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0cykucmVwbGFjZSgvTlVNX0hFTUlfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtSGVtaUxpZ2h0cykucmVwbGFjZSgvTlVNX0RJUl9MSUdIVF9TSEFET1dTL2csIHBhcmFtZXRlcnMubnVtRGlyTGlnaHRTaGFkb3dzKS5yZXBsYWNlKC9OVU1fU1BPVF9MSUdIVF9TSEFET1dTL2csIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93cykucmVwbGFjZSgvTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MvZywgcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0U2hhZG93cyk7CiAgfQogIGZ1bmN0aW9uIHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyhzdHJpbmcsIHBhcmFtZXRlcnMpIHsKICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvTlVNX0NMSVBQSU5HX1BMQU5FUy9nLCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzKS5yZXBsYWNlKC9VTklPTl9DTElQUElOR19QTEFORVMvZywgcGFyYW1ldGVycy5udW1DbGlwcGluZ1BsYW5lcyAtIHBhcmFtZXRlcnMubnVtQ2xpcEludGVyc2VjdGlvbik7CiAgfQogIHZhciBpbmNsdWRlUGF0dGVybiA9IC9eWyBcdF0qI2luY2x1ZGUgKzwoW1x3XGQuL10rKT4vZ207CiAgZnVuY3Rpb24gcmVzb2x2ZUluY2x1ZGVzKHN0cmluZykgewogICAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKGluY2x1ZGVQYXR0ZXJuLCBpbmNsdWRlUmVwbGFjZXIpOwogIH0KICBmdW5jdGlvbiBpbmNsdWRlUmVwbGFjZXIobWF0Y2gsIGluY2x1ZGUpIHsKICAgIGNvbnN0IHN0cmluZyA9IFNoYWRlckNodW5rW2luY2x1ZGVdOwogICAgaWYgKHN0cmluZyA9PT0gdm9pZCAwKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQ2FuIG5vdCByZXNvbHZlICNpbmNsdWRlIDwiICsgaW5jbHVkZSArICI+Iik7CiAgICB9CiAgICByZXR1cm4gcmVzb2x2ZUluY2x1ZGVzKHN0cmluZyk7CiAgfQogIHZhciBkZXByZWNhdGVkVW5yb2xsTG9vcFBhdHRlcm4gPSAvI3ByYWdtYSB1bnJvbGxfbG9vcFtcc10rP2ZvciBcKCBpbnQgaSBcPSAoXGQrKVw7IGkgPCAoXGQrKVw7IGkgXCtcKyBcKSBceyhbXHNcU10rPykoPz1cfSlcfS9nOwogIHZhciB1bnJvbGxMb29wUGF0dGVybiA9IC8jcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XHMrZm9yXHMqXChccyppbnRccytpXHMqPVxzKihcZCspXHMqO1xzKmlccyo8XHMqKFxkKylccyo7XHMqaVxzKlwrXCtccypcKVxzKnsoW1xzXFNdKz8pfVxzKyNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kL2c7CiAgZnVuY3Rpb24gdW5yb2xsTG9vcHMoc3RyaW5nKSB7CiAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UodW5yb2xsTG9vcFBhdHRlcm4sIGxvb3BSZXBsYWNlcikucmVwbGFjZShkZXByZWNhdGVkVW5yb2xsTG9vcFBhdHRlcm4sIGRlcHJlY2F0ZWRMb29wUmVwbGFjZXIpOwogIH0KICBmdW5jdGlvbiBkZXByZWNhdGVkTG9vcFJlcGxhY2VyKG1hdGNoLCBzdGFydCwgZW5kLCBzbmlwcGV0KSB7CiAgICBjb25zb2xlLndhcm4oIldlYkdMUHJvZ3JhbTogI3ByYWdtYSB1bnJvbGxfbG9vcCBzaGFkZXIgc3ludGF4IGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgI3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydCBzeW50YXggaW5zdGVhZC4iKTsKICAgIHJldHVybiBsb29wUmVwbGFjZXIobWF0Y2gsIHN0YXJ0LCBlbmQsIHNuaXBwZXQpOwogIH0KICBmdW5jdGlvbiBsb29wUmVwbGFjZXIobWF0Y2gsIHN0YXJ0LCBlbmQsIHNuaXBwZXQpIHsKICAgIGxldCBzdHJpbmcgPSAiIjsKICAgIGZvciAobGV0IGkgPSBwYXJzZUludChzdGFydCk7IGkgPCBwYXJzZUludChlbmQpOyBpKyspIHsKICAgICAgc3RyaW5nICs9IHNuaXBwZXQucmVwbGFjZSgvXFtccyppXHMqXF0vZywgIlsgIiArIGkgKyAiIF0iKS5yZXBsYWNlKC9VTlJPTExFRF9MT09QX0lOREVYL2csIGkpOwogICAgfQogICAgcmV0dXJuIHN0cmluZzsKICB9CiAgZnVuY3Rpb24gZ2VuZXJhdGVQcmVjaXNpb24ocGFyYW1ldGVycykgewogICAgbGV0IHByZWNpc2lvbnN0cmluZyA9ICJwcmVjaXNpb24gIiArIHBhcmFtZXRlcnMucHJlY2lzaW9uICsgIiBmbG9hdDtcbnByZWNpc2lvbiAiICsgcGFyYW1ldGVycy5wcmVjaXNpb24gKyAiIGludDsiOwogICAgaWYgKHBhcmFtZXRlcnMucHJlY2lzaW9uID09PSAiaGlnaHAiKSB7CiAgICAgIHByZWNpc2lvbnN0cmluZyArPSAiXG4jZGVmaW5lIEhJR0hfUFJFQ0lTSU9OIjsKICAgIH0gZWxzZSBpZiAocGFyYW1ldGVycy5wcmVjaXNpb24gPT09ICJtZWRpdW1wIikgewogICAgICBwcmVjaXNpb25zdHJpbmcgKz0gIlxuI2RlZmluZSBNRURJVU1fUFJFQ0lTSU9OIjsKICAgIH0gZWxzZSBpZiAocGFyYW1ldGVycy5wcmVjaXNpb24gPT09ICJsb3dwIikgewogICAgICBwcmVjaXNpb25zdHJpbmcgKz0gIlxuI2RlZmluZSBMT1dfUFJFQ0lTSU9OIjsKICAgIH0KICAgIHJldHVybiBwcmVjaXNpb25zdHJpbmc7CiAgfQogIGZ1bmN0aW9uIGdlbmVyYXRlU2hhZG93TWFwVHlwZURlZmluZShwYXJhbWV0ZXJzKSB7CiAgICBsZXQgc2hhZG93TWFwVHlwZURlZmluZSA9ICJTSEFET1dNQVBfVFlQRV9CQVNJQyI7CiAgICBpZiAocGFyYW1ldGVycy5zaGFkb3dNYXBUeXBlID09PSBQQ0ZTaGFkb3dNYXApIHsKICAgICAgc2hhZG93TWFwVHlwZURlZmluZSA9ICJTSEFET1dNQVBfVFlQRV9QQ0YiOwogICAgfSBlbHNlIGlmIChwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgPT09IFBDRlNvZnRTaGFkb3dNYXApIHsKICAgICAgc2hhZG93TWFwVHlwZURlZmluZSA9ICJTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCI7CiAgICB9IGVsc2UgaWYgKHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSA9PT0gVlNNU2hhZG93TWFwKSB7CiAgICAgIHNoYWRvd01hcFR5cGVEZWZpbmUgPSAiU0hBRE9XTUFQX1RZUEVfVlNNIjsKICAgIH0KICAgIHJldHVybiBzaGFkb3dNYXBUeXBlRGVmaW5lOwogIH0KICBmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcFR5cGVEZWZpbmUocGFyYW1ldGVycykgewogICAgbGV0IGVudk1hcFR5cGVEZWZpbmUgPSAiRU5WTUFQX1RZUEVfQ1VCRSI7CiAgICBpZiAocGFyYW1ldGVycy5lbnZNYXApIHsKICAgICAgc3dpdGNoIChwYXJhbWV0ZXJzLmVudk1hcE1vZGUpIHsKICAgICAgICBjYXNlIEN1YmVSZWZsZWN0aW9uTWFwcGluZzoKICAgICAgICBjYXNlIEN1YmVSZWZyYWN0aW9uTWFwcGluZzoKICAgICAgICAgIGVudk1hcFR5cGVEZWZpbmUgPSAiRU5WTUFQX1RZUEVfQ1VCRSI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nOgogICAgICAgIGNhc2UgQ3ViZVVWUmVmcmFjdGlvbk1hcHBpbmc6CiAgICAgICAgICBlbnZNYXBUeXBlRGVmaW5lID0gIkVOVk1BUF9UWVBFX0NVQkVfVVYiOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbnZNYXBUeXBlRGVmaW5lOwogIH0KICBmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcE1vZGVEZWZpbmUocGFyYW1ldGVycykgewogICAgbGV0IGVudk1hcE1vZGVEZWZpbmUgPSAiRU5WTUFQX01PREVfUkVGTEVDVElPTiI7CiAgICBpZiAocGFyYW1ldGVycy5lbnZNYXApIHsKICAgICAgc3dpdGNoIChwYXJhbWV0ZXJzLmVudk1hcE1vZGUpIHsKICAgICAgICBjYXNlIEN1YmVSZWZyYWN0aW9uTWFwcGluZzoKICAgICAgICBjYXNlIEN1YmVVVlJlZnJhY3Rpb25NYXBwaW5nOgogICAgICAgICAgZW52TWFwTW9kZURlZmluZSA9ICJFTlZNQVBfTU9ERV9SRUZSQUNUSU9OIjsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZW52TWFwTW9kZURlZmluZTsKICB9CiAgZnVuY3Rpb24gZ2VuZXJhdGVFbnZNYXBCbGVuZGluZ0RlZmluZShwYXJhbWV0ZXJzKSB7CiAgICBsZXQgZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAiRU5WTUFQX0JMRU5ESU5HX05PTkUiOwogICAgaWYgKHBhcmFtZXRlcnMuZW52TWFwKSB7CiAgICAgIHN3aXRjaCAocGFyYW1ldGVycy5jb21iaW5lKSB7CiAgICAgICAgY2FzZSBNdWx0aXBseU9wZXJhdGlvbjoKICAgICAgICAgIGVudk1hcEJsZW5kaW5nRGVmaW5lID0gIkVOVk1BUF9CTEVORElOR19NVUxUSVBMWSI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIE1peE9wZXJhdGlvbjoKICAgICAgICAgIGVudk1hcEJsZW5kaW5nRGVmaW5lID0gIkVOVk1BUF9CTEVORElOR19NSVgiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBZGRPcGVyYXRpb246CiAgICAgICAgICBlbnZNYXBCbGVuZGluZ0RlZmluZSA9ICJFTlZNQVBfQkxFTkRJTkdfQUREIjsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZW52TWFwQmxlbmRpbmdEZWZpbmU7CiAgfQogIGZ1bmN0aW9uIFdlYkdMUHJvZ3JhbShyZW5kZXJlciwgY2FjaGVLZXksIHBhcmFtZXRlcnMsIGJpbmRpbmdTdGF0ZXMpIHsKICAgIGNvbnN0IGdsID0gcmVuZGVyZXIuZ2V0Q29udGV4dCgpOwogICAgY29uc3QgZGVmaW5lcyA9IHBhcmFtZXRlcnMuZGVmaW5lczsKICAgIGxldCB2ZXJ0ZXhTaGFkZXIgPSBwYXJhbWV0ZXJzLnZlcnRleFNoYWRlcjsKICAgIGxldCBmcmFnbWVudFNoYWRlciA9IHBhcmFtZXRlcnMuZnJhZ21lbnRTaGFkZXI7CiAgICBjb25zdCBzaGFkb3dNYXBUeXBlRGVmaW5lID0gZ2VuZXJhdGVTaGFkb3dNYXBUeXBlRGVmaW5lKHBhcmFtZXRlcnMpOwogICAgY29uc3QgZW52TWFwVHlwZURlZmluZSA9IGdlbmVyYXRlRW52TWFwVHlwZURlZmluZShwYXJhbWV0ZXJzKTsKICAgIGNvbnN0IGVudk1hcE1vZGVEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcE1vZGVEZWZpbmUocGFyYW1ldGVycyk7CiAgICBjb25zdCBlbnZNYXBCbGVuZGluZ0RlZmluZSA9IGdlbmVyYXRlRW52TWFwQmxlbmRpbmdEZWZpbmUocGFyYW1ldGVycyk7CiAgICBjb25zdCBnYW1tYUZhY3RvckRlZmluZSA9IHJlbmRlcmVyLmdhbW1hRmFjdG9yID4gMCA/IHJlbmRlcmVyLmdhbW1hRmFjdG9yIDogMTsKICAgIGNvbnN0IGN1c3RvbUV4dGVuc2lvbnMgPSBwYXJhbWV0ZXJzLmlzV2ViR0wyID8gIiIgOiBnZW5lcmF0ZUV4dGVuc2lvbnMocGFyYW1ldGVycyk7CiAgICBjb25zdCBjdXN0b21EZWZpbmVzID0gZ2VuZXJhdGVEZWZpbmVzKGRlZmluZXMpOwogICAgY29uc3QgcHJvZ3JhbSA9IGdsLmNyZWF0ZVByb2dyYW0oKTsKICAgIGxldCBwcmVmaXhWZXJ0ZXgsIHByZWZpeEZyYWdtZW50OwogICAgbGV0IHZlcnNpb25TdHJpbmcgPSBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID8gIiN2ZXJzaW9uICIgKyBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uICsgIlxuIiA6ICIiOwogICAgaWYgKHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCkgewogICAgICBwcmVmaXhWZXJ0ZXggPSBbCiAgICAgICAgY3VzdG9tRGVmaW5lcwogICAgICBdLmZpbHRlcihmaWx0ZXJFbXB0eUxpbmUpLmpvaW4oIlxuIik7CiAgICAgIGlmIChwcmVmaXhWZXJ0ZXgubGVuZ3RoID4gMCkgewogICAgICAgIHByZWZpeFZlcnRleCArPSAiXG4iOwogICAgICB9CiAgICAgIHByZWZpeEZyYWdtZW50ID0gWwogICAgICAgIGN1c3RvbUV4dGVuc2lvbnMsCiAgICAgICAgY3VzdG9tRGVmaW5lcwogICAgICBdLmZpbHRlcihmaWx0ZXJFbXB0eUxpbmUpLmpvaW4oIlxuIik7CiAgICAgIGlmIChwcmVmaXhGcmFnbWVudC5sZW5ndGggPiAwKSB7CiAgICAgICAgcHJlZml4RnJhZ21lbnQgKz0gIlxuIjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcHJlZml4VmVydGV4ID0gWwogICAgICAgIGdlbmVyYXRlUHJlY2lzaW9uKHBhcmFtZXRlcnMpLAogICAgICAgICIjZGVmaW5lIFNIQURFUl9OQU1FICIgKyBwYXJhbWV0ZXJzLnNoYWRlck5hbWUsCiAgICAgICAgY3VzdG9tRGVmaW5lcywKICAgICAgICBwYXJhbWV0ZXJzLmluc3RhbmNpbmcgPyAiI2RlZmluZSBVU0VfSU5TVEFOQ0lORyIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvciA/ICIjZGVmaW5lIFVTRV9JTlNUQU5DSU5HX0NPTE9SIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuc3VwcG9ydHNWZXJ0ZXhUZXh0dXJlcyA/ICIjZGVmaW5lIFZFUlRFWF9URVhUVVJFUyIgOiAiIiwKICAgICAgICAiI2RlZmluZSBHQU1NQV9GQUNUT1IgIiArIGdhbW1hRmFjdG9yRGVmaW5lLAogICAgICAgICIjZGVmaW5lIE1BWF9CT05FUyAiICsgcGFyYW1ldGVycy5tYXhCb25lcywKICAgICAgICBwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZyA/ICIjZGVmaW5lIFVTRV9GT0ciIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2dFeHAyID8gIiNkZWZpbmUgRk9HX0VYUDIiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5tYXAgPyAiI2RlZmluZSBVU0VfTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZW52TWFwID8gIiNkZWZpbmUgVVNFX0VOVk1BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLmVudk1hcCA/ICIjZGVmaW5lICIgKyBlbnZNYXBNb2RlRGVmaW5lIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5saWdodE1hcCA/ICIjZGVmaW5lIFVTRV9MSUdIVE1BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLmFvTWFwID8gIiNkZWZpbmUgVVNFX0FPTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyAiI2RlZmluZSBVU0VfRU1JU1NJVkVNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5idW1wTWFwID8gIiNkZWZpbmUgVVNFX0JVTVBNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5ub3JtYWxNYXAgPyAiI2RlZmluZSBVU0VfTk9STUFMTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMubm9ybWFsTWFwICYmIHBhcmFtZXRlcnMub2JqZWN0U3BhY2VOb3JtYWxNYXAgPyAiI2RlZmluZSBPQkpFQ1RTUEFDRV9OT1JNQUxNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5ub3JtYWxNYXAgJiYgcGFyYW1ldGVycy50YW5nZW50U3BhY2VOb3JtYWxNYXAgPyAiI2RlZmluZSBUQU5HRU5UU1BBQ0VfTk9STUFMTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwID8gIiNkZWZpbmUgVVNFX0NMRUFSQ09BVE1BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcCA/ICIjZGVmaW5lIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwID8gIiNkZWZpbmUgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5kaXNwbGFjZW1lbnRNYXAgJiYgcGFyYW1ldGVycy5zdXBwb3J0c1ZlcnRleFRleHR1cmVzID8gIiNkZWZpbmUgVVNFX0RJU1BMQUNFTUVOVE1BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwID8gIiNkZWZpbmUgVVNFX1NQRUNVTEFSTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMucm91Z2huZXNzTWFwID8gIiNkZWZpbmUgVVNFX1JPVUdITkVTU01BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcCA/ICIjZGVmaW5lIFVTRV9NRVRBTE5FU1NNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5hbHBoYU1hcCA/ICIjZGVmaW5lIFVTRV9BTFBIQU1BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiA/ICIjZGVmaW5lIFVTRV9UUkFOU01JU1NJT04iIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXAgPyAiI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMudGhpY2tuZXNzTWFwID8gIiNkZWZpbmUgVVNFX1RISUNLTkVTU01BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnZlcnRleFRhbmdlbnRzID8gIiNkZWZpbmUgVVNFX1RBTkdFTlQiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy52ZXJ0ZXhDb2xvcnMgPyAiI2RlZmluZSBVU0VfQ09MT1IiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy52ZXJ0ZXhBbHBoYXMgPyAiI2RlZmluZSBVU0VfQ09MT1JfQUxQSEEiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy52ZXJ0ZXhVdnMgPyAiI2RlZmluZSBVU0VfVVYiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy51dnNWZXJ0ZXhPbmx5ID8gIiNkZWZpbmUgVVZTX1ZFUlRFWF9PTkxZIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAiI2RlZmluZSBGTEFUX1NIQURFRCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnNraW5uaW5nID8gIiNkZWZpbmUgVVNFX1NLSU5OSU5HIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMudXNlVmVydGV4VGV4dHVyZSA/ICIjZGVmaW5lIEJPTkVfVEVYVFVSRSIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0cyA/ICIjZGVmaW5lIFVTRV9NT1JQSFRBUkdFVFMiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5tb3JwaE5vcm1hbHMgJiYgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA9PT0gZmFsc2UgPyAiI2RlZmluZSBVU0VfTU9SUEhOT1JNQUxTIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZG91YmxlU2lkZWQgPyAiI2RlZmluZSBET1VCTEVfU0lERUQiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5mbGlwU2lkZWQgPyAiI2RlZmluZSBGTElQX1NJREVEIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICIjZGVmaW5lIFVTRV9TSEFET1dNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkID8gIiNkZWZpbmUgIiArIHNoYWRvd01hcFR5cGVEZWZpbmUgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnNpemVBdHRlbnVhdGlvbiA/ICIjZGVmaW5lIFVTRV9TSVpFQVRURU5VQVRJT04iIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID8gIiNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciAmJiBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uRnJhZ0RlcHRoID8gIiNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGX0VYVCIgOiAiIiwKICAgICAgICAidW5pZm9ybSBtYXQ0IG1vZGVsTWF0cml4OyIsCiAgICAgICAgInVuaWZvcm0gbWF0NCBtb2RlbFZpZXdNYXRyaXg7IiwKICAgICAgICAidW5pZm9ybSBtYXQ0IHByb2plY3Rpb25NYXRyaXg7IiwKICAgICAgICAidW5pZm9ybSBtYXQ0IHZpZXdNYXRyaXg7IiwKICAgICAgICAidW5pZm9ybSBtYXQzIG5vcm1hbE1hdHJpeDsiLAogICAgICAgICJ1bmlmb3JtIHZlYzMgY2FtZXJhUG9zaXRpb247IiwKICAgICAgICAidW5pZm9ybSBib29sIGlzT3J0aG9ncmFwaGljOyIsCiAgICAgICAgIiNpZmRlZiBVU0VfSU5TVEFOQ0lORyIsCiAgICAgICAgIglhdHRyaWJ1dGUgbWF0NCBpbnN0YW5jZU1hdHJpeDsiLAogICAgICAgICIjZW5kaWYiLAogICAgICAgICIjaWZkZWYgVVNFX0lOU1RBTkNJTkdfQ09MT1IiLAogICAgICAgICIJYXR0cmlidXRlIHZlYzMgaW5zdGFuY2VDb2xvcjsiLAogICAgICAgICIjZW5kaWYiLAogICAgICAgICJhdHRyaWJ1dGUgdmVjMyBwb3NpdGlvbjsiLAogICAgICAgICJhdHRyaWJ1dGUgdmVjMyBub3JtYWw7IiwKICAgICAgICAiYXR0cmlidXRlIHZlYzIgdXY7IiwKICAgICAgICAiI2lmZGVmIFVTRV9UQU5HRU5UIiwKICAgICAgICAiCWF0dHJpYnV0ZSB2ZWM0IHRhbmdlbnQ7IiwKICAgICAgICAiI2VuZGlmIiwKICAgICAgICAiI2lmIGRlZmluZWQoIFVTRV9DT0xPUl9BTFBIQSApIiwKICAgICAgICAiCWF0dHJpYnV0ZSB2ZWM0IGNvbG9yOyIsCiAgICAgICAgIiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApIiwKICAgICAgICAiCWF0dHJpYnV0ZSB2ZWMzIGNvbG9yOyIsCiAgICAgICAgIiNlbmRpZiIsCiAgICAgICAgIiNpZmRlZiBVU0VfTU9SUEhUQVJHRVRTIiwKICAgICAgICAiCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0MDsiLAogICAgICAgICIJYXR0cmlidXRlIHZlYzMgbW9ycGhUYXJnZXQxOyIsCiAgICAgICAgIglhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDI7IiwKICAgICAgICAiCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0MzsiLAogICAgICAgICIJI2lmZGVmIFVTRV9NT1JQSE5PUk1BTFMiLAogICAgICAgICIJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoTm9ybWFsMDsiLAogICAgICAgICIJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoTm9ybWFsMTsiLAogICAgICAgICIJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoTm9ybWFsMjsiLAogICAgICAgICIJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoTm9ybWFsMzsiLAogICAgICAgICIJI2Vsc2UiLAogICAgICAgICIJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0NDsiLAogICAgICAgICIJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0NTsiLAogICAgICAgICIJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0NjsiLAogICAgICAgICIJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0NzsiLAogICAgICAgICIJI2VuZGlmIiwKICAgICAgICAiI2VuZGlmIiwKICAgICAgICAiI2lmZGVmIFVTRV9TS0lOTklORyIsCiAgICAgICAgIglhdHRyaWJ1dGUgdmVjNCBza2luSW5kZXg7IiwKICAgICAgICAiCWF0dHJpYnV0ZSB2ZWM0IHNraW5XZWlnaHQ7IiwKICAgICAgICAiI2VuZGlmIiwKICAgICAgICAiXG4iCiAgICAgIF0uZmlsdGVyKGZpbHRlckVtcHR5TGluZSkuam9pbigiXG4iKTsKICAgICAgcHJlZml4RnJhZ21lbnQgPSBbCiAgICAgICAgY3VzdG9tRXh0ZW5zaW9ucywKICAgICAgICBnZW5lcmF0ZVByZWNpc2lvbihwYXJhbWV0ZXJzKSwKICAgICAgICAiI2RlZmluZSBTSEFERVJfTkFNRSAiICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAogICAgICAgIGN1c3RvbURlZmluZXMsCiAgICAgICAgcGFyYW1ldGVycy5hbHBoYVRlc3QgPyAiI2RlZmluZSBBTFBIQVRFU1QgIiArIHBhcmFtZXRlcnMuYWxwaGFUZXN0ICsgKHBhcmFtZXRlcnMuYWxwaGFUZXN0ICUgMSA/ICIiIDogIi4wIikgOiAiIiwKICAgICAgICAiI2RlZmluZSBHQU1NQV9GQUNUT1IgIiArIGdhbW1hRmFjdG9yRGVmaW5lLAogICAgICAgIHBhcmFtZXRlcnMudXNlRm9nICYmIHBhcmFtZXRlcnMuZm9nID8gIiNkZWZpbmUgVVNFX0ZPRyIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZ0V4cDIgPyAiI2RlZmluZSBGT0dfRVhQMiIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLm1hcCA/ICIjZGVmaW5lIFVTRV9NQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5tYXRjYXAgPyAiI2RlZmluZSBVU0VfTUFUQ0FQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZW52TWFwID8gIiNkZWZpbmUgVVNFX0VOVk1BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLmVudk1hcCA/ICIjZGVmaW5lICIgKyBlbnZNYXBUeXBlRGVmaW5lIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5lbnZNYXAgPyAiI2RlZmluZSAiICsgZW52TWFwTW9kZURlZmluZSA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZW52TWFwID8gIiNkZWZpbmUgIiArIGVudk1hcEJsZW5kaW5nRGVmaW5lIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5saWdodE1hcCA/ICIjZGVmaW5lIFVTRV9MSUdIVE1BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLmFvTWFwID8gIiNkZWZpbmUgVVNFX0FPTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyAiI2RlZmluZSBVU0VfRU1JU1NJVkVNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5idW1wTWFwID8gIiNkZWZpbmUgVVNFX0JVTVBNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5ub3JtYWxNYXAgPyAiI2RlZmluZSBVU0VfTk9STUFMTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMubm9ybWFsTWFwICYmIHBhcmFtZXRlcnMub2JqZWN0U3BhY2VOb3JtYWxNYXAgPyAiI2RlZmluZSBPQkpFQ1RTUEFDRV9OT1JNQUxNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5ub3JtYWxNYXAgJiYgcGFyYW1ldGVycy50YW5nZW50U3BhY2VOb3JtYWxNYXAgPyAiI2RlZmluZSBUQU5HRU5UU1BBQ0VfTk9STUFMTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwID8gIiNkZWZpbmUgVVNFX0NMRUFSQ09BVE1BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcCA/ICIjZGVmaW5lIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwID8gIiNkZWZpbmUgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5zcGVjdWxhck1hcCA/ICIjZGVmaW5lIFVTRV9TUEVDVUxBUk1BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnJvdWdobmVzc01hcCA/ICIjZGVmaW5lIFVTRV9ST1VHSE5FU1NNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5tZXRhbG5lc3NNYXAgPyAiI2RlZmluZSBVU0VfTUVUQUxORVNTTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuYWxwaGFNYXAgPyAiI2RlZmluZSBVU0VfQUxQSEFNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5zaGVlbiA/ICIjZGVmaW5lIFVTRV9TSEVFTiIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiA/ICIjZGVmaW5lIFVTRV9UUkFOU01JU1NJT04iIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXAgPyAiI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OTUFQIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMudGhpY2tuZXNzTWFwID8gIiNkZWZpbmUgVVNFX1RISUNLTkVTU01BUCIgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnZlcnRleFRhbmdlbnRzID8gIiNkZWZpbmUgVVNFX1RBTkdFTlQiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy52ZXJ0ZXhDb2xvcnMgfHwgcGFyYW1ldGVycy5pbnN0YW5jaW5nQ29sb3IgPyAiI2RlZmluZSBVU0VfQ09MT1IiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy52ZXJ0ZXhBbHBoYXMgPyAiI2RlZmluZSBVU0VfQ09MT1JfQUxQSEEiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy52ZXJ0ZXhVdnMgPyAiI2RlZmluZSBVU0VfVVYiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy51dnNWZXJ0ZXhPbmx5ID8gIiNkZWZpbmUgVVZTX1ZFUlRFWF9PTkxZIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZ3JhZGllbnRNYXAgPyAiI2RlZmluZSBVU0VfR1JBRElFTlRNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA/ICIjZGVmaW5lIEZMQVRfU0hBREVEIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZG91YmxlU2lkZWQgPyAiI2RlZmluZSBET1VCTEVfU0lERUQiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5mbGlwU2lkZWQgPyAiI2RlZmluZSBGTElQX1NJREVEIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICIjZGVmaW5lIFVTRV9TSEFET1dNQVAiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkID8gIiNkZWZpbmUgIiArIHNoYWRvd01hcFR5cGVEZWZpbmUgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnByZW11bHRpcGxpZWRBbHBoYSA/ICIjZGVmaW5lIFBSRU1VTFRJUExJRURfQUxQSEEiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5waHlzaWNhbGx5Q29ycmVjdExpZ2h0cyA/ICIjZGVmaW5lIFBIWVNJQ0FMTFlfQ09SUkVDVF9MSUdIVFMiIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID8gIiNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGIiA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciAmJiBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uRnJhZ0RlcHRoID8gIiNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGX0VYVCIgOiAiIiwKICAgICAgICAocGFyYW1ldGVycy5leHRlbnNpb25TaGFkZXJUZXh0dXJlTE9EIHx8IHBhcmFtZXRlcnMuZW52TWFwKSAmJiBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uU2hhZGVyVGV4dHVyZUxvZCA/ICIjZGVmaW5lIFRFWFRVUkVfTE9EX0VYVCIgOiAiIiwKICAgICAgICAidW5pZm9ybSBtYXQ0IHZpZXdNYXRyaXg7IiwKICAgICAgICAidW5pZm9ybSB2ZWMzIGNhbWVyYVBvc2l0aW9uOyIsCiAgICAgICAgInVuaWZvcm0gYm9vbCBpc09ydGhvZ3JhcGhpYzsiLAogICAgICAgIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgIT09IE5vVG9uZU1hcHBpbmcgPyAiI2RlZmluZSBUT05FX01BUFBJTkciIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy50b25lTWFwcGluZyAhPT0gTm9Ub25lTWFwcGluZyA/IFNoYWRlckNodW5rWyJ0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50Il0gOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nID8gZ2V0VG9uZU1hcHBpbmdGdW5jdGlvbigidG9uZU1hcHBpbmciLCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nKSA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZGl0aGVyaW5nID8gIiNkZWZpbmUgRElUSEVSSU5HIiA6ICIiLAogICAgICAgIFNoYWRlckNodW5rWyJlbmNvZGluZ3NfcGFyc19mcmFnbWVudCJdLAogICAgICAgIHBhcmFtZXRlcnMubWFwID8gZ2V0VGV4ZWxEZWNvZGluZ0Z1bmN0aW9uKCJtYXBUZXhlbFRvTGluZWFyIiwgcGFyYW1ldGVycy5tYXBFbmNvZGluZykgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLm1hdGNhcCA/IGdldFRleGVsRGVjb2RpbmdGdW5jdGlvbigibWF0Y2FwVGV4ZWxUb0xpbmVhciIsIHBhcmFtZXRlcnMubWF0Y2FwRW5jb2RpbmcpIDogIiIsCiAgICAgICAgcGFyYW1ldGVycy5lbnZNYXAgPyBnZXRUZXhlbERlY29kaW5nRnVuY3Rpb24oImVudk1hcFRleGVsVG9MaW5lYXIiLCBwYXJhbWV0ZXJzLmVudk1hcEVuY29kaW5nKSA6ICIiLAogICAgICAgIHBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyBnZXRUZXhlbERlY29kaW5nRnVuY3Rpb24oImVtaXNzaXZlTWFwVGV4ZWxUb0xpbmVhciIsIHBhcmFtZXRlcnMuZW1pc3NpdmVNYXBFbmNvZGluZykgOiAiIiwKICAgICAgICBwYXJhbWV0ZXJzLmxpZ2h0TWFwID8gZ2V0VGV4ZWxEZWNvZGluZ0Z1bmN0aW9uKCJsaWdodE1hcFRleGVsVG9MaW5lYXIiLCBwYXJhbWV0ZXJzLmxpZ2h0TWFwRW5jb2RpbmcpIDogIiIsCiAgICAgICAgZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCJsaW5lYXJUb091dHB1dFRleGVsIiwgcGFyYW1ldGVycy5vdXRwdXRFbmNvZGluZyksCiAgICAgICAgcGFyYW1ldGVycy5kZXB0aFBhY2tpbmcgPyAiI2RlZmluZSBERVBUSF9QQUNLSU5HICIgKyBwYXJhbWV0ZXJzLmRlcHRoUGFja2luZyA6ICIiLAogICAgICAgICJcbiIKICAgICAgXS5maWx0ZXIoZmlsdGVyRW1wdHlMaW5lKS5qb2luKCJcbiIpOwogICAgfQogICAgdmVydGV4U2hhZGVyID0gcmVzb2x2ZUluY2x1ZGVzKHZlcnRleFNoYWRlcik7CiAgICB2ZXJ0ZXhTaGFkZXIgPSByZXBsYWNlTGlnaHROdW1zKHZlcnRleFNoYWRlciwgcGFyYW1ldGVycyk7CiAgICB2ZXJ0ZXhTaGFkZXIgPSByZXBsYWNlQ2xpcHBpbmdQbGFuZU51bXModmVydGV4U2hhZGVyLCBwYXJhbWV0ZXJzKTsKICAgIGZyYWdtZW50U2hhZGVyID0gcmVzb2x2ZUluY2x1ZGVzKGZyYWdtZW50U2hhZGVyKTsKICAgIGZyYWdtZW50U2hhZGVyID0gcmVwbGFjZUxpZ2h0TnVtcyhmcmFnbWVudFNoYWRlciwgcGFyYW1ldGVycyk7CiAgICBmcmFnbWVudFNoYWRlciA9IHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyhmcmFnbWVudFNoYWRlciwgcGFyYW1ldGVycyk7CiAgICB2ZXJ0ZXhTaGFkZXIgPSB1bnJvbGxMb29wcyh2ZXJ0ZXhTaGFkZXIpOwogICAgZnJhZ21lbnRTaGFkZXIgPSB1bnJvbGxMb29wcyhmcmFnbWVudFNoYWRlcik7CiAgICBpZiAocGFyYW1ldGVycy5pc1dlYkdMMiAmJiBwYXJhbWV0ZXJzLmlzUmF3U2hhZGVyTWF0ZXJpYWwgIT09IHRydWUpIHsKICAgICAgdmVyc2lvblN0cmluZyA9ICIjdmVyc2lvbiAzMDAgZXNcbiI7CiAgICAgIHByZWZpeFZlcnRleCA9IFsKICAgICAgICAiI2RlZmluZSBhdHRyaWJ1dGUgaW4iLAogICAgICAgICIjZGVmaW5lIHZhcnlpbmcgb3V0IiwKICAgICAgICAiI2RlZmluZSB0ZXh0dXJlMkQgdGV4dHVyZSIKICAgICAgXS5qb2luKCJcbiIpICsgIlxuIiArIHByZWZpeFZlcnRleDsKICAgICAgcHJlZml4RnJhZ21lbnQgPSBbCiAgICAgICAgIiNkZWZpbmUgdmFyeWluZyBpbiIsCiAgICAgICAgcGFyYW1ldGVycy5nbHNsVmVyc2lvbiA9PT0gR0xTTDMgPyAiIiA6ICJvdXQgaGlnaHAgdmVjNCBwY19mcmFnQ29sb3I7IiwKICAgICAgICBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID09PSBHTFNMMyA/ICIiIDogIiNkZWZpbmUgZ2xfRnJhZ0NvbG9yIHBjX2ZyYWdDb2xvciIsCiAgICAgICAgIiNkZWZpbmUgZ2xfRnJhZ0RlcHRoRVhUIGdsX0ZyYWdEZXB0aCIsCiAgICAgICAgIiNkZWZpbmUgdGV4dHVyZTJEIHRleHR1cmUiLAogICAgICAgICIjZGVmaW5lIHRleHR1cmVDdWJlIHRleHR1cmUiLAogICAgICAgICIjZGVmaW5lIHRleHR1cmUyRFByb2ogdGV4dHVyZVByb2oiLAogICAgICAgICIjZGVmaW5lIHRleHR1cmUyRExvZEVYVCB0ZXh0dXJlTG9kIiwKICAgICAgICAiI2RlZmluZSB0ZXh0dXJlMkRQcm9qTG9kRVhUIHRleHR1cmVQcm9qTG9kIiwKICAgICAgICAiI2RlZmluZSB0ZXh0dXJlQ3ViZUxvZEVYVCB0ZXh0dXJlTG9kIiwKICAgICAgICAiI2RlZmluZSB0ZXh0dXJlMkRHcmFkRVhUIHRleHR1cmVHcmFkIiwKICAgICAgICAiI2RlZmluZSB0ZXh0dXJlMkRQcm9qR3JhZEVYVCB0ZXh0dXJlUHJvakdyYWQiLAogICAgICAgICIjZGVmaW5lIHRleHR1cmVDdWJlR3JhZEVYVCB0ZXh0dXJlR3JhZCIKICAgICAgXS5qb2luKCJcbiIpICsgIlxuIiArIHByZWZpeEZyYWdtZW50OwogICAgfQogICAgY29uc3QgdmVydGV4R2xzbCA9IHZlcnNpb25TdHJpbmcgKyBwcmVmaXhWZXJ0ZXggKyB2ZXJ0ZXhTaGFkZXI7CiAgICBjb25zdCBmcmFnbWVudEdsc2wgPSB2ZXJzaW9uU3RyaW5nICsgcHJlZml4RnJhZ21lbnQgKyBmcmFnbWVudFNoYWRlcjsKICAgIGNvbnN0IGdsVmVydGV4U2hhZGVyID0gV2ViR0xTaGFkZXIoZ2wsIDM1NjMzLCB2ZXJ0ZXhHbHNsKTsKICAgIGNvbnN0IGdsRnJhZ21lbnRTaGFkZXIgPSBXZWJHTFNoYWRlcihnbCwgMzU2MzIsIGZyYWdtZW50R2xzbCk7CiAgICBnbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgZ2xWZXJ0ZXhTaGFkZXIpOwogICAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGdsRnJhZ21lbnRTaGFkZXIpOwogICAgaWYgKHBhcmFtZXRlcnMuaW5kZXgwQXR0cmlidXRlTmFtZSAhPT0gdm9pZCAwKSB7CiAgICAgIGdsLmJpbmRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCAwLCBwYXJhbWV0ZXJzLmluZGV4MEF0dHJpYnV0ZU5hbWUpOwogICAgfSBlbHNlIGlmIChwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0cyA9PT0gdHJ1ZSkgewogICAgICBnbC5iaW5kQXR0cmliTG9jYXRpb24ocHJvZ3JhbSwgMCwgInBvc2l0aW9uIik7CiAgICB9CiAgICBnbC5saW5rUHJvZ3JhbShwcm9ncmFtKTsKICAgIGlmIChyZW5kZXJlci5kZWJ1Zy5jaGVja1NoYWRlckVycm9ycykgewogICAgICBjb25zdCBwcm9ncmFtTG9nID0gZ2wuZ2V0UHJvZ3JhbUluZm9Mb2cocHJvZ3JhbSkudHJpbSgpOwogICAgICBjb25zdCB2ZXJ0ZXhMb2cgPSBnbC5nZXRTaGFkZXJJbmZvTG9nKGdsVmVydGV4U2hhZGVyKS50cmltKCk7CiAgICAgIGNvbnN0IGZyYWdtZW50TG9nID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyhnbEZyYWdtZW50U2hhZGVyKS50cmltKCk7CiAgICAgIGxldCBydW5uYWJsZSA9IHRydWU7CiAgICAgIGxldCBoYXZlRGlhZ25vc3RpY3MgPSB0cnVlOwogICAgICBpZiAoZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCAzNTcxNCkgPT09IGZhbHNlKSB7CiAgICAgICAgcnVubmFibGUgPSBmYWxzZTsKICAgICAgICBjb25zdCB2ZXJ0ZXhFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoZ2wsIGdsVmVydGV4U2hhZGVyLCAidmVydGV4Iik7CiAgICAgICAgY29uc3QgZnJhZ21lbnRFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoZ2wsIGdsRnJhZ21lbnRTaGFkZXIsICJmcmFnbWVudCIpOwogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLldlYkdMUHJvZ3JhbTogc2hhZGVyIGVycm9yOiAiLCBnbC5nZXRFcnJvcigpLCAiMzU3MTUiLCBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKHByb2dyYW0sIDM1NzE1KSwgImdsLmdldFByb2dyYW1JbmZvTG9nIiwgcHJvZ3JhbUxvZywgdmVydGV4RXJyb3JzLCBmcmFnbWVudEVycm9ycyk7CiAgICAgIH0gZWxzZSBpZiAocHJvZ3JhbUxvZyAhPT0gIiIpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUHJvZ3JhbTogZ2wuZ2V0UHJvZ3JhbUluZm9Mb2coKSIsIHByb2dyYW1Mb2cpOwogICAgICB9IGVsc2UgaWYgKHZlcnRleExvZyA9PT0gIiIgfHwgZnJhZ21lbnRMb2cgPT09ICIiKSB7CiAgICAgICAgaGF2ZURpYWdub3N0aWNzID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKGhhdmVEaWFnbm9zdGljcykgewogICAgICAgIHRoaXMuZGlhZ25vc3RpY3MgPSB7CiAgICAgICAgICBydW5uYWJsZSwKICAgICAgICAgIHByb2dyYW1Mb2csCiAgICAgICAgICB2ZXJ0ZXhTaGFkZXI6IHsKICAgICAgICAgICAgbG9nOiB2ZXJ0ZXhMb2csCiAgICAgICAgICAgIHByZWZpeDogcHJlZml4VmVydGV4CiAgICAgICAgICB9LAogICAgICAgICAgZnJhZ21lbnRTaGFkZXI6IHsKICAgICAgICAgICAgbG9nOiBmcmFnbWVudExvZywKICAgICAgICAgICAgcHJlZml4OiBwcmVmaXhGcmFnbWVudAogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIGdsLmRlbGV0ZVNoYWRlcihnbFZlcnRleFNoYWRlcik7CiAgICBnbC5kZWxldGVTaGFkZXIoZ2xGcmFnbWVudFNoYWRlcik7CiAgICBsZXQgY2FjaGVkVW5pZm9ybXM7CiAgICB0aGlzLmdldFVuaWZvcm1zID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChjYWNoZWRVbmlmb3JtcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgY2FjaGVkVW5pZm9ybXMgPSBuZXcgV2ViR0xVbmlmb3JtcyhnbCwgcHJvZ3JhbSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNhY2hlZFVuaWZvcm1zOwogICAgfTsKICAgIGxldCBjYWNoZWRBdHRyaWJ1dGVzOwogICAgdGhpcy5nZXRBdHRyaWJ1dGVzID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChjYWNoZWRBdHRyaWJ1dGVzID09PSB2b2lkIDApIHsKICAgICAgICBjYWNoZWRBdHRyaWJ1dGVzID0gZmV0Y2hBdHRyaWJ1dGVMb2NhdGlvbnMoZ2wsIHByb2dyYW0pOwogICAgICB9CiAgICAgIHJldHVybiBjYWNoZWRBdHRyaWJ1dGVzOwogICAgfTsKICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICBiaW5kaW5nU3RhdGVzLnJlbGVhc2VTdGF0ZXNPZlByb2dyYW0odGhpcyk7CiAgICAgIGdsLmRlbGV0ZVByb2dyYW0ocHJvZ3JhbSk7CiAgICAgIHRoaXMucHJvZ3JhbSA9IHZvaWQgMDsKICAgIH07CiAgICB0aGlzLm5hbWUgPSBwYXJhbWV0ZXJzLnNoYWRlck5hbWU7CiAgICB0aGlzLmlkID0gcHJvZ3JhbUlkQ291bnQrKzsKICAgIHRoaXMuY2FjaGVLZXkgPSBjYWNoZUtleTsKICAgIHRoaXMudXNlZFRpbWVzID0gMTsKICAgIHRoaXMucHJvZ3JhbSA9IHByb2dyYW07CiAgICB0aGlzLnZlcnRleFNoYWRlciA9IGdsVmVydGV4U2hhZGVyOwogICAgdGhpcy5mcmFnbWVudFNoYWRlciA9IGdsRnJhZ21lbnRTaGFkZXI7CiAgICByZXR1cm4gdGhpczsKICB9CiAgZnVuY3Rpb24gV2ViR0xQcm9ncmFtcyhyZW5kZXJlciwgY3ViZW1hcHMsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcywgYmluZGluZ1N0YXRlcywgY2xpcHBpbmcpIHsKICAgIGNvbnN0IHByb2dyYW1zID0gW107CiAgICBjb25zdCBpc1dlYkdMMiA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMjsKICAgIGNvbnN0IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPSBjYXBhYmlsaXRpZXMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcjsKICAgIGNvbnN0IGZsb2F0VmVydGV4VGV4dHVyZXMgPSBjYXBhYmlsaXRpZXMuZmxvYXRWZXJ0ZXhUZXh0dXJlczsKICAgIGNvbnN0IG1heFZlcnRleFVuaWZvcm1zID0gY2FwYWJpbGl0aWVzLm1heFZlcnRleFVuaWZvcm1zOwogICAgY29uc3QgdmVydGV4VGV4dHVyZXMgPSBjYXBhYmlsaXRpZXMudmVydGV4VGV4dHVyZXM7CiAgICBsZXQgcHJlY2lzaW9uID0gY2FwYWJpbGl0aWVzLnByZWNpc2lvbjsKICAgIGNvbnN0IHNoYWRlcklEcyA9IHsKICAgICAgTWVzaERlcHRoTWF0ZXJpYWw6ICJkZXB0aCIsCiAgICAgIE1lc2hEaXN0YW5jZU1hdGVyaWFsOiAiZGlzdGFuY2VSR0JBIiwKICAgICAgTWVzaE5vcm1hbE1hdGVyaWFsOiAibm9ybWFsIiwKICAgICAgTWVzaEJhc2ljTWF0ZXJpYWw6ICJiYXNpYyIsCiAgICAgIE1lc2hMYW1iZXJ0TWF0ZXJpYWw6ICJsYW1iZXJ0IiwKICAgICAgTWVzaFBob25nTWF0ZXJpYWw6ICJwaG9uZyIsCiAgICAgIE1lc2hUb29uTWF0ZXJpYWw6ICJ0b29uIiwKICAgICAgTWVzaFN0YW5kYXJkTWF0ZXJpYWw6ICJwaHlzaWNhbCIsCiAgICAgIE1lc2hQaHlzaWNhbE1hdGVyaWFsOiAicGh5c2ljYWwiLAogICAgICBNZXNoTWF0Y2FwTWF0ZXJpYWw6ICJtYXRjYXAiLAogICAgICBMaW5lQmFzaWNNYXRlcmlhbDogImJhc2ljIiwKICAgICAgTGluZURhc2hlZE1hdGVyaWFsOiAiZGFzaGVkIiwKICAgICAgUG9pbnRzTWF0ZXJpYWw6ICJwb2ludHMiLAogICAgICBTaGFkb3dNYXRlcmlhbDogInNoYWRvdyIsCiAgICAgIFNwcml0ZU1hdGVyaWFsOiAic3ByaXRlIgogICAgfTsKICAgIGNvbnN0IHBhcmFtZXRlck5hbWVzID0gWwogICAgICAicHJlY2lzaW9uIiwKICAgICAgImlzV2ViR0wyIiwKICAgICAgInN1cHBvcnRzVmVydGV4VGV4dHVyZXMiLAogICAgICAib3V0cHV0RW5jb2RpbmciLAogICAgICAiaW5zdGFuY2luZyIsCiAgICAgICJpbnN0YW5jaW5nQ29sb3IiLAogICAgICAibWFwIiwKICAgICAgIm1hcEVuY29kaW5nIiwKICAgICAgIm1hdGNhcCIsCiAgICAgICJtYXRjYXBFbmNvZGluZyIsCiAgICAgICJlbnZNYXAiLAogICAgICAiZW52TWFwTW9kZSIsCiAgICAgICJlbnZNYXBFbmNvZGluZyIsCiAgICAgICJlbnZNYXBDdWJlVVYiLAogICAgICAibGlnaHRNYXAiLAogICAgICAibGlnaHRNYXBFbmNvZGluZyIsCiAgICAgICJhb01hcCIsCiAgICAgICJlbWlzc2l2ZU1hcCIsCiAgICAgICJlbWlzc2l2ZU1hcEVuY29kaW5nIiwKICAgICAgImJ1bXBNYXAiLAogICAgICAibm9ybWFsTWFwIiwKICAgICAgIm9iamVjdFNwYWNlTm9ybWFsTWFwIiwKICAgICAgInRhbmdlbnRTcGFjZU5vcm1hbE1hcCIsCiAgICAgICJjbGVhcmNvYXRNYXAiLAogICAgICAiY2xlYXJjb2F0Um91Z2huZXNzTWFwIiwKICAgICAgImNsZWFyY29hdE5vcm1hbE1hcCIsCiAgICAgICJkaXNwbGFjZW1lbnRNYXAiLAogICAgICAic3BlY3VsYXJNYXAiLAogICAgICAicm91Z2huZXNzTWFwIiwKICAgICAgIm1ldGFsbmVzc01hcCIsCiAgICAgICJncmFkaWVudE1hcCIsCiAgICAgICJhbHBoYU1hcCIsCiAgICAgICJjb21iaW5lIiwKICAgICAgInZlcnRleENvbG9ycyIsCiAgICAgICJ2ZXJ0ZXhBbHBoYXMiLAogICAgICAidmVydGV4VGFuZ2VudHMiLAogICAgICAidmVydGV4VXZzIiwKICAgICAgInV2c1ZlcnRleE9ubHkiLAogICAgICAiZm9nIiwKICAgICAgInVzZUZvZyIsCiAgICAgICJmb2dFeHAyIiwKICAgICAgImZsYXRTaGFkaW5nIiwKICAgICAgInNpemVBdHRlbnVhdGlvbiIsCiAgICAgICJsb2dhcml0aG1pY0RlcHRoQnVmZmVyIiwKICAgICAgInNraW5uaW5nIiwKICAgICAgIm1heEJvbmVzIiwKICAgICAgInVzZVZlcnRleFRleHR1cmUiLAogICAgICAibW9ycGhUYXJnZXRzIiwKICAgICAgIm1vcnBoTm9ybWFscyIsCiAgICAgICJwcmVtdWx0aXBsaWVkQWxwaGEiLAogICAgICAibnVtRGlyTGlnaHRzIiwKICAgICAgIm51bVBvaW50TGlnaHRzIiwKICAgICAgIm51bVNwb3RMaWdodHMiLAogICAgICAibnVtSGVtaUxpZ2h0cyIsCiAgICAgICJudW1SZWN0QXJlYUxpZ2h0cyIsCiAgICAgICJudW1EaXJMaWdodFNoYWRvd3MiLAogICAgICAibnVtUG9pbnRMaWdodFNoYWRvd3MiLAogICAgICAibnVtU3BvdExpZ2h0U2hhZG93cyIsCiAgICAgICJzaGFkb3dNYXBFbmFibGVkIiwKICAgICAgInNoYWRvd01hcFR5cGUiLAogICAgICAidG9uZU1hcHBpbmciLAogICAgICAicGh5c2ljYWxseUNvcnJlY3RMaWdodHMiLAogICAgICAiYWxwaGFUZXN0IiwKICAgICAgImRvdWJsZVNpZGVkIiwKICAgICAgImZsaXBTaWRlZCIsCiAgICAgICJudW1DbGlwcGluZ1BsYW5lcyIsCiAgICAgICJudW1DbGlwSW50ZXJzZWN0aW9uIiwKICAgICAgImRlcHRoUGFja2luZyIsCiAgICAgICJkaXRoZXJpbmciLAogICAgICAic2hlZW4iLAogICAgICAidHJhbnNtaXNzaW9uIiwKICAgICAgInRyYW5zbWlzc2lvbk1hcCIsCiAgICAgICJ0aGlja25lc3NNYXAiCiAgICBdOwogICAgZnVuY3Rpb24gZ2V0TWF4Qm9uZXMob2JqZWN0KSB7CiAgICAgIGNvbnN0IHNrZWxldG9uID0gb2JqZWN0LnNrZWxldG9uOwogICAgICBjb25zdCBib25lcyA9IHNrZWxldG9uLmJvbmVzOwogICAgICBpZiAoZmxvYXRWZXJ0ZXhUZXh0dXJlcykgewogICAgICAgIHJldHVybiAxMDI0OwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IG5WZXJ0ZXhVbmlmb3JtcyA9IG1heFZlcnRleFVuaWZvcm1zOwogICAgICAgIGNvbnN0IG5WZXJ0ZXhNYXRyaWNlcyA9IE1hdGguZmxvb3IoKG5WZXJ0ZXhVbmlmb3JtcyAtIDIwKSAvIDQpOwogICAgICAgIGNvbnN0IG1heEJvbmVzID0gTWF0aC5taW4oblZlcnRleE1hdHJpY2VzLCBib25lcy5sZW5ndGgpOwogICAgICAgIGlmIChtYXhCb25lcyA8IGJvbmVzLmxlbmd0aCkgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiBTa2VsZXRvbiBoYXMgIiArIGJvbmVzLmxlbmd0aCArICIgYm9uZXMuIFRoaXMgR1BVIHN1cHBvcnRzICIgKyBtYXhCb25lcyArICIuIik7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1heEJvbmVzOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBnZXRUZXh0dXJlRW5jb2RpbmdGcm9tTWFwKG1hcCkgewogICAgICBsZXQgZW5jb2Rpbmc7CiAgICAgIGlmIChtYXAgJiYgbWFwLmlzVGV4dHVyZSkgewogICAgICAgIGVuY29kaW5nID0gbWFwLmVuY29kaW5nOwogICAgICB9IGVsc2UgaWYgKG1hcCAmJiBtYXAuaXNXZWJHTFJlbmRlclRhcmdldCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xQcm9ncmFtcy5nZXRUZXh0dXJlRW5jb2RpbmdGcm9tTWFwOiBkb24ndCB1c2UgcmVuZGVyIHRhcmdldHMgYXMgdGV4dHVyZXMuIFVzZSB0aGVpciAudGV4dHVyZSBwcm9wZXJ0eSBpbnN0ZWFkLiIpOwogICAgICAgIGVuY29kaW5nID0gbWFwLnRleHR1cmUuZW5jb2Rpbmc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZW5jb2RpbmcgPSBMaW5lYXJFbmNvZGluZzsKICAgICAgfQogICAgICByZXR1cm4gZW5jb2Rpbmc7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRQYXJhbWV0ZXJzKG1hdGVyaWFsLCBsaWdodHMsIHNoYWRvd3MsIHNjZW5lLCBvYmplY3QpIHsKICAgICAgY29uc3QgZm9nID0gc2NlbmUuZm9nOwogICAgICBjb25zdCBlbnZpcm9ubWVudCA9IG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBzY2VuZS5lbnZpcm9ubWVudCA6IG51bGw7CiAgICAgIGNvbnN0IGVudk1hcCA9IGN1YmVtYXBzLmdldChtYXRlcmlhbC5lbnZNYXAgfHwgZW52aXJvbm1lbnQpOwogICAgICBjb25zdCBzaGFkZXJJRCA9IHNoYWRlcklEc1ttYXRlcmlhbC50eXBlXTsKICAgICAgY29uc3QgbWF4Qm9uZXMgPSBvYmplY3QuaXNTa2lubmVkTWVzaCA/IGdldE1heEJvbmVzKG9iamVjdCkgOiAwOwogICAgICBpZiAobWF0ZXJpYWwucHJlY2lzaW9uICE9PSBudWxsKSB7CiAgICAgICAgcHJlY2lzaW9uID0gY2FwYWJpbGl0aWVzLmdldE1heFByZWNpc2lvbihtYXRlcmlhbC5wcmVjaXNpb24pOwogICAgICAgIGlmIChwcmVjaXNpb24gIT09IG1hdGVyaWFsLnByZWNpc2lvbikgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFByb2dyYW0uZ2V0UGFyYW1ldGVyczoiLCBtYXRlcmlhbC5wcmVjaXNpb24sICJub3Qgc3VwcG9ydGVkLCB1c2luZyIsIHByZWNpc2lvbiwgImluc3RlYWQuIik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCB2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50U2hhZGVyOwogICAgICBpZiAoc2hhZGVySUQpIHsKICAgICAgICBjb25zdCBzaGFkZXIgPSBTaGFkZXJMaWJbc2hhZGVySURdOwogICAgICAgIHZlcnRleFNoYWRlciA9IHNoYWRlci52ZXJ0ZXhTaGFkZXI7CiAgICAgICAgZnJhZ21lbnRTaGFkZXIgPSBzaGFkZXIuZnJhZ21lbnRTaGFkZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmVydGV4U2hhZGVyID0gbWF0ZXJpYWwudmVydGV4U2hhZGVyOwogICAgICAgIGZyYWdtZW50U2hhZGVyID0gbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXI7CiAgICAgIH0KICAgICAgY29uc3QgY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwogICAgICBjb25zdCBwYXJhbWV0ZXJzID0gewogICAgICAgIGlzV2ViR0wyLAogICAgICAgIHNoYWRlcklELAogICAgICAgIHNoYWRlck5hbWU6IG1hdGVyaWFsLnR5cGUsCiAgICAgICAgdmVydGV4U2hhZGVyLAogICAgICAgIGZyYWdtZW50U2hhZGVyLAogICAgICAgIGRlZmluZXM6IG1hdGVyaWFsLmRlZmluZXMsCiAgICAgICAgaXNSYXdTaGFkZXJNYXRlcmlhbDogbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCA9PT0gdHJ1ZSwKICAgICAgICBnbHNsVmVyc2lvbjogbWF0ZXJpYWwuZ2xzbFZlcnNpb24sCiAgICAgICAgcHJlY2lzaW9uLAogICAgICAgIGluc3RhbmNpbmc6IG9iamVjdC5pc0luc3RhbmNlZE1lc2ggPT09IHRydWUsCiAgICAgICAgaW5zdGFuY2luZ0NvbG9yOiBvYmplY3QuaXNJbnN0YW5jZWRNZXNoID09PSB0cnVlICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICE9PSBudWxsLAogICAgICAgIHN1cHBvcnRzVmVydGV4VGV4dHVyZXM6IHZlcnRleFRleHR1cmVzLAogICAgICAgIG91dHB1dEVuY29kaW5nOiBjdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsID8gZ2V0VGV4dHVyZUVuY29kaW5nRnJvbU1hcChjdXJyZW50UmVuZGVyVGFyZ2V0LnRleHR1cmUpIDogcmVuZGVyZXIub3V0cHV0RW5jb2RpbmcsCiAgICAgICAgbWFwOiAhIW1hdGVyaWFsLm1hcCwKICAgICAgICBtYXBFbmNvZGluZzogZ2V0VGV4dHVyZUVuY29kaW5nRnJvbU1hcChtYXRlcmlhbC5tYXApLAogICAgICAgIG1hdGNhcDogISFtYXRlcmlhbC5tYXRjYXAsCiAgICAgICAgbWF0Y2FwRW5jb2Rpbmc6IGdldFRleHR1cmVFbmNvZGluZ0Zyb21NYXAobWF0ZXJpYWwubWF0Y2FwKSwKICAgICAgICBlbnZNYXA6ICEhZW52TWFwLAogICAgICAgIGVudk1hcE1vZGU6IGVudk1hcCAmJiBlbnZNYXAubWFwcGluZywKICAgICAgICBlbnZNYXBFbmNvZGluZzogZ2V0VGV4dHVyZUVuY29kaW5nRnJvbU1hcChlbnZNYXApLAogICAgICAgIGVudk1hcEN1YmVVVjogISFlbnZNYXAgJiYgKGVudk1hcC5tYXBwaW5nID09PSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZyB8fCBlbnZNYXAubWFwcGluZyA9PT0gQ3ViZVVWUmVmcmFjdGlvbk1hcHBpbmcpLAogICAgICAgIGxpZ2h0TWFwOiAhIW1hdGVyaWFsLmxpZ2h0TWFwLAogICAgICAgIGxpZ2h0TWFwRW5jb2Rpbmc6IGdldFRleHR1cmVFbmNvZGluZ0Zyb21NYXAobWF0ZXJpYWwubGlnaHRNYXApLAogICAgICAgIGFvTWFwOiAhIW1hdGVyaWFsLmFvTWFwLAogICAgICAgIGVtaXNzaXZlTWFwOiAhIW1hdGVyaWFsLmVtaXNzaXZlTWFwLAogICAgICAgIGVtaXNzaXZlTWFwRW5jb2Rpbmc6IGdldFRleHR1cmVFbmNvZGluZ0Zyb21NYXAobWF0ZXJpYWwuZW1pc3NpdmVNYXApLAogICAgICAgIGJ1bXBNYXA6ICEhbWF0ZXJpYWwuYnVtcE1hcCwKICAgICAgICBub3JtYWxNYXA6ICEhbWF0ZXJpYWwubm9ybWFsTWFwLAogICAgICAgIG9iamVjdFNwYWNlTm9ybWFsTWFwOiBtYXRlcmlhbC5ub3JtYWxNYXBUeXBlID09PSBPYmplY3RTcGFjZU5vcm1hbE1hcCwKICAgICAgICB0YW5nZW50U3BhY2VOb3JtYWxNYXA6IG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IFRhbmdlbnRTcGFjZU5vcm1hbE1hcCwKICAgICAgICBjbGVhcmNvYXRNYXA6ICEhbWF0ZXJpYWwuY2xlYXJjb2F0TWFwLAogICAgICAgIGNsZWFyY29hdFJvdWdobmVzc01hcDogISFtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAsCiAgICAgICAgY2xlYXJjb2F0Tm9ybWFsTWFwOiAhIW1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcCwKICAgICAgICBkaXNwbGFjZW1lbnRNYXA6ICEhbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwLAogICAgICAgIHJvdWdobmVzc01hcDogISFtYXRlcmlhbC5yb3VnaG5lc3NNYXAsCiAgICAgICAgbWV0YWxuZXNzTWFwOiAhIW1hdGVyaWFsLm1ldGFsbmVzc01hcCwKICAgICAgICBzcGVjdWxhck1hcDogISFtYXRlcmlhbC5zcGVjdWxhck1hcCwKICAgICAgICBhbHBoYU1hcDogISFtYXRlcmlhbC5hbHBoYU1hcCwKICAgICAgICBncmFkaWVudE1hcDogISFtYXRlcmlhbC5ncmFkaWVudE1hcCwKICAgICAgICBzaGVlbjogISFtYXRlcmlhbC5zaGVlbiwKICAgICAgICB0cmFuc21pc3Npb246ICEhbWF0ZXJpYWwudHJhbnNtaXNzaW9uLAogICAgICAgIHRyYW5zbWlzc2lvbk1hcDogISFtYXRlcmlhbC50cmFuc21pc3Npb25NYXAsCiAgICAgICAgdGhpY2tuZXNzTWFwOiAhIW1hdGVyaWFsLnRoaWNrbmVzc01hcCwKICAgICAgICBjb21iaW5lOiBtYXRlcmlhbC5jb21iaW5lLAogICAgICAgIHZlcnRleFRhbmdlbnRzOiBtYXRlcmlhbC5ub3JtYWxNYXAgJiYgbWF0ZXJpYWwudmVydGV4VGFuZ2VudHMsCiAgICAgICAgdmVydGV4Q29sb3JzOiBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMsCiAgICAgICAgdmVydGV4QWxwaGFzOiBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMgPT09IHRydWUgJiYgb2JqZWN0Lmdlb21ldHJ5ICYmIG9iamVjdC5nZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICYmIG9iamVjdC5nZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yLml0ZW1TaXplID09PSA0LAogICAgICAgIHZlcnRleFV2czogISFtYXRlcmlhbC5tYXAgfHwgISFtYXRlcmlhbC5idW1wTWFwIHx8ICEhbWF0ZXJpYWwubm9ybWFsTWFwIHx8ICEhbWF0ZXJpYWwuc3BlY3VsYXJNYXAgfHwgISFtYXRlcmlhbC5hbHBoYU1hcCB8fCAhIW1hdGVyaWFsLmVtaXNzaXZlTWFwIHx8ICEhbWF0ZXJpYWwucm91Z2huZXNzTWFwIHx8ICEhbWF0ZXJpYWwubWV0YWxuZXNzTWFwIHx8ICEhbWF0ZXJpYWwuY2xlYXJjb2F0TWFwIHx8ICEhbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzTWFwIHx8ICEhbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwIHx8ICEhbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwIHx8ICEhbWF0ZXJpYWwudHJhbnNtaXNzaW9uTWFwIHx8ICEhbWF0ZXJpYWwudGhpY2tuZXNzTWFwLAogICAgICAgIHV2c1ZlcnRleE9ubHk6ICEoISFtYXRlcmlhbC5tYXAgfHwgISFtYXRlcmlhbC5idW1wTWFwIHx8ICEhbWF0ZXJpYWwubm9ybWFsTWFwIHx8ICEhbWF0ZXJpYWwuc3BlY3VsYXJNYXAgfHwgISFtYXRlcmlhbC5hbHBoYU1hcCB8fCAhIW1hdGVyaWFsLmVtaXNzaXZlTWFwIHx8ICEhbWF0ZXJpYWwucm91Z2huZXNzTWFwIHx8ICEhbWF0ZXJpYWwubWV0YWxuZXNzTWFwIHx8ICEhbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwIHx8ICEhbWF0ZXJpYWwudHJhbnNtaXNzaW9uIHx8ICEhbWF0ZXJpYWwudHJhbnNtaXNzaW9uTWFwIHx8ICEhbWF0ZXJpYWwudGhpY2tuZXNzTWFwKSAmJiAhIW1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCwKICAgICAgICBmb2c6ICEhZm9nLAogICAgICAgIHVzZUZvZzogbWF0ZXJpYWwuZm9nLAogICAgICAgIGZvZ0V4cDI6IGZvZyAmJiBmb2cuaXNGb2dFeHAyLAogICAgICAgIGZsYXRTaGFkaW5nOiAhIW1hdGVyaWFsLmZsYXRTaGFkaW5nLAogICAgICAgIHNpemVBdHRlbnVhdGlvbjogbWF0ZXJpYWwuc2l6ZUF0dGVudWF0aW9uLAogICAgICAgIGxvZ2FyaXRobWljRGVwdGhCdWZmZXIsCiAgICAgICAgc2tpbm5pbmc6IG9iamVjdC5pc1NraW5uZWRNZXNoID09PSB0cnVlICYmIG1heEJvbmVzID4gMCwKICAgICAgICBtYXhCb25lcywKICAgICAgICB1c2VWZXJ0ZXhUZXh0dXJlOiBmbG9hdFZlcnRleFRleHR1cmVzLAogICAgICAgIG1vcnBoVGFyZ2V0czogbWF0ZXJpYWwubW9ycGhUYXJnZXRzLAogICAgICAgIG1vcnBoTm9ybWFsczogbWF0ZXJpYWwubW9ycGhOb3JtYWxzLAogICAgICAgIG51bURpckxpZ2h0czogbGlnaHRzLmRpcmVjdGlvbmFsLmxlbmd0aCwKICAgICAgICBudW1Qb2ludExpZ2h0czogbGlnaHRzLnBvaW50Lmxlbmd0aCwKICAgICAgICBudW1TcG90TGlnaHRzOiBsaWdodHMuc3BvdC5sZW5ndGgsCiAgICAgICAgbnVtUmVjdEFyZWFMaWdodHM6IGxpZ2h0cy5yZWN0QXJlYS5sZW5ndGgsCiAgICAgICAgbnVtSGVtaUxpZ2h0czogbGlnaHRzLmhlbWkubGVuZ3RoLAogICAgICAgIG51bURpckxpZ2h0U2hhZG93czogbGlnaHRzLmRpcmVjdGlvbmFsU2hhZG93TWFwLmxlbmd0aCwKICAgICAgICBudW1Qb2ludExpZ2h0U2hhZG93czogbGlnaHRzLnBvaW50U2hhZG93TWFwLmxlbmd0aCwKICAgICAgICBudW1TcG90TGlnaHRTaGFkb3dzOiBsaWdodHMuc3BvdFNoYWRvd01hcC5sZW5ndGgsCiAgICAgICAgbnVtQ2xpcHBpbmdQbGFuZXM6IGNsaXBwaW5nLm51bVBsYW5lcywKICAgICAgICBudW1DbGlwSW50ZXJzZWN0aW9uOiBjbGlwcGluZy5udW1JbnRlcnNlY3Rpb24sCiAgICAgICAgZGl0aGVyaW5nOiBtYXRlcmlhbC5kaXRoZXJpbmcsCiAgICAgICAgc2hhZG93TWFwRW5hYmxlZDogcmVuZGVyZXIuc2hhZG93TWFwLmVuYWJsZWQgJiYgc2hhZG93cy5sZW5ndGggPiAwLAogICAgICAgIHNoYWRvd01hcFR5cGU6IHJlbmRlcmVyLnNoYWRvd01hcC50eXBlLAogICAgICAgIHRvbmVNYXBwaW5nOiBtYXRlcmlhbC50b25lTWFwcGVkID8gcmVuZGVyZXIudG9uZU1hcHBpbmcgOiBOb1RvbmVNYXBwaW5nLAogICAgICAgIHBoeXNpY2FsbHlDb3JyZWN0TGlnaHRzOiByZW5kZXJlci5waHlzaWNhbGx5Q29ycmVjdExpZ2h0cywKICAgICAgICBwcmVtdWx0aXBsaWVkQWxwaGE6IG1hdGVyaWFsLnByZW11bHRpcGxpZWRBbHBoYSwKICAgICAgICBhbHBoYVRlc3Q6IG1hdGVyaWFsLmFscGhhVGVzdCwKICAgICAgICBkb3VibGVTaWRlZDogbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZSwKICAgICAgICBmbGlwU2lkZWQ6IG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlLAogICAgICAgIGRlcHRoUGFja2luZzogbWF0ZXJpYWwuZGVwdGhQYWNraW5nICE9PSB2b2lkIDAgPyBtYXRlcmlhbC5kZXB0aFBhY2tpbmcgOiBmYWxzZSwKICAgICAgICBpbmRleDBBdHRyaWJ1dGVOYW1lOiBtYXRlcmlhbC5pbmRleDBBdHRyaWJ1dGVOYW1lLAogICAgICAgIGV4dGVuc2lvbkRlcml2YXRpdmVzOiBtYXRlcmlhbC5leHRlbnNpb25zICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMuZGVyaXZhdGl2ZXMsCiAgICAgICAgZXh0ZW5zaW9uRnJhZ0RlcHRoOiBtYXRlcmlhbC5leHRlbnNpb25zICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMuZnJhZ0RlcHRoLAogICAgICAgIGV4dGVuc2lvbkRyYXdCdWZmZXJzOiBtYXRlcmlhbC5leHRlbnNpb25zICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMuZHJhd0J1ZmZlcnMsCiAgICAgICAgZXh0ZW5zaW9uU2hhZGVyVGV4dHVyZUxPRDogbWF0ZXJpYWwuZXh0ZW5zaW9ucyAmJiBtYXRlcmlhbC5leHRlbnNpb25zLnNoYWRlclRleHR1cmVMT0QsCiAgICAgICAgcmVuZGVyZXJFeHRlbnNpb25GcmFnRGVwdGg6IGlzV2ViR0wyIHx8IGV4dGVuc2lvbnMuaGFzKCJFWFRfZnJhZ19kZXB0aCIpLAogICAgICAgIHJlbmRlcmVyRXh0ZW5zaW9uRHJhd0J1ZmZlcnM6IGlzV2ViR0wyIHx8IGV4dGVuc2lvbnMuaGFzKCJXRUJHTF9kcmF3X2J1ZmZlcnMiKSwKICAgICAgICByZW5kZXJlckV4dGVuc2lvblNoYWRlclRleHR1cmVMb2Q6IGlzV2ViR0wyIHx8IGV4dGVuc2lvbnMuaGFzKCJFWFRfc2hhZGVyX3RleHR1cmVfbG9kIiksCiAgICAgICAgY3VzdG9tUHJvZ3JhbUNhY2hlS2V5OiBtYXRlcmlhbC5jdXN0b21Qcm9ncmFtQ2FjaGVLZXkoKQogICAgICB9OwogICAgICByZXR1cm4gcGFyYW1ldGVyczsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFByb2dyYW1DYWNoZUtleShwYXJhbWV0ZXJzKSB7CiAgICAgIGNvbnN0IGFycmF5ID0gW107CiAgICAgIGlmIChwYXJhbWV0ZXJzLnNoYWRlcklEKSB7CiAgICAgICAgYXJyYXkucHVzaChwYXJhbWV0ZXJzLnNoYWRlcklEKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhcnJheS5wdXNoKHBhcmFtZXRlcnMuZnJhZ21lbnRTaGFkZXIpOwogICAgICAgIGFycmF5LnB1c2gocGFyYW1ldGVycy52ZXJ0ZXhTaGFkZXIpOwogICAgICB9CiAgICAgIGlmIChwYXJhbWV0ZXJzLmRlZmluZXMgIT09IHZvaWQgMCkgewogICAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBwYXJhbWV0ZXJzLmRlZmluZXMpIHsKICAgICAgICAgIGFycmF5LnB1c2gobmFtZSk7CiAgICAgICAgICBhcnJheS5wdXNoKHBhcmFtZXRlcnMuZGVmaW5lc1tuYW1lXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwYXJhbWV0ZXJzLmlzUmF3U2hhZGVyTWF0ZXJpYWwgPT09IGZhbHNlKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXJhbWV0ZXJOYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgYXJyYXkucHVzaChwYXJhbWV0ZXJzW3BhcmFtZXRlck5hbWVzW2ldXSk7CiAgICAgICAgfQogICAgICAgIGFycmF5LnB1c2gocmVuZGVyZXIub3V0cHV0RW5jb2RpbmcpOwogICAgICAgIGFycmF5LnB1c2gocmVuZGVyZXIuZ2FtbWFGYWN0b3IpOwogICAgICB9CiAgICAgIGFycmF5LnB1c2gocGFyYW1ldGVycy5jdXN0b21Qcm9ncmFtQ2FjaGVLZXkpOwogICAgICByZXR1cm4gYXJyYXkuam9pbigpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0VW5pZm9ybXMobWF0ZXJpYWwpIHsKICAgICAgY29uc3Qgc2hhZGVySUQgPSBzaGFkZXJJRHNbbWF0ZXJpYWwudHlwZV07CiAgICAgIGxldCB1bmlmb3JtczsKICAgICAgaWYgKHNoYWRlcklEKSB7CiAgICAgICAgY29uc3Qgc2hhZGVyID0gU2hhZGVyTGliW3NoYWRlcklEXTsKICAgICAgICB1bmlmb3JtcyA9IFVuaWZvcm1zVXRpbHMuY2xvbmUoc2hhZGVyLnVuaWZvcm1zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB1bmlmb3JtcyA9IG1hdGVyaWFsLnVuaWZvcm1zOwogICAgICB9CiAgICAgIHJldHVybiB1bmlmb3JtczsKICAgIH0KICAgIGZ1bmN0aW9uIGFjcXVpcmVQcm9ncmFtKHBhcmFtZXRlcnMsIGNhY2hlS2V5KSB7CiAgICAgIGxldCBwcm9ncmFtOwogICAgICBmb3IgKGxldCBwID0gMCwgcGwgPSBwcm9ncmFtcy5sZW5ndGg7IHAgPCBwbDsgcCsrKSB7CiAgICAgICAgY29uc3QgcHJlZXhpc3RpbmdQcm9ncmFtID0gcHJvZ3JhbXNbcF07CiAgICAgICAgaWYgKHByZWV4aXN0aW5nUHJvZ3JhbS5jYWNoZUtleSA9PT0gY2FjaGVLZXkpIHsKICAgICAgICAgIHByb2dyYW0gPSBwcmVleGlzdGluZ1Byb2dyYW07CiAgICAgICAgICArK3Byb2dyYW0udXNlZFRpbWVzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwcm9ncmFtID09PSB2b2lkIDApIHsKICAgICAgICBwcm9ncmFtID0gbmV3IFdlYkdMUHJvZ3JhbShyZW5kZXJlciwgY2FjaGVLZXksIHBhcmFtZXRlcnMsIGJpbmRpbmdTdGF0ZXMpOwogICAgICAgIHByb2dyYW1zLnB1c2gocHJvZ3JhbSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHByb2dyYW07CiAgICB9CiAgICBmdW5jdGlvbiByZWxlYXNlUHJvZ3JhbShwcm9ncmFtKSB7CiAgICAgIGlmICgtLXByb2dyYW0udXNlZFRpbWVzID09PSAwKSB7CiAgICAgICAgY29uc3QgaSA9IHByb2dyYW1zLmluZGV4T2YocHJvZ3JhbSk7CiAgICAgICAgcHJvZ3JhbXNbaV0gPSBwcm9ncmFtc1twcm9ncmFtcy5sZW5ndGggLSAxXTsKICAgICAgICBwcm9ncmFtcy5wb3AoKTsKICAgICAgICBwcm9ncmFtLmRlc3Ryb3koKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgZ2V0UGFyYW1ldGVycywKICAgICAgZ2V0UHJvZ3JhbUNhY2hlS2V5LAogICAgICBnZXRVbmlmb3JtcywKICAgICAgYWNxdWlyZVByb2dyYW0sCiAgICAgIHJlbGVhc2VQcm9ncmFtLAogICAgICBwcm9ncmFtcwogICAgfTsKICB9CiAgZnVuY3Rpb24gV2ViR0xQcm9wZXJ0aWVzKCkgewogICAgbGV0IHByb3BlcnRpZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtNYXAoKTsKICAgIGZ1bmN0aW9uIGdldChvYmplY3QpIHsKICAgICAgbGV0IG1hcCA9IHByb3BlcnRpZXMuZ2V0KG9iamVjdCk7CiAgICAgIGlmIChtYXAgPT09IHZvaWQgMCkgewogICAgICAgIG1hcCA9IHt9OwogICAgICAgIHByb3BlcnRpZXMuc2V0KG9iamVjdCwgbWFwKTsKICAgICAgfQogICAgICByZXR1cm4gbWFwOwogICAgfQogICAgZnVuY3Rpb24gcmVtb3ZlKG9iamVjdCkgewogICAgICBwcm9wZXJ0aWVzLmRlbGV0ZShvYmplY3QpOwogICAgfQogICAgZnVuY3Rpb24gdXBkYXRlKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgICBwcm9wZXJ0aWVzLmdldChvYmplY3QpW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIGRpc3Bvc2UoKSB7CiAgICAgIHByb3BlcnRpZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtNYXAoKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGdldCwKICAgICAgcmVtb3ZlLAogICAgICB1cGRhdGUsCiAgICAgIGRpc3Bvc2UKICAgIH07CiAgfQogIGZ1bmN0aW9uIHBhaW50ZXJTb3J0U3RhYmxlKGEsIGIpIHsKICAgIGlmIChhLmdyb3VwT3JkZXIgIT09IGIuZ3JvdXBPcmRlcikgewogICAgICByZXR1cm4gYS5ncm91cE9yZGVyIC0gYi5ncm91cE9yZGVyOwogICAgfSBlbHNlIGlmIChhLnJlbmRlck9yZGVyICE9PSBiLnJlbmRlck9yZGVyKSB7CiAgICAgIHJldHVybiBhLnJlbmRlck9yZGVyIC0gYi5yZW5kZXJPcmRlcjsKICAgIH0gZWxzZSBpZiAoYS5wcm9ncmFtICE9PSBiLnByb2dyYW0pIHsKICAgICAgcmV0dXJuIGEucHJvZ3JhbS5pZCAtIGIucHJvZ3JhbS5pZDsKICAgIH0gZWxzZSBpZiAoYS5tYXRlcmlhbC5pZCAhPT0gYi5tYXRlcmlhbC5pZCkgewogICAgICByZXR1cm4gYS5tYXRlcmlhbC5pZCAtIGIubWF0ZXJpYWwuaWQ7CiAgICB9IGVsc2UgaWYgKGEueiAhPT0gYi56KSB7CiAgICAgIHJldHVybiBhLnogLSBiLno7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gYS5pZCAtIGIuaWQ7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHJldmVyc2VQYWludGVyU29ydFN0YWJsZShhLCBiKSB7CiAgICBpZiAoYS5ncm91cE9yZGVyICE9PSBiLmdyb3VwT3JkZXIpIHsKICAgICAgcmV0dXJuIGEuZ3JvdXBPcmRlciAtIGIuZ3JvdXBPcmRlcjsKICAgIH0gZWxzZSBpZiAoYS5yZW5kZXJPcmRlciAhPT0gYi5yZW5kZXJPcmRlcikgewogICAgICByZXR1cm4gYS5yZW5kZXJPcmRlciAtIGIucmVuZGVyT3JkZXI7CiAgICB9IGVsc2UgaWYgKGEueiAhPT0gYi56KSB7CiAgICAgIHJldHVybiBiLnogLSBhLno7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gYS5pZCAtIGIuaWQ7CiAgICB9CiAgfQogIGZ1bmN0aW9uIFdlYkdMUmVuZGVyTGlzdChwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCByZW5kZXJJdGVtcyA9IFtdOwogICAgbGV0IHJlbmRlckl0ZW1zSW5kZXggPSAwOwogICAgY29uc3Qgb3BhcXVlID0gW107CiAgICBjb25zdCB0cmFuc21pc3NpdmUgPSBbXTsKICAgIGNvbnN0IHRyYW5zcGFyZW50ID0gW107CiAgICBjb25zdCBkZWZhdWx0UHJvZ3JhbSA9IHsgaWQ6IC0xIH07CiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICByZW5kZXJJdGVtc0luZGV4ID0gMDsKICAgICAgb3BhcXVlLmxlbmd0aCA9IDA7CiAgICAgIHRyYW5zbWlzc2l2ZS5sZW5ndGggPSAwOwogICAgICB0cmFuc3BhcmVudC5sZW5ndGggPSAwOwogICAgfQogICAgZnVuY3Rpb24gZ2V0TmV4dFJlbmRlckl0ZW0ob2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwKSB7CiAgICAgIGxldCByZW5kZXJJdGVtID0gcmVuZGVySXRlbXNbcmVuZGVySXRlbXNJbmRleF07CiAgICAgIGNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KG1hdGVyaWFsKTsKICAgICAgaWYgKHJlbmRlckl0ZW0gPT09IHZvaWQgMCkgewogICAgICAgIHJlbmRlckl0ZW0gPSB7CiAgICAgICAgICBpZDogb2JqZWN0LmlkLAogICAgICAgICAgb2JqZWN0LAogICAgICAgICAgZ2VvbWV0cnksCiAgICAgICAgICBtYXRlcmlhbCwKICAgICAgICAgIHByb2dyYW06IG1hdGVyaWFsUHJvcGVydGllcy5wcm9ncmFtIHx8IGRlZmF1bHRQcm9ncmFtLAogICAgICAgICAgZ3JvdXBPcmRlciwKICAgICAgICAgIHJlbmRlck9yZGVyOiBvYmplY3QucmVuZGVyT3JkZXIsCiAgICAgICAgICB6LAogICAgICAgICAgZ3JvdXAKICAgICAgICB9OwogICAgICAgIHJlbmRlckl0ZW1zW3JlbmRlckl0ZW1zSW5kZXhdID0gcmVuZGVySXRlbTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZW5kZXJJdGVtLmlkID0gb2JqZWN0LmlkOwogICAgICAgIHJlbmRlckl0ZW0ub2JqZWN0ID0gb2JqZWN0OwogICAgICAgIHJlbmRlckl0ZW0uZ2VvbWV0cnkgPSBnZW9tZXRyeTsKICAgICAgICByZW5kZXJJdGVtLm1hdGVyaWFsID0gbWF0ZXJpYWw7CiAgICAgICAgcmVuZGVySXRlbS5wcm9ncmFtID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLnByb2dyYW0gfHwgZGVmYXVsdFByb2dyYW07CiAgICAgICAgcmVuZGVySXRlbS5ncm91cE9yZGVyID0gZ3JvdXBPcmRlcjsKICAgICAgICByZW5kZXJJdGVtLnJlbmRlck9yZGVyID0gb2JqZWN0LnJlbmRlck9yZGVyOwogICAgICAgIHJlbmRlckl0ZW0ueiA9IHo7CiAgICAgICAgcmVuZGVySXRlbS5ncm91cCA9IGdyb3VwOwogICAgICB9CiAgICAgIHJlbmRlckl0ZW1zSW5kZXgrKzsKICAgICAgcmV0dXJuIHJlbmRlckl0ZW07CiAgICB9CiAgICBmdW5jdGlvbiBwdXNoKG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCkgewogICAgICBjb25zdCByZW5kZXJJdGVtID0gZ2V0TmV4dFJlbmRlckl0ZW0ob2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwKTsKICAgICAgaWYgKG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA+IDApIHsKICAgICAgICB0cmFuc21pc3NpdmUucHVzaChyZW5kZXJJdGVtKTsKICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSkgewogICAgICAgIHRyYW5zcGFyZW50LnB1c2gocmVuZGVySXRlbSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3BhcXVlLnB1c2gocmVuZGVySXRlbSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHVuc2hpZnQob2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwKSB7CiAgICAgIGNvbnN0IHJlbmRlckl0ZW0gPSBnZXROZXh0UmVuZGVySXRlbShvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXApOwogICAgICBpZiAobWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMCkgewogICAgICAgIHRyYW5zbWlzc2l2ZS51bnNoaWZ0KHJlbmRlckl0ZW0pOwogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSB0cnVlKSB7CiAgICAgICAgdHJhbnNwYXJlbnQudW5zaGlmdChyZW5kZXJJdGVtKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcGFxdWUudW5zaGlmdChyZW5kZXJJdGVtKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc29ydChjdXN0b21PcGFxdWVTb3J0LCBjdXN0b21UcmFuc3BhcmVudFNvcnQpIHsKICAgICAgaWYgKG9wYXF1ZS5sZW5ndGggPiAxKQogICAgICAgIG9wYXF1ZS5zb3J0KGN1c3RvbU9wYXF1ZVNvcnQgfHwgcGFpbnRlclNvcnRTdGFibGUpOwogICAgICBpZiAodHJhbnNtaXNzaXZlLmxlbmd0aCA+IDEpCiAgICAgICAgdHJhbnNtaXNzaXZlLnNvcnQoY3VzdG9tVHJhbnNwYXJlbnRTb3J0IHx8IHJldmVyc2VQYWludGVyU29ydFN0YWJsZSk7CiAgICAgIGlmICh0cmFuc3BhcmVudC5sZW5ndGggPiAxKQogICAgICAgIHRyYW5zcGFyZW50LnNvcnQoY3VzdG9tVHJhbnNwYXJlbnRTb3J0IHx8IHJldmVyc2VQYWludGVyU29ydFN0YWJsZSk7CiAgICB9CiAgICBmdW5jdGlvbiBmaW5pc2goKSB7CiAgICAgIGZvciAobGV0IGkgPSByZW5kZXJJdGVtc0luZGV4LCBpbCA9IHJlbmRlckl0ZW1zLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICBjb25zdCByZW5kZXJJdGVtID0gcmVuZGVySXRlbXNbaV07CiAgICAgICAgaWYgKHJlbmRlckl0ZW0uaWQgPT09IG51bGwpCiAgICAgICAgICBicmVhazsKICAgICAgICByZW5kZXJJdGVtLmlkID0gbnVsbDsKICAgICAgICByZW5kZXJJdGVtLm9iamVjdCA9IG51bGw7CiAgICAgICAgcmVuZGVySXRlbS5nZW9tZXRyeSA9IG51bGw7CiAgICAgICAgcmVuZGVySXRlbS5tYXRlcmlhbCA9IG51bGw7CiAgICAgICAgcmVuZGVySXRlbS5wcm9ncmFtID0gbnVsbDsKICAgICAgICByZW5kZXJJdGVtLmdyb3VwID0gbnVsbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgb3BhcXVlLAogICAgICB0cmFuc21pc3NpdmUsCiAgICAgIHRyYW5zcGFyZW50LAogICAgICBpbml0LAogICAgICBwdXNoLAogICAgICB1bnNoaWZ0LAogICAgICBmaW5pc2gsCiAgICAgIHNvcnQKICAgIH07CiAgfQogIGZ1bmN0aW9uIFdlYkdMUmVuZGVyTGlzdHMocHJvcGVydGllcykgewogICAgbGV0IGxpc3RzID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICBmdW5jdGlvbiBnZXQoc2NlbmUsIHJlbmRlckNhbGxEZXB0aCkgewogICAgICBsZXQgbGlzdDsKICAgICAgaWYgKGxpc3RzLmhhcyhzY2VuZSkgPT09IGZhbHNlKSB7CiAgICAgICAgbGlzdCA9IG5ldyBXZWJHTFJlbmRlckxpc3QocHJvcGVydGllcyk7CiAgICAgICAgbGlzdHMuc2V0KHNjZW5lLCBbbGlzdF0pOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChyZW5kZXJDYWxsRGVwdGggPj0gbGlzdHMuZ2V0KHNjZW5lKS5sZW5ndGgpIHsKICAgICAgICAgIGxpc3QgPSBuZXcgV2ViR0xSZW5kZXJMaXN0KHByb3BlcnRpZXMpOwogICAgICAgICAgbGlzdHMuZ2V0KHNjZW5lKS5wdXNoKGxpc3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsaXN0ID0gbGlzdHMuZ2V0KHNjZW5lKVtyZW5kZXJDYWxsRGVwdGhdOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbGlzdDsKICAgIH0KICAgIGZ1bmN0aW9uIGRpc3Bvc2UoKSB7CiAgICAgIGxpc3RzID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICB9CiAgICByZXR1cm4gewogICAgICBnZXQsCiAgICAgIGRpc3Bvc2UKICAgIH07CiAgfQogIGZ1bmN0aW9uIFVuaWZvcm1zQ2FjaGUoKSB7CiAgICBjb25zdCBsaWdodHMgPSB7fTsKICAgIHJldHVybiB7CiAgICAgIGdldDogZnVuY3Rpb24obGlnaHQpIHsKICAgICAgICBpZiAobGlnaHRzW2xpZ2h0LmlkXSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICByZXR1cm4gbGlnaHRzW2xpZ2h0LmlkXTsKICAgICAgICB9CiAgICAgICAgbGV0IHVuaWZvcm1zOwogICAgICAgIHN3aXRjaCAobGlnaHQudHlwZSkgewogICAgICAgICAgY2FzZSAiRGlyZWN0aW9uYWxMaWdodCI6CiAgICAgICAgICAgIHVuaWZvcm1zID0gewogICAgICAgICAgICAgIGRpcmVjdGlvbjogbmV3IFZlY3RvcjMoKSwKICAgICAgICAgICAgICBjb2xvcjogbmV3IENvbG9yKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJTcG90TGlnaHQiOgogICAgICAgICAgICB1bmlmb3JtcyA9IHsKICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IFZlY3RvcjMoKSwKICAgICAgICAgICAgICBkaXJlY3Rpb246IG5ldyBWZWN0b3IzKCksCiAgICAgICAgICAgICAgY29sb3I6IG5ldyBDb2xvcigpLAogICAgICAgICAgICAgIGRpc3RhbmNlOiAwLAogICAgICAgICAgICAgIGNvbmVDb3M6IDAsCiAgICAgICAgICAgICAgcGVudW1icmFDb3M6IDAsCiAgICAgICAgICAgICAgZGVjYXk6IDAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJQb2ludExpZ2h0IjoKICAgICAgICAgICAgdW5pZm9ybXMgPSB7CiAgICAgICAgICAgICAgcG9zaXRpb246IG5ldyBWZWN0b3IzKCksCiAgICAgICAgICAgICAgY29sb3I6IG5ldyBDb2xvcigpLAogICAgICAgICAgICAgIGRpc3RhbmNlOiAwLAogICAgICAgICAgICAgIGRlY2F5OiAwCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiSGVtaXNwaGVyZUxpZ2h0IjoKICAgICAgICAgICAgdW5pZm9ybXMgPSB7CiAgICAgICAgICAgICAgZGlyZWN0aW9uOiBuZXcgVmVjdG9yMygpLAogICAgICAgICAgICAgIHNreUNvbG9yOiBuZXcgQ29sb3IoKSwKICAgICAgICAgICAgICBncm91bmRDb2xvcjogbmV3IENvbG9yKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJSZWN0QXJlYUxpZ2h0IjoKICAgICAgICAgICAgdW5pZm9ybXMgPSB7CiAgICAgICAgICAgICAgY29sb3I6IG5ldyBDb2xvcigpLAogICAgICAgICAgICAgIHBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAogICAgICAgICAgICAgIGhhbGZXaWR0aDogbmV3IFZlY3RvcjMoKSwKICAgICAgICAgICAgICBoYWxmSGVpZ2h0OiBuZXcgVmVjdG9yMygpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBsaWdodHNbbGlnaHQuaWRdID0gdW5pZm9ybXM7CiAgICAgICAgcmV0dXJuIHVuaWZvcm1zOwogICAgICB9CiAgICB9OwogIH0KICBmdW5jdGlvbiBTaGFkb3dVbmlmb3Jtc0NhY2hlKCkgewogICAgY29uc3QgbGlnaHRzID0ge307CiAgICByZXR1cm4gewogICAgICBnZXQ6IGZ1bmN0aW9uKGxpZ2h0KSB7CiAgICAgICAgaWYgKGxpZ2h0c1tsaWdodC5pZF0gIT09IHZvaWQgMCkgewogICAgICAgICAgcmV0dXJuIGxpZ2h0c1tsaWdodC5pZF07CiAgICAgICAgfQogICAgICAgIGxldCB1bmlmb3JtczsKICAgICAgICBzd2l0Y2ggKGxpZ2h0LnR5cGUpIHsKICAgICAgICAgIGNhc2UgIkRpcmVjdGlvbmFsTGlnaHQiOgogICAgICAgICAgICB1bmlmb3JtcyA9IHsKICAgICAgICAgICAgICBzaGFkb3dCaWFzOiAwLAogICAgICAgICAgICAgIHNoYWRvd05vcm1hbEJpYXM6IDAsCiAgICAgICAgICAgICAgc2hhZG93UmFkaXVzOiAxLAogICAgICAgICAgICAgIHNoYWRvd01hcFNpemU6IG5ldyBWZWN0b3IyKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJTcG90TGlnaHQiOgogICAgICAgICAgICB1bmlmb3JtcyA9IHsKICAgICAgICAgICAgICBzaGFkb3dCaWFzOiAwLAogICAgICAgICAgICAgIHNoYWRvd05vcm1hbEJpYXM6IDAsCiAgICAgICAgICAgICAgc2hhZG93UmFkaXVzOiAxLAogICAgICAgICAgICAgIHNoYWRvd01hcFNpemU6IG5ldyBWZWN0b3IyKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJQb2ludExpZ2h0IjoKICAgICAgICAgICAgdW5pZm9ybXMgPSB7CiAgICAgICAgICAgICAgc2hhZG93QmlhczogMCwKICAgICAgICAgICAgICBzaGFkb3dOb3JtYWxCaWFzOiAwLAogICAgICAgICAgICAgIHNoYWRvd1JhZGl1czogMSwKICAgICAgICAgICAgICBzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpLAogICAgICAgICAgICAgIHNoYWRvd0NhbWVyYU5lYXI6IDEsCiAgICAgICAgICAgICAgc2hhZG93Q2FtZXJhRmFyOiAxZTMKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGxpZ2h0c1tsaWdodC5pZF0gPSB1bmlmb3JtczsKICAgICAgICByZXR1cm4gdW5pZm9ybXM7CiAgICAgIH0KICAgIH07CiAgfQogIHZhciBuZXh0VmVyc2lvbiA9IDA7CiAgZnVuY3Rpb24gc2hhZG93Q2FzdGluZ0xpZ2h0c0ZpcnN0KGxpZ2h0QSwgbGlnaHRCKSB7CiAgICByZXR1cm4gKGxpZ2h0Qi5jYXN0U2hhZG93ID8gMSA6IDApIC0gKGxpZ2h0QS5jYXN0U2hhZG93ID8gMSA6IDApOwogIH0KICBmdW5jdGlvbiBXZWJHTExpZ2h0cyhleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMpIHsKICAgIGNvbnN0IGNhY2hlID0gbmV3IFVuaWZvcm1zQ2FjaGUoKTsKICAgIGNvbnN0IHNoYWRvd0NhY2hlID0gU2hhZG93VW5pZm9ybXNDYWNoZSgpOwogICAgY29uc3Qgc3RhdGUgPSB7CiAgICAgIHZlcnNpb246IDAsCiAgICAgIGhhc2g6IHsKICAgICAgICBkaXJlY3Rpb25hbExlbmd0aDogLTEsCiAgICAgICAgcG9pbnRMZW5ndGg6IC0xLAogICAgICAgIHNwb3RMZW5ndGg6IC0xLAogICAgICAgIHJlY3RBcmVhTGVuZ3RoOiAtMSwKICAgICAgICBoZW1pTGVuZ3RoOiAtMSwKICAgICAgICBudW1EaXJlY3Rpb25hbFNoYWRvd3M6IC0xLAogICAgICAgIG51bVBvaW50U2hhZG93czogLTEsCiAgICAgICAgbnVtU3BvdFNoYWRvd3M6IC0xCiAgICAgIH0sCiAgICAgIGFtYmllbnQ6IFswLCAwLCAwXSwKICAgICAgcHJvYmU6IFtdLAogICAgICBkaXJlY3Rpb25hbDogW10sCiAgICAgIGRpcmVjdGlvbmFsU2hhZG93OiBbXSwKICAgICAgZGlyZWN0aW9uYWxTaGFkb3dNYXA6IFtdLAogICAgICBkaXJlY3Rpb25hbFNoYWRvd01hdHJpeDogW10sCiAgICAgIHNwb3Q6IFtdLAogICAgICBzcG90U2hhZG93OiBbXSwKICAgICAgc3BvdFNoYWRvd01hcDogW10sCiAgICAgIHNwb3RTaGFkb3dNYXRyaXg6IFtdLAogICAgICByZWN0QXJlYTogW10sCiAgICAgIHJlY3RBcmVhTFRDMTogbnVsbCwKICAgICAgcmVjdEFyZWFMVEMyOiBudWxsLAogICAgICBwb2ludDogW10sCiAgICAgIHBvaW50U2hhZG93OiBbXSwKICAgICAgcG9pbnRTaGFkb3dNYXA6IFtdLAogICAgICBwb2ludFNoYWRvd01hdHJpeDogW10sCiAgICAgIGhlbWk6IFtdCiAgICB9OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspCiAgICAgIHN0YXRlLnByb2JlLnB1c2gobmV3IFZlY3RvcjMoKSk7CiAgICBjb25zdCB2ZWN0b3IzID0gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IG1hdHJpeDQgPSBuZXcgTWF0cml4NCgpOwogICAgY29uc3QgbWF0cml4NDIgPSBuZXcgTWF0cml4NCgpOwogICAgZnVuY3Rpb24gc2V0dXAobGlnaHRzKSB7CiAgICAgIGxldCByID0gMCwgZyA9IDAsIGIgPSAwOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDk7IGkrKykKICAgICAgICBzdGF0ZS5wcm9iZVtpXS5zZXQoMCwgMCwgMCk7CiAgICAgIGxldCBkaXJlY3Rpb25hbExlbmd0aCA9IDA7CiAgICAgIGxldCBwb2ludExlbmd0aCA9IDA7CiAgICAgIGxldCBzcG90TGVuZ3RoID0gMDsKICAgICAgbGV0IHJlY3RBcmVhTGVuZ3RoID0gMDsKICAgICAgbGV0IGhlbWlMZW5ndGggPSAwOwogICAgICBsZXQgbnVtRGlyZWN0aW9uYWxTaGFkb3dzID0gMDsKICAgICAgbGV0IG51bVBvaW50U2hhZG93cyA9IDA7CiAgICAgIGxldCBudW1TcG90U2hhZG93cyA9IDA7CiAgICAgIGxpZ2h0cy5zb3J0KHNoYWRvd0Nhc3RpbmdMaWdodHNGaXJzdCk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gbGlnaHRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IGxpZ2h0ID0gbGlnaHRzW2ldOwogICAgICAgIGNvbnN0IGNvbG9yID0gbGlnaHQuY29sb3I7CiAgICAgICAgY29uc3QgaW50ZW5zaXR5ID0gbGlnaHQuaW50ZW5zaXR5OwogICAgICAgIGNvbnN0IGRpc3RhbmNlID0gbGlnaHQuZGlzdGFuY2U7CiAgICAgICAgY29uc3Qgc2hhZG93TWFwID0gbGlnaHQuc2hhZG93ICYmIGxpZ2h0LnNoYWRvdy5tYXAgPyBsaWdodC5zaGFkb3cubWFwLnRleHR1cmUgOiBudWxsOwogICAgICAgIGlmIChsaWdodC5pc0FtYmllbnRMaWdodCkgewogICAgICAgICAgciArPSBjb2xvci5yICogaW50ZW5zaXR5OwogICAgICAgICAgZyArPSBjb2xvci5nICogaW50ZW5zaXR5OwogICAgICAgICAgYiArPSBjb2xvci5iICogaW50ZW5zaXR5OwogICAgICAgIH0gZWxzZSBpZiAobGlnaHQuaXNMaWdodFByb2JlKSB7CiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDk7IGorKykgewogICAgICAgICAgICBzdGF0ZS5wcm9iZVtqXS5hZGRTY2FsZWRWZWN0b3IobGlnaHQuc2guY29lZmZpY2llbnRzW2pdLCBpbnRlbnNpdHkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAobGlnaHQuaXNEaXJlY3Rpb25hbExpZ2h0KSB7CiAgICAgICAgICBjb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldChsaWdodCk7CiAgICAgICAgICB1bmlmb3Jtcy5jb2xvci5jb3B5KGxpZ2h0LmNvbG9yKS5tdWx0aXBseVNjYWxhcihsaWdodC5pbnRlbnNpdHkpOwogICAgICAgICAgaWYgKGxpZ2h0LmNhc3RTaGFkb3cpIHsKICAgICAgICAgICAgY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwogICAgICAgICAgICBjb25zdCBzaGFkb3dVbmlmb3JtcyA9IHNoYWRvd0NhY2hlLmdldChsaWdodCk7CiAgICAgICAgICAgIHNoYWRvd1VuaWZvcm1zLnNoYWRvd0JpYXMgPSBzaGFkb3cuYmlhczsKICAgICAgICAgICAgc2hhZG93VW5pZm9ybXMuc2hhZG93Tm9ybWFsQmlhcyA9IHNoYWRvdy5ub3JtYWxCaWFzOwogICAgICAgICAgICBzaGFkb3dVbmlmb3Jtcy5zaGFkb3dSYWRpdXMgPSBzaGFkb3cucmFkaXVzOwogICAgICAgICAgICBzaGFkb3dVbmlmb3Jtcy5zaGFkb3dNYXBTaXplID0gc2hhZG93Lm1hcFNpemU7CiAgICAgICAgICAgIHN0YXRlLmRpcmVjdGlvbmFsU2hhZG93W2RpcmVjdGlvbmFsTGVuZ3RoXSA9IHNoYWRvd1VuaWZvcm1zOwogICAgICAgICAgICBzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hcFtkaXJlY3Rpb25hbExlbmd0aF0gPSBzaGFkb3dNYXA7CiAgICAgICAgICAgIHN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4W2RpcmVjdGlvbmFsTGVuZ3RoXSA9IGxpZ2h0LnNoYWRvdy5tYXRyaXg7CiAgICAgICAgICAgIG51bURpcmVjdGlvbmFsU2hhZG93cysrOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUuZGlyZWN0aW9uYWxbZGlyZWN0aW9uYWxMZW5ndGhdID0gdW5pZm9ybXM7CiAgICAgICAgICBkaXJlY3Rpb25hbExlbmd0aCsrOwogICAgICAgIH0gZWxzZSBpZiAobGlnaHQuaXNTcG90TGlnaHQpIHsKICAgICAgICAgIGNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KGxpZ2h0KTsKICAgICAgICAgIHVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbihsaWdodC5tYXRyaXhXb3JsZCk7CiAgICAgICAgICB1bmlmb3Jtcy5jb2xvci5jb3B5KGNvbG9yKS5tdWx0aXBseVNjYWxhcihpbnRlbnNpdHkpOwogICAgICAgICAgdW5pZm9ybXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgICAgIHVuaWZvcm1zLmNvbmVDb3MgPSBNYXRoLmNvcyhsaWdodC5hbmdsZSk7CiAgICAgICAgICB1bmlmb3Jtcy5wZW51bWJyYUNvcyA9IE1hdGguY29zKGxpZ2h0LmFuZ2xlICogKDEgLSBsaWdodC5wZW51bWJyYSkpOwogICAgICAgICAgdW5pZm9ybXMuZGVjYXkgPSBsaWdodC5kZWNheTsKICAgICAgICAgIGlmIChsaWdodC5jYXN0U2hhZG93KSB7CiAgICAgICAgICAgIGNvbnN0IHNoYWRvdyA9IGxpZ2h0LnNoYWRvdzsKICAgICAgICAgICAgY29uc3Qgc2hhZG93VW5pZm9ybXMgPSBzaGFkb3dDYWNoZS5nZXQobGlnaHQpOwogICAgICAgICAgICBzaGFkb3dVbmlmb3Jtcy5zaGFkb3dCaWFzID0gc2hhZG93LmJpYXM7CiAgICAgICAgICAgIHNoYWRvd1VuaWZvcm1zLnNoYWRvd05vcm1hbEJpYXMgPSBzaGFkb3cubm9ybWFsQmlhczsKICAgICAgICAgICAgc2hhZG93VW5pZm9ybXMuc2hhZG93UmFkaXVzID0gc2hhZG93LnJhZGl1czsKICAgICAgICAgICAgc2hhZG93VW5pZm9ybXMuc2hhZG93TWFwU2l6ZSA9IHNoYWRvdy5tYXBTaXplOwogICAgICAgICAgICBzdGF0ZS5zcG90U2hhZG93W3Nwb3RMZW5ndGhdID0gc2hhZG93VW5pZm9ybXM7CiAgICAgICAgICAgIHN0YXRlLnNwb3RTaGFkb3dNYXBbc3BvdExlbmd0aF0gPSBzaGFkb3dNYXA7CiAgICAgICAgICAgIHN0YXRlLnNwb3RTaGFkb3dNYXRyaXhbc3BvdExlbmd0aF0gPSBsaWdodC5zaGFkb3cubWF0cml4OwogICAgICAgICAgICBudW1TcG90U2hhZG93cysrOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUuc3BvdFtzcG90TGVuZ3RoXSA9IHVuaWZvcm1zOwogICAgICAgICAgc3BvdExlbmd0aCsrOwogICAgICAgIH0gZWxzZSBpZiAobGlnaHQuaXNSZWN0QXJlYUxpZ2h0KSB7CiAgICAgICAgICBjb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldChsaWdodCk7CiAgICAgICAgICB1bmlmb3Jtcy5jb2xvci5jb3B5KGNvbG9yKS5tdWx0aXBseVNjYWxhcihpbnRlbnNpdHkpOwogICAgICAgICAgdW5pZm9ybXMuaGFsZldpZHRoLnNldChsaWdodC53aWR0aCAqIDAuNSwgMCwgMCk7CiAgICAgICAgICB1bmlmb3Jtcy5oYWxmSGVpZ2h0LnNldCgwLCBsaWdodC5oZWlnaHQgKiAwLjUsIDApOwogICAgICAgICAgc3RhdGUucmVjdEFyZWFbcmVjdEFyZWFMZW5ndGhdID0gdW5pZm9ybXM7CiAgICAgICAgICByZWN0QXJlYUxlbmd0aCsrOwogICAgICAgIH0gZWxzZSBpZiAobGlnaHQuaXNQb2ludExpZ2h0KSB7CiAgICAgICAgICBjb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldChsaWdodCk7CiAgICAgICAgICB1bmlmb3Jtcy5jb2xvci5jb3B5KGxpZ2h0LmNvbG9yKS5tdWx0aXBseVNjYWxhcihsaWdodC5pbnRlbnNpdHkpOwogICAgICAgICAgdW5pZm9ybXMuZGlzdGFuY2UgPSBsaWdodC5kaXN0YW5jZTsKICAgICAgICAgIHVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CiAgICAgICAgICBpZiAobGlnaHQuY2FzdFNoYWRvdykgewogICAgICAgICAgICBjb25zdCBzaGFkb3cgPSBsaWdodC5zaGFkb3c7CiAgICAgICAgICAgIGNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KGxpZ2h0KTsKICAgICAgICAgICAgc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwogICAgICAgICAgICBzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CiAgICAgICAgICAgIHNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CiAgICAgICAgICAgIHNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKICAgICAgICAgICAgc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhTmVhciA9IHNoYWRvdy5jYW1lcmEubmVhcjsKICAgICAgICAgICAgc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhRmFyID0gc2hhZG93LmNhbWVyYS5mYXI7CiAgICAgICAgICAgIHN0YXRlLnBvaW50U2hhZG93W3BvaW50TGVuZ3RoXSA9IHNoYWRvd1VuaWZvcm1zOwogICAgICAgICAgICBzdGF0ZS5wb2ludFNoYWRvd01hcFtwb2ludExlbmd0aF0gPSBzaGFkb3dNYXA7CiAgICAgICAgICAgIHN0YXRlLnBvaW50U2hhZG93TWF0cml4W3BvaW50TGVuZ3RoXSA9IGxpZ2h0LnNoYWRvdy5tYXRyaXg7CiAgICAgICAgICAgIG51bVBvaW50U2hhZG93cysrOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUucG9pbnRbcG9pbnRMZW5ndGhdID0gdW5pZm9ybXM7CiAgICAgICAgICBwb2ludExlbmd0aCsrOwogICAgICAgIH0gZWxzZSBpZiAobGlnaHQuaXNIZW1pc3BoZXJlTGlnaHQpIHsKICAgICAgICAgIGNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KGxpZ2h0KTsKICAgICAgICAgIHVuaWZvcm1zLnNreUNvbG9yLmNvcHkobGlnaHQuY29sb3IpLm11bHRpcGx5U2NhbGFyKGludGVuc2l0eSk7CiAgICAgICAgICB1bmlmb3Jtcy5ncm91bmRDb2xvci5jb3B5KGxpZ2h0Lmdyb3VuZENvbG9yKS5tdWx0aXBseVNjYWxhcihpbnRlbnNpdHkpOwogICAgICAgICAgc3RhdGUuaGVtaVtoZW1pTGVuZ3RoXSA9IHVuaWZvcm1zOwogICAgICAgICAgaGVtaUxlbmd0aCsrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocmVjdEFyZWFMZW5ndGggPiAwKSB7CiAgICAgICAgaWYgKGNhcGFiaWxpdGllcy5pc1dlYkdMMikgewogICAgICAgICAgc3RhdGUucmVjdEFyZWFMVEMxID0gVW5pZm9ybXNMaWIuTFRDX0ZMT0FUXzE7CiAgICAgICAgICBzdGF0ZS5yZWN0QXJlYUxUQzIgPSBVbmlmb3Jtc0xpYi5MVENfRkxPQVRfMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGV4dGVuc2lvbnMuaGFzKCJPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXIiKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBzdGF0ZS5yZWN0QXJlYUxUQzEgPSBVbmlmb3Jtc0xpYi5MVENfRkxPQVRfMTsKICAgICAgICAgICAgc3RhdGUucmVjdEFyZWFMVEMyID0gVW5pZm9ybXNMaWIuTFRDX0ZMT0FUXzI7CiAgICAgICAgICB9IGVsc2UgaWYgKGV4dGVuc2lvbnMuaGFzKCJPRVNfdGV4dHVyZV9oYWxmX2Zsb2F0X2xpbmVhciIpID09PSB0cnVlKSB7CiAgICAgICAgICAgIHN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19IQUxGXzE7CiAgICAgICAgICAgIHN0YXRlLnJlY3RBcmVhTFRDMiA9IFVuaWZvcm1zTGliLkxUQ19IQUxGXzI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiBVbmFibGUgdG8gdXNlIFJlY3RBcmVhTGlnaHQuIE1pc3NpbmcgV2ViR0wgZXh0ZW5zaW9ucy4iKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgc3RhdGUuYW1iaWVudFswXSA9IHI7CiAgICAgIHN0YXRlLmFtYmllbnRbMV0gPSBnOwogICAgICBzdGF0ZS5hbWJpZW50WzJdID0gYjsKICAgICAgY29uc3QgaGFzaCA9IHN0YXRlLmhhc2g7CiAgICAgIGlmIChoYXNoLmRpcmVjdGlvbmFsTGVuZ3RoICE9PSBkaXJlY3Rpb25hbExlbmd0aCB8fCBoYXNoLnBvaW50TGVuZ3RoICE9PSBwb2ludExlbmd0aCB8fCBoYXNoLnNwb3RMZW5ndGggIT09IHNwb3RMZW5ndGggfHwgaGFzaC5yZWN0QXJlYUxlbmd0aCAhPT0gcmVjdEFyZWFMZW5ndGggfHwgaGFzaC5oZW1pTGVuZ3RoICE9PSBoZW1pTGVuZ3RoIHx8IGhhc2gubnVtRGlyZWN0aW9uYWxTaGFkb3dzICE9PSBudW1EaXJlY3Rpb25hbFNoYWRvd3MgfHwgaGFzaC5udW1Qb2ludFNoYWRvd3MgIT09IG51bVBvaW50U2hhZG93cyB8fCBoYXNoLm51bVNwb3RTaGFkb3dzICE9PSBudW1TcG90U2hhZG93cykgewogICAgICAgIHN0YXRlLmRpcmVjdGlvbmFsLmxlbmd0aCA9IGRpcmVjdGlvbmFsTGVuZ3RoOwogICAgICAgIHN0YXRlLnNwb3QubGVuZ3RoID0gc3BvdExlbmd0aDsKICAgICAgICBzdGF0ZS5yZWN0QXJlYS5sZW5ndGggPSByZWN0QXJlYUxlbmd0aDsKICAgICAgICBzdGF0ZS5wb2ludC5sZW5ndGggPSBwb2ludExlbmd0aDsKICAgICAgICBzdGF0ZS5oZW1pLmxlbmd0aCA9IGhlbWlMZW5ndGg7CiAgICAgICAgc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3cubGVuZ3RoID0gbnVtRGlyZWN0aW9uYWxTaGFkb3dzOwogICAgICAgIHN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwLmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKICAgICAgICBzdGF0ZS5wb2ludFNoYWRvdy5sZW5ndGggPSBudW1Qb2ludFNoYWRvd3M7CiAgICAgICAgc3RhdGUucG9pbnRTaGFkb3dNYXAubGVuZ3RoID0gbnVtUG9pbnRTaGFkb3dzOwogICAgICAgIHN0YXRlLnNwb3RTaGFkb3cubGVuZ3RoID0gbnVtU3BvdFNoYWRvd3M7CiAgICAgICAgc3RhdGUuc3BvdFNoYWRvd01hcC5sZW5ndGggPSBudW1TcG90U2hhZG93czsKICAgICAgICBzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hdHJpeC5sZW5ndGggPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CiAgICAgICAgc3RhdGUucG9pbnRTaGFkb3dNYXRyaXgubGVuZ3RoID0gbnVtUG9pbnRTaGFkb3dzOwogICAgICAgIHN0YXRlLnNwb3RTaGFkb3dNYXRyaXgubGVuZ3RoID0gbnVtU3BvdFNoYWRvd3M7CiAgICAgICAgaGFzaC5kaXJlY3Rpb25hbExlbmd0aCA9IGRpcmVjdGlvbmFsTGVuZ3RoOwogICAgICAgIGhhc2gucG9pbnRMZW5ndGggPSBwb2ludExlbmd0aDsKICAgICAgICBoYXNoLnNwb3RMZW5ndGggPSBzcG90TGVuZ3RoOwogICAgICAgIGhhc2gucmVjdEFyZWFMZW5ndGggPSByZWN0QXJlYUxlbmd0aDsKICAgICAgICBoYXNoLmhlbWlMZW5ndGggPSBoZW1pTGVuZ3RoOwogICAgICAgIGhhc2gubnVtRGlyZWN0aW9uYWxTaGFkb3dzID0gbnVtRGlyZWN0aW9uYWxTaGFkb3dzOwogICAgICAgIGhhc2gubnVtUG9pbnRTaGFkb3dzID0gbnVtUG9pbnRTaGFkb3dzOwogICAgICAgIGhhc2gubnVtU3BvdFNoYWRvd3MgPSBudW1TcG90U2hhZG93czsKICAgICAgICBzdGF0ZS52ZXJzaW9uID0gbmV4dFZlcnNpb24rKzsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2V0dXBWaWV3KGxpZ2h0cywgY2FtZXJhKSB7CiAgICAgIGxldCBkaXJlY3Rpb25hbExlbmd0aCA9IDA7CiAgICAgIGxldCBwb2ludExlbmd0aCA9IDA7CiAgICAgIGxldCBzcG90TGVuZ3RoID0gMDsKICAgICAgbGV0IHJlY3RBcmVhTGVuZ3RoID0gMDsKICAgICAgbGV0IGhlbWlMZW5ndGggPSAwOwogICAgICBjb25zdCB2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBsaWdodHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgbGlnaHQgPSBsaWdodHNbaV07CiAgICAgICAgaWYgKGxpZ2h0LmlzRGlyZWN0aW9uYWxMaWdodCkgewogICAgICAgICAgY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5kaXJlY3Rpb25hbFtkaXJlY3Rpb25hbExlbmd0aF07CiAgICAgICAgICB1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKGxpZ2h0Lm1hdHJpeFdvcmxkKTsKICAgICAgICAgIHZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKGxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCk7CiAgICAgICAgICB1bmlmb3Jtcy5kaXJlY3Rpb24uc3ViKHZlY3RvcjMpOwogICAgICAgICAgdW5pZm9ybXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbih2aWV3TWF0cml4KTsKICAgICAgICAgIGRpcmVjdGlvbmFsTGVuZ3RoKys7CiAgICAgICAgfSBlbHNlIGlmIChsaWdodC5pc1Nwb3RMaWdodCkgewogICAgICAgICAgY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5zcG90W3Nwb3RMZW5ndGhdOwogICAgICAgICAgdW5pZm9ybXMucG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKGxpZ2h0Lm1hdHJpeFdvcmxkKTsKICAgICAgICAgIHVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCh2aWV3TWF0cml4KTsKICAgICAgICAgIHVuaWZvcm1zLmRpcmVjdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24obGlnaHQubWF0cml4V29ybGQpOwogICAgICAgICAgdmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24obGlnaHQudGFyZ2V0Lm1hdHJpeFdvcmxkKTsKICAgICAgICAgIHVuaWZvcm1zLmRpcmVjdGlvbi5zdWIodmVjdG9yMyk7CiAgICAgICAgICB1bmlmb3Jtcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKHZpZXdNYXRyaXgpOwogICAgICAgICAgc3BvdExlbmd0aCsrOwogICAgICAgIH0gZWxzZSBpZiAobGlnaHQuaXNSZWN0QXJlYUxpZ2h0KSB7CiAgICAgICAgICBjb25zdCB1bmlmb3JtcyA9IHN0YXRlLnJlY3RBcmVhW3JlY3RBcmVhTGVuZ3RoXTsKICAgICAgICAgIHVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbihsaWdodC5tYXRyaXhXb3JsZCk7CiAgICAgICAgICB1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQodmlld01hdHJpeCk7CiAgICAgICAgICBtYXRyaXg0Mi5pZGVudGl0eSgpOwogICAgICAgICAgbWF0cml4NC5jb3B5KGxpZ2h0Lm1hdHJpeFdvcmxkKTsKICAgICAgICAgIG1hdHJpeDQucHJlbXVsdGlwbHkodmlld01hdHJpeCk7CiAgICAgICAgICBtYXRyaXg0Mi5leHRyYWN0Um90YXRpb24obWF0cml4NCk7CiAgICAgICAgICB1bmlmb3Jtcy5oYWxmV2lkdGguc2V0KGxpZ2h0LndpZHRoICogMC41LCAwLCAwKTsKICAgICAgICAgIHVuaWZvcm1zLmhhbGZIZWlnaHQuc2V0KDAsIGxpZ2h0LmhlaWdodCAqIDAuNSwgMCk7CiAgICAgICAgICB1bmlmb3Jtcy5oYWxmV2lkdGguYXBwbHlNYXRyaXg0KG1hdHJpeDQyKTsKICAgICAgICAgIHVuaWZvcm1zLmhhbGZIZWlnaHQuYXBwbHlNYXRyaXg0KG1hdHJpeDQyKTsKICAgICAgICAgIHJlY3RBcmVhTGVuZ3RoKys7CiAgICAgICAgfSBlbHNlIGlmIChsaWdodC5pc1BvaW50TGlnaHQpIHsKICAgICAgICAgIGNvbnN0IHVuaWZvcm1zID0gc3RhdGUucG9pbnRbcG9pbnRMZW5ndGhdOwogICAgICAgICAgdW5pZm9ybXMucG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKGxpZ2h0Lm1hdHJpeFdvcmxkKTsKICAgICAgICAgIHVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCh2aWV3TWF0cml4KTsKICAgICAgICAgIHBvaW50TGVuZ3RoKys7CiAgICAgICAgfSBlbHNlIGlmIChsaWdodC5pc0hlbWlzcGhlcmVMaWdodCkgewogICAgICAgICAgY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5oZW1pW2hlbWlMZW5ndGhdOwogICAgICAgICAgdW5pZm9ybXMuZGlyZWN0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbihsaWdodC5tYXRyaXhXb3JsZCk7CiAgICAgICAgICB1bmlmb3Jtcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKHZpZXdNYXRyaXgpOwogICAgICAgICAgdW5pZm9ybXMuZGlyZWN0aW9uLm5vcm1hbGl6ZSgpOwogICAgICAgICAgaGVtaUxlbmd0aCsrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgc2V0dXAsCiAgICAgIHNldHVwVmlldywKICAgICAgc3RhdGUKICAgIH07CiAgfQogIGZ1bmN0aW9uIFdlYkdMUmVuZGVyU3RhdGUoZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzKSB7CiAgICBjb25zdCBsaWdodHMgPSBuZXcgV2ViR0xMaWdodHMoZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzKTsKICAgIGNvbnN0IGxpZ2h0c0FycmF5ID0gW107CiAgICBjb25zdCBzaGFkb3dzQXJyYXkgPSBbXTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgIGxpZ2h0c0FycmF5Lmxlbmd0aCA9IDA7CiAgICAgIHNoYWRvd3NBcnJheS5sZW5ndGggPSAwOwogICAgfQogICAgZnVuY3Rpb24gcHVzaExpZ2h0KGxpZ2h0KSB7CiAgICAgIGxpZ2h0c0FycmF5LnB1c2gobGlnaHQpOwogICAgfQogICAgZnVuY3Rpb24gcHVzaFNoYWRvdyhzaGFkb3dMaWdodCkgewogICAgICBzaGFkb3dzQXJyYXkucHVzaChzaGFkb3dMaWdodCk7CiAgICB9CiAgICBmdW5jdGlvbiBzZXR1cExpZ2h0cygpIHsKICAgICAgbGlnaHRzLnNldHVwKGxpZ2h0c0FycmF5KTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldHVwTGlnaHRzVmlldyhjYW1lcmEpIHsKICAgICAgbGlnaHRzLnNldHVwVmlldyhsaWdodHNBcnJheSwgY2FtZXJhKTsKICAgIH0KICAgIGNvbnN0IHN0YXRlID0gewogICAgICBsaWdodHNBcnJheSwKICAgICAgc2hhZG93c0FycmF5LAogICAgICBsaWdodHMKICAgIH07CiAgICByZXR1cm4gewogICAgICBpbml0LAogICAgICBzdGF0ZSwKICAgICAgc2V0dXBMaWdodHMsCiAgICAgIHNldHVwTGlnaHRzVmlldywKICAgICAgcHVzaExpZ2h0LAogICAgICBwdXNoU2hhZG93CiAgICB9OwogIH0KICBmdW5jdGlvbiBXZWJHTFJlbmRlclN0YXRlcyhleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMpIHsKICAgIGxldCByZW5kZXJTdGF0ZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtNYXAoKTsKICAgIGZ1bmN0aW9uIGdldChzY2VuZSwgcmVuZGVyQ2FsbERlcHRoID0gMCkgewogICAgICBsZXQgcmVuZGVyU3RhdGU7CiAgICAgIGlmIChyZW5kZXJTdGF0ZXMuaGFzKHNjZW5lKSA9PT0gZmFsc2UpIHsKICAgICAgICByZW5kZXJTdGF0ZSA9IG5ldyBXZWJHTFJlbmRlclN0YXRlKGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyk7CiAgICAgICAgcmVuZGVyU3RhdGVzLnNldChzY2VuZSwgW3JlbmRlclN0YXRlXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHJlbmRlckNhbGxEZXB0aCA+PSByZW5kZXJTdGF0ZXMuZ2V0KHNjZW5lKS5sZW5ndGgpIHsKICAgICAgICAgIHJlbmRlclN0YXRlID0gbmV3IFdlYkdMUmVuZGVyU3RhdGUoZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzKTsKICAgICAgICAgIHJlbmRlclN0YXRlcy5nZXQoc2NlbmUpLnB1c2gocmVuZGVyU3RhdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlcy5nZXQoc2NlbmUpW3JlbmRlckNhbGxEZXB0aF07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZW5kZXJTdGF0ZTsKICAgIH0KICAgIGZ1bmN0aW9uIGRpc3Bvc2UoKSB7CiAgICAgIHJlbmRlclN0YXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgZ2V0LAogICAgICBkaXNwb3NlCiAgICB9OwogIH0KICB2YXIgTWVzaERlcHRoTWF0ZXJpYWwgPSBjbGFzcyBleHRlbmRzIE1hdGVyaWFsIHsKICAgIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIk1lc2hEZXB0aE1hdGVyaWFsIjsKICAgICAgdGhpcy5kZXB0aFBhY2tpbmcgPSBCYXNpY0RlcHRoUGFja2luZzsKICAgICAgdGhpcy5tb3JwaFRhcmdldHMgPSBmYWxzZTsKICAgICAgdGhpcy5tYXAgPSBudWxsOwogICAgICB0aGlzLmFscGhhTWFwID0gbnVsbDsKICAgICAgdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwogICAgICB0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gMTsKICAgICAgdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKICAgICAgdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwogICAgICB0aGlzLmZvZyA9IGZhbHNlOwogICAgICB0aGlzLnNldFZhbHVlcyhwYXJhbWV0ZXJzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5kZXB0aFBhY2tpbmcgPSBzb3VyY2UuZGVwdGhQYWNraW5nOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CiAgICAgIHRoaXMubWFwID0gc291cmNlLm1hcDsKICAgICAgdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKICAgICAgdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwogICAgICB0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwogICAgICB0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSBzb3VyY2UuZGlzcGxhY2VtZW50QmlhczsKICAgICAgdGhpcy53aXJlZnJhbWUgPSBzb3VyY2Uud2lyZWZyYW1lOwogICAgICB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgTWVzaERlcHRoTWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaERlcHRoTWF0ZXJpYWwgPSB0cnVlOwogIHZhciBNZXNoRGlzdGFuY2VNYXRlcmlhbCA9IGNsYXNzIGV4dGVuZHMgTWF0ZXJpYWwgewogICAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiTWVzaERpc3RhbmNlTWF0ZXJpYWwiOwogICAgICB0aGlzLnJlZmVyZW5jZVBvc2l0aW9uID0gbmV3IFZlY3RvcjMoKTsKICAgICAgdGhpcy5uZWFyRGlzdGFuY2UgPSAxOwogICAgICB0aGlzLmZhckRpc3RhbmNlID0gMWUzOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IGZhbHNlOwogICAgICB0aGlzLm1hcCA9IG51bGw7CiAgICAgIHRoaXMuYWxwaGFNYXAgPSBudWxsOwogICAgICB0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwogICAgICB0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSAwOwogICAgICB0aGlzLmZvZyA9IGZhbHNlOwogICAgICB0aGlzLnNldFZhbHVlcyhwYXJhbWV0ZXJzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5yZWZlcmVuY2VQb3NpdGlvbi5jb3B5KHNvdXJjZS5yZWZlcmVuY2VQb3NpdGlvbik7CiAgICAgIHRoaXMubmVhckRpc3RhbmNlID0gc291cmNlLm5lYXJEaXN0YW5jZTsKICAgICAgdGhpcy5mYXJEaXN0YW5jZSA9IHNvdXJjZS5mYXJEaXN0YW5jZTsKICAgICAgdGhpcy5tb3JwaFRhcmdldHMgPSBzb3VyY2UubW9ycGhUYXJnZXRzOwogICAgICB0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CiAgICAgIHRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKICAgICAgdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKICAgICAgdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgTWVzaERpc3RhbmNlTWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaERpc3RhbmNlTWF0ZXJpYWwgPSB0cnVlOwogIHZhciB2c21fZnJhZyA9ICJ1bmlmb3JtIHNhbXBsZXIyRCBzaGFkb3dfcGFzcztcbnVuaWZvcm0gdmVjMiByZXNvbHV0aW9uO1xudW5pZm9ybSBmbG9hdCByYWRpdXM7XG4jaW5jbHVkZSA8cGFja2luZz5cbnZvaWQgbWFpbigpIHtcbglmbG9hdCBtZWFuID0gMC4wO1xuCWZsb2F0IHNxdWFyZWRfbWVhbiA9IDAuMDtcbglmbG9hdCBkZXB0aCA9IHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSApIC8gcmVzb2x1dGlvbiApICk7XG4JZm9yICggZmxvYXQgaSA9IC0xLjA7IGkgPCAxLjAgOyBpICs9IFNBTVBMRV9SQVRFKSB7XG4JCSNpZmRlZiBIT1JJWk9OVEFMX1BBU1NcbgkJCXZlYzIgZGlzdHJpYnV0aW9uID0gdW5wYWNrUkdCQVRvMkhhbGYoIHRleHR1cmUyRCggc2hhZG93X3Bhc3MsICggZ2xfRnJhZ0Nvb3JkLnh5ICsgdmVjMiggaSwgMC4wICkgKiByYWRpdXMgKSAvIHJlc29sdXRpb24gKSApO1xuCQkJbWVhbiArPSBkaXN0cmlidXRpb24ueDtcbgkJCXNxdWFyZWRfbWVhbiArPSBkaXN0cmlidXRpb24ueSAqIGRpc3RyaWJ1dGlvbi55ICsgZGlzdHJpYnV0aW9uLnggKiBkaXN0cmlidXRpb24ueDtcbgkJI2Vsc2VcbgkJCWZsb2F0IGRlcHRoID0gdW5wYWNrUkdCQVRvRGVwdGgoIHRleHR1cmUyRCggc2hhZG93X3Bhc3MsICggZ2xfRnJhZ0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBpICkgKiByYWRpdXMgKSAvIHJlc29sdXRpb24gKSApO1xuCQkJbWVhbiArPSBkZXB0aDtcbgkJCXNxdWFyZWRfbWVhbiArPSBkZXB0aCAqIGRlcHRoO1xuCQkjZW5kaWZcbgl9XG4JbWVhbiA9IG1lYW4gKiBIQUxGX1NBTVBMRV9SQVRFO1xuCXNxdWFyZWRfbWVhbiA9IHNxdWFyZWRfbWVhbiAqIEhBTEZfU0FNUExFX1JBVEU7XG4JZmxvYXQgc3RkX2RldiA9IHNxcnQoIHNxdWFyZWRfbWVhbiAtIG1lYW4gKiBtZWFuICk7XG4JZ2xfRnJhZ0NvbG9yID0gcGFjazJIYWxmVG9SR0JBKCB2ZWMyKCBtZWFuLCBzdGRfZGV2ICkgKTtcbn0iOwogIHZhciB2c21fdmVydCA9ICJ2b2lkIG1haW4oKSB7XG4JZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7XG59IjsKICBmdW5jdGlvbiBXZWJHTFNoYWRvd01hcChfcmVuZGVyZXIsIF9vYmplY3RzLCBfY2FwYWJpbGl0aWVzKSB7CiAgICBsZXQgX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwogICAgY29uc3QgX3NoYWRvd01hcFNpemUgPSBuZXcgVmVjdG9yMigpLCBfdmlld3BvcnRTaXplID0gbmV3IFZlY3RvcjIoKSwgX3ZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKSwgX2RlcHRoTWF0ZXJpYWxzID0gW10sIF9kaXN0YW5jZU1hdGVyaWFscyA9IFtdLCBfbWF0ZXJpYWxDYWNoZSA9IHt9LCBfbWF4VGV4dHVyZVNpemUgPSBfY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplOwogICAgY29uc3Qgc2hhZG93U2lkZSA9IHsgMDogQmFja1NpZGUsIDE6IEZyb250U2lkZSwgMjogRG91YmxlU2lkZSB9OwogICAgY29uc3Qgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCh7CiAgICAgIGRlZmluZXM6IHsKICAgICAgICBTQU1QTEVfUkFURTogMiAvIDgsCiAgICAgICAgSEFMRl9TQU1QTEVfUkFURTogMSAvIDgKICAgICAgfSwKICAgICAgdW5pZm9ybXM6IHsKICAgICAgICBzaGFkb3dfcGFzczogeyB2YWx1ZTogbnVsbCB9LAogICAgICAgIHJlc29sdXRpb246IHsgdmFsdWU6IG5ldyBWZWN0b3IyKCkgfSwKICAgICAgICByYWRpdXM6IHsgdmFsdWU6IDQgfQogICAgICB9LAogICAgICB2ZXJ0ZXhTaGFkZXI6IHZzbV92ZXJ0LAogICAgICBmcmFnbWVudFNoYWRlcjogdnNtX2ZyYWcKICAgIH0pOwogICAgY29uc3Qgc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsID0gc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5jbG9uZSgpOwogICAgc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLmRlZmluZXMuSE9SSVpPTlRBTF9QQVNTID0gMTsKICAgIGNvbnN0IGZ1bGxTY3JlZW5UcmkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKICAgIGZ1bGxTY3JlZW5Ucmkuc2V0QXR0cmlidXRlKCJwb3NpdGlvbiIsIG5ldyBCdWZmZXJBdHRyaWJ1dGUobmV3IEZsb2F0MzJBcnJheShbLTEsIC0xLCAwLjUsIDMsIC0xLCAwLjUsIC0xLCAzLCAwLjVdKSwgMykpOwogICAgY29uc3QgZnVsbFNjcmVlbk1lc2ggPSBuZXcgTWVzaChmdWxsU2NyZWVuVHJpLCBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsKTsKICAgIGNvbnN0IHNjb3BlID0gdGhpczsKICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlOwogICAgdGhpcy5hdXRvVXBkYXRlID0gdHJ1ZTsKICAgIHRoaXMubmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIHRoaXMudHlwZSA9IFBDRlNoYWRvd01hcDsKICAgIHRoaXMucmVuZGVyID0gZnVuY3Rpb24obGlnaHRzLCBzY2VuZSwgY2FtZXJhKSB7CiAgICAgIGlmIChzY29wZS5lbmFibGVkID09PSBmYWxzZSkKICAgICAgICByZXR1cm47CiAgICAgIGlmIChzY29wZS5hdXRvVXBkYXRlID09PSBmYWxzZSAmJiBzY29wZS5uZWVkc1VwZGF0ZSA9PT0gZmFsc2UpCiAgICAgICAgcmV0dXJuOwogICAgICBpZiAobGlnaHRzLmxlbmd0aCA9PT0gMCkKICAgICAgICByZXR1cm47CiAgICAgIGNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSBfcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAgIGNvbnN0IGFjdGl2ZUN1YmVGYWNlID0gX3JlbmRlcmVyLmdldEFjdGl2ZUN1YmVGYWNlKCk7CiAgICAgIGNvbnN0IGFjdGl2ZU1pcG1hcExldmVsID0gX3JlbmRlcmVyLmdldEFjdGl2ZU1pcG1hcExldmVsKCk7CiAgICAgIGNvbnN0IF9zdGF0ZSA9IF9yZW5kZXJlci5zdGF0ZTsKICAgICAgX3N0YXRlLnNldEJsZW5kaW5nKE5vQmxlbmRpbmcpOwogICAgICBfc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhcigxLCAxLCAxLCAxKTsKICAgICAgX3N0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0VGVzdCh0cnVlKTsKICAgICAgX3N0YXRlLnNldFNjaXNzb3JUZXN0KGZhbHNlKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gbGlnaHRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICBjb25zdCBsaWdodCA9IGxpZ2h0c1tpXTsKICAgICAgICBjb25zdCBzaGFkb3cgPSBsaWdodC5zaGFkb3c7CiAgICAgICAgaWYgKHNoYWRvdyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMU2hhZG93TWFwOiIsIGxpZ2h0LCAiaGFzIG5vIHNoYWRvdy4iKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoc2hhZG93LmF1dG9VcGRhdGUgPT09IGZhbHNlICYmIHNoYWRvdy5uZWVkc1VwZGF0ZSA9PT0gZmFsc2UpCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICBfc2hhZG93TWFwU2l6ZS5jb3B5KHNoYWRvdy5tYXBTaXplKTsKICAgICAgICBjb25zdCBzaGFkb3dGcmFtZUV4dGVudHMgPSBzaGFkb3cuZ2V0RnJhbWVFeHRlbnRzKCk7CiAgICAgICAgX3NoYWRvd01hcFNpemUubXVsdGlwbHkoc2hhZG93RnJhbWVFeHRlbnRzKTsKICAgICAgICBfdmlld3BvcnRTaXplLmNvcHkoc2hhZG93Lm1hcFNpemUpOwogICAgICAgIGlmIChfc2hhZG93TWFwU2l6ZS54ID4gX21heFRleHR1cmVTaXplIHx8IF9zaGFkb3dNYXBTaXplLnkgPiBfbWF4VGV4dHVyZVNpemUpIHsKICAgICAgICAgIGlmIChfc2hhZG93TWFwU2l6ZS54ID4gX21heFRleHR1cmVTaXplKSB7CiAgICAgICAgICAgIF92aWV3cG9ydFNpemUueCA9IE1hdGguZmxvb3IoX21heFRleHR1cmVTaXplIC8gc2hhZG93RnJhbWVFeHRlbnRzLngpOwogICAgICAgICAgICBfc2hhZG93TWFwU2l6ZS54ID0gX3ZpZXdwb3J0U2l6ZS54ICogc2hhZG93RnJhbWVFeHRlbnRzLng7CiAgICAgICAgICAgIHNoYWRvdy5tYXBTaXplLnggPSBfdmlld3BvcnRTaXplLng7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoX3NoYWRvd01hcFNpemUueSA+IF9tYXhUZXh0dXJlU2l6ZSkgewogICAgICAgICAgICBfdmlld3BvcnRTaXplLnkgPSBNYXRoLmZsb29yKF9tYXhUZXh0dXJlU2l6ZSAvIHNoYWRvd0ZyYW1lRXh0ZW50cy55KTsKICAgICAgICAgICAgX3NoYWRvd01hcFNpemUueSA9IF92aWV3cG9ydFNpemUueSAqIHNoYWRvd0ZyYW1lRXh0ZW50cy55OwogICAgICAgICAgICBzaGFkb3cubWFwU2l6ZS55ID0gX3ZpZXdwb3J0U2l6ZS55OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc2hhZG93Lm1hcCA9PT0gbnVsbCAmJiAhc2hhZG93LmlzUG9pbnRMaWdodFNoYWRvdyAmJiB0aGlzLnR5cGUgPT09IFZTTVNoYWRvd01hcCkgewogICAgICAgICAgY29uc3QgcGFycyA9IHsgbWluRmlsdGVyOiBMaW5lYXJGaWx0ZXIsIG1hZ0ZpbHRlcjogTGluZWFyRmlsdGVyLCBmb3JtYXQ6IFJHQkFGb3JtYXQgfTsKICAgICAgICAgIHNoYWRvdy5tYXAgPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoX3NoYWRvd01hcFNpemUueCwgX3NoYWRvd01hcFNpemUueSwgcGFycyk7CiAgICAgICAgICBzaGFkb3cubWFwLnRleHR1cmUubmFtZSA9IGxpZ2h0Lm5hbWUgKyAiLnNoYWRvd01hcCI7CiAgICAgICAgICBzaGFkb3cubWFwUGFzcyA9IG5ldyBXZWJHTFJlbmRlclRhcmdldChfc2hhZG93TWFwU2l6ZS54LCBfc2hhZG93TWFwU2l6ZS55LCBwYXJzKTsKICAgICAgICAgIHNoYWRvdy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwogICAgICAgIH0KICAgICAgICBpZiAoc2hhZG93Lm1hcCA9PT0gbnVsbCkgewogICAgICAgICAgY29uc3QgcGFycyA9IHsgbWluRmlsdGVyOiBOZWFyZXN0RmlsdGVyLCBtYWdGaWx0ZXI6IE5lYXJlc3RGaWx0ZXIsIGZvcm1hdDogUkdCQUZvcm1hdCB9OwogICAgICAgICAgc2hhZG93Lm1hcCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldChfc2hhZG93TWFwU2l6ZS54LCBfc2hhZG93TWFwU2l6ZS55LCBwYXJzKTsKICAgICAgICAgIHNoYWRvdy5tYXAudGV4dHVyZS5uYW1lID0gbGlnaHQubmFtZSArICIuc2hhZG93TWFwIjsKICAgICAgICAgIHNoYWRvdy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwogICAgICAgIH0KICAgICAgICBfcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KHNoYWRvdy5tYXApOwogICAgICAgIF9yZW5kZXJlci5jbGVhcigpOwogICAgICAgIGNvbnN0IHZpZXdwb3J0Q291bnQgPSBzaGFkb3cuZ2V0Vmlld3BvcnRDb3VudCgpOwogICAgICAgIGZvciAobGV0IHZwID0gMDsgdnAgPCB2aWV3cG9ydENvdW50OyB2cCsrKSB7CiAgICAgICAgICBjb25zdCB2aWV3cG9ydCA9IHNoYWRvdy5nZXRWaWV3cG9ydCh2cCk7CiAgICAgICAgICBfdmlld3BvcnQuc2V0KF92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LngsIF92aWV3cG9ydFNpemUueSAqIHZpZXdwb3J0LnksIF92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LnosIF92aWV3cG9ydFNpemUueSAqIHZpZXdwb3J0LncpOwogICAgICAgICAgX3N0YXRlLnZpZXdwb3J0KF92aWV3cG9ydCk7CiAgICAgICAgICBzaGFkb3cudXBkYXRlTWF0cmljZXMobGlnaHQsIHZwKTsKICAgICAgICAgIF9mcnVzdHVtID0gc2hhZG93LmdldEZydXN0dW0oKTsKICAgICAgICAgIHJlbmRlck9iamVjdChzY2VuZSwgY2FtZXJhLCBzaGFkb3cuY2FtZXJhLCBsaWdodCwgdGhpcy50eXBlKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzaGFkb3cuaXNQb2ludExpZ2h0U2hhZG93ICYmIHRoaXMudHlwZSA9PT0gVlNNU2hhZG93TWFwKSB7CiAgICAgICAgICBWU01QYXNzKHNoYWRvdywgY2FtZXJhKTsKICAgICAgICB9CiAgICAgICAgc2hhZG93Lm5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICAgIH0KICAgICAgc2NvcGUubmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgICAgX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldChjdXJyZW50UmVuZGVyVGFyZ2V0LCBhY3RpdmVDdWJlRmFjZSwgYWN0aXZlTWlwbWFwTGV2ZWwpOwogICAgfTsKICAgIGZ1bmN0aW9uIFZTTVBhc3Moc2hhZG93LCBjYW1lcmEpIHsKICAgICAgY29uc3QgZ2VvbWV0cnkgPSBfb2JqZWN0cy51cGRhdGUoZnVsbFNjcmVlbk1lc2gpOwogICAgICBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLnVuaWZvcm1zLnNoYWRvd19wYXNzLnZhbHVlID0gc2hhZG93Lm1hcC50ZXh0dXJlOwogICAgICBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLnVuaWZvcm1zLnJlc29sdXRpb24udmFsdWUgPSBzaGFkb3cubWFwU2l6ZTsKICAgICAgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC51bmlmb3Jtcy5yYWRpdXMudmFsdWUgPSBzaGFkb3cucmFkaXVzOwogICAgICBfcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KHNoYWRvdy5tYXBQYXNzKTsKICAgICAgX3JlbmRlcmVyLmNsZWFyKCk7CiAgICAgIF9yZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoY2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbCwgZnVsbFNjcmVlbk1lc2gsIG51bGwpOwogICAgICBzaGFkb3dNYXRlcmlhbEhvcml6b250YWwudW5pZm9ybXMuc2hhZG93X3Bhc3MudmFsdWUgPSBzaGFkb3cubWFwUGFzcy50ZXh0dXJlOwogICAgICBzaGFkb3dNYXRlcmlhbEhvcml6b250YWwudW5pZm9ybXMucmVzb2x1dGlvbi52YWx1ZSA9IHNoYWRvdy5tYXBTaXplOwogICAgICBzaGFkb3dNYXRlcmlhbEhvcml6b250YWwudW5pZm9ybXMucmFkaXVzLnZhbHVlID0gc2hhZG93LnJhZGl1czsKICAgICAgX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldChzaGFkb3cubWFwKTsKICAgICAgX3JlbmRlcmVyLmNsZWFyKCk7CiAgICAgIF9yZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoY2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLCBmdWxsU2NyZWVuTWVzaCwgbnVsbCk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXREZXB0aE1hdGVyaWFsVmFyaWFudCh1c2VNb3JwaGluZykgewogICAgICBjb25zdCBpbmRleCA9IHVzZU1vcnBoaW5nIDw8IDA7CiAgICAgIGxldCBtYXRlcmlhbCA9IF9kZXB0aE1hdGVyaWFsc1tpbmRleF07CiAgICAgIGlmIChtYXRlcmlhbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF0ZXJpYWwgPSBuZXcgTWVzaERlcHRoTWF0ZXJpYWwoewogICAgICAgICAgZGVwdGhQYWNraW5nOiBSR0JBRGVwdGhQYWNraW5nLAogICAgICAgICAgbW9ycGhUYXJnZXRzOiB1c2VNb3JwaGluZwogICAgICAgIH0pOwogICAgICAgIF9kZXB0aE1hdGVyaWFsc1tpbmRleF0gPSBtYXRlcmlhbDsKICAgICAgfQogICAgICByZXR1cm4gbWF0ZXJpYWw7CiAgICB9CiAgICBmdW5jdGlvbiBnZXREaXN0YW5jZU1hdGVyaWFsVmFyaWFudCh1c2VNb3JwaGluZykgewogICAgICBjb25zdCBpbmRleCA9IHVzZU1vcnBoaW5nIDw8IDA7CiAgICAgIGxldCBtYXRlcmlhbCA9IF9kaXN0YW5jZU1hdGVyaWFsc1tpbmRleF07CiAgICAgIGlmIChtYXRlcmlhbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF0ZXJpYWwgPSBuZXcgTWVzaERpc3RhbmNlTWF0ZXJpYWwoewogICAgICAgICAgbW9ycGhUYXJnZXRzOiB1c2VNb3JwaGluZwogICAgICAgIH0pOwogICAgICAgIF9kaXN0YW5jZU1hdGVyaWFsc1tpbmRleF0gPSBtYXRlcmlhbDsKICAgICAgfQogICAgICByZXR1cm4gbWF0ZXJpYWw7CiAgICB9CiAgICBmdW5jdGlvbiBnZXREZXB0aE1hdGVyaWFsKG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBsaWdodCwgc2hhZG93Q2FtZXJhTmVhciwgc2hhZG93Q2FtZXJhRmFyLCB0eXBlKSB7CiAgICAgIGxldCByZXN1bHQgPSBudWxsOwogICAgICBsZXQgZ2V0TWF0ZXJpYWxWYXJpYW50ID0gZ2V0RGVwdGhNYXRlcmlhbFZhcmlhbnQ7CiAgICAgIGxldCBjdXN0b21NYXRlcmlhbCA9IG9iamVjdC5jdXN0b21EZXB0aE1hdGVyaWFsOwogICAgICBpZiAobGlnaHQuaXNQb2ludExpZ2h0ID09PSB0cnVlKSB7CiAgICAgICAgZ2V0TWF0ZXJpYWxWYXJpYW50ID0gZ2V0RGlzdGFuY2VNYXRlcmlhbFZhcmlhbnQ7CiAgICAgICAgY3VzdG9tTWF0ZXJpYWwgPSBvYmplY3QuY3VzdG9tRGlzdGFuY2VNYXRlcmlhbDsKICAgICAgfQogICAgICBpZiAoY3VzdG9tTWF0ZXJpYWwgPT09IHZvaWQgMCkgewogICAgICAgIGxldCB1c2VNb3JwaGluZyA9IGZhbHNlOwogICAgICAgIGlmIChtYXRlcmlhbC5tb3JwaFRhcmdldHMgPT09IHRydWUpIHsKICAgICAgICAgIHVzZU1vcnBoaW5nID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzICYmIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiAmJiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24ubGVuZ3RoID4gMDsKICAgICAgICB9CiAgICAgICAgcmVzdWx0ID0gZ2V0TWF0ZXJpYWxWYXJpYW50KHVzZU1vcnBoaW5nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXN1bHQgPSBjdXN0b21NYXRlcmlhbDsKICAgICAgfQogICAgICBpZiAoX3JlbmRlcmVyLmxvY2FsQ2xpcHBpbmdFbmFibGVkICYmIG1hdGVyaWFsLmNsaXBTaGFkb3dzID09PSB0cnVlICYmIG1hdGVyaWFsLmNsaXBwaW5nUGxhbmVzLmxlbmd0aCAhPT0gMCkgewogICAgICAgIGNvbnN0IGtleUEgPSByZXN1bHQudXVpZCwga2V5QiA9IG1hdGVyaWFsLnV1aWQ7CiAgICAgICAgbGV0IG1hdGVyaWFsc0ZvclZhcmlhbnQgPSBfbWF0ZXJpYWxDYWNoZVtrZXlBXTsKICAgICAgICBpZiAobWF0ZXJpYWxzRm9yVmFyaWFudCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBtYXRlcmlhbHNGb3JWYXJpYW50ID0ge307CiAgICAgICAgICBfbWF0ZXJpYWxDYWNoZVtrZXlBXSA9IG1hdGVyaWFsc0ZvclZhcmlhbnQ7CiAgICAgICAgfQogICAgICAgIGxldCBjYWNoZWRNYXRlcmlhbCA9IG1hdGVyaWFsc0ZvclZhcmlhbnRba2V5Ql07CiAgICAgICAgaWYgKGNhY2hlZE1hdGVyaWFsID09PSB2b2lkIDApIHsKICAgICAgICAgIGNhY2hlZE1hdGVyaWFsID0gcmVzdWx0LmNsb25lKCk7CiAgICAgICAgICBtYXRlcmlhbHNGb3JWYXJpYW50W2tleUJdID0gY2FjaGVkTWF0ZXJpYWw7CiAgICAgICAgfQogICAgICAgIHJlc3VsdCA9IGNhY2hlZE1hdGVyaWFsOwogICAgICB9CiAgICAgIHJlc3VsdC52aXNpYmxlID0gbWF0ZXJpYWwudmlzaWJsZTsKICAgICAgcmVzdWx0LndpcmVmcmFtZSA9IG1hdGVyaWFsLndpcmVmcmFtZTsKICAgICAgaWYgKHR5cGUgPT09IFZTTVNoYWRvd01hcCkgewogICAgICAgIHJlc3VsdC5zaWRlID0gbWF0ZXJpYWwuc2hhZG93U2lkZSAhPT0gbnVsbCA/IG1hdGVyaWFsLnNoYWRvd1NpZGUgOiBtYXRlcmlhbC5zaWRlOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdC5zaWRlID0gbWF0ZXJpYWwuc2hhZG93U2lkZSAhPT0gbnVsbCA/IG1hdGVyaWFsLnNoYWRvd1NpZGUgOiBzaGFkb3dTaWRlW21hdGVyaWFsLnNpZGVdOwogICAgICB9CiAgICAgIHJlc3VsdC5jbGlwU2hhZG93cyA9IG1hdGVyaWFsLmNsaXBTaGFkb3dzOwogICAgICByZXN1bHQuY2xpcHBpbmdQbGFuZXMgPSBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lczsKICAgICAgcmVzdWx0LmNsaXBJbnRlcnNlY3Rpb24gPSBtYXRlcmlhbC5jbGlwSW50ZXJzZWN0aW9uOwogICAgICByZXN1bHQud2lyZWZyYW1lTGluZXdpZHRoID0gbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoOwogICAgICByZXN1bHQubGluZXdpZHRoID0gbWF0ZXJpYWwubGluZXdpZHRoOwogICAgICBpZiAobGlnaHQuaXNQb2ludExpZ2h0ID09PSB0cnVlICYmIHJlc3VsdC5pc01lc2hEaXN0YW5jZU1hdGVyaWFsID09PSB0cnVlKSB7CiAgICAgICAgcmVzdWx0LnJlZmVyZW5jZVBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbihsaWdodC5tYXRyaXhXb3JsZCk7CiAgICAgICAgcmVzdWx0Lm5lYXJEaXN0YW5jZSA9IHNoYWRvd0NhbWVyYU5lYXI7CiAgICAgICAgcmVzdWx0LmZhckRpc3RhbmNlID0gc2hhZG93Q2FtZXJhRmFyOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICBmdW5jdGlvbiByZW5kZXJPYmplY3Qob2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgbGlnaHQsIHR5cGUpIHsKICAgICAgaWYgKG9iamVjdC52aXNpYmxlID09PSBmYWxzZSkKICAgICAgICByZXR1cm47CiAgICAgIGNvbnN0IHZpc2libGUgPSBvYmplY3QubGF5ZXJzLnRlc3QoY2FtZXJhLmxheWVycyk7CiAgICAgIGlmICh2aXNpYmxlICYmIChvYmplY3QuaXNNZXNoIHx8IG9iamVjdC5pc0xpbmUgfHwgb2JqZWN0LmlzUG9pbnRzKSkgewogICAgICAgIGlmICgob2JqZWN0LmNhc3RTaGFkb3cgfHwgb2JqZWN0LnJlY2VpdmVTaGFkb3cgJiYgdHlwZSA9PT0gVlNNU2hhZG93TWFwKSAmJiAoIW9iamVjdC5mcnVzdHVtQ3VsbGVkIHx8IF9mcnVzdHVtLmludGVyc2VjdHNPYmplY3Qob2JqZWN0KSkpIHsKICAgICAgICAgIG9iamVjdC5tb2RlbFZpZXdNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyhzaGFkb3dDYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLCBvYmplY3QubWF0cml4V29ybGQpOwogICAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBfb2JqZWN0cy51cGRhdGUob2JqZWN0KTsKICAgICAgICAgIGNvbnN0IG1hdGVyaWFsID0gb2JqZWN0Lm1hdGVyaWFsOwogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobWF0ZXJpYWwpKSB7CiAgICAgICAgICAgIGNvbnN0IGdyb3VwcyA9IGdlb21ldHJ5Lmdyb3VwczsKICAgICAgICAgICAgZm9yIChsZXQgayA9IDAsIGtsID0gZ3JvdXBzLmxlbmd0aDsgayA8IGtsOyBrKyspIHsKICAgICAgICAgICAgICBjb25zdCBncm91cCA9IGdyb3Vwc1trXTsKICAgICAgICAgICAgICBjb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbZ3JvdXAubWF0ZXJpYWxJbmRleF07CiAgICAgICAgICAgICAgaWYgKGdyb3VwTWF0ZXJpYWwgJiYgZ3JvdXBNYXRlcmlhbC52aXNpYmxlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkZXB0aE1hdGVyaWFsID0gZ2V0RGVwdGhNYXRlcmlhbChvYmplY3QsIGdlb21ldHJ5LCBncm91cE1hdGVyaWFsLCBsaWdodCwgc2hhZG93Q2FtZXJhLm5lYXIsIHNoYWRvd0NhbWVyYS5mYXIsIHR5cGUpOwogICAgICAgICAgICAgICAgX3JlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdChzaGFkb3dDYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBvYmplY3QsIGdyb3VwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwudmlzaWJsZSkgewogICAgICAgICAgICBjb25zdCBkZXB0aE1hdGVyaWFsID0gZ2V0RGVwdGhNYXRlcmlhbChvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgbGlnaHQsIHNoYWRvd0NhbWVyYS5uZWFyLCBzaGFkb3dDYW1lcmEuZmFyLCB0eXBlKTsKICAgICAgICAgICAgX3JlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdChzaGFkb3dDYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBvYmplY3QsIG51bGwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICByZW5kZXJPYmplY3QoY2hpbGRyZW5baV0sIGNhbWVyYSwgc2hhZG93Q2FtZXJhLCBsaWdodCwgdHlwZSk7CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gV2ViR0xTdGF0ZShnbCwgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzKSB7CiAgICBjb25zdCBpc1dlYkdMMiA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMjsKICAgIGZ1bmN0aW9uIENvbG9yQnVmZmVyKCkgewogICAgICBsZXQgbG9ja2VkID0gZmFsc2U7CiAgICAgIGNvbnN0IGNvbG9yID0gbmV3IFZlY3RvcjQoKTsKICAgICAgbGV0IGN1cnJlbnRDb2xvck1hc2sgPSBudWxsOwogICAgICBjb25zdCBjdXJyZW50Q29sb3JDbGVhciA9IG5ldyBWZWN0b3I0KDAsIDAsIDAsIDApOwogICAgICByZXR1cm4gewogICAgICAgIHNldE1hc2s6IGZ1bmN0aW9uKGNvbG9yTWFzaykgewogICAgICAgICAgaWYgKGN1cnJlbnRDb2xvck1hc2sgIT09IGNvbG9yTWFzayAmJiAhbG9ja2VkKSB7CiAgICAgICAgICAgIGdsLmNvbG9yTWFzayhjb2xvck1hc2ssIGNvbG9yTWFzaywgY29sb3JNYXNrLCBjb2xvck1hc2spOwogICAgICAgICAgICBjdXJyZW50Q29sb3JNYXNrID0gY29sb3JNYXNrOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2V0TG9ja2VkOiBmdW5jdGlvbihsb2NrKSB7CiAgICAgICAgICBsb2NrZWQgPSBsb2NrOwogICAgICAgIH0sCiAgICAgICAgc2V0Q2xlYXI6IGZ1bmN0aW9uKHIsIGcsIGIsIGEsIHByZW11bHRpcGxpZWRBbHBoYSkgewogICAgICAgICAgaWYgKHByZW11bHRpcGxpZWRBbHBoYSA9PT0gdHJ1ZSkgewogICAgICAgICAgICByICo9IGE7CiAgICAgICAgICAgIGcgKj0gYTsKICAgICAgICAgICAgYiAqPSBhOwogICAgICAgICAgfQogICAgICAgICAgY29sb3Iuc2V0KHIsIGcsIGIsIGEpOwogICAgICAgICAgaWYgKGN1cnJlbnRDb2xvckNsZWFyLmVxdWFscyhjb2xvcikgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIGdsLmNsZWFyQ29sb3IociwgZywgYiwgYSk7CiAgICAgICAgICAgIGN1cnJlbnRDb2xvckNsZWFyLmNvcHkoY29sb3IpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgbG9ja2VkID0gZmFsc2U7CiAgICAgICAgICBjdXJyZW50Q29sb3JNYXNrID0gbnVsbDsKICAgICAgICAgIGN1cnJlbnRDb2xvckNsZWFyLnNldCgtMSwgMCwgMCwgMCk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gRGVwdGhCdWZmZXIoKSB7CiAgICAgIGxldCBsb2NrZWQgPSBmYWxzZTsKICAgICAgbGV0IGN1cnJlbnREZXB0aE1hc2sgPSBudWxsOwogICAgICBsZXQgY3VycmVudERlcHRoRnVuYyA9IG51bGw7CiAgICAgIGxldCBjdXJyZW50RGVwdGhDbGVhciA9IG51bGw7CiAgICAgIHJldHVybiB7CiAgICAgICAgc2V0VGVzdDogZnVuY3Rpb24oZGVwdGhUZXN0KSB7CiAgICAgICAgICBpZiAoZGVwdGhUZXN0KSB7CiAgICAgICAgICAgIGVuYWJsZSgyOTI5KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRpc2FibGUoMjkyOSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZXRNYXNrOiBmdW5jdGlvbihkZXB0aE1hc2spIHsKICAgICAgICAgIGlmIChjdXJyZW50RGVwdGhNYXNrICE9PSBkZXB0aE1hc2sgJiYgIWxvY2tlZCkgewogICAgICAgICAgICBnbC5kZXB0aE1hc2soZGVwdGhNYXNrKTsKICAgICAgICAgICAgY3VycmVudERlcHRoTWFzayA9IGRlcHRoTWFzazsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldEZ1bmM6IGZ1bmN0aW9uKGRlcHRoRnVuYykgewogICAgICAgICAgaWYgKGN1cnJlbnREZXB0aEZ1bmMgIT09IGRlcHRoRnVuYykgewogICAgICAgICAgICBpZiAoZGVwdGhGdW5jKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChkZXB0aEZ1bmMpIHsKICAgICAgICAgICAgICAgIGNhc2UgTmV2ZXJEZXB0aDoKICAgICAgICAgICAgICAgICAgZ2wuZGVwdGhGdW5jKDUxMik7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBbHdheXNEZXB0aDoKICAgICAgICAgICAgICAgICAgZ2wuZGVwdGhGdW5jKDUxOSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBMZXNzRGVwdGg6CiAgICAgICAgICAgICAgICAgIGdsLmRlcHRoRnVuYyg1MTMpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTGVzc0VxdWFsRGVwdGg6CiAgICAgICAgICAgICAgICAgIGdsLmRlcHRoRnVuYyg1MTUpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRXF1YWxEZXB0aDoKICAgICAgICAgICAgICAgICAgZ2wuZGVwdGhGdW5jKDUxNCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBHcmVhdGVyRXF1YWxEZXB0aDoKICAgICAgICAgICAgICAgICAgZ2wuZGVwdGhGdW5jKDUxOCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBHcmVhdGVyRGVwdGg6CiAgICAgICAgICAgICAgICAgIGdsLmRlcHRoRnVuYyg1MTYpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTm90RXF1YWxEZXB0aDoKICAgICAgICAgICAgICAgICAgZ2wuZGVwdGhGdW5jKDUxNyk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgZ2wuZGVwdGhGdW5jKDUxNSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGdsLmRlcHRoRnVuYyg1MTUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1cnJlbnREZXB0aEZ1bmMgPSBkZXB0aEZ1bmM7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZXRMb2NrZWQ6IGZ1bmN0aW9uKGxvY2spIHsKICAgICAgICAgIGxvY2tlZCA9IGxvY2s7CiAgICAgICAgfSwKICAgICAgICBzZXRDbGVhcjogZnVuY3Rpb24oZGVwdGgpIHsKICAgICAgICAgIGlmIChjdXJyZW50RGVwdGhDbGVhciAhPT0gZGVwdGgpIHsKICAgICAgICAgICAgZ2wuY2xlYXJEZXB0aChkZXB0aCk7CiAgICAgICAgICAgIGN1cnJlbnREZXB0aENsZWFyID0gZGVwdGg7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBsb2NrZWQgPSBmYWxzZTsKICAgICAgICAgIGN1cnJlbnREZXB0aE1hc2sgPSBudWxsOwogICAgICAgICAgY3VycmVudERlcHRoRnVuYyA9IG51bGw7CiAgICAgICAgICBjdXJyZW50RGVwdGhDbGVhciA9IG51bGw7CiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gU3RlbmNpbEJ1ZmZlcigpIHsKICAgICAgbGV0IGxvY2tlZCA9IGZhbHNlOwogICAgICBsZXQgY3VycmVudFN0ZW5jaWxNYXNrID0gbnVsbDsKICAgICAgbGV0IGN1cnJlbnRTdGVuY2lsRnVuYyA9IG51bGw7CiAgICAgIGxldCBjdXJyZW50U3RlbmNpbFJlZiA9IG51bGw7CiAgICAgIGxldCBjdXJyZW50U3RlbmNpbEZ1bmNNYXNrID0gbnVsbDsKICAgICAgbGV0IGN1cnJlbnRTdGVuY2lsRmFpbCA9IG51bGw7CiAgICAgIGxldCBjdXJyZW50U3RlbmNpbFpGYWlsID0gbnVsbDsKICAgICAgbGV0IGN1cnJlbnRTdGVuY2lsWlBhc3MgPSBudWxsOwogICAgICBsZXQgY3VycmVudFN0ZW5jaWxDbGVhciA9IG51bGw7CiAgICAgIHJldHVybiB7CiAgICAgICAgc2V0VGVzdDogZnVuY3Rpb24oc3RlbmNpbFRlc3QpIHsKICAgICAgICAgIGlmICghbG9ja2VkKSB7CiAgICAgICAgICAgIGlmIChzdGVuY2lsVGVzdCkgewogICAgICAgICAgICAgIGVuYWJsZSgyOTYwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBkaXNhYmxlKDI5NjApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZXRNYXNrOiBmdW5jdGlvbihzdGVuY2lsTWFzaykgewogICAgICAgICAgaWYgKGN1cnJlbnRTdGVuY2lsTWFzayAhPT0gc3RlbmNpbE1hc2sgJiYgIWxvY2tlZCkgewogICAgICAgICAgICBnbC5zdGVuY2lsTWFzayhzdGVuY2lsTWFzayk7CiAgICAgICAgICAgIGN1cnJlbnRTdGVuY2lsTWFzayA9IHN0ZW5jaWxNYXNrOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2V0RnVuYzogZnVuY3Rpb24oc3RlbmNpbEZ1bmMsIHN0ZW5jaWxSZWYsIHN0ZW5jaWxNYXNrKSB7CiAgICAgICAgICBpZiAoY3VycmVudFN0ZW5jaWxGdW5jICE9PSBzdGVuY2lsRnVuYyB8fCBjdXJyZW50U3RlbmNpbFJlZiAhPT0gc3RlbmNpbFJlZiB8fCBjdXJyZW50U3RlbmNpbEZ1bmNNYXNrICE9PSBzdGVuY2lsTWFzaykgewogICAgICAgICAgICBnbC5zdGVuY2lsRnVuYyhzdGVuY2lsRnVuYywgc3RlbmNpbFJlZiwgc3RlbmNpbE1hc2spOwogICAgICAgICAgICBjdXJyZW50U3RlbmNpbEZ1bmMgPSBzdGVuY2lsRnVuYzsKICAgICAgICAgICAgY3VycmVudFN0ZW5jaWxSZWYgPSBzdGVuY2lsUmVmOwogICAgICAgICAgICBjdXJyZW50U3RlbmNpbEZ1bmNNYXNrID0gc3RlbmNpbE1hc2s7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZXRPcDogZnVuY3Rpb24oc3RlbmNpbEZhaWwsIHN0ZW5jaWxaRmFpbCwgc3RlbmNpbFpQYXNzKSB7CiAgICAgICAgICBpZiAoY3VycmVudFN0ZW5jaWxGYWlsICE9PSBzdGVuY2lsRmFpbCB8fCBjdXJyZW50U3RlbmNpbFpGYWlsICE9PSBzdGVuY2lsWkZhaWwgfHwgY3VycmVudFN0ZW5jaWxaUGFzcyAhPT0gc3RlbmNpbFpQYXNzKSB7CiAgICAgICAgICAgIGdsLnN0ZW5jaWxPcChzdGVuY2lsRmFpbCwgc3RlbmNpbFpGYWlsLCBzdGVuY2lsWlBhc3MpOwogICAgICAgICAgICBjdXJyZW50U3RlbmNpbEZhaWwgPSBzdGVuY2lsRmFpbDsKICAgICAgICAgICAgY3VycmVudFN0ZW5jaWxaRmFpbCA9IHN0ZW5jaWxaRmFpbDsKICAgICAgICAgICAgY3VycmVudFN0ZW5jaWxaUGFzcyA9IHN0ZW5jaWxaUGFzczsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldExvY2tlZDogZnVuY3Rpb24obG9jaykgewogICAgICAgICAgbG9ja2VkID0gbG9jazsKICAgICAgICB9LAogICAgICAgIHNldENsZWFyOiBmdW5jdGlvbihzdGVuY2lsKSB7CiAgICAgICAgICBpZiAoY3VycmVudFN0ZW5jaWxDbGVhciAhPT0gc3RlbmNpbCkgewogICAgICAgICAgICBnbC5jbGVhclN0ZW5jaWwoc3RlbmNpbCk7CiAgICAgICAgICAgIGN1cnJlbnRTdGVuY2lsQ2xlYXIgPSBzdGVuY2lsOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgbG9ja2VkID0gZmFsc2U7CiAgICAgICAgICBjdXJyZW50U3RlbmNpbE1hc2sgPSBudWxsOwogICAgICAgICAgY3VycmVudFN0ZW5jaWxGdW5jID0gbnVsbDsKICAgICAgICAgIGN1cnJlbnRTdGVuY2lsUmVmID0gbnVsbDsKICAgICAgICAgIGN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBudWxsOwogICAgICAgICAgY3VycmVudFN0ZW5jaWxGYWlsID0gbnVsbDsKICAgICAgICAgIGN1cnJlbnRTdGVuY2lsWkZhaWwgPSBudWxsOwogICAgICAgICAgY3VycmVudFN0ZW5jaWxaUGFzcyA9IG51bGw7CiAgICAgICAgICBjdXJyZW50U3RlbmNpbENsZWFyID0gbnVsbDsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICBjb25zdCBjb2xvckJ1ZmZlciA9IG5ldyBDb2xvckJ1ZmZlcigpOwogICAgY29uc3QgZGVwdGhCdWZmZXIgPSBuZXcgRGVwdGhCdWZmZXIoKTsKICAgIGNvbnN0IHN0ZW5jaWxCdWZmZXIgPSBuZXcgU3RlbmNpbEJ1ZmZlcigpOwogICAgbGV0IGVuYWJsZWRDYXBhYmlsaXRpZXMgPSB7fTsKICAgIGxldCB4ckZyYW1lYnVmZmVyID0gbnVsbDsKICAgIGxldCBjdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnMgPSB7fTsKICAgIGxldCBjdXJyZW50UHJvZ3JhbSA9IG51bGw7CiAgICBsZXQgY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IGZhbHNlOwogICAgbGV0IGN1cnJlbnRCbGVuZGluZyA9IG51bGw7CiAgICBsZXQgY3VycmVudEJsZW5kRXF1YXRpb24gPSBudWxsOwogICAgbGV0IGN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CiAgICBsZXQgY3VycmVudEJsZW5kRHN0ID0gbnVsbDsKICAgIGxldCBjdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKICAgIGxldCBjdXJyZW50QmxlbmRTcmNBbHBoYSA9IG51bGw7CiAgICBsZXQgY3VycmVudEJsZW5kRHN0QWxwaGEgPSBudWxsOwogICAgbGV0IGN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IGZhbHNlOwogICAgbGV0IGN1cnJlbnRGbGlwU2lkZWQgPSBudWxsOwogICAgbGV0IGN1cnJlbnRDdWxsRmFjZSA9IG51bGw7CiAgICBsZXQgY3VycmVudExpbmVXaWR0aCA9IG51bGw7CiAgICBsZXQgY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgPSBudWxsOwogICAgbGV0IGN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSBudWxsOwogICAgY29uc3QgbWF4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoMzU2NjEpOwogICAgbGV0IGxpbmVXaWR0aEF2YWlsYWJsZSA9IGZhbHNlOwogICAgbGV0IHZlcnNpb24gPSAwOwogICAgY29uc3QgZ2xWZXJzaW9uID0gZ2wuZ2V0UGFyYW1ldGVyKDc5MzgpOwogICAgaWYgKGdsVmVyc2lvbi5pbmRleE9mKCJXZWJHTCIpICE9PSAtMSkgewogICAgICB2ZXJzaW9uID0gcGFyc2VGbG9hdCgvXldlYkdMIChcZCkvLmV4ZWMoZ2xWZXJzaW9uKVsxXSk7CiAgICAgIGxpbmVXaWR0aEF2YWlsYWJsZSA9IHZlcnNpb24gPj0gMTsKICAgIH0gZWxzZSBpZiAoZ2xWZXJzaW9uLmluZGV4T2YoIk9wZW5HTCBFUyIpICE9PSAtMSkgewogICAgICB2ZXJzaW9uID0gcGFyc2VGbG9hdCgvXk9wZW5HTCBFUyAoXGQpLy5leGVjKGdsVmVyc2lvbilbMV0pOwogICAgICBsaW5lV2lkdGhBdmFpbGFibGUgPSB2ZXJzaW9uID49IDI7CiAgICB9CiAgICBsZXQgY3VycmVudFRleHR1cmVTbG90ID0gbnVsbDsKICAgIGxldCBjdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwogICAgY29uc3Qgc2Npc3NvclBhcmFtID0gZ2wuZ2V0UGFyYW1ldGVyKDMwODgpOwogICAgY29uc3Qgdmlld3BvcnRQYXJhbSA9IGdsLmdldFBhcmFtZXRlcigyOTc4KTsKICAgIGNvbnN0IGN1cnJlbnRTY2lzc29yID0gbmV3IFZlY3RvcjQoKS5mcm9tQXJyYXkoc2Npc3NvclBhcmFtKTsKICAgIGNvbnN0IGN1cnJlbnRWaWV3cG9ydCA9IG5ldyBWZWN0b3I0KCkuZnJvbUFycmF5KHZpZXdwb3J0UGFyYW0pOwogICAgZnVuY3Rpb24gY3JlYXRlVGV4dHVyZSh0eXBlLCB0YXJnZXQsIGNvdW50KSB7CiAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheSg0KTsKICAgICAgY29uc3QgdGV4dHVyZSA9IGdsLmNyZWF0ZVRleHR1cmUoKTsKICAgICAgZ2wuYmluZFRleHR1cmUodHlwZSwgdGV4dHVyZSk7CiAgICAgIGdsLnRleFBhcmFtZXRlcmkodHlwZSwgMTAyNDEsIDk3MjgpOwogICAgICBnbC50ZXhQYXJhbWV0ZXJpKHR5cGUsIDEwMjQwLCA5NzI4KTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgZ2wudGV4SW1hZ2UyRCh0YXJnZXQgKyBpLCAwLCA2NDA4LCAxLCAxLCAwLCA2NDA4LCA1MTIxLCBkYXRhKTsKICAgICAgfQogICAgICByZXR1cm4gdGV4dHVyZTsKICAgIH0KICAgIGNvbnN0IGVtcHR5VGV4dHVyZXMgPSB7fTsKICAgIGVtcHR5VGV4dHVyZXNbMzU1M10gPSBjcmVhdGVUZXh0dXJlKDM1NTMsIDM1NTMsIDEpOwogICAgZW1wdHlUZXh0dXJlc1szNDA2N10gPSBjcmVhdGVUZXh0dXJlKDM0MDY3LCAzNDA2OSwgNik7CiAgICBjb2xvckJ1ZmZlci5zZXRDbGVhcigwLCAwLCAwLCAxKTsKICAgIGRlcHRoQnVmZmVyLnNldENsZWFyKDEpOwogICAgc3RlbmNpbEJ1ZmZlci5zZXRDbGVhcigwKTsKICAgIGVuYWJsZSgyOTI5KTsKICAgIGRlcHRoQnVmZmVyLnNldEZ1bmMoTGVzc0VxdWFsRGVwdGgpOwogICAgc2V0RmxpcFNpZGVkKGZhbHNlKTsKICAgIHNldEN1bGxGYWNlKEN1bGxGYWNlQmFjayk7CiAgICBlbmFibGUoMjg4NCk7CiAgICBzZXRCbGVuZGluZyhOb0JsZW5kaW5nKTsKICAgIGZ1bmN0aW9uIGVuYWJsZShpZCkgewogICAgICBpZiAoZW5hYmxlZENhcGFiaWxpdGllc1tpZF0gIT09IHRydWUpIHsKICAgICAgICBnbC5lbmFibGUoaWQpOwogICAgICAgIGVuYWJsZWRDYXBhYmlsaXRpZXNbaWRdID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZGlzYWJsZShpZCkgewogICAgICBpZiAoZW5hYmxlZENhcGFiaWxpdGllc1tpZF0gIT09IGZhbHNlKSB7CiAgICAgICAgZ2wuZGlzYWJsZShpZCk7CiAgICAgICAgZW5hYmxlZENhcGFiaWxpdGllc1tpZF0gPSBmYWxzZTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gYmluZFhSRnJhbWVidWZmZXIoZnJhbWVidWZmZXIpIHsKICAgICAgaWYgKGZyYW1lYnVmZmVyICE9PSB4ckZyYW1lYnVmZmVyKSB7CiAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKDM2MTYwLCBmcmFtZWJ1ZmZlcik7CiAgICAgICAgeHJGcmFtZWJ1ZmZlciA9IGZyYW1lYnVmZmVyOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBiaW5kRnJhbWVidWZmZXIodGFyZ2V0LCBmcmFtZWJ1ZmZlcikgewogICAgICBpZiAoZnJhbWVidWZmZXIgPT09IG51bGwgJiYgeHJGcmFtZWJ1ZmZlciAhPT0gbnVsbCkKICAgICAgICBmcmFtZWJ1ZmZlciA9IHhyRnJhbWVidWZmZXI7CiAgICAgIGlmIChjdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbdGFyZ2V0XSAhPT0gZnJhbWVidWZmZXIpIHsKICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIodGFyZ2V0LCBmcmFtZWJ1ZmZlcik7CiAgICAgICAgY3VycmVudEJvdW5kRnJhbWVidWZmZXJzW3RhcmdldF0gPSBmcmFtZWJ1ZmZlcjsKICAgICAgICBpZiAoaXNXZWJHTDIpIHsKICAgICAgICAgIGlmICh0YXJnZXQgPT09IDM2MDA5KSB7CiAgICAgICAgICAgIGN1cnJlbnRCb3VuZEZyYW1lYnVmZmVyc1szNjE2MF0gPSBmcmFtZWJ1ZmZlcjsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0YXJnZXQgPT09IDM2MTYwKSB7CiAgICAgICAgICAgIGN1cnJlbnRCb3VuZEZyYW1lYnVmZmVyc1szNjAwOV0gPSBmcmFtZWJ1ZmZlcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgZnVuY3Rpb24gdXNlUHJvZ3JhbShwcm9ncmFtKSB7CiAgICAgIGlmIChjdXJyZW50UHJvZ3JhbSAhPT0gcHJvZ3JhbSkgewogICAgICAgIGdsLnVzZVByb2dyYW0ocHJvZ3JhbSk7CiAgICAgICAgY3VycmVudFByb2dyYW0gPSBwcm9ncmFtOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IGVxdWF0aW9uVG9HTCA9IHsKICAgICAgW0FkZEVxdWF0aW9uXTogMzI3NzQsCiAgICAgIFtTdWJ0cmFjdEVxdWF0aW9uXTogMzI3NzgsCiAgICAgIFtSZXZlcnNlU3VidHJhY3RFcXVhdGlvbl06IDMyNzc5CiAgICB9OwogICAgaWYgKGlzV2ViR0wyKSB7CiAgICAgIGVxdWF0aW9uVG9HTFtNaW5FcXVhdGlvbl0gPSAzMjc3NTsKICAgICAgZXF1YXRpb25Ub0dMW01heEVxdWF0aW9uXSA9IDMyNzc2OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoIkVYVF9ibGVuZF9taW5tYXgiKTsKICAgICAgaWYgKGV4dGVuc2lvbiAhPT0gbnVsbCkgewogICAgICAgIGVxdWF0aW9uVG9HTFtNaW5FcXVhdGlvbl0gPSBleHRlbnNpb24uTUlOX0VYVDsKICAgICAgICBlcXVhdGlvblRvR0xbTWF4RXF1YXRpb25dID0gZXh0ZW5zaW9uLk1BWF9FWFQ7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGZhY3RvclRvR0wgPSB7CiAgICAgIFtaZXJvRmFjdG9yXTogMCwKICAgICAgW09uZUZhY3Rvcl06IDEsCiAgICAgIFtTcmNDb2xvckZhY3Rvcl06IDc2OCwKICAgICAgW1NyY0FscGhhRmFjdG9yXTogNzcwLAogICAgICBbU3JjQWxwaGFTYXR1cmF0ZUZhY3Rvcl06IDc3NiwKICAgICAgW0RzdENvbG9yRmFjdG9yXTogNzc0LAogICAgICBbRHN0QWxwaGFGYWN0b3JdOiA3NzIsCiAgICAgIFtPbmVNaW51c1NyY0NvbG9yRmFjdG9yXTogNzY5LAogICAgICBbT25lTWludXNTcmNBbHBoYUZhY3Rvcl06IDc3MSwKICAgICAgW09uZU1pbnVzRHN0Q29sb3JGYWN0b3JdOiA3NzUsCiAgICAgIFtPbmVNaW51c0RzdEFscGhhRmFjdG9yXTogNzczCiAgICB9OwogICAgZnVuY3Rpb24gc2V0QmxlbmRpbmcoYmxlbmRpbmcsIGJsZW5kRXF1YXRpb24sIGJsZW5kU3JjLCBibGVuZERzdCwgYmxlbmRFcXVhdGlvbkFscGhhLCBibGVuZFNyY0FscGhhLCBibGVuZERzdEFscGhhLCBwcmVtdWx0aXBsaWVkQWxwaGEpIHsKICAgICAgaWYgKGJsZW5kaW5nID09PSBOb0JsZW5kaW5nKSB7CiAgICAgICAgaWYgKGN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgIGRpc2FibGUoMzA0Mik7CiAgICAgICAgICBjdXJyZW50QmxlbmRpbmdFbmFibGVkID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9PT0gZmFsc2UpIHsKICAgICAgICBlbmFibGUoMzA0Mik7CiAgICAgICAgY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKGJsZW5kaW5nICE9PSBDdXN0b21CbGVuZGluZykgewogICAgICAgIGlmIChibGVuZGluZyAhPT0gY3VycmVudEJsZW5kaW5nIHx8IHByZW11bHRpcGxpZWRBbHBoYSAhPT0gY3VycmVudFByZW11bHRpcGxlZEFscGhhKSB7CiAgICAgICAgICBpZiAoY3VycmVudEJsZW5kRXF1YXRpb24gIT09IEFkZEVxdWF0aW9uIHx8IGN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgIT09IEFkZEVxdWF0aW9uKSB7CiAgICAgICAgICAgIGdsLmJsZW5kRXF1YXRpb24oMzI3NzQpOwogICAgICAgICAgICBjdXJyZW50QmxlbmRFcXVhdGlvbiA9IEFkZEVxdWF0aW9uOwogICAgICAgICAgICBjdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhID0gQWRkRXF1YXRpb247CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocHJlbXVsdGlwbGllZEFscGhhKSB7CiAgICAgICAgICAgIHN3aXRjaCAoYmxlbmRpbmcpIHsKICAgICAgICAgICAgICBjYXNlIE5vcm1hbEJsZW5kaW5nOgogICAgICAgICAgICAgICAgZ2wuYmxlbmRGdW5jU2VwYXJhdGUoMSwgNzcxLCAxLCA3NzEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSBBZGRpdGl2ZUJsZW5kaW5nOgogICAgICAgICAgICAgICAgZ2wuYmxlbmRGdW5jKDEsIDEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSBTdWJ0cmFjdGl2ZUJsZW5kaW5nOgogICAgICAgICAgICAgICAgZ2wuYmxlbmRGdW5jU2VwYXJhdGUoMCwgMCwgNzY5LCA3NzEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSBNdWx0aXBseUJsZW5kaW5nOgogICAgICAgICAgICAgICAgZ2wuYmxlbmRGdW5jU2VwYXJhdGUoMCwgNzY4LCAwLCA3NzApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLldlYkdMU3RhdGU6IEludmFsaWQgYmxlbmRpbmc6ICIsIGJsZW5kaW5nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzd2l0Y2ggKGJsZW5kaW5nKSB7CiAgICAgICAgICAgICAgY2FzZSBOb3JtYWxCbGVuZGluZzoKICAgICAgICAgICAgICAgIGdsLmJsZW5kRnVuY1NlcGFyYXRlKDc3MCwgNzcxLCAxLCA3NzEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSBBZGRpdGl2ZUJsZW5kaW5nOgogICAgICAgICAgICAgICAgZ2wuYmxlbmRGdW5jKDc3MCwgMSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIFN1YnRyYWN0aXZlQmxlbmRpbmc6CiAgICAgICAgICAgICAgICBnbC5ibGVuZEZ1bmMoMCwgNzY5KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgTXVsdGlwbHlCbGVuZGluZzoKICAgICAgICAgICAgICAgIGdsLmJsZW5kRnVuYygwLCA3NjgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLldlYkdMU3RhdGU6IEludmFsaWQgYmxlbmRpbmc6ICIsIGJsZW5kaW5nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50QmxlbmRTcmMgPSBudWxsOwogICAgICAgICAgY3VycmVudEJsZW5kRHN0ID0gbnVsbDsKICAgICAgICAgIGN1cnJlbnRCbGVuZFNyY0FscGhhID0gbnVsbDsKICAgICAgICAgIGN1cnJlbnRCbGVuZERzdEFscGhhID0gbnVsbDsKICAgICAgICAgIGN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwogICAgICAgICAgY3VycmVudFByZW11bHRpcGxlZEFscGhhID0gcHJlbXVsdGlwbGllZEFscGhhOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgYmxlbmRFcXVhdGlvbkFscGhhID0gYmxlbmRFcXVhdGlvbkFscGhhIHx8IGJsZW5kRXF1YXRpb247CiAgICAgIGJsZW5kU3JjQWxwaGEgPSBibGVuZFNyY0FscGhhIHx8IGJsZW5kU3JjOwogICAgICBibGVuZERzdEFscGhhID0gYmxlbmREc3RBbHBoYSB8fCBibGVuZERzdDsKICAgICAgaWYgKGJsZW5kRXF1YXRpb24gIT09IGN1cnJlbnRCbGVuZEVxdWF0aW9uIHx8IGJsZW5kRXF1YXRpb25BbHBoYSAhPT0gY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSkgewogICAgICAgIGdsLmJsZW5kRXF1YXRpb25TZXBhcmF0ZShlcXVhdGlvblRvR0xbYmxlbmRFcXVhdGlvbl0sIGVxdWF0aW9uVG9HTFtibGVuZEVxdWF0aW9uQWxwaGFdKTsKICAgICAgICBjdXJyZW50QmxlbmRFcXVhdGlvbiA9IGJsZW5kRXF1YXRpb247CiAgICAgICAgY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IGJsZW5kRXF1YXRpb25BbHBoYTsKICAgICAgfQogICAgICBpZiAoYmxlbmRTcmMgIT09IGN1cnJlbnRCbGVuZFNyYyB8fCBibGVuZERzdCAhPT0gY3VycmVudEJsZW5kRHN0IHx8IGJsZW5kU3JjQWxwaGEgIT09IGN1cnJlbnRCbGVuZFNyY0FscGhhIHx8IGJsZW5kRHN0QWxwaGEgIT09IGN1cnJlbnRCbGVuZERzdEFscGhhKSB7CiAgICAgICAgZ2wuYmxlbmRGdW5jU2VwYXJhdGUoZmFjdG9yVG9HTFtibGVuZFNyY10sIGZhY3RvclRvR0xbYmxlbmREc3RdLCBmYWN0b3JUb0dMW2JsZW5kU3JjQWxwaGFdLCBmYWN0b3JUb0dMW2JsZW5kRHN0QWxwaGFdKTsKICAgICAgICBjdXJyZW50QmxlbmRTcmMgPSBibGVuZFNyYzsKICAgICAgICBjdXJyZW50QmxlbmREc3QgPSBibGVuZERzdDsKICAgICAgICBjdXJyZW50QmxlbmRTcmNBbHBoYSA9IGJsZW5kU3JjQWxwaGE7CiAgICAgICAgY3VycmVudEJsZW5kRHN0QWxwaGEgPSBibGVuZERzdEFscGhhOwogICAgICB9CiAgICAgIGN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwogICAgICBjdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBudWxsOwogICAgfQogICAgZnVuY3Rpb24gc2V0TWF0ZXJpYWwobWF0ZXJpYWwsIGZyb250RmFjZUNXKSB7CiAgICAgIG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUgPyBkaXNhYmxlKDI4ODQpIDogZW5hYmxlKDI4ODQpOwogICAgICBsZXQgZmxpcFNpZGVkID0gbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGU7CiAgICAgIGlmIChmcm9udEZhY2VDVykKICAgICAgICBmbGlwU2lkZWQgPSAhZmxpcFNpZGVkOwogICAgICBzZXRGbGlwU2lkZWQoZmxpcFNpZGVkKTsKICAgICAgbWF0ZXJpYWwuYmxlbmRpbmcgPT09IE5vcm1hbEJsZW5kaW5nICYmIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSBmYWxzZSA/IHNldEJsZW5kaW5nKE5vQmxlbmRpbmcpIDogc2V0QmxlbmRpbmcobWF0ZXJpYWwuYmxlbmRpbmcsIG1hdGVyaWFsLmJsZW5kRXF1YXRpb24sIG1hdGVyaWFsLmJsZW5kU3JjLCBtYXRlcmlhbC5ibGVuZERzdCwgbWF0ZXJpYWwuYmxlbmRFcXVhdGlvbkFscGhhLCBtYXRlcmlhbC5ibGVuZFNyY0FscGhhLCBtYXRlcmlhbC5ibGVuZERzdEFscGhhLCBtYXRlcmlhbC5wcmVtdWx0aXBsaWVkQWxwaGEpOwogICAgICBkZXB0aEJ1ZmZlci5zZXRGdW5jKG1hdGVyaWFsLmRlcHRoRnVuYyk7CiAgICAgIGRlcHRoQnVmZmVyLnNldFRlc3QobWF0ZXJpYWwuZGVwdGhUZXN0KTsKICAgICAgZGVwdGhCdWZmZXIuc2V0TWFzayhtYXRlcmlhbC5kZXB0aFdyaXRlKTsKICAgICAgY29sb3JCdWZmZXIuc2V0TWFzayhtYXRlcmlhbC5jb2xvcldyaXRlKTsKICAgICAgY29uc3Qgc3RlbmNpbFdyaXRlID0gbWF0ZXJpYWwuc3RlbmNpbFdyaXRlOwogICAgICBzdGVuY2lsQnVmZmVyLnNldFRlc3Qoc3RlbmNpbFdyaXRlKTsKICAgICAgaWYgKHN0ZW5jaWxXcml0ZSkgewogICAgICAgIHN0ZW5jaWxCdWZmZXIuc2V0TWFzayhtYXRlcmlhbC5zdGVuY2lsV3JpdGVNYXNrKTsKICAgICAgICBzdGVuY2lsQnVmZmVyLnNldEZ1bmMobWF0ZXJpYWwuc3RlbmNpbEZ1bmMsIG1hdGVyaWFsLnN0ZW5jaWxSZWYsIG1hdGVyaWFsLnN0ZW5jaWxGdW5jTWFzayk7CiAgICAgICAgc3RlbmNpbEJ1ZmZlci5zZXRPcChtYXRlcmlhbC5zdGVuY2lsRmFpbCwgbWF0ZXJpYWwuc3RlbmNpbFpGYWlsLCBtYXRlcmlhbC5zdGVuY2lsWlBhc3MpOwogICAgICB9CiAgICAgIHNldFBvbHlnb25PZmZzZXQobWF0ZXJpYWwucG9seWdvbk9mZnNldCwgbWF0ZXJpYWwucG9seWdvbk9mZnNldEZhY3RvciwgbWF0ZXJpYWwucG9seWdvbk9mZnNldFVuaXRzKTsKICAgICAgbWF0ZXJpYWwuYWxwaGFUb0NvdmVyYWdlID09PSB0cnVlID8gZW5hYmxlKDMyOTI2KSA6IGRpc2FibGUoMzI5MjYpOwogICAgfQogICAgZnVuY3Rpb24gc2V0RmxpcFNpZGVkKGZsaXBTaWRlZCkgewogICAgICBpZiAoY3VycmVudEZsaXBTaWRlZCAhPT0gZmxpcFNpZGVkKSB7CiAgICAgICAgaWYgKGZsaXBTaWRlZCkgewogICAgICAgICAgZ2wuZnJvbnRGYWNlKDIzMDQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBnbC5mcm9udEZhY2UoMjMwNSk7CiAgICAgICAgfQogICAgICAgIGN1cnJlbnRGbGlwU2lkZWQgPSBmbGlwU2lkZWQ7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNldEN1bGxGYWNlKGN1bGxGYWNlKSB7CiAgICAgIGlmIChjdWxsRmFjZSAhPT0gQ3VsbEZhY2VOb25lKSB7CiAgICAgICAgZW5hYmxlKDI4ODQpOwogICAgICAgIGlmIChjdWxsRmFjZSAhPT0gY3VycmVudEN1bGxGYWNlKSB7CiAgICAgICAgICBpZiAoY3VsbEZhY2UgPT09IEN1bGxGYWNlQmFjaykgewogICAgICAgICAgICBnbC5jdWxsRmFjZSgxMDI5KTsKICAgICAgICAgIH0gZWxzZSBpZiAoY3VsbEZhY2UgPT09IEN1bGxGYWNlRnJvbnQpIHsKICAgICAgICAgICAgZ2wuY3VsbEZhY2UoMTAyOCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBnbC5jdWxsRmFjZSgxMDMyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGlzYWJsZSgyODg0KTsKICAgICAgfQogICAgICBjdXJyZW50Q3VsbEZhY2UgPSBjdWxsRmFjZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldExpbmVXaWR0aCh3aWR0aCkgewogICAgICBpZiAod2lkdGggIT09IGN1cnJlbnRMaW5lV2lkdGgpIHsKICAgICAgICBpZiAobGluZVdpZHRoQXZhaWxhYmxlKQogICAgICAgICAgZ2wubGluZVdpZHRoKHdpZHRoKTsKICAgICAgICBjdXJyZW50TGluZVdpZHRoID0gd2lkdGg7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNldFBvbHlnb25PZmZzZXQocG9seWdvbk9mZnNldCwgZmFjdG9yLCB1bml0cykgewogICAgICBpZiAocG9seWdvbk9mZnNldCkgewogICAgICAgIGVuYWJsZSgzMjgyMyk7CiAgICAgICAgaWYgKGN1cnJlbnRQb2x5Z29uT2Zmc2V0RmFjdG9yICE9PSBmYWN0b3IgfHwgY3VycmVudFBvbHlnb25PZmZzZXRVbml0cyAhPT0gdW5pdHMpIHsKICAgICAgICAgIGdsLnBvbHlnb25PZmZzZXQoZmFjdG9yLCB1bml0cyk7CiAgICAgICAgICBjdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IGZhY3RvcjsKICAgICAgICAgIGN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSB1bml0czsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGlzYWJsZSgzMjgyMyk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNldFNjaXNzb3JUZXN0KHNjaXNzb3JUZXN0KSB7CiAgICAgIGlmIChzY2lzc29yVGVzdCkgewogICAgICAgIGVuYWJsZSgzMDg5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkaXNhYmxlKDMwODkpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBhY3RpdmVUZXh0dXJlKHdlYmdsU2xvdCkgewogICAgICBpZiAod2ViZ2xTbG90ID09PSB2b2lkIDApCiAgICAgICAgd2ViZ2xTbG90ID0gMzM5ODQgKyBtYXhUZXh0dXJlcyAtIDE7CiAgICAgIGlmIChjdXJyZW50VGV4dHVyZVNsb3QgIT09IHdlYmdsU2xvdCkgewogICAgICAgIGdsLmFjdGl2ZVRleHR1cmUod2ViZ2xTbG90KTsKICAgICAgICBjdXJyZW50VGV4dHVyZVNsb3QgPSB3ZWJnbFNsb3Q7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGJpbmRUZXh0dXJlKHdlYmdsVHlwZSwgd2ViZ2xUZXh0dXJlKSB7CiAgICAgIGlmIChjdXJyZW50VGV4dHVyZVNsb3QgPT09IG51bGwpIHsKICAgICAgICBhY3RpdmVUZXh0dXJlKCk7CiAgICAgIH0KICAgICAgbGV0IGJvdW5kVGV4dHVyZSA9IGN1cnJlbnRCb3VuZFRleHR1cmVzW2N1cnJlbnRUZXh0dXJlU2xvdF07CiAgICAgIGlmIChib3VuZFRleHR1cmUgPT09IHZvaWQgMCkgewogICAgICAgIGJvdW5kVGV4dHVyZSA9IHsgdHlwZTogdm9pZCAwLCB0ZXh0dXJlOiB2b2lkIDAgfTsKICAgICAgICBjdXJyZW50Qm91bmRUZXh0dXJlc1tjdXJyZW50VGV4dHVyZVNsb3RdID0gYm91bmRUZXh0dXJlOwogICAgICB9CiAgICAgIGlmIChib3VuZFRleHR1cmUudHlwZSAhPT0gd2ViZ2xUeXBlIHx8IGJvdW5kVGV4dHVyZS50ZXh0dXJlICE9PSB3ZWJnbFRleHR1cmUpIHsKICAgICAgICBnbC5iaW5kVGV4dHVyZSh3ZWJnbFR5cGUsIHdlYmdsVGV4dHVyZSB8fCBlbXB0eVRleHR1cmVzW3dlYmdsVHlwZV0pOwogICAgICAgIGJvdW5kVGV4dHVyZS50eXBlID0gd2ViZ2xUeXBlOwogICAgICAgIGJvdW5kVGV4dHVyZS50ZXh0dXJlID0gd2ViZ2xUZXh0dXJlOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB1bmJpbmRUZXh0dXJlKCkgewogICAgICBjb25zdCBib3VuZFRleHR1cmUgPSBjdXJyZW50Qm91bmRUZXh0dXJlc1tjdXJyZW50VGV4dHVyZVNsb3RdOwogICAgICBpZiAoYm91bmRUZXh0dXJlICE9PSB2b2lkIDAgJiYgYm91bmRUZXh0dXJlLnR5cGUgIT09IHZvaWQgMCkgewogICAgICAgIGdsLmJpbmRUZXh0dXJlKGJvdW5kVGV4dHVyZS50eXBlLCBudWxsKTsKICAgICAgICBib3VuZFRleHR1cmUudHlwZSA9IHZvaWQgMDsKICAgICAgICBib3VuZFRleHR1cmUudGV4dHVyZSA9IHZvaWQgMDsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gY29tcHJlc3NlZFRleEltYWdlMkQoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgZ2wuY29tcHJlc3NlZFRleEltYWdlMkQuYXBwbHkoZ2wsIGFyZ3VtZW50cyk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuV2ViR0xTdGF0ZToiLCBlcnJvcik7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHRleEltYWdlMkQoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgZ2wudGV4SW1hZ2UyRC5hcHBseShnbCwgYXJndW1lbnRzKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5XZWJHTFN0YXRlOiIsIGVycm9yKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gdGV4SW1hZ2UzRCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBnbC50ZXhJbWFnZTNELmFwcGx5KGdsLCBhcmd1bWVudHMpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLldlYkdMU3RhdGU6IiwgZXJyb3IpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzY2lzc29yKHNjaXNzb3IyKSB7CiAgICAgIGlmIChjdXJyZW50U2Npc3Nvci5lcXVhbHMoc2Npc3NvcjIpID09PSBmYWxzZSkgewogICAgICAgIGdsLnNjaXNzb3Ioc2Npc3NvcjIueCwgc2Npc3NvcjIueSwgc2Npc3NvcjIueiwgc2Npc3NvcjIudyk7CiAgICAgICAgY3VycmVudFNjaXNzb3IuY29weShzY2lzc29yMik7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHZpZXdwb3J0KHZpZXdwb3J0MikgewogICAgICBpZiAoY3VycmVudFZpZXdwb3J0LmVxdWFscyh2aWV3cG9ydDIpID09PSBmYWxzZSkgewogICAgICAgIGdsLnZpZXdwb3J0KHZpZXdwb3J0Mi54LCB2aWV3cG9ydDIueSwgdmlld3BvcnQyLnosIHZpZXdwb3J0Mi53KTsKICAgICAgICBjdXJyZW50Vmlld3BvcnQuY29weSh2aWV3cG9ydDIpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgZ2wuZGlzYWJsZSgzMDQyKTsKICAgICAgZ2wuZGlzYWJsZSgyODg0KTsKICAgICAgZ2wuZGlzYWJsZSgyOTI5KTsKICAgICAgZ2wuZGlzYWJsZSgzMjgyMyk7CiAgICAgIGdsLmRpc2FibGUoMzA4OSk7CiAgICAgIGdsLmRpc2FibGUoMjk2MCk7CiAgICAgIGdsLmRpc2FibGUoMzI5MjYpOwogICAgICBnbC5ibGVuZEVxdWF0aW9uKDMyNzc0KTsKICAgICAgZ2wuYmxlbmRGdW5jKDEsIDApOwogICAgICBnbC5ibGVuZEZ1bmNTZXBhcmF0ZSgxLCAwLCAxLCAwKTsKICAgICAgZ2wuY29sb3JNYXNrKHRydWUsIHRydWUsIHRydWUsIHRydWUpOwogICAgICBnbC5jbGVhckNvbG9yKDAsIDAsIDAsIDApOwogICAgICBnbC5kZXB0aE1hc2sodHJ1ZSk7CiAgICAgIGdsLmRlcHRoRnVuYyg1MTMpOwogICAgICBnbC5jbGVhckRlcHRoKDEpOwogICAgICBnbC5zdGVuY2lsTWFzayg0Mjk0OTY3Mjk1KTsKICAgICAgZ2wuc3RlbmNpbEZ1bmMoNTE5LCAwLCA0Mjk0OTY3Mjk1KTsKICAgICAgZ2wuc3RlbmNpbE9wKDc2ODAsIDc2ODAsIDc2ODApOwogICAgICBnbC5jbGVhclN0ZW5jaWwoMCk7CiAgICAgIGdsLmN1bGxGYWNlKDEwMjkpOwogICAgICBnbC5mcm9udEZhY2UoMjMwNSk7CiAgICAgIGdsLnBvbHlnb25PZmZzZXQoMCwgMCk7CiAgICAgIGdsLmFjdGl2ZVRleHR1cmUoMzM5ODQpOwogICAgICBnbC5iaW5kRnJhbWVidWZmZXIoMzYxNjAsIG51bGwpOwogICAgICBpZiAoaXNXZWJHTDIgPT09IHRydWUpIHsKICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoMzYwMDksIG51bGwpOwogICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcigzNjAwOCwgbnVsbCk7CiAgICAgIH0KICAgICAgZ2wudXNlUHJvZ3JhbShudWxsKTsKICAgICAgZ2wubGluZVdpZHRoKDEpOwogICAgICBnbC5zY2lzc29yKDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCk7CiAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCk7CiAgICAgIGVuYWJsZWRDYXBhYmlsaXRpZXMgPSB7fTsKICAgICAgY3VycmVudFRleHR1cmVTbG90ID0gbnVsbDsKICAgICAgY3VycmVudEJvdW5kVGV4dHVyZXMgPSB7fTsKICAgICAgeHJGcmFtZWJ1ZmZlciA9IG51bGw7CiAgICAgIGN1cnJlbnRCb3VuZEZyYW1lYnVmZmVycyA9IHt9OwogICAgICBjdXJyZW50UHJvZ3JhbSA9IG51bGw7CiAgICAgIGN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSBmYWxzZTsKICAgICAgY3VycmVudEJsZW5kaW5nID0gbnVsbDsKICAgICAgY3VycmVudEJsZW5kRXF1YXRpb24gPSBudWxsOwogICAgICBjdXJyZW50QmxlbmRTcmMgPSBudWxsOwogICAgICBjdXJyZW50QmxlbmREc3QgPSBudWxsOwogICAgICBjdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKICAgICAgY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwogICAgICBjdXJyZW50QmxlbmREc3RBbHBoYSA9IG51bGw7CiAgICAgIGN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IGZhbHNlOwogICAgICBjdXJyZW50RmxpcFNpZGVkID0gbnVsbDsKICAgICAgY3VycmVudEN1bGxGYWNlID0gbnVsbDsKICAgICAgY3VycmVudExpbmVXaWR0aCA9IG51bGw7CiAgICAgIGN1cnJlbnRQb2x5Z29uT2Zmc2V0RmFjdG9yID0gbnVsbDsKICAgICAgY3VycmVudFBvbHlnb25PZmZzZXRVbml0cyA9IG51bGw7CiAgICAgIGN1cnJlbnRTY2lzc29yLnNldCgwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQpOwogICAgICBjdXJyZW50Vmlld3BvcnQuc2V0KDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCk7CiAgICAgIGNvbG9yQnVmZmVyLnJlc2V0KCk7CiAgICAgIGRlcHRoQnVmZmVyLnJlc2V0KCk7CiAgICAgIHN0ZW5jaWxCdWZmZXIucmVzZXQoKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGJ1ZmZlcnM6IHsKICAgICAgICBjb2xvcjogY29sb3JCdWZmZXIsCiAgICAgICAgZGVwdGg6IGRlcHRoQnVmZmVyLAogICAgICAgIHN0ZW5jaWw6IHN0ZW5jaWxCdWZmZXIKICAgICAgfSwKICAgICAgZW5hYmxlLAogICAgICBkaXNhYmxlLAogICAgICBiaW5kRnJhbWVidWZmZXIsCiAgICAgIGJpbmRYUkZyYW1lYnVmZmVyLAogICAgICB1c2VQcm9ncmFtLAogICAgICBzZXRCbGVuZGluZywKICAgICAgc2V0TWF0ZXJpYWwsCiAgICAgIHNldEZsaXBTaWRlZCwKICAgICAgc2V0Q3VsbEZhY2UsCiAgICAgIHNldExpbmVXaWR0aCwKICAgICAgc2V0UG9seWdvbk9mZnNldCwKICAgICAgc2V0U2Npc3NvclRlc3QsCiAgICAgIGFjdGl2ZVRleHR1cmUsCiAgICAgIGJpbmRUZXh0dXJlLAogICAgICB1bmJpbmRUZXh0dXJlLAogICAgICBjb21wcmVzc2VkVGV4SW1hZ2UyRCwKICAgICAgdGV4SW1hZ2UyRCwKICAgICAgdGV4SW1hZ2UzRCwKICAgICAgc2Npc3NvciwKICAgICAgdmlld3BvcnQsCiAgICAgIHJlc2V0CiAgICB9OwogIH0KICBmdW5jdGlvbiBXZWJHTFRleHR1cmVzKF9nbCwgZXh0ZW5zaW9ucywgc3RhdGUsIHByb3BlcnRpZXMsIGNhcGFiaWxpdGllcywgdXRpbHMsIGluZm8pIHsKICAgIGNvbnN0IGlzV2ViR0wyID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyOwogICAgY29uc3QgbWF4VGV4dHVyZXMgPSBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZXM7CiAgICBjb25zdCBtYXhDdWJlbWFwU2l6ZSA9IGNhcGFiaWxpdGllcy5tYXhDdWJlbWFwU2l6ZTsKICAgIGNvbnN0IG1heFRleHR1cmVTaXplID0gY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplOwogICAgY29uc3QgbWF4U2FtcGxlcyA9IGNhcGFiaWxpdGllcy5tYXhTYW1wbGVzOwogICAgY29uc3QgX3ZpZGVvVGV4dHVyZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFdlYWtNYXAoKTsKICAgIGxldCBfY2FudmFzMjsKICAgIGxldCB1c2VPZmZzY3JlZW5DYW52YXMgPSBmYWxzZTsKICAgIHRyeSB7CiAgICAgIHVzZU9mZnNjcmVlbkNhbnZhcyA9IHR5cGVvZiBPZmZzY3JlZW5DYW52YXMgIT09ICJ1bmRlZmluZWQiICYmIG5ldyBPZmZzY3JlZW5DYW52YXMoMSwgMSkuZ2V0Q29udGV4dCgiMmQiKSAhPT0gbnVsbDsKICAgIH0gY2F0Y2ggKGVycikgewogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlQ2FudmFzKHdpZHRoLCBoZWlnaHQpIHsKICAgICAgcmV0dXJuIHVzZU9mZnNjcmVlbkNhbnZhcyA/IG5ldyBPZmZzY3JlZW5DYW52YXMod2lkdGgsIGhlaWdodCkgOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLCAiY2FudmFzIik7CiAgICB9CiAgICBmdW5jdGlvbiByZXNpemVJbWFnZShpbWFnZSwgbmVlZHNQb3dlck9mVHdvLCBuZWVkc05ld0NhbnZhcywgbWF4U2l6ZSkgewogICAgICBsZXQgc2NhbGUgPSAxOwogICAgICBpZiAoaW1hZ2Uud2lkdGggPiBtYXhTaXplIHx8IGltYWdlLmhlaWdodCA+IG1heFNpemUpIHsKICAgICAgICBzY2FsZSA9IG1heFNpemUgLyBNYXRoLm1heChpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTsKICAgICAgfQogICAgICBpZiAoc2NhbGUgPCAxIHx8IG5lZWRzUG93ZXJPZlR3byA9PT0gdHJ1ZSkgewogICAgICAgIGlmICh0eXBlb2YgSFRNTEltYWdlRWxlbWVudCAhPT0gInVuZGVmaW5lZCIgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50IHx8IHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCAhPT0gInVuZGVmaW5lZCIgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCB8fCB0eXBlb2YgSW1hZ2VCaXRtYXAgIT09ICJ1bmRlZmluZWQiICYmIGltYWdlIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXApIHsKICAgICAgICAgIGNvbnN0IGZsb29yID0gbmVlZHNQb3dlck9mVHdvID8gZmxvb3JQb3dlck9mVHdvIDogTWF0aC5mbG9vcjsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gZmxvb3Ioc2NhbGUgKiBpbWFnZS53aWR0aCk7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBmbG9vcihzY2FsZSAqIGltYWdlLmhlaWdodCk7CiAgICAgICAgICBpZiAoX2NhbnZhczIgPT09IHZvaWQgMCkKICAgICAgICAgICAgX2NhbnZhczIgPSBjcmVhdGVDYW52YXMod2lkdGgsIGhlaWdodCk7CiAgICAgICAgICBjb25zdCBjYW52YXMgPSBuZWVkc05ld0NhbnZhcyA/IGNyZWF0ZUNhbnZhcyh3aWR0aCwgaGVpZ2h0KSA6IF9jYW52YXMyOwogICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIGhhcyBiZWVuIHJlc2l6ZWQgZnJvbSAoIiArIGltYWdlLndpZHRoICsgIngiICsgaW1hZ2UuaGVpZ2h0ICsgIikgdG8gKCIgKyB3aWR0aCArICJ4IiArIGhlaWdodCArICIpLiIpOwogICAgICAgICAgcmV0dXJuIGNhbnZhczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCJkYXRhIiBpbiBpbWFnZSkgewogICAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IEltYWdlIGluIERhdGFUZXh0dXJlIGlzIHRvbyBiaWcgKCIgKyBpbWFnZS53aWR0aCArICJ4IiArIGltYWdlLmhlaWdodCArICIpLiIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGltYWdlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gaW1hZ2U7CiAgICB9CiAgICBmdW5jdGlvbiBpc1Bvd2VyT2ZUd28kMShpbWFnZSkgewogICAgICByZXR1cm4gaXNQb3dlck9mVHdvKGltYWdlLndpZHRoKSAmJiBpc1Bvd2VyT2ZUd28oaW1hZ2UuaGVpZ2h0KTsKICAgIH0KICAgIGZ1bmN0aW9uIHRleHR1cmVOZWVkc1Bvd2VyT2ZUd28odGV4dHVyZSkgewogICAgICBpZiAoaXNXZWJHTDIpCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4gdGV4dHVyZS53cmFwUyAhPT0gQ2xhbXBUb0VkZ2VXcmFwcGluZyB8fCB0ZXh0dXJlLndyYXBUICE9PSBDbGFtcFRvRWRnZVdyYXBwaW5nIHx8IHRleHR1cmUubWluRmlsdGVyICE9PSBOZWFyZXN0RmlsdGVyICYmIHRleHR1cmUubWluRmlsdGVyICE9PSBMaW5lYXJGaWx0ZXI7CiAgICB9CiAgICBmdW5jdGlvbiB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHModGV4dHVyZSwgc3VwcG9ydHNNaXBzKSB7CiAgICAgIHJldHVybiB0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyAmJiBzdXBwb3J0c01pcHMgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhckZpbHRlcjsKICAgIH0KICAgIGZ1bmN0aW9uIGdlbmVyYXRlTWlwbWFwKHRhcmdldCwgdGV4dHVyZSwgd2lkdGgsIGhlaWdodCwgZGVwdGggPSAxKSB7CiAgICAgIF9nbC5nZW5lcmF0ZU1pcG1hcCh0YXJnZXQpOwogICAgICBjb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KHRleHR1cmUpOwogICAgICB0ZXh0dXJlUHJvcGVydGllcy5fX21heE1pcExldmVsID0gTWF0aC5sb2cyKE1hdGgubWF4KHdpZHRoLCBoZWlnaHQsIGRlcHRoKSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRJbnRlcm5hbEZvcm1hdChpbnRlcm5hbEZvcm1hdE5hbWUsIGdsRm9ybWF0LCBnbFR5cGUpIHsKICAgICAgaWYgKGlzV2ViR0wyID09PSBmYWxzZSkKICAgICAgICByZXR1cm4gZ2xGb3JtYXQ7CiAgICAgIGlmIChpbnRlcm5hbEZvcm1hdE5hbWUgIT09IG51bGwpIHsKICAgICAgICBpZiAoX2dsW2ludGVybmFsRm9ybWF0TmFtZV0gIT09IHZvaWQgMCkKICAgICAgICAgIHJldHVybiBfZ2xbaW50ZXJuYWxGb3JtYXROYW1lXTsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gdXNlIG5vbi1leGlzdGluZyBXZWJHTCBpbnRlcm5hbCBmb3JtYXQgJyIgKyBpbnRlcm5hbEZvcm1hdE5hbWUgKyAiJyIpOwogICAgICB9CiAgICAgIGxldCBpbnRlcm5hbEZvcm1hdCA9IGdsRm9ybWF0OwogICAgICBpZiAoZ2xGb3JtYXQgPT09IDY0MDMpIHsKICAgICAgICBpZiAoZ2xUeXBlID09PSA1MTI2KQogICAgICAgICAgaW50ZXJuYWxGb3JtYXQgPSAzMzMyNjsKICAgICAgICBpZiAoZ2xUeXBlID09PSA1MTMxKQogICAgICAgICAgaW50ZXJuYWxGb3JtYXQgPSAzMzMyNTsKICAgICAgICBpZiAoZ2xUeXBlID09PSA1MTIxKQogICAgICAgICAgaW50ZXJuYWxGb3JtYXQgPSAzMzMyMTsKICAgICAgfQogICAgICBpZiAoZ2xGb3JtYXQgPT09IDY0MDcpIHsKICAgICAgICBpZiAoZ2xUeXBlID09PSA1MTI2KQogICAgICAgICAgaW50ZXJuYWxGb3JtYXQgPSAzNDgzNzsKICAgICAgICBpZiAoZ2xUeXBlID09PSA1MTMxKQogICAgICAgICAgaW50ZXJuYWxGb3JtYXQgPSAzNDg0MzsKICAgICAgICBpZiAoZ2xUeXBlID09PSA1MTIxKQogICAgICAgICAgaW50ZXJuYWxGb3JtYXQgPSAzMjg0OTsKICAgICAgfQogICAgICBpZiAoZ2xGb3JtYXQgPT09IDY0MDgpIHsKICAgICAgICBpZiAoZ2xUeXBlID09PSA1MTI2KQogICAgICAgICAgaW50ZXJuYWxGb3JtYXQgPSAzNDgzNjsKICAgICAgICBpZiAoZ2xUeXBlID09PSA1MTMxKQogICAgICAgICAgaW50ZXJuYWxGb3JtYXQgPSAzNDg0MjsKICAgICAgICBpZiAoZ2xUeXBlID09PSA1MTIxKQogICAgICAgICAgaW50ZXJuYWxGb3JtYXQgPSAzMjg1NjsKICAgICAgfQogICAgICBpZiAoaW50ZXJuYWxGb3JtYXQgPT09IDMzMzI1IHx8IGludGVybmFsRm9ybWF0ID09PSAzMzMyNiB8fCBpbnRlcm5hbEZvcm1hdCA9PT0gMzQ4NDIgfHwgaW50ZXJuYWxGb3JtYXQgPT09IDM0ODM2KSB7CiAgICAgICAgZXh0ZW5zaW9ucy5nZXQoIkVYVF9jb2xvcl9idWZmZXJfZmxvYXQiKTsKICAgICAgfQogICAgICByZXR1cm4gaW50ZXJuYWxGb3JtYXQ7CiAgICB9CiAgICBmdW5jdGlvbiBmaWx0ZXJGYWxsYmFjayhmKSB7CiAgICAgIGlmIChmID09PSBOZWFyZXN0RmlsdGVyIHx8IGYgPT09IE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyIHx8IGYgPT09IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIpIHsKICAgICAgICByZXR1cm4gOTcyODsKICAgICAgfQogICAgICByZXR1cm4gOTcyOTsKICAgIH0KICAgIGZ1bmN0aW9uIG9uVGV4dHVyZURpc3Bvc2UoZXZlbnQpIHsKICAgICAgY29uc3QgdGV4dHVyZSA9IGV2ZW50LnRhcmdldDsKICAgICAgdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCJkaXNwb3NlIiwgb25UZXh0dXJlRGlzcG9zZSk7CiAgICAgIGRlYWxsb2NhdGVUZXh0dXJlKHRleHR1cmUpOwogICAgICBpZiAodGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSkgewogICAgICAgIF92aWRlb1RleHR1cmVzLmRlbGV0ZSh0ZXh0dXJlKTsKICAgICAgfQogICAgICBpbmZvLm1lbW9yeS50ZXh0dXJlcy0tOwogICAgfQogICAgZnVuY3Rpb24gb25SZW5kZXJUYXJnZXREaXNwb3NlKGV2ZW50KSB7CiAgICAgIGNvbnN0IHJlbmRlclRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgICAgcmVuZGVyVGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoImRpc3Bvc2UiLCBvblJlbmRlclRhcmdldERpc3Bvc2UpOwogICAgICBkZWFsbG9jYXRlUmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCk7CiAgICB9CiAgICBmdW5jdGlvbiBkZWFsbG9jYXRlVGV4dHVyZSh0ZXh0dXJlKSB7CiAgICAgIGNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQodGV4dHVyZSk7CiAgICAgIGlmICh0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsSW5pdCA9PT0gdm9pZCAwKQogICAgICAgIHJldHVybjsKICAgICAgX2dsLmRlbGV0ZVRleHR1cmUodGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUpOwogICAgICBwcm9wZXJ0aWVzLnJlbW92ZSh0ZXh0dXJlKTsKICAgIH0KICAgIGZ1bmN0aW9uIGRlYWxsb2NhdGVSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0KSB7CiAgICAgIGNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KHJlbmRlclRhcmdldCk7CiAgICAgIGNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQodGV4dHVyZSk7CiAgICAgIGlmICghcmVuZGVyVGFyZ2V0KQogICAgICAgIHJldHVybjsKICAgICAgaWYgKHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICE9PSB2b2lkIDApIHsKICAgICAgICBfZ2wuZGVsZXRlVGV4dHVyZSh0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSk7CiAgICAgICAgaW5mby5tZW1vcnkudGV4dHVyZXMtLTsKICAgICAgfQogICAgICBpZiAocmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSkgewogICAgICAgIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuZGlzcG9zZSgpOwogICAgICB9CiAgICAgIGlmIChyZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgICAgX2dsLmRlbGV0ZUZyYW1lYnVmZmVyKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyW2ldKTsKICAgICAgICAgIGlmIChyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlcikKICAgICAgICAgICAgX2dsLmRlbGV0ZVJlbmRlcmJ1ZmZlcihyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlcltpXSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIF9nbC5kZWxldGVGcmFtZWJ1ZmZlcihyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlcik7CiAgICAgICAgaWYgKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyKQogICAgICAgICAgX2dsLmRlbGV0ZVJlbmRlcmJ1ZmZlcihyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlcik7CiAgICAgICAgaWYgKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyKQogICAgICAgICAgX2dsLmRlbGV0ZUZyYW1lYnVmZmVyKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyKTsKICAgICAgICBpZiAocmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXIpCiAgICAgICAgICBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyKTsKICAgICAgICBpZiAocmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhSZW5kZXJidWZmZXIpCiAgICAgICAgICBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyKTsKICAgICAgfQogICAgICBpZiAocmVuZGVyVGFyZ2V0LmlzV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSB0ZXh0dXJlLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGF0dGFjaG1lbnRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQodGV4dHVyZVtpXSk7CiAgICAgICAgICBpZiAoYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUpIHsKICAgICAgICAgICAgX2dsLmRlbGV0ZVRleHR1cmUoYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUpOwogICAgICAgICAgICBpbmZvLm1lbW9yeS50ZXh0dXJlcy0tOwogICAgICAgICAgfQogICAgICAgICAgcHJvcGVydGllcy5yZW1vdmUodGV4dHVyZVtpXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHByb3BlcnRpZXMucmVtb3ZlKHRleHR1cmUpOwogICAgICBwcm9wZXJ0aWVzLnJlbW92ZShyZW5kZXJUYXJnZXQpOwogICAgfQogICAgbGV0IHRleHR1cmVVbml0cyA9IDA7CiAgICBmdW5jdGlvbiByZXNldFRleHR1cmVVbml0cygpIHsKICAgICAgdGV4dHVyZVVuaXRzID0gMDsKICAgIH0KICAgIGZ1bmN0aW9uIGFsbG9jYXRlVGV4dHVyZVVuaXQoKSB7CiAgICAgIGNvbnN0IHRleHR1cmVVbml0ID0gdGV4dHVyZVVuaXRzOwogICAgICBpZiAodGV4dHVyZVVuaXQgPj0gbWF4VGV4dHVyZXMpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMVGV4dHVyZXM6IFRyeWluZyB0byB1c2UgIiArIHRleHR1cmVVbml0ICsgIiB0ZXh0dXJlIHVuaXRzIHdoaWxlIHRoaXMgR1BVIHN1cHBvcnRzIG9ubHkgIiArIG1heFRleHR1cmVzKTsKICAgICAgfQogICAgICB0ZXh0dXJlVW5pdHMgKz0gMTsKICAgICAgcmV0dXJuIHRleHR1cmVVbml0OwogICAgfQogICAgZnVuY3Rpb24gc2V0VGV4dHVyZTJEKHRleHR1cmUsIHNsb3QpIHsKICAgICAgY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCh0ZXh0dXJlKTsKICAgICAgaWYgKHRleHR1cmUuaXNWaWRlb1RleHR1cmUpCiAgICAgICAgdXBkYXRlVmlkZW9UZXh0dXJlKHRleHR1cmUpOwogICAgICBpZiAodGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbikgewogICAgICAgIGNvbnN0IGltYWdlID0gdGV4dHVyZS5pbWFnZTsKICAgICAgICBpZiAoaW1hZ2UgPT09IHZvaWQgMCkgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIG1hcmtlZCBmb3IgdXBkYXRlIGJ1dCBpbWFnZSBpcyB1bmRlZmluZWQiKTsKICAgICAgICB9IGVsc2UgaWYgKGltYWdlLmNvbXBsZXRlID09PSBmYWxzZSkgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIG1hcmtlZCBmb3IgdXBkYXRlIGJ1dCBpbWFnZSBpcyBpbmNvbXBsZXRlIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHVwbG9hZFRleHR1cmUodGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgICBzdGF0ZS5hY3RpdmVUZXh0dXJlKDMzOTg0ICsgc2xvdCk7CiAgICAgIHN0YXRlLmJpbmRUZXh0dXJlKDM1NTMsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldFRleHR1cmUyREFycmF5KHRleHR1cmUsIHNsb3QpIHsKICAgICAgY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCh0ZXh0dXJlKTsKICAgICAgaWYgKHRleHR1cmUudmVyc2lvbiA+IDAgJiYgdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uICE9PSB0ZXh0dXJlLnZlcnNpb24pIHsKICAgICAgICB1cGxvYWRUZXh0dXJlKHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc3RhdGUuYWN0aXZlVGV4dHVyZSgzMzk4NCArIHNsb3QpOwogICAgICBzdGF0ZS5iaW5kVGV4dHVyZSgzNTg2NiwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUpOwogICAgfQogICAgZnVuY3Rpb24gc2V0VGV4dHVyZTNEKHRleHR1cmUsIHNsb3QpIHsKICAgICAgY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCh0ZXh0dXJlKTsKICAgICAgaWYgKHRleHR1cmUudmVyc2lvbiA+IDAgJiYgdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uICE9PSB0ZXh0dXJlLnZlcnNpb24pIHsKICAgICAgICB1cGxvYWRUZXh0dXJlKHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc3RhdGUuYWN0aXZlVGV4dHVyZSgzMzk4NCArIHNsb3QpOwogICAgICBzdGF0ZS5iaW5kVGV4dHVyZSgzMjg3OSwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUpOwogICAgfQogICAgZnVuY3Rpb24gc2V0VGV4dHVyZUN1YmUodGV4dHVyZSwgc2xvdCkgewogICAgICBjb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KHRleHR1cmUpOwogICAgICBpZiAodGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbikgewogICAgICAgIHVwbG9hZEN1YmVUZXh0dXJlKHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc3RhdGUuYWN0aXZlVGV4dHVyZSgzMzk4NCArIHNsb3QpOwogICAgICBzdGF0ZS5iaW5kVGV4dHVyZSgzNDA2NywgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUpOwogICAgfQogICAgY29uc3Qgd3JhcHBpbmdUb0dMID0gewogICAgICBbUmVwZWF0V3JhcHBpbmddOiAxMDQ5NywKICAgICAgW0NsYW1wVG9FZGdlV3JhcHBpbmddOiAzMzA3MSwKICAgICAgW01pcnJvcmVkUmVwZWF0V3JhcHBpbmddOiAzMzY0OAogICAgfTsKICAgIGNvbnN0IGZpbHRlclRvR0wgPSB7CiAgICAgIFtOZWFyZXN0RmlsdGVyXTogOTcyOCwKICAgICAgW05lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyXTogOTk4NCwKICAgICAgW05lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXJdOiA5OTg2LAogICAgICBbTGluZWFyRmlsdGVyXTogOTcyOSwKICAgICAgW0xpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXJdOiA5OTg1LAogICAgICBbTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyXTogOTk4NwogICAgfTsKICAgIGZ1bmN0aW9uIHNldFRleHR1cmVQYXJhbWV0ZXJzKHRleHR1cmVUeXBlLCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMpIHsKICAgICAgaWYgKHN1cHBvcnRzTWlwcykgewogICAgICAgIF9nbC50ZXhQYXJhbWV0ZXJpKHRleHR1cmVUeXBlLCAxMDI0Miwgd3JhcHBpbmdUb0dMW3RleHR1cmUud3JhcFNdKTsKICAgICAgICBfZ2wudGV4UGFyYW1ldGVyaSh0ZXh0dXJlVHlwZSwgMTAyNDMsIHdyYXBwaW5nVG9HTFt0ZXh0dXJlLndyYXBUXSk7CiAgICAgICAgaWYgKHRleHR1cmVUeXBlID09PSAzMjg3OSB8fCB0ZXh0dXJlVHlwZSA9PT0gMzU4NjYpIHsKICAgICAgICAgIF9nbC50ZXhQYXJhbWV0ZXJpKHRleHR1cmVUeXBlLCAzMjg4Miwgd3JhcHBpbmdUb0dMW3RleHR1cmUud3JhcFJdKTsKICAgICAgICB9CiAgICAgICAgX2dsLnRleFBhcmFtZXRlcmkodGV4dHVyZVR5cGUsIDEwMjQwLCBmaWx0ZXJUb0dMW3RleHR1cmUubWFnRmlsdGVyXSk7CiAgICAgICAgX2dsLnRleFBhcmFtZXRlcmkodGV4dHVyZVR5cGUsIDEwMjQxLCBmaWx0ZXJUb0dMW3RleHR1cmUubWluRmlsdGVyXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX2dsLnRleFBhcmFtZXRlcmkodGV4dHVyZVR5cGUsIDEwMjQyLCAzMzA3MSk7CiAgICAgICAgX2dsLnRleFBhcmFtZXRlcmkodGV4dHVyZVR5cGUsIDEwMjQzLCAzMzA3MSk7CiAgICAgICAgaWYgKHRleHR1cmVUeXBlID09PSAzMjg3OSB8fCB0ZXh0dXJlVHlwZSA9PT0gMzU4NjYpIHsKICAgICAgICAgIF9nbC50ZXhQYXJhbWV0ZXJpKHRleHR1cmVUeXBlLCAzMjg4MiwgMzMwNzEpOwogICAgICAgIH0KICAgICAgICBpZiAodGV4dHVyZS53cmFwUyAhPT0gQ2xhbXBUb0VkZ2VXcmFwcGluZyB8fCB0ZXh0dXJlLndyYXBUICE9PSBDbGFtcFRvRWRnZVdyYXBwaW5nKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IFRleHR1cmUgaXMgbm90IHBvd2VyIG9mIHR3by4gVGV4dHVyZS53cmFwUyBhbmQgVGV4dHVyZS53cmFwVCBzaG91bGQgYmUgc2V0IHRvIFRIUkVFLkNsYW1wVG9FZGdlV3JhcHBpbmcuIik7CiAgICAgICAgfQogICAgICAgIF9nbC50ZXhQYXJhbWV0ZXJpKHRleHR1cmVUeXBlLCAxMDI0MCwgZmlsdGVyRmFsbGJhY2sodGV4dHVyZS5tYWdGaWx0ZXIpKTsKICAgICAgICBfZ2wudGV4UGFyYW1ldGVyaSh0ZXh0dXJlVHlwZSwgMTAyNDEsIGZpbHRlckZhbGxiYWNrKHRleHR1cmUubWluRmlsdGVyKSk7CiAgICAgICAgaWYgKHRleHR1cmUubWluRmlsdGVyICE9PSBOZWFyZXN0RmlsdGVyICYmIHRleHR1cmUubWluRmlsdGVyICE9PSBMaW5lYXJGaWx0ZXIpIHsKICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBpcyBub3QgcG93ZXIgb2YgdHdvLiBUZXh0dXJlLm1pbkZpbHRlciBzaG91bGQgYmUgc2V0IHRvIFRIUkVFLk5lYXJlc3RGaWx0ZXIgb3IgVEhSRUUuTGluZWFyRmlsdGVyLiIpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoZXh0ZW5zaW9ucy5oYXMoIkVYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYyIpID09PSB0cnVlKSB7CiAgICAgICAgY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoIkVYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYyIpOwogICAgICAgIGlmICh0ZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSAmJiBleHRlbnNpb25zLmhhcygiT0VTX3RleHR1cmVfZmxvYXRfbGluZWFyIikgPT09IGZhbHNlKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChpc1dlYkdMMiA9PT0gZmFsc2UgJiYgKHRleHR1cmUudHlwZSA9PT0gSGFsZkZsb2F0VHlwZSAmJiBleHRlbnNpb25zLmhhcygiT0VTX3RleHR1cmVfaGFsZl9mbG9hdF9saW5lYXIiKSA9PT0gZmFsc2UpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICh0ZXh0dXJlLmFuaXNvdHJvcHkgPiAxIHx8IHByb3BlcnRpZXMuZ2V0KHRleHR1cmUpLl9fY3VycmVudEFuaXNvdHJvcHkpIHsKICAgICAgICAgIF9nbC50ZXhQYXJhbWV0ZXJmKHRleHR1cmVUeXBlLCBleHRlbnNpb24uVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQsIE1hdGgubWluKHRleHR1cmUuYW5pc290cm9weSwgY2FwYWJpbGl0aWVzLmdldE1heEFuaXNvdHJvcHkoKSkpOwogICAgICAgICAgcHJvcGVydGllcy5nZXQodGV4dHVyZSkuX19jdXJyZW50QW5pc290cm9weSA9IHRleHR1cmUuYW5pc290cm9weTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGluaXRUZXh0dXJlKHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlKSB7CiAgICAgIGlmICh0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsSW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbEluaXQgPSB0cnVlOwogICAgICAgIHRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lcigiZGlzcG9zZSIsIG9uVGV4dHVyZURpc3Bvc2UpOwogICAgICAgIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID0gX2dsLmNyZWF0ZVRleHR1cmUoKTsKICAgICAgICBpbmZvLm1lbW9yeS50ZXh0dXJlcysrOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB1cGxvYWRUZXh0dXJlKHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90KSB7CiAgICAgIGxldCB0ZXh0dXJlVHlwZSA9IDM1NTM7CiAgICAgIGlmICh0ZXh0dXJlLmlzRGF0YVRleHR1cmUyREFycmF5KQogICAgICAgIHRleHR1cmVUeXBlID0gMzU4NjY7CiAgICAgIGlmICh0ZXh0dXJlLmlzRGF0YVRleHR1cmUzRCkKICAgICAgICB0ZXh0dXJlVHlwZSA9IDMyODc5OwogICAgICBpbml0VGV4dHVyZSh0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSk7CiAgICAgIHN0YXRlLmFjdGl2ZVRleHR1cmUoMzM5ODQgKyBzbG90KTsKICAgICAgc3RhdGUuYmluZFRleHR1cmUodGV4dHVyZVR5cGUsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlKTsKICAgICAgX2dsLnBpeGVsU3RvcmVpKDM3NDQwLCB0ZXh0dXJlLmZsaXBZKTsKICAgICAgX2dsLnBpeGVsU3RvcmVpKDM3NDQxLCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEpOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzMxNywgdGV4dHVyZS51bnBhY2tBbGlnbm1lbnQpOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzc0NDMsIDApOwogICAgICBjb25zdCBuZWVkc1Bvd2VyT2ZUd28gPSB0ZXh0dXJlTmVlZHNQb3dlck9mVHdvKHRleHR1cmUpICYmIGlzUG93ZXJPZlR3byQxKHRleHR1cmUuaW1hZ2UpID09PSBmYWxzZTsKICAgICAgY29uc3QgaW1hZ2UgPSByZXNpemVJbWFnZSh0ZXh0dXJlLmltYWdlLCBuZWVkc1Bvd2VyT2ZUd28sIGZhbHNlLCBtYXhUZXh0dXJlU2l6ZSk7CiAgICAgIGNvbnN0IHN1cHBvcnRzTWlwcyA9IGlzUG93ZXJPZlR3byQxKGltYWdlKSB8fCBpc1dlYkdMMiwgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KHRleHR1cmUuZm9ybWF0KTsKICAgICAgbGV0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQodGV4dHVyZS50eXBlKSwgZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUpOwogICAgICBzZXRUZXh0dXJlUGFyYW1ldGVycyh0ZXh0dXJlVHlwZSwgdGV4dHVyZSwgc3VwcG9ydHNNaXBzKTsKICAgICAgbGV0IG1pcG1hcDsKICAgICAgY29uc3QgbWlwbWFwcyA9IHRleHR1cmUubWlwbWFwczsKICAgICAgaWYgKHRleHR1cmUuaXNEZXB0aFRleHR1cmUpIHsKICAgICAgICBnbEludGVybmFsRm9ybWF0ID0gNjQwMjsKICAgICAgICBpZiAoaXNXZWJHTDIpIHsKICAgICAgICAgIGlmICh0ZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSkgewogICAgICAgICAgICBnbEludGVybmFsRm9ybWF0ID0gMzYwMTI7CiAgICAgICAgICB9IGVsc2UgaWYgKHRleHR1cmUudHlwZSA9PT0gVW5zaWduZWRJbnRUeXBlKSB7CiAgICAgICAgICAgIGdsSW50ZXJuYWxGb3JtYXQgPSAzMzE5MDsKICAgICAgICAgIH0gZWxzZSBpZiAodGV4dHVyZS50eXBlID09PSBVbnNpZ25lZEludDI0OFR5cGUpIHsKICAgICAgICAgICAgZ2xJbnRlcm5hbEZvcm1hdCA9IDM1MDU2OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ2xJbnRlcm5hbEZvcm1hdCA9IDMzMTg5OwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGV4dHVyZS50eXBlID09PSBGbG9hdFR5cGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiV2ViR0xSZW5kZXJlcjogRmxvYXRpbmcgcG9pbnQgZGVwdGggdGV4dHVyZSByZXF1aXJlcyBXZWJHTDIuIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0ZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhGb3JtYXQgJiYgZ2xJbnRlcm5hbEZvcm1hdCA9PT0gNjQwMikgewogICAgICAgICAgaWYgKHRleHR1cmUudHlwZSAhPT0gVW5zaWduZWRTaG9ydFR5cGUgJiYgdGV4dHVyZS50eXBlICE9PSBVbnNpZ25lZEludFR5cGUpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiBVc2UgVW5zaWduZWRTaG9ydFR5cGUgb3IgVW5zaWduZWRJbnRUeXBlIGZvciBEZXB0aEZvcm1hdCBEZXB0aFRleHR1cmUuIik7CiAgICAgICAgICAgIHRleHR1cmUudHlwZSA9IFVuc2lnbmVkU2hvcnRUeXBlOwogICAgICAgICAgICBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KHRleHR1cmUudHlwZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0ZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0ICYmIGdsSW50ZXJuYWxGb3JtYXQgPT09IDY0MDIpIHsKICAgICAgICAgIGdsSW50ZXJuYWxGb3JtYXQgPSAzNDA0MTsKICAgICAgICAgIGlmICh0ZXh0dXJlLnR5cGUgIT09IFVuc2lnbmVkSW50MjQ4VHlwZSkgewogICAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IFVzZSBVbnNpZ25lZEludDI0OFR5cGUgZm9yIERlcHRoU3RlbmNpbEZvcm1hdCBEZXB0aFRleHR1cmUuIik7CiAgICAgICAgICAgIHRleHR1cmUudHlwZSA9IFVuc2lnbmVkSW50MjQ4VHlwZTsKICAgICAgICAgICAgZ2xUeXBlID0gdXRpbHMuY29udmVydCh0ZXh0dXJlLnR5cGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGF0ZS50ZXhJbWFnZTJEKDM1NTMsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwpOwogICAgICB9IGVsc2UgaWYgKHRleHR1cmUuaXNEYXRhVGV4dHVyZSkgewogICAgICAgIGlmIChtaXBtYXBzLmxlbmd0aCA+IDAgJiYgc3VwcG9ydHNNaXBzKSB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBtaXBtYXBzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgICAgbWlwbWFwID0gbWlwbWFwc1tpXTsKICAgICAgICAgICAgc3RhdGUudGV4SW1hZ2UyRCgzNTUzLCBpLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICAgIHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CiAgICAgICAgICB0ZXh0dXJlUHJvcGVydGllcy5fX21heE1pcExldmVsID0gbWlwbWFwcy5sZW5ndGggLSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdGF0ZS50ZXhJbWFnZTJEKDM1NTMsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEpOwogICAgICAgICAgdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IDA7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgbWlwbWFwID0gbWlwbWFwc1tpXTsKICAgICAgICAgIGlmICh0ZXh0dXJlLmZvcm1hdCAhPT0gUkdCQUZvcm1hdCAmJiB0ZXh0dXJlLmZvcm1hdCAhPT0gUkdCRm9ybWF0KSB7CiAgICAgICAgICAgIGlmIChnbEZvcm1hdCAhPT0gbnVsbCkgewogICAgICAgICAgICAgIHN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTJEKDM1NTMsIGksIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgMCwgbWlwbWFwLmRhdGEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogQXR0ZW1wdCB0byBsb2FkIHVuc3VwcG9ydGVkIGNvbXByZXNzZWQgdGV4dHVyZSBmb3JtYXQgaW4gLnVwbG9hZFRleHR1cmUoKSIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0ZS50ZXhJbWFnZTJEKDM1NTMsIGksIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0ZXh0dXJlUHJvcGVydGllcy5fX21heE1pcExldmVsID0gbWlwbWFwcy5sZW5ndGggLSAxOwogICAgICB9IGVsc2UgaWYgKHRleHR1cmUuaXNEYXRhVGV4dHVyZTJEQXJyYXkpIHsKICAgICAgICBzdGF0ZS50ZXhJbWFnZTNEKDM1ODY2LCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSk7CiAgICAgICAgdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IDA7CiAgICAgIH0gZWxzZSBpZiAodGV4dHVyZS5pc0RhdGFUZXh0dXJlM0QpIHsKICAgICAgICBzdGF0ZS50ZXhJbWFnZTNEKDMyODc5LCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSk7CiAgICAgICAgdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKG1pcG1hcHMubGVuZ3RoID4gMCAmJiBzdXBwb3J0c01pcHMpIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgICBtaXBtYXAgPSBtaXBtYXBzW2ldOwogICAgICAgICAgICBzdGF0ZS50ZXhJbWFnZTJEKDM1NTMsIGksIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCk7CiAgICAgICAgICB9CiAgICAgICAgICB0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwogICAgICAgICAgdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IG1pcG1hcHMubGVuZ3RoIC0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RhdGUudGV4SW1hZ2UyRCgzNTUzLCAwLCBnbEludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZSk7CiAgICAgICAgICB0ZXh0dXJlUHJvcGVydGllcy5fX21heE1pcExldmVsID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyh0ZXh0dXJlLCBzdXBwb3J0c01pcHMpKSB7CiAgICAgICAgZ2VuZXJhdGVNaXBtYXAodGV4dHVyZVR5cGUsIHRleHR1cmUsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICB9CiAgICAgIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9IHRleHR1cmUudmVyc2lvbjsKICAgICAgaWYgKHRleHR1cmUub25VcGRhdGUpCiAgICAgICAgdGV4dHVyZS5vblVwZGF0ZSh0ZXh0dXJlKTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwbG9hZEN1YmVUZXh0dXJlKHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90KSB7CiAgICAgIGlmICh0ZXh0dXJlLmltYWdlLmxlbmd0aCAhPT0gNikKICAgICAgICByZXR1cm47CiAgICAgIGluaXRUZXh0dXJlKHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlKTsKICAgICAgc3RhdGUuYWN0aXZlVGV4dHVyZSgzMzk4NCArIHNsb3QpOwogICAgICBzdGF0ZS5iaW5kVGV4dHVyZSgzNDA2NywgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUpOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzc0NDAsIHRleHR1cmUuZmxpcFkpOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzc0NDEsIHRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSk7CiAgICAgIF9nbC5waXhlbFN0b3JlaSgzMzE3LCB0ZXh0dXJlLnVucGFja0FsaWdubWVudCk7CiAgICAgIF9nbC5waXhlbFN0b3JlaSgzNzQ0MywgMCk7CiAgICAgIGNvbnN0IGlzQ29tcHJlc3NlZCA9IHRleHR1cmUgJiYgKHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSB8fCB0ZXh0dXJlLmltYWdlWzBdLmlzQ29tcHJlc3NlZFRleHR1cmUpOwogICAgICBjb25zdCBpc0RhdGFUZXh0dXJlID0gdGV4dHVyZS5pbWFnZVswXSAmJiB0ZXh0dXJlLmltYWdlWzBdLmlzRGF0YVRleHR1cmU7CiAgICAgIGNvbnN0IGN1YmVJbWFnZSA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGlmICghaXNDb21wcmVzc2VkICYmICFpc0RhdGFUZXh0dXJlKSB7CiAgICAgICAgICBjdWJlSW1hZ2VbaV0gPSByZXNpemVJbWFnZSh0ZXh0dXJlLmltYWdlW2ldLCBmYWxzZSwgdHJ1ZSwgbWF4Q3ViZW1hcFNpemUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdWJlSW1hZ2VbaV0gPSBpc0RhdGFUZXh0dXJlID8gdGV4dHVyZS5pbWFnZVtpXS5pbWFnZSA6IHRleHR1cmUuaW1hZ2VbaV07CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IGltYWdlID0gY3ViZUltYWdlWzBdLCBzdXBwb3J0c01pcHMgPSBpc1Bvd2VyT2ZUd28kMShpbWFnZSkgfHwgaXNXZWJHTDIsIGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCh0ZXh0dXJlLmZvcm1hdCksIGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQodGV4dHVyZS50eXBlKSwgZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUpOwogICAgICBzZXRUZXh0dXJlUGFyYW1ldGVycygzNDA2NywgdGV4dHVyZSwgc3VwcG9ydHNNaXBzKTsKICAgICAgbGV0IG1pcG1hcHM7CiAgICAgIGlmIChpc0NvbXByZXNzZWQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgICAgbWlwbWFwcyA9IGN1YmVJbWFnZVtpXS5taXBtYXBzOwogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtaXBtYXBzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG1pcG1hcCA9IG1pcG1hcHNbal07CiAgICAgICAgICAgIGlmICh0ZXh0dXJlLmZvcm1hdCAhPT0gUkdCQUZvcm1hdCAmJiB0ZXh0dXJlLmZvcm1hdCAhPT0gUkdCRm9ybWF0KSB7CiAgICAgICAgICAgICAgaWYgKGdsRm9ybWF0ICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5jb21wcmVzc2VkVGV4SW1hZ2UyRCgzNDA2OSArIGksIGosIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgMCwgbWlwbWFwLmRhdGEpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gbG9hZCB1bnN1cHBvcnRlZCBjb21wcmVzc2VkIHRleHR1cmUgZm9ybWF0IGluIC5zZXRUZXh0dXJlQ3ViZSgpIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0YXRlLnRleEltYWdlMkQoMzQwNjkgKyBpLCBqLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0ZXh0dXJlUHJvcGVydGllcy5fX21heE1pcExldmVsID0gbWlwbWFwcy5sZW5ndGggLSAxOwogICAgICB9IGVsc2UgewogICAgICAgIG1pcG1hcHMgPSB0ZXh0dXJlLm1pcG1hcHM7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICAgIGlmIChpc0RhdGFUZXh0dXJlKSB7CiAgICAgICAgICAgIHN0YXRlLnRleEltYWdlMkQoMzQwNjkgKyBpLCAwLCBnbEludGVybmFsRm9ybWF0LCBjdWJlSW1hZ2VbaV0ud2lkdGgsIGN1YmVJbWFnZVtpXS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVtpXS5kYXRhKTsKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtaXBtYXBzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgY29uc3QgbWlwbWFwID0gbWlwbWFwc1tqXTsKICAgICAgICAgICAgICBjb25zdCBtaXBtYXBJbWFnZSA9IG1pcG1hcC5pbWFnZVtpXS5pbWFnZTsKICAgICAgICAgICAgICBzdGF0ZS50ZXhJbWFnZTJEKDM0MDY5ICsgaSwgaiArIDEsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcEltYWdlLndpZHRoLCBtaXBtYXBJbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcEltYWdlLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0ZS50ZXhJbWFnZTJEKDM0MDY5ICsgaSwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgY3ViZUltYWdlW2ldKTsKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtaXBtYXBzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgY29uc3QgbWlwbWFwID0gbWlwbWFwc1tqXTsKICAgICAgICAgICAgICBzdGF0ZS50ZXhJbWFnZTJEKDM0MDY5ICsgaSwgaiArIDEsIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5pbWFnZVtpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IG1pcG1hcHMubGVuZ3RoOwogICAgICB9CiAgICAgIGlmICh0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHModGV4dHVyZSwgc3VwcG9ydHNNaXBzKSkgewogICAgICAgIGdlbmVyYXRlTWlwbWFwKDM0MDY3LCB0ZXh0dXJlLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTsKICAgICAgfQogICAgICB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gPSB0ZXh0dXJlLnZlcnNpb247CiAgICAgIGlmICh0ZXh0dXJlLm9uVXBkYXRlKQogICAgICAgIHRleHR1cmUub25VcGRhdGUodGV4dHVyZSk7CiAgICB9CiAgICBmdW5jdGlvbiBzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZShmcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBhdHRhY2htZW50LCB0ZXh0dXJlVGFyZ2V0KSB7CiAgICAgIGNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCh0ZXh0dXJlLmZvcm1hdCk7CiAgICAgIGNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQodGV4dHVyZS50eXBlKTsKICAgICAgY29uc3QgZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUpOwogICAgICBpZiAodGV4dHVyZVRhcmdldCA9PT0gMzI4NzkgfHwgdGV4dHVyZVRhcmdldCA9PT0gMzU4NjYpIHsKICAgICAgICBzdGF0ZS50ZXhJbWFnZTNEKHRleHR1cmVUYXJnZXQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCwgcmVuZGVyVGFyZ2V0LmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdGF0ZS50ZXhJbWFnZTJEKHRleHR1cmVUYXJnZXQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbnVsbCk7CiAgICAgIH0KICAgICAgc3RhdGUuYmluZEZyYW1lYnVmZmVyKDM2MTYwLCBmcmFtZWJ1ZmZlcik7CiAgICAgIF9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCgzNjE2MCwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCwgcHJvcGVydGllcy5nZXQodGV4dHVyZSkuX193ZWJnbFRleHR1cmUsIDApOwogICAgICBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoMzYxNjAsIG51bGwpOwogICAgfQogICAgZnVuY3Rpb24gc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKHJlbmRlcmJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCBpc011bHRpc2FtcGxlKSB7CiAgICAgIF9nbC5iaW5kUmVuZGVyYnVmZmVyKDM2MTYxLCByZW5kZXJidWZmZXIpOwogICAgICBpZiAocmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICYmICFyZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlcikgewogICAgICAgIGxldCBnbEludGVybmFsRm9ybWF0ID0gMzMxODk7CiAgICAgICAgaWYgKGlzTXVsdGlzYW1wbGUpIHsKICAgICAgICAgIGNvbnN0IGRlcHRoVGV4dHVyZSA9IHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmU7CiAgICAgICAgICBpZiAoZGVwdGhUZXh0dXJlICYmIGRlcHRoVGV4dHVyZS5pc0RlcHRoVGV4dHVyZSkgewogICAgICAgICAgICBpZiAoZGVwdGhUZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSkgewogICAgICAgICAgICAgIGdsSW50ZXJuYWxGb3JtYXQgPSAzNjAxMjsKICAgICAgICAgICAgfSBlbHNlIGlmIChkZXB0aFRleHR1cmUudHlwZSA9PT0gVW5zaWduZWRJbnRUeXBlKSB7CiAgICAgICAgICAgICAgZ2xJbnRlcm5hbEZvcm1hdCA9IDMzMTkwOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyhyZW5kZXJUYXJnZXQpOwogICAgICAgICAgX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZSgzNjE2MSwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoMzYxNjEsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCk7CiAgICAgICAgfQogICAgICAgIF9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlcigzNjE2MCwgMzYwOTYsIDM2MTYxLCByZW5kZXJidWZmZXIpOwogICAgICB9IGVsc2UgaWYgKHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciAmJiByZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlcikgewogICAgICAgIGlmIChpc011bHRpc2FtcGxlKSB7CiAgICAgICAgICBjb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyhyZW5kZXJUYXJnZXQpOwogICAgICAgICAgX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZSgzNjE2MSwgc2FtcGxlcywgMzUwNTYsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF9nbC5yZW5kZXJidWZmZXJTdG9yYWdlKDM2MTYxLCAzNDA0MSwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0KTsKICAgICAgICB9CiAgICAgICAgX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKDM2MTYwLCAzMzMwNiwgMzYxNjEsIHJlbmRlcmJ1ZmZlcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgdGV4dHVyZSA9IHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzID09PSB0cnVlID8gcmVuZGVyVGFyZ2V0LnRleHR1cmVbMF0gOiByZW5kZXJUYXJnZXQudGV4dHVyZTsKICAgICAgICBjb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQodGV4dHVyZS5mb3JtYXQpOwogICAgICAgIGNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQodGV4dHVyZS50eXBlKTsKICAgICAgICBjb25zdCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQodGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSk7CiAgICAgICAgaWYgKGlzTXVsdGlzYW1wbGUpIHsKICAgICAgICAgIGNvbnN0IHNhbXBsZXMgPSBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKHJlbmRlclRhcmdldCk7CiAgICAgICAgICBfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKDM2MTYxLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZSgzNjE2MSwgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgX2dsLmJpbmRSZW5kZXJidWZmZXIoMzYxNjEsIG51bGwpOwogICAgfQogICAgZnVuY3Rpb24gc2V0dXBEZXB0aFRleHR1cmUoZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCkgewogICAgICBjb25zdCBpc0N1YmUgPSByZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0OwogICAgICBpZiAoaXNDdWJlKQogICAgICAgIHRocm93IG5ldyBFcnJvcigiRGVwdGggVGV4dHVyZSB3aXRoIGN1YmUgcmVuZGVyIHRhcmdldHMgaXMgbm90IHN1cHBvcnRlZCIpOwogICAgICBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoMzYxNjAsIGZyYW1lYnVmZmVyKTsKICAgICAgaWYgKCEocmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSAmJiByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmlzRGVwdGhUZXh0dXJlKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigicmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIFRIUkVFLkRlcHRoVGV4dHVyZSIpOwogICAgICB9CiAgICAgIGlmICghcHJvcGVydGllcy5nZXQocmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSkuX193ZWJnbFRleHR1cmUgfHwgcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pbWFnZS53aWR0aCAhPT0gcmVuZGVyVGFyZ2V0LndpZHRoIHx8IHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2UuaGVpZ2h0ICE9PSByZW5kZXJUYXJnZXQuaGVpZ2h0KSB7CiAgICAgICAgcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pbWFnZS53aWR0aCA9IHJlbmRlclRhcmdldC53aWR0aDsKICAgICAgICByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmltYWdlLmhlaWdodCA9IHJlbmRlclRhcmdldC5oZWlnaHQ7CiAgICAgICAgcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIH0KICAgICAgc2V0VGV4dHVyZTJEKHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUsIDApOwogICAgICBjb25zdCB3ZWJnbERlcHRoVGV4dHVyZSA9IHByb3BlcnRpZXMuZ2V0KHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUpLl9fd2ViZ2xUZXh0dXJlOwogICAgICBpZiAocmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5mb3JtYXQgPT09IERlcHRoRm9ybWF0KSB7CiAgICAgICAgX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKDM2MTYwLCAzNjA5NiwgMzU1Mywgd2ViZ2xEZXB0aFRleHR1cmUsIDApOwogICAgICB9IGVsc2UgaWYgKHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuZm9ybWF0ID09PSBEZXB0aFN0ZW5jaWxGb3JtYXQpIHsKICAgICAgICBfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoMzYxNjAsIDMzMzA2LCAzNTUzLCB3ZWJnbERlcHRoVGV4dHVyZSwgMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGRlcHRoVGV4dHVyZSBmb3JtYXQiKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlcihyZW5kZXJUYXJnZXQpIHsKICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KHJlbmRlclRhcmdldCk7CiAgICAgIGNvbnN0IGlzQ3ViZSA9IHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCA9PT0gdHJ1ZTsKICAgICAgaWYgKHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUpIHsKICAgICAgICBpZiAoaXNDdWJlKQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ0YXJnZXQuZGVwdGhUZXh0dXJlIG5vdCBzdXBwb3J0ZWQgaW4gQ3ViZSByZW5kZXIgdGFyZ2V0cyIpOwogICAgICAgIHNldHVwRGVwdGhUZXh0dXJlKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChpc0N1YmUpIHsKICAgICAgICAgIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyID0gW107CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgICAgICBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoMzYxNjAsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyW2ldKTsKICAgICAgICAgICAgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXJbaV0gPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CiAgICAgICAgICAgIHNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZShyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlcltpXSwgcmVuZGVyVGFyZ2V0LCBmYWxzZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXRlLmJpbmRGcmFtZWJ1ZmZlcigzNjE2MCwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIpOwogICAgICAgICAgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CiAgICAgICAgICBzZXR1cFJlbmRlckJ1ZmZlclN0b3JhZ2UocmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIsIHJlbmRlclRhcmdldCwgZmFsc2UpOwogICAgICAgIH0KICAgICAgfQogICAgICBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoMzYxNjAsIG51bGwpOwogICAgfQogICAgZnVuY3Rpb24gc2V0dXBSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0KSB7CiAgICAgIGNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KHJlbmRlclRhcmdldCk7CiAgICAgIGNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQodGV4dHVyZSk7CiAgICAgIHJlbmRlclRhcmdldC5hZGRFdmVudExpc3RlbmVyKCJkaXNwb3NlIiwgb25SZW5kZXJUYXJnZXREaXNwb3NlKTsKICAgICAgaWYgKHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzICE9PSB0cnVlKSB7CiAgICAgICAgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPSBfZ2wuY3JlYXRlVGV4dHVyZSgpOwogICAgICAgIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9IHRleHR1cmUudmVyc2lvbjsKICAgICAgICBpbmZvLm1lbW9yeS50ZXh0dXJlcysrOwogICAgICB9CiAgICAgIGNvbnN0IGlzQ3ViZSA9IHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCA9PT0gdHJ1ZTsKICAgICAgY29uc3QgaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgPSByZW5kZXJUYXJnZXQuaXNXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cyA9PT0gdHJ1ZTsKICAgICAgY29uc3QgaXNNdWx0aXNhbXBsZSA9IHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQgPT09IHRydWU7CiAgICAgIGNvbnN0IGlzUmVuZGVyVGFyZ2V0M0QgPSB0ZXh0dXJlLmlzRGF0YVRleHR1cmUzRCB8fCB0ZXh0dXJlLmlzRGF0YVRleHR1cmUyREFycmF5OwogICAgICBjb25zdCBzdXBwb3J0c01pcHMgPSBpc1Bvd2VyT2ZUd28kMShyZW5kZXJUYXJnZXQpIHx8IGlzV2ViR0wyOwogICAgICBpZiAoaXNXZWJHTDIgJiYgdGV4dHVyZS5mb3JtYXQgPT09IFJHQkZvcm1hdCAmJiAodGV4dHVyZS50eXBlID09PSBGbG9hdFR5cGUgfHwgdGV4dHVyZS50eXBlID09PSBIYWxmRmxvYXRUeXBlKSkgewogICAgICAgIHRleHR1cmUuZm9ybWF0ID0gUkdCQUZvcm1hdDsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IFJlbmRlcmluZyB0byB0ZXh0dXJlcyB3aXRoIFJHQiBmb3JtYXQgaXMgbm90IHN1cHBvcnRlZC4gVXNpbmcgUkdCQSBmb3JtYXQgaW5zdGVhZC4iKTsKICAgICAgfQogICAgICBpZiAoaXNDdWJlKSB7CiAgICAgICAgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgICAgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbaV0gPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKICAgICAgICBpZiAoaXNNdWx0aXBsZVJlbmRlclRhcmdldHMpIHsKICAgICAgICAgIGlmIChjYXBhYmlsaXRpZXMuZHJhd0J1ZmZlcnMpIHsKICAgICAgICAgICAgY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IGF0dGFjaG1lbnRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQodGV4dHVyZXNbaV0pOwogICAgICAgICAgICAgIGlmIChhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSA9IF9nbC5jcmVhdGVUZXh0dXJlKCk7CiAgICAgICAgICAgICAgICBpbmZvLm1lbW9yeS50ZXh0dXJlcysrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiBXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cyBjYW4gb25seSBiZSB1c2VkIHdpdGggV2ViR0wyIG9yIFdFQkdMX2RyYXdfYnVmZmVycyBleHRlbnNpb24uIik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChpc011bHRpc2FtcGxlKSB7CiAgICAgICAgICBpZiAoaXNXZWJHTDIpIHsKICAgICAgICAgICAgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKICAgICAgICAgICAgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXIgPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CiAgICAgICAgICAgIF9nbC5iaW5kUmVuZGVyYnVmZmVyKDM2MTYxLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlcik7CiAgICAgICAgICAgIGNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCh0ZXh0dXJlLmZvcm1hdCk7CiAgICAgICAgICAgIGNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQodGV4dHVyZS50eXBlKTsKICAgICAgICAgICAgY29uc3QgZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUpOwogICAgICAgICAgICBjb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyhyZW5kZXJUYXJnZXQpOwogICAgICAgICAgICBfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKDM2MTYxLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQpOwogICAgICAgICAgICBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoMzYxNjAsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyKTsKICAgICAgICAgICAgX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKDM2MTYwLCAzNjA2NCwgMzYxNjEsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyKTsKICAgICAgICAgICAgX2dsLmJpbmRSZW5kZXJidWZmZXIoMzYxNjEsIG51bGwpOwogICAgICAgICAgICBpZiAocmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyKSB7CiAgICAgICAgICAgICAgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhSZW5kZXJidWZmZXIgPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CiAgICAgICAgICAgICAgc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyLCByZW5kZXJUYXJnZXQsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmJpbmRGcmFtZWJ1ZmZlcigzNjE2MCwgbnVsbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IFdlYkdMTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQgY2FuIG9ubHkgYmUgdXNlZCB3aXRoIFdlYkdMMi4iKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGlzQ3ViZSkgewogICAgICAgIHN0YXRlLmJpbmRUZXh0dXJlKDM0MDY3LCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSk7CiAgICAgICAgc2V0VGV4dHVyZVBhcmFtZXRlcnMoMzQwNjcsIHRleHR1cmUsIHN1cHBvcnRzTWlwcyk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICAgIHNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyW2ldLCByZW5kZXJUYXJnZXQsIHRleHR1cmUsIDM2MDY0LCAzNDA2OSArIGkpOwogICAgICAgIH0KICAgICAgICBpZiAodGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKHRleHR1cmUsIHN1cHBvcnRzTWlwcykpIHsKICAgICAgICAgIGdlbmVyYXRlTWlwbWFwKDM0MDY3LCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICBzdGF0ZS5iaW5kVGV4dHVyZSgzNDA2NywgbnVsbCk7CiAgICAgIH0gZWxzZSBpZiAoaXNNdWx0aXBsZVJlbmRlclRhcmdldHMpIHsKICAgICAgICBjb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlOwogICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IHRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGF0dGFjaG1lbnQgPSB0ZXh0dXJlc1tpXTsKICAgICAgICAgIGNvbnN0IGF0dGFjaG1lbnRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoYXR0YWNobWVudCk7CiAgICAgICAgICBzdGF0ZS5iaW5kVGV4dHVyZSgzNTUzLCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSk7CiAgICAgICAgICBzZXRUZXh0dXJlUGFyYW1ldGVycygzNTUzLCBhdHRhY2htZW50LCBzdXBwb3J0c01pcHMpOwogICAgICAgICAgc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUocmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgYXR0YWNobWVudCwgMzYwNjQgKyBpLCAzNTUzKTsKICAgICAgICAgIGlmICh0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoYXR0YWNobWVudCwgc3VwcG9ydHNNaXBzKSkgewogICAgICAgICAgICBnZW5lcmF0ZU1pcG1hcCgzNTUzLCBhdHRhY2htZW50LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGF0ZS5iaW5kVGV4dHVyZSgzNTUzLCBudWxsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsZXQgZ2xUZXh0dXJlVHlwZSA9IDM1NTM7CiAgICAgICAgaWYgKGlzUmVuZGVyVGFyZ2V0M0QpIHsKICAgICAgICAgIGlmIChpc1dlYkdMMikgewogICAgICAgICAgICBjb25zdCBpc1RleHR1cmUzRCA9IHRleHR1cmUuaXNEYXRhVGV4dHVyZTNEOwogICAgICAgICAgICBnbFRleHR1cmVUeXBlID0gaXNUZXh0dXJlM0QgPyAzMjg3OSA6IDM1ODY2OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5EYXRhVGV4dHVyZTNEIGFuZCBUSFJFRS5EYXRhVGV4dHVyZTJEQXJyYXkgb25seSBzdXBwb3J0ZWQgd2l0aCBXZWJHTDIuIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0YXRlLmJpbmRUZXh0dXJlKGdsVGV4dHVyZVR5cGUsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlKTsKICAgICAgICBzZXRUZXh0dXJlUGFyYW1ldGVycyhnbFRleHR1cmVUeXBlLCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMpOwogICAgICAgIHNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQsIHRleHR1cmUsIDM2MDY0LCBnbFRleHR1cmVUeXBlKTsKICAgICAgICBpZiAodGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKHRleHR1cmUsIHN1cHBvcnRzTWlwcykpIHsKICAgICAgICAgIGdlbmVyYXRlTWlwbWFwKGdsVGV4dHVyZVR5cGUsIHRleHR1cmUsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCwgcmVuZGVyVGFyZ2V0LmRlcHRoKTsKICAgICAgICB9CiAgICAgICAgc3RhdGUuYmluZFRleHR1cmUoZ2xUZXh0dXJlVHlwZSwgbnVsbCk7CiAgICAgIH0KICAgICAgaWYgKHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlcikgewogICAgICAgIHNldHVwRGVwdGhSZW5kZXJidWZmZXIocmVuZGVyVGFyZ2V0KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gdXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKHJlbmRlclRhcmdldCkgewogICAgICBjb25zdCBzdXBwb3J0c01pcHMgPSBpc1Bvd2VyT2ZUd28kMShyZW5kZXJUYXJnZXQpIHx8IGlzV2ViR0wyOwogICAgICBjb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzID09PSB0cnVlID8gcmVuZGVyVGFyZ2V0LnRleHR1cmUgOiBbcmVuZGVyVGFyZ2V0LnRleHR1cmVdOwogICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSB0ZXh0dXJlcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzW2ldOwogICAgICAgIGlmICh0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHModGV4dHVyZSwgc3VwcG9ydHNNaXBzKSkgewogICAgICAgICAgY29uc3QgdGFyZ2V0ID0gcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ID8gMzQwNjcgOiAzNTUzOwogICAgICAgICAgY29uc3Qgd2ViZ2xUZXh0dXJlID0gcHJvcGVydGllcy5nZXQodGV4dHVyZSkuX193ZWJnbFRleHR1cmU7CiAgICAgICAgICBzdGF0ZS5iaW5kVGV4dHVyZSh0YXJnZXQsIHdlYmdsVGV4dHVyZSk7CiAgICAgICAgICBnZW5lcmF0ZU1pcG1hcCh0YXJnZXQsIHRleHR1cmUsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCk7CiAgICAgICAgICBzdGF0ZS5iaW5kVGV4dHVyZSh0YXJnZXQsIG51bGwpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0KSB7CiAgICAgIGlmIChyZW5kZXJUYXJnZXQuaXNXZWJHTE11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KSB7CiAgICAgICAgaWYgKGlzV2ViR0wyKSB7CiAgICAgICAgICBjb25zdCB3aWR0aCA9IHJlbmRlclRhcmdldC53aWR0aDsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IHJlbmRlclRhcmdldC5oZWlnaHQ7CiAgICAgICAgICBsZXQgbWFzayA9IDE2Mzg0OwogICAgICAgICAgaWYgKHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlcikKICAgICAgICAgICAgbWFzayB8PSAyNTY7CiAgICAgICAgICBpZiAocmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIpCiAgICAgICAgICAgIG1hc2sgfD0gMTAyNDsKICAgICAgICAgIGNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldChyZW5kZXJUYXJnZXQpOwogICAgICAgICAgc3RhdGUuYmluZEZyYW1lYnVmZmVyKDM2MDA4LCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlcik7CiAgICAgICAgICBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoMzYwMDksIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyKTsKICAgICAgICAgIF9nbC5ibGl0RnJhbWVidWZmZXIoMCwgMCwgd2lkdGgsIGhlaWdodCwgMCwgMCwgd2lkdGgsIGhlaWdodCwgbWFzaywgOTcyOCk7CiAgICAgICAgICBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoMzYwMDgsIG51bGwpOwogICAgICAgICAgc3RhdGUuYmluZEZyYW1lYnVmZmVyKDM2MDA5LCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogV2ViR0xNdWx0aXNhbXBsZVJlbmRlclRhcmdldCBjYW4gb25seSBiZSB1c2VkIHdpdGggV2ViR0wyLiIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyhyZW5kZXJUYXJnZXQpIHsKICAgICAgcmV0dXJuIGlzV2ViR0wyICYmIHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQgPyBNYXRoLm1pbihtYXhTYW1wbGVzLCByZW5kZXJUYXJnZXQuc2FtcGxlcykgOiAwOwogICAgfQogICAgZnVuY3Rpb24gdXBkYXRlVmlkZW9UZXh0dXJlKHRleHR1cmUpIHsKICAgICAgY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKICAgICAgaWYgKF92aWRlb1RleHR1cmVzLmdldCh0ZXh0dXJlKSAhPT0gZnJhbWUpIHsKICAgICAgICBfdmlkZW9UZXh0dXJlcy5zZXQodGV4dHVyZSwgZnJhbWUpOwogICAgICAgIHRleHR1cmUudXBkYXRlKCk7CiAgICAgIH0KICAgIH0KICAgIGxldCB3YXJuZWRUZXh0dXJlMkQgPSBmYWxzZTsKICAgIGxldCB3YXJuZWRUZXh0dXJlQ3ViZSA9IGZhbHNlOwogICAgZnVuY3Rpb24gc2FmZVNldFRleHR1cmUyRCh0ZXh0dXJlLCBzbG90KSB7CiAgICAgIGlmICh0ZXh0dXJlICYmIHRleHR1cmUuaXNXZWJHTFJlbmRlclRhcmdldCkgewogICAgICAgIGlmICh3YXJuZWRUZXh0dXJlMkQgPT09IGZhbHNlKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMVGV4dHVyZXMuc2FmZVNldFRleHR1cmUyRDogZG9uJ3QgdXNlIHJlbmRlciB0YXJnZXRzIGFzIHRleHR1cmVzLiBVc2UgdGhlaXIgLnRleHR1cmUgcHJvcGVydHkgaW5zdGVhZC4iKTsKICAgICAgICAgIHdhcm5lZFRleHR1cmUyRCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHRleHR1cmUgPSB0ZXh0dXJlLnRleHR1cmU7CiAgICAgIH0KICAgICAgc2V0VGV4dHVyZTJEKHRleHR1cmUsIHNsb3QpOwogICAgfQogICAgZnVuY3Rpb24gc2FmZVNldFRleHR1cmVDdWJlKHRleHR1cmUsIHNsb3QpIHsKICAgICAgaWYgKHRleHR1cmUgJiYgdGV4dHVyZS5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCkgewogICAgICAgIGlmICh3YXJuZWRUZXh0dXJlQ3ViZSA9PT0gZmFsc2UpIHsKICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xUZXh0dXJlcy5zYWZlU2V0VGV4dHVyZUN1YmU6IGRvbid0IHVzZSBjdWJlIHJlbmRlciB0YXJnZXRzIGFzIHRleHR1cmVzLiBVc2UgdGhlaXIgLnRleHR1cmUgcHJvcGVydHkgaW5zdGVhZC4iKTsKICAgICAgICAgIHdhcm5lZFRleHR1cmVDdWJlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgdGV4dHVyZSA9IHRleHR1cmUudGV4dHVyZTsKICAgICAgfQogICAgICBzZXRUZXh0dXJlQ3ViZSh0ZXh0dXJlLCBzbG90KTsKICAgIH0KICAgIHRoaXMuYWxsb2NhdGVUZXh0dXJlVW5pdCA9IGFsbG9jYXRlVGV4dHVyZVVuaXQ7CiAgICB0aGlzLnJlc2V0VGV4dHVyZVVuaXRzID0gcmVzZXRUZXh0dXJlVW5pdHM7CiAgICB0aGlzLnNldFRleHR1cmUyRCA9IHNldFRleHR1cmUyRDsKICAgIHRoaXMuc2V0VGV4dHVyZTJEQXJyYXkgPSBzZXRUZXh0dXJlMkRBcnJheTsKICAgIHRoaXMuc2V0VGV4dHVyZTNEID0gc2V0VGV4dHVyZTNEOwogICAgdGhpcy5zZXRUZXh0dXJlQ3ViZSA9IHNldFRleHR1cmVDdWJlOwogICAgdGhpcy5zZXR1cFJlbmRlclRhcmdldCA9IHNldHVwUmVuZGVyVGFyZ2V0OwogICAgdGhpcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAgPSB1cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXA7CiAgICB0aGlzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0ID0gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQ7CiAgICB0aGlzLnNhZmVTZXRUZXh0dXJlMkQgPSBzYWZlU2V0VGV4dHVyZTJEOwogICAgdGhpcy5zYWZlU2V0VGV4dHVyZUN1YmUgPSBzYWZlU2V0VGV4dHVyZUN1YmU7CiAgfQogIGZ1bmN0aW9uIFdlYkdMVXRpbHMoZ2wsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcykgewogICAgY29uc3QgaXNXZWJHTDIgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDI7CiAgICBmdW5jdGlvbiBjb252ZXJ0KHApIHsKICAgICAgbGV0IGV4dGVuc2lvbjsKICAgICAgaWYgKHAgPT09IFVuc2lnbmVkQnl0ZVR5cGUpCiAgICAgICAgcmV0dXJuIDUxMjE7CiAgICAgIGlmIChwID09PSBVbnNpZ25lZFNob3J0NDQ0NFR5cGUpCiAgICAgICAgcmV0dXJuIDMyODE5OwogICAgICBpZiAocCA9PT0gVW5zaWduZWRTaG9ydDU1NTFUeXBlKQogICAgICAgIHJldHVybiAzMjgyMDsKICAgICAgaWYgKHAgPT09IFVuc2lnbmVkU2hvcnQ1NjVUeXBlKQogICAgICAgIHJldHVybiAzMzYzNTsKICAgICAgaWYgKHAgPT09IEJ5dGVUeXBlKQogICAgICAgIHJldHVybiA1MTIwOwogICAgICBpZiAocCA9PT0gU2hvcnRUeXBlKQogICAgICAgIHJldHVybiA1MTIyOwogICAgICBpZiAocCA9PT0gVW5zaWduZWRTaG9ydFR5cGUpCiAgICAgICAgcmV0dXJuIDUxMjM7CiAgICAgIGlmIChwID09PSBJbnRUeXBlKQogICAgICAgIHJldHVybiA1MTI0OwogICAgICBpZiAocCA9PT0gVW5zaWduZWRJbnRUeXBlKQogICAgICAgIHJldHVybiA1MTI1OwogICAgICBpZiAocCA9PT0gRmxvYXRUeXBlKQogICAgICAgIHJldHVybiA1MTI2OwogICAgICBpZiAocCA9PT0gSGFsZkZsb2F0VHlwZSkgewogICAgICAgIGlmIChpc1dlYkdMMikKICAgICAgICAgIHJldHVybiA1MTMxOwogICAgICAgIGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCJPRVNfdGV4dHVyZV9oYWxmX2Zsb2F0Iik7CiAgICAgICAgaWYgKGV4dGVuc2lvbiAhPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGV4dGVuc2lvbi5IQUxGX0ZMT0FUX09FUzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwID09PSBBbHBoYUZvcm1hdCkKICAgICAgICByZXR1cm4gNjQwNjsKICAgICAgaWYgKHAgPT09IFJHQkZvcm1hdCkKICAgICAgICByZXR1cm4gNjQwNzsKICAgICAgaWYgKHAgPT09IFJHQkFGb3JtYXQpCiAgICAgICAgcmV0dXJuIDY0MDg7CiAgICAgIGlmIChwID09PSBMdW1pbmFuY2VGb3JtYXQpCiAgICAgICAgcmV0dXJuIDY0MDk7CiAgICAgIGlmIChwID09PSBMdW1pbmFuY2VBbHBoYUZvcm1hdCkKICAgICAgICByZXR1cm4gNjQxMDsKICAgICAgaWYgKHAgPT09IERlcHRoRm9ybWF0KQogICAgICAgIHJldHVybiA2NDAyOwogICAgICBpZiAocCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0KQogICAgICAgIHJldHVybiAzNDA0MTsKICAgICAgaWYgKHAgPT09IFJlZEZvcm1hdCkKICAgICAgICByZXR1cm4gNjQwMzsKICAgICAgaWYgKHAgPT09IFJlZEludGVnZXJGb3JtYXQpCiAgICAgICAgcmV0dXJuIDM2MjQ0OwogICAgICBpZiAocCA9PT0gUkdGb3JtYXQpCiAgICAgICAgcmV0dXJuIDMzMzE5OwogICAgICBpZiAocCA9PT0gUkdJbnRlZ2VyRm9ybWF0KQogICAgICAgIHJldHVybiAzMzMyMDsKICAgICAgaWYgKHAgPT09IFJHQkludGVnZXJGb3JtYXQpCiAgICAgICAgcmV0dXJuIDM2MjQ4OwogICAgICBpZiAocCA9PT0gUkdCQUludGVnZXJGb3JtYXQpCiAgICAgICAgcmV0dXJuIDM2MjQ5OwogICAgICBpZiAocCA9PT0gUkdCX1MzVENfRFhUMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9TM1RDX0RYVDFfRm9ybWF0IHx8IHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCB8fCBwID09PSBSR0JBX1MzVENfRFhUNV9Gb3JtYXQpIHsKICAgICAgICBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCgiV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMiKTsKICAgICAgICBpZiAoZXh0ZW5zaW9uICE9PSBudWxsKSB7CiAgICAgICAgICBpZiAocCA9PT0gUkdCX1MzVENfRFhUMV9Gb3JtYXQpCiAgICAgICAgICAgIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUzNUQ19EWFQxX0VYVDsKICAgICAgICAgIGlmIChwID09PSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQpCiAgICAgICAgICAgIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1MzVENfRFhUMV9FWFQ7CiAgICAgICAgICBpZiAocCA9PT0gUkdCQV9TM1RDX0RYVDNfRm9ybWF0KQogICAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDNfRVhUOwogICAgICAgICAgaWYgKHAgPT09IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCkKICAgICAgICAgICAgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUzNUQ19EWFQ1X0VYVDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwID09PSBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCB8fCBwID09PSBSR0JfUFZSVENfMkJQUFYxX0Zvcm1hdCB8fCBwID09PSBSR0JBX1BWUlRDXzRCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0KSB7CiAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoIldFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YyIpOwogICAgICAgIGlmIChleHRlbnNpb24gIT09IG51bGwpIHsKICAgICAgICAgIGlmIChwID09PSBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCkKICAgICAgICAgICAgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9QVlJUQ180QlBQVjFfSU1HOwogICAgICAgICAgaWYgKHAgPT09IFJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0KQogICAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX1BWUlRDXzJCUFBWMV9JTUc7CiAgICAgICAgICBpZiAocCA9PT0gUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0KQogICAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9QVlJUQ180QlBQVjFfSU1HOwogICAgICAgICAgaWYgKHAgPT09IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCkKICAgICAgICAgICAgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUFZSVENfMkJQUFYxX0lNRzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwID09PSBSR0JfRVRDMV9Gb3JtYXQpIHsKICAgICAgICBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCgiV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX2V0YzEiKTsKICAgICAgICBpZiAoZXh0ZW5zaW9uICE9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX0VUQzFfV0VCR0w7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocCA9PT0gUkdCX0VUQzJfRm9ybWF0IHx8IHAgPT09IFJHQkFfRVRDMl9FQUNfRm9ybWF0KSB7CiAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoIldFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGMiKTsKICAgICAgICBpZiAoZXh0ZW5zaW9uICE9PSBudWxsKSB7CiAgICAgICAgICBpZiAocCA9PT0gUkdCX0VUQzJfRm9ybWF0KQogICAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCOF9FVEMyOwogICAgICAgICAgaWYgKHAgPT09IFJHQkFfRVRDMl9FQUNfRm9ybWF0KQogICAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQThfRVRDMl9FQUM7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwID09PSBSR0JBX0FTVENfNHg0X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNXg0X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNXg1X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNng1X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNng2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfOHg1X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfOHg2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfOHg4X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfMTB4NV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDZfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMHg4X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfMTB4MTBfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCB8fCBwID09PSBTUkdCOF9BTFBIQThfQVNUQ180eDRfRm9ybWF0IHx8IHAgPT09IFNSR0I4X0FMUEhBOF9BU1RDXzV4NF9Gb3JtYXQgfHwgcCA9PT0gU1JHQjhfQUxQSEE4X0FTVENfNXg1X0Zvcm1hdCB8fCBwID09PSBTUkdCOF9BTFBIQThfQVNUQ182eDVfRm9ybWF0IHx8IHAgPT09IFNSR0I4X0FMUEhBOF9BU1RDXzZ4Nl9Gb3JtYXQgfHwgcCA9PT0gU1JHQjhfQUxQSEE4X0FTVENfOHg1X0Zvcm1hdCB8fCBwID09PSBTUkdCOF9BTFBIQThfQVNUQ184eDZfRm9ybWF0IHx8IHAgPT09IFNSR0I4X0FMUEhBOF9BU1RDXzh4OF9Gb3JtYXQgfHwgcCA9PT0gU1JHQjhfQUxQSEE4X0FTVENfMTB4NV9Gb3JtYXQgfHwgcCA9PT0gU1JHQjhfQUxQSEE4X0FTVENfMTB4Nl9Gb3JtYXQgfHwgcCA9PT0gU1JHQjhfQUxQSEE4X0FTVENfMTB4OF9Gb3JtYXQgfHwgcCA9PT0gU1JHQjhfQUxQSEE4X0FTVENfMTB4MTBfRm9ybWF0IHx8IHAgPT09IFNSR0I4X0FMUEhBOF9BU1RDXzEyeDEwX0Zvcm1hdCB8fCBwID09PSBTUkdCOF9BTFBIQThfQVNUQ18xMngxMl9Gb3JtYXQpIHsKICAgICAgICBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCgiV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX2FzdGMiKTsKICAgICAgICBpZiAoZXh0ZW5zaW9uICE9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gcDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwID09PSBSR0JBX0JQVENfRm9ybWF0KSB7CiAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoIkVYVF90ZXh0dXJlX2NvbXByZXNzaW9uX2JwdGMiKTsKICAgICAgICBpZiAoZXh0ZW5zaW9uICE9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gcDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwID09PSBVbnNpZ25lZEludDI0OFR5cGUpIHsKICAgICAgICBpZiAoaXNXZWJHTDIpCiAgICAgICAgICByZXR1cm4gMzQwNDI7CiAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoIldFQkdMX2RlcHRoX3RleHR1cmUiKTsKICAgICAgICBpZiAoZXh0ZW5zaW9uICE9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9uLlVOU0lHTkVEX0lOVF8yNF84X1dFQkdMOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGNvbnZlcnQgfTsKICB9CiAgdmFyIEFycmF5Q2FtZXJhID0gY2xhc3MgZXh0ZW5kcyBQZXJzcGVjdGl2ZUNhbWVyYSB7CiAgICBjb25zdHJ1Y3RvcihhcnJheSA9IFtdKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuY2FtZXJhcyA9IGFycmF5OwogICAgfQogIH07CiAgQXJyYXlDYW1lcmEucHJvdG90eXBlLmlzQXJyYXlDYW1lcmEgPSB0cnVlOwogIHZhciBHcm91cCA9IGNsYXNzIGV4dGVuZHMgT2JqZWN0M0QgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJHcm91cCI7CiAgICB9CiAgfTsKICBHcm91cC5wcm90b3R5cGUuaXNHcm91cCA9IHRydWU7CiAgdmFyIF9tb3ZlRXZlbnQgPSB7IHR5cGU6ICJtb3ZlIiB9OwogIHZhciBXZWJYUkNvbnRyb2xsZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5fdGFyZ2V0UmF5ID0gbnVsbDsKICAgICAgdGhpcy5fZ3JpcCA9IG51bGw7CiAgICAgIHRoaXMuX2hhbmQgPSBudWxsOwogICAgfQogICAgZ2V0SGFuZFNwYWNlKCkgewogICAgICBpZiAodGhpcy5faGFuZCA9PT0gbnVsbCkgewogICAgICAgIHRoaXMuX2hhbmQgPSBuZXcgR3JvdXAoKTsKICAgICAgICB0aGlzLl9oYW5kLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKICAgICAgICB0aGlzLl9oYW5kLnZpc2libGUgPSBmYWxzZTsKICAgICAgICB0aGlzLl9oYW5kLmpvaW50cyA9IHt9OwogICAgICAgIHRoaXMuX2hhbmQuaW5wdXRTdGF0ZSA9IHsgcGluY2hpbmc6IGZhbHNlIH07CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2hhbmQ7CiAgICB9CiAgICBnZXRUYXJnZXRSYXlTcGFjZSgpIHsKICAgICAgaWYgKHRoaXMuX3RhcmdldFJheSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMuX3RhcmdldFJheSA9IG5ldyBHcm91cCgpOwogICAgICAgIHRoaXMuX3RhcmdldFJheS5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CiAgICAgICAgdGhpcy5fdGFyZ2V0UmF5LnZpc2libGUgPSBmYWxzZTsKICAgICAgICB0aGlzLl90YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKICAgICAgICB0aGlzLl90YXJnZXRSYXkubGluZWFyVmVsb2NpdHkgPSBuZXcgVmVjdG9yMygpOwogICAgICAgIHRoaXMuX3RhcmdldFJheS5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKICAgICAgICB0aGlzLl90YXJnZXRSYXkuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fdGFyZ2V0UmF5OwogICAgfQogICAgZ2V0R3JpcFNwYWNlKCkgewogICAgICBpZiAodGhpcy5fZ3JpcCA9PT0gbnVsbCkgewogICAgICAgIHRoaXMuX2dyaXAgPSBuZXcgR3JvdXAoKTsKICAgICAgICB0aGlzLl9ncmlwLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKICAgICAgICB0aGlzLl9ncmlwLnZpc2libGUgPSBmYWxzZTsKICAgICAgICB0aGlzLl9ncmlwLmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CiAgICAgICAgdGhpcy5fZ3JpcC5saW5lYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CiAgICAgICAgdGhpcy5fZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKICAgICAgICB0aGlzLl9ncmlwLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2dyaXA7CiAgICB9CiAgICBkaXNwYXRjaEV2ZW50KGV2ZW50KSB7CiAgICAgIGlmICh0aGlzLl90YXJnZXRSYXkgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl90YXJnZXRSYXkuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuX2dyaXAgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl9ncmlwLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgICB9CiAgICAgIGlmICh0aGlzLl9oYW5kICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5faGFuZC5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGRpc2Nvbm5lY3QoaW5wdXRTb3VyY2UpIHsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHsgdHlwZTogImRpc2Nvbm5lY3RlZCIsIGRhdGE6IGlucHV0U291cmNlIH0pOwogICAgICBpZiAodGhpcy5fdGFyZ2V0UmF5ICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5fdGFyZ2V0UmF5LnZpc2libGUgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAodGhpcy5fZ3JpcCAhPT0gbnVsbCkgewogICAgICAgIHRoaXMuX2dyaXAudmlzaWJsZSA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmICh0aGlzLl9oYW5kICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5faGFuZC52aXNpYmxlID0gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB1cGRhdGUoaW5wdXRTb3VyY2UsIGZyYW1lLCByZWZlcmVuY2VTcGFjZSkgewogICAgICBsZXQgaW5wdXRQb3NlID0gbnVsbDsKICAgICAgbGV0IGdyaXBQb3NlID0gbnVsbDsKICAgICAgbGV0IGhhbmRQb3NlID0gbnVsbDsKICAgICAgY29uc3QgdGFyZ2V0UmF5ID0gdGhpcy5fdGFyZ2V0UmF5OwogICAgICBjb25zdCBncmlwID0gdGhpcy5fZ3JpcDsKICAgICAgY29uc3QgaGFuZCA9IHRoaXMuX2hhbmQ7CiAgICAgIGlmIChpbnB1dFNvdXJjZSAmJiBmcmFtZS5zZXNzaW9uLnZpc2liaWxpdHlTdGF0ZSAhPT0gInZpc2libGUtYmx1cnJlZCIpIHsKICAgICAgICBpZiAodGFyZ2V0UmF5ICE9PSBudWxsKSB7CiAgICAgICAgICBpbnB1dFBvc2UgPSBmcmFtZS5nZXRQb3NlKGlucHV0U291cmNlLnRhcmdldFJheVNwYWNlLCByZWZlcmVuY2VTcGFjZSk7CiAgICAgICAgICBpZiAoaW5wdXRQb3NlICE9PSBudWxsKSB7CiAgICAgICAgICAgIHRhcmdldFJheS5tYXRyaXguZnJvbUFycmF5KGlucHV0UG9zZS50cmFuc2Zvcm0ubWF0cml4KTsKICAgICAgICAgICAgdGFyZ2V0UmF5Lm1hdHJpeC5kZWNvbXBvc2UodGFyZ2V0UmF5LnBvc2l0aW9uLCB0YXJnZXRSYXkucm90YXRpb24sIHRhcmdldFJheS5zY2FsZSk7CiAgICAgICAgICAgIGlmIChpbnB1dFBvc2UubGluZWFyVmVsb2NpdHkpIHsKICAgICAgICAgICAgICB0YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSB0cnVlOwogICAgICAgICAgICAgIHRhcmdldFJheS5saW5lYXJWZWxvY2l0eS5jb3B5KGlucHV0UG9zZS5saW5lYXJWZWxvY2l0eSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGFyZ2V0UmF5Lmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlucHV0UG9zZS5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICAgICAgICB0YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gdHJ1ZTsKICAgICAgICAgICAgICB0YXJnZXRSYXkuYW5ndWxhclZlbG9jaXR5LmNvcHkoaW5wdXRQb3NlLmFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGFyZ2V0UmF5Lmhhc0FuZ3VsYXJWZWxvY2l0eSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChfbW92ZUV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGhhbmQgJiYgaW5wdXRTb3VyY2UuaGFuZCkgewogICAgICAgICAgaGFuZFBvc2UgPSB0cnVlOwogICAgICAgICAgZm9yIChjb25zdCBpbnB1dGpvaW50IG9mIGlucHV0U291cmNlLmhhbmQudmFsdWVzKCkpIHsKICAgICAgICAgICAgY29uc3Qgam9pbnRQb3NlID0gZnJhbWUuZ2V0Sm9pbnRQb3NlKGlucHV0am9pbnQsIHJlZmVyZW5jZVNwYWNlKTsKICAgICAgICAgICAgaWYgKGhhbmQuam9pbnRzW2lucHV0am9pbnQuam9pbnROYW1lXSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgY29uc3Qgam9pbnQyID0gbmV3IEdyb3VwKCk7CiAgICAgICAgICAgICAgam9pbnQyLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKICAgICAgICAgICAgICBqb2ludDIudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgIGhhbmQuam9pbnRzW2lucHV0am9pbnQuam9pbnROYW1lXSA9IGpvaW50MjsKICAgICAgICAgICAgICBoYW5kLmFkZChqb2ludDIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGpvaW50ID0gaGFuZC5qb2ludHNbaW5wdXRqb2ludC5qb2ludE5hbWVdOwogICAgICAgICAgICBpZiAoam9pbnRQb3NlICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgam9pbnQubWF0cml4LmZyb21BcnJheShqb2ludFBvc2UudHJhbnNmb3JtLm1hdHJpeCk7CiAgICAgICAgICAgICAgam9pbnQubWF0cml4LmRlY29tcG9zZShqb2ludC5wb3NpdGlvbiwgam9pbnQucm90YXRpb24sIGpvaW50LnNjYWxlKTsKICAgICAgICAgICAgICBqb2ludC5qb2ludFJhZGl1cyA9IGpvaW50UG9zZS5yYWRpdXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgam9pbnQudmlzaWJsZSA9IGpvaW50UG9zZSAhPT0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGluZGV4VGlwID0gaGFuZC5qb2ludHNbImluZGV4LWZpbmdlci10aXAiXTsKICAgICAgICAgIGNvbnN0IHRodW1iVGlwID0gaGFuZC5qb2ludHNbInRodW1iLXRpcCJdOwogICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBpbmRleFRpcC5wb3NpdGlvbi5kaXN0YW5jZVRvKHRodW1iVGlwLnBvc2l0aW9uKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlVG9QaW5jaCA9IDAuMDI7CiAgICAgICAgICBjb25zdCB0aHJlc2hvbGQgPSA1ZS0zOwogICAgICAgICAgaWYgKGhhbmQuaW5wdXRTdGF0ZS5waW5jaGluZyAmJiBkaXN0YW5jZSA+IGRpc3RhbmNlVG9QaW5jaCArIHRocmVzaG9sZCkgewogICAgICAgICAgICBoYW5kLmlucHV0U3RhdGUucGluY2hpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHsKICAgICAgICAgICAgICB0eXBlOiAicGluY2hlbmQiLAogICAgICAgICAgICAgIGhhbmRlZG5lc3M6IGlucHV0U291cmNlLmhhbmRlZG5lc3MsCiAgICAgICAgICAgICAgdGFyZ2V0OiB0aGlzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmICghaGFuZC5pbnB1dFN0YXRlLnBpbmNoaW5nICYmIGRpc3RhbmNlIDw9IGRpc3RhbmNlVG9QaW5jaCAtIHRocmVzaG9sZCkgewogICAgICAgICAgICBoYW5kLmlucHV0U3RhdGUucGluY2hpbmcgPSB0cnVlOwogICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoewogICAgICAgICAgICAgIHR5cGU6ICJwaW5jaHN0YXJ0IiwKICAgICAgICAgICAgICBoYW5kZWRuZXNzOiBpbnB1dFNvdXJjZS5oYW5kZWRuZXNzLAogICAgICAgICAgICAgIHRhcmdldDogdGhpcwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGdyaXAgIT09IG51bGwgJiYgaW5wdXRTb3VyY2UuZ3JpcFNwYWNlKSB7CiAgICAgICAgICAgIGdyaXBQb3NlID0gZnJhbWUuZ2V0UG9zZShpbnB1dFNvdXJjZS5ncmlwU3BhY2UsIHJlZmVyZW5jZVNwYWNlKTsKICAgICAgICAgICAgaWYgKGdyaXBQb3NlICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgZ3JpcC5tYXRyaXguZnJvbUFycmF5KGdyaXBQb3NlLnRyYW5zZm9ybS5tYXRyaXgpOwogICAgICAgICAgICAgIGdyaXAubWF0cml4LmRlY29tcG9zZShncmlwLnBvc2l0aW9uLCBncmlwLnJvdGF0aW9uLCBncmlwLnNjYWxlKTsKICAgICAgICAgICAgICBpZiAoZ3JpcFBvc2UubGluZWFyVmVsb2NpdHkpIHsKICAgICAgICAgICAgICAgIGdyaXAuaGFzTGluZWFyVmVsb2NpdHkgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JpcC5saW5lYXJWZWxvY2l0eS5jb3B5KGdyaXBQb3NlLmxpbmVhclZlbG9jaXR5KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZ3JpcC5oYXNMaW5lYXJWZWxvY2l0eSA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZ3JpcFBvc2UuYW5ndWxhclZlbG9jaXR5KSB7CiAgICAgICAgICAgICAgICBncmlwLmhhc0FuZ3VsYXJWZWxvY2l0eSA9IHRydWU7CiAgICAgICAgICAgICAgICBncmlwLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KGdyaXBQb3NlLmFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdyaXAuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0YXJnZXRSYXkgIT09IG51bGwpIHsKICAgICAgICB0YXJnZXRSYXkudmlzaWJsZSA9IGlucHV0UG9zZSAhPT0gbnVsbDsKICAgICAgfQogICAgICBpZiAoZ3JpcCAhPT0gbnVsbCkgewogICAgICAgIGdyaXAudmlzaWJsZSA9IGdyaXBQb3NlICE9PSBudWxsOwogICAgICB9CiAgICAgIGlmIChoYW5kICE9PSBudWxsKSB7CiAgICAgICAgaGFuZC52aXNpYmxlID0gaGFuZFBvc2UgIT09IG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICB2YXIgV2ViWFJNYW5hZ2VyID0gY2xhc3MgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewogICAgY29uc3RydWN0b3IocmVuZGVyZXIsIGdsKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIGNvbnN0IHNjb3BlID0gdGhpczsKICAgICAgY29uc3Qgc3RhdGUgPSByZW5kZXJlci5zdGF0ZTsKICAgICAgbGV0IHNlc3Npb24gPSBudWxsOwogICAgICBsZXQgZnJhbWVidWZmZXJTY2FsZUZhY3RvciA9IDE7CiAgICAgIGxldCByZWZlcmVuY2VTcGFjZSA9IG51bGw7CiAgICAgIGxldCByZWZlcmVuY2VTcGFjZVR5cGUgPSAibG9jYWwtZmxvb3IiOwogICAgICBsZXQgcG9zZSA9IG51bGw7CiAgICAgIGxldCBnbEJpbmRpbmcgPSBudWxsOwogICAgICBsZXQgZ2xGcmFtZWJ1ZmZlciA9IG51bGw7CiAgICAgIGxldCBnbFByb2pMYXllciA9IG51bGw7CiAgICAgIGNvbnN0IGNvbnRyb2xsZXJzID0gW107CiAgICAgIGNvbnN0IGlucHV0U291cmNlc01hcCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgICAgIGNvbnN0IGNhbWVyYUwgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoKTsKICAgICAgY2FtZXJhTC5sYXllcnMuZW5hYmxlKDEpOwogICAgICBjYW1lcmFMLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKTsKICAgICAgY29uc3QgY2FtZXJhUiA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwogICAgICBjYW1lcmFSLmxheWVycy5lbmFibGUoMik7CiAgICAgIGNhbWVyYVIudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwogICAgICBjb25zdCBjYW1lcmFzID0gW2NhbWVyYUwsIGNhbWVyYVJdOwogICAgICBjb25zdCBjYW1lcmFWUiA9IG5ldyBBcnJheUNhbWVyYSgpOwogICAgICBjYW1lcmFWUi5sYXllcnMuZW5hYmxlKDEpOwogICAgICBjYW1lcmFWUi5sYXllcnMuZW5hYmxlKDIpOwogICAgICBsZXQgX2N1cnJlbnREZXB0aE5lYXIgPSBudWxsOwogICAgICBsZXQgX2N1cnJlbnREZXB0aEZhciA9IG51bGw7CiAgICAgIHRoaXMuY2FtZXJhQXV0b1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlOwogICAgICB0aGlzLmlzUHJlc2VudGluZyA9IGZhbHNlOwogICAgICB0aGlzLmdldENvbnRyb2xsZXIgPSBmdW5jdGlvbihpbmRleCkgewogICAgICAgIGxldCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbaW5kZXhdOwogICAgICAgIGlmIChjb250cm9sbGVyID09PSB2b2lkIDApIHsKICAgICAgICAgIGNvbnRyb2xsZXIgPSBuZXcgV2ViWFJDb250cm9sbGVyKCk7CiAgICAgICAgICBjb250cm9sbGVyc1tpbmRleF0gPSBjb250cm9sbGVyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY29udHJvbGxlci5nZXRUYXJnZXRSYXlTcGFjZSgpOwogICAgICB9OwogICAgICB0aGlzLmdldENvbnRyb2xsZXJHcmlwID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgICBsZXQgY29udHJvbGxlciA9IGNvbnRyb2xsZXJzW2luZGV4XTsKICAgICAgICBpZiAoY29udHJvbGxlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBjb250cm9sbGVyID0gbmV3IFdlYlhSQ29udHJvbGxlcigpOwogICAgICAgICAgY29udHJvbGxlcnNbaW5kZXhdID0gY29udHJvbGxlcjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXIuZ2V0R3JpcFNwYWNlKCk7CiAgICAgIH07CiAgICAgIHRoaXMuZ2V0SGFuZCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgbGV0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1tpbmRleF07CiAgICAgICAgaWYgKGNvbnRyb2xsZXIgPT09IHZvaWQgMCkgewogICAgICAgICAgY29udHJvbGxlciA9IG5ldyBXZWJYUkNvbnRyb2xsZXIoKTsKICAgICAgICAgIGNvbnRyb2xsZXJzW2luZGV4XSA9IGNvbnRyb2xsZXI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb250cm9sbGVyLmdldEhhbmRTcGFjZSgpOwogICAgICB9OwogICAgICBmdW5jdGlvbiBvblNlc3Npb25FdmVudChldmVudCkgewogICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBpbnB1dFNvdXJjZXNNYXAuZ2V0KGV2ZW50LmlucHV0U291cmNlKTsKICAgICAgICBpZiAoY29udHJvbGxlcikgewogICAgICAgICAgY29udHJvbGxlci5kaXNwYXRjaEV2ZW50KHsgdHlwZTogZXZlbnQudHlwZSwgZGF0YTogZXZlbnQuaW5wdXRTb3VyY2UgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIG9uU2Vzc2lvbkVuZCgpIHsKICAgICAgICBpbnB1dFNvdXJjZXNNYXAuZm9yRWFjaChmdW5jdGlvbihjb250cm9sbGVyLCBpbnB1dFNvdXJjZSkgewogICAgICAgICAgY29udHJvbGxlci5kaXNjb25uZWN0KGlucHV0U291cmNlKTsKICAgICAgICB9KTsKICAgICAgICBpbnB1dFNvdXJjZXNNYXAuY2xlYXIoKTsKICAgICAgICBfY3VycmVudERlcHRoTmVhciA9IG51bGw7CiAgICAgICAgX2N1cnJlbnREZXB0aEZhciA9IG51bGw7CiAgICAgICAgc3RhdGUuYmluZFhSRnJhbWVidWZmZXIobnVsbCk7CiAgICAgICAgcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpKTsKICAgICAgICBhbmltYXRpb24uc3RvcCgpOwogICAgICAgIHNjb3BlLmlzUHJlc2VudGluZyA9IGZhbHNlOwogICAgICAgIHNjb3BlLmRpc3BhdGNoRXZlbnQoeyB0eXBlOiAic2Vzc2lvbmVuZCIgfSk7CiAgICAgIH0KICAgICAgdGhpcy5zZXRGcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gdmFsdWU7CiAgICAgICAgaWYgKHNjb3BlLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSkgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJYUk1hbmFnZXI6IENhbm5vdCBjaGFuZ2UgZnJhbWVidWZmZXIgc2NhbGUgd2hpbGUgcHJlc2VudGluZy4iKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHRoaXMuc2V0UmVmZXJlbmNlU3BhY2VUeXBlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICByZWZlcmVuY2VTcGFjZVR5cGUgPSB2YWx1ZTsKICAgICAgICBpZiAoc2NvcGUuaXNQcmVzZW50aW5nID09PSB0cnVlKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYlhSTWFuYWdlcjogQ2Fubm90IGNoYW5nZSByZWZlcmVuY2Ugc3BhY2UgdHlwZSB3aGlsZSBwcmVzZW50aW5nLiIpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgdGhpcy5nZXRSZWZlcmVuY2VTcGFjZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiByZWZlcmVuY2VTcGFjZTsKICAgICAgfTsKICAgICAgdGhpcy5nZXRTZXNzaW9uID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHNlc3Npb247CiAgICAgIH07CiAgICAgIHRoaXMuc2V0U2Vzc2lvbiA9IGFzeW5jIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgc2Vzc2lvbiA9IHZhbHVlOwogICAgICAgIGlmIChzZXNzaW9uICE9PSBudWxsKSB7CiAgICAgICAgICBzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoInNlbGVjdCIsIG9uU2Vzc2lvbkV2ZW50KTsKICAgICAgICAgIHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcigic2VsZWN0c3RhcnQiLCBvblNlc3Npb25FdmVudCk7CiAgICAgICAgICBzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoInNlbGVjdGVuZCIsIG9uU2Vzc2lvbkV2ZW50KTsKICAgICAgICAgIHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcigic3F1ZWV6ZSIsIG9uU2Vzc2lvbkV2ZW50KTsKICAgICAgICAgIHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcigic3F1ZWV6ZXN0YXJ0Iiwgb25TZXNzaW9uRXZlbnQpOwogICAgICAgICAgc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCJzcXVlZXplZW5kIiwgb25TZXNzaW9uRXZlbnQpOwogICAgICAgICAgc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCJlbmQiLCBvblNlc3Npb25FbmQpOwogICAgICAgICAgc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCJpbnB1dHNvdXJjZXNjaGFuZ2UiLCBvbklucHV0U291cmNlc0NoYW5nZSk7CiAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gZ2wuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKTsKICAgICAgICAgIGlmIChhdHRyaWJ1dGVzLnhyQ29tcGF0aWJsZSAhPT0gdHJ1ZSkgewogICAgICAgICAgICBhd2FpdCBnbC5tYWtlWFJDb21wYXRpYmxlKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc2Vzc2lvbi5yZW5kZXJTdGF0ZS5sYXllcnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICBjb25zdCBsYXllckluaXQgPSB7CiAgICAgICAgICAgICAgYW50aWFsaWFzOiBhdHRyaWJ1dGVzLmFudGlhbGlhcywKICAgICAgICAgICAgICBhbHBoYTogYXR0cmlidXRlcy5hbHBoYSwKICAgICAgICAgICAgICBkZXB0aDogYXR0cmlidXRlcy5kZXB0aCwKICAgICAgICAgICAgICBzdGVuY2lsOiBhdHRyaWJ1dGVzLnN0ZW5jaWwsCiAgICAgICAgICAgICAgZnJhbWVidWZmZXJTY2FsZUZhY3RvcgogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCBiYXNlTGF5ZXIgPSBuZXcgWFJXZWJHTExheWVyKHNlc3Npb24sIGdsLCBsYXllckluaXQpOwogICAgICAgICAgICBzZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKHsgYmFzZUxheWVyIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGV0IGRlcHRoRm9ybWF0ID0gMDsKICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZXMuZGVwdGgpIHsKICAgICAgICAgICAgICBkZXB0aEZvcm1hdCA9IGF0dHJpYnV0ZXMuc3RlbmNpbCA/IDM0MDQxIDogNjQwMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBwcm9qZWN0aW9ubGF5ZXJJbml0ID0gewogICAgICAgICAgICAgIGNvbG9yRm9ybWF0OiBhdHRyaWJ1dGVzLmFscGhhID8gNjQwOCA6IDY0MDcsCiAgICAgICAgICAgICAgZGVwdGhGb3JtYXQsCiAgICAgICAgICAgICAgc2NhbGVGYWN0b3I6IGZyYW1lYnVmZmVyU2NhbGVGYWN0b3IKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZ2xCaW5kaW5nID0gbmV3IFhSV2ViR0xCaW5kaW5nKHNlc3Npb24sIGdsKTsKICAgICAgICAgICAgZ2xQcm9qTGF5ZXIgPSBnbEJpbmRpbmcuY3JlYXRlUHJvamVjdGlvbkxheWVyKHByb2plY3Rpb25sYXllckluaXQpOwogICAgICAgICAgICBnbEZyYW1lYnVmZmVyID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKICAgICAgICAgICAgc2Vzc2lvbi51cGRhdGVSZW5kZXJTdGF0ZSh7IGxheWVyczogW2dsUHJvakxheWVyXSB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJlZmVyZW5jZVNwYWNlID0gYXdhaXQgc2Vzc2lvbi5yZXF1ZXN0UmVmZXJlbmNlU3BhY2UocmVmZXJlbmNlU3BhY2VUeXBlKTsKICAgICAgICAgIGFuaW1hdGlvbi5zZXRDb250ZXh0KHNlc3Npb24pOwogICAgICAgICAgYW5pbWF0aW9uLnN0YXJ0KCk7CiAgICAgICAgICBzY29wZS5pc1ByZXNlbnRpbmcgPSB0cnVlOwogICAgICAgICAgc2NvcGUuZGlzcGF0Y2hFdmVudCh7IHR5cGU6ICJzZXNzaW9uc3RhcnQiIH0pOwogICAgICAgIH0KICAgICAgfTsKICAgICAgZnVuY3Rpb24gb25JbnB1dFNvdXJjZXNDaGFuZ2UoZXZlbnQpIHsKICAgICAgICBjb25zdCBpbnB1dFNvdXJjZXMgPSBzZXNzaW9uLmlucHV0U291cmNlczsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpbnB1dFNvdXJjZXNNYXAuc2V0KGlucHV0U291cmNlc1tpXSwgY29udHJvbGxlcnNbaV0pOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50LnJlbW92ZWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGlucHV0U291cmNlID0gZXZlbnQucmVtb3ZlZFtpXTsKICAgICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBpbnB1dFNvdXJjZXNNYXAuZ2V0KGlucHV0U291cmNlKTsKICAgICAgICAgIGlmIChjb250cm9sbGVyKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIuZGlzcGF0Y2hFdmVudCh7IHR5cGU6ICJkaXNjb25uZWN0ZWQiLCBkYXRhOiBpbnB1dFNvdXJjZSB9KTsKICAgICAgICAgICAgaW5wdXRTb3VyY2VzTWFwLmRlbGV0ZShpbnB1dFNvdXJjZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXZlbnQuYWRkZWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGlucHV0U291cmNlID0gZXZlbnQuYWRkZWRbaV07CiAgICAgICAgICBjb25zdCBjb250cm9sbGVyID0gaW5wdXRTb3VyY2VzTWFwLmdldChpbnB1dFNvdXJjZSk7CiAgICAgICAgICBpZiAoY29udHJvbGxlcikgewogICAgICAgICAgICBjb250cm9sbGVyLmRpc3BhdGNoRXZlbnQoeyB0eXBlOiAiY29ubmVjdGVkIiwgZGF0YTogaW5wdXRTb3VyY2UgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IGNhbWVyYUxQb3MgPSBuZXcgVmVjdG9yMygpOwogICAgICBjb25zdCBjYW1lcmFSUG9zID0gbmV3IFZlY3RvcjMoKTsKICAgICAgZnVuY3Rpb24gc2V0UHJvamVjdGlvbkZyb21VbmlvbihjYW1lcmEsIGNhbWVyYUwyLCBjYW1lcmFSMikgewogICAgICAgIGNhbWVyYUxQb3Muc2V0RnJvbU1hdHJpeFBvc2l0aW9uKGNhbWVyYUwyLm1hdHJpeFdvcmxkKTsKICAgICAgICBjYW1lcmFSUG9zLnNldEZyb21NYXRyaXhQb3NpdGlvbihjYW1lcmFSMi5tYXRyaXhXb3JsZCk7CiAgICAgICAgY29uc3QgaXBkID0gY2FtZXJhTFBvcy5kaXN0YW5jZVRvKGNhbWVyYVJQb3MpOwogICAgICAgIGNvbnN0IHByb2pMID0gY2FtZXJhTDIucHJvamVjdGlvbk1hdHJpeC5lbGVtZW50czsKICAgICAgICBjb25zdCBwcm9qUiA9IGNhbWVyYVIyLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CiAgICAgICAgY29uc3QgbmVhciA9IHByb2pMWzE0XSAvIChwcm9qTFsxMF0gLSAxKTsKICAgICAgICBjb25zdCBmYXIgPSBwcm9qTFsxNF0gLyAocHJvakxbMTBdICsgMSk7CiAgICAgICAgY29uc3QgdG9wRm92ID0gKHByb2pMWzldICsgMSkgLyBwcm9qTFs1XTsKICAgICAgICBjb25zdCBib3R0b21Gb3YgPSAocHJvakxbOV0gLSAxKSAvIHByb2pMWzVdOwogICAgICAgIGNvbnN0IGxlZnRGb3YgPSAocHJvakxbOF0gLSAxKSAvIHByb2pMWzBdOwogICAgICAgIGNvbnN0IHJpZ2h0Rm92ID0gKHByb2pSWzhdICsgMSkgLyBwcm9qUlswXTsKICAgICAgICBjb25zdCBsZWZ0ID0gbmVhciAqIGxlZnRGb3Y7CiAgICAgICAgY29uc3QgcmlnaHQgPSBuZWFyICogcmlnaHRGb3Y7CiAgICAgICAgY29uc3Qgek9mZnNldCA9IGlwZCAvICgtbGVmdEZvdiArIHJpZ2h0Rm92KTsKICAgICAgICBjb25zdCB4T2Zmc2V0ID0gek9mZnNldCAqIC1sZWZ0Rm92OwogICAgICAgIGNhbWVyYUwyLm1hdHJpeFdvcmxkLmRlY29tcG9zZShjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5xdWF0ZXJuaW9uLCBjYW1lcmEuc2NhbGUpOwogICAgICAgIGNhbWVyYS50cmFuc2xhdGVYKHhPZmZzZXQpOwogICAgICAgIGNhbWVyYS50cmFuc2xhdGVaKHpPZmZzZXQpOwogICAgICAgIGNhbWVyYS5tYXRyaXhXb3JsZC5jb21wb3NlKGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSk7CiAgICAgICAgY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZS5jb3B5KGNhbWVyYS5tYXRyaXhXb3JsZCkuaW52ZXJ0KCk7CiAgICAgICAgY29uc3QgbmVhcjIgPSBuZWFyICsgek9mZnNldDsKICAgICAgICBjb25zdCBmYXIyID0gZmFyICsgek9mZnNldDsKICAgICAgICBjb25zdCBsZWZ0MiA9IGxlZnQgLSB4T2Zmc2V0OwogICAgICAgIGNvbnN0IHJpZ2h0MiA9IHJpZ2h0ICsgKGlwZCAtIHhPZmZzZXQpOwogICAgICAgIGNvbnN0IHRvcDIgPSB0b3BGb3YgKiBmYXIgLyBmYXIyICogbmVhcjI7CiAgICAgICAgY29uc3QgYm90dG9tMiA9IGJvdHRvbUZvdiAqIGZhciAvIGZhcjIgKiBuZWFyMjsKICAgICAgICBjYW1lcmEucHJvamVjdGlvbk1hdHJpeC5tYWtlUGVyc3BlY3RpdmUobGVmdDIsIHJpZ2h0MiwgdG9wMiwgYm90dG9tMiwgbmVhcjIsIGZhcjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbWVyYShjYW1lcmEsIHBhcmVudCkgewogICAgICAgIGlmIChwYXJlbnQgPT09IG51bGwpIHsKICAgICAgICAgIGNhbWVyYS5tYXRyaXhXb3JsZC5jb3B5KGNhbWVyYS5tYXRyaXgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjYW1lcmEubWF0cml4V29ybGQubXVsdGlwbHlNYXRyaWNlcyhwYXJlbnQubWF0cml4V29ybGQsIGNhbWVyYS5tYXRyaXgpOwogICAgICAgIH0KICAgICAgICBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoY2FtZXJhLm1hdHJpeFdvcmxkKS5pbnZlcnQoKTsKICAgICAgfQogICAgICB0aGlzLnVwZGF0ZUNhbWVyYSA9IGZ1bmN0aW9uKGNhbWVyYSkgewogICAgICAgIGlmIChzZXNzaW9uID09PSBudWxsKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGNhbWVyYVZSLm5lYXIgPSBjYW1lcmFSLm5lYXIgPSBjYW1lcmFMLm5lYXIgPSBjYW1lcmEubmVhcjsKICAgICAgICBjYW1lcmFWUi5mYXIgPSBjYW1lcmFSLmZhciA9IGNhbWVyYUwuZmFyID0gY2FtZXJhLmZhcjsKICAgICAgICBpZiAoX2N1cnJlbnREZXB0aE5lYXIgIT09IGNhbWVyYVZSLm5lYXIgfHwgX2N1cnJlbnREZXB0aEZhciAhPT0gY2FtZXJhVlIuZmFyKSB7CiAgICAgICAgICBzZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKHsKICAgICAgICAgICAgZGVwdGhOZWFyOiBjYW1lcmFWUi5uZWFyLAogICAgICAgICAgICBkZXB0aEZhcjogY2FtZXJhVlIuZmFyCiAgICAgICAgICB9KTsKICAgICAgICAgIF9jdXJyZW50RGVwdGhOZWFyID0gY2FtZXJhVlIubmVhcjsKICAgICAgICAgIF9jdXJyZW50RGVwdGhGYXIgPSBjYW1lcmFWUi5mYXI7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBhcmVudCA9IGNhbWVyYS5wYXJlbnQ7CiAgICAgICAgY29uc3QgY2FtZXJhczIgPSBjYW1lcmFWUi5jYW1lcmFzOwogICAgICAgIHVwZGF0ZUNhbWVyYShjYW1lcmFWUiwgcGFyZW50KTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbWVyYXMyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB1cGRhdGVDYW1lcmEoY2FtZXJhczJbaV0sIHBhcmVudCk7CiAgICAgICAgfQogICAgICAgIGNhbWVyYVZSLm1hdHJpeFdvcmxkLmRlY29tcG9zZShjYW1lcmFWUi5wb3NpdGlvbiwgY2FtZXJhVlIucXVhdGVybmlvbiwgY2FtZXJhVlIuc2NhbGUpOwogICAgICAgIGNhbWVyYS5wb3NpdGlvbi5jb3B5KGNhbWVyYVZSLnBvc2l0aW9uKTsKICAgICAgICBjYW1lcmEucXVhdGVybmlvbi5jb3B5KGNhbWVyYVZSLnF1YXRlcm5pb24pOwogICAgICAgIGNhbWVyYS5zY2FsZS5jb3B5KGNhbWVyYVZSLnNjYWxlKTsKICAgICAgICBjYW1lcmEubWF0cml4LmNvcHkoY2FtZXJhVlIubWF0cml4KTsKICAgICAgICBjYW1lcmEubWF0cml4V29ybGQuY29weShjYW1lcmFWUi5tYXRyaXhXb3JsZCk7CiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBjYW1lcmEuY2hpbGRyZW47CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGNoaWxkcmVuW2ldLnVwZGF0ZU1hdHJpeFdvcmxkKHRydWUpOwogICAgICAgIH0KICAgICAgICBpZiAoY2FtZXJhczIubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICBzZXRQcm9qZWN0aW9uRnJvbVVuaW9uKGNhbWVyYVZSLCBjYW1lcmFMLCBjYW1lcmFSKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FtZXJhVlIucHJvamVjdGlvbk1hdHJpeC5jb3B5KGNhbWVyYUwucHJvamVjdGlvbk1hdHJpeCk7CiAgICAgICAgfQogICAgICB9OwogICAgICB0aGlzLmdldENhbWVyYSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBjYW1lcmFWUjsKICAgICAgfTsKICAgICAgbGV0IG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IG51bGw7CiAgICAgIGZ1bmN0aW9uIG9uQW5pbWF0aW9uRnJhbWUodGltZSwgZnJhbWUpIHsKICAgICAgICBwb3NlID0gZnJhbWUuZ2V0Vmlld2VyUG9zZShyZWZlcmVuY2VTcGFjZSk7CiAgICAgICAgaWYgKHBvc2UgIT09IG51bGwpIHsKICAgICAgICAgIGNvbnN0IHZpZXdzID0gcG9zZS52aWV3czsKICAgICAgICAgIGNvbnN0IGJhc2VMYXllciA9IHNlc3Npb24ucmVuZGVyU3RhdGUuYmFzZUxheWVyOwogICAgICAgICAgaWYgKHNlc3Npb24ucmVuZGVyU3RhdGUubGF5ZXJzID09PSB2b2lkIDApIHsKICAgICAgICAgICAgc3RhdGUuYmluZFhSRnJhbWVidWZmZXIoYmFzZUxheWVyLmZyYW1lYnVmZmVyKTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBjYW1lcmFWUk5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICAgICAgICBpZiAodmlld3MubGVuZ3RoICE9PSBjYW1lcmFWUi5jYW1lcmFzLmxlbmd0aCkgewogICAgICAgICAgICBjYW1lcmFWUi5jYW1lcmFzLmxlbmd0aCA9IDA7CiAgICAgICAgICAgIGNhbWVyYVZSTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2aWV3cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdCB2aWV3ID0gdmlld3NbaV07CiAgICAgICAgICAgIGxldCB2aWV3cG9ydCA9IG51bGw7CiAgICAgICAgICAgIGlmIChzZXNzaW9uLnJlbmRlclN0YXRlLmxheWVycyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgdmlld3BvcnQgPSBiYXNlTGF5ZXIuZ2V0Vmlld3BvcnQodmlldyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc3QgZ2xTdWJJbWFnZSA9IGdsQmluZGluZy5nZXRWaWV3U3ViSW1hZ2UoZ2xQcm9qTGF5ZXIsIHZpZXcpOwogICAgICAgICAgICAgIHN0YXRlLmJpbmRYUkZyYW1lYnVmZmVyKGdsRnJhbWVidWZmZXIpOwogICAgICAgICAgICAgIGdsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKDM2MTYwLCAzNjA2NCwgMzU1MywgZ2xTdWJJbWFnZS5jb2xvclRleHR1cmUsIDApOwogICAgICAgICAgICAgIGlmIChnbFN1YkltYWdlLmRlcHRoU3RlbmNpbFRleHR1cmUgIT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoMzYxNjAsIDM2MDk2LCAzNTUzLCBnbFN1YkltYWdlLmRlcHRoU3RlbmNpbFRleHR1cmUsIDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2aWV3cG9ydCA9IGdsU3ViSW1hZ2Uudmlld3BvcnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY2FtZXJhID0gY2FtZXJhc1tpXTsKICAgICAgICAgICAgY2FtZXJhLm1hdHJpeC5mcm9tQXJyYXkodmlldy50cmFuc2Zvcm0ubWF0cml4KTsKICAgICAgICAgICAgY2FtZXJhLnByb2plY3Rpb25NYXRyaXguZnJvbUFycmF5KHZpZXcucHJvamVjdGlvbk1hdHJpeCk7CiAgICAgICAgICAgIGNhbWVyYS52aWV3cG9ydC5zZXQodmlld3BvcnQueCwgdmlld3BvcnQueSwgdmlld3BvcnQud2lkdGgsIHZpZXdwb3J0LmhlaWdodCk7CiAgICAgICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgICAgY2FtZXJhVlIubWF0cml4LmNvcHkoY2FtZXJhLm1hdHJpeCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNhbWVyYVZSTmVlZHNVcGRhdGUgPT09IHRydWUpIHsKICAgICAgICAgICAgICBjYW1lcmFWUi5jYW1lcmFzLnB1c2goY2FtZXJhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBpbnB1dFNvdXJjZXMgPSBzZXNzaW9uLmlucHV0U291cmNlczsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbaV07CiAgICAgICAgICBjb25zdCBpbnB1dFNvdXJjZSA9IGlucHV0U291cmNlc1tpXTsKICAgICAgICAgIGNvbnRyb2xsZXIudXBkYXRlKGlucHV0U291cmNlLCBmcmFtZSwgcmVmZXJlbmNlU3BhY2UpOwogICAgICAgIH0KICAgICAgICBpZiAob25BbmltYXRpb25GcmFtZUNhbGxiYWNrKQogICAgICAgICAgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrKHRpbWUsIGZyYW1lKTsKICAgICAgfQogICAgICBjb25zdCBhbmltYXRpb24gPSBuZXcgV2ViR0xBbmltYXRpb24oKTsKICAgICAgYW5pbWF0aW9uLnNldEFuaW1hdGlvbkxvb3Aob25BbmltYXRpb25GcmFtZSk7CiAgICAgIHRoaXMuc2V0QW5pbWF0aW9uTG9vcCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICAgICAgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIH07CiAgICAgIHRoaXMuZGlzcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICB9OwogICAgfQogIH07CiAgZnVuY3Rpb24gV2ViR0xNYXRlcmlhbHMocHJvcGVydGllcykgewogICAgZnVuY3Rpb24gcmVmcmVzaEZvZ1VuaWZvcm1zKHVuaWZvcm1zLCBmb2cpIHsKICAgICAgdW5pZm9ybXMuZm9nQ29sb3IudmFsdWUuY29weShmb2cuY29sb3IpOwogICAgICBpZiAoZm9nLmlzRm9nKSB7CiAgICAgICAgdW5pZm9ybXMuZm9nTmVhci52YWx1ZSA9IGZvZy5uZWFyOwogICAgICAgIHVuaWZvcm1zLmZvZ0Zhci52YWx1ZSA9IGZvZy5mYXI7CiAgICAgIH0gZWxzZSBpZiAoZm9nLmlzRm9nRXhwMikgewogICAgICAgIHVuaWZvcm1zLmZvZ0RlbnNpdHkudmFsdWUgPSBmb2cuZGVuc2l0eTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVmcmVzaE1hdGVyaWFsVW5pZm9ybXModW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCkgewogICAgICBpZiAobWF0ZXJpYWwuaXNNZXNoQmFzaWNNYXRlcmlhbCkgewogICAgICAgIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbih1bmlmb3JtcywgbWF0ZXJpYWwpOwogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLmlzTWVzaExhbWJlcnRNYXRlcmlhbCkgewogICAgICAgIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbih1bmlmb3JtcywgbWF0ZXJpYWwpOwogICAgICAgIHJlZnJlc2hVbmlmb3Jtc0xhbWJlcnQodW5pZm9ybXMsIG1hdGVyaWFsKTsKICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwpIHsKICAgICAgICByZWZyZXNoVW5pZm9ybXNDb21tb24odW5pZm9ybXMsIG1hdGVyaWFsKTsKICAgICAgICByZWZyZXNoVW5pZm9ybXNUb29uKHVuaWZvcm1zLCBtYXRlcmlhbCk7CiAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwuaXNNZXNoUGhvbmdNYXRlcmlhbCkgewogICAgICAgIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbih1bmlmb3JtcywgbWF0ZXJpYWwpOwogICAgICAgIHJlZnJlc2hVbmlmb3Jtc1Bob25nKHVuaWZvcm1zLCBtYXRlcmlhbCk7CiAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCkgewogICAgICAgIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbih1bmlmb3JtcywgbWF0ZXJpYWwpOwogICAgICAgIGlmIChtYXRlcmlhbC5pc01lc2hQaHlzaWNhbE1hdGVyaWFsKSB7CiAgICAgICAgICByZWZyZXNoVW5pZm9ybXNQaHlzaWNhbCh1bmlmb3JtcywgbWF0ZXJpYWwsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlZnJlc2hVbmlmb3Jtc1N0YW5kYXJkKHVuaWZvcm1zLCBtYXRlcmlhbCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLmlzTWVzaE1hdGNhcE1hdGVyaWFsKSB7CiAgICAgICAgcmVmcmVzaFVuaWZvcm1zQ29tbW9uKHVuaWZvcm1zLCBtYXRlcmlhbCk7CiAgICAgICAgcmVmcmVzaFVuaWZvcm1zTWF0Y2FwKHVuaWZvcm1zLCBtYXRlcmlhbCk7CiAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwuaXNNZXNoRGVwdGhNYXRlcmlhbCkgewogICAgICAgIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbih1bmlmb3JtcywgbWF0ZXJpYWwpOwogICAgICAgIHJlZnJlc2hVbmlmb3Jtc0RlcHRoKHVuaWZvcm1zLCBtYXRlcmlhbCk7CiAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwuaXNNZXNoRGlzdGFuY2VNYXRlcmlhbCkgewogICAgICAgIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbih1bmlmb3JtcywgbWF0ZXJpYWwpOwogICAgICAgIHJlZnJlc2hVbmlmb3Jtc0Rpc3RhbmNlKHVuaWZvcm1zLCBtYXRlcmlhbCk7CiAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwuaXNNZXNoTm9ybWFsTWF0ZXJpYWwpIHsKICAgICAgICByZWZyZXNoVW5pZm9ybXNDb21tb24odW5pZm9ybXMsIG1hdGVyaWFsKTsKICAgICAgICByZWZyZXNoVW5pZm9ybXNOb3JtYWwodW5pZm9ybXMsIG1hdGVyaWFsKTsKICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC5pc0xpbmVCYXNpY01hdGVyaWFsKSB7CiAgICAgICAgcmVmcmVzaFVuaWZvcm1zTGluZSh1bmlmb3JtcywgbWF0ZXJpYWwpOwogICAgICAgIGlmIChtYXRlcmlhbC5pc0xpbmVEYXNoZWRNYXRlcmlhbCkgewogICAgICAgICAgcmVmcmVzaFVuaWZvcm1zRGFzaCh1bmlmb3JtcywgbWF0ZXJpYWwpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC5pc1BvaW50c01hdGVyaWFsKSB7CiAgICAgICAgcmVmcmVzaFVuaWZvcm1zUG9pbnRzKHVuaWZvcm1zLCBtYXRlcmlhbCwgcGl4ZWxSYXRpbywgaGVpZ2h0KTsKICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC5pc1Nwcml0ZU1hdGVyaWFsKSB7CiAgICAgICAgcmVmcmVzaFVuaWZvcm1zU3ByaXRlcyh1bmlmb3JtcywgbWF0ZXJpYWwpOwogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLmlzU2hhZG93TWF0ZXJpYWwpIHsKICAgICAgICB1bmlmb3Jtcy5jb2xvci52YWx1ZS5jb3B5KG1hdGVyaWFsLmNvbG9yKTsKICAgICAgICB1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsKSB7CiAgICAgICAgbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbih1bmlmb3JtcywgbWF0ZXJpYWwpIHsKICAgICAgdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CiAgICAgIGlmIChtYXRlcmlhbC5jb2xvcikgewogICAgICAgIHVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weShtYXRlcmlhbC5jb2xvcik7CiAgICAgIH0KICAgICAgaWYgKG1hdGVyaWFsLmVtaXNzaXZlKSB7CiAgICAgICAgdW5pZm9ybXMuZW1pc3NpdmUudmFsdWUuY29weShtYXRlcmlhbC5lbWlzc2l2ZSkubXVsdGlwbHlTY2FsYXIobWF0ZXJpYWwuZW1pc3NpdmVJbnRlbnNpdHkpOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5tYXApIHsKICAgICAgICB1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CiAgICAgIH0KICAgICAgaWYgKG1hdGVyaWFsLmFscGhhTWFwKSB7CiAgICAgICAgdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwuc3BlY3VsYXJNYXApIHsKICAgICAgICB1bmlmb3Jtcy5zcGVjdWxhck1hcC52YWx1ZSA9IG1hdGVyaWFsLnNwZWN1bGFyTWFwOwogICAgICB9CiAgICAgIGNvbnN0IGVudk1hcCA9IHByb3BlcnRpZXMuZ2V0KG1hdGVyaWFsKS5lbnZNYXA7CiAgICAgIGlmIChlbnZNYXApIHsKICAgICAgICB1bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBlbnZNYXA7CiAgICAgICAgdW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9IGVudk1hcC5pc0N1YmVUZXh0dXJlICYmIGVudk1hcC5fbmVlZHNGbGlwRW52TWFwID8gLTEgOiAxOwogICAgICAgIHVuaWZvcm1zLnJlZmxlY3Rpdml0eS52YWx1ZSA9IG1hdGVyaWFsLnJlZmxlY3Rpdml0eTsKICAgICAgICB1bmlmb3Jtcy5yZWZyYWN0aW9uUmF0aW8udmFsdWUgPSBtYXRlcmlhbC5yZWZyYWN0aW9uUmF0aW87CiAgICAgICAgY29uc3QgbWF4TWlwTGV2ZWwgPSBwcm9wZXJ0aWVzLmdldChlbnZNYXApLl9fbWF4TWlwTGV2ZWw7CiAgICAgICAgaWYgKG1heE1pcExldmVsICE9PSB2b2lkIDApIHsKICAgICAgICAgIHVuaWZvcm1zLm1heE1pcExldmVsLnZhbHVlID0gbWF4TWlwTGV2ZWw7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5saWdodE1hcCkgewogICAgICAgIHVuaWZvcm1zLmxpZ2h0TWFwLnZhbHVlID0gbWF0ZXJpYWwubGlnaHRNYXA7CiAgICAgICAgdW5pZm9ybXMubGlnaHRNYXBJbnRlbnNpdHkudmFsdWUgPSBtYXRlcmlhbC5saWdodE1hcEludGVuc2l0eTsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwuYW9NYXApIHsKICAgICAgICB1bmlmb3Jtcy5hb01hcC52YWx1ZSA9IG1hdGVyaWFsLmFvTWFwOwogICAgICAgIHVuaWZvcm1zLmFvTWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuYW9NYXBJbnRlbnNpdHk7CiAgICAgIH0KICAgICAgbGV0IHV2U2NhbGVNYXA7CiAgICAgIGlmIChtYXRlcmlhbC5tYXApIHsKICAgICAgICB1dlNjYWxlTWFwID0gbWF0ZXJpYWwubWFwOwogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLnNwZWN1bGFyTWFwKSB7CiAgICAgICAgdXZTY2FsZU1hcCA9IG1hdGVyaWFsLnNwZWN1bGFyTWFwOwogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCkgewogICAgICAgIHV2U2NhbGVNYXAgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CiAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwubm9ybWFsTWFwKSB7CiAgICAgICAgdXZTY2FsZU1hcCA9IG1hdGVyaWFsLm5vcm1hbE1hcDsKICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC5idW1wTWFwKSB7CiAgICAgICAgdXZTY2FsZU1hcCA9IG1hdGVyaWFsLmJ1bXBNYXA7CiAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwucm91Z2huZXNzTWFwKSB7CiAgICAgICAgdXZTY2FsZU1hcCA9IG1hdGVyaWFsLnJvdWdobmVzc01hcDsKICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC5tZXRhbG5lc3NNYXApIHsKICAgICAgICB1dlNjYWxlTWFwID0gbWF0ZXJpYWwubWV0YWxuZXNzTWFwOwogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLmFscGhhTWFwKSB7CiAgICAgICAgdXZTY2FsZU1hcCA9IG1hdGVyaWFsLmFscGhhTWFwOwogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLmVtaXNzaXZlTWFwKSB7CiAgICAgICAgdXZTY2FsZU1hcCA9IG1hdGVyaWFsLmVtaXNzaXZlTWFwOwogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLmNsZWFyY29hdE1hcCkgewogICAgICAgIHV2U2NhbGVNYXAgPSBtYXRlcmlhbC5jbGVhcmNvYXRNYXA7CiAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwKSB7CiAgICAgICAgdXZTY2FsZU1hcCA9IG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcDsKICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXApIHsKICAgICAgICB1dlNjYWxlTWFwID0gbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzTWFwOwogICAgICB9CiAgICAgIGlmICh1dlNjYWxlTWFwICE9PSB2b2lkIDApIHsKICAgICAgICBpZiAodXZTY2FsZU1hcC5pc1dlYkdMUmVuZGVyVGFyZ2V0KSB7CiAgICAgICAgICB1dlNjYWxlTWFwID0gdXZTY2FsZU1hcC50ZXh0dXJlOwogICAgICAgIH0KICAgICAgICBpZiAodXZTY2FsZU1hcC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlKSB7CiAgICAgICAgICB1dlNjYWxlTWFwLnVwZGF0ZU1hdHJpeCgpOwogICAgICAgIH0KICAgICAgICB1bmlmb3Jtcy51dlRyYW5zZm9ybS52YWx1ZS5jb3B5KHV2U2NhbGVNYXAubWF0cml4KTsKICAgICAgfQogICAgICBsZXQgdXYyU2NhbGVNYXA7CiAgICAgIGlmIChtYXRlcmlhbC5hb01hcCkgewogICAgICAgIHV2MlNjYWxlTWFwID0gbWF0ZXJpYWwuYW9NYXA7CiAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwubGlnaHRNYXApIHsKICAgICAgICB1djJTY2FsZU1hcCA9IG1hdGVyaWFsLmxpZ2h0TWFwOwogICAgICB9CiAgICAgIGlmICh1djJTY2FsZU1hcCAhPT0gdm9pZCAwKSB7CiAgICAgICAgaWYgKHV2MlNjYWxlTWFwLmlzV2ViR0xSZW5kZXJUYXJnZXQpIHsKICAgICAgICAgIHV2MlNjYWxlTWFwID0gdXYyU2NhbGVNYXAudGV4dHVyZTsKICAgICAgICB9CiAgICAgICAgaWYgKHV2MlNjYWxlTWFwLm1hdHJpeEF1dG9VcGRhdGUgPT09IHRydWUpIHsKICAgICAgICAgIHV2MlNjYWxlTWFwLnVwZGF0ZU1hdHJpeCgpOwogICAgICAgIH0KICAgICAgICB1bmlmb3Jtcy51djJUcmFuc2Zvcm0udmFsdWUuY29weSh1djJTY2FsZU1hcC5tYXRyaXgpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNMaW5lKHVuaWZvcm1zLCBtYXRlcmlhbCkgewogICAgICB1bmlmb3Jtcy5kaWZmdXNlLnZhbHVlLmNvcHkobWF0ZXJpYWwuY29sb3IpOwogICAgICB1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0Rhc2godW5pZm9ybXMsIG1hdGVyaWFsKSB7CiAgICAgIHVuaWZvcm1zLmRhc2hTaXplLnZhbHVlID0gbWF0ZXJpYWwuZGFzaFNpemU7CiAgICAgIHVuaWZvcm1zLnRvdGFsU2l6ZS52YWx1ZSA9IG1hdGVyaWFsLmRhc2hTaXplICsgbWF0ZXJpYWwuZ2FwU2l6ZTsKICAgICAgdW5pZm9ybXMuc2NhbGUudmFsdWUgPSBtYXRlcmlhbC5zY2FsZTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1BvaW50cyh1bmlmb3JtcywgbWF0ZXJpYWwsIHBpeGVsUmF0aW8sIGhlaWdodCkgewogICAgICB1bmlmb3Jtcy5kaWZmdXNlLnZhbHVlLmNvcHkobWF0ZXJpYWwuY29sb3IpOwogICAgICB1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKICAgICAgdW5pZm9ybXMuc2l6ZS52YWx1ZSA9IG1hdGVyaWFsLnNpemUgKiBwaXhlbFJhdGlvOwogICAgICB1bmlmb3Jtcy5zY2FsZS52YWx1ZSA9IGhlaWdodCAqIDAuNTsKICAgICAgaWYgKG1hdGVyaWFsLm1hcCkgewogICAgICAgIHVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwuYWxwaGFNYXApIHsKICAgICAgICB1bmlmb3Jtcy5hbHBoYU1hcC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhTWFwOwogICAgICB9CiAgICAgIGxldCB1dlNjYWxlTWFwOwogICAgICBpZiAobWF0ZXJpYWwubWFwKSB7CiAgICAgICAgdXZTY2FsZU1hcCA9IG1hdGVyaWFsLm1hcDsKICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC5hbHBoYU1hcCkgewogICAgICAgIHV2U2NhbGVNYXAgPSBtYXRlcmlhbC5hbHBoYU1hcDsKICAgICAgfQogICAgICBpZiAodXZTY2FsZU1hcCAhPT0gdm9pZCAwKSB7CiAgICAgICAgaWYgKHV2U2NhbGVNYXAubWF0cml4QXV0b1VwZGF0ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgdXZTY2FsZU1hcC51cGRhdGVNYXRyaXgoKTsKICAgICAgICB9CiAgICAgICAgdW5pZm9ybXMudXZUcmFuc2Zvcm0udmFsdWUuY29weSh1dlNjYWxlTWFwLm1hdHJpeCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Nwcml0ZXModW5pZm9ybXMsIG1hdGVyaWFsKSB7CiAgICAgIHVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weShtYXRlcmlhbC5jb2xvcik7CiAgICAgIHVuaWZvcm1zLm9wYWNpdHkudmFsdWUgPSBtYXRlcmlhbC5vcGFjaXR5OwogICAgICB1bmlmb3Jtcy5yb3RhdGlvbi52YWx1ZSA9IG1hdGVyaWFsLnJvdGF0aW9uOwogICAgICBpZiAobWF0ZXJpYWwubWFwKSB7CiAgICAgICAgdW5pZm9ybXMubWFwLnZhbHVlID0gbWF0ZXJpYWwubWFwOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5hbHBoYU1hcCkgewogICAgICAgIHVuaWZvcm1zLmFscGhhTWFwLnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFNYXA7CiAgICAgIH0KICAgICAgbGV0IHV2U2NhbGVNYXA7CiAgICAgIGlmIChtYXRlcmlhbC5tYXApIHsKICAgICAgICB1dlNjYWxlTWFwID0gbWF0ZXJpYWwubWFwOwogICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLmFscGhhTWFwKSB7CiAgICAgICAgdXZTY2FsZU1hcCA9IG1hdGVyaWFsLmFscGhhTWFwOwogICAgICB9CiAgICAgIGlmICh1dlNjYWxlTWFwICE9PSB2b2lkIDApIHsKICAgICAgICBpZiAodXZTY2FsZU1hcC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlKSB7CiAgICAgICAgICB1dlNjYWxlTWFwLnVwZGF0ZU1hdHJpeCgpOwogICAgICAgIH0KICAgICAgICB1bmlmb3Jtcy51dlRyYW5zZm9ybS52YWx1ZS5jb3B5KHV2U2NhbGVNYXAubWF0cml4KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zTGFtYmVydCh1bmlmb3JtcywgbWF0ZXJpYWwpIHsKICAgICAgaWYgKG1hdGVyaWFsLmVtaXNzaXZlTWFwKSB7CiAgICAgICAgdW5pZm9ybXMuZW1pc3NpdmVNYXAudmFsdWUgPSBtYXRlcmlhbC5lbWlzc2l2ZU1hcDsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zUGhvbmcodW5pZm9ybXMsIG1hdGVyaWFsKSB7CiAgICAgIHVuaWZvcm1zLnNwZWN1bGFyLnZhbHVlLmNvcHkobWF0ZXJpYWwuc3BlY3VsYXIpOwogICAgICB1bmlmb3Jtcy5zaGluaW5lc3MudmFsdWUgPSBNYXRoLm1heChtYXRlcmlhbC5zaGluaW5lc3MsIDFlLTQpOwogICAgICBpZiAobWF0ZXJpYWwuZW1pc3NpdmVNYXApIHsKICAgICAgICB1bmlmb3Jtcy5lbWlzc2l2ZU1hcC52YWx1ZSA9IG1hdGVyaWFsLmVtaXNzaXZlTWFwOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5idW1wTWFwKSB7CiAgICAgICAgdW5pZm9ybXMuYnVtcE1hcC52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBNYXA7CiAgICAgICAgdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuYnVtcFNjYWxlOwogICAgICAgIGlmIChtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSkKICAgICAgICAgIHVuaWZvcm1zLmJ1bXBTY2FsZS52YWx1ZSAqPSAtMTsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwubm9ybWFsTWFwKSB7CiAgICAgICAgdW5pZm9ybXMubm9ybWFsTWFwLnZhbHVlID0gbWF0ZXJpYWwubm9ybWFsTWFwOwogICAgICAgIHVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLmNvcHkobWF0ZXJpYWwubm9ybWFsU2NhbGUpOwogICAgICAgIGlmIChtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSkKICAgICAgICAgIHVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXApIHsKICAgICAgICB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CiAgICAgICAgdW5pZm9ybXMuZGlzcGxhY2VtZW50U2NhbGUudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZTsKICAgICAgICB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRCaWFzLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zVG9vbih1bmlmb3JtcywgbWF0ZXJpYWwpIHsKICAgICAgaWYgKG1hdGVyaWFsLmdyYWRpZW50TWFwKSB7CiAgICAgICAgdW5pZm9ybXMuZ3JhZGllbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5ncmFkaWVudE1hcDsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwuZW1pc3NpdmVNYXApIHsKICAgICAgICB1bmlmb3Jtcy5lbWlzc2l2ZU1hcC52YWx1ZSA9IG1hdGVyaWFsLmVtaXNzaXZlTWFwOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5idW1wTWFwKSB7CiAgICAgICAgdW5pZm9ybXMuYnVtcE1hcC52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBNYXA7CiAgICAgICAgdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuYnVtcFNjYWxlOwogICAgICAgIGlmIChtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSkKICAgICAgICAgIHVuaWZvcm1zLmJ1bXBTY2FsZS52YWx1ZSAqPSAtMTsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwubm9ybWFsTWFwKSB7CiAgICAgICAgdW5pZm9ybXMubm9ybWFsTWFwLnZhbHVlID0gbWF0ZXJpYWwubm9ybWFsTWFwOwogICAgICAgIHVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLmNvcHkobWF0ZXJpYWwubm9ybWFsU2NhbGUpOwogICAgICAgIGlmIChtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSkKICAgICAgICAgIHVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXApIHsKICAgICAgICB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CiAgICAgICAgdW5pZm9ybXMuZGlzcGxhY2VtZW50U2NhbGUudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZTsKICAgICAgICB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRCaWFzLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zU3RhbmRhcmQodW5pZm9ybXMsIG1hdGVyaWFsKSB7CiAgICAgIHVuaWZvcm1zLnJvdWdobmVzcy52YWx1ZSA9IG1hdGVyaWFsLnJvdWdobmVzczsKICAgICAgdW5pZm9ybXMubWV0YWxuZXNzLnZhbHVlID0gbWF0ZXJpYWwubWV0YWxuZXNzOwogICAgICBpZiAobWF0ZXJpYWwucm91Z2huZXNzTWFwKSB7CiAgICAgICAgdW5pZm9ybXMucm91Z2huZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwucm91Z2huZXNzTWFwOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5tZXRhbG5lc3NNYXApIHsKICAgICAgICB1bmlmb3Jtcy5tZXRhbG5lc3NNYXAudmFsdWUgPSBtYXRlcmlhbC5tZXRhbG5lc3NNYXA7CiAgICAgIH0KICAgICAgaWYgKG1hdGVyaWFsLmVtaXNzaXZlTWFwKSB7CiAgICAgICAgdW5pZm9ybXMuZW1pc3NpdmVNYXAudmFsdWUgPSBtYXRlcmlhbC5lbWlzc2l2ZU1hcDsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwuYnVtcE1hcCkgewogICAgICAgIHVuaWZvcm1zLmJ1bXBNYXAudmFsdWUgPSBtYXRlcmlhbC5idW1wTWFwOwogICAgICAgIHVuaWZvcm1zLmJ1bXBTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBTY2FsZTsKICAgICAgICBpZiAobWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUpCiAgICAgICAgICB1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgKj0gLTE7CiAgICAgIH0KICAgICAgaWYgKG1hdGVyaWFsLm5vcm1hbE1hcCkgewogICAgICAgIHVuaWZvcm1zLm5vcm1hbE1hcC52YWx1ZSA9IG1hdGVyaWFsLm5vcm1hbE1hcDsKICAgICAgICB1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5jb3B5KG1hdGVyaWFsLm5vcm1hbFNjYWxlKTsKICAgICAgICBpZiAobWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUpCiAgICAgICAgICB1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5uZWdhdGUoKTsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwKSB7CiAgICAgICAgdW5pZm9ybXMuZGlzcGxhY2VtZW50TWFwLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwOwogICAgICAgIHVuaWZvcm1zLmRpc3BsYWNlbWVudFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGU7CiAgICAgICAgdW5pZm9ybXMuZGlzcGxhY2VtZW50Qmlhcy52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CiAgICAgIH0KICAgICAgY29uc3QgZW52TWFwID0gcHJvcGVydGllcy5nZXQobWF0ZXJpYWwpLmVudk1hcDsKICAgICAgaWYgKGVudk1hcCkgewogICAgICAgIHVuaWZvcm1zLmVudk1hcEludGVuc2l0eS52YWx1ZSA9IG1hdGVyaWFsLmVudk1hcEludGVuc2l0eTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zUGh5c2ljYWwodW5pZm9ybXMsIG1hdGVyaWFsLCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQpIHsKICAgICAgcmVmcmVzaFVuaWZvcm1zU3RhbmRhcmQodW5pZm9ybXMsIG1hdGVyaWFsKTsKICAgICAgdW5pZm9ybXMucmVmbGVjdGl2aXR5LnZhbHVlID0gbWF0ZXJpYWwucmVmbGVjdGl2aXR5OwogICAgICB1bmlmb3Jtcy5jbGVhcmNvYXQudmFsdWUgPSBtYXRlcmlhbC5jbGVhcmNvYXQ7CiAgICAgIHVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzcy52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzczsKICAgICAgaWYgKG1hdGVyaWFsLnNoZWVuKQogICAgICAgIHVuaWZvcm1zLnNoZWVuLnZhbHVlLmNvcHkobWF0ZXJpYWwuc2hlZW4pOwogICAgICBpZiAobWF0ZXJpYWwuY2xlYXJjb2F0TWFwKSB7CiAgICAgICAgdW5pZm9ybXMuY2xlYXJjb2F0TWFwLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0TWFwOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXApIHsKICAgICAgICB1bmlmb3Jtcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAudmFsdWUgPSBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXA7CiAgICAgIH0KICAgICAgaWYgKG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcCkgewogICAgICAgIHVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbFNjYWxlLnZhbHVlLmNvcHkobWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsU2NhbGUpOwogICAgICAgIHVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbE1hcC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcDsKICAgICAgICBpZiAobWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUpIHsKICAgICAgICAgIHVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICB1bmlmb3Jtcy50cmFuc21pc3Npb24udmFsdWUgPSBtYXRlcmlhbC50cmFuc21pc3Npb247CiAgICAgIGlmIChtYXRlcmlhbC50cmFuc21pc3Npb25NYXApIHsKICAgICAgICB1bmlmb3Jtcy50cmFuc21pc3Npb25NYXAudmFsdWUgPSBtYXRlcmlhbC50cmFuc21pc3Npb25NYXA7CiAgICAgIH0KICAgICAgaWYgKG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA+IDApIHsKICAgICAgICB1bmlmb3Jtcy50cmFuc21pc3Npb25TYW1wbGVyTWFwLnZhbHVlID0gdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LnRleHR1cmU7CiAgICAgICAgdW5pZm9ybXMudHJhbnNtaXNzaW9uU2FtcGxlclNpemUudmFsdWUuc2V0KHRyYW5zbWlzc2lvblJlbmRlclRhcmdldC53aWR0aCwgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LmhlaWdodCk7CiAgICAgIH0KICAgICAgdW5pZm9ybXMudGhpY2tuZXNzLnZhbHVlID0gbWF0ZXJpYWwudGhpY2tuZXNzOwogICAgICBpZiAobWF0ZXJpYWwudGhpY2tuZXNzTWFwKSB7CiAgICAgICAgdW5pZm9ybXMudGhpY2tuZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwudGhpY2tuZXNzTWFwOwogICAgICB9CiAgICAgIHVuaWZvcm1zLmF0dGVudWF0aW9uRGlzdGFuY2UudmFsdWUgPSBtYXRlcmlhbC5hdHRlbnVhdGlvbkRpc3RhbmNlOwogICAgICB1bmlmb3Jtcy5hdHRlbnVhdGlvbkNvbG9yLnZhbHVlLmNvcHkobWF0ZXJpYWwuYXR0ZW51YXRpb25Db2xvcik7CiAgICB9CiAgICBmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNNYXRjYXAodW5pZm9ybXMsIG1hdGVyaWFsKSB7CiAgICAgIGlmIChtYXRlcmlhbC5tYXRjYXApIHsKICAgICAgICB1bmlmb3Jtcy5tYXRjYXAudmFsdWUgPSBtYXRlcmlhbC5tYXRjYXA7CiAgICAgIH0KICAgICAgaWYgKG1hdGVyaWFsLmJ1bXBNYXApIHsKICAgICAgICB1bmlmb3Jtcy5idW1wTWFwLnZhbHVlID0gbWF0ZXJpYWwuYnVtcE1hcDsKICAgICAgICB1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgPSBtYXRlcmlhbC5idW1wU2NhbGU7CiAgICAgICAgaWYgKG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlKQogICAgICAgICAgdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlICo9IC0xOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5ub3JtYWxNYXApIHsKICAgICAgICB1bmlmb3Jtcy5ub3JtYWxNYXAudmFsdWUgPSBtYXRlcmlhbC5ub3JtYWxNYXA7CiAgICAgICAgdW5pZm9ybXMubm9ybWFsU2NhbGUudmFsdWUuY29weShtYXRlcmlhbC5ub3JtYWxTY2FsZSk7CiAgICAgICAgaWYgKG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlKQogICAgICAgICAgdW5pZm9ybXMubm9ybWFsU2NhbGUudmFsdWUubmVnYXRlKCk7CiAgICAgIH0KICAgICAgaWYgKG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCkgewogICAgICAgIHVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKICAgICAgICB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwogICAgICAgIHVuaWZvcm1zLmRpc3BsYWNlbWVudEJpYXMudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRCaWFzOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNEZXB0aCh1bmlmb3JtcywgbWF0ZXJpYWwpIHsKICAgICAgaWYgKG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCkgewogICAgICAgIHVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKICAgICAgICB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwogICAgICAgIHVuaWZvcm1zLmRpc3BsYWNlbWVudEJpYXMudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRCaWFzOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNEaXN0YW5jZSh1bmlmb3JtcywgbWF0ZXJpYWwpIHsKICAgICAgaWYgKG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCkgewogICAgICAgIHVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKICAgICAgICB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwogICAgICAgIHVuaWZvcm1zLmRpc3BsYWNlbWVudEJpYXMudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRCaWFzOwogICAgICB9CiAgICAgIHVuaWZvcm1zLnJlZmVyZW5jZVBvc2l0aW9uLnZhbHVlLmNvcHkobWF0ZXJpYWwucmVmZXJlbmNlUG9zaXRpb24pOwogICAgICB1bmlmb3Jtcy5uZWFyRGlzdGFuY2UudmFsdWUgPSBtYXRlcmlhbC5uZWFyRGlzdGFuY2U7CiAgICAgIHVuaWZvcm1zLmZhckRpc3RhbmNlLnZhbHVlID0gbWF0ZXJpYWwuZmFyRGlzdGFuY2U7CiAgICB9CiAgICBmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNOb3JtYWwodW5pZm9ybXMsIG1hdGVyaWFsKSB7CiAgICAgIGlmIChtYXRlcmlhbC5idW1wTWFwKSB7CiAgICAgICAgdW5pZm9ybXMuYnVtcE1hcC52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBNYXA7CiAgICAgICAgdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuYnVtcFNjYWxlOwogICAgICAgIGlmIChtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSkKICAgICAgICAgIHVuaWZvcm1zLmJ1bXBTY2FsZS52YWx1ZSAqPSAtMTsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwubm9ybWFsTWFwKSB7CiAgICAgICAgdW5pZm9ybXMubm9ybWFsTWFwLnZhbHVlID0gbWF0ZXJpYWwubm9ybWFsTWFwOwogICAgICAgIHVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLmNvcHkobWF0ZXJpYWwubm9ybWFsU2NhbGUpOwogICAgICAgIGlmIChtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSkKICAgICAgICAgIHVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwogICAgICB9CiAgICAgIGlmIChtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXApIHsKICAgICAgICB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CiAgICAgICAgdW5pZm9ybXMuZGlzcGxhY2VtZW50U2NhbGUudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZTsKICAgICAgICB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRCaWFzLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgcmVmcmVzaEZvZ1VuaWZvcm1zLAogICAgICByZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcwogICAgfTsKICB9CiAgZnVuY3Rpb24gY3JlYXRlQ2FudmFzRWxlbWVudCgpIHsKICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIsICJjYW52YXMiKTsKICAgIGNhbnZhcy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgIHJldHVybiBjYW52YXM7CiAgfQogIGZ1bmN0aW9uIFdlYkdMUmVuZGVyZXIocGFyYW1ldGVycyA9IHt9KSB7CiAgICBjb25zdCBfY2FudmFzMiA9IHBhcmFtZXRlcnMuY2FudmFzICE9PSB2b2lkIDAgPyBwYXJhbWV0ZXJzLmNhbnZhcyA6IGNyZWF0ZUNhbnZhc0VsZW1lbnQoKSwgX2NvbnRleHQyID0gcGFyYW1ldGVycy5jb250ZXh0ICE9PSB2b2lkIDAgPyBwYXJhbWV0ZXJzLmNvbnRleHQgOiBudWxsLCBfYWxwaGEgPSBwYXJhbWV0ZXJzLmFscGhhICE9PSB2b2lkIDAgPyBwYXJhbWV0ZXJzLmFscGhhIDogZmFsc2UsIF9kZXB0aCA9IHBhcmFtZXRlcnMuZGVwdGggIT09IHZvaWQgMCA/IHBhcmFtZXRlcnMuZGVwdGggOiB0cnVlLCBfc3RlbmNpbCA9IHBhcmFtZXRlcnMuc3RlbmNpbCAhPT0gdm9pZCAwID8gcGFyYW1ldGVycy5zdGVuY2lsIDogdHJ1ZSwgX2FudGlhbGlhcyA9IHBhcmFtZXRlcnMuYW50aWFsaWFzICE9PSB2b2lkIDAgPyBwYXJhbWV0ZXJzLmFudGlhbGlhcyA6IGZhbHNlLCBfcHJlbXVsdGlwbGllZEFscGhhID0gcGFyYW1ldGVycy5wcmVtdWx0aXBsaWVkQWxwaGEgIT09IHZvaWQgMCA/IHBhcmFtZXRlcnMucHJlbXVsdGlwbGllZEFscGhhIDogdHJ1ZSwgX3ByZXNlcnZlRHJhd2luZ0J1ZmZlciA9IHBhcmFtZXRlcnMucHJlc2VydmVEcmF3aW5nQnVmZmVyICE9PSB2b2lkIDAgPyBwYXJhbWV0ZXJzLnByZXNlcnZlRHJhd2luZ0J1ZmZlciA6IGZhbHNlLCBfcG93ZXJQcmVmZXJlbmNlID0gcGFyYW1ldGVycy5wb3dlclByZWZlcmVuY2UgIT09IHZvaWQgMCA/IHBhcmFtZXRlcnMucG93ZXJQcmVmZXJlbmNlIDogImRlZmF1bHQiLCBfZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCA9IHBhcmFtZXRlcnMuZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCAhPT0gdm9pZCAwID8gcGFyYW1ldGVycy5mYWlsSWZNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0IDogZmFsc2U7CiAgICBsZXQgY3VycmVudFJlbmRlckxpc3QgPSBudWxsOwogICAgbGV0IGN1cnJlbnRSZW5kZXJTdGF0ZSA9IG51bGw7CiAgICBjb25zdCByZW5kZXJMaXN0U3RhY2sgPSBbXTsKICAgIGNvbnN0IHJlbmRlclN0YXRlU3RhY2sgPSBbXTsKICAgIHRoaXMuZG9tRWxlbWVudCA9IF9jYW52YXMyOwogICAgdGhpcy5kZWJ1ZyA9IHsKICAgICAgY2hlY2tTaGFkZXJFcnJvcnM6IHRydWUKICAgIH07CiAgICB0aGlzLmF1dG9DbGVhciA9IHRydWU7CiAgICB0aGlzLmF1dG9DbGVhckNvbG9yID0gdHJ1ZTsKICAgIHRoaXMuYXV0b0NsZWFyRGVwdGggPSB0cnVlOwogICAgdGhpcy5hdXRvQ2xlYXJTdGVuY2lsID0gdHJ1ZTsKICAgIHRoaXMuc29ydE9iamVjdHMgPSB0cnVlOwogICAgdGhpcy5jbGlwcGluZ1BsYW5lcyA9IFtdOwogICAgdGhpcy5sb2NhbENsaXBwaW5nRW5hYmxlZCA9IGZhbHNlOwogICAgdGhpcy5nYW1tYUZhY3RvciA9IDI7CiAgICB0aGlzLm91dHB1dEVuY29kaW5nID0gTGluZWFyRW5jb2Rpbmc7CiAgICB0aGlzLnBoeXNpY2FsbHlDb3JyZWN0TGlnaHRzID0gZmFsc2U7CiAgICB0aGlzLnRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKICAgIHRoaXMudG9uZU1hcHBpbmdFeHBvc3VyZSA9IDE7CiAgICBjb25zdCBfdGhpcyA9IHRoaXM7CiAgICBsZXQgX2lzQ29udGV4dExvc3QgPSBmYWxzZTsKICAgIGxldCBfY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gMDsKICAgIGxldCBfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gMDsKICAgIGxldCBfY3VycmVudFJlbmRlclRhcmdldCA9IG51bGw7CiAgICBsZXQgX2N1cnJlbnRNYXRlcmlhbElkID0gLTE7CiAgICBsZXQgX2N1cnJlbnRDYW1lcmEgPSBudWxsOwogICAgY29uc3QgX2N1cnJlbnRWaWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CiAgICBjb25zdCBfY3VycmVudFNjaXNzb3IgPSBuZXcgVmVjdG9yNCgpOwogICAgbGV0IF9jdXJyZW50U2Npc3NvclRlc3QgPSBudWxsOwogICAgbGV0IF93aWR0aCA9IF9jYW52YXMyLndpZHRoOwogICAgbGV0IF9oZWlnaHQgPSBfY2FudmFzMi5oZWlnaHQ7CiAgICBsZXQgX3BpeGVsUmF0aW8gPSAxOwogICAgbGV0IF9vcGFxdWVTb3J0ID0gbnVsbDsKICAgIGxldCBfdHJhbnNwYXJlbnRTb3J0ID0gbnVsbDsKICAgIGNvbnN0IF92aWV3cG9ydCA9IG5ldyBWZWN0b3I0KDAsIDAsIF93aWR0aCwgX2hlaWdodCk7CiAgICBjb25zdCBfc2Npc3NvciA9IG5ldyBWZWN0b3I0KDAsIDAsIF93aWR0aCwgX2hlaWdodCk7CiAgICBsZXQgX3NjaXNzb3JUZXN0ID0gZmFsc2U7CiAgICBjb25zdCBfY3VycmVudERyYXdCdWZmZXJzID0gW107CiAgICBjb25zdCBfZnJ1c3R1bSA9IG5ldyBGcnVzdHVtKCk7CiAgICBsZXQgX2NsaXBwaW5nRW5hYmxlZCA9IGZhbHNlOwogICAgbGV0IF9sb2NhbENsaXBwaW5nRW5hYmxlZCA9IGZhbHNlOwogICAgbGV0IF90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgPSBudWxsOwogICAgY29uc3QgX3Byb2pTY3JlZW5NYXRyaXgyID0gbmV3IE1hdHJpeDQoKTsKICAgIGNvbnN0IF92ZWN0b3IzID0gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9lbXB0eVNjZW5lID0geyBiYWNrZ3JvdW5kOiBudWxsLCBmb2c6IG51bGwsIGVudmlyb25tZW50OiBudWxsLCBvdmVycmlkZU1hdGVyaWFsOiBudWxsLCBpc1NjZW5lOiB0cnVlIH07CiAgICBmdW5jdGlvbiBnZXRUYXJnZXRQaXhlbFJhdGlvKCkgewogICAgICByZXR1cm4gX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgPyBfcGl4ZWxSYXRpbyA6IDE7CiAgICB9CiAgICBsZXQgX2dsID0gX2NvbnRleHQyOwogICAgZnVuY3Rpb24gZ2V0Q29udGV4dChjb250ZXh0TmFtZXMsIGNvbnRleHRBdHRyaWJ1dGVzKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29udGV4dE5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgY29udGV4dE5hbWUgPSBjb250ZXh0TmFtZXNbaV07CiAgICAgICAgY29uc3QgY29udGV4dCA9IF9jYW52YXMyLmdldENvbnRleHQoY29udGV4dE5hbWUsIGNvbnRleHRBdHRyaWJ1dGVzKTsKICAgICAgICBpZiAoY29udGV4dCAhPT0gbnVsbCkKICAgICAgICAgIHJldHVybiBjb250ZXh0OwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdHJ5IHsKICAgICAgY29uc3QgY29udGV4dEF0dHJpYnV0ZXMgPSB7CiAgICAgICAgYWxwaGE6IF9hbHBoYSwKICAgICAgICBkZXB0aDogX2RlcHRoLAogICAgICAgIHN0ZW5jaWw6IF9zdGVuY2lsLAogICAgICAgIGFudGlhbGlhczogX2FudGlhbGlhcywKICAgICAgICBwcmVtdWx0aXBsaWVkQWxwaGE6IF9wcmVtdWx0aXBsaWVkQWxwaGEsCiAgICAgICAgcHJlc2VydmVEcmF3aW5nQnVmZmVyOiBfcHJlc2VydmVEcmF3aW5nQnVmZmVyLAogICAgICAgIHBvd2VyUHJlZmVyZW5jZTogX3Bvd2VyUHJlZmVyZW5jZSwKICAgICAgICBmYWlsSWZNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0OiBfZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdAogICAgICB9OwogICAgICBfY2FudmFzMi5hZGRFdmVudExpc3RlbmVyKCJ3ZWJnbGNvbnRleHRsb3N0Iiwgb25Db250ZXh0TG9zdCwgZmFsc2UpOwogICAgICBfY2FudmFzMi5hZGRFdmVudExpc3RlbmVyKCJ3ZWJnbGNvbnRleHRyZXN0b3JlZCIsIG9uQ29udGV4dFJlc3RvcmUsIGZhbHNlKTsKICAgICAgaWYgKF9nbCA9PT0gbnVsbCkgewogICAgICAgIGNvbnN0IGNvbnRleHROYW1lcyA9IFsid2ViZ2wyIiwgIndlYmdsIiwgImV4cGVyaW1lbnRhbC13ZWJnbCJdOwogICAgICAgIGlmIChfdGhpcy5pc1dlYkdMMVJlbmRlcmVyID09PSB0cnVlKSB7CiAgICAgICAgICBjb250ZXh0TmFtZXMuc2hpZnQoKTsKICAgICAgICB9CiAgICAgICAgX2dsID0gZ2V0Q29udGV4dChjb250ZXh0TmFtZXMsIGNvbnRleHRBdHRyaWJ1dGVzKTsKICAgICAgICBpZiAoX2dsID09PSBudWxsKSB7CiAgICAgICAgICBpZiAoZ2V0Q29udGV4dChjb250ZXh0TmFtZXMpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXJyb3IgY3JlYXRpbmcgV2ViR0wgY29udGV4dCB3aXRoIHlvdXIgc2VsZWN0ZWQgYXR0cmlidXRlcy4iKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXJyb3IgY3JlYXRpbmcgV2ViR0wgY29udGV4dC4iKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKF9nbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQgPT09IHZvaWQgMCkgewogICAgICAgIF9nbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB7ICJyYW5nZU1pbiI6IDEsICJyYW5nZU1heCI6IDEsICJwcmVjaXNpb24iOiAxIH07CiAgICAgICAgfTsKICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuV2ViR0xSZW5kZXJlcjogIiArIGVycm9yLm1lc3NhZ2UpOwogICAgICB0aHJvdyBlcnJvcjsKICAgIH0KICAgIGxldCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMsIHN0YXRlLCBpbmZvOwogICAgbGV0IHByb3BlcnRpZXMsIHRleHR1cmVzLCBjdWJlbWFwcywgYXR0cmlidXRlcywgZ2VvbWV0cmllcywgb2JqZWN0czsKICAgIGxldCBwcm9ncmFtQ2FjaGUsIG1hdGVyaWFscywgcmVuZGVyTGlzdHMsIHJlbmRlclN0YXRlcywgY2xpcHBpbmcsIHNoYWRvd01hcDsKICAgIGxldCBiYWNrZ3JvdW5kLCBtb3JwaHRhcmdldHMsIGJ1ZmZlclJlbmRlcmVyLCBpbmRleGVkQnVmZmVyUmVuZGVyZXI7CiAgICBsZXQgdXRpbHMsIGJpbmRpbmdTdGF0ZXM7CiAgICBmdW5jdGlvbiBpbml0R0xDb250ZXh0KCkgewogICAgICBleHRlbnNpb25zID0gbmV3IFdlYkdMRXh0ZW5zaW9ucyhfZ2wpOwogICAgICBjYXBhYmlsaXRpZXMgPSBuZXcgV2ViR0xDYXBhYmlsaXRpZXMoX2dsLCBleHRlbnNpb25zLCBwYXJhbWV0ZXJzKTsKICAgICAgZXh0ZW5zaW9ucy5pbml0KGNhcGFiaWxpdGllcyk7CiAgICAgIHV0aWxzID0gbmV3IFdlYkdMVXRpbHMoX2dsLCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMpOwogICAgICBzdGF0ZSA9IG5ldyBXZWJHTFN0YXRlKF9nbCwgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzKTsKICAgICAgX2N1cnJlbnREcmF3QnVmZmVyc1swXSA9IDEwMjk7CiAgICAgIGluZm8gPSBuZXcgV2ViR0xJbmZvKF9nbCk7CiAgICAgIHByb3BlcnRpZXMgPSBuZXcgV2ViR0xQcm9wZXJ0aWVzKCk7CiAgICAgIHRleHR1cmVzID0gbmV3IFdlYkdMVGV4dHVyZXMoX2dsLCBleHRlbnNpb25zLCBzdGF0ZSwgcHJvcGVydGllcywgY2FwYWJpbGl0aWVzLCB1dGlscywgaW5mbyk7CiAgICAgIGN1YmVtYXBzID0gbmV3IFdlYkdMQ3ViZU1hcHMoX3RoaXMpOwogICAgICBhdHRyaWJ1dGVzID0gbmV3IFdlYkdMQXR0cmlidXRlcyhfZ2wsIGNhcGFiaWxpdGllcyk7CiAgICAgIGJpbmRpbmdTdGF0ZXMgPSBuZXcgV2ViR0xCaW5kaW5nU3RhdGVzKF9nbCwgZXh0ZW5zaW9ucywgYXR0cmlidXRlcywgY2FwYWJpbGl0aWVzKTsKICAgICAgZ2VvbWV0cmllcyA9IG5ldyBXZWJHTEdlb21ldHJpZXMoX2dsLCBhdHRyaWJ1dGVzLCBpbmZvLCBiaW5kaW5nU3RhdGVzKTsKICAgICAgb2JqZWN0cyA9IG5ldyBXZWJHTE9iamVjdHMoX2dsLCBnZW9tZXRyaWVzLCBhdHRyaWJ1dGVzLCBpbmZvKTsKICAgICAgbW9ycGh0YXJnZXRzID0gbmV3IFdlYkdMTW9ycGh0YXJnZXRzKF9nbCk7CiAgICAgIGNsaXBwaW5nID0gbmV3IFdlYkdMQ2xpcHBpbmcocHJvcGVydGllcyk7CiAgICAgIHByb2dyYW1DYWNoZSA9IG5ldyBXZWJHTFByb2dyYW1zKF90aGlzLCBjdWJlbWFwcywgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzLCBiaW5kaW5nU3RhdGVzLCBjbGlwcGluZyk7CiAgICAgIG1hdGVyaWFscyA9IG5ldyBXZWJHTE1hdGVyaWFscyhwcm9wZXJ0aWVzKTsKICAgICAgcmVuZGVyTGlzdHMgPSBuZXcgV2ViR0xSZW5kZXJMaXN0cyhwcm9wZXJ0aWVzKTsKICAgICAgcmVuZGVyU3RhdGVzID0gbmV3IFdlYkdMUmVuZGVyU3RhdGVzKGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyk7CiAgICAgIGJhY2tncm91bmQgPSBuZXcgV2ViR0xCYWNrZ3JvdW5kKF90aGlzLCBjdWJlbWFwcywgc3RhdGUsIG9iamVjdHMsIF9wcmVtdWx0aXBsaWVkQWxwaGEpOwogICAgICBzaGFkb3dNYXAgPSBuZXcgV2ViR0xTaGFkb3dNYXAoX3RoaXMsIG9iamVjdHMsIGNhcGFiaWxpdGllcyk7CiAgICAgIGJ1ZmZlclJlbmRlcmVyID0gbmV3IFdlYkdMQnVmZmVyUmVuZGVyZXIoX2dsLCBleHRlbnNpb25zLCBpbmZvLCBjYXBhYmlsaXRpZXMpOwogICAgICBpbmRleGVkQnVmZmVyUmVuZGVyZXIgPSBuZXcgV2ViR0xJbmRleGVkQnVmZmVyUmVuZGVyZXIoX2dsLCBleHRlbnNpb25zLCBpbmZvLCBjYXBhYmlsaXRpZXMpOwogICAgICBpbmZvLnByb2dyYW1zID0gcHJvZ3JhbUNhY2hlLnByb2dyYW1zOwogICAgICBfdGhpcy5jYXBhYmlsaXRpZXMgPSBjYXBhYmlsaXRpZXM7CiAgICAgIF90aGlzLmV4dGVuc2lvbnMgPSBleHRlbnNpb25zOwogICAgICBfdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKICAgICAgX3RoaXMucmVuZGVyTGlzdHMgPSByZW5kZXJMaXN0czsKICAgICAgX3RoaXMuc2hhZG93TWFwID0gc2hhZG93TWFwOwogICAgICBfdGhpcy5zdGF0ZSA9IHN0YXRlOwogICAgICBfdGhpcy5pbmZvID0gaW5mbzsKICAgIH0KICAgIGluaXRHTENvbnRleHQoKTsKICAgIGNvbnN0IHhyID0gbmV3IFdlYlhSTWFuYWdlcihfdGhpcywgX2dsKTsKICAgIHRoaXMueHIgPSB4cjsKICAgIHRoaXMuZ2V0Q29udGV4dCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gX2dsOwogICAgfTsKICAgIHRoaXMuZ2V0Q29udGV4dEF0dHJpYnV0ZXMgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIF9nbC5nZXRDb250ZXh0QXR0cmlidXRlcygpOwogICAgfTsKICAgIHRoaXMuZm9yY2VDb250ZXh0TG9zcyA9IGZ1bmN0aW9uKCkgewogICAgICBjb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCgiV0VCR0xfbG9zZV9jb250ZXh0Iik7CiAgICAgIGlmIChleHRlbnNpb24pCiAgICAgICAgZXh0ZW5zaW9uLmxvc2VDb250ZXh0KCk7CiAgICB9OwogICAgdGhpcy5mb3JjZUNvbnRleHRSZXN0b3JlID0gZnVuY3Rpb24oKSB7CiAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCJXRUJHTF9sb3NlX2NvbnRleHQiKTsKICAgICAgaWYgKGV4dGVuc2lvbikKICAgICAgICBleHRlbnNpb24ucmVzdG9yZUNvbnRleHQoKTsKICAgIH07CiAgICB0aGlzLmdldFBpeGVsUmF0aW8gPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIF9waXhlbFJhdGlvOwogICAgfTsKICAgIHRoaXMuc2V0UGl4ZWxSYXRpbyA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKQogICAgICAgIHJldHVybjsKICAgICAgX3BpeGVsUmF0aW8gPSB2YWx1ZTsKICAgICAgdGhpcy5zZXRTaXplKF93aWR0aCwgX2hlaWdodCwgZmFsc2UpOwogICAgfTsKICAgIHRoaXMuZ2V0U2l6ZSA9IGZ1bmN0aW9uKHRhcmdldCkgewogICAgICByZXR1cm4gdGFyZ2V0LnNldChfd2lkdGgsIF9oZWlnaHQpOwogICAgfTsKICAgIHRoaXMuc2V0U2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQsIHVwZGF0ZVN0eWxlKSB7CiAgICAgIGlmICh4ci5pc1ByZXNlbnRpbmcpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IENhbid0IGNoYW5nZSBzaXplIHdoaWxlIFZSIGRldmljZSBpcyBwcmVzZW50aW5nLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBfd2lkdGggPSB3aWR0aDsKICAgICAgX2hlaWdodCA9IGhlaWdodDsKICAgICAgX2NhbnZhczIud2lkdGggPSBNYXRoLmZsb29yKHdpZHRoICogX3BpeGVsUmF0aW8pOwogICAgICBfY2FudmFzMi5oZWlnaHQgPSBNYXRoLmZsb29yKGhlaWdodCAqIF9waXhlbFJhdGlvKTsKICAgICAgaWYgKHVwZGF0ZVN0eWxlICE9PSBmYWxzZSkgewogICAgICAgIF9jYW52YXMyLnN0eWxlLndpZHRoID0gd2lkdGggKyAicHgiOwogICAgICAgIF9jYW52YXMyLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICJweCI7CiAgICAgIH0KICAgICAgdGhpcy5zZXRWaWV3cG9ydCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgIH07CiAgICB0aGlzLmdldERyYXdpbmdCdWZmZXJTaXplID0gZnVuY3Rpb24odGFyZ2V0KSB7CiAgICAgIHJldHVybiB0YXJnZXQuc2V0KF93aWR0aCAqIF9waXhlbFJhdGlvLCBfaGVpZ2h0ICogX3BpeGVsUmF0aW8pLmZsb29yKCk7CiAgICB9OwogICAgdGhpcy5zZXREcmF3aW5nQnVmZmVyU2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQsIHBpeGVsUmF0aW8pIHsKICAgICAgX3dpZHRoID0gd2lkdGg7CiAgICAgIF9oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIF9waXhlbFJhdGlvID0gcGl4ZWxSYXRpbzsKICAgICAgX2NhbnZhczIud2lkdGggPSBNYXRoLmZsb29yKHdpZHRoICogcGl4ZWxSYXRpbyk7CiAgICAgIF9jYW52YXMyLmhlaWdodCA9IE1hdGguZmxvb3IoaGVpZ2h0ICogcGl4ZWxSYXRpbyk7CiAgICAgIHRoaXMuc2V0Vmlld3BvcnQoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICB9OwogICAgdGhpcy5nZXRDdXJyZW50Vmlld3BvcnQgPSBmdW5jdGlvbih0YXJnZXQpIHsKICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KF9jdXJyZW50Vmlld3BvcnQpOwogICAgfTsKICAgIHRoaXMuZ2V0Vmlld3BvcnQgPSBmdW5jdGlvbih0YXJnZXQpIHsKICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KF92aWV3cG9ydCk7CiAgICB9OwogICAgdGhpcy5zZXRWaWV3cG9ydCA9IGZ1bmN0aW9uKHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgaWYgKHguaXNWZWN0b3I0KSB7CiAgICAgICAgX3ZpZXdwb3J0LnNldCh4LngsIHgueSwgeC56LCB4LncpOwogICAgICB9IGVsc2UgewogICAgICAgIF92aWV3cG9ydC5zZXQoeCwgeSwgd2lkdGgsIGhlaWdodCk7CiAgICAgIH0KICAgICAgc3RhdGUudmlld3BvcnQoX2N1cnJlbnRWaWV3cG9ydC5jb3B5KF92aWV3cG9ydCkubXVsdGlwbHlTY2FsYXIoX3BpeGVsUmF0aW8pLmZsb29yKCkpOwogICAgfTsKICAgIHRoaXMuZ2V0U2Npc3NvciA9IGZ1bmN0aW9uKHRhcmdldCkgewogICAgICByZXR1cm4gdGFyZ2V0LmNvcHkoX3NjaXNzb3IpOwogICAgfTsKICAgIHRoaXMuc2V0U2Npc3NvciA9IGZ1bmN0aW9uKHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgaWYgKHguaXNWZWN0b3I0KSB7CiAgICAgICAgX3NjaXNzb3Iuc2V0KHgueCwgeC55LCB4LnosIHgudyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3NjaXNzb3Iuc2V0KHgsIHksIHdpZHRoLCBoZWlnaHQpOwogICAgICB9CiAgICAgIHN0YXRlLnNjaXNzb3IoX2N1cnJlbnRTY2lzc29yLmNvcHkoX3NjaXNzb3IpLm11bHRpcGx5U2NhbGFyKF9waXhlbFJhdGlvKS5mbG9vcigpKTsKICAgIH07CiAgICB0aGlzLmdldFNjaXNzb3JUZXN0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfc2Npc3NvclRlc3Q7CiAgICB9OwogICAgdGhpcy5zZXRTY2lzc29yVGVzdCA9IGZ1bmN0aW9uKGJvb2xlYW4pIHsKICAgICAgc3RhdGUuc2V0U2Npc3NvclRlc3QoX3NjaXNzb3JUZXN0ID0gYm9vbGVhbik7CiAgICB9OwogICAgdGhpcy5zZXRPcGFxdWVTb3J0ID0gZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgIF9vcGFxdWVTb3J0ID0gbWV0aG9kOwogICAgfTsKICAgIHRoaXMuc2V0VHJhbnNwYXJlbnRTb3J0ID0gZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgIF90cmFuc3BhcmVudFNvcnQgPSBtZXRob2Q7CiAgICB9OwogICAgdGhpcy5nZXRDbGVhckNvbG9yID0gZnVuY3Rpb24odGFyZ2V0KSB7CiAgICAgIHJldHVybiB0YXJnZXQuY29weShiYWNrZ3JvdW5kLmdldENsZWFyQ29sb3IoKSk7CiAgICB9OwogICAgdGhpcy5zZXRDbGVhckNvbG9yID0gZnVuY3Rpb24oKSB7CiAgICAgIGJhY2tncm91bmQuc2V0Q2xlYXJDb2xvci5hcHBseShiYWNrZ3JvdW5kLCBhcmd1bWVudHMpOwogICAgfTsKICAgIHRoaXMuZ2V0Q2xlYXJBbHBoYSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gYmFja2dyb3VuZC5nZXRDbGVhckFscGhhKCk7CiAgICB9OwogICAgdGhpcy5zZXRDbGVhckFscGhhID0gZnVuY3Rpb24oKSB7CiAgICAgIGJhY2tncm91bmQuc2V0Q2xlYXJBbHBoYS5hcHBseShiYWNrZ3JvdW5kLCBhcmd1bWVudHMpOwogICAgfTsKICAgIHRoaXMuY2xlYXIgPSBmdW5jdGlvbihjb2xvciwgZGVwdGgsIHN0ZW5jaWwpIHsKICAgICAgbGV0IGJpdHMgPSAwOwogICAgICBpZiAoY29sb3IgPT09IHZvaWQgMCB8fCBjb2xvcikKICAgICAgICBiaXRzIHw9IDE2Mzg0OwogICAgICBpZiAoZGVwdGggPT09IHZvaWQgMCB8fCBkZXB0aCkKICAgICAgICBiaXRzIHw9IDI1NjsKICAgICAgaWYgKHN0ZW5jaWwgPT09IHZvaWQgMCB8fCBzdGVuY2lsKQogICAgICAgIGJpdHMgfD0gMTAyNDsKICAgICAgX2dsLmNsZWFyKGJpdHMpOwogICAgfTsKICAgIHRoaXMuY2xlYXJDb2xvciA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmNsZWFyKHRydWUsIGZhbHNlLCBmYWxzZSk7CiAgICB9OwogICAgdGhpcy5jbGVhckRlcHRoID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuY2xlYXIoZmFsc2UsIHRydWUsIGZhbHNlKTsKICAgIH07CiAgICB0aGlzLmNsZWFyU3RlbmNpbCA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmNsZWFyKGZhbHNlLCBmYWxzZSwgdHJ1ZSk7CiAgICB9OwogICAgdGhpcy5kaXNwb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgIF9jYW52YXMyLnJlbW92ZUV2ZW50TGlzdGVuZXIoIndlYmdsY29udGV4dGxvc3QiLCBvbkNvbnRleHRMb3N0LCBmYWxzZSk7CiAgICAgIF9jYW52YXMyLnJlbW92ZUV2ZW50TGlzdGVuZXIoIndlYmdsY29udGV4dHJlc3RvcmVkIiwgb25Db250ZXh0UmVzdG9yZSwgZmFsc2UpOwogICAgICByZW5kZXJMaXN0cy5kaXNwb3NlKCk7CiAgICAgIHJlbmRlclN0YXRlcy5kaXNwb3NlKCk7CiAgICAgIHByb3BlcnRpZXMuZGlzcG9zZSgpOwogICAgICBjdWJlbWFwcy5kaXNwb3NlKCk7CiAgICAgIG9iamVjdHMuZGlzcG9zZSgpOwogICAgICBiaW5kaW5nU3RhdGVzLmRpc3Bvc2UoKTsKICAgICAgeHIuZGlzcG9zZSgpOwogICAgICB4ci5yZW1vdmVFdmVudExpc3RlbmVyKCJzZXNzaW9uc3RhcnQiLCBvblhSU2Vzc2lvblN0YXJ0KTsKICAgICAgeHIucmVtb3ZlRXZlbnRMaXN0ZW5lcigic2Vzc2lvbmVuZCIsIG9uWFJTZXNzaW9uRW5kKTsKICAgICAgaWYgKF90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQpIHsKICAgICAgICBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LmRpc3Bvc2UoKTsKICAgICAgICBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgfQogICAgICBhbmltYXRpb24uc3RvcCgpOwogICAgfTsKICAgIGZ1bmN0aW9uIG9uQ29udGV4dExvc3QoZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgY29uc29sZS5sb2coIlRIUkVFLldlYkdMUmVuZGVyZXI6IENvbnRleHQgTG9zdC4iKTsKICAgICAgX2lzQ29udGV4dExvc3QgPSB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gb25Db250ZXh0UmVzdG9yZSgpIHsKICAgICAgY29uc29sZS5sb2coIlRIUkVFLldlYkdMUmVuZGVyZXI6IENvbnRleHQgUmVzdG9yZWQuIik7CiAgICAgIF9pc0NvbnRleHRMb3N0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGluZm9BdXRvUmVzZXQgPSBpbmZvLmF1dG9SZXNldDsKICAgICAgY29uc3Qgc2hhZG93TWFwRW5hYmxlZCA9IHNoYWRvd01hcC5lbmFibGVkOwogICAgICBjb25zdCBzaGFkb3dNYXBBdXRvVXBkYXRlID0gc2hhZG93TWFwLmF1dG9VcGRhdGU7CiAgICAgIGNvbnN0IHNoYWRvd01hcE5lZWRzVXBkYXRlID0gc2hhZG93TWFwLm5lZWRzVXBkYXRlOwogICAgICBjb25zdCBzaGFkb3dNYXBUeXBlID0gc2hhZG93TWFwLnR5cGU7CiAgICAgIGluaXRHTENvbnRleHQoKTsKICAgICAgaW5mby5hdXRvUmVzZXQgPSBpbmZvQXV0b1Jlc2V0OwogICAgICBzaGFkb3dNYXAuZW5hYmxlZCA9IHNoYWRvd01hcEVuYWJsZWQ7CiAgICAgIHNoYWRvd01hcC5hdXRvVXBkYXRlID0gc2hhZG93TWFwQXV0b1VwZGF0ZTsKICAgICAgc2hhZG93TWFwLm5lZWRzVXBkYXRlID0gc2hhZG93TWFwTmVlZHNVcGRhdGU7CiAgICAgIHNoYWRvd01hcC50eXBlID0gc2hhZG93TWFwVHlwZTsKICAgIH0KICAgIGZ1bmN0aW9uIG9uTWF0ZXJpYWxEaXNwb3NlKGV2ZW50KSB7CiAgICAgIGNvbnN0IG1hdGVyaWFsID0gZXZlbnQudGFyZ2V0OwogICAgICBtYXRlcmlhbC5yZW1vdmVFdmVudExpc3RlbmVyKCJkaXNwb3NlIiwgb25NYXRlcmlhbERpc3Bvc2UpOwogICAgICBkZWFsbG9jYXRlTWF0ZXJpYWwobWF0ZXJpYWwpOwogICAgfQogICAgZnVuY3Rpb24gZGVhbGxvY2F0ZU1hdGVyaWFsKG1hdGVyaWFsKSB7CiAgICAgIHJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKG1hdGVyaWFsKTsKICAgICAgcHJvcGVydGllcy5yZW1vdmUobWF0ZXJpYWwpOwogICAgfQogICAgZnVuY3Rpb24gcmVsZWFzZU1hdGVyaWFsUHJvZ3JhbVJlZmVyZW5jZXMobWF0ZXJpYWwpIHsKICAgICAgY29uc3QgcHJvZ3JhbXMgPSBwcm9wZXJ0aWVzLmdldChtYXRlcmlhbCkucHJvZ3JhbXM7CiAgICAgIGlmIChwcm9ncmFtcyAhPT0gdm9pZCAwKSB7CiAgICAgICAgcHJvZ3JhbXMuZm9yRWFjaChmdW5jdGlvbihwcm9ncmFtKSB7CiAgICAgICAgICBwcm9ncmFtQ2FjaGUucmVsZWFzZVByb2dyYW0ocHJvZ3JhbSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHJlbmRlck9iamVjdEltbWVkaWF0ZShvYmplY3QsIHByb2dyYW0pIHsKICAgICAgb2JqZWN0LnJlbmRlcihmdW5jdGlvbihvYmplY3QyKSB7CiAgICAgICAgX3RoaXMucmVuZGVyQnVmZmVySW1tZWRpYXRlKG9iamVjdDIsIHByb2dyYW0pOwogICAgICB9KTsKICAgIH0KICAgIHRoaXMucmVuZGVyQnVmZmVySW1tZWRpYXRlID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9ncmFtKSB7CiAgICAgIGJpbmRpbmdTdGF0ZXMuaW5pdEF0dHJpYnV0ZXMoKTsKICAgICAgY29uc3QgYnVmZmVycyA9IHByb3BlcnRpZXMuZ2V0KG9iamVjdCk7CiAgICAgIGlmIChvYmplY3QuaGFzUG9zaXRpb25zICYmICFidWZmZXJzLnBvc2l0aW9uKQogICAgICAgIGJ1ZmZlcnMucG9zaXRpb24gPSBfZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAgIGlmIChvYmplY3QuaGFzTm9ybWFscyAmJiAhYnVmZmVycy5ub3JtYWwpCiAgICAgICAgYnVmZmVycy5ub3JtYWwgPSBfZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAgIGlmIChvYmplY3QuaGFzVXZzICYmICFidWZmZXJzLnV2KQogICAgICAgIGJ1ZmZlcnMudXYgPSBfZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAgIGlmIChvYmplY3QuaGFzQ29sb3JzICYmICFidWZmZXJzLmNvbG9yKQogICAgICAgIGJ1ZmZlcnMuY29sb3IgPSBfZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAgIGNvbnN0IHByb2dyYW1BdHRyaWJ1dGVzID0gcHJvZ3JhbS5nZXRBdHRyaWJ1dGVzKCk7CiAgICAgIGlmIChvYmplY3QuaGFzUG9zaXRpb25zKSB7CiAgICAgICAgX2dsLmJpbmRCdWZmZXIoMzQ5NjIsIGJ1ZmZlcnMucG9zaXRpb24pOwogICAgICAgIF9nbC5idWZmZXJEYXRhKDM0OTYyLCBvYmplY3QucG9zaXRpb25BcnJheSwgMzUwNDgpOwogICAgICAgIGJpbmRpbmdTdGF0ZXMuZW5hYmxlQXR0cmlidXRlKHByb2dyYW1BdHRyaWJ1dGVzLnBvc2l0aW9uKTsKICAgICAgICBfZ2wudmVydGV4QXR0cmliUG9pbnRlcihwcm9ncmFtQXR0cmlidXRlcy5wb3NpdGlvbiwgMywgNTEyNiwgZmFsc2UsIDAsIDApOwogICAgICB9CiAgICAgIGlmIChvYmplY3QuaGFzTm9ybWFscykgewogICAgICAgIF9nbC5iaW5kQnVmZmVyKDM0OTYyLCBidWZmZXJzLm5vcm1hbCk7CiAgICAgICAgX2dsLmJ1ZmZlckRhdGEoMzQ5NjIsIG9iamVjdC5ub3JtYWxBcnJheSwgMzUwNDgpOwogICAgICAgIGJpbmRpbmdTdGF0ZXMuZW5hYmxlQXR0cmlidXRlKHByb2dyYW1BdHRyaWJ1dGVzLm5vcm1hbCk7CiAgICAgICAgX2dsLnZlcnRleEF0dHJpYlBvaW50ZXIocHJvZ3JhbUF0dHJpYnV0ZXMubm9ybWFsLCAzLCA1MTI2LCBmYWxzZSwgMCwgMCk7CiAgICAgIH0KICAgICAgaWYgKG9iamVjdC5oYXNVdnMpIHsKICAgICAgICBfZ2wuYmluZEJ1ZmZlcigzNDk2MiwgYnVmZmVycy51dik7CiAgICAgICAgX2dsLmJ1ZmZlckRhdGEoMzQ5NjIsIG9iamVjdC51dkFycmF5LCAzNTA0OCk7CiAgICAgICAgYmluZGluZ1N0YXRlcy5lbmFibGVBdHRyaWJ1dGUocHJvZ3JhbUF0dHJpYnV0ZXMudXYpOwogICAgICAgIF9nbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHByb2dyYW1BdHRyaWJ1dGVzLnV2LCAyLCA1MTI2LCBmYWxzZSwgMCwgMCk7CiAgICAgIH0KICAgICAgaWYgKG9iamVjdC5oYXNDb2xvcnMpIHsKICAgICAgICBfZ2wuYmluZEJ1ZmZlcigzNDk2MiwgYnVmZmVycy5jb2xvcik7CiAgICAgICAgX2dsLmJ1ZmZlckRhdGEoMzQ5NjIsIG9iamVjdC5jb2xvckFycmF5LCAzNTA0OCk7CiAgICAgICAgYmluZGluZ1N0YXRlcy5lbmFibGVBdHRyaWJ1dGUocHJvZ3JhbUF0dHJpYnV0ZXMuY29sb3IpOwogICAgICAgIF9nbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHByb2dyYW1BdHRyaWJ1dGVzLmNvbG9yLCAzLCA1MTI2LCBmYWxzZSwgMCwgMCk7CiAgICAgIH0KICAgICAgYmluZGluZ1N0YXRlcy5kaXNhYmxlVW51c2VkQXR0cmlidXRlcygpOwogICAgICBfZ2wuZHJhd0FycmF5cyg0LCAwLCBvYmplY3QuY291bnQpOwogICAgICBvYmplY3QuY291bnQgPSAwOwogICAgfTsKICAgIHRoaXMucmVuZGVyQnVmZmVyRGlyZWN0ID0gZnVuY3Rpb24oY2FtZXJhLCBzY2VuZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBvYmplY3QsIGdyb3VwKSB7CiAgICAgIGlmIChzY2VuZSA9PT0gbnVsbCkKICAgICAgICBzY2VuZSA9IF9lbXB0eVNjZW5lOwogICAgICBjb25zdCBmcm9udEZhY2VDVyA9IG9iamVjdC5pc01lc2ggJiYgb2JqZWN0Lm1hdHJpeFdvcmxkLmRldGVybWluYW50KCkgPCAwOwogICAgICBjb25zdCBwcm9ncmFtID0gc2V0UHJvZ3JhbShjYW1lcmEsIHNjZW5lLCBtYXRlcmlhbCwgb2JqZWN0KTsKICAgICAgc3RhdGUuc2V0TWF0ZXJpYWwobWF0ZXJpYWwsIGZyb250RmFjZUNXKTsKICAgICAgbGV0IGluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CiAgICAgIGNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKICAgICAgaWYgKGluZGV4ID09PSBudWxsKSB7CiAgICAgICAgaWYgKHBvc2l0aW9uID09PSB2b2lkIDAgfHwgcG9zaXRpb24uY291bnQgPT09IDApCiAgICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAoaW5kZXguY291bnQgPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGV0IHJhbmdlRmFjdG9yID0gMTsKICAgICAgaWYgKG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSkgewogICAgICAgIGluZGV4ID0gZ2VvbWV0cmllcy5nZXRXaXJlZnJhbWVBdHRyaWJ1dGUoZ2VvbWV0cnkpOwogICAgICAgIHJhbmdlRmFjdG9yID0gMjsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwubW9ycGhUYXJnZXRzIHx8IG1hdGVyaWFsLm1vcnBoTm9ybWFscykgewogICAgICAgIG1vcnBodGFyZ2V0cy51cGRhdGUob2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIHByb2dyYW0pOwogICAgICB9CiAgICAgIGJpbmRpbmdTdGF0ZXMuc2V0dXAob2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnksIGluZGV4KTsKICAgICAgbGV0IGF0dHJpYnV0ZTsKICAgICAgbGV0IHJlbmRlcmVyID0gYnVmZmVyUmVuZGVyZXI7CiAgICAgIGlmIChpbmRleCAhPT0gbnVsbCkgewogICAgICAgIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KGluZGV4KTsKICAgICAgICByZW5kZXJlciA9IGluZGV4ZWRCdWZmZXJSZW5kZXJlcjsKICAgICAgICByZW5kZXJlci5zZXRJbmRleChhdHRyaWJ1dGUpOwogICAgICB9CiAgICAgIGNvbnN0IGRhdGFDb3VudCA9IGluZGV4ICE9PSBudWxsID8gaW5kZXguY291bnQgOiBwb3NpdGlvbi5jb3VudDsKICAgICAgY29uc3QgcmFuZ2VTdGFydCA9IGdlb21ldHJ5LmRyYXdSYW5nZS5zdGFydCAqIHJhbmdlRmFjdG9yOwogICAgICBjb25zdCByYW5nZUNvdW50ID0gZ2VvbWV0cnkuZHJhd1JhbmdlLmNvdW50ICogcmFuZ2VGYWN0b3I7CiAgICAgIGNvbnN0IGdyb3VwU3RhcnQgPSBncm91cCAhPT0gbnVsbCA/IGdyb3VwLnN0YXJ0ICogcmFuZ2VGYWN0b3IgOiAwOwogICAgICBjb25zdCBncm91cENvdW50ID0gZ3JvdXAgIT09IG51bGwgPyBncm91cC5jb3VudCAqIHJhbmdlRmFjdG9yIDogSW5maW5pdHk7CiAgICAgIGNvbnN0IGRyYXdTdGFydCA9IE1hdGgubWF4KHJhbmdlU3RhcnQsIGdyb3VwU3RhcnQpOwogICAgICBjb25zdCBkcmF3RW5kID0gTWF0aC5taW4oZGF0YUNvdW50LCByYW5nZVN0YXJ0ICsgcmFuZ2VDb3VudCwgZ3JvdXBTdGFydCArIGdyb3VwQ291bnQpIC0gMTsKICAgICAgY29uc3QgZHJhd0NvdW50ID0gTWF0aC5tYXgoMCwgZHJhd0VuZCAtIGRyYXdTdGFydCArIDEpOwogICAgICBpZiAoZHJhd0NvdW50ID09PSAwKQogICAgICAgIHJldHVybjsKICAgICAgaWYgKG9iamVjdC5pc01lc2gpIHsKICAgICAgICBpZiAobWF0ZXJpYWwud2lyZWZyYW1lID09PSB0cnVlKSB7CiAgICAgICAgICBzdGF0ZS5zZXRMaW5lV2lkdGgobWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoICogZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpKTsKICAgICAgICAgIHJlbmRlcmVyLnNldE1vZGUoMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlbmRlcmVyLnNldE1vZGUoNCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKG9iamVjdC5pc0xpbmUpIHsKICAgICAgICBsZXQgbGluZVdpZHRoID0gbWF0ZXJpYWwubGluZXdpZHRoOwogICAgICAgIGlmIChsaW5lV2lkdGggPT09IHZvaWQgMCkKICAgICAgICAgIGxpbmVXaWR0aCA9IDE7CiAgICAgICAgc3RhdGUuc2V0TGluZVdpZHRoKGxpbmVXaWR0aCAqIGdldFRhcmdldFBpeGVsUmF0aW8oKSk7CiAgICAgICAgaWYgKG9iamVjdC5pc0xpbmVTZWdtZW50cykgewogICAgICAgICAgcmVuZGVyZXIuc2V0TW9kZSgxKTsKICAgICAgICB9IGVsc2UgaWYgKG9iamVjdC5pc0xpbmVMb29wKSB7CiAgICAgICAgICByZW5kZXJlci5zZXRNb2RlKDIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZW5kZXJlci5zZXRNb2RlKDMpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChvYmplY3QuaXNQb2ludHMpIHsKICAgICAgICByZW5kZXJlci5zZXRNb2RlKDApOwogICAgICB9IGVsc2UgaWYgKG9iamVjdC5pc1Nwcml0ZSkgewogICAgICAgIHJlbmRlcmVyLnNldE1vZGUoNCk7CiAgICAgIH0KICAgICAgaWYgKG9iamVjdC5pc0luc3RhbmNlZE1lc2gpIHsKICAgICAgICByZW5kZXJlci5yZW5kZXJJbnN0YW5jZXMoZHJhd1N0YXJ0LCBkcmF3Q291bnQsIG9iamVjdC5jb3VudCk7CiAgICAgIH0gZWxzZSBpZiAoZ2VvbWV0cnkuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSkgewogICAgICAgIGNvbnN0IGluc3RhbmNlQ291bnQgPSBNYXRoLm1pbihnZW9tZXRyeS5pbnN0YW5jZUNvdW50LCBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCk7CiAgICAgICAgcmVuZGVyZXIucmVuZGVySW5zdGFuY2VzKGRyYXdTdGFydCwgZHJhd0NvdW50LCBpbnN0YW5jZUNvdW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZW5kZXJlci5yZW5kZXIoZHJhd1N0YXJ0LCBkcmF3Q291bnQpOwogICAgICB9CiAgICB9OwogICAgdGhpcy5jb21waWxlID0gZnVuY3Rpb24oc2NlbmUsIGNhbWVyYSkgewogICAgICBjdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KHNjZW5lKTsKICAgICAgY3VycmVudFJlbmRlclN0YXRlLmluaXQoKTsKICAgICAgc2NlbmUudHJhdmVyc2VWaXNpYmxlKGZ1bmN0aW9uKG9iamVjdCkgewogICAgICAgIGlmIChvYmplY3QuaXNMaWdodCAmJiBvYmplY3QubGF5ZXJzLnRlc3QoY2FtZXJhLmxheWVycykpIHsKICAgICAgICAgIGN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoTGlnaHQob2JqZWN0KTsKICAgICAgICAgIGlmIChvYmplY3QuY2FzdFNoYWRvdykgewogICAgICAgICAgICBjdXJyZW50UmVuZGVyU3RhdGUucHVzaFNoYWRvdyhvYmplY3QpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0cygpOwogICAgICBzY2VuZS50cmF2ZXJzZShmdW5jdGlvbihvYmplY3QpIHsKICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKICAgICAgICBpZiAobWF0ZXJpYWwpIHsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1hdGVyaWFsKSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1hdGVyaWFsLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgY29uc3QgbWF0ZXJpYWwyID0gbWF0ZXJpYWxbaV07CiAgICAgICAgICAgICAgZ2V0UHJvZ3JhbShtYXRlcmlhbDIsIHNjZW5lLCBvYmplY3QpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBnZXRQcm9ncmFtKG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICAgIGxldCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBudWxsOwogICAgZnVuY3Rpb24gb25BbmltYXRpb25GcmFtZSh0aW1lKSB7CiAgICAgIGlmIChvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2spCiAgICAgICAgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrKHRpbWUpOwogICAgfQogICAgZnVuY3Rpb24gb25YUlNlc3Npb25TdGFydCgpIHsKICAgICAgYW5pbWF0aW9uLnN0b3AoKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9uWFJTZXNzaW9uRW5kKCkgewogICAgICBhbmltYXRpb24uc3RhcnQoKTsKICAgIH0KICAgIGNvbnN0IGFuaW1hdGlvbiA9IG5ldyBXZWJHTEFuaW1hdGlvbigpOwogICAgYW5pbWF0aW9uLnNldEFuaW1hdGlvbkxvb3Aob25BbmltYXRpb25GcmFtZSk7CiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIpCiAgICAgIGFuaW1hdGlvbi5zZXRDb250ZXh0KHdpbmRvdyk7CiAgICB0aGlzLnNldEFuaW1hdGlvbkxvb3AgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgICBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgeHIuc2V0QW5pbWF0aW9uTG9vcChjYWxsYmFjayk7CiAgICAgIGNhbGxiYWNrID09PSBudWxsID8gYW5pbWF0aW9uLnN0b3AoKSA6IGFuaW1hdGlvbi5zdGFydCgpOwogICAgfTsKICAgIHhyLmFkZEV2ZW50TGlzdGVuZXIoInNlc3Npb25zdGFydCIsIG9uWFJTZXNzaW9uU3RhcnQpOwogICAgeHIuYWRkRXZlbnRMaXN0ZW5lcigic2Vzc2lvbmVuZCIsIG9uWFJTZXNzaW9uRW5kKTsKICAgIHRoaXMucmVuZGVyID0gZnVuY3Rpb24oc2NlbmUsIGNhbWVyYSkgewogICAgICBpZiAoY2FtZXJhICE9PSB2b2lkIDAgJiYgY2FtZXJhLmlzQ2FtZXJhICE9PSB0cnVlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuV2ViR0xSZW5kZXJlci5yZW5kZXI6IGNhbWVyYSBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuQ2FtZXJhLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoX2lzQ29udGV4dExvc3QgPT09IHRydWUpCiAgICAgICAgcmV0dXJuOwogICAgICBpZiAoc2NlbmUuYXV0b1VwZGF0ZSA9PT0gdHJ1ZSkKICAgICAgICBzY2VuZS51cGRhdGVNYXRyaXhXb3JsZCgpOwogICAgICBpZiAoY2FtZXJhLnBhcmVudCA9PT0gbnVsbCkKICAgICAgICBjYW1lcmEudXBkYXRlTWF0cml4V29ybGQoKTsKICAgICAgaWYgKHhyLmVuYWJsZWQgPT09IHRydWUgJiYgeHIuaXNQcmVzZW50aW5nID09PSB0cnVlKSB7CiAgICAgICAgaWYgKHhyLmNhbWVyYUF1dG9VcGRhdGUgPT09IHRydWUpCiAgICAgICAgICB4ci51cGRhdGVDYW1lcmEoY2FtZXJhKTsKICAgICAgICBjYW1lcmEgPSB4ci5nZXRDYW1lcmEoKTsKICAgICAgfQogICAgICBpZiAoc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSkKICAgICAgICBzY2VuZS5vbkJlZm9yZVJlbmRlcihfdGhpcywgc2NlbmUsIGNhbWVyYSwgX2N1cnJlbnRSZW5kZXJUYXJnZXQpOwogICAgICBjdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KHNjZW5lLCByZW5kZXJTdGF0ZVN0YWNrLmxlbmd0aCk7CiAgICAgIGN1cnJlbnRSZW5kZXJTdGF0ZS5pbml0KCk7CiAgICAgIHJlbmRlclN0YXRlU3RhY2sucHVzaChjdXJyZW50UmVuZGVyU3RhdGUpOwogICAgICBfcHJvalNjcmVlbk1hdHJpeDIubXVsdGlwbHlNYXRyaWNlcyhjYW1lcmEucHJvamVjdGlvbk1hdHJpeCwgY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSk7CiAgICAgIF9mcnVzdHVtLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KF9wcm9qU2NyZWVuTWF0cml4Mik7CiAgICAgIF9sb2NhbENsaXBwaW5nRW5hYmxlZCA9IHRoaXMubG9jYWxDbGlwcGluZ0VuYWJsZWQ7CiAgICAgIF9jbGlwcGluZ0VuYWJsZWQgPSBjbGlwcGluZy5pbml0KHRoaXMuY2xpcHBpbmdQbGFuZXMsIF9sb2NhbENsaXBwaW5nRW5hYmxlZCwgY2FtZXJhKTsKICAgICAgY3VycmVudFJlbmRlckxpc3QgPSByZW5kZXJMaXN0cy5nZXQoc2NlbmUsIHJlbmRlckxpc3RTdGFjay5sZW5ndGgpOwogICAgICBjdXJyZW50UmVuZGVyTGlzdC5pbml0KCk7CiAgICAgIHJlbmRlckxpc3RTdGFjay5wdXNoKGN1cnJlbnRSZW5kZXJMaXN0KTsKICAgICAgcHJvamVjdE9iamVjdChzY2VuZSwgY2FtZXJhLCAwLCBfdGhpcy5zb3J0T2JqZWN0cyk7CiAgICAgIGN1cnJlbnRSZW5kZXJMaXN0LmZpbmlzaCgpOwogICAgICBpZiAoX3RoaXMuc29ydE9iamVjdHMgPT09IHRydWUpIHsKICAgICAgICBjdXJyZW50UmVuZGVyTGlzdC5zb3J0KF9vcGFxdWVTb3J0LCBfdHJhbnNwYXJlbnRTb3J0KTsKICAgICAgfQogICAgICBpZiAoX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSkKICAgICAgICBjbGlwcGluZy5iZWdpblNoYWRvd3MoKTsKICAgICAgY29uc3Qgc2hhZG93c0FycmF5ID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnNoYWRvd3NBcnJheTsKICAgICAgc2hhZG93TWFwLnJlbmRlcihzaGFkb3dzQXJyYXksIHNjZW5lLCBjYW1lcmEpOwogICAgICBjdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHMoKTsKICAgICAgY3VycmVudFJlbmRlclN0YXRlLnNldHVwTGlnaHRzVmlldyhjYW1lcmEpOwogICAgICBpZiAoX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSkKICAgICAgICBjbGlwcGluZy5lbmRTaGFkb3dzKCk7CiAgICAgIGlmICh0aGlzLmluZm8uYXV0b1Jlc2V0ID09PSB0cnVlKQogICAgICAgIHRoaXMuaW5mby5yZXNldCgpOwogICAgICBiYWNrZ3JvdW5kLnJlbmRlcihjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUpOwogICAgICBjb25zdCBvcGFxdWVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3Qub3BhcXVlOwogICAgICBjb25zdCB0cmFuc21pc3NpdmVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3QudHJhbnNtaXNzaXZlOwogICAgICBjb25zdCB0cmFuc3BhcmVudE9iamVjdHMgPSBjdXJyZW50UmVuZGVyTGlzdC50cmFuc3BhcmVudDsKICAgICAgaWYgKG9wYXF1ZU9iamVjdHMubGVuZ3RoID4gMCkKICAgICAgICByZW5kZXJPYmplY3RzKG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEpOwogICAgICBpZiAodHJhbnNtaXNzaXZlT2JqZWN0cy5sZW5ndGggPiAwKQogICAgICAgIHJlbmRlclRyYW5zbWlzc2l2ZU9iamVjdHMob3BhcXVlT2JqZWN0cywgdHJhbnNtaXNzaXZlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSk7CiAgICAgIGlmICh0cmFuc3BhcmVudE9iamVjdHMubGVuZ3RoID4gMCkKICAgICAgICByZW5kZXJPYmplY3RzKHRyYW5zcGFyZW50T2JqZWN0cywgc2NlbmUsIGNhbWVyYSk7CiAgICAgIGlmIChfY3VycmVudFJlbmRlclRhcmdldCAhPT0gbnVsbCkgewogICAgICAgIHRleHR1cmVzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KF9jdXJyZW50UmVuZGVyVGFyZ2V0KTsKICAgICAgICB0ZXh0dXJlcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAoX2N1cnJlbnRSZW5kZXJUYXJnZXQpOwogICAgICB9CiAgICAgIGlmIChzY2VuZS5pc1NjZW5lID09PSB0cnVlKQogICAgICAgIHNjZW5lLm9uQWZ0ZXJSZW5kZXIoX3RoaXMsIHNjZW5lLCBjYW1lcmEpOwogICAgICBzdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QodHJ1ZSk7CiAgICAgIHN0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0TWFzayh0cnVlKTsKICAgICAgc3RhdGUuYnVmZmVycy5jb2xvci5zZXRNYXNrKHRydWUpOwogICAgICBzdGF0ZS5zZXRQb2x5Z29uT2Zmc2V0KGZhbHNlKTsKICAgICAgYmluZGluZ1N0YXRlcy5yZXNldERlZmF1bHRTdGF0ZSgpOwogICAgICBfY3VycmVudE1hdGVyaWFsSWQgPSAtMTsKICAgICAgX2N1cnJlbnRDYW1lcmEgPSBudWxsOwogICAgICByZW5kZXJTdGF0ZVN0YWNrLnBvcCgpOwogICAgICBpZiAocmVuZGVyU3RhdGVTdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgY3VycmVudFJlbmRlclN0YXRlID0gcmVuZGVyU3RhdGVTdGFja1tyZW5kZXJTdGF0ZVN0YWNrLmxlbmd0aCAtIDFdOwogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRSZW5kZXJTdGF0ZSA9IG51bGw7CiAgICAgIH0KICAgICAgcmVuZGVyTGlzdFN0YWNrLnBvcCgpOwogICAgICBpZiAocmVuZGVyTGlzdFN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICBjdXJyZW50UmVuZGVyTGlzdCA9IHJlbmRlckxpc3RTdGFja1tyZW5kZXJMaXN0U3RhY2subGVuZ3RoIC0gMV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3VycmVudFJlbmRlckxpc3QgPSBudWxsOwogICAgICB9CiAgICB9OwogICAgZnVuY3Rpb24gcHJvamVjdE9iamVjdChvYmplY3QsIGNhbWVyYSwgZ3JvdXBPcmRlciwgc29ydE9iamVjdHMpIHsKICAgICAgaWYgKG9iamVjdC52aXNpYmxlID09PSBmYWxzZSkKICAgICAgICByZXR1cm47CiAgICAgIGNvbnN0IHZpc2libGUgPSBvYmplY3QubGF5ZXJzLnRlc3QoY2FtZXJhLmxheWVycyk7CiAgICAgIGlmICh2aXNpYmxlKSB7CiAgICAgICAgaWYgKG9iamVjdC5pc0dyb3VwKSB7CiAgICAgICAgICBncm91cE9yZGVyID0gb2JqZWN0LnJlbmRlck9yZGVyOwogICAgICAgIH0gZWxzZSBpZiAob2JqZWN0LmlzTE9EKSB7CiAgICAgICAgICBpZiAob2JqZWN0LmF1dG9VcGRhdGUgPT09IHRydWUpCiAgICAgICAgICAgIG9iamVjdC51cGRhdGUoY2FtZXJhKTsKICAgICAgICB9IGVsc2UgaWYgKG9iamVjdC5pc0xpZ2h0KSB7CiAgICAgICAgICBjdXJyZW50UmVuZGVyU3RhdGUucHVzaExpZ2h0KG9iamVjdCk7CiAgICAgICAgICBpZiAob2JqZWN0LmNhc3RTaGFkb3cpIHsKICAgICAgICAgICAgY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3cob2JqZWN0KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG9iamVjdC5pc1Nwcml0ZSkgewogICAgICAgICAgaWYgKCFvYmplY3QuZnJ1c3R1bUN1bGxlZCB8fCBfZnJ1c3R1bS5pbnRlcnNlY3RzU3ByaXRlKG9iamVjdCkpIHsKICAgICAgICAgICAgaWYgKHNvcnRPYmplY3RzKSB7CiAgICAgICAgICAgICAgX3ZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKG9iamVjdC5tYXRyaXhXb3JsZCkuYXBwbHlNYXRyaXg0KF9wcm9qU2NyZWVuTWF0cml4Mik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZShvYmplY3QpOwogICAgICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKICAgICAgICAgICAgaWYgKG1hdGVyaWFsLnZpc2libGUpIHsKICAgICAgICAgICAgICBjdXJyZW50UmVuZGVyTGlzdC5wdXNoKG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCBfdmVjdG9yMy56LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob2JqZWN0LmlzSW1tZWRpYXRlUmVuZGVyT2JqZWN0KSB7CiAgICAgICAgICBpZiAoc29ydE9iamVjdHMpIHsKICAgICAgICAgICAgX3ZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKG9iamVjdC5tYXRyaXhXb3JsZCkuYXBwbHlNYXRyaXg0KF9wcm9qU2NyZWVuTWF0cml4Mik7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50UmVuZGVyTGlzdC5wdXNoKG9iamVjdCwgbnVsbCwgb2JqZWN0Lm1hdGVyaWFsLCBncm91cE9yZGVyLCBfdmVjdG9yMy56LCBudWxsKTsKICAgICAgICB9IGVsc2UgaWYgKG9iamVjdC5pc01lc2ggfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNQb2ludHMpIHsKICAgICAgICAgIGlmIChvYmplY3QuaXNTa2lubmVkTWVzaCkgewogICAgICAgICAgICBpZiAob2JqZWN0LnNrZWxldG9uLmZyYW1lICE9PSBpbmZvLnJlbmRlci5mcmFtZSkgewogICAgICAgICAgICAgIG9iamVjdC5za2VsZXRvbi51cGRhdGUoKTsKICAgICAgICAgICAgICBvYmplY3Quc2tlbGV0b24uZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFvYmplY3QuZnJ1c3R1bUN1bGxlZCB8fCBfZnJ1c3R1bS5pbnRlcnNlY3RzT2JqZWN0KG9iamVjdCkpIHsKICAgICAgICAgICAgaWYgKHNvcnRPYmplY3RzKSB7CiAgICAgICAgICAgICAgX3ZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKG9iamVjdC5tYXRyaXhXb3JsZCkuYXBwbHlNYXRyaXg0KF9wcm9qU2NyZWVuTWF0cml4Mik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZShvYmplY3QpOwogICAgICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobWF0ZXJpYWwpKSB7CiAgICAgICAgICAgICAgY29uc3QgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwogICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSBncm91cHNbaV07CiAgICAgICAgICAgICAgICBjb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbZ3JvdXAubWF0ZXJpYWxJbmRleF07CiAgICAgICAgICAgICAgICBpZiAoZ3JvdXBNYXRlcmlhbCAmJiBncm91cE1hdGVyaWFsLnZpc2libGUpIHsKICAgICAgICAgICAgICAgICAgY3VycmVudFJlbmRlckxpc3QucHVzaChvYmplY3QsIGdlb21ldHJ5LCBncm91cE1hdGVyaWFsLCBncm91cE9yZGVyLCBfdmVjdG9yMy56LCBncm91cCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsLnZpc2libGUpIHsKICAgICAgICAgICAgICBjdXJyZW50UmVuZGVyTGlzdC5wdXNoKG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCBfdmVjdG9yMy56LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBwcm9qZWN0T2JqZWN0KGNoaWxkcmVuW2ldLCBjYW1lcmEsIGdyb3VwT3JkZXIsIHNvcnRPYmplY3RzKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcmVuZGVyVHJhbnNtaXNzaXZlT2JqZWN0cyhvcGFxdWVPYmplY3RzLCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhKSB7CiAgICAgIGlmIChfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ID09PSBudWxsKSB7CiAgICAgICAgY29uc3QgbmVlZHNBbnRpYWxpYXMgPSBfYW50aWFsaWFzID09PSB0cnVlICYmIGNhcGFiaWxpdGllcy5pc1dlYkdMMiA9PT0gdHJ1ZTsKICAgICAgICBjb25zdCByZW5kZXJUYXJnZXRUeXBlID0gbmVlZHNBbnRpYWxpYXMgPyBXZWJHTE11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0IDogV2ViR0xSZW5kZXJUYXJnZXQ7CiAgICAgICAgX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCA9IG5ldyByZW5kZXJUYXJnZXRUeXBlKDEwMjQsIDEwMjQsIHsKICAgICAgICAgIGdlbmVyYXRlTWlwbWFwczogdHJ1ZSwKICAgICAgICAgIHR5cGU6IHV0aWxzLmNvbnZlcnQoSGFsZkZsb2F0VHlwZSkgIT09IG51bGwgPyBIYWxmRmxvYXRUeXBlIDogVW5zaWduZWRCeXRlVHlwZSwKICAgICAgICAgIG1pbkZpbHRlcjogTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyLAogICAgICAgICAgbWFnRmlsdGVyOiBOZWFyZXN0RmlsdGVyLAogICAgICAgICAgd3JhcFM6IENsYW1wVG9FZGdlV3JhcHBpbmcsCiAgICAgICAgICB3cmFwVDogQ2xhbXBUb0VkZ2VXcmFwcGluZwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSBfdGhpcy5nZXRSZW5kZXJUYXJnZXQoKTsKICAgICAgX3RoaXMuc2V0UmVuZGVyVGFyZ2V0KF90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQpOwogICAgICBfdGhpcy5jbGVhcigpOwogICAgICBjb25zdCBjdXJyZW50VG9uZU1hcHBpbmcgPSBfdGhpcy50b25lTWFwcGluZzsKICAgICAgX3RoaXMudG9uZU1hcHBpbmcgPSBOb1RvbmVNYXBwaW5nOwogICAgICByZW5kZXJPYmplY3RzKG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEpOwogICAgICBfdGhpcy50b25lTWFwcGluZyA9IGN1cnJlbnRUb25lTWFwcGluZzsKICAgICAgdGV4dHVyZXMudXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQoX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCk7CiAgICAgIHRleHR1cmVzLnVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcChfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0KTsKICAgICAgX3RoaXMuc2V0UmVuZGVyVGFyZ2V0KGN1cnJlbnRSZW5kZXJUYXJnZXQpOwogICAgICByZW5kZXJPYmplY3RzKHRyYW5zbWlzc2l2ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEpOwogICAgfQogICAgZnVuY3Rpb24gcmVuZGVyT2JqZWN0cyhyZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhKSB7CiAgICAgIGNvbnN0IG92ZXJyaWRlTWF0ZXJpYWwgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUub3ZlcnJpZGVNYXRlcmlhbCA6IG51bGw7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcmVuZGVyTGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCByZW5kZXJJdGVtID0gcmVuZGVyTGlzdFtpXTsKICAgICAgICBjb25zdCBvYmplY3QgPSByZW5kZXJJdGVtLm9iamVjdDsKICAgICAgICBjb25zdCBnZW9tZXRyeSA9IHJlbmRlckl0ZW0uZ2VvbWV0cnk7CiAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBvdmVycmlkZU1hdGVyaWFsID09PSBudWxsID8gcmVuZGVySXRlbS5tYXRlcmlhbCA6IG92ZXJyaWRlTWF0ZXJpYWw7CiAgICAgICAgY29uc3QgZ3JvdXAgPSByZW5kZXJJdGVtLmdyb3VwOwogICAgICAgIGlmIChjYW1lcmEuaXNBcnJheUNhbWVyYSkgewogICAgICAgICAgY29uc3QgY2FtZXJhcyA9IGNhbWVyYS5jYW1lcmFzOwogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGpsID0gY2FtZXJhcy5sZW5ndGg7IGogPCBqbDsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IGNhbWVyYTIgPSBjYW1lcmFzW2pdOwogICAgICAgICAgICBpZiAob2JqZWN0LmxheWVycy50ZXN0KGNhbWVyYTIubGF5ZXJzKSkgewogICAgICAgICAgICAgIHN0YXRlLnZpZXdwb3J0KF9jdXJyZW50Vmlld3BvcnQuY29weShjYW1lcmEyLnZpZXdwb3J0KSk7CiAgICAgICAgICAgICAgY3VycmVudFJlbmRlclN0YXRlLnNldHVwTGlnaHRzVmlldyhjYW1lcmEyKTsKICAgICAgICAgICAgICByZW5kZXJPYmplY3Qob2JqZWN0LCBzY2VuZSwgY2FtZXJhMiwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVuZGVyT2JqZWN0KG9iamVjdCwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZW5kZXJPYmplY3Qob2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwKSB7CiAgICAgIG9iamVjdC5vbkJlZm9yZVJlbmRlcihfdGhpcywgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCk7CiAgICAgIG9iamVjdC5tb2RlbFZpZXdNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyhjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLCBvYmplY3QubWF0cml4V29ybGQpOwogICAgICBvYmplY3Qubm9ybWFsTWF0cml4LmdldE5vcm1hbE1hdHJpeChvYmplY3QubW9kZWxWaWV3TWF0cml4KTsKICAgICAgaWYgKG9iamVjdC5pc0ltbWVkaWF0ZVJlbmRlck9iamVjdCkgewogICAgICAgIGNvbnN0IHByb2dyYW0gPSBzZXRQcm9ncmFtKGNhbWVyYSwgc2NlbmUsIG1hdGVyaWFsLCBvYmplY3QpOwogICAgICAgIHN0YXRlLnNldE1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBiaW5kaW5nU3RhdGVzLnJlc2V0KCk7CiAgICAgICAgcmVuZGVyT2JqZWN0SW1tZWRpYXRlKG9iamVjdCwgcHJvZ3JhbSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSB0cnVlICYmIG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUpIHsKICAgICAgICAgIG1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKICAgICAgICAgIG1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgICAgIF90aGlzLnJlbmRlckJ1ZmZlckRpcmVjdChjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXApOwogICAgICAgICAgbWF0ZXJpYWwuc2lkZSA9IEZyb250U2lkZTsKICAgICAgICAgIG1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgICAgIF90aGlzLnJlbmRlckJ1ZmZlckRpcmVjdChjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXApOwogICAgICAgICAgbWF0ZXJpYWwuc2lkZSA9IERvdWJsZVNpZGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzLnJlbmRlckJ1ZmZlckRpcmVjdChjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXApOwogICAgICAgIH0KICAgICAgfQogICAgICBvYmplY3Qub25BZnRlclJlbmRlcihfdGhpcywgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRQcm9ncmFtKG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0KSB7CiAgICAgIGlmIChzY2VuZS5pc1NjZW5lICE9PSB0cnVlKQogICAgICAgIHNjZW5lID0gX2VtcHR5U2NlbmU7CiAgICAgIGNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KG1hdGVyaWFsKTsKICAgICAgY29uc3QgbGlnaHRzID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLmxpZ2h0czsKICAgICAgY29uc3Qgc2hhZG93c0FycmF5ID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnNoYWRvd3NBcnJheTsKICAgICAgY29uc3QgbGlnaHRzU3RhdGVWZXJzaW9uID0gbGlnaHRzLnN0YXRlLnZlcnNpb247CiAgICAgIGNvbnN0IHBhcmFtZXRlcnMyID0gcHJvZ3JhbUNhY2hlLmdldFBhcmFtZXRlcnMobWF0ZXJpYWwsIGxpZ2h0cy5zdGF0ZSwgc2hhZG93c0FycmF5LCBzY2VuZSwgb2JqZWN0KTsKICAgICAgY29uc3QgcHJvZ3JhbUNhY2hlS2V5ID0gcHJvZ3JhbUNhY2hlLmdldFByb2dyYW1DYWNoZUtleShwYXJhbWV0ZXJzMik7CiAgICAgIGxldCBwcm9ncmFtcyA9IG1hdGVyaWFsUHJvcGVydGllcy5wcm9ncmFtczsKICAgICAgbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudmlyb25tZW50ID0gbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IHNjZW5lLmVudmlyb25tZW50IDogbnVsbDsKICAgICAgbWF0ZXJpYWxQcm9wZXJ0aWVzLmZvZyA9IHNjZW5lLmZvZzsKICAgICAgbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudk1hcCA9IGN1YmVtYXBzLmdldChtYXRlcmlhbC5lbnZNYXAgfHwgbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudmlyb25tZW50KTsKICAgICAgaWYgKHByb2dyYW1zID09PSB2b2lkIDApIHsKICAgICAgICBtYXRlcmlhbC5hZGRFdmVudExpc3RlbmVyKCJkaXNwb3NlIiwgb25NYXRlcmlhbERpc3Bvc2UpOwogICAgICAgIHByb2dyYW1zID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgICBtYXRlcmlhbFByb3BlcnRpZXMucHJvZ3JhbXMgPSBwcm9ncmFtczsKICAgICAgfQogICAgICBsZXQgcHJvZ3JhbSA9IHByb2dyYW1zLmdldChwcm9ncmFtQ2FjaGVLZXkpOwogICAgICBpZiAocHJvZ3JhbSAhPT0gdm9pZCAwKSB7CiAgICAgICAgaWYgKG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbSA9PT0gcHJvZ3JhbSAmJiBtYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uID09PSBsaWdodHNTdGF0ZVZlcnNpb24pIHsKICAgICAgICAgIHVwZGF0ZUNvbW1vbk1hdGVyaWFsUHJvcGVydGllcyhtYXRlcmlhbCwgcGFyYW1ldGVyczIpOwogICAgICAgICAgcmV0dXJuIHByb2dyYW07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHBhcmFtZXRlcnMyLnVuaWZvcm1zID0gcHJvZ3JhbUNhY2hlLmdldFVuaWZvcm1zKG1hdGVyaWFsKTsKICAgICAgICBtYXRlcmlhbC5vbkJ1aWxkKHBhcmFtZXRlcnMyLCBfdGhpcyk7CiAgICAgICAgbWF0ZXJpYWwub25CZWZvcmVDb21waWxlKHBhcmFtZXRlcnMyLCBfdGhpcyk7CiAgICAgICAgcHJvZ3JhbSA9IHByb2dyYW1DYWNoZS5hY3F1aXJlUHJvZ3JhbShwYXJhbWV0ZXJzMiwgcHJvZ3JhbUNhY2hlS2V5KTsKICAgICAgICBwcm9ncmFtcy5zZXQocHJvZ3JhbUNhY2hlS2V5LCBwcm9ncmFtKTsKICAgICAgICBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXMgPSBwYXJhbWV0ZXJzMi51bmlmb3JtczsKICAgICAgfQogICAgICBjb25zdCB1bmlmb3JtcyA9IG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3JtczsKICAgICAgaWYgKCFtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICYmICFtYXRlcmlhbC5pc1Jhd1NoYWRlck1hdGVyaWFsIHx8IG1hdGVyaWFsLmNsaXBwaW5nID09PSB0cnVlKSB7CiAgICAgICAgdW5pZm9ybXMuY2xpcHBpbmdQbGFuZXMgPSBjbGlwcGluZy51bmlmb3JtOwogICAgICB9CiAgICAgIHVwZGF0ZUNvbW1vbk1hdGVyaWFsUHJvcGVydGllcyhtYXRlcmlhbCwgcGFyYW1ldGVyczIpOwogICAgICBtYXRlcmlhbFByb3BlcnRpZXMubmVlZHNMaWdodHMgPSBtYXRlcmlhbE5lZWRzTGlnaHRzKG1hdGVyaWFsKTsKICAgICAgbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0c1N0YXRlVmVyc2lvbiA9IGxpZ2h0c1N0YXRlVmVyc2lvbjsKICAgICAgaWYgKG1hdGVyaWFsUHJvcGVydGllcy5uZWVkc0xpZ2h0cykgewogICAgICAgIHVuaWZvcm1zLmFtYmllbnRMaWdodENvbG9yLnZhbHVlID0gbGlnaHRzLnN0YXRlLmFtYmllbnQ7CiAgICAgICAgdW5pZm9ybXMubGlnaHRQcm9iZS52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wcm9iZTsKICAgICAgICB1bmlmb3Jtcy5kaXJlY3Rpb25hbExpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5kaXJlY3Rpb25hbDsKICAgICAgICB1bmlmb3Jtcy5kaXJlY3Rpb25hbExpZ2h0U2hhZG93cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5kaXJlY3Rpb25hbFNoYWRvdzsKICAgICAgICB1bmlmb3Jtcy5zcG90TGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnNwb3Q7CiAgICAgICAgdW5pZm9ybXMuc3BvdExpZ2h0U2hhZG93cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90U2hhZG93OwogICAgICAgIHVuaWZvcm1zLnJlY3RBcmVhTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnJlY3RBcmVhOwogICAgICAgIHVuaWZvcm1zLmx0Y18xLnZhbHVlID0gbGlnaHRzLnN0YXRlLnJlY3RBcmVhTFRDMTsKICAgICAgICB1bmlmb3Jtcy5sdGNfMi52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5yZWN0QXJlYUxUQzI7CiAgICAgICAgdW5pZm9ybXMucG9pbnRMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnQ7CiAgICAgICAgdW5pZm9ybXMucG9pbnRMaWdodFNoYWRvd3MudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3c7CiAgICAgICAgdW5pZm9ybXMuaGVtaXNwaGVyZUxpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5oZW1pOwogICAgICAgIHVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWFwLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwOwogICAgICAgIHVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4LnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4OwogICAgICAgIHVuaWZvcm1zLnNwb3RTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdFNoYWRvd01hcDsKICAgICAgICB1bmlmb3Jtcy5zcG90U2hhZG93TWF0cml4LnZhbHVlID0gbGlnaHRzLnN0YXRlLnNwb3RTaGFkb3dNYXRyaXg7CiAgICAgICAgdW5pZm9ybXMucG9pbnRTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXA7CiAgICAgICAgdW5pZm9ybXMucG9pbnRTaGFkb3dNYXRyaXgudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXRyaXg7CiAgICAgIH0KICAgICAgY29uc3QgcHJvZ1VuaWZvcm1zID0gcHJvZ3JhbS5nZXRVbmlmb3JtcygpOwogICAgICBjb25zdCB1bmlmb3Jtc0xpc3QgPSBXZWJHTFVuaWZvcm1zLnNlcVdpdGhWYWx1ZShwcm9nVW5pZm9ybXMuc2VxLCB1bmlmb3Jtcyk7CiAgICAgIG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbSA9IHByb2dyYW07CiAgICAgIG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3QgPSB1bmlmb3Jtc0xpc3Q7CiAgICAgIHJldHVybiBwcm9ncmFtOwogICAgfQogICAgZnVuY3Rpb24gdXBkYXRlQ29tbW9uTWF0ZXJpYWxQcm9wZXJ0aWVzKG1hdGVyaWFsLCBwYXJhbWV0ZXJzMikgewogICAgICBjb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldChtYXRlcmlhbCk7CiAgICAgIG1hdGVyaWFsUHJvcGVydGllcy5vdXRwdXRFbmNvZGluZyA9IHBhcmFtZXRlcnMyLm91dHB1dEVuY29kaW5nOwogICAgICBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9IHBhcmFtZXRlcnMyLmluc3RhbmNpbmc7CiAgICAgIG1hdGVyaWFsUHJvcGVydGllcy5za2lubmluZyA9IHBhcmFtZXRlcnMyLnNraW5uaW5nOwogICAgICBtYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgPSBwYXJhbWV0ZXJzMi5udW1DbGlwcGluZ1BsYW5lczsKICAgICAgbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUludGVyc2VjdGlvbiA9IHBhcmFtZXRlcnMyLm51bUNsaXBJbnRlcnNlY3Rpb247CiAgICAgIG1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgPSBwYXJhbWV0ZXJzMi52ZXJ0ZXhBbHBoYXM7CiAgICB9CiAgICBmdW5jdGlvbiBzZXRQcm9ncmFtKGNhbWVyYSwgc2NlbmUsIG1hdGVyaWFsLCBvYmplY3QpIHsKICAgICAgaWYgKHNjZW5lLmlzU2NlbmUgIT09IHRydWUpCiAgICAgICAgc2NlbmUgPSBfZW1wdHlTY2VuZTsKICAgICAgdGV4dHVyZXMucmVzZXRUZXh0dXJlVW5pdHMoKTsKICAgICAgY29uc3QgZm9nID0gc2NlbmUuZm9nOwogICAgICBjb25zdCBlbnZpcm9ubWVudCA9IG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBzY2VuZS5lbnZpcm9ubWVudCA6IG51bGw7CiAgICAgIGNvbnN0IGVuY29kaW5nID0gX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgPyBfdGhpcy5vdXRwdXRFbmNvZGluZyA6IF9jdXJyZW50UmVuZGVyVGFyZ2V0LnRleHR1cmUuZW5jb2Rpbmc7CiAgICAgIGNvbnN0IGVudk1hcCA9IGN1YmVtYXBzLmdldChtYXRlcmlhbC5lbnZNYXAgfHwgZW52aXJvbm1lbnQpOwogICAgICBjb25zdCB2ZXJ0ZXhBbHBoYXMgPSBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMgPT09IHRydWUgJiYgb2JqZWN0Lmdlb21ldHJ5ICYmIG9iamVjdC5nZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICYmIG9iamVjdC5nZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yLml0ZW1TaXplID09PSA0OwogICAgICBjb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldChtYXRlcmlhbCk7CiAgICAgIGNvbnN0IGxpZ2h0cyA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5saWdodHM7CiAgICAgIGlmIChfY2xpcHBpbmdFbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgaWYgKF9sb2NhbENsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSB8fCBjYW1lcmEgIT09IF9jdXJyZW50Q2FtZXJhKSB7CiAgICAgICAgICBjb25zdCB1c2VDYWNoZSA9IGNhbWVyYSA9PT0gX2N1cnJlbnRDYW1lcmEgJiYgbWF0ZXJpYWwuaWQgPT09IF9jdXJyZW50TWF0ZXJpYWxJZDsKICAgICAgICAgIGNsaXBwaW5nLnNldFN0YXRlKG1hdGVyaWFsLCBjYW1lcmEsIHVzZUNhY2hlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGV0IG5lZWRzUHJvZ3JhbUNoYW5nZSA9IGZhbHNlOwogICAgICBpZiAobWF0ZXJpYWwudmVyc2lvbiA9PT0gbWF0ZXJpYWxQcm9wZXJ0aWVzLl9fdmVyc2lvbikgewogICAgICAgIGlmIChtYXRlcmlhbFByb3BlcnRpZXMubmVlZHNMaWdodHMgJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0c1N0YXRlVmVyc2lvbiAhPT0gbGlnaHRzLnN0YXRlLnZlcnNpb24pIHsKICAgICAgICAgIG5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbFByb3BlcnRpZXMub3V0cHV0RW5jb2RpbmcgIT09IGVuY29kaW5nKSB7CiAgICAgICAgICBuZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAob2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9PT0gZmFsc2UpIHsKICAgICAgICAgIG5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmICghb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9PT0gdHJ1ZSkgewogICAgICAgICAgbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKG9iamVjdC5pc1NraW5uZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5za2lubmluZyA9PT0gZmFsc2UpIHsKICAgICAgICAgIG5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmICghb2JqZWN0LmlzU2tpbm5lZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLnNraW5uaW5nID09PSB0cnVlKSB7CiAgICAgICAgICBuZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWxQcm9wZXJ0aWVzLmVudk1hcCAhPT0gZW52TWFwKSB7CiAgICAgICAgICBuZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwuZm9nICYmIG1hdGVyaWFsUHJvcGVydGllcy5mb2cgIT09IGZvZykgewogICAgICAgICAgbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKG1hdGVyaWFsUHJvcGVydGllcy5udW1DbGlwcGluZ1BsYW5lcyAhPT0gdm9pZCAwICYmIChtYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgIT09IGNsaXBwaW5nLm51bVBsYW5lcyB8fCBtYXRlcmlhbFByb3BlcnRpZXMubnVtSW50ZXJzZWN0aW9uICE9PSBjbGlwcGluZy5udW1JbnRlcnNlY3Rpb24pKSB7CiAgICAgICAgICBuZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWxQcm9wZXJ0aWVzLnZlcnRleEFscGhhcyAhPT0gdmVydGV4QWxwaGFzKSB7CiAgICAgICAgICBuZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBuZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwogICAgICAgIG1hdGVyaWFsUHJvcGVydGllcy5fX3ZlcnNpb24gPSBtYXRlcmlhbC52ZXJzaW9uOwogICAgICB9CiAgICAgIGxldCBwcm9ncmFtID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmN1cnJlbnRQcm9ncmFtOwogICAgICBpZiAobmVlZHNQcm9ncmFtQ2hhbmdlID09PSB0cnVlKSB7CiAgICAgICAgcHJvZ3JhbSA9IGdldFByb2dyYW0obWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QpOwogICAgICB9CiAgICAgIGxldCByZWZyZXNoUHJvZ3JhbSA9IGZhbHNlOwogICAgICBsZXQgcmVmcmVzaE1hdGVyaWFsID0gZmFsc2U7CiAgICAgIGxldCByZWZyZXNoTGlnaHRzID0gZmFsc2U7CiAgICAgIGNvbnN0IHBfdW5pZm9ybXMgPSBwcm9ncmFtLmdldFVuaWZvcm1zKCksIG1fdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXM7CiAgICAgIGlmIChzdGF0ZS51c2VQcm9ncmFtKHByb2dyYW0ucHJvZ3JhbSkpIHsKICAgICAgICByZWZyZXNoUHJvZ3JhbSA9IHRydWU7CiAgICAgICAgcmVmcmVzaE1hdGVyaWFsID0gdHJ1ZTsKICAgICAgICByZWZyZXNoTGlnaHRzID0gdHJ1ZTsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwuaWQgIT09IF9jdXJyZW50TWF0ZXJpYWxJZCkgewogICAgICAgIF9jdXJyZW50TWF0ZXJpYWxJZCA9IG1hdGVyaWFsLmlkOwogICAgICAgIHJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKHJlZnJlc2hQcm9ncmFtIHx8IF9jdXJyZW50Q2FtZXJhICE9PSBjYW1lcmEpIHsKICAgICAgICBwX3VuaWZvcm1zLnNldFZhbHVlKF9nbCwgInByb2plY3Rpb25NYXRyaXgiLCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCk7CiAgICAgICAgaWYgKGNhcGFiaWxpdGllcy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyKSB7CiAgICAgICAgICBwX3VuaWZvcm1zLnNldFZhbHVlKF9nbCwgImxvZ0RlcHRoQnVmRkMiLCAyIC8gKE1hdGgubG9nKGNhbWVyYS5mYXIgKyAxKSAvIE1hdGguTE4yKSk7CiAgICAgICAgfQogICAgICAgIGlmIChfY3VycmVudENhbWVyYSAhPT0gY2FtZXJhKSB7CiAgICAgICAgICBfY3VycmVudENhbWVyYSA9IGNhbWVyYTsKICAgICAgICAgIHJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CiAgICAgICAgICByZWZyZXNoTGlnaHRzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoUGhvbmdNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCB8fCBtYXRlcmlhbC5lbnZNYXApIHsKICAgICAgICAgIGNvbnN0IHVDYW1Qb3MgPSBwX3VuaWZvcm1zLm1hcC5jYW1lcmFQb3NpdGlvbjsKICAgICAgICAgIGlmICh1Q2FtUG9zICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgdUNhbVBvcy5zZXRWYWx1ZShfZ2wsIF92ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbihjYW1lcmEubWF0cml4V29ybGQpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoVG9vbk1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzTWVzaExhbWJlcnRNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc01lc2hCYXNpY01hdGVyaWFsIHx8IG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCkgewogICAgICAgICAgcF91bmlmb3Jtcy5zZXRWYWx1ZShfZ2wsICJpc09ydGhvZ3JhcGhpYyIsIGNhbWVyYS5pc09ydGhvZ3JhcGhpY0NhbWVyYSA9PT0gdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGlmIChtYXRlcmlhbC5pc01lc2hQaG9uZ01hdGVyaWFsIHx8IG1hdGVyaWFsLmlzTWVzaFRvb25NYXRlcmlhbCB8fCBtYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoQmFzaWNNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNTaGFkb3dNYXRlcmlhbCB8fCBvYmplY3QuaXNTa2lubmVkTWVzaCkgewogICAgICAgICAgcF91bmlmb3Jtcy5zZXRWYWx1ZShfZ2wsICJ2aWV3TWF0cml4IiwgY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChvYmplY3QuaXNTa2lubmVkTWVzaCkgewogICAgICAgIHBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoX2dsLCBvYmplY3QsICJiaW5kTWF0cml4Iik7CiAgICAgICAgcF91bmlmb3Jtcy5zZXRPcHRpb25hbChfZ2wsIG9iamVjdCwgImJpbmRNYXRyaXhJbnZlcnNlIik7CiAgICAgICAgY29uc3Qgc2tlbGV0b24gPSBvYmplY3Quc2tlbGV0b247CiAgICAgICAgaWYgKHNrZWxldG9uKSB7CiAgICAgICAgICBpZiAoY2FwYWJpbGl0aWVzLmZsb2F0VmVydGV4VGV4dHVyZXMpIHsKICAgICAgICAgICAgaWYgKHNrZWxldG9uLmJvbmVUZXh0dXJlID09PSBudWxsKQogICAgICAgICAgICAgIHNrZWxldG9uLmNvbXB1dGVCb25lVGV4dHVyZSgpOwogICAgICAgICAgICBwX3VuaWZvcm1zLnNldFZhbHVlKF9nbCwgImJvbmVUZXh0dXJlIiwgc2tlbGV0b24uYm9uZVRleHR1cmUsIHRleHR1cmVzKTsKICAgICAgICAgICAgcF91bmlmb3Jtcy5zZXRWYWx1ZShfZ2wsICJib25lVGV4dHVyZVNpemUiLCBza2VsZXRvbi5ib25lVGV4dHVyZVNpemUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcF91bmlmb3Jtcy5zZXRPcHRpb25hbChfZ2wsIHNrZWxldG9uLCAiYm9uZU1hdHJpY2VzIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChyZWZyZXNoTWF0ZXJpYWwgfHwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnJlY2VpdmVTaGFkb3cgIT09IG9iamVjdC5yZWNlaXZlU2hhZG93KSB7CiAgICAgICAgbWF0ZXJpYWxQcm9wZXJ0aWVzLnJlY2VpdmVTaGFkb3cgPSBvYmplY3QucmVjZWl2ZVNoYWRvdzsKICAgICAgICBwX3VuaWZvcm1zLnNldFZhbHVlKF9nbCwgInJlY2VpdmVTaGFkb3ciLCBvYmplY3QucmVjZWl2ZVNoYWRvdyk7CiAgICAgIH0KICAgICAgaWYgKHJlZnJlc2hNYXRlcmlhbCkgewogICAgICAgIHBfdW5pZm9ybXMuc2V0VmFsdWUoX2dsLCAidG9uZU1hcHBpbmdFeHBvc3VyZSIsIF90aGlzLnRvbmVNYXBwaW5nRXhwb3N1cmUpOwogICAgICAgIGlmIChtYXRlcmlhbFByb3BlcnRpZXMubmVlZHNMaWdodHMpIHsKICAgICAgICAgIG1hcmtVbmlmb3Jtc0xpZ2h0c05lZWRzVXBkYXRlKG1fdW5pZm9ybXMsIHJlZnJlc2hMaWdodHMpOwogICAgICAgIH0KICAgICAgICBpZiAoZm9nICYmIG1hdGVyaWFsLmZvZykgewogICAgICAgICAgbWF0ZXJpYWxzLnJlZnJlc2hGb2dVbmlmb3JtcyhtX3VuaWZvcm1zLCBmb2cpOwogICAgICAgIH0KICAgICAgICBtYXRlcmlhbHMucmVmcmVzaE1hdGVyaWFsVW5pZm9ybXMobV91bmlmb3JtcywgbWF0ZXJpYWwsIF9waXhlbFJhdGlvLCBfaGVpZ2h0LCBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0KTsKICAgICAgICBXZWJHTFVuaWZvcm1zLnVwbG9hZChfZ2wsIG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3QsIG1fdW5pZm9ybXMsIHRleHR1cmVzKTsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiBtYXRlcmlhbC51bmlmb3Jtc05lZWRVcGRhdGUgPT09IHRydWUpIHsKICAgICAgICBXZWJHTFVuaWZvcm1zLnVwbG9hZChfZ2wsIG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3QsIG1fdW5pZm9ybXMsIHRleHR1cmVzKTsKICAgICAgICBtYXRlcmlhbC51bmlmb3Jtc05lZWRVcGRhdGUgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAobWF0ZXJpYWwuaXNTcHJpdGVNYXRlcmlhbCkgewogICAgICAgIHBfdW5pZm9ybXMuc2V0VmFsdWUoX2dsLCAiY2VudGVyIiwgb2JqZWN0LmNlbnRlcik7CiAgICAgIH0KICAgICAgcF91bmlmb3Jtcy5zZXRWYWx1ZShfZ2wsICJtb2RlbFZpZXdNYXRyaXgiLCBvYmplY3QubW9kZWxWaWV3TWF0cml4KTsKICAgICAgcF91bmlmb3Jtcy5zZXRWYWx1ZShfZ2wsICJub3JtYWxNYXRyaXgiLCBvYmplY3Qubm9ybWFsTWF0cml4KTsKICAgICAgcF91bmlmb3Jtcy5zZXRWYWx1ZShfZ2wsICJtb2RlbE1hdHJpeCIsIG9iamVjdC5tYXRyaXhXb3JsZCk7CiAgICAgIHJldHVybiBwcm9ncmFtOwogICAgfQogICAgZnVuY3Rpb24gbWFya1VuaWZvcm1zTGlnaHRzTmVlZHNVcGRhdGUodW5pZm9ybXMsIHZhbHVlKSB7CiAgICAgIHVuaWZvcm1zLmFtYmllbnRMaWdodENvbG9yLm5lZWRzVXBkYXRlID0gdmFsdWU7CiAgICAgIHVuaWZvcm1zLmxpZ2h0UHJvYmUubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgICAgdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgICAgdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodFNoYWRvd3MubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgICAgdW5pZm9ybXMucG9pbnRMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgICAgdW5pZm9ybXMucG9pbnRMaWdodFNoYWRvd3MubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgICAgdW5pZm9ybXMuc3BvdExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwogICAgICB1bmlmb3Jtcy5zcG90TGlnaHRTaGFkb3dzLm5lZWRzVXBkYXRlID0gdmFsdWU7CiAgICAgIHVuaWZvcm1zLnJlY3RBcmVhTGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CiAgICAgIHVuaWZvcm1zLmhlbWlzcGhlcmVMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIG1hdGVyaWFsTmVlZHNMaWdodHMobWF0ZXJpYWwpIHsKICAgICAgcmV0dXJuIG1hdGVyaWFsLmlzTWVzaExhbWJlcnRNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoUGhvbmdNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzU2hhZG93TWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiBtYXRlcmlhbC5saWdodHMgPT09IHRydWU7CiAgICB9CiAgICB0aGlzLmdldEFjdGl2ZUN1YmVGYWNlID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfY3VycmVudEFjdGl2ZUN1YmVGYWNlOwogICAgfTsKICAgIHRoaXMuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIF9jdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWw7CiAgICB9OwogICAgdGhpcy5nZXRSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIF9jdXJyZW50UmVuZGVyVGFyZ2V0OwogICAgfTsKICAgIHRoaXMuc2V0UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24ocmVuZGVyVGFyZ2V0LCBhY3RpdmVDdWJlRmFjZSA9IDAsIGFjdGl2ZU1pcG1hcExldmVsID0gMCkgewogICAgICBfY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldDsKICAgICAgX2N1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IGFjdGl2ZUN1YmVGYWNlOwogICAgICBfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gYWN0aXZlTWlwbWFwTGV2ZWw7CiAgICAgIGlmIChyZW5kZXJUYXJnZXQgJiYgcHJvcGVydGllcy5nZXQocmVuZGVyVGFyZ2V0KS5fX3dlYmdsRnJhbWVidWZmZXIgPT09IHZvaWQgMCkgewogICAgICAgIHRleHR1cmVzLnNldHVwUmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCk7CiAgICAgIH0KICAgICAgbGV0IGZyYW1lYnVmZmVyID0gbnVsbDsKICAgICAgbGV0IGlzQ3ViZSA9IGZhbHNlOwogICAgICBsZXQgaXNSZW5kZXJUYXJnZXQzRCA9IGZhbHNlOwogICAgICBpZiAocmVuZGVyVGFyZ2V0KSB7CiAgICAgICAgY29uc3QgdGV4dHVyZSA9IHJlbmRlclRhcmdldC50ZXh0dXJlOwogICAgICAgIGlmICh0ZXh0dXJlLmlzRGF0YVRleHR1cmUzRCB8fCB0ZXh0dXJlLmlzRGF0YVRleHR1cmUyREFycmF5KSB7CiAgICAgICAgICBpc1JlbmRlclRhcmdldDNEID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgX193ZWJnbEZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQocmVuZGVyVGFyZ2V0KS5fX3dlYmdsRnJhbWVidWZmZXI7CiAgICAgICAgaWYgKHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCkgewogICAgICAgICAgZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbYWN0aXZlQ3ViZUZhY2VdOwogICAgICAgICAgaXNDdWJlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQpIHsKICAgICAgICAgIGZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQocmVuZGVyVGFyZ2V0KS5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyOwogICAgICAgIH0KICAgICAgICBfY3VycmVudFZpZXdwb3J0LmNvcHkocmVuZGVyVGFyZ2V0LnZpZXdwb3J0KTsKICAgICAgICBfY3VycmVudFNjaXNzb3IuY29weShyZW5kZXJUYXJnZXQuc2Npc3Nvcik7CiAgICAgICAgX2N1cnJlbnRTY2lzc29yVGVzdCA9IHJlbmRlclRhcmdldC5zY2lzc29yVGVzdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBfY3VycmVudFZpZXdwb3J0LmNvcHkoX3ZpZXdwb3J0KS5tdWx0aXBseVNjYWxhcihfcGl4ZWxSYXRpbykuZmxvb3IoKTsKICAgICAgICBfY3VycmVudFNjaXNzb3IuY29weShfc2Npc3NvcikubXVsdGlwbHlTY2FsYXIoX3BpeGVsUmF0aW8pLmZsb29yKCk7CiAgICAgICAgX2N1cnJlbnRTY2lzc29yVGVzdCA9IF9zY2lzc29yVGVzdDsKICAgICAgfQogICAgICBjb25zdCBmcmFtZWJ1ZmZlckJvdW5kID0gc3RhdGUuYmluZEZyYW1lYnVmZmVyKDM2MTYwLCBmcmFtZWJ1ZmZlcik7CiAgICAgIGlmIChmcmFtZWJ1ZmZlckJvdW5kICYmIGNhcGFiaWxpdGllcy5kcmF3QnVmZmVycykgewogICAgICAgIGxldCBuZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgICAgIGlmIChyZW5kZXJUYXJnZXQpIHsKICAgICAgICAgIGlmIChyZW5kZXJUYXJnZXQuaXNXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cykgewogICAgICAgICAgICBjb25zdCB0ZXh0dXJlczIgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKICAgICAgICAgICAgaWYgKF9jdXJyZW50RHJhd0J1ZmZlcnMubGVuZ3RoICE9PSB0ZXh0dXJlczIubGVuZ3RoIHx8IF9jdXJyZW50RHJhd0J1ZmZlcnNbMF0gIT09IDM2MDY0KSB7CiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMyLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgICAgICAgIF9jdXJyZW50RHJhd0J1ZmZlcnNbaV0gPSAzNjA2NCArIGk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF9jdXJyZW50RHJhd0J1ZmZlcnMubGVuZ3RoID0gdGV4dHVyZXMyLmxlbmd0aDsKICAgICAgICAgICAgICBuZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChfY3VycmVudERyYXdCdWZmZXJzLmxlbmd0aCAhPT0gMSB8fCBfY3VycmVudERyYXdCdWZmZXJzWzBdICE9PSAzNjA2NCkgewogICAgICAgICAgICAgIF9jdXJyZW50RHJhd0J1ZmZlcnNbMF0gPSAzNjA2NDsKICAgICAgICAgICAgICBfY3VycmVudERyYXdCdWZmZXJzLmxlbmd0aCA9IDE7CiAgICAgICAgICAgICAgbmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChfY3VycmVudERyYXdCdWZmZXJzLmxlbmd0aCAhPT0gMSB8fCBfY3VycmVudERyYXdCdWZmZXJzWzBdICE9PSAxMDI5KSB7CiAgICAgICAgICAgIF9jdXJyZW50RHJhd0J1ZmZlcnNbMF0gPSAxMDI5OwogICAgICAgICAgICBfY3VycmVudERyYXdCdWZmZXJzLmxlbmd0aCA9IDE7CiAgICAgICAgICAgIG5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG5lZWRzVXBkYXRlKSB7CiAgICAgICAgICBpZiAoY2FwYWJpbGl0aWVzLmlzV2ViR0wyKSB7CiAgICAgICAgICAgIF9nbC5kcmF3QnVmZmVycyhfY3VycmVudERyYXdCdWZmZXJzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV4dGVuc2lvbnMuZ2V0KCJXRUJHTF9kcmF3X2J1ZmZlcnMiKS5kcmF3QnVmZmVyc1dFQkdMKF9jdXJyZW50RHJhd0J1ZmZlcnMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBzdGF0ZS52aWV3cG9ydChfY3VycmVudFZpZXdwb3J0KTsKICAgICAgc3RhdGUuc2Npc3NvcihfY3VycmVudFNjaXNzb3IpOwogICAgICBzdGF0ZS5zZXRTY2lzc29yVGVzdChfY3VycmVudFNjaXNzb3JUZXN0KTsKICAgICAgaWYgKGlzQ3ViZSkgewogICAgICAgIGNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQocmVuZGVyVGFyZ2V0LnRleHR1cmUpOwogICAgICAgIF9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCgzNjE2MCwgMzYwNjQsIDM0MDY5ICsgYWN0aXZlQ3ViZUZhY2UsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBhY3RpdmVNaXBtYXBMZXZlbCk7CiAgICAgIH0gZWxzZSBpZiAoaXNSZW5kZXJUYXJnZXQzRCkgewogICAgICAgIGNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQocmVuZGVyVGFyZ2V0LnRleHR1cmUpOwogICAgICAgIGNvbnN0IGxheWVyID0gYWN0aXZlQ3ViZUZhY2UgfHwgMDsKICAgICAgICBfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoMzYxNjAsIDM2MDY0LCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgYWN0aXZlTWlwbWFwTGV2ZWwgfHwgMCwgbGF5ZXIpOwogICAgICB9CiAgICB9OwogICAgdGhpcy5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzID0gZnVuY3Rpb24ocmVuZGVyVGFyZ2V0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBidWZmZXIsIGFjdGl2ZUN1YmVGYWNlSW5kZXgpIHsKICAgICAgaWYgKCEocmVuZGVyVGFyZ2V0ICYmIHJlbmRlclRhcmdldC5pc1dlYkdMUmVuZGVyVGFyZ2V0KSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBUSFJFRS5XZWJHTFJlbmRlclRhcmdldC4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGV0IGZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQocmVuZGVyVGFyZ2V0KS5fX3dlYmdsRnJhbWVidWZmZXI7CiAgICAgIGlmIChyZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgJiYgYWN0aXZlQ3ViZUZhY2VJbmRleCAhPT0gdm9pZCAwKSB7CiAgICAgICAgZnJhbWVidWZmZXIgPSBmcmFtZWJ1ZmZlclthY3RpdmVDdWJlRmFjZUluZGV4XTsKICAgICAgfQogICAgICBpZiAoZnJhbWVidWZmZXIpIHsKICAgICAgICBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoMzYxNjAsIGZyYW1lYnVmZmVyKTsKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgdGV4dHVyZSA9IHJlbmRlclRhcmdldC50ZXh0dXJlOwogICAgICAgICAgY29uc3QgdGV4dHVyZUZvcm1hdCA9IHRleHR1cmUuZm9ybWF0OwogICAgICAgICAgY29uc3QgdGV4dHVyZVR5cGUgPSB0ZXh0dXJlLnR5cGU7CiAgICAgICAgICBpZiAodGV4dHVyZUZvcm1hdCAhPT0gUkdCQUZvcm1hdCAmJiB1dGlscy5jb252ZXJ0KHRleHR1cmVGb3JtYXQpICE9PSBfZ2wuZ2V0UGFyYW1ldGVyKDM1NzM5KSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gUkdCQSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIGZvcm1hdC4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgaGFsZkZsb2F0U3VwcG9ydGVkQnlFeHQgPSB0ZXh0dXJlVHlwZSA9PT0gSGFsZkZsb2F0VHlwZSAmJiAoZXh0ZW5zaW9ucy5oYXMoIkVYVF9jb2xvcl9idWZmZXJfaGFsZl9mbG9hdCIpIHx8IGNhcGFiaWxpdGllcy5pc1dlYkdMMiAmJiBleHRlbnNpb25zLmhhcygiRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCIpKTsKICAgICAgICAgIGlmICh0ZXh0dXJlVHlwZSAhPT0gVW5zaWduZWRCeXRlVHlwZSAmJiB1dGlscy5jb252ZXJ0KHRleHR1cmVUeXBlKSAhPT0gX2dsLmdldFBhcmFtZXRlcigzNTczOCkgJiYgISh0ZXh0dXJlVHlwZSA9PT0gRmxvYXRUeXBlICYmIChjYXBhYmlsaXRpZXMuaXNXZWJHTDIgfHwgZXh0ZW5zaW9ucy5oYXMoIk9FU190ZXh0dXJlX2Zsb2F0IikgfHwgZXh0ZW5zaW9ucy5oYXMoIldFQkdMX2NvbG9yX2J1ZmZlcl9mbG9hdCIpKSkgJiYgIWhhbGZGbG9hdFN1cHBvcnRlZEJ5RXh0KSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBpbiBVbnNpZ25lZEJ5dGVUeXBlIG9yIGltcGxlbWVudGF0aW9uIGRlZmluZWQgdHlwZS4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKF9nbC5jaGVja0ZyYW1lYnVmZmVyU3RhdHVzKDM2MTYwKSA9PT0gMzYwNTMpIHsKICAgICAgICAgICAgaWYgKHggPj0gMCAmJiB4IDw9IHJlbmRlclRhcmdldC53aWR0aCAtIHdpZHRoICYmICh5ID49IDAgJiYgeSA8PSByZW5kZXJUYXJnZXQuaGVpZ2h0IC0gaGVpZ2h0KSkgewogICAgICAgICAgICAgIF9nbC5yZWFkUGl4ZWxzKHgsIHksIHdpZHRoLCBoZWlnaHQsIHV0aWxzLmNvbnZlcnQodGV4dHVyZUZvcm1hdCksIHV0aWxzLmNvbnZlcnQodGV4dHVyZVR5cGUpLCBidWZmZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHM6IHJlYWRQaXhlbHMgZnJvbSByZW5kZXJUYXJnZXQgZmFpbGVkLiBGcmFtZWJ1ZmZlciBub3QgY29tcGxldGUuIik7CiAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGNvbnN0IGZyYW1lYnVmZmVyMiA9IF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsID8gcHJvcGVydGllcy5nZXQoX2N1cnJlbnRSZW5kZXJUYXJnZXQpLl9fd2ViZ2xGcmFtZWJ1ZmZlciA6IG51bGw7CiAgICAgICAgICBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoMzYxNjAsIGZyYW1lYnVmZmVyMik7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgdGhpcy5jb3B5RnJhbWVidWZmZXJUb1RleHR1cmUgPSBmdW5jdGlvbihwb3NpdGlvbiwgdGV4dHVyZSwgbGV2ZWwgPSAwKSB7CiAgICAgIGNvbnN0IGxldmVsU2NhbGUgPSBNYXRoLnBvdygyLCAtbGV2ZWwpOwogICAgICBjb25zdCB3aWR0aCA9IE1hdGguZmxvb3IodGV4dHVyZS5pbWFnZS53aWR0aCAqIGxldmVsU2NhbGUpOwogICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLmZsb29yKHRleHR1cmUuaW1hZ2UuaGVpZ2h0ICogbGV2ZWxTY2FsZSk7CiAgICAgIGxldCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQodGV4dHVyZS5mb3JtYXQpOwogICAgICBpZiAoY2FwYWJpbGl0aWVzLmlzV2ViR0wyKSB7CiAgICAgICAgaWYgKGdsRm9ybWF0ID09PSA2NDA3KQogICAgICAgICAgZ2xGb3JtYXQgPSAzMjg0OTsKICAgICAgICBpZiAoZ2xGb3JtYXQgPT09IDY0MDgpCiAgICAgICAgICBnbEZvcm1hdCA9IDMyODU2OwogICAgICB9CiAgICAgIHRleHR1cmVzLnNldFRleHR1cmUyRCh0ZXh0dXJlLCAwKTsKICAgICAgX2dsLmNvcHlUZXhJbWFnZTJEKDM1NTMsIGxldmVsLCBnbEZvcm1hdCwgcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgd2lkdGgsIGhlaWdodCwgMCk7CiAgICAgIHN0YXRlLnVuYmluZFRleHR1cmUoKTsKICAgIH07CiAgICB0aGlzLmNvcHlUZXh0dXJlVG9UZXh0dXJlID0gZnVuY3Rpb24ocG9zaXRpb24sIHNyY1RleHR1cmUsIGRzdFRleHR1cmUsIGxldmVsID0gMCkgewogICAgICBjb25zdCB3aWR0aCA9IHNyY1RleHR1cmUuaW1hZ2Uud2lkdGg7CiAgICAgIGNvbnN0IGhlaWdodCA9IHNyY1RleHR1cmUuaW1hZ2UuaGVpZ2h0OwogICAgICBjb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoZHN0VGV4dHVyZS5mb3JtYXQpOwogICAgICBjb25zdCBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KGRzdFRleHR1cmUudHlwZSk7CiAgICAgIHRleHR1cmVzLnNldFRleHR1cmUyRChkc3RUZXh0dXJlLCAwKTsKICAgICAgX2dsLnBpeGVsU3RvcmVpKDM3NDQwLCBkc3RUZXh0dXJlLmZsaXBZKTsKICAgICAgX2dsLnBpeGVsU3RvcmVpKDM3NDQxLCBkc3RUZXh0dXJlLnByZW11bHRpcGx5QWxwaGEpOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzMxNywgZHN0VGV4dHVyZS51bnBhY2tBbGlnbm1lbnQpOwogICAgICBpZiAoc3JjVGV4dHVyZS5pc0RhdGFUZXh0dXJlKSB7CiAgICAgICAgX2dsLnRleFN1YkltYWdlMkQoMzU1MywgbGV2ZWwsIHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHdpZHRoLCBoZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIHNyY1RleHR1cmUuaW1hZ2UuZGF0YSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHNyY1RleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSkgewogICAgICAgICAgX2dsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKDM1NTMsIGxldmVsLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBzcmNUZXh0dXJlLm1pcG1hcHNbMF0ud2lkdGgsIHNyY1RleHR1cmUubWlwbWFwc1swXS5oZWlnaHQsIGdsRm9ybWF0LCBzcmNUZXh0dXJlLm1pcG1hcHNbMF0uZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF9nbC50ZXhTdWJJbWFnZTJEKDM1NTMsIGxldmVsLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBnbEZvcm1hdCwgZ2xUeXBlLCBzcmNUZXh0dXJlLmltYWdlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGxldmVsID09PSAwICYmIGRzdFRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzKQogICAgICAgIF9nbC5nZW5lcmF0ZU1pcG1hcCgzNTUzKTsKICAgICAgc3RhdGUudW5iaW5kVGV4dHVyZSgpOwogICAgfTsKICAgIHRoaXMuY29weVRleHR1cmVUb1RleHR1cmUzRCA9IGZ1bmN0aW9uKHNvdXJjZUJveCwgcG9zaXRpb24sIHNyY1RleHR1cmUsIGRzdFRleHR1cmUsIGxldmVsID0gMCkgewogICAgICBpZiAoX3RoaXMuaXNXZWJHTDFSZW5kZXJlcikgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlci5jb3B5VGV4dHVyZVRvVGV4dHVyZTNEOiBjYW4gb25seSBiZSB1c2VkIHdpdGggV2ViR0wyLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCB3aWR0aCA9IHNvdXJjZUJveC5tYXgueCAtIHNvdXJjZUJveC5taW4ueCArIDE7CiAgICAgIGNvbnN0IGhlaWdodCA9IHNvdXJjZUJveC5tYXgueSAtIHNvdXJjZUJveC5taW4ueSArIDE7CiAgICAgIGNvbnN0IGRlcHRoID0gc291cmNlQm94Lm1heC56IC0gc291cmNlQm94Lm1pbi56ICsgMTsKICAgICAgY29uc3QgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KGRzdFRleHR1cmUuZm9ybWF0KTsKICAgICAgY29uc3QgZ2xUeXBlID0gdXRpbHMuY29udmVydChkc3RUZXh0dXJlLnR5cGUpOwogICAgICBsZXQgZ2xUYXJnZXQ7CiAgICAgIGlmIChkc3RUZXh0dXJlLmlzRGF0YVRleHR1cmUzRCkgewogICAgICAgIHRleHR1cmVzLnNldFRleHR1cmUzRChkc3RUZXh0dXJlLCAwKTsKICAgICAgICBnbFRhcmdldCA9IDMyODc5OwogICAgICB9IGVsc2UgaWYgKGRzdFRleHR1cmUuaXNEYXRhVGV4dHVyZTJEQXJyYXkpIHsKICAgICAgICB0ZXh0dXJlcy5zZXRUZXh0dXJlMkRBcnJheShkc3RUZXh0dXJlLCAwKTsKICAgICAgICBnbFRhcmdldCA9IDM1ODY2OwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlci5jb3B5VGV4dHVyZVRvVGV4dHVyZTNEOiBvbmx5IHN1cHBvcnRzIFRIUkVFLkRhdGFUZXh0dXJlM0QgYW5kIFRIUkVFLkRhdGFUZXh0dXJlMkRBcnJheS4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgX2dsLnBpeGVsU3RvcmVpKDM3NDQwLCBkc3RUZXh0dXJlLmZsaXBZKTsKICAgICAgX2dsLnBpeGVsU3RvcmVpKDM3NDQxLCBkc3RUZXh0dXJlLnByZW11bHRpcGx5QWxwaGEpOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzMxNywgZHN0VGV4dHVyZS51bnBhY2tBbGlnbm1lbnQpOwogICAgICBjb25zdCB1bnBhY2tSb3dMZW4gPSBfZ2wuZ2V0UGFyYW1ldGVyKDMzMTQpOwogICAgICBjb25zdCB1bnBhY2tJbWFnZUhlaWdodCA9IF9nbC5nZXRQYXJhbWV0ZXIoMzI4NzgpOwogICAgICBjb25zdCB1bnBhY2tTa2lwUGl4ZWxzID0gX2dsLmdldFBhcmFtZXRlcigzMzE2KTsKICAgICAgY29uc3QgdW5wYWNrU2tpcFJvd3MgPSBfZ2wuZ2V0UGFyYW1ldGVyKDMzMTUpOwogICAgICBjb25zdCB1bnBhY2tTa2lwSW1hZ2VzID0gX2dsLmdldFBhcmFtZXRlcigzMjg3Nyk7CiAgICAgIGNvbnN0IGltYWdlID0gc3JjVGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlID8gc3JjVGV4dHVyZS5taXBtYXBzWzBdIDogc3JjVGV4dHVyZS5pbWFnZTsKICAgICAgX2dsLnBpeGVsU3RvcmVpKDMzMTQsIGltYWdlLndpZHRoKTsKICAgICAgX2dsLnBpeGVsU3RvcmVpKDMyODc4LCBpbWFnZS5oZWlnaHQpOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzMxNiwgc291cmNlQm94Lm1pbi54KTsKICAgICAgX2dsLnBpeGVsU3RvcmVpKDMzMTUsIHNvdXJjZUJveC5taW4ueSk7CiAgICAgIF9nbC5waXhlbFN0b3JlaSgzMjg3Nywgc291cmNlQm94Lm1pbi56KTsKICAgICAgaWYgKHNyY1RleHR1cmUuaXNEYXRhVGV4dHVyZSB8fCBzcmNUZXh0dXJlLmlzRGF0YVRleHR1cmUzRCkgewogICAgICAgIF9nbC50ZXhTdWJJbWFnZTNEKGdsVGFyZ2V0LCBsZXZlbCwgcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChzcmNUZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUpIHsKICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlci5jb3B5VGV4dHVyZVRvVGV4dHVyZTNEOiB1bnRlc3RlZCBzdXBwb3J0IGZvciBjb21wcmVzc2VkIHNyY1RleHR1cmUuIik7CiAgICAgICAgICBfZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlM0QoZ2xUYXJnZXQsIGxldmVsLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56LCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGltYWdlLmRhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfZ2wudGV4U3ViSW1hZ2UzRChnbFRhcmdldCwgbGV2ZWwsIHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHBvc2l0aW9uLnosIHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIF9nbC5waXhlbFN0b3JlaSgzMzE0LCB1bnBhY2tSb3dMZW4pOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzI4NzgsIHVucGFja0ltYWdlSGVpZ2h0KTsKICAgICAgX2dsLnBpeGVsU3RvcmVpKDMzMTYsIHVucGFja1NraXBQaXhlbHMpOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzMxNSwgdW5wYWNrU2tpcFJvd3MpOwogICAgICBfZ2wucGl4ZWxTdG9yZWkoMzI4NzcsIHVucGFja1NraXBJbWFnZXMpOwogICAgICBpZiAobGV2ZWwgPT09IDAgJiYgZHN0VGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMpCiAgICAgICAgX2dsLmdlbmVyYXRlTWlwbWFwKGdsVGFyZ2V0KTsKICAgICAgc3RhdGUudW5iaW5kVGV4dHVyZSgpOwogICAgfTsKICAgIHRoaXMuaW5pdFRleHR1cmUgPSBmdW5jdGlvbih0ZXh0dXJlKSB7CiAgICAgIHRleHR1cmVzLnNldFRleHR1cmUyRCh0ZXh0dXJlLCAwKTsKICAgICAgc3RhdGUudW5iaW5kVGV4dHVyZSgpOwogICAgfTsKICAgIHRoaXMucmVzZXRTdGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICBfY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gMDsKICAgICAgX2N1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9IDA7CiAgICAgIF9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgc3RhdGUucmVzZXQoKTsKICAgICAgYmluZGluZ1N0YXRlcy5yZXNldCgpOwogICAgfTsKICAgIGlmICh0eXBlb2YgX19USFJFRV9ERVZUT09MU19fICE9PSAidW5kZWZpbmVkIikgewogICAgICBfX1RIUkVFX0RFVlRPT0xTX18uZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoIm9ic2VydmUiLCB7IGRldGFpbDogdGhpcyB9KSk7CiAgICB9CiAgfQogIHZhciBXZWJHTDFSZW5kZXJlciA9IGNsYXNzIGV4dGVuZHMgV2ViR0xSZW5kZXJlciB7CiAgfTsKICBXZWJHTDFSZW5kZXJlci5wcm90b3R5cGUuaXNXZWJHTDFSZW5kZXJlciA9IHRydWU7CiAgdmFyIEZvZ0V4cDIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3Rvcihjb2xvciwgZGVuc2l0eSA9IDI1ZS01KSB7CiAgICAgIHRoaXMubmFtZSA9ICIiOwogICAgICB0aGlzLmNvbG9yID0gbmV3IENvbG9yKGNvbG9yKTsKICAgICAgdGhpcy5kZW5zaXR5ID0gZGVuc2l0eTsKICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEZvZ0V4cDIodGhpcy5jb2xvciwgdGhpcy5kZW5zaXR5KTsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAiRm9nRXhwMiIsCiAgICAgICAgY29sb3I6IHRoaXMuY29sb3IuZ2V0SGV4KCksCiAgICAgICAgZGVuc2l0eTogdGhpcy5kZW5zaXR5CiAgICAgIH07CiAgICB9CiAgfTsKICBGb2dFeHAyLnByb3RvdHlwZS5pc0ZvZ0V4cDIgPSB0cnVlOwogIHZhciBGb2cgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3Rvcihjb2xvciwgbmVhciA9IDEsIGZhciA9IDFlMykgewogICAgICB0aGlzLm5hbWUgPSAiIjsKICAgICAgdGhpcy5jb2xvciA9IG5ldyBDb2xvcihjb2xvcik7CiAgICAgIHRoaXMubmVhciA9IG5lYXI7CiAgICAgIHRoaXMuZmFyID0gZmFyOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgRm9nKHRoaXMuY29sb3IsIHRoaXMubmVhciwgdGhpcy5mYXIpOwogICAgfQogICAgdG9KU09OKCkgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICJGb2ciLAogICAgICAgIGNvbG9yOiB0aGlzLmNvbG9yLmdldEhleCgpLAogICAgICAgIG5lYXI6IHRoaXMubmVhciwKICAgICAgICBmYXI6IHRoaXMuZmFyCiAgICAgIH07CiAgICB9CiAgfTsKICBGb2cucHJvdG90eXBlLmlzRm9nID0gdHJ1ZTsKICB2YXIgU2NlbmUgPSBjbGFzcyBleHRlbmRzIE9iamVjdDNEIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiU2NlbmUiOwogICAgICB0aGlzLmJhY2tncm91bmQgPSBudWxsOwogICAgICB0aGlzLmVudmlyb25tZW50ID0gbnVsbDsKICAgICAgdGhpcy5mb2cgPSBudWxsOwogICAgICB0aGlzLm92ZXJyaWRlTWF0ZXJpYWwgPSBudWxsOwogICAgICB0aGlzLmF1dG9VcGRhdGUgPSB0cnVlOwogICAgICBpZiAodHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXyAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBfX1RIUkVFX0RFVlRPT0xTX18uZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoIm9ic2VydmUiLCB7IGRldGFpbDogdGhpcyB9KSk7CiAgICAgIH0KICAgIH0KICAgIGNvcHkoc291cmNlLCByZWN1cnNpdmUpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UsIHJlY3Vyc2l2ZSk7CiAgICAgIGlmIChzb3VyY2UuYmFja2dyb3VuZCAhPT0gbnVsbCkKICAgICAgICB0aGlzLmJhY2tncm91bmQgPSBzb3VyY2UuYmFja2dyb3VuZC5jbG9uZSgpOwogICAgICBpZiAoc291cmNlLmVudmlyb25tZW50ICE9PSBudWxsKQogICAgICAgIHRoaXMuZW52aXJvbm1lbnQgPSBzb3VyY2UuZW52aXJvbm1lbnQuY2xvbmUoKTsKICAgICAgaWYgKHNvdXJjZS5mb2cgIT09IG51bGwpCiAgICAgICAgdGhpcy5mb2cgPSBzb3VyY2UuZm9nLmNsb25lKCk7CiAgICAgIGlmIChzb3VyY2Uub3ZlcnJpZGVNYXRlcmlhbCAhPT0gbnVsbCkKICAgICAgICB0aGlzLm92ZXJyaWRlTWF0ZXJpYWwgPSBzb3VyY2Uub3ZlcnJpZGVNYXRlcmlhbC5jbG9uZSgpOwogICAgICB0aGlzLmF1dG9VcGRhdGUgPSBzb3VyY2UuYXV0b1VwZGF0ZTsKICAgICAgdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gc291cmNlLm1hdHJpeEF1dG9VcGRhdGU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKG1ldGEpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTihtZXRhKTsKICAgICAgaWYgKHRoaXMuZm9nICE9PSBudWxsKQogICAgICAgIGRhdGEub2JqZWN0LmZvZyA9IHRoaXMuZm9nLnRvSlNPTigpOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICB9OwogIFNjZW5lLnByb3RvdHlwZS5pc1NjZW5lID0gdHJ1ZTsKICB2YXIgSW50ZXJsZWF2ZWRCdWZmZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhcnJheSwgc3RyaWRlKSB7CiAgICAgIHRoaXMuYXJyYXkgPSBhcnJheTsKICAgICAgdGhpcy5zdHJpZGUgPSBzdHJpZGU7CiAgICAgIHRoaXMuY291bnQgPSBhcnJheSAhPT0gdm9pZCAwID8gYXJyYXkubGVuZ3RoIC8gc3RyaWRlIDogMDsKICAgICAgdGhpcy51c2FnZSA9IFN0YXRpY0RyYXdVc2FnZTsKICAgICAgdGhpcy51cGRhdGVSYW5nZSA9IHsgb2Zmc2V0OiAwLCBjb3VudDogLTEgfTsKICAgICAgdGhpcy52ZXJzaW9uID0gMDsKICAgICAgdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CiAgICB9CiAgICBvblVwbG9hZENhbGxiYWNrKCkgewogICAgfQogICAgc2V0IG5lZWRzVXBkYXRlKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSkKICAgICAgICB0aGlzLnZlcnNpb24rKzsKICAgIH0KICAgIHNldFVzYWdlKHZhbHVlKSB7CiAgICAgIHRoaXMudXNhZ2UgPSB2YWx1ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICB0aGlzLmFycmF5ID0gbmV3IHNvdXJjZS5hcnJheS5jb25zdHJ1Y3Rvcihzb3VyY2UuYXJyYXkpOwogICAgICB0aGlzLmNvdW50ID0gc291cmNlLmNvdW50OwogICAgICB0aGlzLnN0cmlkZSA9IHNvdXJjZS5zdHJpZGU7CiAgICAgIHRoaXMudXNhZ2UgPSBzb3VyY2UudXNhZ2U7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY29weUF0KGluZGV4MSwgYXR0cmlidXRlLCBpbmRleDIpIHsKICAgICAgaW5kZXgxICo9IHRoaXMuc3RyaWRlOwogICAgICBpbmRleDIgKj0gYXR0cmlidXRlLnN0cmlkZTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLnN0cmlkZTsgaSA8IGw7IGkrKykgewogICAgICAgIHRoaXMuYXJyYXlbaW5kZXgxICsgaV0gPSBhdHRyaWJ1dGUuYXJyYXlbaW5kZXgyICsgaV07CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXQodmFsdWUsIG9mZnNldCA9IDApIHsKICAgICAgdGhpcy5hcnJheS5zZXQodmFsdWUsIG9mZnNldCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY2xvbmUoZGF0YSkgewogICAgICBpZiAoZGF0YS5hcnJheUJ1ZmZlcnMgPT09IHZvaWQgMCkgewogICAgICAgIGRhdGEuYXJyYXlCdWZmZXJzID0ge307CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkID09PSB2b2lkIDApIHsKICAgICAgICB0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCA9IGdlbmVyYXRlVVVJRCgpOwogICAgICB9CiAgICAgIGlmIChkYXRhLmFycmF5QnVmZmVyc1t0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZF0gPT09IHZvaWQgMCkgewogICAgICAgIGRhdGEuYXJyYXlCdWZmZXJzW3RoaXMuYXJyYXkuYnVmZmVyLl91dWlkXSA9IHRoaXMuYXJyYXkuc2xpY2UoMCkuYnVmZmVyOwogICAgICB9CiAgICAgIGNvbnN0IGFycmF5ID0gbmV3IHRoaXMuYXJyYXkuY29uc3RydWN0b3IoZGF0YS5hcnJheUJ1ZmZlcnNbdGhpcy5hcnJheS5idWZmZXIuX3V1aWRdKTsKICAgICAgY29uc3QgaWIgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihhcnJheSwgdGhpcy5zdHJpZGUpOwogICAgICBpYi5zZXRVc2FnZSh0aGlzLnVzYWdlKTsKICAgICAgcmV0dXJuIGliOwogICAgfQogICAgb25VcGxvYWQoY2FsbGJhY2spIHsKICAgICAgdGhpcy5vblVwbG9hZENhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKGRhdGEpIHsKICAgICAgaWYgKGRhdGEuYXJyYXlCdWZmZXJzID09PSB2b2lkIDApIHsKICAgICAgICBkYXRhLmFycmF5QnVmZmVycyA9IHt9OwogICAgICB9CiAgICAgIGlmICh0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGhpcy5hcnJheS5idWZmZXIuX3V1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKICAgICAgfQogICAgICBpZiAoZGF0YS5hcnJheUJ1ZmZlcnNbdGhpcy5hcnJheS5idWZmZXIuX3V1aWRdID09PSB2b2lkIDApIHsKICAgICAgICBkYXRhLmFycmF5QnVmZmVyc1t0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZF0gPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChuZXcgVWludDMyQXJyYXkodGhpcy5hcnJheS5idWZmZXIpKTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIHV1aWQ6IHRoaXMudXVpZCwKICAgICAgICBidWZmZXI6IHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkLAogICAgICAgIHR5cGU6IHRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSwKICAgICAgICBzdHJpZGU6IHRoaXMuc3RyaWRlCiAgICAgIH07CiAgICB9CiAgfTsKICBJbnRlcmxlYXZlZEJ1ZmZlci5wcm90b3R5cGUuaXNJbnRlcmxlYXZlZEJ1ZmZlciA9IHRydWU7CiAgdmFyIF92ZWN0b3IkNiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGludGVybGVhdmVkQnVmZmVyLCBpdGVtU2l6ZSwgb2Zmc2V0LCBub3JtYWxpemVkID0gZmFsc2UpIHsKICAgICAgdGhpcy5uYW1lID0gIiI7CiAgICAgIHRoaXMuZGF0YSA9IGludGVybGVhdmVkQnVmZmVyOwogICAgICB0aGlzLml0ZW1TaXplID0gaXRlbVNpemU7CiAgICAgIHRoaXMub2Zmc2V0ID0gb2Zmc2V0OwogICAgICB0aGlzLm5vcm1hbGl6ZWQgPSBub3JtYWxpemVkID09PSB0cnVlOwogICAgfQogICAgZ2V0IGNvdW50KCkgewogICAgICByZXR1cm4gdGhpcy5kYXRhLmNvdW50OwogICAgfQogICAgZ2V0IGFycmF5KCkgewogICAgICByZXR1cm4gdGhpcy5kYXRhLmFycmF5OwogICAgfQogICAgc2V0IG5lZWRzVXBkYXRlKHZhbHVlKSB7CiAgICAgIHRoaXMuZGF0YS5uZWVkc1VwZGF0ZSA9IHZhbHVlOwogICAgfQogICAgYXBwbHlNYXRyaXg0KG0pIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLmRhdGEuY291bnQ7IGkgPCBsOyBpKyspIHsKICAgICAgICBfdmVjdG9yJDYueCA9IHRoaXMuZ2V0WChpKTsKICAgICAgICBfdmVjdG9yJDYueSA9IHRoaXMuZ2V0WShpKTsKICAgICAgICBfdmVjdG9yJDYueiA9IHRoaXMuZ2V0WihpKTsKICAgICAgICBfdmVjdG9yJDYuYXBwbHlNYXRyaXg0KG0pOwogICAgICAgIHRoaXMuc2V0WFlaKGksIF92ZWN0b3IkNi54LCBfdmVjdG9yJDYueSwgX3ZlY3RvciQ2LnopOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYXBwbHlOb3JtYWxNYXRyaXgobSkgewogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpKyspIHsKICAgICAgICBfdmVjdG9yJDYueCA9IHRoaXMuZ2V0WChpKTsKICAgICAgICBfdmVjdG9yJDYueSA9IHRoaXMuZ2V0WShpKTsKICAgICAgICBfdmVjdG9yJDYueiA9IHRoaXMuZ2V0WihpKTsKICAgICAgICBfdmVjdG9yJDYuYXBwbHlOb3JtYWxNYXRyaXgobSk7CiAgICAgICAgdGhpcy5zZXRYWVooaSwgX3ZlY3RvciQ2LngsIF92ZWN0b3IkNi55LCBfdmVjdG9yJDYueik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0cmFuc2Zvcm1EaXJlY3Rpb24obSkgewogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpKyspIHsKICAgICAgICBfdmVjdG9yJDYueCA9IHRoaXMuZ2V0WChpKTsKICAgICAgICBfdmVjdG9yJDYueSA9IHRoaXMuZ2V0WShpKTsKICAgICAgICBfdmVjdG9yJDYueiA9IHRoaXMuZ2V0WihpKTsKICAgICAgICBfdmVjdG9yJDYudHJhbnNmb3JtRGlyZWN0aW9uKG0pOwogICAgICAgIHRoaXMuc2V0WFlaKGksIF92ZWN0b3IkNi54LCBfdmVjdG9yJDYueSwgX3ZlY3RvciQ2LnopOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0WChpbmRleCwgeCkgewogICAgICB0aGlzLmRhdGEuYXJyYXlbaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXRdID0geDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRZKGluZGV4LCB5KSB7CiAgICAgIHRoaXMuZGF0YS5hcnJheVtpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDFdID0geTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRaKGluZGV4LCB6KSB7CiAgICAgIHRoaXMuZGF0YS5hcnJheVtpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDJdID0gejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRXKGluZGV4LCB3KSB7CiAgICAgIHRoaXMuZGF0YS5hcnJheVtpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDNdID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXRYKGluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLmRhdGEuYXJyYXlbaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXRdOwogICAgfQogICAgZ2V0WShpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5kYXRhLmFycmF5W2luZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0ICsgMV07CiAgICB9CiAgICBnZXRaKGluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLmRhdGEuYXJyYXlbaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQgKyAyXTsKICAgIH0KICAgIGdldFcoaW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMuZGF0YS5hcnJheVtpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDNdOwogICAgfQogICAgc2V0WFkoaW5kZXgsIHgsIHkpIHsKICAgICAgaW5kZXggPSBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldDsKICAgICAgdGhpcy5kYXRhLmFycmF5W2luZGV4ICsgMF0gPSB4OwogICAgICB0aGlzLmRhdGEuYXJyYXlbaW5kZXggKyAxXSA9IHk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0WFlaKGluZGV4LCB4LCB5LCB6KSB7CiAgICAgIGluZGV4ID0gaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQ7CiAgICAgIHRoaXMuZGF0YS5hcnJheVtpbmRleCArIDBdID0geDsKICAgICAgdGhpcy5kYXRhLmFycmF5W2luZGV4ICsgMV0gPSB5OwogICAgICB0aGlzLmRhdGEuYXJyYXlbaW5kZXggKyAyXSA9IHo7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0WFlaVyhpbmRleCwgeCwgeSwgeiwgdykgewogICAgICBpbmRleCA9IGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0OwogICAgICB0aGlzLmRhdGEuYXJyYXlbaW5kZXggKyAwXSA9IHg7CiAgICAgIHRoaXMuZGF0YS5hcnJheVtpbmRleCArIDFdID0geTsKICAgICAgdGhpcy5kYXRhLmFycmF5W2luZGV4ICsgMl0gPSB6OwogICAgICB0aGlzLmRhdGEuYXJyYXlbaW5kZXggKyAzXSA9IHc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY2xvbmUoZGF0YSkgewogICAgICBpZiAoZGF0YSA9PT0gdm9pZCAwKSB7CiAgICAgICAgY29uc29sZS5sb2coIlRIUkVFLkludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlLmNsb25lKCk6IENsb25pbmcgYW4gaW50ZXJsYXZlZCBidWZmZXIgYXR0cmlidXRlIHdpbGwgZGVpbnRlcmxlYXZlIGJ1ZmZlciBkYXRhLiIpOwogICAgICAgIGNvbnN0IGFycmF5ID0gW107CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNvdW50OyBpKyspIHsKICAgICAgICAgIGNvbnN0IGluZGV4ID0gaSAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldDsKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5pdGVtU2l6ZTsgaisrKSB7CiAgICAgICAgICAgIGFycmF5LnB1c2godGhpcy5kYXRhLmFycmF5W2luZGV4ICsgal0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEJ1ZmZlckF0dHJpYnV0ZShuZXcgdGhpcy5hcnJheS5jb25zdHJ1Y3RvcihhcnJheSksIHRoaXMuaXRlbVNpemUsIHRoaXMubm9ybWFsaXplZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzID09PSB2b2lkIDApIHsKICAgICAgICAgIGRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzID0ge307CiAgICAgICAgfQogICAgICAgIGlmIChkYXRhLmludGVybGVhdmVkQnVmZmVyc1t0aGlzLmRhdGEudXVpZF0gPT09IHZvaWQgMCkgewogICAgICAgICAgZGF0YS5pbnRlcmxlYXZlZEJ1ZmZlcnNbdGhpcy5kYXRhLnV1aWRdID0gdGhpcy5kYXRhLmNsb25lKGRhdGEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKGRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzW3RoaXMuZGF0YS51dWlkXSwgdGhpcy5pdGVtU2l6ZSwgdGhpcy5vZmZzZXQsIHRoaXMubm9ybWFsaXplZCk7CiAgICAgIH0KICAgIH0KICAgIHRvSlNPTihkYXRhKSB7CiAgICAgIGlmIChkYXRhID09PSB2b2lkIDApIHsKICAgICAgICBjb25zb2xlLmxvZygiVEhSRUUuSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUudG9KU09OKCk6IFNlcmlhbGl6aW5nIGFuIGludGVybGF2ZWQgYnVmZmVyIGF0dHJpYnV0ZSB3aWxsIGRlaW50ZXJsZWF2ZSBidWZmZXIgZGF0YS4iKTsKICAgICAgICBjb25zdCBhcnJheSA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jb3VudDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBpbmRleCA9IGkgKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQ7CiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuaXRlbVNpemU7IGorKykgewogICAgICAgICAgICBhcnJheS5wdXNoKHRoaXMuZGF0YS5hcnJheVtpbmRleCArIGpdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGl0ZW1TaXplOiB0aGlzLml0ZW1TaXplLAogICAgICAgICAgdHlwZTogdGhpcy5hcnJheS5jb25zdHJ1Y3Rvci5uYW1lLAogICAgICAgICAgYXJyYXksCiAgICAgICAgICBub3JtYWxpemVkOiB0aGlzLm5vcm1hbGl6ZWQKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChkYXRhLmludGVybGVhdmVkQnVmZmVycyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBkYXRhLmludGVybGVhdmVkQnVmZmVycyA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS5pbnRlcmxlYXZlZEJ1ZmZlcnNbdGhpcy5kYXRhLnV1aWRdID09PSB2b2lkIDApIHsKICAgICAgICAgIGRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzW3RoaXMuZGF0YS51dWlkXSA9IHRoaXMuZGF0YS50b0pTT04oZGF0YSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlOiB0cnVlLAogICAgICAgICAgaXRlbVNpemU6IHRoaXMuaXRlbVNpemUsCiAgICAgICAgICBkYXRhOiB0aGlzLmRhdGEudXVpZCwKICAgICAgICAgIG9mZnNldDogdGhpcy5vZmZzZXQsCiAgICAgICAgICBub3JtYWxpemVkOiB0aGlzLm5vcm1hbGl6ZWQKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgfTsKICBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSA9IHRydWU7CiAgdmFyIFNwcml0ZU1hdGVyaWFsID0gY2xhc3MgZXh0ZW5kcyBNYXRlcmlhbCB7CiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJTcHJpdGVNYXRlcmlhbCI7CiAgICAgIHRoaXMuY29sb3IgPSBuZXcgQ29sb3IoMTY3NzcyMTUpOwogICAgICB0aGlzLm1hcCA9IG51bGw7CiAgICAgIHRoaXMuYWxwaGFNYXAgPSBudWxsOwogICAgICB0aGlzLnJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5zaXplQXR0ZW51YXRpb24gPSB0cnVlOwogICAgICB0aGlzLnRyYW5zcGFyZW50ID0gdHJ1ZTsKICAgICAgdGhpcy5zZXRWYWx1ZXMocGFyYW1ldGVycyk7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMuY29sb3IuY29weShzb3VyY2UuY29sb3IpOwogICAgICB0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CiAgICAgIHRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CiAgICAgIHRoaXMucm90YXRpb24gPSBzb3VyY2Uucm90YXRpb247CiAgICAgIHRoaXMuc2l6ZUF0dGVudWF0aW9uID0gc291cmNlLnNpemVBdHRlbnVhdGlvbjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBTcHJpdGVNYXRlcmlhbC5wcm90b3R5cGUuaXNTcHJpdGVNYXRlcmlhbCA9IHRydWU7CiAgdmFyIF9nZW9tZXRyeTsKICB2YXIgX2ludGVyc2VjdFBvaW50ID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF93b3JsZFNjYWxlID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9tdlBvc2l0aW9uID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9hbGlnbmVkUG9zaXRpb24gPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjIoKTsKICB2YXIgX3JvdGF0ZWRQb3NpdGlvbiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMigpOwogIHZhciBfdmlld1dvcmxkTWF0cml4ID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXRyaXg0KCk7CiAgdmFyIF92QSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfdkIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX3ZDID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF91dkEgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjIoKTsKICB2YXIgX3V2QiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMigpOwogIHZhciBfdXZDID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IyKCk7CiAgdmFyIFNwcml0ZSA9IGNsYXNzIGV4dGVuZHMgT2JqZWN0M0QgewogICAgY29uc3RydWN0b3IobWF0ZXJpYWwpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIlNwcml0ZSI7CiAgICAgIGlmIChfZ2VvbWV0cnkgPT09IHZvaWQgMCkgewogICAgICAgIF9nZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwogICAgICAgIGNvbnN0IGZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoWwogICAgICAgICAgLTAuNSwKICAgICAgICAgIC0wLjUsCiAgICAgICAgICAwLAogICAgICAgICAgMCwKICAgICAgICAgIDAsCiAgICAgICAgICAwLjUsCiAgICAgICAgICAtMC41LAogICAgICAgICAgMCwKICAgICAgICAgIDEsCiAgICAgICAgICAwLAogICAgICAgICAgMC41LAogICAgICAgICAgMC41LAogICAgICAgICAgMCwKICAgICAgICAgIDEsCiAgICAgICAgICAxLAogICAgICAgICAgLTAuNSwKICAgICAgICAgIDAuNSwKICAgICAgICAgIDAsCiAgICAgICAgICAwLAogICAgICAgICAgMQogICAgICAgIF0pOwogICAgICAgIGNvbnN0IGludGVybGVhdmVkQnVmZmVyID0gbmV3IEludGVybGVhdmVkQnVmZmVyKGZsb2F0MzJBcnJheSwgNSk7CiAgICAgICAgX2dlb21ldHJ5LnNldEluZGV4KFswLCAxLCAyLCAwLCAyLCAzXSk7CiAgICAgICAgX2dlb21ldHJ5LnNldEF0dHJpYnV0ZSgicG9zaXRpb24iLCBuZXcgSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUoaW50ZXJsZWF2ZWRCdWZmZXIsIDMsIDAsIGZhbHNlKSk7CiAgICAgICAgX2dlb21ldHJ5LnNldEF0dHJpYnV0ZSgidXYiLCBuZXcgSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUoaW50ZXJsZWF2ZWRCdWZmZXIsIDIsIDMsIGZhbHNlKSk7CiAgICAgIH0KICAgICAgdGhpcy5nZW9tZXRyeSA9IF9nZW9tZXRyeTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsICE9PSB2b2lkIDAgPyBtYXRlcmlhbCA6IG5ldyBTcHJpdGVNYXRlcmlhbCgpOwogICAgICB0aGlzLmNlbnRlciA9IG5ldyBWZWN0b3IyKDAuNSwgMC41KTsKICAgIH0KICAgIHJheWNhc3QocmF5Y2FzdGVyLCBpbnRlcnNlY3RzMikgewogICAgICBpZiAocmF5Y2FzdGVyLmNhbWVyYSA9PT0gbnVsbCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RIUkVFLlNwcml0ZTogIlJheWNhc3Rlci5jYW1lcmEiIG5lZWRzIHRvIGJlIHNldCBpbiBvcmRlciB0byByYXljYXN0IGFnYWluc3Qgc3ByaXRlcy4nKTsKICAgICAgfQogICAgICBfd29ybGRTY2FsZS5zZXRGcm9tTWF0cml4U2NhbGUodGhpcy5tYXRyaXhXb3JsZCk7CiAgICAgIF92aWV3V29ybGRNYXRyaXguY29weShyYXljYXN0ZXIuY2FtZXJhLm1hdHJpeFdvcmxkKTsKICAgICAgdGhpcy5tb2RlbFZpZXdNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyhyYXljYXN0ZXIuY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSwgdGhpcy5tYXRyaXhXb3JsZCk7CiAgICAgIF9tdlBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbih0aGlzLm1vZGVsVmlld01hdHJpeCk7CiAgICAgIGlmIChyYXljYXN0ZXIuY2FtZXJhLmlzUGVyc3BlY3RpdmVDYW1lcmEgJiYgdGhpcy5tYXRlcmlhbC5zaXplQXR0ZW51YXRpb24gPT09IGZhbHNlKSB7CiAgICAgICAgX3dvcmxkU2NhbGUubXVsdGlwbHlTY2FsYXIoLV9tdlBvc2l0aW9uLnopOwogICAgICB9CiAgICAgIGNvbnN0IHJvdGF0aW9uID0gdGhpcy5tYXRlcmlhbC5yb3RhdGlvbjsKICAgICAgbGV0IHNpbiwgY29zOwogICAgICBpZiAocm90YXRpb24gIT09IDApIHsKICAgICAgICBjb3MgPSBNYXRoLmNvcyhyb3RhdGlvbik7CiAgICAgICAgc2luID0gTWF0aC5zaW4ocm90YXRpb24pOwogICAgICB9CiAgICAgIGNvbnN0IGNlbnRlciA9IHRoaXMuY2VudGVyOwogICAgICB0cmFuc2Zvcm1WZXJ0ZXgoX3ZBLnNldCgtMC41LCAtMC41LCAwKSwgX212UG9zaXRpb24sIGNlbnRlciwgX3dvcmxkU2NhbGUsIHNpbiwgY29zKTsKICAgICAgdHJhbnNmb3JtVmVydGV4KF92Qi5zZXQoMC41LCAtMC41LCAwKSwgX212UG9zaXRpb24sIGNlbnRlciwgX3dvcmxkU2NhbGUsIHNpbiwgY29zKTsKICAgICAgdHJhbnNmb3JtVmVydGV4KF92Qy5zZXQoMC41LCAwLjUsIDApLCBfbXZQb3NpdGlvbiwgY2VudGVyLCBfd29ybGRTY2FsZSwgc2luLCBjb3MpOwogICAgICBfdXZBLnNldCgwLCAwKTsKICAgICAgX3V2Qi5zZXQoMSwgMCk7CiAgICAgIF91dkMuc2V0KDEsIDEpOwogICAgICBsZXQgaW50ZXJzZWN0ID0gcmF5Y2FzdGVyLnJheS5pbnRlcnNlY3RUcmlhbmdsZShfdkEsIF92QiwgX3ZDLCBmYWxzZSwgX2ludGVyc2VjdFBvaW50KTsKICAgICAgaWYgKGludGVyc2VjdCA9PT0gbnVsbCkgewogICAgICAgIHRyYW5zZm9ybVZlcnRleChfdkIuc2V0KC0wLjUsIDAuNSwgMCksIF9tdlBvc2l0aW9uLCBjZW50ZXIsIF93b3JsZFNjYWxlLCBzaW4sIGNvcyk7CiAgICAgICAgX3V2Qi5zZXQoMCwgMSk7CiAgICAgICAgaW50ZXJzZWN0ID0gcmF5Y2FzdGVyLnJheS5pbnRlcnNlY3RUcmlhbmdsZShfdkEsIF92QywgX3ZCLCBmYWxzZSwgX2ludGVyc2VjdFBvaW50KTsKICAgICAgICBpZiAoaW50ZXJzZWN0ID09PSBudWxsKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyhfaW50ZXJzZWN0UG9pbnQpOwogICAgICBpZiAoZGlzdGFuY2UgPCByYXljYXN0ZXIubmVhciB8fCBkaXN0YW5jZSA+IHJheWNhc3Rlci5mYXIpCiAgICAgICAgcmV0dXJuOwogICAgICBpbnRlcnNlY3RzMi5wdXNoKHsKICAgICAgICBkaXN0YW5jZSwKICAgICAgICBwb2ludDogX2ludGVyc2VjdFBvaW50LmNsb25lKCksCiAgICAgICAgdXY6IFRyaWFuZ2xlLmdldFVWKF9pbnRlcnNlY3RQb2ludCwgX3ZBLCBfdkIsIF92QywgX3V2QSwgX3V2QiwgX3V2QywgbmV3IFZlY3RvcjIoKSksCiAgICAgICAgZmFjZTogbnVsbCwKICAgICAgICBvYmplY3Q6IHRoaXMKICAgICAgfSk7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIGlmIChzb3VyY2UuY2VudGVyICE9PSB2b2lkIDApCiAgICAgICAgdGhpcy5jZW50ZXIuY29weShzb3VyY2UuY2VudGVyKTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IHNvdXJjZS5tYXRlcmlhbDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBTcHJpdGUucHJvdG90eXBlLmlzU3ByaXRlID0gdHJ1ZTsKICBmdW5jdGlvbiB0cmFuc2Zvcm1WZXJ0ZXgodmVydGV4UG9zaXRpb24sIG12UG9zaXRpb24sIGNlbnRlciwgc2NhbGUsIHNpbiwgY29zKSB7CiAgICBfYWxpZ25lZFBvc2l0aW9uLnN1YlZlY3RvcnModmVydGV4UG9zaXRpb24sIGNlbnRlcikuYWRkU2NhbGFyKDAuNSkubXVsdGlwbHkoc2NhbGUpOwogICAgaWYgKHNpbiAhPT0gdm9pZCAwKSB7CiAgICAgIF9yb3RhdGVkUG9zaXRpb24ueCA9IGNvcyAqIF9hbGlnbmVkUG9zaXRpb24ueCAtIHNpbiAqIF9hbGlnbmVkUG9zaXRpb24ueTsKICAgICAgX3JvdGF0ZWRQb3NpdGlvbi55ID0gc2luICogX2FsaWduZWRQb3NpdGlvbi54ICsgY29zICogX2FsaWduZWRQb3NpdGlvbi55OwogICAgfSBlbHNlIHsKICAgICAgX3JvdGF0ZWRQb3NpdGlvbi5jb3B5KF9hbGlnbmVkUG9zaXRpb24pOwogICAgfQogICAgdmVydGV4UG9zaXRpb24uY29weShtdlBvc2l0aW9uKTsKICAgIHZlcnRleFBvc2l0aW9uLnggKz0gX3JvdGF0ZWRQb3NpdGlvbi54OwogICAgdmVydGV4UG9zaXRpb24ueSArPSBfcm90YXRlZFBvc2l0aW9uLnk7CiAgICB2ZXJ0ZXhQb3NpdGlvbi5hcHBseU1hdHJpeDQoX3ZpZXdXb3JsZE1hdHJpeCk7CiAgfQogIHZhciBfYmFzZVBvc2l0aW9uID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9za2luSW5kZXggPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjQoKTsKICB2YXIgX3NraW5XZWlnaHQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjQoKTsKICB2YXIgX3ZlY3RvciQ1ID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9tYXRyaXggPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hdHJpeDQoKTsKICB2YXIgU2tpbm5lZE1lc2ggPSBjbGFzcyBleHRlbmRzIE1lc2ggewogICAgY29uc3RydWN0b3IoZ2VvbWV0cnksIG1hdGVyaWFsKSB7CiAgICAgIHN1cGVyKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgIHRoaXMudHlwZSA9ICJTa2lubmVkTWVzaCI7CiAgICAgIHRoaXMuYmluZE1vZGUgPSAiYXR0YWNoZWQiOwogICAgICB0aGlzLmJpbmRNYXRyaXggPSBuZXcgTWF0cml4NCgpOwogICAgICB0aGlzLmJpbmRNYXRyaXhJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5iaW5kTW9kZSA9IHNvdXJjZS5iaW5kTW9kZTsKICAgICAgdGhpcy5iaW5kTWF0cml4LmNvcHkoc291cmNlLmJpbmRNYXRyaXgpOwogICAgICB0aGlzLmJpbmRNYXRyaXhJbnZlcnNlLmNvcHkoc291cmNlLmJpbmRNYXRyaXhJbnZlcnNlKTsKICAgICAgdGhpcy5za2VsZXRvbiA9IHNvdXJjZS5za2VsZXRvbjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBiaW5kKHNrZWxldG9uLCBiaW5kTWF0cml4KSB7CiAgICAgIHRoaXMuc2tlbGV0b24gPSBza2VsZXRvbjsKICAgICAgaWYgKGJpbmRNYXRyaXggPT09IHZvaWQgMCkgewogICAgICAgIHRoaXMudXBkYXRlTWF0cml4V29ybGQodHJ1ZSk7CiAgICAgICAgdGhpcy5za2VsZXRvbi5jYWxjdWxhdGVJbnZlcnNlcygpOwogICAgICAgIGJpbmRNYXRyaXggPSB0aGlzLm1hdHJpeFdvcmxkOwogICAgICB9CiAgICAgIHRoaXMuYmluZE1hdHJpeC5jb3B5KGJpbmRNYXRyaXgpOwogICAgICB0aGlzLmJpbmRNYXRyaXhJbnZlcnNlLmNvcHkoYmluZE1hdHJpeCkuaW52ZXJ0KCk7CiAgICB9CiAgICBwb3NlKCkgewogICAgICB0aGlzLnNrZWxldG9uLnBvc2UoKTsKICAgIH0KICAgIG5vcm1hbGl6ZVNraW5XZWlnaHRzKCkgewogICAgICBjb25zdCB2ZWN0b3IgPSBuZXcgVmVjdG9yNCgpOwogICAgICBjb25zdCBza2luV2VpZ2h0ID0gdGhpcy5nZW9tZXRyeS5hdHRyaWJ1dGVzLnNraW5XZWlnaHQ7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc2tpbldlaWdodC5jb3VudDsgaSA8IGw7IGkrKykgewogICAgICAgIHZlY3Rvci54ID0gc2tpbldlaWdodC5nZXRYKGkpOwogICAgICAgIHZlY3Rvci55ID0gc2tpbldlaWdodC5nZXRZKGkpOwogICAgICAgIHZlY3Rvci56ID0gc2tpbldlaWdodC5nZXRaKGkpOwogICAgICAgIHZlY3Rvci53ID0gc2tpbldlaWdodC5nZXRXKGkpOwogICAgICAgIGNvbnN0IHNjYWxlID0gMSAvIHZlY3Rvci5tYW5oYXR0YW5MZW5ndGgoKTsKICAgICAgICBpZiAoc2NhbGUgIT09IEluZmluaXR5KSB7CiAgICAgICAgICB2ZWN0b3IubXVsdGlwbHlTY2FsYXIoc2NhbGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2ZWN0b3Iuc2V0KDEsIDAsIDAsIDApOwogICAgICAgIH0KICAgICAgICBza2luV2VpZ2h0LnNldFhZWlcoaSwgdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiwgdmVjdG9yLncpOwogICAgICB9CiAgICB9CiAgICB1cGRhdGVNYXRyaXhXb3JsZChmb3JjZSkgewogICAgICBzdXBlci51cGRhdGVNYXRyaXhXb3JsZChmb3JjZSk7CiAgICAgIGlmICh0aGlzLmJpbmRNb2RlID09PSAiYXR0YWNoZWQiKSB7CiAgICAgICAgdGhpcy5iaW5kTWF0cml4SW52ZXJzZS5jb3B5KHRoaXMubWF0cml4V29ybGQpLmludmVydCgpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuYmluZE1vZGUgPT09ICJkZXRhY2hlZCIpIHsKICAgICAgICB0aGlzLmJpbmRNYXRyaXhJbnZlcnNlLmNvcHkodGhpcy5iaW5kTWF0cml4KS5pbnZlcnQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLlNraW5uZWRNZXNoOiBVbnJlY29nbml6ZWQgYmluZE1vZGU6ICIgKyB0aGlzLmJpbmRNb2RlKTsKICAgICAgfQogICAgfQogICAgYm9uZVRyYW5zZm9ybShpbmRleCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHNrZWxldG9uID0gdGhpcy5za2VsZXRvbjsKICAgICAgY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwogICAgICBfc2tpbkluZGV4LmZyb21CdWZmZXJBdHRyaWJ1dGUoZ2VvbWV0cnkuYXR0cmlidXRlcy5za2luSW5kZXgsIGluZGV4KTsKICAgICAgX3NraW5XZWlnaHQuZnJvbUJ1ZmZlckF0dHJpYnV0ZShnZW9tZXRyeS5hdHRyaWJ1dGVzLnNraW5XZWlnaHQsIGluZGV4KTsKICAgICAgX2Jhc2VQb3NpdGlvbi5mcm9tQnVmZmVyQXR0cmlidXRlKGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24sIGluZGV4KS5hcHBseU1hdHJpeDQodGhpcy5iaW5kTWF0cml4KTsKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICBjb25zdCB3ZWlnaHQgPSBfc2tpbldlaWdodC5nZXRDb21wb25lbnQoaSk7CiAgICAgICAgaWYgKHdlaWdodCAhPT0gMCkgewogICAgICAgICAgY29uc3QgYm9uZUluZGV4ID0gX3NraW5JbmRleC5nZXRDb21wb25lbnQoaSk7CiAgICAgICAgICBfbWF0cml4Lm11bHRpcGx5TWF0cmljZXMoc2tlbGV0b24uYm9uZXNbYm9uZUluZGV4XS5tYXRyaXhXb3JsZCwgc2tlbGV0b24uYm9uZUludmVyc2VzW2JvbmVJbmRleF0pOwogICAgICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3RvcihfdmVjdG9yJDUuY29weShfYmFzZVBvc2l0aW9uKS5hcHBseU1hdHJpeDQoX21hdHJpeCksIHdlaWdodCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0YXJnZXQuYXBwbHlNYXRyaXg0KHRoaXMuYmluZE1hdHJpeEludmVyc2UpOwogICAgfQogIH07CiAgU2tpbm5lZE1lc2gucHJvdG90eXBlLmlzU2tpbm5lZE1lc2ggPSB0cnVlOwogIHZhciBCb25lID0gY2xhc3MgZXh0ZW5kcyBPYmplY3QzRCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIkJvbmUiOwogICAgfQogIH07CiAgQm9uZS5wcm90b3R5cGUuaXNCb25lID0gdHJ1ZTsKICB2YXIgRGF0YVRleHR1cmUgPSBjbGFzcyBleHRlbmRzIFRleHR1cmUgewogICAgY29uc3RydWN0b3IoZGF0YSA9IG51bGwsIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgZm9ybWF0LCB0eXBlLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIG1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIGFuaXNvdHJvcHksIGVuY29kaW5nKSB7CiAgICAgIHN1cGVyKG51bGwsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSwgZW5jb2RpbmcpOwogICAgICB0aGlzLmltYWdlID0geyBkYXRhLCB3aWR0aCwgaGVpZ2h0IH07CiAgICAgIHRoaXMubWFnRmlsdGVyID0gbWFnRmlsdGVyOwogICAgICB0aGlzLm1pbkZpbHRlciA9IG1pbkZpbHRlcjsKICAgICAgdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKICAgICAgdGhpcy5mbGlwWSA9IGZhbHNlOwogICAgICB0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CiAgICAgIHRoaXMubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgfQogIH07CiAgRGF0YVRleHR1cmUucHJvdG90eXBlLmlzRGF0YVRleHR1cmUgPSB0cnVlOwogIHZhciBfaW5zdGFuY2VMb2NhbE1hdHJpeCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWF0cml4NCgpOwogIHZhciBfaW5zdGFuY2VXb3JsZE1hdHJpeCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWF0cml4NCgpOwogIHZhciBfaW5zdGFuY2VJbnRlcnNlY3RzID0gW107CiAgdmFyIF9tZXNoID0gLyogQF9fUFVSRV9fICovIG5ldyBNZXNoKCk7CiAgdmFyIEluc3RhbmNlZE1lc2ggPSBjbGFzcyBleHRlbmRzIE1lc2ggewogICAgY29uc3RydWN0b3IoZ2VvbWV0cnksIG1hdGVyaWFsLCBjb3VudCkgewogICAgICBzdXBlcihnZW9tZXRyeSwgbWF0ZXJpYWwpOwogICAgICB0aGlzLmluc3RhbmNlTWF0cml4ID0gbmV3IEJ1ZmZlckF0dHJpYnV0ZShuZXcgRmxvYXQzMkFycmF5KGNvdW50ICogMTYpLCAxNik7CiAgICAgIHRoaXMuaW5zdGFuY2VDb2xvciA9IG51bGw7CiAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKICAgICAgdGhpcy5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMuaW5zdGFuY2VNYXRyaXguY29weShzb3VyY2UuaW5zdGFuY2VNYXRyaXgpOwogICAgICBpZiAoc291cmNlLmluc3RhbmNlQ29sb3IgIT09IG51bGwpCiAgICAgICAgdGhpcy5pbnN0YW5jZUNvbG9yID0gc291cmNlLmluc3RhbmNlQ29sb3IuY2xvbmUoKTsKICAgICAgdGhpcy5jb3VudCA9IHNvdXJjZS5jb3VudDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXRDb2xvckF0KGluZGV4LCBjb2xvcikgewogICAgICBjb2xvci5mcm9tQXJyYXkodGhpcy5pbnN0YW5jZUNvbG9yLmFycmF5LCBpbmRleCAqIDMpOwogICAgfQogICAgZ2V0TWF0cml4QXQoaW5kZXgsIG1hdHJpeCkgewogICAgICBtYXRyaXguZnJvbUFycmF5KHRoaXMuaW5zdGFuY2VNYXRyaXguYXJyYXksIGluZGV4ICogMTYpOwogICAgfQogICAgcmF5Y2FzdChyYXljYXN0ZXIsIGludGVyc2VjdHMyKSB7CiAgICAgIGNvbnN0IG1hdHJpeFdvcmxkID0gdGhpcy5tYXRyaXhXb3JsZDsKICAgICAgY29uc3QgcmF5Y2FzdFRpbWVzID0gdGhpcy5jb3VudDsKICAgICAgX21lc2guZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwogICAgICBfbWVzaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICAgIGlmIChfbWVzaC5tYXRlcmlhbCA9PT0gdm9pZCAwKQogICAgICAgIHJldHVybjsKICAgICAgZm9yIChsZXQgaW5zdGFuY2VJZCA9IDA7IGluc3RhbmNlSWQgPCByYXljYXN0VGltZXM7IGluc3RhbmNlSWQrKykgewogICAgICAgIHRoaXMuZ2V0TWF0cml4QXQoaW5zdGFuY2VJZCwgX2luc3RhbmNlTG9jYWxNYXRyaXgpOwogICAgICAgIF9pbnN0YW5jZVdvcmxkTWF0cml4Lm11bHRpcGx5TWF0cmljZXMobWF0cml4V29ybGQsIF9pbnN0YW5jZUxvY2FsTWF0cml4KTsKICAgICAgICBfbWVzaC5tYXRyaXhXb3JsZCA9IF9pbnN0YW5jZVdvcmxkTWF0cml4OwogICAgICAgIF9tZXNoLnJheWNhc3QocmF5Y2FzdGVyLCBfaW5zdGFuY2VJbnRlcnNlY3RzKTsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IF9pbnN0YW5jZUludGVyc2VjdHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBpbnRlcnNlY3QgPSBfaW5zdGFuY2VJbnRlcnNlY3RzW2ldOwogICAgICAgICAgaW50ZXJzZWN0Lmluc3RhbmNlSWQgPSBpbnN0YW5jZUlkOwogICAgICAgICAgaW50ZXJzZWN0Lm9iamVjdCA9IHRoaXM7CiAgICAgICAgICBpbnRlcnNlY3RzMi5wdXNoKGludGVyc2VjdCk7CiAgICAgICAgfQogICAgICAgIF9pbnN0YW5jZUludGVyc2VjdHMubGVuZ3RoID0gMDsKICAgICAgfQogICAgfQogICAgc2V0Q29sb3JBdChpbmRleCwgY29sb3IpIHsKICAgICAgaWYgKHRoaXMuaW5zdGFuY2VDb2xvciA9PT0gbnVsbCkgewogICAgICAgIHRoaXMuaW5zdGFuY2VDb2xvciA9IG5ldyBCdWZmZXJBdHRyaWJ1dGUobmV3IEZsb2F0MzJBcnJheSh0aGlzLmNvdW50ICogMyksIDMpOwogICAgICB9CiAgICAgIGNvbG9yLnRvQXJyYXkodGhpcy5pbnN0YW5jZUNvbG9yLmFycmF5LCBpbmRleCAqIDMpOwogICAgfQogICAgc2V0TWF0cml4QXQoaW5kZXgsIG1hdHJpeCkgewogICAgICBtYXRyaXgudG9BcnJheSh0aGlzLmluc3RhbmNlTWF0cml4LmFycmF5LCBpbmRleCAqIDE2KTsKICAgIH0KICAgIHVwZGF0ZU1vcnBoVGFyZ2V0cygpIHsKICAgIH0KICAgIGRpc3Bvc2UoKSB7CiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCh7IHR5cGU6ICJkaXNwb3NlIiB9KTsKICAgIH0KICB9OwogIEluc3RhbmNlZE1lc2gucHJvdG90eXBlLmlzSW5zdGFuY2VkTWVzaCA9IHRydWU7CiAgdmFyIExpbmVCYXNpY01hdGVyaWFsID0gY2xhc3MgZXh0ZW5kcyBNYXRlcmlhbCB7CiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJMaW5lQmFzaWNNYXRlcmlhbCI7CiAgICAgIHRoaXMuY29sb3IgPSBuZXcgQ29sb3IoMTY3NzcyMTUpOwogICAgICB0aGlzLmxpbmV3aWR0aCA9IDE7CiAgICAgIHRoaXMubGluZWNhcCA9ICJyb3VuZCI7CiAgICAgIHRoaXMubGluZWpvaW4gPSAicm91bmQiOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IGZhbHNlOwogICAgICB0aGlzLnNldFZhbHVlcyhwYXJhbWV0ZXJzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5jb2xvci5jb3B5KHNvdXJjZS5jb2xvcik7CiAgICAgIHRoaXMubGluZXdpZHRoID0gc291cmNlLmxpbmV3aWR0aDsKICAgICAgdGhpcy5saW5lY2FwID0gc291cmNlLmxpbmVjYXA7CiAgICAgIHRoaXMubGluZWpvaW4gPSBzb3VyY2UubGluZWpvaW47CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gc291cmNlLm1vcnBoVGFyZ2V0czsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBMaW5lQmFzaWNNYXRlcmlhbC5wcm90b3R5cGUuaXNMaW5lQmFzaWNNYXRlcmlhbCA9IHRydWU7CiAgdmFyIF9zdGFydCQxID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9lbmQkMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfaW52ZXJzZU1hdHJpeCQxID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXRyaXg0KCk7CiAgdmFyIF9yYXkkMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgUmF5KCk7CiAgdmFyIF9zcGhlcmUkMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU3BoZXJlKCk7CiAgdmFyIExpbmUgPSBjbGFzcyBleHRlbmRzIE9iamVjdDNEIHsKICAgIGNvbnN0cnVjdG9yKGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCksIG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCkpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIkxpbmUiOwogICAgICB0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbDsKICAgICAgdGhpcy51cGRhdGVNb3JwaFRhcmdldHMoKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IHNvdXJjZS5tYXRlcmlhbDsKICAgICAgdGhpcy5nZW9tZXRyeSA9IHNvdXJjZS5nZW9tZXRyeTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb21wdXRlTGluZURpc3RhbmNlcygpIHsKICAgICAgY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwogICAgICBpZiAoZ2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSkgewogICAgICAgIGlmIChnZW9tZXRyeS5pbmRleCA9PT0gbnVsbCkgewogICAgICAgICAgY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwogICAgICAgICAgY29uc3QgbGluZURpc3RhbmNlcyA9IFswXTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgX3N0YXJ0JDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZShwb3NpdGlvbkF0dHJpYnV0ZSwgaSAtIDEpOwogICAgICAgICAgICBfZW5kJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZShwb3NpdGlvbkF0dHJpYnV0ZSwgaSk7CiAgICAgICAgICAgIGxpbmVEaXN0YW5jZXNbaV0gPSBsaW5lRGlzdGFuY2VzW2kgLSAxXTsKICAgICAgICAgICAgbGluZURpc3RhbmNlc1tpXSArPSBfc3RhcnQkMS5kaXN0YW5jZVRvKF9lbmQkMSk7CiAgICAgICAgICB9CiAgICAgICAgICBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoImxpbmVEaXN0YW5jZSIsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKGxpbmVEaXN0YW5jZXMsIDEpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5MaW5lLmNvbXB1dGVMaW5lRGlzdGFuY2VzKCk6IENvbXB1dGF0aW9uIG9ubHkgcG9zc2libGUgd2l0aCBub24taW5kZXhlZCBCdWZmZXJHZW9tZXRyeS4iKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZ2VvbWV0cnkuaXNHZW9tZXRyeSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLkxpbmUuY29tcHV0ZUxpbmVEaXN0YW5jZXMoKSBubyBsb25nZXIgc3VwcG9ydHMgVEhSRUUuR2VvbWV0cnkuIFVzZSBUSFJFRS5CdWZmZXJHZW9tZXRyeSBpbnN0ZWFkLiIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcmF5Y2FzdChyYXljYXN0ZXIsIGludGVyc2VjdHMyKSB7CiAgICAgIGNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKICAgICAgY29uc3QgbWF0cml4V29ybGQgPSB0aGlzLm1hdHJpeFdvcmxkOwogICAgICBjb25zdCB0aHJlc2hvbGQgPSByYXljYXN0ZXIucGFyYW1zLkxpbmUudGhyZXNob2xkOwogICAgICBjb25zdCBkcmF3UmFuZ2UgPSBnZW9tZXRyeS5kcmF3UmFuZ2U7CiAgICAgIGlmIChnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCkKICAgICAgICBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKICAgICAgX3NwaGVyZSQxLmNvcHkoZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUpOwogICAgICBfc3BoZXJlJDEuYXBwbHlNYXRyaXg0KG1hdHJpeFdvcmxkKTsKICAgICAgX3NwaGVyZSQxLnJhZGl1cyArPSB0aHJlc2hvbGQ7CiAgICAgIGlmIChyYXljYXN0ZXIucmF5LmludGVyc2VjdHNTcGhlcmUoX3NwaGVyZSQxKSA9PT0gZmFsc2UpCiAgICAgICAgcmV0dXJuOwogICAgICBfaW52ZXJzZU1hdHJpeCQxLmNvcHkobWF0cml4V29ybGQpLmludmVydCgpOwogICAgICBfcmF5JDEuY29weShyYXljYXN0ZXIucmF5KS5hcHBseU1hdHJpeDQoX2ludmVyc2VNYXRyaXgkMSk7CiAgICAgIGNvbnN0IGxvY2FsVGhyZXNob2xkID0gdGhyZXNob2xkIC8gKCh0aGlzLnNjYWxlLnggKyB0aGlzLnNjYWxlLnkgKyB0aGlzLnNjYWxlLnopIC8gMyk7CiAgICAgIGNvbnN0IGxvY2FsVGhyZXNob2xkU3EgPSBsb2NhbFRocmVzaG9sZCAqIGxvY2FsVGhyZXNob2xkOwogICAgICBjb25zdCB2U3RhcnQgPSBuZXcgVmVjdG9yMygpOwogICAgICBjb25zdCB2RW5kID0gbmV3IFZlY3RvcjMoKTsKICAgICAgY29uc3QgaW50ZXJTZWdtZW50ID0gbmV3IFZlY3RvcjMoKTsKICAgICAgY29uc3QgaW50ZXJSYXkgPSBuZXcgVmVjdG9yMygpOwogICAgICBjb25zdCBzdGVwID0gdGhpcy5pc0xpbmVTZWdtZW50cyA/IDIgOiAxOwogICAgICBpZiAoZ2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSkgewogICAgICAgIGNvbnN0IGluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CiAgICAgICAgY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzLnBvc2l0aW9uOwogICAgICAgIGlmIChpbmRleCAhPT0gbnVsbCkgewogICAgICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heCgwLCBkcmF3UmFuZ2Uuc3RhcnQpOwogICAgICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4oaW5kZXguY291bnQsIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCk7CiAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnQsIGwgPSBlbmQgLSAxOyBpIDwgbDsgaSArPSBzdGVwKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBpbmRleC5nZXRYKGkpOwogICAgICAgICAgICBjb25zdCBiID0gaW5kZXguZ2V0WChpICsgMSk7CiAgICAgICAgICAgIHZTdGFydC5mcm9tQnVmZmVyQXR0cmlidXRlKHBvc2l0aW9uQXR0cmlidXRlLCBhKTsKICAgICAgICAgICAgdkVuZC5mcm9tQnVmZmVyQXR0cmlidXRlKHBvc2l0aW9uQXR0cmlidXRlLCBiKTsKICAgICAgICAgICAgY29uc3QgZGlzdFNxID0gX3JheSQxLmRpc3RhbmNlU3FUb1NlZ21lbnQodlN0YXJ0LCB2RW5kLCBpbnRlclJheSwgaW50ZXJTZWdtZW50KTsKICAgICAgICAgICAgaWYgKGRpc3RTcSA+IGxvY2FsVGhyZXNob2xkU3EpCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGludGVyUmF5LmFwcGx5TWF0cml4NCh0aGlzLm1hdHJpeFdvcmxkKTsKICAgICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKGludGVyUmF5KTsKICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpbnRlcnNlY3RzMi5wdXNoKHsKICAgICAgICAgICAgICBkaXN0YW5jZSwKICAgICAgICAgICAgICBwb2ludDogaW50ZXJTZWdtZW50LmNsb25lKCkuYXBwbHlNYXRyaXg0KHRoaXMubWF0cml4V29ybGQpLAogICAgICAgICAgICAgIGluZGV4OiBpLAogICAgICAgICAgICAgIGZhY2U6IG51bGwsCiAgICAgICAgICAgICAgZmFjZUluZGV4OiBudWxsLAogICAgICAgICAgICAgIG9iamVjdDogdGhpcwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heCgwLCBkcmF3UmFuZ2Uuc3RhcnQpOwogICAgICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4ocG9zaXRpb25BdHRyaWJ1dGUuY291bnQsIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCk7CiAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnQsIGwgPSBlbmQgLSAxOyBpIDwgbDsgaSArPSBzdGVwKSB7CiAgICAgICAgICAgIHZTdGFydC5mcm9tQnVmZmVyQXR0cmlidXRlKHBvc2l0aW9uQXR0cmlidXRlLCBpKTsKICAgICAgICAgICAgdkVuZC5mcm9tQnVmZmVyQXR0cmlidXRlKHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMSk7CiAgICAgICAgICAgIGNvbnN0IGRpc3RTcSA9IF9yYXkkMS5kaXN0YW5jZVNxVG9TZWdtZW50KHZTdGFydCwgdkVuZCwgaW50ZXJSYXksIGludGVyU2VnbWVudCk7CiAgICAgICAgICAgIGlmIChkaXN0U3EgPiBsb2NhbFRocmVzaG9sZFNxKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpbnRlclJheS5hcHBseU1hdHJpeDQodGhpcy5tYXRyaXhXb3JsZCk7CiAgICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyhpbnRlclJheSk7CiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IHJheWNhc3Rlci5uZWFyIHx8IGRpc3RhbmNlID4gcmF5Y2FzdGVyLmZhcikKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaW50ZXJzZWN0czIucHVzaCh7CiAgICAgICAgICAgICAgZGlzdGFuY2UsCiAgICAgICAgICAgICAgcG9pbnQ6IGludGVyU2VnbWVudC5jbG9uZSgpLmFwcGx5TWF0cml4NCh0aGlzLm1hdHJpeFdvcmxkKSwKICAgICAgICAgICAgICBpbmRleDogaSwKICAgICAgICAgICAgICBmYWNlOiBudWxsLAogICAgICAgICAgICAgIGZhY2VJbmRleDogbnVsbCwKICAgICAgICAgICAgICBvYmplY3Q6IHRoaXMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGdlb21ldHJ5LmlzR2VvbWV0cnkpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5MaW5lLnJheWNhc3QoKSBubyBsb25nZXIgc3VwcG9ydHMgVEhSRUUuR2VvbWV0cnkuIFVzZSBUSFJFRS5CdWZmZXJHZW9tZXRyeSBpbnN0ZWFkLiIpOwogICAgICB9CiAgICB9CiAgICB1cGRhdGVNb3JwaFRhcmdldHMoKSB7CiAgICAgIGNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKICAgICAgaWYgKGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkpIHsKICAgICAgICBjb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXM7CiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG1vcnBoQXR0cmlidXRlcyk7CiAgICAgICAgaWYgKGtleXMubGVuZ3RoID4gMCkgewogICAgICAgICAgY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNba2V5c1swXV07CiAgICAgICAgICBpZiAobW9ycGhBdHRyaWJ1dGUgIT09IHZvaWQgMCkgewogICAgICAgICAgICB0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyA9IFtdOwogICAgICAgICAgICB0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSA9IHt9OwogICAgICAgICAgICBmb3IgKGxldCBtID0gMCwgbWwgPSBtb3JwaEF0dHJpYnV0ZS5sZW5ndGg7IG0gPCBtbDsgbSsrKSB7CiAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IG1vcnBoQXR0cmlidXRlW21dLm5hbWUgfHwgU3RyaW5nKG0pOwogICAgICAgICAgICAgIHRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzLnB1c2goMCk7CiAgICAgICAgICAgICAgdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnlbbmFtZV0gPSBtOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IG1vcnBoVGFyZ2V0cyA9IGdlb21ldHJ5Lm1vcnBoVGFyZ2V0czsKICAgICAgICBpZiAobW9ycGhUYXJnZXRzICE9PSB2b2lkIDAgJiYgbW9ycGhUYXJnZXRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLkxpbmUudXBkYXRlTW9ycGhUYXJnZXRzKCkgZG9lcyBub3Qgc3VwcG9ydCBUSFJFRS5HZW9tZXRyeS4gVXNlIFRIUkVFLkJ1ZmZlckdlb21ldHJ5IGluc3RlYWQuIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKICBMaW5lLnByb3RvdHlwZS5pc0xpbmUgPSB0cnVlOwogIHZhciBfc3RhcnQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX2VuZCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBMaW5lU2VnbWVudHMgPSBjbGFzcyBleHRlbmRzIExpbmUgewogICAgY29uc3RydWN0b3IoZ2VvbWV0cnksIG1hdGVyaWFsKSB7CiAgICAgIHN1cGVyKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgIHRoaXMudHlwZSA9ICJMaW5lU2VnbWVudHMiOwogICAgfQogICAgY29tcHV0ZUxpbmVEaXN0YW5jZXMoKSB7CiAgICAgIGNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKICAgICAgaWYgKGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkpIHsKICAgICAgICBpZiAoZ2VvbWV0cnkuaW5kZXggPT09IG51bGwpIHsKICAgICAgICAgIGNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKICAgICAgICAgIGNvbnN0IGxpbmVEaXN0YW5jZXMgPSBbXTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgICAgX3N0YXJ0LmZyb21CdWZmZXJBdHRyaWJ1dGUocG9zaXRpb25BdHRyaWJ1dGUsIGkpOwogICAgICAgICAgICBfZW5kLmZyb21CdWZmZXJBdHRyaWJ1dGUocG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAxKTsKICAgICAgICAgICAgbGluZURpc3RhbmNlc1tpXSA9IGkgPT09IDAgPyAwIDogbGluZURpc3RhbmNlc1tpIC0gMV07CiAgICAgICAgICAgIGxpbmVEaXN0YW5jZXNbaSArIDFdID0gbGluZURpc3RhbmNlc1tpXSArIF9zdGFydC5kaXN0YW5jZVRvKF9lbmQpOwogICAgICAgICAgfQogICAgICAgICAgZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCJsaW5lRGlzdGFuY2UiLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZShsaW5lRGlzdGFuY2VzLCAxKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuTGluZVNlZ21lbnRzLmNvbXB1dGVMaW5lRGlzdGFuY2VzKCk6IENvbXB1dGF0aW9uIG9ubHkgcG9zc2libGUgd2l0aCBub24taW5kZXhlZCBCdWZmZXJHZW9tZXRyeS4iKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZ2VvbWV0cnkuaXNHZW9tZXRyeSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLkxpbmVTZWdtZW50cy5jb21wdXRlTGluZURpc3RhbmNlcygpIG5vIGxvbmdlciBzdXBwb3J0cyBUSFJFRS5HZW9tZXRyeS4gVXNlIFRIUkVFLkJ1ZmZlckdlb21ldHJ5IGluc3RlYWQuIik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBMaW5lU2VnbWVudHMucHJvdG90eXBlLmlzTGluZVNlZ21lbnRzID0gdHJ1ZTsKICB2YXIgTGluZUxvb3AgPSBjbGFzcyBleHRlbmRzIExpbmUgewogICAgY29uc3RydWN0b3IoZ2VvbWV0cnksIG1hdGVyaWFsKSB7CiAgICAgIHN1cGVyKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgIHRoaXMudHlwZSA9ICJMaW5lTG9vcCI7CiAgICB9CiAgfTsKICBMaW5lTG9vcC5wcm90b3R5cGUuaXNMaW5lTG9vcCA9IHRydWU7CiAgdmFyIFBvaW50c01hdGVyaWFsID0gY2xhc3MgZXh0ZW5kcyBNYXRlcmlhbCB7CiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJQb2ludHNNYXRlcmlhbCI7CiAgICAgIHRoaXMuY29sb3IgPSBuZXcgQ29sb3IoMTY3NzcyMTUpOwogICAgICB0aGlzLm1hcCA9IG51bGw7CiAgICAgIHRoaXMuYWxwaGFNYXAgPSBudWxsOwogICAgICB0aGlzLnNpemUgPSAxOwogICAgICB0aGlzLnNpemVBdHRlbnVhdGlvbiA9IHRydWU7CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gZmFsc2U7CiAgICAgIHRoaXMuc2V0VmFsdWVzKHBhcmFtZXRlcnMpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLmNvbG9yLmNvcHkoc291cmNlLmNvbG9yKTsKICAgICAgdGhpcy5tYXAgPSBzb3VyY2UubWFwOwogICAgICB0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwogICAgICB0aGlzLnNpemUgPSBzb3VyY2Uuc2l6ZTsKICAgICAgdGhpcy5zaXplQXR0ZW51YXRpb24gPSBzb3VyY2Uuc2l6ZUF0dGVudWF0aW9uOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgUG9pbnRzTWF0ZXJpYWwucHJvdG90eXBlLmlzUG9pbnRzTWF0ZXJpYWwgPSB0cnVlOwogIHZhciBfaW52ZXJzZU1hdHJpeCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWF0cml4NCgpOwogIHZhciBfcmF5ID0gLyogQF9fUFVSRV9fICovIG5ldyBSYXkoKTsKICB2YXIgX3NwaGVyZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU3BoZXJlKCk7CiAgdmFyIF9wb3NpdGlvbiQyID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIFBvaW50cyA9IGNsYXNzIGV4dGVuZHMgT2JqZWN0M0QgewogICAgY29uc3RydWN0b3IoZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKSwgbWF0ZXJpYWwgPSBuZXcgUG9pbnRzTWF0ZXJpYWwoKSkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiUG9pbnRzIjsKICAgICAgdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5OwogICAgICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7CiAgICAgIHRoaXMudXBkYXRlTW9ycGhUYXJnZXRzKCk7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSBzb3VyY2UubWF0ZXJpYWw7CiAgICAgIHRoaXMuZ2VvbWV0cnkgPSBzb3VyY2UuZ2VvbWV0cnk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcmF5Y2FzdChyYXljYXN0ZXIsIGludGVyc2VjdHMyKSB7CiAgICAgIGNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKICAgICAgY29uc3QgbWF0cml4V29ybGQgPSB0aGlzLm1hdHJpeFdvcmxkOwogICAgICBjb25zdCB0aHJlc2hvbGQgPSByYXljYXN0ZXIucGFyYW1zLlBvaW50cy50aHJlc2hvbGQ7CiAgICAgIGNvbnN0IGRyYXdSYW5nZSA9IGdlb21ldHJ5LmRyYXdSYW5nZTsKICAgICAgaWYgKGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsKQogICAgICAgIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwogICAgICBfc3BoZXJlLmNvcHkoZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUpOwogICAgICBfc3BoZXJlLmFwcGx5TWF0cml4NChtYXRyaXhXb3JsZCk7CiAgICAgIF9zcGhlcmUucmFkaXVzICs9IHRocmVzaG9sZDsKICAgICAgaWYgKHJheWNhc3Rlci5yYXkuaW50ZXJzZWN0c1NwaGVyZShfc3BoZXJlKSA9PT0gZmFsc2UpCiAgICAgICAgcmV0dXJuOwogICAgICBfaW52ZXJzZU1hdHJpeC5jb3B5KG1hdHJpeFdvcmxkKS5pbnZlcnQoKTsKICAgICAgX3JheS5jb3B5KHJheWNhc3Rlci5yYXkpLmFwcGx5TWF0cml4NChfaW52ZXJzZU1hdHJpeCk7CiAgICAgIGNvbnN0IGxvY2FsVGhyZXNob2xkID0gdGhyZXNob2xkIC8gKCh0aGlzLnNjYWxlLnggKyB0aGlzLnNjYWxlLnkgKyB0aGlzLnNjYWxlLnopIC8gMyk7CiAgICAgIGNvbnN0IGxvY2FsVGhyZXNob2xkU3EgPSBsb2NhbFRocmVzaG9sZCAqIGxvY2FsVGhyZXNob2xkOwogICAgICBpZiAoZ2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSkgewogICAgICAgIGNvbnN0IGluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CiAgICAgICAgY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzLnBvc2l0aW9uOwogICAgICAgIGlmIChpbmRleCAhPT0gbnVsbCkgewogICAgICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heCgwLCBkcmF3UmFuZ2Uuc3RhcnQpOwogICAgICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4oaW5kZXguY291bnQsIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCk7CiAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnQsIGlsID0gZW5kOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgICBjb25zdCBhID0gaW5kZXguZ2V0WChpKTsKICAgICAgICAgICAgX3Bvc2l0aW9uJDIuZnJvbUJ1ZmZlckF0dHJpYnV0ZShwb3NpdGlvbkF0dHJpYnV0ZSwgYSk7CiAgICAgICAgICAgIHRlc3RQb2ludChfcG9zaXRpb24kMiwgYSwgbG9jYWxUaHJlc2hvbGRTcSwgbWF0cml4V29ybGQsIHJheWNhc3RlciwgaW50ZXJzZWN0czIsIHRoaXMpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBzdGFydCA9IE1hdGgubWF4KDAsIGRyYXdSYW5nZS5zdGFydCk7CiAgICAgICAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudCwgZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50KTsKICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydCwgbCA9IGVuZDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICBfcG9zaXRpb24kMi5mcm9tQnVmZmVyQXR0cmlidXRlKHBvc2l0aW9uQXR0cmlidXRlLCBpKTsKICAgICAgICAgICAgdGVzdFBvaW50KF9wb3NpdGlvbiQyLCBpLCBsb2NhbFRocmVzaG9sZFNxLCBtYXRyaXhXb3JsZCwgcmF5Y2FzdGVyLCBpbnRlcnNlY3RzMiwgdGhpcyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLlBvaW50cy5yYXljYXN0KCkgbm8gbG9uZ2VyIHN1cHBvcnRzIFRIUkVFLkdlb21ldHJ5LiBVc2UgVEhSRUUuQnVmZmVyR2VvbWV0cnkgaW5zdGVhZC4iKTsKICAgICAgfQogICAgfQogICAgdXBkYXRlTW9ycGhUYXJnZXRzKCkgewogICAgICBjb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CiAgICAgIGlmIChnZW9tZXRyeS5pc0J1ZmZlckdlb21ldHJ5KSB7CiAgICAgICAgY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwogICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhtb3JwaEF0dHJpYnV0ZXMpOwogICAgICAgIGlmIChrZXlzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzW2tleXNbMF1dOwogICAgICAgICAgaWYgKG1vcnBoQXR0cmlidXRlICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSB7fTsKICAgICAgICAgICAgZm9yIChsZXQgbSA9IDAsIG1sID0gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoOyBtIDwgbWw7IG0rKykgewogICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBtb3JwaEF0dHJpYnV0ZVttXS5uYW1lIHx8IFN0cmluZyhtKTsKICAgICAgICAgICAgICB0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcy5wdXNoKDApOwogICAgICAgICAgICAgIHRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5W25hbWVdID0gbTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBtb3JwaFRhcmdldHMgPSBnZW9tZXRyeS5tb3JwaFRhcmdldHM7CiAgICAgICAgaWYgKG1vcnBoVGFyZ2V0cyAhPT0gdm9pZCAwICYmIG1vcnBoVGFyZ2V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5Qb2ludHMudXBkYXRlTW9ycGhUYXJnZXRzKCkgZG9lcyBub3Qgc3VwcG9ydCBUSFJFRS5HZW9tZXRyeS4gVXNlIFRIUkVFLkJ1ZmZlckdlb21ldHJ5IGluc3RlYWQuIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKICBQb2ludHMucHJvdG90eXBlLmlzUG9pbnRzID0gdHJ1ZTsKICBmdW5jdGlvbiB0ZXN0UG9pbnQocG9pbnQsIGluZGV4LCBsb2NhbFRocmVzaG9sZFNxLCBtYXRyaXhXb3JsZCwgcmF5Y2FzdGVyLCBpbnRlcnNlY3RzMiwgb2JqZWN0KSB7CiAgICBjb25zdCByYXlQb2ludERpc3RhbmNlU3EgPSBfcmF5LmRpc3RhbmNlU3FUb1BvaW50KHBvaW50KTsKICAgIGlmIChyYXlQb2ludERpc3RhbmNlU3EgPCBsb2NhbFRocmVzaG9sZFNxKSB7CiAgICAgIGNvbnN0IGludGVyc2VjdFBvaW50ID0gbmV3IFZlY3RvcjMoKTsKICAgICAgX3JheS5jbG9zZXN0UG9pbnRUb1BvaW50KHBvaW50LCBpbnRlcnNlY3RQb2ludCk7CiAgICAgIGludGVyc2VjdFBvaW50LmFwcGx5TWF0cml4NChtYXRyaXhXb3JsZCk7CiAgICAgIGNvbnN0IGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyhpbnRlcnNlY3RQb2ludCk7CiAgICAgIGlmIChkaXN0YW5jZSA8IHJheWNhc3Rlci5uZWFyIHx8IGRpc3RhbmNlID4gcmF5Y2FzdGVyLmZhcikKICAgICAgICByZXR1cm47CiAgICAgIGludGVyc2VjdHMyLnB1c2goewogICAgICAgIGRpc3RhbmNlLAogICAgICAgIGRpc3RhbmNlVG9SYXk6IE1hdGguc3FydChyYXlQb2ludERpc3RhbmNlU3EpLAogICAgICAgIHBvaW50OiBpbnRlcnNlY3RQb2ludCwKICAgICAgICBpbmRleCwKICAgICAgICBmYWNlOiBudWxsLAogICAgICAgIG9iamVjdAogICAgICB9KTsKICAgIH0KICB9CiAgdmFyIFZpZGVvVGV4dHVyZSA9IGNsYXNzIGV4dGVuZHMgVGV4dHVyZSB7CiAgICBjb25zdHJ1Y3Rvcih2aWRlbywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5KSB7CiAgICAgIHN1cGVyKHZpZGVvLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkpOwogICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdCAhPT0gdm9pZCAwID8gZm9ybWF0IDogUkdCRm9ybWF0OwogICAgICB0aGlzLm1pbkZpbHRlciA9IG1pbkZpbHRlciAhPT0gdm9pZCAwID8gbWluRmlsdGVyIDogTGluZWFyRmlsdGVyOwogICAgICB0aGlzLm1hZ0ZpbHRlciA9IG1hZ0ZpbHRlciAhPT0gdm9pZCAwID8gbWFnRmlsdGVyIDogTGluZWFyRmlsdGVyOwogICAgICB0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwogICAgICBjb25zdCBzY29wZSA9IHRoaXM7CiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVZpZGVvKCkgewogICAgICAgIHNjb3BlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgICB2aWRlby5yZXF1ZXN0VmlkZW9GcmFtZUNhbGxiYWNrKHVwZGF0ZVZpZGVvKTsKICAgICAgfQogICAgICBpZiAoInJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2siIGluIHZpZGVvKSB7CiAgICAgICAgdmlkZW8ucmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjayh1cGRhdGVWaWRlbyk7CiAgICAgIH0KICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5pbWFnZSkuY29weSh0aGlzKTsKICAgIH0KICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgdmlkZW8gPSB0aGlzLmltYWdlOwogICAgICBjb25zdCBoYXNWaWRlb0ZyYW1lQ2FsbGJhY2sgPSAicmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjayIgaW4gdmlkZW87CiAgICAgIGlmIChoYXNWaWRlb0ZyYW1lQ2FsbGJhY2sgPT09IGZhbHNlICYmIHZpZGVvLnJlYWR5U3RhdGUgPj0gdmlkZW8uSEFWRV9DVVJSRU5UX0RBVEEpIHsKICAgICAgICB0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgfQogICAgfQogIH07CiAgVmlkZW9UZXh0dXJlLnByb3RvdHlwZS5pc1ZpZGVvVGV4dHVyZSA9IHRydWU7CiAgdmFyIENvbXByZXNzZWRUZXh0dXJlID0gY2xhc3MgZXh0ZW5kcyBUZXh0dXJlIHsKICAgIGNvbnN0cnVjdG9yKG1pcG1hcHMsIHdpZHRoLCBoZWlnaHQsIGZvcm1hdCwgdHlwZSwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgYW5pc290cm9weSwgZW5jb2RpbmcpIHsKICAgICAgc3VwZXIobnVsbCwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBlbmNvZGluZyk7CiAgICAgIHRoaXMuaW1hZ2UgPSB7IHdpZHRoLCBoZWlnaHQgfTsKICAgICAgdGhpcy5taXBtYXBzID0gbWlwbWFwczsKICAgICAgdGhpcy5mbGlwWSA9IGZhbHNlOwogICAgICB0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwogICAgfQogIH07CiAgQ29tcHJlc3NlZFRleHR1cmUucHJvdG90eXBlLmlzQ29tcHJlc3NlZFRleHR1cmUgPSB0cnVlOwogIHZhciBDYW52YXNUZXh0dXJlID0gY2xhc3MgZXh0ZW5kcyBUZXh0dXJlIHsKICAgIGNvbnN0cnVjdG9yKGNhbnZhcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5KSB7CiAgICAgIHN1cGVyKGNhbnZhcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5KTsKICAgICAgdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICB9CiAgfTsKICBDYW52YXNUZXh0dXJlLnByb3RvdHlwZS5pc0NhbnZhc1RleHR1cmUgPSB0cnVlOwogIHZhciBEZXB0aFRleHR1cmUgPSBjbGFzcyBleHRlbmRzIFRleHR1cmUgewogICAgY29uc3RydWN0b3Iod2lkdGgsIGhlaWdodCwgdHlwZSwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgYW5pc290cm9weSwgZm9ybWF0KSB7CiAgICAgIGZvcm1hdCA9IGZvcm1hdCAhPT0gdm9pZCAwID8gZm9ybWF0IDogRGVwdGhGb3JtYXQ7CiAgICAgIGlmIChmb3JtYXQgIT09IERlcHRoRm9ybWF0ICYmIGZvcm1hdCAhPT0gRGVwdGhTdGVuY2lsRm9ybWF0KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJEZXB0aFRleHR1cmUgZm9ybWF0IG11c3QgYmUgZWl0aGVyIFRIUkVFLkRlcHRoRm9ybWF0IG9yIFRIUkVFLkRlcHRoU3RlbmNpbEZvcm1hdCIpOwogICAgICB9CiAgICAgIGlmICh0eXBlID09PSB2b2lkIDAgJiYgZm9ybWF0ID09PSBEZXB0aEZvcm1hdCkKICAgICAgICB0eXBlID0gVW5zaWduZWRTaG9ydFR5cGU7CiAgICAgIGlmICh0eXBlID09PSB2b2lkIDAgJiYgZm9ybWF0ID09PSBEZXB0aFN0ZW5jaWxGb3JtYXQpCiAgICAgICAgdHlwZSA9IFVuc2lnbmVkSW50MjQ4VHlwZTsKICAgICAgc3VwZXIobnVsbCwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5KTsKICAgICAgdGhpcy5pbWFnZSA9IHsgd2lkdGgsIGhlaWdodCB9OwogICAgICB0aGlzLm1hZ0ZpbHRlciA9IG1hZ0ZpbHRlciAhPT0gdm9pZCAwID8gbWFnRmlsdGVyIDogTmVhcmVzdEZpbHRlcjsKICAgICAgdGhpcy5taW5GaWx0ZXIgPSBtaW5GaWx0ZXIgIT09IHZvaWQgMCA/IG1pbkZpbHRlciA6IE5lYXJlc3RGaWx0ZXI7CiAgICAgIHRoaXMuZmxpcFkgPSBmYWxzZTsKICAgICAgdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKICAgIH0KICB9OwogIERlcHRoVGV4dHVyZS5wcm90b3R5cGUuaXNEZXB0aFRleHR1cmUgPSB0cnVlOwogIHZhciBfdjAgPSBuZXcgVmVjdG9yMygpOwogIHZhciBfdjEkMSA9IG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9ub3JtYWwgPSBuZXcgVmVjdG9yMygpOwogIHZhciBfdHJpYW5nbGUgPSBuZXcgVHJpYW5nbGUoKTsKICB2YXIgQ3VydmUgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy50eXBlID0gIkN1cnZlIjsKICAgICAgdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnMgPSAyMDA7CiAgICB9CiAgICBnZXRQb2ludCgpIHsKICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5DdXJ2ZTogLmdldFBvaW50KCkgbm90IGltcGxlbWVudGVkLiIpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGdldFBvaW50QXQodSwgb3B0aW9uYWxUYXJnZXQpIHsKICAgICAgY29uc3QgdCA9IHRoaXMuZ2V0VXRvVG1hcHBpbmcodSk7CiAgICAgIHJldHVybiB0aGlzLmdldFBvaW50KHQsIG9wdGlvbmFsVGFyZ2V0KTsKICAgIH0KICAgIGdldFBvaW50cyhkaXZpc2lvbnMgPSA1KSB7CiAgICAgIGNvbnN0IHBvaW50cyA9IFtdOwogICAgICBmb3IgKGxldCBkID0gMDsgZCA8PSBkaXZpc2lvbnM7IGQrKykgewogICAgICAgIHBvaW50cy5wdXNoKHRoaXMuZ2V0UG9pbnQoZCAvIGRpdmlzaW9ucykpOwogICAgICB9CiAgICAgIHJldHVybiBwb2ludHM7CiAgICB9CiAgICBnZXRTcGFjZWRQb2ludHMoZGl2aXNpb25zID0gNSkgewogICAgICBjb25zdCBwb2ludHMgPSBbXTsKICAgICAgZm9yIChsZXQgZCA9IDA7IGQgPD0gZGl2aXNpb25zOyBkKyspIHsKICAgICAgICBwb2ludHMucHVzaCh0aGlzLmdldFBvaW50QXQoZCAvIGRpdmlzaW9ucykpOwogICAgICB9CiAgICAgIHJldHVybiBwb2ludHM7CiAgICB9CiAgICBnZXRMZW5ndGgoKSB7CiAgICAgIGNvbnN0IGxlbmd0aHMgPSB0aGlzLmdldExlbmd0aHMoKTsKICAgICAgcmV0dXJuIGxlbmd0aHNbbGVuZ3Rocy5sZW5ndGggLSAxXTsKICAgIH0KICAgIGdldExlbmd0aHMoZGl2aXNpb25zID0gdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnMpIHsKICAgICAgaWYgKHRoaXMuY2FjaGVBcmNMZW5ndGhzICYmIHRoaXMuY2FjaGVBcmNMZW5ndGhzLmxlbmd0aCA9PT0gZGl2aXNpb25zICsgMSAmJiAhdGhpcy5uZWVkc1VwZGF0ZSkgewogICAgICAgIHJldHVybiB0aGlzLmNhY2hlQXJjTGVuZ3RoczsKICAgICAgfQogICAgICB0aGlzLm5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICAgIGNvbnN0IGNhY2hlID0gW107CiAgICAgIGxldCBjdXJyZW50LCBsYXN0ID0gdGhpcy5nZXRQb2ludCgwKTsKICAgICAgbGV0IHN1bSA9IDA7CiAgICAgIGNhY2hlLnB1c2goMCk7CiAgICAgIGZvciAobGV0IHAgPSAxOyBwIDw9IGRpdmlzaW9uczsgcCsrKSB7CiAgICAgICAgY3VycmVudCA9IHRoaXMuZ2V0UG9pbnQocCAvIGRpdmlzaW9ucyk7CiAgICAgICAgc3VtICs9IGN1cnJlbnQuZGlzdGFuY2VUbyhsYXN0KTsKICAgICAgICBjYWNoZS5wdXNoKHN1bSk7CiAgICAgICAgbGFzdCA9IGN1cnJlbnQ7CiAgICAgIH0KICAgICAgdGhpcy5jYWNoZUFyY0xlbmd0aHMgPSBjYWNoZTsKICAgICAgcmV0dXJuIGNhY2hlOwogICAgfQogICAgdXBkYXRlQXJjTGVuZ3RocygpIHsKICAgICAgdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuZ2V0TGVuZ3RocygpOwogICAgfQogICAgZ2V0VXRvVG1hcHBpbmcodSwgZGlzdGFuY2UpIHsKICAgICAgY29uc3QgYXJjTGVuZ3RocyA9IHRoaXMuZ2V0TGVuZ3RocygpOwogICAgICBsZXQgaSA9IDA7CiAgICAgIGNvbnN0IGlsID0gYXJjTGVuZ3Rocy5sZW5ndGg7CiAgICAgIGxldCB0YXJnZXRBcmNMZW5ndGg7CiAgICAgIGlmIChkaXN0YW5jZSkgewogICAgICAgIHRhcmdldEFyY0xlbmd0aCA9IGRpc3RhbmNlOwogICAgICB9IGVsc2UgewogICAgICAgIHRhcmdldEFyY0xlbmd0aCA9IHUgKiBhcmNMZW5ndGhzW2lsIC0gMV07CiAgICAgIH0KICAgICAgbGV0IGxvdyA9IDAsIGhpZ2ggPSBpbCAtIDEsIGNvbXBhcmlzb247CiAgICAgIHdoaWxlIChsb3cgPD0gaGlnaCkgewogICAgICAgIGkgPSBNYXRoLmZsb29yKGxvdyArIChoaWdoIC0gbG93KSAvIDIpOwogICAgICAgIGNvbXBhcmlzb24gPSBhcmNMZW5ndGhzW2ldIC0gdGFyZ2V0QXJjTGVuZ3RoOwogICAgICAgIGlmIChjb21wYXJpc29uIDwgMCkgewogICAgICAgICAgbG93ID0gaSArIDE7CiAgICAgICAgfSBlbHNlIGlmIChjb21wYXJpc29uID4gMCkgewogICAgICAgICAgaGlnaCA9IGkgLSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoaWdoID0gaTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpID0gaGlnaDsKICAgICAgaWYgKGFyY0xlbmd0aHNbaV0gPT09IHRhcmdldEFyY0xlbmd0aCkgewogICAgICAgIHJldHVybiBpIC8gKGlsIC0gMSk7CiAgICAgIH0KICAgICAgY29uc3QgbGVuZ3RoQmVmb3JlID0gYXJjTGVuZ3Roc1tpXTsKICAgICAgY29uc3QgbGVuZ3RoQWZ0ZXIgPSBhcmNMZW5ndGhzW2kgKyAxXTsKICAgICAgY29uc3Qgc2VnbWVudExlbmd0aCA9IGxlbmd0aEFmdGVyIC0gbGVuZ3RoQmVmb3JlOwogICAgICBjb25zdCBzZWdtZW50RnJhY3Rpb24gPSAodGFyZ2V0QXJjTGVuZ3RoIC0gbGVuZ3RoQmVmb3JlKSAvIHNlZ21lbnRMZW5ndGg7CiAgICAgIGNvbnN0IHQgPSAoaSArIHNlZ21lbnRGcmFjdGlvbikgLyAoaWwgLSAxKTsKICAgICAgcmV0dXJuIHQ7CiAgICB9CiAgICBnZXRUYW5nZW50KHQsIG9wdGlvbmFsVGFyZ2V0KSB7CiAgICAgIGNvbnN0IGRlbHRhID0gMWUtNDsKICAgICAgbGV0IHQxID0gdCAtIGRlbHRhOwogICAgICBsZXQgdDIgPSB0ICsgZGVsdGE7CiAgICAgIGlmICh0MSA8IDApCiAgICAgICAgdDEgPSAwOwogICAgICBpZiAodDIgPiAxKQogICAgICAgIHQyID0gMTsKICAgICAgY29uc3QgcHQxID0gdGhpcy5nZXRQb2ludCh0MSk7CiAgICAgIGNvbnN0IHB0MiA9IHRoaXMuZ2V0UG9pbnQodDIpOwogICAgICBjb25zdCB0YW5nZW50ID0gb3B0aW9uYWxUYXJnZXQgfHwgKHB0MS5pc1ZlY3RvcjIgPyBuZXcgVmVjdG9yMigpIDogbmV3IFZlY3RvcjMoKSk7CiAgICAgIHRhbmdlbnQuY29weShwdDIpLnN1YihwdDEpLm5vcm1hbGl6ZSgpOwogICAgICByZXR1cm4gdGFuZ2VudDsKICAgIH0KICAgIGdldFRhbmdlbnRBdCh1LCBvcHRpb25hbFRhcmdldCkgewogICAgICBjb25zdCB0ID0gdGhpcy5nZXRVdG9UbWFwcGluZyh1KTsKICAgICAgcmV0dXJuIHRoaXMuZ2V0VGFuZ2VudCh0LCBvcHRpb25hbFRhcmdldCk7CiAgICB9CiAgICBjb21wdXRlRnJlbmV0RnJhbWVzKHNlZ21lbnRzLCBjbG9zZWQpIHsKICAgICAgY29uc3Qgbm9ybWFsMiA9IG5ldyBWZWN0b3IzKCk7CiAgICAgIGNvbnN0IHRhbmdlbnRzID0gW107CiAgICAgIGNvbnN0IG5vcm1hbHMgPSBbXTsKICAgICAgY29uc3QgYmlub3JtYWxzID0gW107CiAgICAgIGNvbnN0IHZlYyA9IG5ldyBWZWN0b3IzKCk7CiAgICAgIGNvbnN0IG1hdCA9IG5ldyBNYXRyaXg0KCk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHNlZ21lbnRzOyBpKyspIHsKICAgICAgICBjb25zdCB1ID0gaSAvIHNlZ21lbnRzOwogICAgICAgIHRhbmdlbnRzW2ldID0gdGhpcy5nZXRUYW5nZW50QXQodSwgbmV3IFZlY3RvcjMoKSk7CiAgICAgICAgdGFuZ2VudHNbaV0ubm9ybWFsaXplKCk7CiAgICAgIH0KICAgICAgbm9ybWFsc1swXSA9IG5ldyBWZWN0b3IzKCk7CiAgICAgIGJpbm9ybWFsc1swXSA9IG5ldyBWZWN0b3IzKCk7CiAgICAgIGxldCBtaW4gPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBjb25zdCB0eCA9IE1hdGguYWJzKHRhbmdlbnRzWzBdLngpOwogICAgICBjb25zdCB0eSA9IE1hdGguYWJzKHRhbmdlbnRzWzBdLnkpOwogICAgICBjb25zdCB0eiA9IE1hdGguYWJzKHRhbmdlbnRzWzBdLnopOwogICAgICBpZiAodHggPD0gbWluKSB7CiAgICAgICAgbWluID0gdHg7CiAgICAgICAgbm9ybWFsMi5zZXQoMSwgMCwgMCk7CiAgICAgIH0KICAgICAgaWYgKHR5IDw9IG1pbikgewogICAgICAgIG1pbiA9IHR5OwogICAgICAgIG5vcm1hbDIuc2V0KDAsIDEsIDApOwogICAgICB9CiAgICAgIGlmICh0eiA8PSBtaW4pIHsKICAgICAgICBub3JtYWwyLnNldCgwLCAwLCAxKTsKICAgICAgfQogICAgICB2ZWMuY3Jvc3NWZWN0b3JzKHRhbmdlbnRzWzBdLCBub3JtYWwyKS5ub3JtYWxpemUoKTsKICAgICAgbm9ybWFsc1swXS5jcm9zc1ZlY3RvcnModGFuZ2VudHNbMF0sIHZlYyk7CiAgICAgIGJpbm9ybWFsc1swXS5jcm9zc1ZlY3RvcnModGFuZ2VudHNbMF0sIG5vcm1hbHNbMF0pOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBzZWdtZW50czsgaSsrKSB7CiAgICAgICAgbm9ybWFsc1tpXSA9IG5vcm1hbHNbaSAtIDFdLmNsb25lKCk7CiAgICAgICAgYmlub3JtYWxzW2ldID0gYmlub3JtYWxzW2kgLSAxXS5jbG9uZSgpOwogICAgICAgIHZlYy5jcm9zc1ZlY3RvcnModGFuZ2VudHNbaSAtIDFdLCB0YW5nZW50c1tpXSk7CiAgICAgICAgaWYgKHZlYy5sZW5ndGgoKSA+IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICB2ZWMubm9ybWFsaXplKCk7CiAgICAgICAgICBjb25zdCB0aGV0YSA9IE1hdGguYWNvcyhjbGFtcCh0YW5nZW50c1tpIC0gMV0uZG90KHRhbmdlbnRzW2ldKSwgLTEsIDEpKTsKICAgICAgICAgIG5vcm1hbHNbaV0uYXBwbHlNYXRyaXg0KG1hdC5tYWtlUm90YXRpb25BeGlzKHZlYywgdGhldGEpKTsKICAgICAgICB9CiAgICAgICAgYmlub3JtYWxzW2ldLmNyb3NzVmVjdG9ycyh0YW5nZW50c1tpXSwgbm9ybWFsc1tpXSk7CiAgICAgIH0KICAgICAgaWYgKGNsb3NlZCA9PT0gdHJ1ZSkgewogICAgICAgIGxldCB0aGV0YSA9IE1hdGguYWNvcyhjbGFtcChub3JtYWxzWzBdLmRvdChub3JtYWxzW3NlZ21lbnRzXSksIC0xLCAxKSk7CiAgICAgICAgdGhldGEgLz0gc2VnbWVudHM7CiAgICAgICAgaWYgKHRhbmdlbnRzWzBdLmRvdCh2ZWMuY3Jvc3NWZWN0b3JzKG5vcm1hbHNbMF0sIG5vcm1hbHNbc2VnbWVudHNdKSkgPiAwKSB7CiAgICAgICAgICB0aGV0YSA9IC10aGV0YTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gc2VnbWVudHM7IGkrKykgewogICAgICAgICAgbm9ybWFsc1tpXS5hcHBseU1hdHJpeDQobWF0Lm1ha2VSb3RhdGlvbkF4aXModGFuZ2VudHNbaV0sIHRoZXRhICogaSkpOwogICAgICAgICAgYmlub3JtYWxzW2ldLmNyb3NzVmVjdG9ycyh0YW5nZW50c1tpXSwgbm9ybWFsc1tpXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgdGFuZ2VudHMsCiAgICAgICAgbm9ybWFscywKICAgICAgICBiaW5vcm1hbHMKICAgICAgfTsKICAgIH0KICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnMgPSBzb3VyY2UuYXJjTGVuZ3RoRGl2aXNpb25zOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICBtZXRhZGF0YTogewogICAgICAgICAgdmVyc2lvbjogNC41LAogICAgICAgICAgdHlwZTogIkN1cnZlIiwKICAgICAgICAgIGdlbmVyYXRvcjogIkN1cnZlLnRvSlNPTiIKICAgICAgICB9CiAgICAgIH07CiAgICAgIGRhdGEuYXJjTGVuZ3RoRGl2aXNpb25zID0gdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnM7CiAgICAgIGRhdGEudHlwZSA9IHRoaXMudHlwZTsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBmcm9tSlNPTihqc29uKSB7CiAgICAgIHRoaXMuYXJjTGVuZ3RoRGl2aXNpb25zID0ganNvbi5hcmNMZW5ndGhEaXZpc2lvbnM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgdmFyIEVsbGlwc2VDdXJ2ZSA9IGNsYXNzIGV4dGVuZHMgQ3VydmUgewogICAgY29uc3RydWN0b3IoYVggPSAwLCBhWSA9IDAsIHhSYWRpdXMgPSAxLCB5UmFkaXVzID0gMSwgYVN0YXJ0QW5nbGUgPSAwLCBhRW5kQW5nbGUgPSBNYXRoLlBJICogMiwgYUNsb2Nrd2lzZSA9IGZhbHNlLCBhUm90YXRpb24gPSAwKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJFbGxpcHNlQ3VydmUiOwogICAgICB0aGlzLmFYID0gYVg7CiAgICAgIHRoaXMuYVkgPSBhWTsKICAgICAgdGhpcy54UmFkaXVzID0geFJhZGl1czsKICAgICAgdGhpcy55UmFkaXVzID0geVJhZGl1czsKICAgICAgdGhpcy5hU3RhcnRBbmdsZSA9IGFTdGFydEFuZ2xlOwogICAgICB0aGlzLmFFbmRBbmdsZSA9IGFFbmRBbmdsZTsKICAgICAgdGhpcy5hQ2xvY2t3aXNlID0gYUNsb2Nrd2lzZTsKICAgICAgdGhpcy5hUm90YXRpb24gPSBhUm90YXRpb247CiAgICB9CiAgICBnZXRQb2ludCh0LCBvcHRpb25hbFRhcmdldCkgewogICAgICBjb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0IHx8IG5ldyBWZWN0b3IyKCk7CiAgICAgIGNvbnN0IHR3b1BpID0gTWF0aC5QSSAqIDI7CiAgICAgIGxldCBkZWx0YUFuZ2xlID0gdGhpcy5hRW5kQW5nbGUgLSB0aGlzLmFTdGFydEFuZ2xlOwogICAgICBjb25zdCBzYW1lUG9pbnRzID0gTWF0aC5hYnMoZGVsdGFBbmdsZSkgPCBOdW1iZXIuRVBTSUxPTjsKICAgICAgd2hpbGUgKGRlbHRhQW5nbGUgPCAwKQogICAgICAgIGRlbHRhQW5nbGUgKz0gdHdvUGk7CiAgICAgIHdoaWxlIChkZWx0YUFuZ2xlID4gdHdvUGkpCiAgICAgICAgZGVsdGFBbmdsZSAtPSB0d29QaTsKICAgICAgaWYgKGRlbHRhQW5nbGUgPCBOdW1iZXIuRVBTSUxPTikgewogICAgICAgIGlmIChzYW1lUG9pbnRzKSB7CiAgICAgICAgICBkZWx0YUFuZ2xlID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsdGFBbmdsZSA9IHR3b1BpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGhpcy5hQ2xvY2t3aXNlID09PSB0cnVlICYmICFzYW1lUG9pbnRzKSB7CiAgICAgICAgaWYgKGRlbHRhQW5nbGUgPT09IHR3b1BpKSB7CiAgICAgICAgICBkZWx0YUFuZ2xlID0gLXR3b1BpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkZWx0YUFuZ2xlID0gZGVsdGFBbmdsZSAtIHR3b1BpOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBhbmdsZSA9IHRoaXMuYVN0YXJ0QW5nbGUgKyB0ICogZGVsdGFBbmdsZTsKICAgICAgbGV0IHggPSB0aGlzLmFYICsgdGhpcy54UmFkaXVzICogTWF0aC5jb3MoYW5nbGUpOwogICAgICBsZXQgeSA9IHRoaXMuYVkgKyB0aGlzLnlSYWRpdXMgKiBNYXRoLnNpbihhbmdsZSk7CiAgICAgIGlmICh0aGlzLmFSb3RhdGlvbiAhPT0gMCkgewogICAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zKHRoaXMuYVJvdGF0aW9uKTsKICAgICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbih0aGlzLmFSb3RhdGlvbik7CiAgICAgICAgY29uc3QgdHggPSB4IC0gdGhpcy5hWDsKICAgICAgICBjb25zdCB0eSA9IHkgLSB0aGlzLmFZOwogICAgICAgIHggPSB0eCAqIGNvcyAtIHR5ICogc2luICsgdGhpcy5hWDsKICAgICAgICB5ID0gdHggKiBzaW4gKyB0eSAqIGNvcyArIHRoaXMuYVk7CiAgICAgIH0KICAgICAgcmV0dXJuIHBvaW50LnNldCh4LCB5KTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5hWCA9IHNvdXJjZS5hWDsKICAgICAgdGhpcy5hWSA9IHNvdXJjZS5hWTsKICAgICAgdGhpcy54UmFkaXVzID0gc291cmNlLnhSYWRpdXM7CiAgICAgIHRoaXMueVJhZGl1cyA9IHNvdXJjZS55UmFkaXVzOwogICAgICB0aGlzLmFTdGFydEFuZ2xlID0gc291cmNlLmFTdGFydEFuZ2xlOwogICAgICB0aGlzLmFFbmRBbmdsZSA9IHNvdXJjZS5hRW5kQW5nbGU7CiAgICAgIHRoaXMuYUNsb2Nrd2lzZSA9IHNvdXJjZS5hQ2xvY2t3aXNlOwogICAgICB0aGlzLmFSb3RhdGlvbiA9IHNvdXJjZS5hUm90YXRpb247CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKCkgewogICAgICBjb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CiAgICAgIGRhdGEuYVggPSB0aGlzLmFYOwogICAgICBkYXRhLmFZID0gdGhpcy5hWTsKICAgICAgZGF0YS54UmFkaXVzID0gdGhpcy54UmFkaXVzOwogICAgICBkYXRhLnlSYWRpdXMgPSB0aGlzLnlSYWRpdXM7CiAgICAgIGRhdGEuYVN0YXJ0QW5nbGUgPSB0aGlzLmFTdGFydEFuZ2xlOwogICAgICBkYXRhLmFFbmRBbmdsZSA9IHRoaXMuYUVuZEFuZ2xlOwogICAgICBkYXRhLmFDbG9ja3dpc2UgPSB0aGlzLmFDbG9ja3dpc2U7CiAgICAgIGRhdGEuYVJvdGF0aW9uID0gdGhpcy5hUm90YXRpb247CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgZnJvbUpTT04oanNvbikgewogICAgICBzdXBlci5mcm9tSlNPTihqc29uKTsKICAgICAgdGhpcy5hWCA9IGpzb24uYVg7CiAgICAgIHRoaXMuYVkgPSBqc29uLmFZOwogICAgICB0aGlzLnhSYWRpdXMgPSBqc29uLnhSYWRpdXM7CiAgICAgIHRoaXMueVJhZGl1cyA9IGpzb24ueVJhZGl1czsKICAgICAgdGhpcy5hU3RhcnRBbmdsZSA9IGpzb24uYVN0YXJ0QW5nbGU7CiAgICAgIHRoaXMuYUVuZEFuZ2xlID0ganNvbi5hRW5kQW5nbGU7CiAgICAgIHRoaXMuYUNsb2Nrd2lzZSA9IGpzb24uYUNsb2Nrd2lzZTsKICAgICAgdGhpcy5hUm90YXRpb24gPSBqc29uLmFSb3RhdGlvbjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBFbGxpcHNlQ3VydmUucHJvdG90eXBlLmlzRWxsaXBzZUN1cnZlID0gdHJ1ZTsKICB2YXIgQXJjQ3VydmUgPSBjbGFzcyBleHRlbmRzIEVsbGlwc2VDdXJ2ZSB7CiAgICBjb25zdHJ1Y3RvcihhWCwgYVksIGFSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UpIHsKICAgICAgc3VwZXIoYVgsIGFZLCBhUmFkaXVzLCBhUmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlKTsKICAgICAgdGhpcy50eXBlID0gIkFyY0N1cnZlIjsKICAgIH0KICB9OwogIEFyY0N1cnZlLnByb3RvdHlwZS5pc0FyY0N1cnZlID0gdHJ1ZTsKICBmdW5jdGlvbiBDdWJpY1BvbHkoKSB7CiAgICBsZXQgYzAgPSAwLCBjMSA9IDAsIGMyID0gMCwgYzMgPSAwOwogICAgZnVuY3Rpb24gaW5pdCh4MCwgeDEsIHQwLCB0MSkgewogICAgICBjMCA9IHgwOwogICAgICBjMSA9IHQwOwogICAgICBjMiA9IC0zICogeDAgKyAzICogeDEgLSAyICogdDAgLSB0MTsKICAgICAgYzMgPSAyICogeDAgLSAyICogeDEgKyB0MCArIHQxOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgaW5pdENhdG11bGxSb206IGZ1bmN0aW9uKHgwLCB4MSwgeDIsIHgzLCB0ZW5zaW9uKSB7CiAgICAgICAgaW5pdCh4MSwgeDIsIHRlbnNpb24gKiAoeDIgLSB4MCksIHRlbnNpb24gKiAoeDMgLSB4MSkpOwogICAgICB9LAogICAgICBpbml0Tm9udW5pZm9ybUNhdG11bGxSb206IGZ1bmN0aW9uKHgwLCB4MSwgeDIsIHgzLCBkdDAsIGR0MSwgZHQyKSB7CiAgICAgICAgbGV0IHQxID0gKHgxIC0geDApIC8gZHQwIC0gKHgyIC0geDApIC8gKGR0MCArIGR0MSkgKyAoeDIgLSB4MSkgLyBkdDE7CiAgICAgICAgbGV0IHQyID0gKHgyIC0geDEpIC8gZHQxIC0gKHgzIC0geDEpIC8gKGR0MSArIGR0MikgKyAoeDMgLSB4MikgLyBkdDI7CiAgICAgICAgdDEgKj0gZHQxOwogICAgICAgIHQyICo9IGR0MTsKICAgICAgICBpbml0KHgxLCB4MiwgdDEsIHQyKTsKICAgICAgfSwKICAgICAgY2FsYzogZnVuY3Rpb24odCkgewogICAgICAgIGNvbnN0IHQyID0gdCAqIHQ7CiAgICAgICAgY29uc3QgdDMgPSB0MiAqIHQ7CiAgICAgICAgcmV0dXJuIGMwICsgYzEgKiB0ICsgYzIgKiB0MiArIGMzICogdDM7CiAgICAgIH0KICAgIH07CiAgfQogIHZhciB0bXAgPSBuZXcgVmVjdG9yMygpOwogIHZhciBweCA9IG5ldyBDdWJpY1BvbHkoKTsKICB2YXIgcHkgPSBuZXcgQ3ViaWNQb2x5KCk7CiAgdmFyIHB6ID0gbmV3IEN1YmljUG9seSgpOwogIHZhciBDYXRtdWxsUm9tQ3VydmUzID0gY2xhc3MgZXh0ZW5kcyBDdXJ2ZSB7CiAgICBjb25zdHJ1Y3Rvcihwb2ludHMgPSBbXSwgY2xvc2VkID0gZmFsc2UsIGN1cnZlVHlwZSA9ICJjZW50cmlwZXRhbCIsIHRlbnNpb24gPSAwLjUpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIkNhdG11bGxSb21DdXJ2ZTMiOwogICAgICB0aGlzLnBvaW50cyA9IHBvaW50czsKICAgICAgdGhpcy5jbG9zZWQgPSBjbG9zZWQ7CiAgICAgIHRoaXMuY3VydmVUeXBlID0gY3VydmVUeXBlOwogICAgICB0aGlzLnRlbnNpb24gPSB0ZW5zaW9uOwogICAgfQogICAgZ2V0UG9pbnQodCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMygpKSB7CiAgICAgIGNvbnN0IHBvaW50ID0gb3B0aW9uYWxUYXJnZXQ7CiAgICAgIGNvbnN0IHBvaW50cyA9IHRoaXMucG9pbnRzOwogICAgICBjb25zdCBsID0gcG9pbnRzLmxlbmd0aDsKICAgICAgY29uc3QgcCA9IChsIC0gKHRoaXMuY2xvc2VkID8gMCA6IDEpKSAqIHQ7CiAgICAgIGxldCBpbnRQb2ludCA9IE1hdGguZmxvb3IocCk7CiAgICAgIGxldCB3ZWlnaHQgPSBwIC0gaW50UG9pbnQ7CiAgICAgIGlmICh0aGlzLmNsb3NlZCkgewogICAgICAgIGludFBvaW50ICs9IGludFBvaW50ID4gMCA/IDAgOiAoTWF0aC5mbG9vcihNYXRoLmFicyhpbnRQb2ludCkgLyBsKSArIDEpICogbDsKICAgICAgfSBlbHNlIGlmICh3ZWlnaHQgPT09IDAgJiYgaW50UG9pbnQgPT09IGwgLSAxKSB7CiAgICAgICAgaW50UG9pbnQgPSBsIC0gMjsKICAgICAgICB3ZWlnaHQgPSAxOwogICAgICB9CiAgICAgIGxldCBwMCwgcDM7CiAgICAgIGlmICh0aGlzLmNsb3NlZCB8fCBpbnRQb2ludCA+IDApIHsKICAgICAgICBwMCA9IHBvaW50c1soaW50UG9pbnQgLSAxKSAlIGxdOwogICAgICB9IGVsc2UgewogICAgICAgIHRtcC5zdWJWZWN0b3JzKHBvaW50c1swXSwgcG9pbnRzWzFdKS5hZGQocG9pbnRzWzBdKTsKICAgICAgICBwMCA9IHRtcDsKICAgICAgfQogICAgICBjb25zdCBwMSA9IHBvaW50c1tpbnRQb2ludCAlIGxdOwogICAgICBjb25zdCBwMiA9IHBvaW50c1soaW50UG9pbnQgKyAxKSAlIGxdOwogICAgICBpZiAodGhpcy5jbG9zZWQgfHwgaW50UG9pbnQgKyAyIDwgbCkgewogICAgICAgIHAzID0gcG9pbnRzWyhpbnRQb2ludCArIDIpICUgbF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG1wLnN1YlZlY3RvcnMocG9pbnRzW2wgLSAxXSwgcG9pbnRzW2wgLSAyXSkuYWRkKHBvaW50c1tsIC0gMV0pOwogICAgICAgIHAzID0gdG1wOwogICAgICB9CiAgICAgIGlmICh0aGlzLmN1cnZlVHlwZSA9PT0gImNlbnRyaXBldGFsIiB8fCB0aGlzLmN1cnZlVHlwZSA9PT0gImNob3JkYWwiKSB7CiAgICAgICAgY29uc3QgcG93ID0gdGhpcy5jdXJ2ZVR5cGUgPT09ICJjaG9yZGFsIiA/IDAuNSA6IDAuMjU7CiAgICAgICAgbGV0IGR0MCA9IE1hdGgucG93KHAwLmRpc3RhbmNlVG9TcXVhcmVkKHAxKSwgcG93KTsKICAgICAgICBsZXQgZHQxID0gTWF0aC5wb3cocDEuZGlzdGFuY2VUb1NxdWFyZWQocDIpLCBwb3cpOwogICAgICAgIGxldCBkdDIgPSBNYXRoLnBvdyhwMi5kaXN0YW5jZVRvU3F1YXJlZChwMyksIHBvdyk7CiAgICAgICAgaWYgKGR0MSA8IDFlLTQpCiAgICAgICAgICBkdDEgPSAxOwogICAgICAgIGlmIChkdDAgPCAxZS00KQogICAgICAgICAgZHQwID0gZHQxOwogICAgICAgIGlmIChkdDIgPCAxZS00KQogICAgICAgICAgZHQyID0gZHQxOwogICAgICAgIHB4LmluaXROb251bmlmb3JtQ2F0bXVsbFJvbShwMC54LCBwMS54LCBwMi54LCBwMy54LCBkdDAsIGR0MSwgZHQyKTsKICAgICAgICBweS5pbml0Tm9udW5pZm9ybUNhdG11bGxSb20ocDAueSwgcDEueSwgcDIueSwgcDMueSwgZHQwLCBkdDEsIGR0Mik7CiAgICAgICAgcHouaW5pdE5vbnVuaWZvcm1DYXRtdWxsUm9tKHAwLnosIHAxLnosIHAyLnosIHAzLnosIGR0MCwgZHQxLCBkdDIpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuY3VydmVUeXBlID09PSAiY2F0bXVsbHJvbSIpIHsKICAgICAgICBweC5pbml0Q2F0bXVsbFJvbShwMC54LCBwMS54LCBwMi54LCBwMy54LCB0aGlzLnRlbnNpb24pOwogICAgICAgIHB5LmluaXRDYXRtdWxsUm9tKHAwLnksIHAxLnksIHAyLnksIHAzLnksIHRoaXMudGVuc2lvbik7CiAgICAgICAgcHouaW5pdENhdG11bGxSb20ocDAueiwgcDEueiwgcDIueiwgcDMueiwgdGhpcy50ZW5zaW9uKTsKICAgICAgfQogICAgICBwb2ludC5zZXQocHguY2FsYyh3ZWlnaHQpLCBweS5jYWxjKHdlaWdodCksIHB6LmNhbGMod2VpZ2h0KSk7CiAgICAgIHJldHVybiBwb2ludDsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5wb2ludHMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzb3VyY2UucG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHBvaW50ID0gc291cmNlLnBvaW50c1tpXTsKICAgICAgICB0aGlzLnBvaW50cy5wdXNoKHBvaW50LmNsb25lKCkpOwogICAgICB9CiAgICAgIHRoaXMuY2xvc2VkID0gc291cmNlLmNsb3NlZDsKICAgICAgdGhpcy5jdXJ2ZVR5cGUgPSBzb3VyY2UuY3VydmVUeXBlOwogICAgICB0aGlzLnRlbnNpb24gPSBzb3VyY2UudGVuc2lvbjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgIGNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKICAgICAgZGF0YS5wb2ludHMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCBwb2ludCA9IHRoaXMucG9pbnRzW2ldOwogICAgICAgIGRhdGEucG9pbnRzLnB1c2gocG9pbnQudG9BcnJheSgpKTsKICAgICAgfQogICAgICBkYXRhLmNsb3NlZCA9IHRoaXMuY2xvc2VkOwogICAgICBkYXRhLmN1cnZlVHlwZSA9IHRoaXMuY3VydmVUeXBlOwogICAgICBkYXRhLnRlbnNpb24gPSB0aGlzLnRlbnNpb247CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgZnJvbUpTT04oanNvbikgewogICAgICBzdXBlci5mcm9tSlNPTihqc29uKTsKICAgICAgdGhpcy5wb2ludHMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBqc29uLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCBwb2ludCA9IGpzb24ucG9pbnRzW2ldOwogICAgICAgIHRoaXMucG9pbnRzLnB1c2gobmV3IFZlY3RvcjMoKS5mcm9tQXJyYXkocG9pbnQpKTsKICAgICAgfQogICAgICB0aGlzLmNsb3NlZCA9IGpzb24uY2xvc2VkOwogICAgICB0aGlzLmN1cnZlVHlwZSA9IGpzb24uY3VydmVUeXBlOwogICAgICB0aGlzLnRlbnNpb24gPSBqc29uLnRlbnNpb247CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgQ2F0bXVsbFJvbUN1cnZlMy5wcm90b3R5cGUuaXNDYXRtdWxsUm9tQ3VydmUzID0gdHJ1ZTsKICBmdW5jdGlvbiBDYXRtdWxsUm9tKHQsIHAwLCBwMSwgcDIsIHAzKSB7CiAgICBjb25zdCB2MCA9IChwMiAtIHAwKSAqIDAuNTsKICAgIGNvbnN0IHYxID0gKHAzIC0gcDEpICogMC41OwogICAgY29uc3QgdDIgPSB0ICogdDsKICAgIGNvbnN0IHQzID0gdCAqIHQyOwogICAgcmV0dXJuICgyICogcDEgLSAyICogcDIgKyB2MCArIHYxKSAqIHQzICsgKC0zICogcDEgKyAzICogcDIgLSAyICogdjAgLSB2MSkgKiB0MiArIHYwICogdCArIHAxOwogIH0KICBmdW5jdGlvbiBRdWFkcmF0aWNCZXppZXJQMCh0LCBwKSB7CiAgICBjb25zdCBrID0gMSAtIHQ7CiAgICByZXR1cm4gayAqIGsgKiBwOwogIH0KICBmdW5jdGlvbiBRdWFkcmF0aWNCZXppZXJQMSh0LCBwKSB7CiAgICByZXR1cm4gMiAqICgxIC0gdCkgKiB0ICogcDsKICB9CiAgZnVuY3Rpb24gUXVhZHJhdGljQmV6aWVyUDIodCwgcCkgewogICAgcmV0dXJuIHQgKiB0ICogcDsKICB9CiAgZnVuY3Rpb24gUXVhZHJhdGljQmV6aWVyKHQsIHAwLCBwMSwgcDIpIHsKICAgIHJldHVybiBRdWFkcmF0aWNCZXppZXJQMCh0LCBwMCkgKyBRdWFkcmF0aWNCZXppZXJQMSh0LCBwMSkgKyBRdWFkcmF0aWNCZXppZXJQMih0LCBwMik7CiAgfQogIGZ1bmN0aW9uIEN1YmljQmV6aWVyUDAodCwgcCkgewogICAgY29uc3QgayA9IDEgLSB0OwogICAgcmV0dXJuIGsgKiBrICogayAqIHA7CiAgfQogIGZ1bmN0aW9uIEN1YmljQmV6aWVyUDEodCwgcCkgewogICAgY29uc3QgayA9IDEgLSB0OwogICAgcmV0dXJuIDMgKiBrICogayAqIHQgKiBwOwogIH0KICBmdW5jdGlvbiBDdWJpY0JlemllclAyKHQsIHApIHsKICAgIHJldHVybiAzICogKDEgLSB0KSAqIHQgKiB0ICogcDsKICB9CiAgZnVuY3Rpb24gQ3ViaWNCZXppZXJQMyh0LCBwKSB7CiAgICByZXR1cm4gdCAqIHQgKiB0ICogcDsKICB9CiAgZnVuY3Rpb24gQ3ViaWNCZXppZXIodCwgcDAsIHAxLCBwMiwgcDMpIHsKICAgIHJldHVybiBDdWJpY0JlemllclAwKHQsIHAwKSArIEN1YmljQmV6aWVyUDEodCwgcDEpICsgQ3ViaWNCZXppZXJQMih0LCBwMikgKyBDdWJpY0JlemllclAzKHQsIHAzKTsKICB9CiAgdmFyIEN1YmljQmV6aWVyQ3VydmUgPSBjbGFzcyBleHRlbmRzIEN1cnZlIHsKICAgIGNvbnN0cnVjdG9yKHYwID0gbmV3IFZlY3RvcjIoKSwgdjEgPSBuZXcgVmVjdG9yMigpLCB2MiA9IG5ldyBWZWN0b3IyKCksIHYzID0gbmV3IFZlY3RvcjIoKSkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiQ3ViaWNCZXppZXJDdXJ2ZSI7CiAgICAgIHRoaXMudjAgPSB2MDsKICAgICAgdGhpcy52MSA9IHYxOwogICAgICB0aGlzLnYyID0gdjI7CiAgICAgIHRoaXMudjMgPSB2MzsKICAgIH0KICAgIGdldFBvaW50KHQsIG9wdGlvbmFsVGFyZ2V0ID0gbmV3IFZlY3RvcjIoKSkgewogICAgICBjb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwogICAgICBjb25zdCB2MCA9IHRoaXMudjAsIHYxID0gdGhpcy52MSwgdjIgPSB0aGlzLnYyLCB2MyA9IHRoaXMudjM7CiAgICAgIHBvaW50LnNldChDdWJpY0Jlemllcih0LCB2MC54LCB2MS54LCB2Mi54LCB2My54KSwgQ3ViaWNCZXppZXIodCwgdjAueSwgdjEueSwgdjIueSwgdjMueSkpOwogICAgICByZXR1cm4gcG9pbnQ7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMudjAuY29weShzb3VyY2UudjApOwogICAgICB0aGlzLnYxLmNvcHkoc291cmNlLnYxKTsKICAgICAgdGhpcy52Mi5jb3B5KHNvdXJjZS52Mik7CiAgICAgIHRoaXMudjMuY29weShzb3VyY2UudjMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwogICAgICBkYXRhLnYwID0gdGhpcy52MC50b0FycmF5KCk7CiAgICAgIGRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKICAgICAgZGF0YS52MiA9IHRoaXMudjIudG9BcnJheSgpOwogICAgICBkYXRhLnYzID0gdGhpcy52My50b0FycmF5KCk7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgZnJvbUpTT04oanNvbikgewogICAgICBzdXBlci5mcm9tSlNPTihqc29uKTsKICAgICAgdGhpcy52MC5mcm9tQXJyYXkoanNvbi52MCk7CiAgICAgIHRoaXMudjEuZnJvbUFycmF5KGpzb24udjEpOwogICAgICB0aGlzLnYyLmZyb21BcnJheShqc29uLnYyKTsKICAgICAgdGhpcy52My5mcm9tQXJyYXkoanNvbi52Myk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgQ3ViaWNCZXppZXJDdXJ2ZS5wcm90b3R5cGUuaXNDdWJpY0JlemllckN1cnZlID0gdHJ1ZTsKICB2YXIgQ3ViaWNCZXppZXJDdXJ2ZTMgPSBjbGFzcyBleHRlbmRzIEN1cnZlIHsKICAgIGNvbnN0cnVjdG9yKHYwID0gbmV3IFZlY3RvcjMoKSwgdjEgPSBuZXcgVmVjdG9yMygpLCB2MiA9IG5ldyBWZWN0b3IzKCksIHYzID0gbmV3IFZlY3RvcjMoKSkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiQ3ViaWNCZXppZXJDdXJ2ZTMiOwogICAgICB0aGlzLnYwID0gdjA7CiAgICAgIHRoaXMudjEgPSB2MTsKICAgICAgdGhpcy52MiA9IHYyOwogICAgICB0aGlzLnYzID0gdjM7CiAgICB9CiAgICBnZXRQb2ludCh0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IzKCkpIHsKICAgICAgY29uc3QgcG9pbnQgPSBvcHRpb25hbFRhcmdldDsKICAgICAgY29uc3QgdjAgPSB0aGlzLnYwLCB2MSA9IHRoaXMudjEsIHYyID0gdGhpcy52MiwgdjMgPSB0aGlzLnYzOwogICAgICBwb2ludC5zZXQoQ3ViaWNCZXppZXIodCwgdjAueCwgdjEueCwgdjIueCwgdjMueCksIEN1YmljQmV6aWVyKHQsIHYwLnksIHYxLnksIHYyLnksIHYzLnkpLCBDdWJpY0Jlemllcih0LCB2MC56LCB2MS56LCB2Mi56LCB2My56KSk7CiAgICAgIHJldHVybiBwb2ludDsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy52MC5jb3B5KHNvdXJjZS52MCk7CiAgICAgIHRoaXMudjEuY29weShzb3VyY2UudjEpOwogICAgICB0aGlzLnYyLmNvcHkoc291cmNlLnYyKTsKICAgICAgdGhpcy52My5jb3B5KHNvdXJjZS52Myk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKCkgewogICAgICBjb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CiAgICAgIGRhdGEudjAgPSB0aGlzLnYwLnRvQXJyYXkoKTsKICAgICAgZGF0YS52MSA9IHRoaXMudjEudG9BcnJheSgpOwogICAgICBkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CiAgICAgIGRhdGEudjMgPSB0aGlzLnYzLnRvQXJyYXkoKTsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBmcm9tSlNPTihqc29uKSB7CiAgICAgIHN1cGVyLmZyb21KU09OKGpzb24pOwogICAgICB0aGlzLnYwLmZyb21BcnJheShqc29uLnYwKTsKICAgICAgdGhpcy52MS5mcm9tQXJyYXkoanNvbi52MSk7CiAgICAgIHRoaXMudjIuZnJvbUFycmF5KGpzb24udjIpOwogICAgICB0aGlzLnYzLmZyb21BcnJheShqc29uLnYzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBDdWJpY0JlemllckN1cnZlMy5wcm90b3R5cGUuaXNDdWJpY0JlemllckN1cnZlMyA9IHRydWU7CiAgdmFyIExpbmVDdXJ2ZSA9IGNsYXNzIGV4dGVuZHMgQ3VydmUgewogICAgY29uc3RydWN0b3IodjEgPSBuZXcgVmVjdG9yMigpLCB2MiA9IG5ldyBWZWN0b3IyKCkpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIkxpbmVDdXJ2ZSI7CiAgICAgIHRoaXMudjEgPSB2MTsKICAgICAgdGhpcy52MiA9IHYyOwogICAgfQogICAgZ2V0UG9pbnQodCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMigpKSB7CiAgICAgIGNvbnN0IHBvaW50ID0gb3B0aW9uYWxUYXJnZXQ7CiAgICAgIGlmICh0ID09PSAxKSB7CiAgICAgICAgcG9pbnQuY29weSh0aGlzLnYyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwb2ludC5jb3B5KHRoaXMudjIpLnN1Yih0aGlzLnYxKTsKICAgICAgICBwb2ludC5tdWx0aXBseVNjYWxhcih0KS5hZGQodGhpcy52MSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHBvaW50OwogICAgfQogICAgZ2V0UG9pbnRBdCh1LCBvcHRpb25hbFRhcmdldCkgewogICAgICByZXR1cm4gdGhpcy5nZXRQb2ludCh1LCBvcHRpb25hbFRhcmdldCk7CiAgICB9CiAgICBnZXRUYW5nZW50KHQsIG9wdGlvbmFsVGFyZ2V0KSB7CiAgICAgIGNvbnN0IHRhbmdlbnQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVmVjdG9yMigpOwogICAgICB0YW5nZW50LmNvcHkodGhpcy52Mikuc3ViKHRoaXMudjEpLm5vcm1hbGl6ZSgpOwogICAgICByZXR1cm4gdGFuZ2VudDsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy52MS5jb3B5KHNvdXJjZS52MSk7CiAgICAgIHRoaXMudjIuY29weShzb3VyY2UudjIpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwogICAgICBkYXRhLnYxID0gdGhpcy52MS50b0FycmF5KCk7CiAgICAgIGRhdGEudjIgPSB0aGlzLnYyLnRvQXJyYXkoKTsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBmcm9tSlNPTihqc29uKSB7CiAgICAgIHN1cGVyLmZyb21KU09OKGpzb24pOwogICAgICB0aGlzLnYxLmZyb21BcnJheShqc29uLnYxKTsKICAgICAgdGhpcy52Mi5mcm9tQXJyYXkoanNvbi52Mik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgTGluZUN1cnZlLnByb3RvdHlwZS5pc0xpbmVDdXJ2ZSA9IHRydWU7CiAgdmFyIExpbmVDdXJ2ZTMgPSBjbGFzcyBleHRlbmRzIEN1cnZlIHsKICAgIGNvbnN0cnVjdG9yKHYxID0gbmV3IFZlY3RvcjMoKSwgdjIgPSBuZXcgVmVjdG9yMygpKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJMaW5lQ3VydmUzIjsKICAgICAgdGhpcy5pc0xpbmVDdXJ2ZTMgPSB0cnVlOwogICAgICB0aGlzLnYxID0gdjE7CiAgICAgIHRoaXMudjIgPSB2MjsKICAgIH0KICAgIGdldFBvaW50KHQsIG9wdGlvbmFsVGFyZ2V0ID0gbmV3IFZlY3RvcjMoKSkgewogICAgICBjb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwogICAgICBpZiAodCA9PT0gMSkgewogICAgICAgIHBvaW50LmNvcHkodGhpcy52Mik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcG9pbnQuY29weSh0aGlzLnYyKS5zdWIodGhpcy52MSk7CiAgICAgICAgcG9pbnQubXVsdGlwbHlTY2FsYXIodCkuYWRkKHRoaXMudjEpOwogICAgICB9CiAgICAgIHJldHVybiBwb2ludDsKICAgIH0KICAgIGdldFBvaW50QXQodSwgb3B0aW9uYWxUYXJnZXQpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0UG9pbnQodSwgb3B0aW9uYWxUYXJnZXQpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLnYxLmNvcHkoc291cmNlLnYxKTsKICAgICAgdGhpcy52Mi5jb3B5KHNvdXJjZS52Mik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKCkgewogICAgICBjb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CiAgICAgIGRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKICAgICAgZGF0YS52MiA9IHRoaXMudjIudG9BcnJheSgpOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICAgIGZyb21KU09OKGpzb24pIHsKICAgICAgc3VwZXIuZnJvbUpTT04oanNvbik7CiAgICAgIHRoaXMudjEuZnJvbUFycmF5KGpzb24udjEpOwogICAgICB0aGlzLnYyLmZyb21BcnJheShqc29uLnYyKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICB2YXIgUXVhZHJhdGljQmV6aWVyQ3VydmUgPSBjbGFzcyBleHRlbmRzIEN1cnZlIHsKICAgIGNvbnN0cnVjdG9yKHYwID0gbmV3IFZlY3RvcjIoKSwgdjEgPSBuZXcgVmVjdG9yMigpLCB2MiA9IG5ldyBWZWN0b3IyKCkpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIlF1YWRyYXRpY0JlemllckN1cnZlIjsKICAgICAgdGhpcy52MCA9IHYwOwogICAgICB0aGlzLnYxID0gdjE7CiAgICAgIHRoaXMudjIgPSB2MjsKICAgIH0KICAgIGdldFBvaW50KHQsIG9wdGlvbmFsVGFyZ2V0ID0gbmV3IFZlY3RvcjIoKSkgewogICAgICBjb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwogICAgICBjb25zdCB2MCA9IHRoaXMudjAsIHYxID0gdGhpcy52MSwgdjIgPSB0aGlzLnYyOwogICAgICBwb2ludC5zZXQoUXVhZHJhdGljQmV6aWVyKHQsIHYwLngsIHYxLngsIHYyLngpLCBRdWFkcmF0aWNCZXppZXIodCwgdjAueSwgdjEueSwgdjIueSkpOwogICAgICByZXR1cm4gcG9pbnQ7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMudjAuY29weShzb3VyY2UudjApOwogICAgICB0aGlzLnYxLmNvcHkoc291cmNlLnYxKTsKICAgICAgdGhpcy52Mi5jb3B5KHNvdXJjZS52Mik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKCkgewogICAgICBjb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CiAgICAgIGRhdGEudjAgPSB0aGlzLnYwLnRvQXJyYXkoKTsKICAgICAgZGF0YS52MSA9IHRoaXMudjEudG9BcnJheSgpOwogICAgICBkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgZnJvbUpTT04oanNvbikgewogICAgICBzdXBlci5mcm9tSlNPTihqc29uKTsKICAgICAgdGhpcy52MC5mcm9tQXJyYXkoanNvbi52MCk7CiAgICAgIHRoaXMudjEuZnJvbUFycmF5KGpzb24udjEpOwogICAgICB0aGlzLnYyLmZyb21BcnJheShqc29uLnYyKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBRdWFkcmF0aWNCZXppZXJDdXJ2ZS5wcm90b3R5cGUuaXNRdWFkcmF0aWNCZXppZXJDdXJ2ZSA9IHRydWU7CiAgdmFyIFF1YWRyYXRpY0JlemllckN1cnZlMyA9IGNsYXNzIGV4dGVuZHMgQ3VydmUgewogICAgY29uc3RydWN0b3IodjAgPSBuZXcgVmVjdG9yMygpLCB2MSA9IG5ldyBWZWN0b3IzKCksIHYyID0gbmV3IFZlY3RvcjMoKSkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiUXVhZHJhdGljQmV6aWVyQ3VydmUzIjsKICAgICAgdGhpcy52MCA9IHYwOwogICAgICB0aGlzLnYxID0gdjE7CiAgICAgIHRoaXMudjIgPSB2MjsKICAgIH0KICAgIGdldFBvaW50KHQsIG9wdGlvbmFsVGFyZ2V0ID0gbmV3IFZlY3RvcjMoKSkgewogICAgICBjb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwogICAgICBjb25zdCB2MCA9IHRoaXMudjAsIHYxID0gdGhpcy52MSwgdjIgPSB0aGlzLnYyOwogICAgICBwb2ludC5zZXQoUXVhZHJhdGljQmV6aWVyKHQsIHYwLngsIHYxLngsIHYyLngpLCBRdWFkcmF0aWNCZXppZXIodCwgdjAueSwgdjEueSwgdjIueSksIFF1YWRyYXRpY0Jlemllcih0LCB2MC56LCB2MS56LCB2Mi56KSk7CiAgICAgIHJldHVybiBwb2ludDsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy52MC5jb3B5KHNvdXJjZS52MCk7CiAgICAgIHRoaXMudjEuY29weShzb3VyY2UudjEpOwogICAgICB0aGlzLnYyLmNvcHkoc291cmNlLnYyKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgIGNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKICAgICAgZGF0YS52MCA9IHRoaXMudjAudG9BcnJheSgpOwogICAgICBkYXRhLnYxID0gdGhpcy52MS50b0FycmF5KCk7CiAgICAgIGRhdGEudjIgPSB0aGlzLnYyLnRvQXJyYXkoKTsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBmcm9tSlNPTihqc29uKSB7CiAgICAgIHN1cGVyLmZyb21KU09OKGpzb24pOwogICAgICB0aGlzLnYwLmZyb21BcnJheShqc29uLnYwKTsKICAgICAgdGhpcy52MS5mcm9tQXJyYXkoanNvbi52MSk7CiAgICAgIHRoaXMudjIuZnJvbUFycmF5KGpzb24udjIpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIFF1YWRyYXRpY0JlemllckN1cnZlMy5wcm90b3R5cGUuaXNRdWFkcmF0aWNCZXppZXJDdXJ2ZTMgPSB0cnVlOwogIHZhciBTcGxpbmVDdXJ2ZSA9IGNsYXNzIGV4dGVuZHMgQ3VydmUgewogICAgY29uc3RydWN0b3IocG9pbnRzID0gW10pIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIlNwbGluZUN1cnZlIjsKICAgICAgdGhpcy5wb2ludHMgPSBwb2ludHM7CiAgICB9CiAgICBnZXRQb2ludCh0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IyKCkpIHsKICAgICAgY29uc3QgcG9pbnQgPSBvcHRpb25hbFRhcmdldDsKICAgICAgY29uc3QgcG9pbnRzID0gdGhpcy5wb2ludHM7CiAgICAgIGNvbnN0IHAgPSAocG9pbnRzLmxlbmd0aCAtIDEpICogdDsKICAgICAgY29uc3QgaW50UG9pbnQgPSBNYXRoLmZsb29yKHApOwogICAgICBjb25zdCB3ZWlnaHQgPSBwIC0gaW50UG9pbnQ7CiAgICAgIGNvbnN0IHAwID0gcG9pbnRzW2ludFBvaW50ID09PSAwID8gaW50UG9pbnQgOiBpbnRQb2ludCAtIDFdOwogICAgICBjb25zdCBwMSA9IHBvaW50c1tpbnRQb2ludF07CiAgICAgIGNvbnN0IHAyID0gcG9pbnRzW2ludFBvaW50ID4gcG9pbnRzLmxlbmd0aCAtIDIgPyBwb2ludHMubGVuZ3RoIC0gMSA6IGludFBvaW50ICsgMV07CiAgICAgIGNvbnN0IHAzID0gcG9pbnRzW2ludFBvaW50ID4gcG9pbnRzLmxlbmd0aCAtIDMgPyBwb2ludHMubGVuZ3RoIC0gMSA6IGludFBvaW50ICsgMl07CiAgICAgIHBvaW50LnNldChDYXRtdWxsUm9tKHdlaWdodCwgcDAueCwgcDEueCwgcDIueCwgcDMueCksIENhdG11bGxSb20od2VpZ2h0LCBwMC55LCBwMS55LCBwMi55LCBwMy55KSk7CiAgICAgIHJldHVybiBwb2ludDsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5wb2ludHMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzb3VyY2UucG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHBvaW50ID0gc291cmNlLnBvaW50c1tpXTsKICAgICAgICB0aGlzLnBvaW50cy5wdXNoKHBvaW50LmNsb25lKCkpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKCkgewogICAgICBjb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CiAgICAgIGRhdGEucG9pbnRzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5wb2ludHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgcG9pbnQgPSB0aGlzLnBvaW50c1tpXTsKICAgICAgICBkYXRhLnBvaW50cy5wdXNoKHBvaW50LnRvQXJyYXkoKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBmcm9tSlNPTihqc29uKSB7CiAgICAgIHN1cGVyLmZyb21KU09OKGpzb24pOwogICAgICB0aGlzLnBvaW50cyA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGpzb24ucG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHBvaW50ID0ganNvbi5wb2ludHNbaV07CiAgICAgICAgdGhpcy5wb2ludHMucHVzaChuZXcgVmVjdG9yMigpLmZyb21BcnJheShwb2ludCkpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgU3BsaW5lQ3VydmUucHJvdG90eXBlLmlzU3BsaW5lQ3VydmUgPSB0cnVlOwogIHZhciBDdXJ2ZXMgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBBcmNDdXJ2ZSwKICAgIENhdG11bGxSb21DdXJ2ZTMsCiAgICBDdWJpY0JlemllckN1cnZlLAogICAgQ3ViaWNCZXppZXJDdXJ2ZTMsCiAgICBFbGxpcHNlQ3VydmUsCiAgICBMaW5lQ3VydmUsCiAgICBMaW5lQ3VydmUzLAogICAgUXVhZHJhdGljQmV6aWVyQ3VydmUsCiAgICBRdWFkcmF0aWNCZXppZXJDdXJ2ZTMsCiAgICBTcGxpbmVDdXJ2ZQogIH0pOwogIHZhciBFYXJjdXQgPSB7CiAgICB0cmlhbmd1bGF0ZTogZnVuY3Rpb24oZGF0YSwgaG9sZUluZGljZXMsIGRpbSA9IDIpIHsKICAgICAgY29uc3QgaGFzSG9sZXMgPSBob2xlSW5kaWNlcyAmJiBob2xlSW5kaWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IG91dGVyTGVuID0gaGFzSG9sZXMgPyBob2xlSW5kaWNlc1swXSAqIGRpbSA6IGRhdGEubGVuZ3RoOwogICAgICBsZXQgb3V0ZXJOb2RlID0gbGlua2VkTGlzdChkYXRhLCAwLCBvdXRlckxlbiwgZGltLCB0cnVlKTsKICAgICAgY29uc3QgdHJpYW5nbGVzID0gW107CiAgICAgIGlmICghb3V0ZXJOb2RlIHx8IG91dGVyTm9kZS5uZXh0ID09PSBvdXRlck5vZGUucHJldikKICAgICAgICByZXR1cm4gdHJpYW5nbGVzOwogICAgICBsZXQgbWluWCwgbWluWSwgbWF4WCwgbWF4WSwgeCwgeSwgaW52U2l6ZTsKICAgICAgaWYgKGhhc0hvbGVzKQogICAgICAgIG91dGVyTm9kZSA9IGVsaW1pbmF0ZUhvbGVzKGRhdGEsIGhvbGVJbmRpY2VzLCBvdXRlck5vZGUsIGRpbSk7CiAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDgwICogZGltKSB7CiAgICAgICAgbWluWCA9IG1heFggPSBkYXRhWzBdOwogICAgICAgIG1pblkgPSBtYXhZID0gZGF0YVsxXTsKICAgICAgICBmb3IgKGxldCBpID0gZGltOyBpIDwgb3V0ZXJMZW47IGkgKz0gZGltKSB7CiAgICAgICAgICB4ID0gZGF0YVtpXTsKICAgICAgICAgIHkgPSBkYXRhW2kgKyAxXTsKICAgICAgICAgIGlmICh4IDwgbWluWCkKICAgICAgICAgICAgbWluWCA9IHg7CiAgICAgICAgICBpZiAoeSA8IG1pblkpCiAgICAgICAgICAgIG1pblkgPSB5OwogICAgICAgICAgaWYgKHggPiBtYXhYKQogICAgICAgICAgICBtYXhYID0geDsKICAgICAgICAgIGlmICh5ID4gbWF4WSkKICAgICAgICAgICAgbWF4WSA9IHk7CiAgICAgICAgfQogICAgICAgIGludlNpemUgPSBNYXRoLm1heChtYXhYIC0gbWluWCwgbWF4WSAtIG1pblkpOwogICAgICAgIGludlNpemUgPSBpbnZTaXplICE9PSAwID8gMSAvIGludlNpemUgOiAwOwogICAgICB9CiAgICAgIGVhcmN1dExpbmtlZChvdXRlck5vZGUsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplKTsKICAgICAgcmV0dXJuIHRyaWFuZ2xlczsKICAgIH0KICB9OwogIGZ1bmN0aW9uIGxpbmtlZExpc3QoZGF0YSwgc3RhcnQsIGVuZCwgZGltLCBjbG9ja3dpc2UpIHsKICAgIGxldCBpLCBsYXN0OwogICAgaWYgKGNsb2Nrd2lzZSA9PT0gc2lnbmVkQXJlYShkYXRhLCBzdGFydCwgZW5kLCBkaW0pID4gMCkgewogICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgaSArPSBkaW0pCiAgICAgICAgbGFzdCA9IGluc2VydE5vZGUoaSwgZGF0YVtpXSwgZGF0YVtpICsgMV0sIGxhc3QpOwogICAgfSBlbHNlIHsKICAgICAgZm9yIChpID0gZW5kIC0gZGltOyBpID49IHN0YXJ0OyBpIC09IGRpbSkKICAgICAgICBsYXN0ID0gaW5zZXJ0Tm9kZShpLCBkYXRhW2ldLCBkYXRhW2kgKyAxXSwgbGFzdCk7CiAgICB9CiAgICBpZiAobGFzdCAmJiBlcXVhbHMobGFzdCwgbGFzdC5uZXh0KSkgewogICAgICByZW1vdmVOb2RlKGxhc3QpOwogICAgICBsYXN0ID0gbGFzdC5uZXh0OwogICAgfQogICAgcmV0dXJuIGxhc3Q7CiAgfQogIGZ1bmN0aW9uIGZpbHRlclBvaW50cyhzdGFydCwgZW5kKSB7CiAgICBpZiAoIXN0YXJ0KQogICAgICByZXR1cm4gc3RhcnQ7CiAgICBpZiAoIWVuZCkKICAgICAgZW5kID0gc3RhcnQ7CiAgICBsZXQgcCA9IHN0YXJ0LCBhZ2FpbjsKICAgIGRvIHsKICAgICAgYWdhaW4gPSBmYWxzZTsKICAgICAgaWYgKCFwLnN0ZWluZXIgJiYgKGVxdWFscyhwLCBwLm5leHQpIHx8IGFyZWEyKHAucHJldiwgcCwgcC5uZXh0KSA9PT0gMCkpIHsKICAgICAgICByZW1vdmVOb2RlKHApOwogICAgICAgIHAgPSBlbmQgPSBwLnByZXY7CiAgICAgICAgaWYgKHAgPT09IHAubmV4dCkKICAgICAgICAgIGJyZWFrOwogICAgICAgIGFnYWluID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwID0gcC5uZXh0OwogICAgICB9CiAgICB9IHdoaWxlIChhZ2FpbiB8fCBwICE9PSBlbmQpOwogICAgcmV0dXJuIGVuZDsKICB9CiAgZnVuY3Rpb24gZWFyY3V0TGlua2VkKGVhciwgdHJpYW5nbGVzLCBkaW0sIG1pblgsIG1pblksIGludlNpemUsIHBhc3MpIHsKICAgIGlmICghZWFyKQogICAgICByZXR1cm47CiAgICBpZiAoIXBhc3MgJiYgaW52U2l6ZSkKICAgICAgaW5kZXhDdXJ2ZShlYXIsIG1pblgsIG1pblksIGludlNpemUpOwogICAgbGV0IHN0b3AgPSBlYXIsIHByZXYsIG5leHQ7CiAgICB3aGlsZSAoZWFyLnByZXYgIT09IGVhci5uZXh0KSB7CiAgICAgIHByZXYgPSBlYXIucHJldjsKICAgICAgbmV4dCA9IGVhci5uZXh0OwogICAgICBpZiAoaW52U2l6ZSA/IGlzRWFySGFzaGVkKGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSkgOiBpc0VhcihlYXIpKSB7CiAgICAgICAgdHJpYW5nbGVzLnB1c2gocHJldi5pIC8gZGltKTsKICAgICAgICB0cmlhbmdsZXMucHVzaChlYXIuaSAvIGRpbSk7CiAgICAgICAgdHJpYW5nbGVzLnB1c2gobmV4dC5pIC8gZGltKTsKICAgICAgICByZW1vdmVOb2RlKGVhcik7CiAgICAgICAgZWFyID0gbmV4dC5uZXh0OwogICAgICAgIHN0b3AgPSBuZXh0Lm5leHQ7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZWFyID0gbmV4dDsKICAgICAgaWYgKGVhciA9PT0gc3RvcCkgewogICAgICAgIGlmICghcGFzcykgewogICAgICAgICAgZWFyY3V0TGlua2VkKGZpbHRlclBvaW50cyhlYXIpLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMSk7CiAgICAgICAgfSBlbHNlIGlmIChwYXNzID09PSAxKSB7CiAgICAgICAgICBlYXIgPSBjdXJlTG9jYWxJbnRlcnNlY3Rpb25zKGZpbHRlclBvaW50cyhlYXIpLCB0cmlhbmdsZXMsIGRpbSk7CiAgICAgICAgICBlYXJjdXRMaW5rZWQoZWFyLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMik7CiAgICAgICAgfSBlbHNlIGlmIChwYXNzID09PSAyKSB7CiAgICAgICAgICBzcGxpdEVhcmN1dChlYXIsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gaXNFYXIoZWFyKSB7CiAgICBjb25zdCBhID0gZWFyLnByZXYsIGIgPSBlYXIsIGMgPSBlYXIubmV4dDsKICAgIGlmIChhcmVhMihhLCBiLCBjKSA+PSAwKQogICAgICByZXR1cm4gZmFsc2U7CiAgICBsZXQgcCA9IGVhci5uZXh0Lm5leHQ7CiAgICB3aGlsZSAocCAhPT0gZWFyLnByZXYpIHsKICAgICAgaWYgKHBvaW50SW5UcmlhbmdsZShhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBwLngsIHAueSkgJiYgYXJlYTIocC5wcmV2LCBwLCBwLm5leHQpID49IDApCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICBwID0gcC5uZXh0OwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIGZ1bmN0aW9uIGlzRWFySGFzaGVkKGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSkgewogICAgY29uc3QgYSA9IGVhci5wcmV2LCBiID0gZWFyLCBjID0gZWFyLm5leHQ7CiAgICBpZiAoYXJlYTIoYSwgYiwgYykgPj0gMCkKICAgICAgcmV0dXJuIGZhbHNlOwogICAgY29uc3QgbWluVFggPSBhLnggPCBiLnggPyBhLnggPCBjLnggPyBhLnggOiBjLnggOiBiLnggPCBjLnggPyBiLnggOiBjLngsIG1pblRZID0gYS55IDwgYi55ID8gYS55IDwgYy55ID8gYS55IDogYy55IDogYi55IDwgYy55ID8gYi55IDogYy55LCBtYXhUWCA9IGEueCA+IGIueCA/IGEueCA+IGMueCA/IGEueCA6IGMueCA6IGIueCA+IGMueCA/IGIueCA6IGMueCwgbWF4VFkgPSBhLnkgPiBiLnkgPyBhLnkgPiBjLnkgPyBhLnkgOiBjLnkgOiBiLnkgPiBjLnkgPyBiLnkgOiBjLnk7CiAgICBjb25zdCBtaW5aID0gek9yZGVyKG1pblRYLCBtaW5UWSwgbWluWCwgbWluWSwgaW52U2l6ZSksIG1heFogPSB6T3JkZXIobWF4VFgsIG1heFRZLCBtaW5YLCBtaW5ZLCBpbnZTaXplKTsKICAgIGxldCBwID0gZWFyLnByZXZaLCBuID0gZWFyLm5leHRaOwogICAgd2hpbGUgKHAgJiYgcC56ID49IG1pblogJiYgbiAmJiBuLnogPD0gbWF4WikgewogICAgICBpZiAocCAhPT0gZWFyLnByZXYgJiYgcCAhPT0gZWFyLm5leHQgJiYgcG9pbnRJblRyaWFuZ2xlKGEueCwgYS55LCBiLngsIGIueSwgYy54LCBjLnksIHAueCwgcC55KSAmJiBhcmVhMihwLnByZXYsIHAsIHAubmV4dCkgPj0gMCkKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIHAgPSBwLnByZXZaOwogICAgICBpZiAobiAhPT0gZWFyLnByZXYgJiYgbiAhPT0gZWFyLm5leHQgJiYgcG9pbnRJblRyaWFuZ2xlKGEueCwgYS55LCBiLngsIGIueSwgYy54LCBjLnksIG4ueCwgbi55KSAmJiBhcmVhMihuLnByZXYsIG4sIG4ubmV4dCkgPj0gMCkKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIG4gPSBuLm5leHRaOwogICAgfQogICAgd2hpbGUgKHAgJiYgcC56ID49IG1pblopIHsKICAgICAgaWYgKHAgIT09IGVhci5wcmV2ICYmIHAgIT09IGVhci5uZXh0ICYmIHBvaW50SW5UcmlhbmdsZShhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBwLngsIHAueSkgJiYgYXJlYTIocC5wcmV2LCBwLCBwLm5leHQpID49IDApCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICBwID0gcC5wcmV2WjsKICAgIH0KICAgIHdoaWxlIChuICYmIG4ueiA8PSBtYXhaKSB7CiAgICAgIGlmIChuICE9PSBlYXIucHJldiAmJiBuICE9PSBlYXIubmV4dCAmJiBwb2ludEluVHJpYW5nbGUoYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgbi54LCBuLnkpICYmIGFyZWEyKG4ucHJldiwgbiwgbi5uZXh0KSA+PSAwKQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgbiA9IG4ubmV4dFo7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZnVuY3Rpb24gY3VyZUxvY2FsSW50ZXJzZWN0aW9ucyhzdGFydCwgdHJpYW5nbGVzLCBkaW0pIHsKICAgIGxldCBwID0gc3RhcnQ7CiAgICBkbyB7CiAgICAgIGNvbnN0IGEgPSBwLnByZXYsIGIgPSBwLm5leHQubmV4dDsKICAgICAgaWYgKCFlcXVhbHMoYSwgYikgJiYgaW50ZXJzZWN0cyhhLCBwLCBwLm5leHQsIGIpICYmIGxvY2FsbHlJbnNpZGUoYSwgYikgJiYgbG9jYWxseUluc2lkZShiLCBhKSkgewogICAgICAgIHRyaWFuZ2xlcy5wdXNoKGEuaSAvIGRpbSk7CiAgICAgICAgdHJpYW5nbGVzLnB1c2gocC5pIC8gZGltKTsKICAgICAgICB0cmlhbmdsZXMucHVzaChiLmkgLyBkaW0pOwogICAgICAgIHJlbW92ZU5vZGUocCk7CiAgICAgICAgcmVtb3ZlTm9kZShwLm5leHQpOwogICAgICAgIHAgPSBzdGFydCA9IGI7CiAgICAgIH0KICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IHN0YXJ0KTsKICAgIHJldHVybiBmaWx0ZXJQb2ludHMocCk7CiAgfQogIGZ1bmN0aW9uIHNwbGl0RWFyY3V0KHN0YXJ0LCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSkgewogICAgbGV0IGEgPSBzdGFydDsKICAgIGRvIHsKICAgICAgbGV0IGIgPSBhLm5leHQubmV4dDsKICAgICAgd2hpbGUgKGIgIT09IGEucHJldikgewogICAgICAgIGlmIChhLmkgIT09IGIuaSAmJiBpc1ZhbGlkRGlhZ29uYWwoYSwgYikpIHsKICAgICAgICAgIGxldCBjID0gc3BsaXRQb2x5Z29uKGEsIGIpOwogICAgICAgICAgYSA9IGZpbHRlclBvaW50cyhhLCBhLm5leHQpOwogICAgICAgICAgYyA9IGZpbHRlclBvaW50cyhjLCBjLm5leHQpOwogICAgICAgICAgZWFyY3V0TGlua2VkKGEsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplKTsKICAgICAgICAgIGVhcmN1dExpbmtlZChjLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGIgPSBiLm5leHQ7CiAgICAgIH0KICAgICAgYSA9IGEubmV4dDsKICAgIH0gd2hpbGUgKGEgIT09IHN0YXJ0KTsKICB9CiAgZnVuY3Rpb24gZWxpbWluYXRlSG9sZXMoZGF0YSwgaG9sZUluZGljZXMsIG91dGVyTm9kZSwgZGltKSB7CiAgICBjb25zdCBxdWV1ZSA9IFtdOwogICAgbGV0IGksIGxlbiwgc3RhcnQsIGVuZCwgbGlzdDsKICAgIGZvciAoaSA9IDAsIGxlbiA9IGhvbGVJbmRpY2VzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIHN0YXJ0ID0gaG9sZUluZGljZXNbaV0gKiBkaW07CiAgICAgIGVuZCA9IGkgPCBsZW4gLSAxID8gaG9sZUluZGljZXNbaSArIDFdICogZGltIDogZGF0YS5sZW5ndGg7CiAgICAgIGxpc3QgPSBsaW5rZWRMaXN0KGRhdGEsIHN0YXJ0LCBlbmQsIGRpbSwgZmFsc2UpOwogICAgICBpZiAobGlzdCA9PT0gbGlzdC5uZXh0KQogICAgICAgIGxpc3Quc3RlaW5lciA9IHRydWU7CiAgICAgIHF1ZXVlLnB1c2goZ2V0TGVmdG1vc3QobGlzdCkpOwogICAgfQogICAgcXVldWUuc29ydChjb21wYXJlWCk7CiAgICBmb3IgKGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHsKICAgICAgZWxpbWluYXRlSG9sZShxdWV1ZVtpXSwgb3V0ZXJOb2RlKTsKICAgICAgb3V0ZXJOb2RlID0gZmlsdGVyUG9pbnRzKG91dGVyTm9kZSwgb3V0ZXJOb2RlLm5leHQpOwogICAgfQogICAgcmV0dXJuIG91dGVyTm9kZTsKICB9CiAgZnVuY3Rpb24gY29tcGFyZVgoYSwgYikgewogICAgcmV0dXJuIGEueCAtIGIueDsKICB9CiAgZnVuY3Rpb24gZWxpbWluYXRlSG9sZShob2xlLCBvdXRlck5vZGUpIHsKICAgIG91dGVyTm9kZSA9IGZpbmRIb2xlQnJpZGdlKGhvbGUsIG91dGVyTm9kZSk7CiAgICBpZiAob3V0ZXJOb2RlKSB7CiAgICAgIGNvbnN0IGIgPSBzcGxpdFBvbHlnb24ob3V0ZXJOb2RlLCBob2xlKTsKICAgICAgZmlsdGVyUG9pbnRzKG91dGVyTm9kZSwgb3V0ZXJOb2RlLm5leHQpOwogICAgICBmaWx0ZXJQb2ludHMoYiwgYi5uZXh0KTsKICAgIH0KICB9CiAgZnVuY3Rpb24gZmluZEhvbGVCcmlkZ2UoaG9sZSwgb3V0ZXJOb2RlKSB7CiAgICBsZXQgcCA9IG91dGVyTm9kZTsKICAgIGNvbnN0IGh4ID0gaG9sZS54OwogICAgY29uc3QgaHkgPSBob2xlLnk7CiAgICBsZXQgcXggPSAtSW5maW5pdHksIG07CiAgICBkbyB7CiAgICAgIGlmIChoeSA8PSBwLnkgJiYgaHkgPj0gcC5uZXh0LnkgJiYgcC5uZXh0LnkgIT09IHAueSkgewogICAgICAgIGNvbnN0IHggPSBwLnggKyAoaHkgLSBwLnkpICogKHAubmV4dC54IC0gcC54KSAvIChwLm5leHQueSAtIHAueSk7CiAgICAgICAgaWYgKHggPD0gaHggJiYgeCA+IHF4KSB7CiAgICAgICAgICBxeCA9IHg7CiAgICAgICAgICBpZiAoeCA9PT0gaHgpIHsKICAgICAgICAgICAgaWYgKGh5ID09PSBwLnkpCiAgICAgICAgICAgICAgcmV0dXJuIHA7CiAgICAgICAgICAgIGlmIChoeSA9PT0gcC5uZXh0LnkpCiAgICAgICAgICAgICAgcmV0dXJuIHAubmV4dDsKICAgICAgICAgIH0KICAgICAgICAgIG0gPSBwLnggPCBwLm5leHQueCA/IHAgOiBwLm5leHQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHAgPSBwLm5leHQ7CiAgICB9IHdoaWxlIChwICE9PSBvdXRlck5vZGUpOwogICAgaWYgKCFtKQogICAgICByZXR1cm4gbnVsbDsKICAgIGlmIChoeCA9PT0gcXgpCiAgICAgIHJldHVybiBtOwogICAgY29uc3Qgc3RvcCA9IG0sIG14ID0gbS54LCBteSA9IG0ueTsKICAgIGxldCB0YW5NaW4gPSBJbmZpbml0eSwgdGFuOwogICAgcCA9IG07CiAgICBkbyB7CiAgICAgIGlmIChoeCA+PSBwLnggJiYgcC54ID49IG14ICYmIGh4ICE9PSBwLnggJiYgcG9pbnRJblRyaWFuZ2xlKGh5IDwgbXkgPyBoeCA6IHF4LCBoeSwgbXgsIG15LCBoeSA8IG15ID8gcXggOiBoeCwgaHksIHAueCwgcC55KSkgewogICAgICAgIHRhbiA9IE1hdGguYWJzKGh5IC0gcC55KSAvIChoeCAtIHAueCk7CiAgICAgICAgaWYgKGxvY2FsbHlJbnNpZGUocCwgaG9sZSkgJiYgKHRhbiA8IHRhbk1pbiB8fCB0YW4gPT09IHRhbk1pbiAmJiAocC54ID4gbS54IHx8IHAueCA9PT0gbS54ICYmIHNlY3RvckNvbnRhaW5zU2VjdG9yKG0sIHApKSkpIHsKICAgICAgICAgIG0gPSBwOwogICAgICAgICAgdGFuTWluID0gdGFuOwogICAgICAgIH0KICAgICAgfQogICAgICBwID0gcC5uZXh0OwogICAgfSB3aGlsZSAocCAhPT0gc3RvcCk7CiAgICByZXR1cm4gbTsKICB9CiAgZnVuY3Rpb24gc2VjdG9yQ29udGFpbnNTZWN0b3IobSwgcCkgewogICAgcmV0dXJuIGFyZWEyKG0ucHJldiwgbSwgcC5wcmV2KSA8IDAgJiYgYXJlYTIocC5uZXh0LCBtLCBtLm5leHQpIDwgMDsKICB9CiAgZnVuY3Rpb24gaW5kZXhDdXJ2ZShzdGFydCwgbWluWCwgbWluWSwgaW52U2l6ZSkgewogICAgbGV0IHAgPSBzdGFydDsKICAgIGRvIHsKICAgICAgaWYgKHAueiA9PT0gbnVsbCkKICAgICAgICBwLnogPSB6T3JkZXIocC54LCBwLnksIG1pblgsIG1pblksIGludlNpemUpOwogICAgICBwLnByZXZaID0gcC5wcmV2OwogICAgICBwLm5leHRaID0gcC5uZXh0OwogICAgICBwID0gcC5uZXh0OwogICAgfSB3aGlsZSAocCAhPT0gc3RhcnQpOwogICAgcC5wcmV2Wi5uZXh0WiA9IG51bGw7CiAgICBwLnByZXZaID0gbnVsbDsKICAgIHNvcnRMaW5rZWQocCk7CiAgfQogIGZ1bmN0aW9uIHNvcnRMaW5rZWQobGlzdCkgewogICAgbGV0IGksIHAsIHEsIGUsIHRhaWwsIG51bU1lcmdlcywgcFNpemUsIHFTaXplLCBpblNpemUgPSAxOwogICAgZG8gewogICAgICBwID0gbGlzdDsKICAgICAgbGlzdCA9IG51bGw7CiAgICAgIHRhaWwgPSBudWxsOwogICAgICBudW1NZXJnZXMgPSAwOwogICAgICB3aGlsZSAocCkgewogICAgICAgIG51bU1lcmdlcysrOwogICAgICAgIHEgPSBwOwogICAgICAgIHBTaXplID0gMDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaW5TaXplOyBpKyspIHsKICAgICAgICAgIHBTaXplKys7CiAgICAgICAgICBxID0gcS5uZXh0WjsKICAgICAgICAgIGlmICghcSkKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHFTaXplID0gaW5TaXplOwogICAgICAgIHdoaWxlIChwU2l6ZSA+IDAgfHwgcVNpemUgPiAwICYmIHEpIHsKICAgICAgICAgIGlmIChwU2l6ZSAhPT0gMCAmJiAocVNpemUgPT09IDAgfHwgIXEgfHwgcC56IDw9IHEueikpIHsKICAgICAgICAgICAgZSA9IHA7CiAgICAgICAgICAgIHAgPSBwLm5leHRaOwogICAgICAgICAgICBwU2l6ZS0tOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZSA9IHE7CiAgICAgICAgICAgIHEgPSBxLm5leHRaOwogICAgICAgICAgICBxU2l6ZS0tOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRhaWwpCiAgICAgICAgICAgIHRhaWwubmV4dFogPSBlOwogICAgICAgICAgZWxzZQogICAgICAgICAgICBsaXN0ID0gZTsKICAgICAgICAgIGUucHJldlogPSB0YWlsOwogICAgICAgICAgdGFpbCA9IGU7CiAgICAgICAgfQogICAgICAgIHAgPSBxOwogICAgICB9CiAgICAgIHRhaWwubmV4dFogPSBudWxsOwogICAgICBpblNpemUgKj0gMjsKICAgIH0gd2hpbGUgKG51bU1lcmdlcyA+IDEpOwogICAgcmV0dXJuIGxpc3Q7CiAgfQogIGZ1bmN0aW9uIHpPcmRlcih4LCB5LCBtaW5YLCBtaW5ZLCBpbnZTaXplKSB7CiAgICB4ID0gMzI3NjcgKiAoeCAtIG1pblgpICogaW52U2l6ZTsKICAgIHkgPSAzMjc2NyAqICh5IC0gbWluWSkgKiBpbnZTaXplOwogICAgeCA9ICh4IHwgeCA8PCA4KSAmIDE2NzExOTM1OwogICAgeCA9ICh4IHwgeCA8PCA0KSAmIDI1MjY0NTEzNTsKICAgIHggPSAoeCB8IHggPDwgMikgJiA4NTg5OTM0NTk7CiAgICB4ID0gKHggfCB4IDw8IDEpICYgMTQzMTY1NTc2NTsKICAgIHkgPSAoeSB8IHkgPDwgOCkgJiAxNjcxMTkzNTsKICAgIHkgPSAoeSB8IHkgPDwgNCkgJiAyNTI2NDUxMzU7CiAgICB5ID0gKHkgfCB5IDw8IDIpICYgODU4OTkzNDU5OwogICAgeSA9ICh5IHwgeSA8PCAxKSAmIDE0MzE2NTU3NjU7CiAgICByZXR1cm4geCB8IHkgPDwgMTsKICB9CiAgZnVuY3Rpb24gZ2V0TGVmdG1vc3Qoc3RhcnQpIHsKICAgIGxldCBwID0gc3RhcnQsIGxlZnRtb3N0ID0gc3RhcnQ7CiAgICBkbyB7CiAgICAgIGlmIChwLnggPCBsZWZ0bW9zdC54IHx8IHAueCA9PT0gbGVmdG1vc3QueCAmJiBwLnkgPCBsZWZ0bW9zdC55KQogICAgICAgIGxlZnRtb3N0ID0gcDsKICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IHN0YXJ0KTsKICAgIHJldHVybiBsZWZ0bW9zdDsKICB9CiAgZnVuY3Rpb24gcG9pbnRJblRyaWFuZ2xlKGF4LCBheSwgYngsIGJ5LCBjeCwgY3ksIHB4MiwgcHkyKSB7CiAgICByZXR1cm4gKGN4IC0gcHgyKSAqIChheSAtIHB5MikgLSAoYXggLSBweDIpICogKGN5IC0gcHkyKSA+PSAwICYmIChheCAtIHB4MikgKiAoYnkgLSBweTIpIC0gKGJ4IC0gcHgyKSAqIChheSAtIHB5MikgPj0gMCAmJiAoYnggLSBweDIpICogKGN5IC0gcHkyKSAtIChjeCAtIHB4MikgKiAoYnkgLSBweTIpID49IDA7CiAgfQogIGZ1bmN0aW9uIGlzVmFsaWREaWFnb25hbChhLCBiKSB7CiAgICByZXR1cm4gYS5uZXh0LmkgIT09IGIuaSAmJiBhLnByZXYuaSAhPT0gYi5pICYmICFpbnRlcnNlY3RzUG9seWdvbihhLCBiKSAmJiAobG9jYWxseUluc2lkZShhLCBiKSAmJiBsb2NhbGx5SW5zaWRlKGIsIGEpICYmIG1pZGRsZUluc2lkZShhLCBiKSAmJiAoYXJlYTIoYS5wcmV2LCBhLCBiLnByZXYpIHx8IGFyZWEyKGEsIGIucHJldiwgYikpIHx8IGVxdWFscyhhLCBiKSAmJiBhcmVhMihhLnByZXYsIGEsIGEubmV4dCkgPiAwICYmIGFyZWEyKGIucHJldiwgYiwgYi5uZXh0KSA+IDApOwogIH0KICBmdW5jdGlvbiBhcmVhMihwLCBxLCByKSB7CiAgICByZXR1cm4gKHEueSAtIHAueSkgKiAoci54IC0gcS54KSAtIChxLnggLSBwLngpICogKHIueSAtIHEueSk7CiAgfQogIGZ1bmN0aW9uIGVxdWFscyhwMSwgcDIpIHsKICAgIHJldHVybiBwMS54ID09PSBwMi54ICYmIHAxLnkgPT09IHAyLnk7CiAgfQogIGZ1bmN0aW9uIGludGVyc2VjdHMocDEsIHExLCBwMiwgcTIpIHsKICAgIGNvbnN0IG8xID0gc2lnbihhcmVhMihwMSwgcTEsIHAyKSk7CiAgICBjb25zdCBvMiA9IHNpZ24oYXJlYTIocDEsIHExLCBxMikpOwogICAgY29uc3QgbzMgPSBzaWduKGFyZWEyKHAyLCBxMiwgcDEpKTsKICAgIGNvbnN0IG80ID0gc2lnbihhcmVhMihwMiwgcTIsIHExKSk7CiAgICBpZiAobzEgIT09IG8yICYmIG8zICE9PSBvNCkKICAgICAgcmV0dXJuIHRydWU7CiAgICBpZiAobzEgPT09IDAgJiYgb25TZWdtZW50KHAxLCBwMiwgcTEpKQogICAgICByZXR1cm4gdHJ1ZTsKICAgIGlmIChvMiA9PT0gMCAmJiBvblNlZ21lbnQocDEsIHEyLCBxMSkpCiAgICAgIHJldHVybiB0cnVlOwogICAgaWYgKG8zID09PSAwICYmIG9uU2VnbWVudChwMiwgcDEsIHEyKSkKICAgICAgcmV0dXJuIHRydWU7CiAgICBpZiAobzQgPT09IDAgJiYgb25TZWdtZW50KHAyLCBxMSwgcTIpKQogICAgICByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZnVuY3Rpb24gb25TZWdtZW50KHAsIHEsIHIpIHsKICAgIHJldHVybiBxLnggPD0gTWF0aC5tYXgocC54LCByLngpICYmIHEueCA+PSBNYXRoLm1pbihwLngsIHIueCkgJiYgcS55IDw9IE1hdGgubWF4KHAueSwgci55KSAmJiBxLnkgPj0gTWF0aC5taW4ocC55LCByLnkpOwogIH0KICBmdW5jdGlvbiBzaWduKG51bSkgewogICAgcmV0dXJuIG51bSA+IDAgPyAxIDogbnVtIDwgMCA/IC0xIDogMDsKICB9CiAgZnVuY3Rpb24gaW50ZXJzZWN0c1BvbHlnb24oYSwgYikgewogICAgbGV0IHAgPSBhOwogICAgZG8gewogICAgICBpZiAocC5pICE9PSBhLmkgJiYgcC5uZXh0LmkgIT09IGEuaSAmJiBwLmkgIT09IGIuaSAmJiBwLm5leHQuaSAhPT0gYi5pICYmIGludGVyc2VjdHMocCwgcC5uZXh0LCBhLCBiKSkKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IGEpOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBmdW5jdGlvbiBsb2NhbGx5SW5zaWRlKGEsIGIpIHsKICAgIHJldHVybiBhcmVhMihhLnByZXYsIGEsIGEubmV4dCkgPCAwID8gYXJlYTIoYSwgYiwgYS5uZXh0KSA+PSAwICYmIGFyZWEyKGEsIGEucHJldiwgYikgPj0gMCA6IGFyZWEyKGEsIGIsIGEucHJldikgPCAwIHx8IGFyZWEyKGEsIGEubmV4dCwgYikgPCAwOwogIH0KICBmdW5jdGlvbiBtaWRkbGVJbnNpZGUoYSwgYikgewogICAgbGV0IHAgPSBhLCBpbnNpZGUgPSBmYWxzZTsKICAgIGNvbnN0IHB4MiA9IChhLnggKyBiLngpIC8gMiwgcHkyID0gKGEueSArIGIueSkgLyAyOwogICAgZG8gewogICAgICBpZiAocC55ID4gcHkyICE9PSBwLm5leHQueSA+IHB5MiAmJiBwLm5leHQueSAhPT0gcC55ICYmIHB4MiA8IChwLm5leHQueCAtIHAueCkgKiAocHkyIC0gcC55KSAvIChwLm5leHQueSAtIHAueSkgKyBwLngpCiAgICAgICAgaW5zaWRlID0gIWluc2lkZTsKICAgICAgcCA9IHAubmV4dDsKICAgIH0gd2hpbGUgKHAgIT09IGEpOwogICAgcmV0dXJuIGluc2lkZTsKICB9CiAgZnVuY3Rpb24gc3BsaXRQb2x5Z29uKGEsIGIpIHsKICAgIGNvbnN0IGEyID0gbmV3IE5vZGUoYS5pLCBhLngsIGEueSksIGIyID0gbmV3IE5vZGUoYi5pLCBiLngsIGIueSksIGFuID0gYS5uZXh0LCBicCA9IGIucHJldjsKICAgIGEubmV4dCA9IGI7CiAgICBiLnByZXYgPSBhOwogICAgYTIubmV4dCA9IGFuOwogICAgYW4ucHJldiA9IGEyOwogICAgYjIubmV4dCA9IGEyOwogICAgYTIucHJldiA9IGIyOwogICAgYnAubmV4dCA9IGIyOwogICAgYjIucHJldiA9IGJwOwogICAgcmV0dXJuIGIyOwogIH0KICBmdW5jdGlvbiBpbnNlcnROb2RlKGksIHgsIHksIGxhc3QpIHsKICAgIGNvbnN0IHAgPSBuZXcgTm9kZShpLCB4LCB5KTsKICAgIGlmICghbGFzdCkgewogICAgICBwLnByZXYgPSBwOwogICAgICBwLm5leHQgPSBwOwogICAgfSBlbHNlIHsKICAgICAgcC5uZXh0ID0gbGFzdC5uZXh0OwogICAgICBwLnByZXYgPSBsYXN0OwogICAgICBsYXN0Lm5leHQucHJldiA9IHA7CiAgICAgIGxhc3QubmV4dCA9IHA7CiAgICB9CiAgICByZXR1cm4gcDsKICB9CiAgZnVuY3Rpb24gcmVtb3ZlTm9kZShwKSB7CiAgICBwLm5leHQucHJldiA9IHAucHJldjsKICAgIHAucHJldi5uZXh0ID0gcC5uZXh0OwogICAgaWYgKHAucHJldlopCiAgICAgIHAucHJldloubmV4dFogPSBwLm5leHRaOwogICAgaWYgKHAubmV4dFopCiAgICAgIHAubmV4dFoucHJldlogPSBwLnByZXZaOwogIH0KICBmdW5jdGlvbiBOb2RlKGksIHgsIHkpIHsKICAgIHRoaXMuaSA9IGk7CiAgICB0aGlzLnggPSB4OwogICAgdGhpcy55ID0geTsKICAgIHRoaXMucHJldiA9IG51bGw7CiAgICB0aGlzLm5leHQgPSBudWxsOwogICAgdGhpcy56ID0gbnVsbDsKICAgIHRoaXMucHJldlogPSBudWxsOwogICAgdGhpcy5uZXh0WiA9IG51bGw7CiAgICB0aGlzLnN0ZWluZXIgPSBmYWxzZTsKICB9CiAgZnVuY3Rpb24gc2lnbmVkQXJlYShkYXRhLCBzdGFydCwgZW5kLCBkaW0pIHsKICAgIGxldCBzdW0gPSAwOwogICAgZm9yIChsZXQgaSA9IHN0YXJ0LCBqID0gZW5kIC0gZGltOyBpIDwgZW5kOyBpICs9IGRpbSkgewogICAgICBzdW0gKz0gKGRhdGFbal0gLSBkYXRhW2ldKSAqIChkYXRhW2kgKyAxXSArIGRhdGFbaiArIDFdKTsKICAgICAgaiA9IGk7CiAgICB9CiAgICByZXR1cm4gc3VtOwogIH0KICB2YXIgU2hhcGVVdGlscyA9IGNsYXNzIHsKICAgIHN0YXRpYyBhcmVhKGNvbnRvdXIpIHsKICAgICAgY29uc3QgbiA9IGNvbnRvdXIubGVuZ3RoOwogICAgICBsZXQgYSA9IDA7CiAgICAgIGZvciAobGV0IHAgPSBuIC0gMSwgcSA9IDA7IHEgPCBuOyBwID0gcSsrKSB7CiAgICAgICAgYSArPSBjb250b3VyW3BdLnggKiBjb250b3VyW3FdLnkgLSBjb250b3VyW3FdLnggKiBjb250b3VyW3BdLnk7CiAgICAgIH0KICAgICAgcmV0dXJuIGEgKiAwLjU7CiAgICB9CiAgICBzdGF0aWMgaXNDbG9ja1dpc2UocHRzKSB7CiAgICAgIHJldHVybiBTaGFwZVV0aWxzLmFyZWEocHRzKSA8IDA7CiAgICB9CiAgICBzdGF0aWMgdHJpYW5ndWxhdGVTaGFwZShjb250b3VyLCBob2xlcykgewogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBob2xlSW5kaWNlcyA9IFtdOwogICAgICBjb25zdCBmYWNlcyA9IFtdOwogICAgICByZW1vdmVEdXBFbmRQdHMoY29udG91cik7CiAgICAgIGFkZENvbnRvdXIodmVydGljZXMsIGNvbnRvdXIpOwogICAgICBsZXQgaG9sZUluZGV4ID0gY29udG91ci5sZW5ndGg7CiAgICAgIGhvbGVzLmZvckVhY2gocmVtb3ZlRHVwRW5kUHRzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBob2xlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGhvbGVJbmRpY2VzLnB1c2goaG9sZUluZGV4KTsKICAgICAgICBob2xlSW5kZXggKz0gaG9sZXNbaV0ubGVuZ3RoOwogICAgICAgIGFkZENvbnRvdXIodmVydGljZXMsIGhvbGVzW2ldKTsKICAgICAgfQogICAgICBjb25zdCB0cmlhbmdsZXMgPSBFYXJjdXQudHJpYW5ndWxhdGUodmVydGljZXMsIGhvbGVJbmRpY2VzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpICs9IDMpIHsKICAgICAgICBmYWNlcy5wdXNoKHRyaWFuZ2xlcy5zbGljZShpLCBpICsgMykpOwogICAgICB9CiAgICAgIHJldHVybiBmYWNlczsKICAgIH0KICB9OwogIGZ1bmN0aW9uIHJlbW92ZUR1cEVuZFB0cyhwb2ludHMpIHsKICAgIGNvbnN0IGwgPSBwb2ludHMubGVuZ3RoOwogICAgaWYgKGwgPiAyICYmIHBvaW50c1tsIC0gMV0uZXF1YWxzKHBvaW50c1swXSkpIHsKICAgICAgcG9pbnRzLnBvcCgpOwogICAgfQogIH0KICBmdW5jdGlvbiBhZGRDb250b3VyKHZlcnRpY2VzLCBjb250b3VyKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbnRvdXIubGVuZ3RoOyBpKyspIHsKICAgICAgdmVydGljZXMucHVzaChjb250b3VyW2ldLngpOwogICAgICB2ZXJ0aWNlcy5wdXNoKGNvbnRvdXJbaV0ueSk7CiAgICB9CiAgfQogIHZhciBFeHRydWRlR2VvbWV0cnkgPSBjbGFzcyBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKICAgIGNvbnN0cnVjdG9yKHNoYXBlcywgb3B0aW9ucykgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiRXh0cnVkZUdlb21ldHJ5IjsKICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gewogICAgICAgIHNoYXBlcywKICAgICAgICBvcHRpb25zCiAgICAgIH07CiAgICAgIHNoYXBlcyA9IEFycmF5LmlzQXJyYXkoc2hhcGVzKSA/IHNoYXBlcyA6IFtzaGFwZXNdOwogICAgICBjb25zdCBzY29wZSA9IHRoaXM7CiAgICAgIGNvbnN0IHZlcnRpY2VzQXJyYXkgPSBbXTsKICAgICAgY29uc3QgdXZBcnJheSA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsKICAgICAgICBhZGRTaGFwZShzaGFwZSk7CiAgICAgIH0KICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoInBvc2l0aW9uIiwgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUodmVydGljZXNBcnJheSwgMykpOwogICAgICB0aGlzLnNldEF0dHJpYnV0ZSgidXYiLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSh1dkFycmF5LCAyKSk7CiAgICAgIHRoaXMuY29tcHV0ZVZlcnRleE5vcm1hbHMoKTsKICAgICAgZnVuY3Rpb24gYWRkU2hhcGUoc2hhcGUpIHsKICAgICAgICBjb25zdCBwbGFjZWhvbGRlciA9IFtdOwogICAgICAgIGNvbnN0IGN1cnZlU2VnbWVudHMgPSBvcHRpb25zLmN1cnZlU2VnbWVudHMgIT09IHZvaWQgMCA/IG9wdGlvbnMuY3VydmVTZWdtZW50cyA6IDEyOwogICAgICAgIGNvbnN0IHN0ZXBzID0gb3B0aW9ucy5zdGVwcyAhPT0gdm9pZCAwID8gb3B0aW9ucy5zdGVwcyA6IDE7CiAgICAgICAgbGV0IGRlcHRoID0gb3B0aW9ucy5kZXB0aCAhPT0gdm9pZCAwID8gb3B0aW9ucy5kZXB0aCA6IDEwMDsKICAgICAgICBsZXQgYmV2ZWxFbmFibGVkID0gb3B0aW9ucy5iZXZlbEVuYWJsZWQgIT09IHZvaWQgMCA/IG9wdGlvbnMuYmV2ZWxFbmFibGVkIDogdHJ1ZTsKICAgICAgICBsZXQgYmV2ZWxUaGlja25lc3MgPSBvcHRpb25zLmJldmVsVGhpY2tuZXNzICE9PSB2b2lkIDAgPyBvcHRpb25zLmJldmVsVGhpY2tuZXNzIDogNjsKICAgICAgICBsZXQgYmV2ZWxTaXplID0gb3B0aW9ucy5iZXZlbFNpemUgIT09IHZvaWQgMCA/IG9wdGlvbnMuYmV2ZWxTaXplIDogYmV2ZWxUaGlja25lc3MgLSAyOwogICAgICAgIGxldCBiZXZlbE9mZnNldCA9IG9wdGlvbnMuYmV2ZWxPZmZzZXQgIT09IHZvaWQgMCA/IG9wdGlvbnMuYmV2ZWxPZmZzZXQgOiAwOwogICAgICAgIGxldCBiZXZlbFNlZ21lbnRzID0gb3B0aW9ucy5iZXZlbFNlZ21lbnRzICE9PSB2b2lkIDAgPyBvcHRpb25zLmJldmVsU2VnbWVudHMgOiAzOwogICAgICAgIGNvbnN0IGV4dHJ1ZGVQYXRoID0gb3B0aW9ucy5leHRydWRlUGF0aDsKICAgICAgICBjb25zdCB1dmdlbiA9IG9wdGlvbnMuVVZHZW5lcmF0b3IgIT09IHZvaWQgMCA/IG9wdGlvbnMuVVZHZW5lcmF0b3IgOiBXb3JsZFVWR2VuZXJhdG9yOwogICAgICAgIGlmIChvcHRpb25zLmFtb3VudCAhPT0gdm9pZCAwKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkV4dHJ1ZGVCdWZmZXJHZW9tZXRyeTogYW1vdW50IGhhcyBiZWVuIHJlbmFtZWQgdG8gZGVwdGguIik7CiAgICAgICAgICBkZXB0aCA9IG9wdGlvbnMuYW1vdW50OwogICAgICAgIH0KICAgICAgICBsZXQgZXh0cnVkZVB0cywgZXh0cnVkZUJ5UGF0aCA9IGZhbHNlOwogICAgICAgIGxldCBzcGxpbmVUdWJlLCBiaW5vcm1hbCwgbm9ybWFsMiwgcG9zaXRpb24yOwogICAgICAgIGlmIChleHRydWRlUGF0aCkgewogICAgICAgICAgZXh0cnVkZVB0cyA9IGV4dHJ1ZGVQYXRoLmdldFNwYWNlZFBvaW50cyhzdGVwcyk7CiAgICAgICAgICBleHRydWRlQnlQYXRoID0gdHJ1ZTsKICAgICAgICAgIGJldmVsRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgc3BsaW5lVHViZSA9IGV4dHJ1ZGVQYXRoLmNvbXB1dGVGcmVuZXRGcmFtZXMoc3RlcHMsIGZhbHNlKTsKICAgICAgICAgIGJpbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKICAgICAgICAgIG5vcm1hbDIgPSBuZXcgVmVjdG9yMygpOwogICAgICAgICAgcG9zaXRpb24yID0gbmV3IFZlY3RvcjMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFiZXZlbEVuYWJsZWQpIHsKICAgICAgICAgIGJldmVsU2VnbWVudHMgPSAwOwogICAgICAgICAgYmV2ZWxUaGlja25lc3MgPSAwOwogICAgICAgICAgYmV2ZWxTaXplID0gMDsKICAgICAgICAgIGJldmVsT2Zmc2V0ID0gMDsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc2hhcGVQb2ludHMgPSBzaGFwZS5leHRyYWN0UG9pbnRzKGN1cnZlU2VnbWVudHMpOwogICAgICAgIGxldCB2ZXJ0aWNlcyA9IHNoYXBlUG9pbnRzLnNoYXBlOwogICAgICAgIGNvbnN0IGhvbGVzID0gc2hhcGVQb2ludHMuaG9sZXM7CiAgICAgICAgY29uc3QgcmV2ZXJzZSA9ICFTaGFwZVV0aWxzLmlzQ2xvY2tXaXNlKHZlcnRpY2VzKTsKICAgICAgICBpZiAocmV2ZXJzZSkgewogICAgICAgICAgdmVydGljZXMgPSB2ZXJ0aWNlcy5yZXZlcnNlKCk7CiAgICAgICAgICBmb3IgKGxldCBoID0gMCwgaGwgPSBob2xlcy5sZW5ndGg7IGggPCBobDsgaCsrKSB7CiAgICAgICAgICAgIGNvbnN0IGFob2xlID0gaG9sZXNbaF07CiAgICAgICAgICAgIGlmIChTaGFwZVV0aWxzLmlzQ2xvY2tXaXNlKGFob2xlKSkgewogICAgICAgICAgICAgIGhvbGVzW2hdID0gYWhvbGUucmV2ZXJzZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZhY2VzID0gU2hhcGVVdGlscy50cmlhbmd1bGF0ZVNoYXBlKHZlcnRpY2VzLCBob2xlcyk7CiAgICAgICAgY29uc3QgY29udG91ciA9IHZlcnRpY2VzOwogICAgICAgIGZvciAobGV0IGggPSAwLCBobCA9IGhvbGVzLmxlbmd0aDsgaCA8IGhsOyBoKyspIHsKICAgICAgICAgIGNvbnN0IGFob2xlID0gaG9sZXNbaF07CiAgICAgICAgICB2ZXJ0aWNlcyA9IHZlcnRpY2VzLmNvbmNhdChhaG9sZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNjYWxlUHQyKHB0LCB2ZWMsIHNpemUpIHsKICAgICAgICAgIGlmICghdmVjKQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5FeHRydWRlR2VvbWV0cnk6IHZlYyBkb2VzIG5vdCBleGlzdCIpOwogICAgICAgICAgcmV0dXJuIHZlYy5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKHNpemUpLmFkZChwdCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHZsZW4gPSB2ZXJ0aWNlcy5sZW5ndGgsIGZsZW4gPSBmYWNlcy5sZW5ndGg7CiAgICAgICAgZnVuY3Rpb24gZ2V0QmV2ZWxWZWMoaW5QdCwgaW5QcmV2LCBpbk5leHQpIHsKICAgICAgICAgIGxldCB2X3RyYW5zX3gsIHZfdHJhbnNfeSwgc2hyaW5rX2J5OwogICAgICAgICAgY29uc3Qgdl9wcmV2X3ggPSBpblB0LnggLSBpblByZXYueCwgdl9wcmV2X3kgPSBpblB0LnkgLSBpblByZXYueTsKICAgICAgICAgIGNvbnN0IHZfbmV4dF94ID0gaW5OZXh0LnggLSBpblB0LngsIHZfbmV4dF95ID0gaW5OZXh0LnkgLSBpblB0Lnk7CiAgICAgICAgICBjb25zdCB2X3ByZXZfbGVuc3EgPSB2X3ByZXZfeCAqIHZfcHJldl94ICsgdl9wcmV2X3kgKiB2X3ByZXZfeTsKICAgICAgICAgIGNvbnN0IGNvbGxpbmVhcjAgPSB2X3ByZXZfeCAqIHZfbmV4dF95IC0gdl9wcmV2X3kgKiB2X25leHRfeDsKICAgICAgICAgIGlmIChNYXRoLmFicyhjb2xsaW5lYXIwKSA+IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgIGNvbnN0IHZfcHJldl9sZW4gPSBNYXRoLnNxcnQodl9wcmV2X2xlbnNxKTsKICAgICAgICAgICAgY29uc3Qgdl9uZXh0X2xlbiA9IE1hdGguc3FydCh2X25leHRfeCAqIHZfbmV4dF94ICsgdl9uZXh0X3kgKiB2X25leHRfeSk7CiAgICAgICAgICAgIGNvbnN0IHB0UHJldlNoaWZ0X3ggPSBpblByZXYueCAtIHZfcHJldl95IC8gdl9wcmV2X2xlbjsKICAgICAgICAgICAgY29uc3QgcHRQcmV2U2hpZnRfeSA9IGluUHJldi55ICsgdl9wcmV2X3ggLyB2X3ByZXZfbGVuOwogICAgICAgICAgICBjb25zdCBwdE5leHRTaGlmdF94ID0gaW5OZXh0LnggLSB2X25leHRfeSAvIHZfbmV4dF9sZW47CiAgICAgICAgICAgIGNvbnN0IHB0TmV4dFNoaWZ0X3kgPSBpbk5leHQueSArIHZfbmV4dF94IC8gdl9uZXh0X2xlbjsKICAgICAgICAgICAgY29uc3Qgc2YgPSAoKHB0TmV4dFNoaWZ0X3ggLSBwdFByZXZTaGlmdF94KSAqIHZfbmV4dF95IC0gKHB0TmV4dFNoaWZ0X3kgLSBwdFByZXZTaGlmdF95KSAqIHZfbmV4dF94KSAvICh2X3ByZXZfeCAqIHZfbmV4dF95IC0gdl9wcmV2X3kgKiB2X25leHRfeCk7CiAgICAgICAgICAgIHZfdHJhbnNfeCA9IHB0UHJldlNoaWZ0X3ggKyB2X3ByZXZfeCAqIHNmIC0gaW5QdC54OwogICAgICAgICAgICB2X3RyYW5zX3kgPSBwdFByZXZTaGlmdF95ICsgdl9wcmV2X3kgKiBzZiAtIGluUHQueTsKICAgICAgICAgICAgY29uc3Qgdl90cmFuc19sZW5zcSA9IHZfdHJhbnNfeCAqIHZfdHJhbnNfeCArIHZfdHJhbnNfeSAqIHZfdHJhbnNfeTsKICAgICAgICAgICAgaWYgKHZfdHJhbnNfbGVuc3EgPD0gMikgewogICAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMih2X3RyYW5zX3gsIHZfdHJhbnNfeSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc2hyaW5rX2J5ID0gTWF0aC5zcXJ0KHZfdHJhbnNfbGVuc3EgLyAyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGV0IGRpcmVjdGlvbl9lcSA9IGZhbHNlOwogICAgICAgICAgICBpZiAodl9wcmV2X3ggPiBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICAgIGlmICh2X25leHRfeCA+IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgICAgICBkaXJlY3Rpb25fZXEgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAodl9wcmV2X3ggPCAtTnVtYmVyLkVQU0lMT04pIHsKICAgICAgICAgICAgICAgIGlmICh2X25leHRfeCA8IC1OdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICAgICAgICBkaXJlY3Rpb25fZXEgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoTWF0aC5zaWduKHZfcHJldl95KSA9PT0gTWF0aC5zaWduKHZfbmV4dF95KSkgewogICAgICAgICAgICAgICAgICBkaXJlY3Rpb25fZXEgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGlyZWN0aW9uX2VxKSB7CiAgICAgICAgICAgICAgdl90cmFuc194ID0gLXZfcHJldl95OwogICAgICAgICAgICAgIHZfdHJhbnNfeSA9IHZfcHJldl94OwogICAgICAgICAgICAgIHNocmlua19ieSA9IE1hdGguc3FydCh2X3ByZXZfbGVuc3EpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZfdHJhbnNfeCA9IHZfcHJldl94OwogICAgICAgICAgICAgIHZfdHJhbnNfeSA9IHZfcHJldl95OwogICAgICAgICAgICAgIHNocmlua19ieSA9IE1hdGguc3FydCh2X3ByZXZfbGVuc3EgLyAyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHZfdHJhbnNfeCAvIHNocmlua19ieSwgdl90cmFuc195IC8gc2hyaW5rX2J5KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29udG91ck1vdmVtZW50cyA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IGNvbnRvdXIubGVuZ3RoLCBqID0gaWwgLSAxLCBrID0gaSArIDE7IGkgPCBpbDsgaSsrLCBqKyssIGsrKykgewogICAgICAgICAgaWYgKGogPT09IGlsKQogICAgICAgICAgICBqID0gMDsKICAgICAgICAgIGlmIChrID09PSBpbCkKICAgICAgICAgICAgayA9IDA7CiAgICAgICAgICBjb250b3VyTW92ZW1lbnRzW2ldID0gZ2V0QmV2ZWxWZWMoY29udG91cltpXSwgY29udG91cltqXSwgY29udG91cltrXSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGhvbGVzTW92ZW1lbnRzID0gW107CiAgICAgICAgbGV0IG9uZUhvbGVNb3ZlbWVudHMsIHZlcnRpY2VzTW92ZW1lbnRzID0gY29udG91ck1vdmVtZW50cy5jb25jYXQoKTsKICAgICAgICBmb3IgKGxldCBoID0gMCwgaGwgPSBob2xlcy5sZW5ndGg7IGggPCBobDsgaCsrKSB7CiAgICAgICAgICBjb25zdCBhaG9sZSA9IGhvbGVzW2hdOwogICAgICAgICAgb25lSG9sZU1vdmVtZW50cyA9IFtdOwogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gYWhvbGUubGVuZ3RoLCBqID0gaWwgLSAxLCBrID0gaSArIDE7IGkgPCBpbDsgaSsrLCBqKyssIGsrKykgewogICAgICAgICAgICBpZiAoaiA9PT0gaWwpCiAgICAgICAgICAgICAgaiA9IDA7CiAgICAgICAgICAgIGlmIChrID09PSBpbCkKICAgICAgICAgICAgICBrID0gMDsKICAgICAgICAgICAgb25lSG9sZU1vdmVtZW50c1tpXSA9IGdldEJldmVsVmVjKGFob2xlW2ldLCBhaG9sZVtqXSwgYWhvbGVba10pOwogICAgICAgICAgfQogICAgICAgICAgaG9sZXNNb3ZlbWVudHMucHVzaChvbmVIb2xlTW92ZW1lbnRzKTsKICAgICAgICAgIHZlcnRpY2VzTW92ZW1lbnRzID0gdmVydGljZXNNb3ZlbWVudHMuY29uY2F0KG9uZUhvbGVNb3ZlbWVudHMpOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBiID0gMDsgYiA8IGJldmVsU2VnbWVudHM7IGIrKykgewogICAgICAgICAgY29uc3QgdCA9IGIgLyBiZXZlbFNlZ21lbnRzOwogICAgICAgICAgY29uc3QgeiA9IGJldmVsVGhpY2tuZXNzICogTWF0aC5jb3ModCAqIE1hdGguUEkgLyAyKTsKICAgICAgICAgIGNvbnN0IGJzMiA9IGJldmVsU2l6ZSAqIE1hdGguc2luKHQgKiBNYXRoLlBJIC8gMikgKyBiZXZlbE9mZnNldDsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IGNvbnRvdXIubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgICBjb25zdCB2ZXJ0ID0gc2NhbGVQdDIoY29udG91cltpXSwgY29udG91ck1vdmVtZW50c1tpXSwgYnMyKTsKICAgICAgICAgICAgdih2ZXJ0LngsIHZlcnQueSwgLXopOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChsZXQgaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGgrKykgewogICAgICAgICAgICBjb25zdCBhaG9sZSA9IGhvbGVzW2hdOwogICAgICAgICAgICBvbmVIb2xlTW92ZW1lbnRzID0gaG9sZXNNb3ZlbWVudHNbaF07CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IGFob2xlLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCB2ZXJ0ID0gc2NhbGVQdDIoYWhvbGVbaV0sIG9uZUhvbGVNb3ZlbWVudHNbaV0sIGJzMik7CiAgICAgICAgICAgICAgdih2ZXJ0LngsIHZlcnQueSwgLXopOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGJzID0gYmV2ZWxTaXplICsgYmV2ZWxPZmZzZXQ7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2bGVuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHZlcnQgPSBiZXZlbEVuYWJsZWQgPyBzY2FsZVB0Mih2ZXJ0aWNlc1tpXSwgdmVydGljZXNNb3ZlbWVudHNbaV0sIGJzKSA6IHZlcnRpY2VzW2ldOwogICAgICAgICAgaWYgKCFleHRydWRlQnlQYXRoKSB7CiAgICAgICAgICAgIHYodmVydC54LCB2ZXJ0LnksIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbm9ybWFsMi5jb3B5KHNwbGluZVR1YmUubm9ybWFsc1swXSkubXVsdGlwbHlTY2FsYXIodmVydC54KTsKICAgICAgICAgICAgYmlub3JtYWwuY29weShzcGxpbmVUdWJlLmJpbm9ybWFsc1swXSkubXVsdGlwbHlTY2FsYXIodmVydC55KTsKICAgICAgICAgICAgcG9zaXRpb24yLmNvcHkoZXh0cnVkZVB0c1swXSkuYWRkKG5vcm1hbDIpLmFkZChiaW5vcm1hbCk7CiAgICAgICAgICAgIHYocG9zaXRpb24yLngsIHBvc2l0aW9uMi55LCBwb3NpdGlvbjIueik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IHMgPSAxOyBzIDw9IHN0ZXBzOyBzKyspIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmxlbjsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHZlcnQgPSBiZXZlbEVuYWJsZWQgPyBzY2FsZVB0Mih2ZXJ0aWNlc1tpXSwgdmVydGljZXNNb3ZlbWVudHNbaV0sIGJzKSA6IHZlcnRpY2VzW2ldOwogICAgICAgICAgICBpZiAoIWV4dHJ1ZGVCeVBhdGgpIHsKICAgICAgICAgICAgICB2KHZlcnQueCwgdmVydC55LCBkZXB0aCAvIHN0ZXBzICogcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbm9ybWFsMi5jb3B5KHNwbGluZVR1YmUubm9ybWFsc1tzXSkubXVsdGlwbHlTY2FsYXIodmVydC54KTsKICAgICAgICAgICAgICBiaW5vcm1hbC5jb3B5KHNwbGluZVR1YmUuYmlub3JtYWxzW3NdKS5tdWx0aXBseVNjYWxhcih2ZXJ0LnkpOwogICAgICAgICAgICAgIHBvc2l0aW9uMi5jb3B5KGV4dHJ1ZGVQdHNbc10pLmFkZChub3JtYWwyKS5hZGQoYmlub3JtYWwpOwogICAgICAgICAgICAgIHYocG9zaXRpb24yLngsIHBvc2l0aW9uMi55LCBwb3NpdGlvbjIueik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgYiA9IGJldmVsU2VnbWVudHMgLSAxOyBiID49IDA7IGItLSkgewogICAgICAgICAgY29uc3QgdCA9IGIgLyBiZXZlbFNlZ21lbnRzOwogICAgICAgICAgY29uc3QgeiA9IGJldmVsVGhpY2tuZXNzICogTWF0aC5jb3ModCAqIE1hdGguUEkgLyAyKTsKICAgICAgICAgIGNvbnN0IGJzMiA9IGJldmVsU2l6ZSAqIE1hdGguc2luKHQgKiBNYXRoLlBJIC8gMikgKyBiZXZlbE9mZnNldDsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IGNvbnRvdXIubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgICBjb25zdCB2ZXJ0ID0gc2NhbGVQdDIoY29udG91cltpXSwgY29udG91ck1vdmVtZW50c1tpXSwgYnMyKTsKICAgICAgICAgICAgdih2ZXJ0LngsIHZlcnQueSwgZGVwdGggKyB6KTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IGggPSAwLCBobCA9IGhvbGVzLmxlbmd0aDsgaCA8IGhsOyBoKyspIHsKICAgICAgICAgICAgY29uc3QgYWhvbGUgPSBob2xlc1toXTsKICAgICAgICAgICAgb25lSG9sZU1vdmVtZW50cyA9IGhvbGVzTW92ZW1lbnRzW2hdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBhaG9sZS5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgICAgICAgY29uc3QgdmVydCA9IHNjYWxlUHQyKGFob2xlW2ldLCBvbmVIb2xlTW92ZW1lbnRzW2ldLCBiczIpOwogICAgICAgICAgICAgIGlmICghZXh0cnVkZUJ5UGF0aCkgewogICAgICAgICAgICAgICAgdih2ZXJ0LngsIHZlcnQueSwgZGVwdGggKyB6KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdih2ZXJ0LngsIHZlcnQueSArIGV4dHJ1ZGVQdHNbc3RlcHMgLSAxXS55LCBleHRydWRlUHRzW3N0ZXBzIC0gMV0ueCArIHopOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBidWlsZExpZEZhY2VzKCk7CiAgICAgICAgYnVpbGRTaWRlRmFjZXMoKTsKICAgICAgICBmdW5jdGlvbiBidWlsZExpZEZhY2VzKCkgewogICAgICAgICAgY29uc3Qgc3RhcnQgPSB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDM7CiAgICAgICAgICBpZiAoYmV2ZWxFbmFibGVkKSB7CiAgICAgICAgICAgIGxldCBsYXllciA9IDA7CiAgICAgICAgICAgIGxldCBvZmZzZXQgPSB2bGVuICogbGF5ZXI7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ldOwogICAgICAgICAgICAgIGYzKGZhY2VbMl0gKyBvZmZzZXQsIGZhY2VbMV0gKyBvZmZzZXQsIGZhY2VbMF0gKyBvZmZzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxheWVyID0gc3RlcHMgKyBiZXZlbFNlZ21lbnRzICogMjsKICAgICAgICAgICAgb2Zmc2V0ID0gdmxlbiAqIGxheWVyOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZsZW47IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IGZhY2UgPSBmYWNlc1tpXTsKICAgICAgICAgICAgICBmMyhmYWNlWzBdICsgb2Zmc2V0LCBmYWNlWzFdICsgb2Zmc2V0LCBmYWNlWzJdICsgb2Zmc2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmbGVuOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgICAgICAgZjMoZmFjZVsyXSwgZmFjZVsxXSwgZmFjZVswXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmbGVuOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgICAgICAgZjMoZmFjZVswXSArIHZsZW4gKiBzdGVwcywgZmFjZVsxXSArIHZsZW4gKiBzdGVwcywgZmFjZVsyXSArIHZsZW4gKiBzdGVwcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHNjb3BlLmFkZEdyb3VwKHN0YXJ0LCB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDMgLSBzdGFydCwgMCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJ1aWxkU2lkZUZhY2VzKCkgewogICAgICAgICAgY29uc3Qgc3RhcnQgPSB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDM7CiAgICAgICAgICBsZXQgbGF5ZXJvZmZzZXQgPSAwOwogICAgICAgICAgc2lkZXdhbGxzKGNvbnRvdXIsIGxheWVyb2Zmc2V0KTsKICAgICAgICAgIGxheWVyb2Zmc2V0ICs9IGNvbnRvdXIubGVuZ3RoOwogICAgICAgICAgZm9yIChsZXQgaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGgrKykgewogICAgICAgICAgICBjb25zdCBhaG9sZSA9IGhvbGVzW2hdOwogICAgICAgICAgICBzaWRld2FsbHMoYWhvbGUsIGxheWVyb2Zmc2V0KTsKICAgICAgICAgICAgbGF5ZXJvZmZzZXQgKz0gYWhvbGUubGVuZ3RoOwogICAgICAgICAgfQogICAgICAgICAgc2NvcGUuYWRkR3JvdXAoc3RhcnQsIHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMyAtIHN0YXJ0LCAxKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc2lkZXdhbGxzKGNvbnRvdXIyLCBsYXllcm9mZnNldCkgewogICAgICAgICAgbGV0IGkgPSBjb250b3VyMi5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAoLS1pID49IDApIHsKICAgICAgICAgICAgY29uc3QgaiA9IGk7CiAgICAgICAgICAgIGxldCBrID0gaSAtIDE7CiAgICAgICAgICAgIGlmIChrIDwgMCkKICAgICAgICAgICAgICBrID0gY29udG91cjIubGVuZ3RoIC0gMTsKICAgICAgICAgICAgZm9yIChsZXQgcyA9IDAsIHNsID0gc3RlcHMgKyBiZXZlbFNlZ21lbnRzICogMjsgcyA8IHNsOyBzKyspIHsKICAgICAgICAgICAgICBjb25zdCBzbGVuMSA9IHZsZW4gKiBzOwogICAgICAgICAgICAgIGNvbnN0IHNsZW4yID0gdmxlbiAqIChzICsgMSk7CiAgICAgICAgICAgICAgY29uc3QgYSA9IGxheWVyb2Zmc2V0ICsgaiArIHNsZW4xLCBiID0gbGF5ZXJvZmZzZXQgKyBrICsgc2xlbjEsIGMgPSBsYXllcm9mZnNldCArIGsgKyBzbGVuMiwgZCA9IGxheWVyb2Zmc2V0ICsgaiArIHNsZW4yOwogICAgICAgICAgICAgIGY0KGEsIGIsIGMsIGQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHYoeCwgeSwgeikgewogICAgICAgICAgcGxhY2Vob2xkZXIucHVzaCh4KTsKICAgICAgICAgIHBsYWNlaG9sZGVyLnB1c2goeSk7CiAgICAgICAgICBwbGFjZWhvbGRlci5wdXNoKHopOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBmMyhhLCBiLCBjKSB7CiAgICAgICAgICBhZGRWZXJ0ZXgoYSk7CiAgICAgICAgICBhZGRWZXJ0ZXgoYik7CiAgICAgICAgICBhZGRWZXJ0ZXgoYyk7CiAgICAgICAgICBjb25zdCBuZXh0SW5kZXggPSB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDM7CiAgICAgICAgICBjb25zdCB1dnMgPSB1dmdlbi5nZW5lcmF0ZVRvcFVWKHNjb3BlLCB2ZXJ0aWNlc0FycmF5LCBuZXh0SW5kZXggLSAzLCBuZXh0SW5kZXggLSAyLCBuZXh0SW5kZXggLSAxKTsKICAgICAgICAgIGFkZFVWKHV2c1swXSk7CiAgICAgICAgICBhZGRVVih1dnNbMV0pOwogICAgICAgICAgYWRkVVYodXZzWzJdKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZjQoYSwgYiwgYywgZCkgewogICAgICAgICAgYWRkVmVydGV4KGEpOwogICAgICAgICAgYWRkVmVydGV4KGIpOwogICAgICAgICAgYWRkVmVydGV4KGQpOwogICAgICAgICAgYWRkVmVydGV4KGIpOwogICAgICAgICAgYWRkVmVydGV4KGMpOwogICAgICAgICAgYWRkVmVydGV4KGQpOwogICAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gdmVydGljZXNBcnJheS5sZW5ndGggLyAzOwogICAgICAgICAgY29uc3QgdXZzID0gdXZnZW4uZ2VuZXJhdGVTaWRlV2FsbFVWKHNjb3BlLCB2ZXJ0aWNlc0FycmF5LCBuZXh0SW5kZXggLSA2LCBuZXh0SW5kZXggLSAzLCBuZXh0SW5kZXggLSAyLCBuZXh0SW5kZXggLSAxKTsKICAgICAgICAgIGFkZFVWKHV2c1swXSk7CiAgICAgICAgICBhZGRVVih1dnNbMV0pOwogICAgICAgICAgYWRkVVYodXZzWzNdKTsKICAgICAgICAgIGFkZFVWKHV2c1sxXSk7CiAgICAgICAgICBhZGRVVih1dnNbMl0pOwogICAgICAgICAgYWRkVVYodXZzWzNdKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYWRkVmVydGV4KGluZGV4KSB7CiAgICAgICAgICB2ZXJ0aWNlc0FycmF5LnB1c2gocGxhY2Vob2xkZXJbaW5kZXggKiAzICsgMF0pOwogICAgICAgICAgdmVydGljZXNBcnJheS5wdXNoKHBsYWNlaG9sZGVyW2luZGV4ICogMyArIDFdKTsKICAgICAgICAgIHZlcnRpY2VzQXJyYXkucHVzaChwbGFjZWhvbGRlcltpbmRleCAqIDMgKyAyXSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFkZFVWKHZlY3RvcjIpIHsKICAgICAgICAgIHV2QXJyYXkucHVzaCh2ZWN0b3IyLngpOwogICAgICAgICAgdXZBcnJheS5wdXNoKHZlY3RvcjIueSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgIGNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKICAgICAgY29uc3Qgc2hhcGVzID0gdGhpcy5wYXJhbWV0ZXJzLnNoYXBlczsKICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMucGFyYW1ldGVycy5vcHRpb25zOwogICAgICByZXR1cm4gdG9KU09OJDEoc2hhcGVzLCBvcHRpb25zLCBkYXRhKTsKICAgIH0KICAgIHN0YXRpYyBmcm9tSlNPTihkYXRhLCBzaGFwZXMpIHsKICAgICAgY29uc3QgZ2VvbWV0cnlTaGFwZXMgPSBbXTsKICAgICAgZm9yIChsZXQgaiA9IDAsIGpsID0gZGF0YS5zaGFwZXMubGVuZ3RoOyBqIDwgamw7IGorKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2RhdGEuc2hhcGVzW2pdXTsKICAgICAgICBnZW9tZXRyeVNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgfQogICAgICBjb25zdCBleHRydWRlUGF0aCA9IGRhdGEub3B0aW9ucy5leHRydWRlUGF0aDsKICAgICAgaWYgKGV4dHJ1ZGVQYXRoICE9PSB2b2lkIDApIHsKICAgICAgICBkYXRhLm9wdGlvbnMuZXh0cnVkZVBhdGggPSBuZXcgQ3VydmVzW2V4dHJ1ZGVQYXRoLnR5cGVdKCkuZnJvbUpTT04oZXh0cnVkZVBhdGgpOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgRXh0cnVkZUdlb21ldHJ5KGdlb21ldHJ5U2hhcGVzLCBkYXRhLm9wdGlvbnMpOwogICAgfQogIH07CiAgdmFyIFdvcmxkVVZHZW5lcmF0b3IgPSB7CiAgICBnZW5lcmF0ZVRvcFVWOiBmdW5jdGlvbihnZW9tZXRyeSwgdmVydGljZXMsIGluZGV4QSwgaW5kZXhCLCBpbmRleEMpIHsKICAgICAgY29uc3QgYV94ID0gdmVydGljZXNbaW5kZXhBICogM107CiAgICAgIGNvbnN0IGFfeSA9IHZlcnRpY2VzW2luZGV4QSAqIDMgKyAxXTsKICAgICAgY29uc3QgYl94ID0gdmVydGljZXNbaW5kZXhCICogM107CiAgICAgIGNvbnN0IGJfeSA9IHZlcnRpY2VzW2luZGV4QiAqIDMgKyAxXTsKICAgICAgY29uc3QgY194ID0gdmVydGljZXNbaW5kZXhDICogM107CiAgICAgIGNvbnN0IGNfeSA9IHZlcnRpY2VzW2luZGV4QyAqIDMgKyAxXTsKICAgICAgcmV0dXJuIFsKICAgICAgICBuZXcgVmVjdG9yMihhX3gsIGFfeSksCiAgICAgICAgbmV3IFZlY3RvcjIoYl94LCBiX3kpLAogICAgICAgIG5ldyBWZWN0b3IyKGNfeCwgY195KQogICAgICBdOwogICAgfSwKICAgIGdlbmVyYXRlU2lkZVdhbGxVVjogZnVuY3Rpb24oZ2VvbWV0cnksIHZlcnRpY2VzLCBpbmRleEEsIGluZGV4QiwgaW5kZXhDLCBpbmRleEQpIHsKICAgICAgY29uc3QgYV94ID0gdmVydGljZXNbaW5kZXhBICogM107CiAgICAgIGNvbnN0IGFfeSA9IHZlcnRpY2VzW2luZGV4QSAqIDMgKyAxXTsKICAgICAgY29uc3QgYV96ID0gdmVydGljZXNbaW5kZXhBICogMyArIDJdOwogICAgICBjb25zdCBiX3ggPSB2ZXJ0aWNlc1tpbmRleEIgKiAzXTsKICAgICAgY29uc3QgYl95ID0gdmVydGljZXNbaW5kZXhCICogMyArIDFdOwogICAgICBjb25zdCBiX3ogPSB2ZXJ0aWNlc1tpbmRleEIgKiAzICsgMl07CiAgICAgIGNvbnN0IGNfeCA9IHZlcnRpY2VzW2luZGV4QyAqIDNdOwogICAgICBjb25zdCBjX3kgPSB2ZXJ0aWNlc1tpbmRleEMgKiAzICsgMV07CiAgICAgIGNvbnN0IGNfeiA9IHZlcnRpY2VzW2luZGV4QyAqIDMgKyAyXTsKICAgICAgY29uc3QgZF94ID0gdmVydGljZXNbaW5kZXhEICogM107CiAgICAgIGNvbnN0IGRfeSA9IHZlcnRpY2VzW2luZGV4RCAqIDMgKyAxXTsKICAgICAgY29uc3QgZF96ID0gdmVydGljZXNbaW5kZXhEICogMyArIDJdOwogICAgICBpZiAoTWF0aC5hYnMoYV95IC0gYl95KSA8IE1hdGguYWJzKGFfeCAtIGJfeCkpIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgbmV3IFZlY3RvcjIoYV94LCAxIC0gYV96KSwKICAgICAgICAgIG5ldyBWZWN0b3IyKGJfeCwgMSAtIGJfeiksCiAgICAgICAgICBuZXcgVmVjdG9yMihjX3gsIDEgLSBjX3opLAogICAgICAgICAgbmV3IFZlY3RvcjIoZF94LCAxIC0gZF96KQogICAgICAgIF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgIG5ldyBWZWN0b3IyKGFfeSwgMSAtIGFfeiksCiAgICAgICAgICBuZXcgVmVjdG9yMihiX3ksIDEgLSBiX3opLAogICAgICAgICAgbmV3IFZlY3RvcjIoY195LCAxIC0gY196KSwKICAgICAgICAgIG5ldyBWZWN0b3IyKGRfeSwgMSAtIGRfeikKICAgICAgICBdOwogICAgICB9CiAgICB9CiAgfTsKICBmdW5jdGlvbiB0b0pTT04kMShzaGFwZXMsIG9wdGlvbnMsIGRhdGEpIHsKICAgIGRhdGEuc2hhcGVzID0gW107CiAgICBpZiAoQXJyYXkuaXNBcnJheShzaGFwZXMpKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc2hhcGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIGRhdGEuc2hhcGVzLnB1c2goc2hhcGUudXVpZCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGRhdGEuc2hhcGVzLnB1c2goc2hhcGVzLnV1aWQpOwogICAgfQogICAgaWYgKG9wdGlvbnMuZXh0cnVkZVBhdGggIT09IHZvaWQgMCkKICAgICAgZGF0YS5vcHRpb25zLmV4dHJ1ZGVQYXRoID0gb3B0aW9ucy5leHRydWRlUGF0aC50b0pTT04oKTsKICAgIHJldHVybiBkYXRhOwogIH0KICB2YXIgU2hhcGVHZW9tZXRyeSA9IGNsYXNzIGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewogICAgY29uc3RydWN0b3Ioc2hhcGVzLCBjdXJ2ZVNlZ21lbnRzID0gMTIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIlNoYXBlR2VvbWV0cnkiOwogICAgICB0aGlzLnBhcmFtZXRlcnMgPSB7CiAgICAgICAgc2hhcGVzLAogICAgICAgIGN1cnZlU2VnbWVudHMKICAgICAgfTsKICAgICAgY29uc3QgaW5kaWNlcyA9IFtdOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBub3JtYWxzID0gW107CiAgICAgIGNvbnN0IHV2cyA9IFtdOwogICAgICBsZXQgZ3JvdXBTdGFydCA9IDA7CiAgICAgIGxldCBncm91cENvdW50ID0gMDsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2hhcGVzKSA9PT0gZmFsc2UpIHsKICAgICAgICBhZGRTaGFwZShzaGFwZXMpOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBhZGRTaGFwZShzaGFwZXNbaV0pOwogICAgICAgICAgdGhpcy5hZGRHcm91cChncm91cFN0YXJ0LCBncm91cENvdW50LCBpKTsKICAgICAgICAgIGdyb3VwU3RhcnQgKz0gZ3JvdXBDb3VudDsKICAgICAgICAgIGdyb3VwQ291bnQgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnNldEluZGV4KGluZGljZXMpOwogICAgICB0aGlzLnNldEF0dHJpYnV0ZSgicG9zaXRpb24iLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSh2ZXJ0aWNlcywgMykpOwogICAgICB0aGlzLnNldEF0dHJpYnV0ZSgibm9ybWFsIiwgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUobm9ybWFscywgMykpOwogICAgICB0aGlzLnNldEF0dHJpYnV0ZSgidXYiLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSh1dnMsIDIpKTsKICAgICAgZnVuY3Rpb24gYWRkU2hhcGUoc2hhcGUpIHsKICAgICAgICBjb25zdCBpbmRleE9mZnNldCA9IHZlcnRpY2VzLmxlbmd0aCAvIDM7CiAgICAgICAgY29uc3QgcG9pbnRzID0gc2hhcGUuZXh0cmFjdFBvaW50cyhjdXJ2ZVNlZ21lbnRzKTsKICAgICAgICBsZXQgc2hhcGVWZXJ0aWNlcyA9IHBvaW50cy5zaGFwZTsKICAgICAgICBjb25zdCBzaGFwZUhvbGVzID0gcG9pbnRzLmhvbGVzOwogICAgICAgIGlmIChTaGFwZVV0aWxzLmlzQ2xvY2tXaXNlKHNoYXBlVmVydGljZXMpID09PSBmYWxzZSkgewogICAgICAgICAgc2hhcGVWZXJ0aWNlcyA9IHNoYXBlVmVydGljZXMucmV2ZXJzZSgpOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHNoYXBlSG9sZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBzaGFwZUhvbGUgPSBzaGFwZUhvbGVzW2ldOwogICAgICAgICAgaWYgKFNoYXBlVXRpbHMuaXNDbG9ja1dpc2Uoc2hhcGVIb2xlKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBzaGFwZUhvbGVzW2ldID0gc2hhcGVIb2xlLnJldmVyc2UoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3QgZmFjZXMgPSBTaGFwZVV0aWxzLnRyaWFuZ3VsYXRlU2hhcGUoc2hhcGVWZXJ0aWNlcywgc2hhcGVIb2xlcyk7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzaGFwZUhvbGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgY29uc3Qgc2hhcGVIb2xlID0gc2hhcGVIb2xlc1tpXTsKICAgICAgICAgIHNoYXBlVmVydGljZXMgPSBzaGFwZVZlcnRpY2VzLmNvbmNhdChzaGFwZUhvbGUpOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHNoYXBlVmVydGljZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ZXJ0ZXggPSBzaGFwZVZlcnRpY2VzW2ldOwogICAgICAgICAgdmVydGljZXMucHVzaCh2ZXJ0ZXgueCwgdmVydGV4LnksIDApOwogICAgICAgICAgbm9ybWFscy5wdXNoKDAsIDAsIDEpOwogICAgICAgICAgdXZzLnB1c2godmVydGV4LngsIHZlcnRleC55KTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBmYWNlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGZhY2UgPSBmYWNlc1tpXTsKICAgICAgICAgIGNvbnN0IGEgPSBmYWNlWzBdICsgaW5kZXhPZmZzZXQ7CiAgICAgICAgICBjb25zdCBiID0gZmFjZVsxXSArIGluZGV4T2Zmc2V0OwogICAgICAgICAgY29uc3QgYyA9IGZhY2VbMl0gKyBpbmRleE9mZnNldDsKICAgICAgICAgIGluZGljZXMucHVzaChhLCBiLCBjKTsKICAgICAgICAgIGdyb3VwQ291bnQgKz0gMzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnBhcmFtZXRlcnMuc2hhcGVzOwogICAgICByZXR1cm4gdG9KU09OKHNoYXBlcywgZGF0YSk7CiAgICB9CiAgICBzdGF0aWMgZnJvbUpTT04oZGF0YSwgc2hhcGVzKSB7CiAgICAgIGNvbnN0IGdlb21ldHJ5U2hhcGVzID0gW107CiAgICAgIGZvciAobGV0IGogPSAwLCBqbCA9IGRhdGEuc2hhcGVzLmxlbmd0aDsgaiA8IGpsOyBqKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tkYXRhLnNoYXBlc1tqXV07CiAgICAgICAgZ2VvbWV0cnlTaGFwZXMucHVzaChzaGFwZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBTaGFwZUdlb21ldHJ5KGdlb21ldHJ5U2hhcGVzLCBkYXRhLmN1cnZlU2VnbWVudHMpOwogICAgfQogIH07CiAgZnVuY3Rpb24gdG9KU09OKHNoYXBlcywgZGF0YSkgewogICAgZGF0YS5zaGFwZXMgPSBbXTsKICAgIGlmIChBcnJheS5pc0FycmF5KHNoYXBlcykpIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzaGFwZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbaV07CiAgICAgICAgZGF0YS5zaGFwZXMucHVzaChzaGFwZS51dWlkKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZGF0YS5zaGFwZXMucHVzaChzaGFwZXMudXVpZCk7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9CiAgdmFyIFNoYWRvd01hdGVyaWFsID0gY2xhc3MgZXh0ZW5kcyBNYXRlcmlhbCB7CiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJTaGFkb3dNYXRlcmlhbCI7CiAgICAgIHRoaXMuY29sb3IgPSBuZXcgQ29sb3IoMCk7CiAgICAgIHRoaXMudHJhbnNwYXJlbnQgPSB0cnVlOwogICAgICB0aGlzLnNldFZhbHVlcyhwYXJhbWV0ZXJzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5jb2xvci5jb3B5KHNvdXJjZS5jb2xvcik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgU2hhZG93TWF0ZXJpYWwucHJvdG90eXBlLmlzU2hhZG93TWF0ZXJpYWwgPSB0cnVlOwogIHZhciBSYXdTaGFkZXJNYXRlcmlhbCA9IGNsYXNzIGV4dGVuZHMgU2hhZGVyTWF0ZXJpYWwgewogICAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgICBzdXBlcihwYXJhbWV0ZXJzKTsKICAgICAgdGhpcy50eXBlID0gIlJhd1NoYWRlck1hdGVyaWFsIjsKICAgIH0KICB9OwogIFJhd1NoYWRlck1hdGVyaWFsLnByb3RvdHlwZS5pc1Jhd1NoYWRlck1hdGVyaWFsID0gdHJ1ZTsKICB2YXIgTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPSBjbGFzcyBleHRlbmRzIE1hdGVyaWFsIHsKICAgIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5kZWZpbmVzID0geyAiU1RBTkRBUkQiOiAiIiB9OwogICAgICB0aGlzLnR5cGUgPSAiTWVzaFN0YW5kYXJkTWF0ZXJpYWwiOwogICAgICB0aGlzLmNvbG9yID0gbmV3IENvbG9yKDE2Nzc3MjE1KTsKICAgICAgdGhpcy5yb3VnaG5lc3MgPSAxOwogICAgICB0aGlzLm1ldGFsbmVzcyA9IDA7CiAgICAgIHRoaXMubWFwID0gbnVsbDsKICAgICAgdGhpcy5saWdodE1hcCA9IG51bGw7CiAgICAgIHRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSAxOwogICAgICB0aGlzLmFvTWFwID0gbnVsbDsKICAgICAgdGhpcy5hb01hcEludGVuc2l0eSA9IDE7CiAgICAgIHRoaXMuZW1pc3NpdmUgPSBuZXcgQ29sb3IoMCk7CiAgICAgIHRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSAxOwogICAgICB0aGlzLmVtaXNzaXZlTWFwID0gbnVsbDsKICAgICAgdGhpcy5idW1wTWFwID0gbnVsbDsKICAgICAgdGhpcy5idW1wU2NhbGUgPSAxOwogICAgICB0aGlzLm5vcm1hbE1hcCA9IG51bGw7CiAgICAgIHRoaXMubm9ybWFsTWFwVHlwZSA9IFRhbmdlbnRTcGFjZU5vcm1hbE1hcDsKICAgICAgdGhpcy5ub3JtYWxTY2FsZSA9IG5ldyBWZWN0b3IyKDEsIDEpOwogICAgICB0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwogICAgICB0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSAwOwogICAgICB0aGlzLnJvdWdobmVzc01hcCA9IG51bGw7CiAgICAgIHRoaXMubWV0YWxuZXNzTWFwID0gbnVsbDsKICAgICAgdGhpcy5hbHBoYU1hcCA9IG51bGw7CiAgICAgIHRoaXMuZW52TWFwID0gbnVsbDsKICAgICAgdGhpcy5lbnZNYXBJbnRlbnNpdHkgPSAxOwogICAgICB0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IDAuOTg7CiAgICAgIHRoaXMud2lyZWZyYW1lID0gZmFsc2U7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gInJvdW5kIjsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9ICJyb3VuZCI7CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gZmFsc2U7CiAgICAgIHRoaXMubW9ycGhOb3JtYWxzID0gZmFsc2U7CiAgICAgIHRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy52ZXJ0ZXhUYW5nZW50cyA9IGZhbHNlOwogICAgICB0aGlzLnNldFZhbHVlcyhwYXJhbWV0ZXJzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5kZWZpbmVzID0geyAiU1RBTkRBUkQiOiAiIiB9OwogICAgICB0aGlzLmNvbG9yLmNvcHkoc291cmNlLmNvbG9yKTsKICAgICAgdGhpcy5yb3VnaG5lc3MgPSBzb3VyY2Uucm91Z2huZXNzOwogICAgICB0aGlzLm1ldGFsbmVzcyA9IHNvdXJjZS5tZXRhbG5lc3M7CiAgICAgIHRoaXMubWFwID0gc291cmNlLm1hcDsKICAgICAgdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKICAgICAgdGhpcy5saWdodE1hcEludGVuc2l0eSA9IHNvdXJjZS5saWdodE1hcEludGVuc2l0eTsKICAgICAgdGhpcy5hb01hcCA9IHNvdXJjZS5hb01hcDsKICAgICAgdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKICAgICAgdGhpcy5lbWlzc2l2ZS5jb3B5KHNvdXJjZS5lbWlzc2l2ZSk7CiAgICAgIHRoaXMuZW1pc3NpdmVNYXAgPSBzb3VyY2UuZW1pc3NpdmVNYXA7CiAgICAgIHRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSBzb3VyY2UuZW1pc3NpdmVJbnRlbnNpdHk7CiAgICAgIHRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwogICAgICB0aGlzLmJ1bXBTY2FsZSA9IHNvdXJjZS5idW1wU2NhbGU7CiAgICAgIHRoaXMubm9ybWFsTWFwID0gc291cmNlLm5vcm1hbE1hcDsKICAgICAgdGhpcy5ub3JtYWxNYXBUeXBlID0gc291cmNlLm5vcm1hbE1hcFR5cGU7CiAgICAgIHRoaXMubm9ybWFsU2NhbGUuY29weShzb3VyY2Uubm9ybWFsU2NhbGUpOwogICAgICB0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwogICAgICB0aGlzLnJvdWdobmVzc01hcCA9IHNvdXJjZS5yb3VnaG5lc3NNYXA7CiAgICAgIHRoaXMubWV0YWxuZXNzTWFwID0gc291cmNlLm1ldGFsbmVzc01hcDsKICAgICAgdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKICAgICAgdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwogICAgICB0aGlzLmVudk1hcEludGVuc2l0eSA9IHNvdXJjZS5lbnZNYXBJbnRlbnNpdHk7CiAgICAgIHRoaXMucmVmcmFjdGlvblJhdGlvID0gc291cmNlLnJlZnJhY3Rpb25SYXRpbzsKICAgICAgdGhpcy53aXJlZnJhbWUgPSBzb3VyY2Uud2lyZWZyYW1lOwogICAgICB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZWNhcCA9IHNvdXJjZS53aXJlZnJhbWVMaW5lY2FwOwogICAgICB0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gc291cmNlLndpcmVmcmFtZUxpbmVqb2luOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CiAgICAgIHRoaXMubW9ycGhOb3JtYWxzID0gc291cmNlLm1vcnBoTm9ybWFsczsKICAgICAgdGhpcy5mbGF0U2hhZGluZyA9IHNvdXJjZS5mbGF0U2hhZGluZzsKICAgICAgdGhpcy52ZXJ0ZXhUYW5nZW50cyA9IHNvdXJjZS52ZXJ0ZXhUYW5nZW50czsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBNZXNoU3RhbmRhcmRNYXRlcmlhbC5wcm90b3R5cGUuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA9IHRydWU7CiAgdmFyIE1lc2hQaHlzaWNhbE1hdGVyaWFsID0gY2xhc3MgZXh0ZW5kcyBNZXNoU3RhbmRhcmRNYXRlcmlhbCB7CiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuZGVmaW5lcyA9IHsKICAgICAgICAiU1RBTkRBUkQiOiAiIiwKICAgICAgICAiUEhZU0lDQUwiOiAiIgogICAgICB9OwogICAgICB0aGlzLnR5cGUgPSAiTWVzaFBoeXNpY2FsTWF0ZXJpYWwiOwogICAgICB0aGlzLmNsZWFyY29hdCA9IDA7CiAgICAgIHRoaXMuY2xlYXJjb2F0TWFwID0gbnVsbDsKICAgICAgdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3MgPSAwOwogICAgICB0aGlzLmNsZWFyY29hdFJvdWdobmVzc01hcCA9IG51bGw7CiAgICAgIHRoaXMuY2xlYXJjb2F0Tm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMigxLCAxKTsKICAgICAgdGhpcy5jbGVhcmNvYXROb3JtYWxNYXAgPSBudWxsOwogICAgICB0aGlzLnJlZmxlY3Rpdml0eSA9IDAuNTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJpb3IiLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAoMSArIDAuNCAqIHRoaXMucmVmbGVjdGl2aXR5KSAvICgxIC0gMC40ICogdGhpcy5yZWZsZWN0aXZpdHkpOwogICAgICAgIH0sCiAgICAgICAgc2V0OiBmdW5jdGlvbihpb3IpIHsKICAgICAgICAgIHRoaXMucmVmbGVjdGl2aXR5ID0gY2xhbXAoMi41ICogKGlvciAtIDEpIC8gKGlvciArIDEpLCAwLCAxKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnNoZWVuID0gbnVsbDsKICAgICAgdGhpcy50cmFuc21pc3Npb24gPSAwOwogICAgICB0aGlzLnRyYW5zbWlzc2lvbk1hcCA9IG51bGw7CiAgICAgIHRoaXMudGhpY2tuZXNzID0gMC4wMTsKICAgICAgdGhpcy50aGlja25lc3NNYXAgPSBudWxsOwogICAgICB0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2UgPSAwOwogICAgICB0aGlzLmF0dGVudWF0aW9uQ29sb3IgPSBuZXcgQ29sb3IoMSwgMSwgMSk7CiAgICAgIHRoaXMuc2V0VmFsdWVzKHBhcmFtZXRlcnMpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLmRlZmluZXMgPSB7CiAgICAgICAgIlNUQU5EQVJEIjogIiIsCiAgICAgICAgIlBIWVNJQ0FMIjogIiIKICAgICAgfTsKICAgICAgdGhpcy5jbGVhcmNvYXQgPSBzb3VyY2UuY2xlYXJjb2F0OwogICAgICB0aGlzLmNsZWFyY29hdE1hcCA9IHNvdXJjZS5jbGVhcmNvYXRNYXA7CiAgICAgIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzID0gc291cmNlLmNsZWFyY29hdFJvdWdobmVzczsKICAgICAgdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgPSBzb3VyY2UuY2xlYXJjb2F0Um91Z2huZXNzTWFwOwogICAgICB0aGlzLmNsZWFyY29hdE5vcm1hbE1hcCA9IHNvdXJjZS5jbGVhcmNvYXROb3JtYWxNYXA7CiAgICAgIHRoaXMuY2xlYXJjb2F0Tm9ybWFsU2NhbGUuY29weShzb3VyY2UuY2xlYXJjb2F0Tm9ybWFsU2NhbGUpOwogICAgICB0aGlzLnJlZmxlY3Rpdml0eSA9IHNvdXJjZS5yZWZsZWN0aXZpdHk7CiAgICAgIGlmIChzb3VyY2Uuc2hlZW4pIHsKICAgICAgICB0aGlzLnNoZWVuID0gKHRoaXMuc2hlZW4gfHwgbmV3IENvbG9yKCkpLmNvcHkoc291cmNlLnNoZWVuKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNoZWVuID0gbnVsbDsKICAgICAgfQogICAgICB0aGlzLnRyYW5zbWlzc2lvbiA9IHNvdXJjZS50cmFuc21pc3Npb247CiAgICAgIHRoaXMudHJhbnNtaXNzaW9uTWFwID0gc291cmNlLnRyYW5zbWlzc2lvbk1hcDsKICAgICAgdGhpcy50aGlja25lc3MgPSBzb3VyY2UudGhpY2tuZXNzOwogICAgICB0aGlzLnRoaWNrbmVzc01hcCA9IHNvdXJjZS50aGlja25lc3NNYXA7CiAgICAgIHRoaXMuYXR0ZW51YXRpb25EaXN0YW5jZSA9IHNvdXJjZS5hdHRlbnVhdGlvbkRpc3RhbmNlOwogICAgICB0aGlzLmF0dGVudWF0aW9uQ29sb3IuY29weShzb3VyY2UuYXR0ZW51YXRpb25Db2xvcik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgTWVzaFBoeXNpY2FsTWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaFBoeXNpY2FsTWF0ZXJpYWwgPSB0cnVlOwogIHZhciBNZXNoUGhvbmdNYXRlcmlhbCA9IGNsYXNzIGV4dGVuZHMgTWF0ZXJpYWwgewogICAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiTWVzaFBob25nTWF0ZXJpYWwiOwogICAgICB0aGlzLmNvbG9yID0gbmV3IENvbG9yKDE2Nzc3MjE1KTsKICAgICAgdGhpcy5zcGVjdWxhciA9IG5ldyBDb2xvcigxMTE4NDgxKTsKICAgICAgdGhpcy5zaGluaW5lc3MgPSAzMDsKICAgICAgdGhpcy5tYXAgPSBudWxsOwogICAgICB0aGlzLmxpZ2h0TWFwID0gbnVsbDsKICAgICAgdGhpcy5saWdodE1hcEludGVuc2l0eSA9IDE7CiAgICAgIHRoaXMuYW9NYXAgPSBudWxsOwogICAgICB0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMTsKICAgICAgdGhpcy5lbWlzc2l2ZSA9IG5ldyBDb2xvcigwKTsKICAgICAgdGhpcy5lbWlzc2l2ZUludGVuc2l0eSA9IDE7CiAgICAgIHRoaXMuZW1pc3NpdmVNYXAgPSBudWxsOwogICAgICB0aGlzLmJ1bXBNYXAgPSBudWxsOwogICAgICB0aGlzLmJ1bXBTY2FsZSA9IDE7CiAgICAgIHRoaXMubm9ybWFsTWFwID0gbnVsbDsKICAgICAgdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwogICAgICB0aGlzLm5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoMSwgMSk7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50TWFwID0gbnVsbDsKICAgICAgdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CiAgICAgIHRoaXMuc3BlY3VsYXJNYXAgPSBudWxsOwogICAgICB0aGlzLmFscGhhTWFwID0gbnVsbDsKICAgICAgdGhpcy5lbnZNYXAgPSBudWxsOwogICAgICB0aGlzLmNvbWJpbmUgPSBNdWx0aXBseU9wZXJhdGlvbjsKICAgICAgdGhpcy5yZWZsZWN0aXZpdHkgPSAxOwogICAgICB0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IDAuOTg7CiAgICAgIHRoaXMud2lyZWZyYW1lID0gZmFsc2U7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gInJvdW5kIjsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9ICJyb3VuZCI7CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gZmFsc2U7CiAgICAgIHRoaXMubW9ycGhOb3JtYWxzID0gZmFsc2U7CiAgICAgIHRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5zZXRWYWx1ZXMocGFyYW1ldGVycyk7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMuY29sb3IuY29weShzb3VyY2UuY29sb3IpOwogICAgICB0aGlzLnNwZWN1bGFyLmNvcHkoc291cmNlLnNwZWN1bGFyKTsKICAgICAgdGhpcy5zaGluaW5lc3MgPSBzb3VyY2Uuc2hpbmluZXNzOwogICAgICB0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CiAgICAgIHRoaXMubGlnaHRNYXAgPSBzb3VyY2UubGlnaHRNYXA7CiAgICAgIHRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSBzb3VyY2UubGlnaHRNYXBJbnRlbnNpdHk7CiAgICAgIHRoaXMuYW9NYXAgPSBzb3VyY2UuYW9NYXA7CiAgICAgIHRoaXMuYW9NYXBJbnRlbnNpdHkgPSBzb3VyY2UuYW9NYXBJbnRlbnNpdHk7CiAgICAgIHRoaXMuZW1pc3NpdmUuY29weShzb3VyY2UuZW1pc3NpdmUpOwogICAgICB0aGlzLmVtaXNzaXZlTWFwID0gc291cmNlLmVtaXNzaXZlTWFwOwogICAgICB0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gc291cmNlLmVtaXNzaXZlSW50ZW5zaXR5OwogICAgICB0aGlzLmJ1bXBNYXAgPSBzb3VyY2UuYnVtcE1hcDsKICAgICAgdGhpcy5idW1wU2NhbGUgPSBzb3VyY2UuYnVtcFNjYWxlOwogICAgICB0aGlzLm5vcm1hbE1hcCA9IHNvdXJjZS5ub3JtYWxNYXA7CiAgICAgIHRoaXMubm9ybWFsTWFwVHlwZSA9IHNvdXJjZS5ub3JtYWxNYXBUeXBlOwogICAgICB0aGlzLm5vcm1hbFNjYWxlLmNvcHkoc291cmNlLm5vcm1hbFNjYWxlKTsKICAgICAgdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwogICAgICB0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwogICAgICB0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSBzb3VyY2UuZGlzcGxhY2VtZW50QmlhczsKICAgICAgdGhpcy5zcGVjdWxhck1hcCA9IHNvdXJjZS5zcGVjdWxhck1hcDsKICAgICAgdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKICAgICAgdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwogICAgICB0aGlzLmNvbWJpbmUgPSBzb3VyY2UuY29tYmluZTsKICAgICAgdGhpcy5yZWZsZWN0aXZpdHkgPSBzb3VyY2UucmVmbGVjdGl2aXR5OwogICAgICB0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IHNvdXJjZS5yZWZyYWN0aW9uUmF0aW87CiAgICAgIHRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwogICAgICB0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSBzb3VyY2Uud2lyZWZyYW1lTGluZWNhcDsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9IHNvdXJjZS53aXJlZnJhbWVMaW5lam9pbjsKICAgICAgdGhpcy5tb3JwaFRhcmdldHMgPSBzb3VyY2UubW9ycGhUYXJnZXRzOwogICAgICB0aGlzLm1vcnBoTm9ybWFscyA9IHNvdXJjZS5tb3JwaE5vcm1hbHM7CiAgICAgIHRoaXMuZmxhdFNoYWRpbmcgPSBzb3VyY2UuZmxhdFNoYWRpbmc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgTWVzaFBob25nTWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaFBob25nTWF0ZXJpYWwgPSB0cnVlOwogIHZhciBNZXNoVG9vbk1hdGVyaWFsID0gY2xhc3MgZXh0ZW5kcyBNYXRlcmlhbCB7CiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuZGVmaW5lcyA9IHsgIlRPT04iOiAiIiB9OwogICAgICB0aGlzLnR5cGUgPSAiTWVzaFRvb25NYXRlcmlhbCI7CiAgICAgIHRoaXMuY29sb3IgPSBuZXcgQ29sb3IoMTY3NzcyMTUpOwogICAgICB0aGlzLm1hcCA9IG51bGw7CiAgICAgIHRoaXMuZ3JhZGllbnRNYXAgPSBudWxsOwogICAgICB0aGlzLmxpZ2h0TWFwID0gbnVsbDsKICAgICAgdGhpcy5saWdodE1hcEludGVuc2l0eSA9IDE7CiAgICAgIHRoaXMuYW9NYXAgPSBudWxsOwogICAgICB0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMTsKICAgICAgdGhpcy5lbWlzc2l2ZSA9IG5ldyBDb2xvcigwKTsKICAgICAgdGhpcy5lbWlzc2l2ZUludGVuc2l0eSA9IDE7CiAgICAgIHRoaXMuZW1pc3NpdmVNYXAgPSBudWxsOwogICAgICB0aGlzLmJ1bXBNYXAgPSBudWxsOwogICAgICB0aGlzLmJ1bXBTY2FsZSA9IDE7CiAgICAgIHRoaXMubm9ybWFsTWFwID0gbnVsbDsKICAgICAgdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwogICAgICB0aGlzLm5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoMSwgMSk7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50TWFwID0gbnVsbDsKICAgICAgdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CiAgICAgIHRoaXMuYWxwaGFNYXAgPSBudWxsOwogICAgICB0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwogICAgICB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZWNhcCA9ICJyb3VuZCI7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSAicm91bmQiOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IGZhbHNlOwogICAgICB0aGlzLm1vcnBoTm9ybWFscyA9IGZhbHNlOwogICAgICB0aGlzLnNldFZhbHVlcyhwYXJhbWV0ZXJzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5jb2xvci5jb3B5KHNvdXJjZS5jb2xvcik7CiAgICAgIHRoaXMubWFwID0gc291cmNlLm1hcDsKICAgICAgdGhpcy5ncmFkaWVudE1hcCA9IHNvdXJjZS5ncmFkaWVudE1hcDsKICAgICAgdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKICAgICAgdGhpcy5saWdodE1hcEludGVuc2l0eSA9IHNvdXJjZS5saWdodE1hcEludGVuc2l0eTsKICAgICAgdGhpcy5hb01hcCA9IHNvdXJjZS5hb01hcDsKICAgICAgdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKICAgICAgdGhpcy5lbWlzc2l2ZS5jb3B5KHNvdXJjZS5lbWlzc2l2ZSk7CiAgICAgIHRoaXMuZW1pc3NpdmVNYXAgPSBzb3VyY2UuZW1pc3NpdmVNYXA7CiAgICAgIHRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSBzb3VyY2UuZW1pc3NpdmVJbnRlbnNpdHk7CiAgICAgIHRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwogICAgICB0aGlzLmJ1bXBTY2FsZSA9IHNvdXJjZS5idW1wU2NhbGU7CiAgICAgIHRoaXMubm9ybWFsTWFwID0gc291cmNlLm5vcm1hbE1hcDsKICAgICAgdGhpcy5ub3JtYWxNYXBUeXBlID0gc291cmNlLm5vcm1hbE1hcFR5cGU7CiAgICAgIHRoaXMubm9ybWFsU2NhbGUuY29weShzb3VyY2Uubm9ybWFsU2NhbGUpOwogICAgICB0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwogICAgICB0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwogICAgICB0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gc291cmNlLndpcmVmcmFtZUxpbmVjYXA7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gc291cmNlLm1vcnBoVGFyZ2V0czsKICAgICAgdGhpcy5tb3JwaE5vcm1hbHMgPSBzb3VyY2UubW9ycGhOb3JtYWxzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIE1lc2hUb29uTWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaFRvb25NYXRlcmlhbCA9IHRydWU7CiAgdmFyIE1lc2hOb3JtYWxNYXRlcmlhbCA9IGNsYXNzIGV4dGVuZHMgTWF0ZXJpYWwgewogICAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiTWVzaE5vcm1hbE1hdGVyaWFsIjsKICAgICAgdGhpcy5idW1wTWFwID0gbnVsbDsKICAgICAgdGhpcy5idW1wU2NhbGUgPSAxOwogICAgICB0aGlzLm5vcm1hbE1hcCA9IG51bGw7CiAgICAgIHRoaXMubm9ybWFsTWFwVHlwZSA9IFRhbmdlbnRTcGFjZU5vcm1hbE1hcDsKICAgICAgdGhpcy5ub3JtYWxTY2FsZSA9IG5ldyBWZWN0b3IyKDEsIDEpOwogICAgICB0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwogICAgICB0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSAwOwogICAgICB0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwogICAgICB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CiAgICAgIHRoaXMuZm9nID0gZmFsc2U7CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gZmFsc2U7CiAgICAgIHRoaXMubW9ycGhOb3JtYWxzID0gZmFsc2U7CiAgICAgIHRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5zZXRWYWx1ZXMocGFyYW1ldGVycyk7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwogICAgICB0aGlzLmJ1bXBTY2FsZSA9IHNvdXJjZS5idW1wU2NhbGU7CiAgICAgIHRoaXMubm9ybWFsTWFwID0gc291cmNlLm5vcm1hbE1hcDsKICAgICAgdGhpcy5ub3JtYWxNYXBUeXBlID0gc291cmNlLm5vcm1hbE1hcFR5cGU7CiAgICAgIHRoaXMubm9ybWFsU2NhbGUuY29weShzb3VyY2Uubm9ybWFsU2NhbGUpOwogICAgICB0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwogICAgICB0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKICAgICAgdGhpcy5tb3JwaFRhcmdldHMgPSBzb3VyY2UubW9ycGhUYXJnZXRzOwogICAgICB0aGlzLm1vcnBoTm9ybWFscyA9IHNvdXJjZS5tb3JwaE5vcm1hbHM7CiAgICAgIHRoaXMuZmxhdFNoYWRpbmcgPSBzb3VyY2UuZmxhdFNoYWRpbmc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgTWVzaE5vcm1hbE1hdGVyaWFsLnByb3RvdHlwZS5pc01lc2hOb3JtYWxNYXRlcmlhbCA9IHRydWU7CiAgdmFyIE1lc2hMYW1iZXJ0TWF0ZXJpYWwgPSBjbGFzcyBleHRlbmRzIE1hdGVyaWFsIHsKICAgIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIk1lc2hMYW1iZXJ0TWF0ZXJpYWwiOwogICAgICB0aGlzLmNvbG9yID0gbmV3IENvbG9yKDE2Nzc3MjE1KTsKICAgICAgdGhpcy5tYXAgPSBudWxsOwogICAgICB0aGlzLmxpZ2h0TWFwID0gbnVsbDsKICAgICAgdGhpcy5saWdodE1hcEludGVuc2l0eSA9IDE7CiAgICAgIHRoaXMuYW9NYXAgPSBudWxsOwogICAgICB0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMTsKICAgICAgdGhpcy5lbWlzc2l2ZSA9IG5ldyBDb2xvcigwKTsKICAgICAgdGhpcy5lbWlzc2l2ZUludGVuc2l0eSA9IDE7CiAgICAgIHRoaXMuZW1pc3NpdmVNYXAgPSBudWxsOwogICAgICB0aGlzLnNwZWN1bGFyTWFwID0gbnVsbDsKICAgICAgdGhpcy5hbHBoYU1hcCA9IG51bGw7CiAgICAgIHRoaXMuZW52TWFwID0gbnVsbDsKICAgICAgdGhpcy5jb21iaW5lID0gTXVsdGlwbHlPcGVyYXRpb247CiAgICAgIHRoaXMucmVmbGVjdGl2aXR5ID0gMTsKICAgICAgdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSAwLjk4OwogICAgICB0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwogICAgICB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZWNhcCA9ICJyb3VuZCI7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSAicm91bmQiOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IGZhbHNlOwogICAgICB0aGlzLm1vcnBoTm9ybWFscyA9IGZhbHNlOwogICAgICB0aGlzLnNldFZhbHVlcyhwYXJhbWV0ZXJzKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5jb2xvci5jb3B5KHNvdXJjZS5jb2xvcik7CiAgICAgIHRoaXMubWFwID0gc291cmNlLm1hcDsKICAgICAgdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKICAgICAgdGhpcy5saWdodE1hcEludGVuc2l0eSA9IHNvdXJjZS5saWdodE1hcEludGVuc2l0eTsKICAgICAgdGhpcy5hb01hcCA9IHNvdXJjZS5hb01hcDsKICAgICAgdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKICAgICAgdGhpcy5lbWlzc2l2ZS5jb3B5KHNvdXJjZS5lbWlzc2l2ZSk7CiAgICAgIHRoaXMuZW1pc3NpdmVNYXAgPSBzb3VyY2UuZW1pc3NpdmVNYXA7CiAgICAgIHRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSBzb3VyY2UuZW1pc3NpdmVJbnRlbnNpdHk7CiAgICAgIHRoaXMuc3BlY3VsYXJNYXAgPSBzb3VyY2Uuc3BlY3VsYXJNYXA7CiAgICAgIHRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CiAgICAgIHRoaXMuZW52TWFwID0gc291cmNlLmVudk1hcDsKICAgICAgdGhpcy5jb21iaW5lID0gc291cmNlLmNvbWJpbmU7CiAgICAgIHRoaXMucmVmbGVjdGl2aXR5ID0gc291cmNlLnJlZmxlY3Rpdml0eTsKICAgICAgdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSBzb3VyY2UucmVmcmFjdGlvblJhdGlvOwogICAgICB0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKICAgICAgdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gc291cmNlLndpcmVmcmFtZUxpbmVjYXA7CiAgICAgIHRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CiAgICAgIHRoaXMubW9ycGhUYXJnZXRzID0gc291cmNlLm1vcnBoVGFyZ2V0czsKICAgICAgdGhpcy5tb3JwaE5vcm1hbHMgPSBzb3VyY2UubW9ycGhOb3JtYWxzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIE1lc2hMYW1iZXJ0TWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaExhbWJlcnRNYXRlcmlhbCA9IHRydWU7CiAgdmFyIE1lc2hNYXRjYXBNYXRlcmlhbCA9IGNsYXNzIGV4dGVuZHMgTWF0ZXJpYWwgewogICAgY29uc3RydWN0b3IocGFyYW1ldGVycykgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLmRlZmluZXMgPSB7ICJNQVRDQVAiOiAiIiB9OwogICAgICB0aGlzLnR5cGUgPSAiTWVzaE1hdGNhcE1hdGVyaWFsIjsKICAgICAgdGhpcy5jb2xvciA9IG5ldyBDb2xvcigxNjc3NzIxNSk7CiAgICAgIHRoaXMubWF0Y2FwID0gbnVsbDsKICAgICAgdGhpcy5tYXAgPSBudWxsOwogICAgICB0aGlzLmJ1bXBNYXAgPSBudWxsOwogICAgICB0aGlzLmJ1bXBTY2FsZSA9IDE7CiAgICAgIHRoaXMubm9ybWFsTWFwID0gbnVsbDsKICAgICAgdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwogICAgICB0aGlzLm5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoMSwgMSk7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50TWFwID0gbnVsbDsKICAgICAgdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CiAgICAgIHRoaXMuYWxwaGFNYXAgPSBudWxsOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IGZhbHNlOwogICAgICB0aGlzLm1vcnBoTm9ybWFscyA9IGZhbHNlOwogICAgICB0aGlzLmZsYXRTaGFkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuc2V0VmFsdWVzKHBhcmFtZXRlcnMpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLmRlZmluZXMgPSB7ICJNQVRDQVAiOiAiIiB9OwogICAgICB0aGlzLmNvbG9yLmNvcHkoc291cmNlLmNvbG9yKTsKICAgICAgdGhpcy5tYXRjYXAgPSBzb3VyY2UubWF0Y2FwOwogICAgICB0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CiAgICAgIHRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwogICAgICB0aGlzLmJ1bXBTY2FsZSA9IHNvdXJjZS5idW1wU2NhbGU7CiAgICAgIHRoaXMubm9ybWFsTWFwID0gc291cmNlLm5vcm1hbE1hcDsKICAgICAgdGhpcy5ub3JtYWxNYXBUeXBlID0gc291cmNlLm5vcm1hbE1hcFR5cGU7CiAgICAgIHRoaXMubm9ybWFsU2NhbGUuY29weShzb3VyY2Uubm9ybWFsU2NhbGUpOwogICAgICB0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CiAgICAgIHRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwogICAgICB0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwogICAgICB0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CiAgICAgIHRoaXMubW9ycGhOb3JtYWxzID0gc291cmNlLm1vcnBoTm9ybWFsczsKICAgICAgdGhpcy5mbGF0U2hhZGluZyA9IHNvdXJjZS5mbGF0U2hhZGluZzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBNZXNoTWF0Y2FwTWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaE1hdGNhcE1hdGVyaWFsID0gdHJ1ZTsKICB2YXIgTGluZURhc2hlZE1hdGVyaWFsID0gY2xhc3MgZXh0ZW5kcyBMaW5lQmFzaWNNYXRlcmlhbCB7CiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJMaW5lRGFzaGVkTWF0ZXJpYWwiOwogICAgICB0aGlzLnNjYWxlID0gMTsKICAgICAgdGhpcy5kYXNoU2l6ZSA9IDM7CiAgICAgIHRoaXMuZ2FwU2l6ZSA9IDE7CiAgICAgIHRoaXMuc2V0VmFsdWVzKHBhcmFtZXRlcnMpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLnNjYWxlID0gc291cmNlLnNjYWxlOwogICAgICB0aGlzLmRhc2hTaXplID0gc291cmNlLmRhc2hTaXplOwogICAgICB0aGlzLmdhcFNpemUgPSBzb3VyY2UuZ2FwU2l6ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBMaW5lRGFzaGVkTWF0ZXJpYWwucHJvdG90eXBlLmlzTGluZURhc2hlZE1hdGVyaWFsID0gdHJ1ZTsKICB2YXIgQW5pbWF0aW9uVXRpbHMgPSB7CiAgICBhcnJheVNsaWNlOiBmdW5jdGlvbihhcnJheSwgZnJvbSwgdG8pIHsKICAgICAgaWYgKEFuaW1hdGlvblV0aWxzLmlzVHlwZWRBcnJheShhcnJheSkpIHsKICAgICAgICByZXR1cm4gbmV3IGFycmF5LmNvbnN0cnVjdG9yKGFycmF5LnN1YmFycmF5KGZyb20sIHRvICE9PSB2b2lkIDAgPyB0byA6IGFycmF5Lmxlbmd0aCkpOwogICAgICB9CiAgICAgIHJldHVybiBhcnJheS5zbGljZShmcm9tLCB0byk7CiAgICB9LAogICAgY29udmVydEFycmF5OiBmdW5jdGlvbihhcnJheSwgdHlwZSwgZm9yY2VDbG9uZSkgewogICAgICBpZiAoIWFycmF5IHx8ICFmb3JjZUNsb25lICYmIGFycmF5LmNvbnN0cnVjdG9yID09PSB0eXBlKQogICAgICAgIHJldHVybiBhcnJheTsKICAgICAgaWYgKHR5cGVvZiB0eXBlLkJZVEVTX1BFUl9FTEVNRU5UID09PSAibnVtYmVyIikgewogICAgICAgIHJldHVybiBuZXcgdHlwZShhcnJheSk7CiAgICAgIH0KICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycmF5KTsKICAgIH0sCiAgICBpc1R5cGVkQXJyYXk6IGZ1bmN0aW9uKG9iamVjdCkgewogICAgICByZXR1cm4gQXJyYXlCdWZmZXIuaXNWaWV3KG9iamVjdCkgJiYgIShvYmplY3QgaW5zdGFuY2VvZiBEYXRhVmlldyk7CiAgICB9LAogICAgZ2V0S2V5ZnJhbWVPcmRlcjogZnVuY3Rpb24odGltZXMpIHsKICAgICAgZnVuY3Rpb24gY29tcGFyZVRpbWUoaSwgaikgewogICAgICAgIHJldHVybiB0aW1lc1tpXSAtIHRpbWVzW2pdOwogICAgICB9CiAgICAgIGNvbnN0IG4gPSB0aW1lcy5sZW5ndGg7CiAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBBcnJheShuKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47ICsraSkKICAgICAgICByZXN1bHRbaV0gPSBpOwogICAgICByZXN1bHQuc29ydChjb21wYXJlVGltZSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAogICAgc29ydGVkQXJyYXk6IGZ1bmN0aW9uKHZhbHVlcywgc3RyaWRlLCBvcmRlcikgewogICAgICBjb25zdCBuVmFsdWVzID0gdmFsdWVzLmxlbmd0aDsKICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IHZhbHVlcy5jb25zdHJ1Y3RvcihuVmFsdWVzKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGRzdE9mZnNldCA9IDA7IGRzdE9mZnNldCAhPT0gblZhbHVlczsgKytpKSB7CiAgICAgICAgY29uc3Qgc3JjT2Zmc2V0ID0gb3JkZXJbaV0gKiBzdHJpZGU7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHN0cmlkZTsgKytqKSB7CiAgICAgICAgICByZXN1bHRbZHN0T2Zmc2V0KytdID0gdmFsdWVzW3NyY09mZnNldCArIGpdOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKICAgIGZsYXR0ZW5KU09OOiBmdW5jdGlvbihqc29uS2V5cywgdGltZXMsIHZhbHVlcywgdmFsdWVQcm9wZXJ0eU5hbWUpIHsKICAgICAgbGV0IGkgPSAxLCBrZXkgPSBqc29uS2V5c1swXTsKICAgICAgd2hpbGUgKGtleSAhPT0gdm9pZCAwICYmIGtleVt2YWx1ZVByb3BlcnR5TmFtZV0gPT09IHZvaWQgMCkgewogICAgICAgIGtleSA9IGpzb25LZXlzW2krK107CiAgICAgIH0KICAgICAgaWYgKGtleSA9PT0gdm9pZCAwKQogICAgICAgIHJldHVybjsKICAgICAgbGV0IHZhbHVlID0ga2V5W3ZhbHVlUHJvcGVydHlOYW1lXTsKICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDApCiAgICAgICAgcmV0dXJuOwogICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICBkbyB7CiAgICAgICAgICB2YWx1ZSA9IGtleVt2YWx1ZVByb3BlcnR5TmFtZV07CiAgICAgICAgICBpZiAodmFsdWUgIT09IHZvaWQgMCkgewogICAgICAgICAgICB0aW1lcy5wdXNoKGtleS50aW1lKTsKICAgICAgICAgICAgdmFsdWVzLnB1c2guYXBwbHkodmFsdWVzLCB2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBrZXkgPSBqc29uS2V5c1tpKytdOwogICAgICAgIH0gd2hpbGUgKGtleSAhPT0gdm9pZCAwKTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZS50b0FycmF5ICE9PSB2b2lkIDApIHsKICAgICAgICBkbyB7CiAgICAgICAgICB2YWx1ZSA9IGtleVt2YWx1ZVByb3BlcnR5TmFtZV07CiAgICAgICAgICBpZiAodmFsdWUgIT09IHZvaWQgMCkgewogICAgICAgICAgICB0aW1lcy5wdXNoKGtleS50aW1lKTsKICAgICAgICAgICAgdmFsdWUudG9BcnJheSh2YWx1ZXMsIHZhbHVlcy5sZW5ndGgpOwogICAgICAgICAgfQogICAgICAgICAga2V5ID0ganNvbktleXNbaSsrXTsKICAgICAgICB9IHdoaWxlIChrZXkgIT09IHZvaWQgMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZG8gewogICAgICAgICAgdmFsdWUgPSBrZXlbdmFsdWVQcm9wZXJ0eU5hbWVdOwogICAgICAgICAgaWYgKHZhbHVlICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgdGltZXMucHVzaChrZXkudGltZSk7CiAgICAgICAgICAgIHZhbHVlcy5wdXNoKHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICAgIGtleSA9IGpzb25LZXlzW2krK107CiAgICAgICAgfSB3aGlsZSAoa2V5ICE9PSB2b2lkIDApOwogICAgICB9CiAgICB9LAogICAgc3ViY2xpcDogZnVuY3Rpb24oc291cmNlQ2xpcCwgbmFtZSwgc3RhcnRGcmFtZSwgZW5kRnJhbWUsIGZwcyA9IDMwKSB7CiAgICAgIGNvbnN0IGNsaXAgPSBzb3VyY2VDbGlwLmNsb25lKCk7CiAgICAgIGNsaXAubmFtZSA9IG5hbWU7CiAgICAgIGNvbnN0IHRyYWNrcyA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNsaXAudHJhY2tzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgY29uc3QgdHJhY2sgPSBjbGlwLnRyYWNrc1tpXTsKICAgICAgICBjb25zdCB2YWx1ZVNpemUgPSB0cmFjay5nZXRWYWx1ZVNpemUoKTsKICAgICAgICBjb25zdCB0aW1lcyA9IFtdOwogICAgICAgIGNvbnN0IHZhbHVlcyA9IFtdOwogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdHJhY2sudGltZXMubGVuZ3RoOyArK2opIHsKICAgICAgICAgIGNvbnN0IGZyYW1lID0gdHJhY2sudGltZXNbal0gKiBmcHM7CiAgICAgICAgICBpZiAoZnJhbWUgPCBzdGFydEZyYW1lIHx8IGZyYW1lID49IGVuZEZyYW1lKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIHRpbWVzLnB1c2godHJhY2sudGltZXNbal0pOwogICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB2YWx1ZVNpemU7ICsraykgewogICAgICAgICAgICB2YWx1ZXMucHVzaCh0cmFjay52YWx1ZXNbaiAqIHZhbHVlU2l6ZSArIGtdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRpbWVzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIHRyYWNrLnRpbWVzID0gQW5pbWF0aW9uVXRpbHMuY29udmVydEFycmF5KHRpbWVzLCB0cmFjay50aW1lcy5jb25zdHJ1Y3Rvcik7CiAgICAgICAgdHJhY2sudmFsdWVzID0gQW5pbWF0aW9uVXRpbHMuY29udmVydEFycmF5KHZhbHVlcywgdHJhY2sudmFsdWVzLmNvbnN0cnVjdG9yKTsKICAgICAgICB0cmFja3MucHVzaCh0cmFjayk7CiAgICAgIH0KICAgICAgY2xpcC50cmFja3MgPSB0cmFja3M7CiAgICAgIGxldCBtaW5TdGFydFRpbWUgPSBJbmZpbml0eTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjbGlwLnRyYWNrcy5sZW5ndGg7ICsraSkgewogICAgICAgIGlmIChtaW5TdGFydFRpbWUgPiBjbGlwLnRyYWNrc1tpXS50aW1lc1swXSkgewogICAgICAgICAgbWluU3RhcnRUaW1lID0gY2xpcC50cmFja3NbaV0udGltZXNbMF07CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2xpcC50cmFja3MubGVuZ3RoOyArK2kpIHsKICAgICAgICBjbGlwLnRyYWNrc1tpXS5zaGlmdCgtMSAqIG1pblN0YXJ0VGltZSk7CiAgICAgIH0KICAgICAgY2xpcC5yZXNldER1cmF0aW9uKCk7CiAgICAgIHJldHVybiBjbGlwOwogICAgfSwKICAgIG1ha2VDbGlwQWRkaXRpdmU6IGZ1bmN0aW9uKHRhcmdldENsaXAsIHJlZmVyZW5jZUZyYW1lID0gMCwgcmVmZXJlbmNlQ2xpcCA9IHRhcmdldENsaXAsIGZwcyA9IDMwKSB7CiAgICAgIGlmIChmcHMgPD0gMCkKICAgICAgICBmcHMgPSAzMDsKICAgICAgY29uc3QgbnVtVHJhY2tzID0gcmVmZXJlbmNlQ2xpcC50cmFja3MubGVuZ3RoOwogICAgICBjb25zdCByZWZlcmVuY2VUaW1lID0gcmVmZXJlbmNlRnJhbWUgLyBmcHM7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVHJhY2tzOyArK2kpIHsKICAgICAgICBjb25zdCByZWZlcmVuY2VUcmFjayA9IHJlZmVyZW5jZUNsaXAudHJhY2tzW2ldOwogICAgICAgIGNvbnN0IHJlZmVyZW5jZVRyYWNrVHlwZSA9IHJlZmVyZW5jZVRyYWNrLlZhbHVlVHlwZU5hbWU7CiAgICAgICAgaWYgKHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gImJvb2wiIHx8IHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gInN0cmluZyIpCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICBjb25zdCB0YXJnZXRUcmFjayA9IHRhcmdldENsaXAudHJhY2tzLmZpbmQoZnVuY3Rpb24odHJhY2spIHsKICAgICAgICAgIHJldHVybiB0cmFjay5uYW1lID09PSByZWZlcmVuY2VUcmFjay5uYW1lICYmIHRyYWNrLlZhbHVlVHlwZU5hbWUgPT09IHJlZmVyZW5jZVRyYWNrVHlwZTsKICAgICAgICB9KTsKICAgICAgICBpZiAodGFyZ2V0VHJhY2sgPT09IHZvaWQgMCkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGxldCByZWZlcmVuY2VPZmZzZXQgPSAwOwogICAgICAgIGNvbnN0IHJlZmVyZW5jZVZhbHVlU2l6ZSA9IHJlZmVyZW5jZVRyYWNrLmdldFZhbHVlU2l6ZSgpOwogICAgICAgIGlmIChyZWZlcmVuY2VUcmFjay5jcmVhdGVJbnRlcnBvbGFudC5pc0ludGVycG9sYW50RmFjdG9yeU1ldGhvZEdMVEZDdWJpY1NwbGluZSkgewogICAgICAgICAgcmVmZXJlbmNlT2Zmc2V0ID0gcmVmZXJlbmNlVmFsdWVTaXplIC8gMzsKICAgICAgICB9CiAgICAgICAgbGV0IHRhcmdldE9mZnNldCA9IDA7CiAgICAgICAgY29uc3QgdGFyZ2V0VmFsdWVTaXplID0gdGFyZ2V0VHJhY2suZ2V0VmFsdWVTaXplKCk7CiAgICAgICAgaWYgKHRhcmdldFRyYWNrLmNyZWF0ZUludGVycG9sYW50LmlzSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kR0xURkN1YmljU3BsaW5lKSB7CiAgICAgICAgICB0YXJnZXRPZmZzZXQgPSB0YXJnZXRWYWx1ZVNpemUgLyAzOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYXN0SW5kZXggPSByZWZlcmVuY2VUcmFjay50aW1lcy5sZW5ndGggLSAxOwogICAgICAgIGxldCByZWZlcmVuY2VWYWx1ZTsKICAgICAgICBpZiAocmVmZXJlbmNlVGltZSA8PSByZWZlcmVuY2VUcmFjay50aW1lc1swXSkgewogICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IHJlZmVyZW5jZU9mZnNldDsKICAgICAgICAgIGNvbnN0IGVuZEluZGV4ID0gcmVmZXJlbmNlVmFsdWVTaXplIC0gcmVmZXJlbmNlT2Zmc2V0OwogICAgICAgICAgcmVmZXJlbmNlVmFsdWUgPSBBbmltYXRpb25VdGlscy5hcnJheVNsaWNlKHJlZmVyZW5jZVRyYWNrLnZhbHVlcywgc3RhcnRJbmRleCwgZW5kSW5kZXgpOwogICAgICAgIH0gZWxzZSBpZiAocmVmZXJlbmNlVGltZSA+PSByZWZlcmVuY2VUcmFjay50aW1lc1tsYXN0SW5kZXhdKSB7CiAgICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gbGFzdEluZGV4ICogcmVmZXJlbmNlVmFsdWVTaXplICsgcmVmZXJlbmNlT2Zmc2V0OwogICAgICAgICAgY29uc3QgZW5kSW5kZXggPSBzdGFydEluZGV4ICsgcmVmZXJlbmNlVmFsdWVTaXplIC0gcmVmZXJlbmNlT2Zmc2V0OwogICAgICAgICAgcmVmZXJlbmNlVmFsdWUgPSBBbmltYXRpb25VdGlscy5hcnJheVNsaWNlKHJlZmVyZW5jZVRyYWNrLnZhbHVlcywgc3RhcnRJbmRleCwgZW5kSW5kZXgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnRlcnBvbGFudCA9IHJlZmVyZW5jZVRyYWNrLmNyZWF0ZUludGVycG9sYW50KCk7CiAgICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gcmVmZXJlbmNlT2Zmc2V0OwogICAgICAgICAgY29uc3QgZW5kSW5kZXggPSByZWZlcmVuY2VWYWx1ZVNpemUgLSByZWZlcmVuY2VPZmZzZXQ7CiAgICAgICAgICBpbnRlcnBvbGFudC5ldmFsdWF0ZShyZWZlcmVuY2VUaW1lKTsKICAgICAgICAgIHJlZmVyZW5jZVZhbHVlID0gQW5pbWF0aW9uVXRpbHMuYXJyYXlTbGljZShpbnRlcnBvbGFudC5yZXN1bHRCdWZmZXIsIHN0YXJ0SW5kZXgsIGVuZEluZGV4KTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gInF1YXRlcm5pb24iKSB7CiAgICAgICAgICBjb25zdCByZWZlcmVuY2VRdWF0ID0gbmV3IFF1YXRlcm5pb24oKS5mcm9tQXJyYXkocmVmZXJlbmNlVmFsdWUpLm5vcm1hbGl6ZSgpLmNvbmp1Z2F0ZSgpOwogICAgICAgICAgcmVmZXJlbmNlUXVhdC50b0FycmF5KHJlZmVyZW5jZVZhbHVlKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbnVtVGltZXMgPSB0YXJnZXRUcmFjay50aW1lcy5sZW5ndGg7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBudW1UaW1lczsgKytqKSB7CiAgICAgICAgICBjb25zdCB2YWx1ZVN0YXJ0ID0gaiAqIHRhcmdldFZhbHVlU2l6ZSArIHRhcmdldE9mZnNldDsKICAgICAgICAgIGlmIChyZWZlcmVuY2VUcmFja1R5cGUgPT09ICJxdWF0ZXJuaW9uIikgewogICAgICAgICAgICBRdWF0ZXJuaW9uLm11bHRpcGx5UXVhdGVybmlvbnNGbGF0KHRhcmdldFRyYWNrLnZhbHVlcywgdmFsdWVTdGFydCwgcmVmZXJlbmNlVmFsdWUsIDAsIHRhcmdldFRyYWNrLnZhbHVlcywgdmFsdWVTdGFydCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCB2YWx1ZUVuZCA9IHRhcmdldFZhbHVlU2l6ZSAtIHRhcmdldE9mZnNldCAqIDI7CiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgdmFsdWVFbmQ7ICsraykgewogICAgICAgICAgICAgIHRhcmdldFRyYWNrLnZhbHVlc1t2YWx1ZVN0YXJ0ICsga10gLT0gcmVmZXJlbmNlVmFsdWVba107CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgdGFyZ2V0Q2xpcC5ibGVuZE1vZGUgPSBBZGRpdGl2ZUFuaW1hdGlvbkJsZW5kTW9kZTsKICAgICAgcmV0dXJuIHRhcmdldENsaXA7CiAgICB9CiAgfTsKICB2YXIgSW50ZXJwb2xhbnQgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyKSB7CiAgICAgIHRoaXMucGFyYW1ldGVyUG9zaXRpb25zID0gcGFyYW1ldGVyUG9zaXRpb25zOwogICAgICB0aGlzLl9jYWNoZWRJbmRleCA9IDA7CiAgICAgIHRoaXMucmVzdWx0QnVmZmVyID0gcmVzdWx0QnVmZmVyICE9PSB2b2lkIDAgPyByZXN1bHRCdWZmZXIgOiBuZXcgc2FtcGxlVmFsdWVzLmNvbnN0cnVjdG9yKHNhbXBsZVNpemUpOwogICAgICB0aGlzLnNhbXBsZVZhbHVlcyA9IHNhbXBsZVZhbHVlczsKICAgICAgdGhpcy52YWx1ZVNpemUgPSBzYW1wbGVTaXplOwogICAgICB0aGlzLnNldHRpbmdzID0gbnVsbDsKICAgICAgdGhpcy5EZWZhdWx0U2V0dGluZ3NfID0ge307CiAgICB9CiAgICBldmFsdWF0ZSh0KSB7CiAgICAgIGNvbnN0IHBwID0gdGhpcy5wYXJhbWV0ZXJQb3NpdGlvbnM7CiAgICAgIGxldCBpMSA9IHRoaXMuX2NhY2hlZEluZGV4LCB0MSA9IHBwW2kxXSwgdDAgPSBwcFtpMSAtIDFdOwogICAgICB2YWxpZGF0ZV9pbnRlcnZhbDogewogICAgICAgIHNlZWs6IHsKICAgICAgICAgIGxldCByaWdodDsKICAgICAgICAgIGxpbmVhcl9zY2FuOiB7CiAgICAgICAgICAgIGZvcndhcmRfc2NhbjoKICAgICAgICAgICAgICBpZiAoISh0IDwgdDEpKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBnaXZlVXBBdCA9IGkxICsgMjsgOyApIHsKICAgICAgICAgICAgICAgICAgaWYgKHQxID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAodCA8IHQwKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgZm9yd2FyZF9zY2FuOwogICAgICAgICAgICAgICAgICAgIGkxID0gcHAubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhY2hlZEluZGV4ID0gaTE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWZ0ZXJFbmRfKGkxIC0gMSwgdCwgdDApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChpMSA9PT0gZ2l2ZVVwQXQpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIHQwID0gdDE7CiAgICAgICAgICAgICAgICAgIHQxID0gcHBbKytpMV07CiAgICAgICAgICAgICAgICAgIGlmICh0IDwgdDEpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBzZWVrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByaWdodCA9IHBwLmxlbmd0aDsKICAgICAgICAgICAgICAgIGJyZWFrIGxpbmVhcl9zY2FuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCEodCA+PSB0MCkpIHsKICAgICAgICAgICAgICBjb25zdCB0MWdsb2JhbCA9IHBwWzFdOwogICAgICAgICAgICAgIGlmICh0IDwgdDFnbG9iYWwpIHsKICAgICAgICAgICAgICAgIGkxID0gMjsKICAgICAgICAgICAgICAgIHQwID0gdDFnbG9iYWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZvciAobGV0IGdpdmVVcEF0ID0gaTEgLSAyOyA7ICkgewogICAgICAgICAgICAgICAgaWYgKHQwID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fY2FjaGVkSW5kZXggPSAwOwogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5iZWZvcmVTdGFydF8oMCwgdCwgdDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGkxID09PSBnaXZlVXBBdCkKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB0MSA9IHQwOwogICAgICAgICAgICAgICAgdDAgPSBwcFstLWkxIC0gMV07CiAgICAgICAgICAgICAgICBpZiAodCA+PSB0MCkgewogICAgICAgICAgICAgICAgICBicmVhayBzZWVrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByaWdodCA9IGkxOwogICAgICAgICAgICAgIGkxID0gMDsKICAgICAgICAgICAgICBicmVhayBsaW5lYXJfc2NhbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhayB2YWxpZGF0ZV9pbnRlcnZhbDsKICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChpMSA8IHJpZ2h0KSB7CiAgICAgICAgICAgIGNvbnN0IG1pZCA9IGkxICsgcmlnaHQgPj4+IDE7CiAgICAgICAgICAgIGlmICh0IDwgcHBbbWlkXSkgewogICAgICAgICAgICAgIHJpZ2h0ID0gbWlkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGkxID0gbWlkICsgMTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdDEgPSBwcFtpMV07CiAgICAgICAgICB0MCA9IHBwW2kxIC0gMV07CiAgICAgICAgICBpZiAodDAgPT09IHZvaWQgMCkgewogICAgICAgICAgICB0aGlzLl9jYWNoZWRJbmRleCA9IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJlZm9yZVN0YXJ0XygwLCB0LCB0MSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodDEgPT09IHZvaWQgMCkgewogICAgICAgICAgICBpMSA9IHBwLmxlbmd0aDsKICAgICAgICAgICAgdGhpcy5fY2FjaGVkSW5kZXggPSBpMTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWZ0ZXJFbmRfKGkxIC0gMSwgdDAsIHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLl9jYWNoZWRJbmRleCA9IGkxOwogICAgICAgIHRoaXMuaW50ZXJ2YWxDaGFuZ2VkXyhpMSwgdDAsIHQxKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5pbnRlcnBvbGF0ZV8oaTEsIHQwLCB0LCB0MSk7CiAgICB9CiAgICBnZXRTZXR0aW5nc18oKSB7CiAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzIHx8IHRoaXMuRGVmYXVsdFNldHRpbmdzXzsKICAgIH0KICAgIGNvcHlTYW1wbGVWYWx1ZV8oaW5kZXgpIHsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHRCdWZmZXIsIHZhbHVlcyA9IHRoaXMuc2FtcGxlVmFsdWVzLCBzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwgb2Zmc2V0ID0gaW5kZXggKiBzdHJpZGU7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzdHJpZGU7ICsraSkgewogICAgICAgIHJlc3VsdFtpXSA9IHZhbHVlc1tvZmZzZXQgKyBpXTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgaW50ZXJwb2xhdGVfKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoImNhbGwgdG8gYWJzdHJhY3QgbWV0aG9kIik7CiAgICB9CiAgICBpbnRlcnZhbENoYW5nZWRfKCkgewogICAgfQogIH07CiAgSW50ZXJwb2xhbnQucHJvdG90eXBlLmJlZm9yZVN0YXJ0XyA9IEludGVycG9sYW50LnByb3RvdHlwZS5jb3B5U2FtcGxlVmFsdWVfOwogIEludGVycG9sYW50LnByb3RvdHlwZS5hZnRlckVuZF8gPSBJbnRlcnBvbGFudC5wcm90b3R5cGUuY29weVNhbXBsZVZhbHVlXzsKICB2YXIgQ3ViaWNJbnRlcnBvbGFudCA9IGNsYXNzIGV4dGVuZHMgSW50ZXJwb2xhbnQgewogICAgY29uc3RydWN0b3IocGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlcikgewogICAgICBzdXBlcihwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyKTsKICAgICAgdGhpcy5fd2VpZ2h0UHJldiA9IC0wOwogICAgICB0aGlzLl9vZmZzZXRQcmV2ID0gLTA7CiAgICAgIHRoaXMuX3dlaWdodE5leHQgPSAtMDsKICAgICAgdGhpcy5fb2Zmc2V0TmV4dCA9IC0wOwogICAgICB0aGlzLkRlZmF1bHRTZXR0aW5nc18gPSB7CiAgICAgICAgZW5kaW5nU3RhcnQ6IFplcm9DdXJ2YXR1cmVFbmRpbmcsCiAgICAgICAgZW5kaW5nRW5kOiBaZXJvQ3VydmF0dXJlRW5kaW5nCiAgICAgIH07CiAgICB9CiAgICBpbnRlcnZhbENoYW5nZWRfKGkxLCB0MCwgdDEpIHsKICAgICAgY29uc3QgcHAgPSB0aGlzLnBhcmFtZXRlclBvc2l0aW9uczsKICAgICAgbGV0IGlQcmV2ID0gaTEgLSAyLCBpTmV4dCA9IGkxICsgMSwgdFByZXYgPSBwcFtpUHJldl0sIHROZXh0ID0gcHBbaU5leHRdOwogICAgICBpZiAodFByZXYgPT09IHZvaWQgMCkgewogICAgICAgIHN3aXRjaCAodGhpcy5nZXRTZXR0aW5nc18oKS5lbmRpbmdTdGFydCkgewogICAgICAgICAgY2FzZSBaZXJvU2xvcGVFbmRpbmc6CiAgICAgICAgICAgIGlQcmV2ID0gaTE7CiAgICAgICAgICAgIHRQcmV2ID0gMiAqIHQwIC0gdDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBXcmFwQXJvdW5kRW5kaW5nOgogICAgICAgICAgICBpUHJldiA9IHBwLmxlbmd0aCAtIDI7CiAgICAgICAgICAgIHRQcmV2ID0gdDAgKyBwcFtpUHJldl0gLSBwcFtpUHJldiArIDFdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGlQcmV2ID0gaTE7CiAgICAgICAgICAgIHRQcmV2ID0gdDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0TmV4dCA9PT0gdm9pZCAwKSB7CiAgICAgICAgc3dpdGNoICh0aGlzLmdldFNldHRpbmdzXygpLmVuZGluZ0VuZCkgewogICAgICAgICAgY2FzZSBaZXJvU2xvcGVFbmRpbmc6CiAgICAgICAgICAgIGlOZXh0ID0gaTE7CiAgICAgICAgICAgIHROZXh0ID0gMiAqIHQxIC0gdDA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBXcmFwQXJvdW5kRW5kaW5nOgogICAgICAgICAgICBpTmV4dCA9IDE7CiAgICAgICAgICAgIHROZXh0ID0gdDEgKyBwcFsxXSAtIHBwWzBdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGlOZXh0ID0gaTEgLSAxOwogICAgICAgICAgICB0TmV4dCA9IHQwOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBoYWxmRHQgPSAodDEgLSB0MCkgKiAwLjUsIHN0cmlkZSA9IHRoaXMudmFsdWVTaXplOwogICAgICB0aGlzLl93ZWlnaHRQcmV2ID0gaGFsZkR0IC8gKHQwIC0gdFByZXYpOwogICAgICB0aGlzLl93ZWlnaHROZXh0ID0gaGFsZkR0IC8gKHROZXh0IC0gdDEpOwogICAgICB0aGlzLl9vZmZzZXRQcmV2ID0gaVByZXYgKiBzdHJpZGU7CiAgICAgIHRoaXMuX29mZnNldE5leHQgPSBpTmV4dCAqIHN0cmlkZTsKICAgIH0KICAgIGludGVycG9sYXRlXyhpMSwgdDAsIHQsIHQxKSB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0QnVmZmVyLCB2YWx1ZXMgPSB0aGlzLnNhbXBsZVZhbHVlcywgc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsIG8xID0gaTEgKiBzdHJpZGUsIG8wID0gbzEgLSBzdHJpZGUsIG9QID0gdGhpcy5fb2Zmc2V0UHJldiwgb04gPSB0aGlzLl9vZmZzZXROZXh0LCB3UCA9IHRoaXMuX3dlaWdodFByZXYsIHdOID0gdGhpcy5fd2VpZ2h0TmV4dCwgcCA9ICh0IC0gdDApIC8gKHQxIC0gdDApLCBwcCA9IHAgKiBwLCBwcHAgPSBwcCAqIHA7CiAgICAgIGNvbnN0IHNQID0gLXdQICogcHBwICsgMiAqIHdQICogcHAgLSB3UCAqIHA7CiAgICAgIGNvbnN0IHMwID0gKDEgKyB3UCkgKiBwcHAgKyAoLTEuNSAtIDIgKiB3UCkgKiBwcCArICgtMC41ICsgd1ApICogcCArIDE7CiAgICAgIGNvbnN0IHMxID0gKC0xIC0gd04pICogcHBwICsgKDEuNSArIHdOKSAqIHBwICsgMC41ICogcDsKICAgICAgY29uc3Qgc04gPSB3TiAqIHBwcCAtIHdOICogcHA7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzdHJpZGU7ICsraSkgewogICAgICAgIHJlc3VsdFtpXSA9IHNQICogdmFsdWVzW29QICsgaV0gKyBzMCAqIHZhbHVlc1tvMCArIGldICsgczEgKiB2YWx1ZXNbbzEgKyBpXSArIHNOICogdmFsdWVzW29OICsgaV07CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9OwogIHZhciBMaW5lYXJJbnRlcnBvbGFudCA9IGNsYXNzIGV4dGVuZHMgSW50ZXJwb2xhbnQgewogICAgY29uc3RydWN0b3IocGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlcikgewogICAgICBzdXBlcihwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyKTsKICAgIH0KICAgIGludGVycG9sYXRlXyhpMSwgdDAsIHQsIHQxKSB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0QnVmZmVyLCB2YWx1ZXMgPSB0aGlzLnNhbXBsZVZhbHVlcywgc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsIG9mZnNldDEgPSBpMSAqIHN0cmlkZSwgb2Zmc2V0MCA9IG9mZnNldDEgLSBzdHJpZGUsIHdlaWdodDEgPSAodCAtIHQwKSAvICh0MSAtIHQwKSwgd2VpZ2h0MCA9IDEgLSB3ZWlnaHQxOwogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gc3RyaWRlOyArK2kpIHsKICAgICAgICByZXN1bHRbaV0gPSB2YWx1ZXNbb2Zmc2V0MCArIGldICogd2VpZ2h0MCArIHZhbHVlc1tvZmZzZXQxICsgaV0gKiB3ZWlnaHQxOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKICB2YXIgRGlzY3JldGVJbnRlcnBvbGFudCA9IGNsYXNzIGV4dGVuZHMgSW50ZXJwb2xhbnQgewogICAgY29uc3RydWN0b3IocGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlcikgewogICAgICBzdXBlcihwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyKTsKICAgIH0KICAgIGludGVycG9sYXRlXyhpMSkgewogICAgICByZXR1cm4gdGhpcy5jb3B5U2FtcGxlVmFsdWVfKGkxIC0gMSk7CiAgICB9CiAgfTsKICB2YXIgS2V5ZnJhbWVUcmFjayA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKG5hbWUsIHRpbWVzLCB2YWx1ZXMsIGludGVycG9sYXRpb24pIHsKICAgICAgaWYgKG5hbWUgPT09IHZvaWQgMCkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRIUkVFLktleWZyYW1lVHJhY2s6IHRyYWNrIG5hbWUgaXMgdW5kZWZpbmVkIik7CiAgICAgIGlmICh0aW1lcyA9PT0gdm9pZCAwIHx8IHRpbWVzLmxlbmd0aCA9PT0gMCkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRIUkVFLktleWZyYW1lVHJhY2s6IG5vIGtleWZyYW1lcyBpbiB0cmFjayBuYW1lZCAiICsgbmFtZSk7CiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMudGltZXMgPSBBbmltYXRpb25VdGlscy5jb252ZXJ0QXJyYXkodGltZXMsIHRoaXMuVGltZUJ1ZmZlclR5cGUpOwogICAgICB0aGlzLnZhbHVlcyA9IEFuaW1hdGlvblV0aWxzLmNvbnZlcnRBcnJheSh2YWx1ZXMsIHRoaXMuVmFsdWVCdWZmZXJUeXBlKTsKICAgICAgdGhpcy5zZXRJbnRlcnBvbGF0aW9uKGludGVycG9sYXRpb24gfHwgdGhpcy5EZWZhdWx0SW50ZXJwb2xhdGlvbik7CiAgICB9CiAgICBzdGF0aWMgdG9KU09OKHRyYWNrKSB7CiAgICAgIGNvbnN0IHRyYWNrVHlwZSA9IHRyYWNrLmNvbnN0cnVjdG9yOwogICAgICBsZXQganNvbjsKICAgICAgaWYgKHRyYWNrVHlwZS50b0pTT04gIT09IHRoaXMudG9KU09OKSB7CiAgICAgICAganNvbiA9IHRyYWNrVHlwZS50b0pTT04odHJhY2spOwogICAgICB9IGVsc2UgewogICAgICAgIGpzb24gPSB7CiAgICAgICAgICAibmFtZSI6IHRyYWNrLm5hbWUsCiAgICAgICAgICAidGltZXMiOiBBbmltYXRpb25VdGlscy5jb252ZXJ0QXJyYXkodHJhY2sudGltZXMsIEFycmF5KSwKICAgICAgICAgICJ2YWx1ZXMiOiBBbmltYXRpb25VdGlscy5jb252ZXJ0QXJyYXkodHJhY2sudmFsdWVzLCBBcnJheSkKICAgICAgICB9OwogICAgICAgIGNvbnN0IGludGVycG9sYXRpb24gPSB0cmFjay5nZXRJbnRlcnBvbGF0aW9uKCk7CiAgICAgICAgaWYgKGludGVycG9sYXRpb24gIT09IHRyYWNrLkRlZmF1bHRJbnRlcnBvbGF0aW9uKSB7CiAgICAgICAgICBqc29uLmludGVycG9sYXRpb24gPSBpbnRlcnBvbGF0aW9uOwogICAgICAgIH0KICAgICAgfQogICAgICBqc29uLnR5cGUgPSB0cmFjay5WYWx1ZVR5cGVOYW1lOwogICAgICByZXR1cm4ganNvbjsKICAgIH0KICAgIEludGVycG9sYW50RmFjdG9yeU1ldGhvZERpc2NyZXRlKHJlc3VsdCkgewogICAgICByZXR1cm4gbmV3IERpc2NyZXRlSW50ZXJwb2xhbnQodGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCksIHJlc3VsdCk7CiAgICB9CiAgICBJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXIocmVzdWx0KSB7CiAgICAgIHJldHVybiBuZXcgTGluZWFySW50ZXJwb2xhbnQodGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCksIHJlc3VsdCk7CiAgICB9CiAgICBJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGgocmVzdWx0KSB7CiAgICAgIHJldHVybiBuZXcgQ3ViaWNJbnRlcnBvbGFudCh0aGlzLnRpbWVzLCB0aGlzLnZhbHVlcywgdGhpcy5nZXRWYWx1ZVNpemUoKSwgcmVzdWx0KTsKICAgIH0KICAgIHNldEludGVycG9sYXRpb24oaW50ZXJwb2xhdGlvbikgewogICAgICBsZXQgZmFjdG9yeU1ldGhvZDsKICAgICAgc3dpdGNoIChpbnRlcnBvbGF0aW9uKSB7CiAgICAgICAgY2FzZSBJbnRlcnBvbGF0ZURpc2NyZXRlOgogICAgICAgICAgZmFjdG9yeU1ldGhvZCA9IHRoaXMuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kRGlzY3JldGU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEludGVycG9sYXRlTGluZWFyOgogICAgICAgICAgZmFjdG9yeU1ldGhvZCA9IHRoaXMuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kTGluZWFyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBJbnRlcnBvbGF0ZVNtb290aDoKICAgICAgICAgIGZhY3RvcnlNZXRob2QgPSB0aGlzLkludGVycG9sYW50RmFjdG9yeU1ldGhvZFNtb290aDsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChmYWN0b3J5TWV0aG9kID09PSB2b2lkIDApIHsKICAgICAgICBjb25zdCBtZXNzYWdlID0gInVuc3VwcG9ydGVkIGludGVycG9sYXRpb24gZm9yICIgKyB0aGlzLlZhbHVlVHlwZU5hbWUgKyAiIGtleWZyYW1lIHRyYWNrIG5hbWVkICIgKyB0aGlzLm5hbWU7CiAgICAgICAgaWYgKHRoaXMuY3JlYXRlSW50ZXJwb2xhbnQgPT09IHZvaWQgMCkgewogICAgICAgICAgaWYgKGludGVycG9sYXRpb24gIT09IHRoaXMuRGVmYXVsdEludGVycG9sYXRpb24pIHsKICAgICAgICAgICAgdGhpcy5zZXRJbnRlcnBvbGF0aW9uKHRoaXMuRGVmYXVsdEludGVycG9sYXRpb24pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLktleWZyYW1lVHJhY2s6IiwgbWVzc2FnZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgdGhpcy5jcmVhdGVJbnRlcnBvbGFudCA9IGZhY3RvcnlNZXRob2Q7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0SW50ZXJwb2xhdGlvbigpIHsKICAgICAgc3dpdGNoICh0aGlzLmNyZWF0ZUludGVycG9sYW50KSB7CiAgICAgICAgY2FzZSB0aGlzLkludGVycG9sYW50RmFjdG9yeU1ldGhvZERpc2NyZXRlOgogICAgICAgICAgcmV0dXJuIEludGVycG9sYXRlRGlzY3JldGU7CiAgICAgICAgY2FzZSB0aGlzLkludGVycG9sYW50RmFjdG9yeU1ldGhvZExpbmVhcjoKICAgICAgICAgIHJldHVybiBJbnRlcnBvbGF0ZUxpbmVhcjsKICAgICAgICBjYXNlIHRoaXMuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kU21vb3RoOgogICAgICAgICAgcmV0dXJuIEludGVycG9sYXRlU21vb3RoOwogICAgICB9CiAgICB9CiAgICBnZXRWYWx1ZVNpemUoKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlcy5sZW5ndGggLyB0aGlzLnRpbWVzLmxlbmd0aDsKICAgIH0KICAgIHNoaWZ0KHRpbWVPZmZzZXQpIHsKICAgICAgaWYgKHRpbWVPZmZzZXQgIT09IDApIHsKICAgICAgICBjb25zdCB0aW1lcyA9IHRoaXMudGltZXM7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSB0aW1lcy5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgICAgdGltZXNbaV0gKz0gdGltZU9mZnNldDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzY2FsZSh0aW1lU2NhbGUpIHsKICAgICAgaWYgKHRpbWVTY2FsZSAhPT0gMSkgewogICAgICAgIGNvbnN0IHRpbWVzID0gdGhpcy50aW1lczsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IHRpbWVzLmxlbmd0aDsgaSAhPT0gbjsgKytpKSB7CiAgICAgICAgICB0aW1lc1tpXSAqPSB0aW1lU2NhbGU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdHJpbShzdGFydFRpbWUsIGVuZFRpbWUpIHsKICAgICAgY29uc3QgdGltZXMgPSB0aGlzLnRpbWVzLCBuS2V5cyA9IHRpbWVzLmxlbmd0aDsKICAgICAgbGV0IGZyb20gPSAwLCB0byA9IG5LZXlzIC0gMTsKICAgICAgd2hpbGUgKGZyb20gIT09IG5LZXlzICYmIHRpbWVzW2Zyb21dIDwgc3RhcnRUaW1lKSB7CiAgICAgICAgKytmcm9tOwogICAgICB9CiAgICAgIHdoaWxlICh0byAhPT0gLTEgJiYgdGltZXNbdG9dID4gZW5kVGltZSkgewogICAgICAgIC0tdG87CiAgICAgIH0KICAgICAgKyt0bzsKICAgICAgaWYgKGZyb20gIT09IDAgfHwgdG8gIT09IG5LZXlzKSB7CiAgICAgICAgaWYgKGZyb20gPj0gdG8pIHsKICAgICAgICAgIHRvID0gTWF0aC5tYXgodG8sIDEpOwogICAgICAgICAgZnJvbSA9IHRvIC0gMTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc3RyaWRlID0gdGhpcy5nZXRWYWx1ZVNpemUoKTsKICAgICAgICB0aGlzLnRpbWVzID0gQW5pbWF0aW9uVXRpbHMuYXJyYXlTbGljZSh0aW1lcywgZnJvbSwgdG8pOwogICAgICAgIHRoaXMudmFsdWVzID0gQW5pbWF0aW9uVXRpbHMuYXJyYXlTbGljZSh0aGlzLnZhbHVlcywgZnJvbSAqIHN0cmlkZSwgdG8gKiBzdHJpZGUpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdmFsaWRhdGUoKSB7CiAgICAgIGxldCB2YWxpZCA9IHRydWU7CiAgICAgIGNvbnN0IHZhbHVlU2l6ZSA9IHRoaXMuZ2V0VmFsdWVTaXplKCk7CiAgICAgIGlmICh2YWx1ZVNpemUgLSBNYXRoLmZsb29yKHZhbHVlU2l6ZSkgIT09IDApIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5LZXlmcmFtZVRyYWNrOiBJbnZhbGlkIHZhbHVlIHNpemUgaW4gdHJhY2suIiwgdGhpcyk7CiAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCB0aW1lcyA9IHRoaXMudGltZXMsIHZhbHVlcyA9IHRoaXMudmFsdWVzLCBuS2V5cyA9IHRpbWVzLmxlbmd0aDsKICAgICAgaWYgKG5LZXlzID09PSAwKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuS2V5ZnJhbWVUcmFjazogVHJhY2sgaXMgZW1wdHkuIiwgdGhpcyk7CiAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgfQogICAgICBsZXQgcHJldlRpbWUgPSBudWxsOwogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbktleXM7IGkrKykgewogICAgICAgIGNvbnN0IGN1cnJUaW1lID0gdGltZXNbaV07CiAgICAgICAgaWYgKHR5cGVvZiBjdXJyVGltZSA9PT0gIm51bWJlciIgJiYgaXNOYU4oY3VyclRpbWUpKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5LZXlmcmFtZVRyYWNrOiBUaW1lIGlzIG5vdCBhIHZhbGlkIG51bWJlci4iLCB0aGlzLCBpLCBjdXJyVGltZSk7CiAgICAgICAgICB2YWxpZCA9IGZhbHNlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChwcmV2VGltZSAhPT0gbnVsbCAmJiBwcmV2VGltZSA+IGN1cnJUaW1lKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5LZXlmcmFtZVRyYWNrOiBPdXQgb2Ygb3JkZXIga2V5cy4iLCB0aGlzLCBpLCBjdXJyVGltZSwgcHJldlRpbWUpOwogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBwcmV2VGltZSA9IGN1cnJUaW1lOwogICAgICB9CiAgICAgIGlmICh2YWx1ZXMgIT09IHZvaWQgMCkgewogICAgICAgIGlmIChBbmltYXRpb25VdGlscy5pc1R5cGVkQXJyYXkodmFsdWVzKSkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSB2YWx1ZXMubGVuZ3RoOyBpICE9PSBuOyArK2kpIHsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaV07CiAgICAgICAgICAgIGlmIChpc05hTih2YWx1ZSkpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5LZXlmcmFtZVRyYWNrOiBWYWx1ZSBpcyBub3QgYSB2YWxpZCBudW1iZXIuIiwgdGhpcywgaSwgdmFsdWUpOwogICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHZhbGlkOwogICAgfQogICAgb3B0aW1pemUoKSB7CiAgICAgIGNvbnN0IHRpbWVzID0gQW5pbWF0aW9uVXRpbHMuYXJyYXlTbGljZSh0aGlzLnRpbWVzKSwgdmFsdWVzID0gQW5pbWF0aW9uVXRpbHMuYXJyYXlTbGljZSh0aGlzLnZhbHVlcyksIHN0cmlkZSA9IHRoaXMuZ2V0VmFsdWVTaXplKCksIHNtb290aEludGVycG9sYXRpb24gPSB0aGlzLmdldEludGVycG9sYXRpb24oKSA9PT0gSW50ZXJwb2xhdGVTbW9vdGgsIGxhc3RJbmRleCA9IHRpbWVzLmxlbmd0aCAtIDE7CiAgICAgIGxldCB3cml0ZUluZGV4ID0gMTsKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBsYXN0SW5kZXg7ICsraSkgewogICAgICAgIGxldCBrZWVwID0gZmFsc2U7CiAgICAgICAgY29uc3QgdGltZSA9IHRpbWVzW2ldOwogICAgICAgIGNvbnN0IHRpbWVOZXh0ID0gdGltZXNbaSArIDFdOwogICAgICAgIGlmICh0aW1lICE9PSB0aW1lTmV4dCAmJiAoaSAhPT0gMSB8fCB0aW1lICE9PSB0aW1lc1swXSkpIHsKICAgICAgICAgIGlmICghc21vb3RoSW50ZXJwb2xhdGlvbikgewogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBpICogc3RyaWRlLCBvZmZzZXRQID0gb2Zmc2V0IC0gc3RyaWRlLCBvZmZzZXROID0gb2Zmc2V0ICsgc3RyaWRlOwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gc3RyaWRlOyArK2opIHsKICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlc1tvZmZzZXQgKyBqXTsKICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IHZhbHVlc1tvZmZzZXRQICsgal0gfHwgdmFsdWUgIT09IHZhbHVlc1tvZmZzZXROICsgal0pIHsKICAgICAgICAgICAgICAgIGtlZXAgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBrZWVwID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGtlZXApIHsKICAgICAgICAgIGlmIChpICE9PSB3cml0ZUluZGV4KSB7CiAgICAgICAgICAgIHRpbWVzW3dyaXRlSW5kZXhdID0gdGltZXNbaV07CiAgICAgICAgICAgIGNvbnN0IHJlYWRPZmZzZXQgPSBpICogc3RyaWRlLCB3cml0ZU9mZnNldCA9IHdyaXRlSW5kZXggKiBzdHJpZGU7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBzdHJpZGU7ICsraikgewogICAgICAgICAgICAgIHZhbHVlc1t3cml0ZU9mZnNldCArIGpdID0gdmFsdWVzW3JlYWRPZmZzZXQgKyBqXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgKyt3cml0ZUluZGV4OwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobGFzdEluZGV4ID4gMCkgewogICAgICAgIHRpbWVzW3dyaXRlSW5kZXhdID0gdGltZXNbbGFzdEluZGV4XTsKICAgICAgICBmb3IgKGxldCByZWFkT2Zmc2V0ID0gbGFzdEluZGV4ICogc3RyaWRlLCB3cml0ZU9mZnNldCA9IHdyaXRlSW5kZXggKiBzdHJpZGUsIGogPSAwOyBqICE9PSBzdHJpZGU7ICsraikgewogICAgICAgICAgdmFsdWVzW3dyaXRlT2Zmc2V0ICsgal0gPSB2YWx1ZXNbcmVhZE9mZnNldCArIGpdOwogICAgICAgIH0KICAgICAgICArK3dyaXRlSW5kZXg7CiAgICAgIH0KICAgICAgaWYgKHdyaXRlSW5kZXggIT09IHRpbWVzLmxlbmd0aCkgewogICAgICAgIHRoaXMudGltZXMgPSBBbmltYXRpb25VdGlscy5hcnJheVNsaWNlKHRpbWVzLCAwLCB3cml0ZUluZGV4KTsKICAgICAgICB0aGlzLnZhbHVlcyA9IEFuaW1hdGlvblV0aWxzLmFycmF5U2xpY2UodmFsdWVzLCAwLCB3cml0ZUluZGV4ICogc3RyaWRlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRpbWVzID0gdGltZXM7CiAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgY29uc3QgdGltZXMgPSBBbmltYXRpb25VdGlscy5hcnJheVNsaWNlKHRoaXMudGltZXMsIDApOwogICAgICBjb25zdCB2YWx1ZXMgPSBBbmltYXRpb25VdGlscy5hcnJheVNsaWNlKHRoaXMudmFsdWVzLCAwKTsKICAgICAgY29uc3QgVHlwZWRLZXlmcmFtZVRyYWNrID0gdGhpcy5jb25zdHJ1Y3RvcjsKICAgICAgY29uc3QgdHJhY2sgPSBuZXcgVHlwZWRLZXlmcmFtZVRyYWNrKHRoaXMubmFtZSwgdGltZXMsIHZhbHVlcyk7CiAgICAgIHRyYWNrLmNyZWF0ZUludGVycG9sYW50ID0gdGhpcy5jcmVhdGVJbnRlcnBvbGFudDsKICAgICAgcmV0dXJuIHRyYWNrOwogICAgfQogIH07CiAgS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVGltZUJ1ZmZlclR5cGUgPSBGbG9hdDMyQXJyYXk7CiAgS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVCdWZmZXJUeXBlID0gRmxvYXQzMkFycmF5OwogIEtleWZyYW1lVHJhY2sucHJvdG90eXBlLkRlZmF1bHRJbnRlcnBvbGF0aW9uID0gSW50ZXJwb2xhdGVMaW5lYXI7CiAgdmFyIEJvb2xlYW5LZXlmcmFtZVRyYWNrID0gY2xhc3MgZXh0ZW5kcyBLZXlmcmFtZVRyYWNrIHsKICB9OwogIEJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5WYWx1ZVR5cGVOYW1lID0gImJvb2wiOwogIEJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5WYWx1ZUJ1ZmZlclR5cGUgPSBBcnJheTsKICBCb29sZWFuS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuRGVmYXVsdEludGVycG9sYXRpb24gPSBJbnRlcnBvbGF0ZURpc2NyZXRlOwogIEJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXIgPSB2b2lkIDA7CiAgQm9vbGVhbktleWZyYW1lVHJhY2sucHJvdG90eXBlLkludGVycG9sYW50RmFjdG9yeU1ldGhvZFNtb290aCA9IHZvaWQgMDsKICB2YXIgQ29sb3JLZXlmcmFtZVRyYWNrID0gY2xhc3MgZXh0ZW5kcyBLZXlmcmFtZVRyYWNrIHsKICB9OwogIENvbG9yS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVUeXBlTmFtZSA9ICJjb2xvciI7CiAgdmFyIE51bWJlcktleWZyYW1lVHJhY2sgPSBjbGFzcyBleHRlbmRzIEtleWZyYW1lVHJhY2sgewogIH07CiAgTnVtYmVyS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVUeXBlTmFtZSA9ICJudW1iZXIiOwogIHZhciBRdWF0ZXJuaW9uTGluZWFySW50ZXJwb2xhbnQgPSBjbGFzcyBleHRlbmRzIEludGVycG9sYW50IHsKICAgIGNvbnN0cnVjdG9yKHBhcmFtZXRlclBvc2l0aW9ucywgc2FtcGxlVmFsdWVzLCBzYW1wbGVTaXplLCByZXN1bHRCdWZmZXIpIHsKICAgICAgc3VwZXIocGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlcik7CiAgICB9CiAgICBpbnRlcnBvbGF0ZV8oaTEsIHQwLCB0LCB0MSkgewogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdEJ1ZmZlciwgdmFsdWVzID0gdGhpcy5zYW1wbGVWYWx1ZXMsIHN0cmlkZSA9IHRoaXMudmFsdWVTaXplLCBhbHBoYSA9ICh0IC0gdDApIC8gKHQxIC0gdDApOwogICAgICBsZXQgb2Zmc2V0ID0gaTEgKiBzdHJpZGU7CiAgICAgIGZvciAobGV0IGVuZCA9IG9mZnNldCArIHN0cmlkZTsgb2Zmc2V0ICE9PSBlbmQ7IG9mZnNldCArPSA0KSB7CiAgICAgICAgUXVhdGVybmlvbi5zbGVycEZsYXQocmVzdWx0LCAwLCB2YWx1ZXMsIG9mZnNldCAtIHN0cmlkZSwgdmFsdWVzLCBvZmZzZXQsIGFscGhhKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgdmFyIFF1YXRlcm5pb25LZXlmcmFtZVRyYWNrID0gY2xhc3MgZXh0ZW5kcyBLZXlmcmFtZVRyYWNrIHsKICAgIEludGVycG9sYW50RmFjdG9yeU1ldGhvZExpbmVhcihyZXN1bHQpIHsKICAgICAgcmV0dXJuIG5ldyBRdWF0ZXJuaW9uTGluZWFySW50ZXJwb2xhbnQodGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCksIHJlc3VsdCk7CiAgICB9CiAgfTsKICBRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVUeXBlTmFtZSA9ICJxdWF0ZXJuaW9uIjsKICBRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuRGVmYXVsdEludGVycG9sYXRpb24gPSBJbnRlcnBvbGF0ZUxpbmVhcjsKICBRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kU21vb3RoID0gdm9pZCAwOwogIHZhciBTdHJpbmdLZXlmcmFtZVRyYWNrID0gY2xhc3MgZXh0ZW5kcyBLZXlmcmFtZVRyYWNrIHsKICB9OwogIFN0cmluZ0tleWZyYW1lVHJhY2sucHJvdG90eXBlLlZhbHVlVHlwZU5hbWUgPSAic3RyaW5nIjsKICBTdHJpbmdLZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5WYWx1ZUJ1ZmZlclR5cGUgPSBBcnJheTsKICBTdHJpbmdLZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5EZWZhdWx0SW50ZXJwb2xhdGlvbiA9IEludGVycG9sYXRlRGlzY3JldGU7CiAgU3RyaW5nS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kTGluZWFyID0gdm9pZCAwOwogIFN0cmluZ0tleWZyYW1lVHJhY2sucHJvdG90eXBlLkludGVycG9sYW50RmFjdG9yeU1ldGhvZFNtb290aCA9IHZvaWQgMDsKICB2YXIgVmVjdG9yS2V5ZnJhbWVUcmFjayA9IGNsYXNzIGV4dGVuZHMgS2V5ZnJhbWVUcmFjayB7CiAgfTsKICBWZWN0b3JLZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5WYWx1ZVR5cGVOYW1lID0gInZlY3RvciI7CiAgdmFyIEFuaW1hdGlvbkNsaXAgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihuYW1lLCBkdXJhdGlvbiA9IC0xLCB0cmFja3MsIGJsZW5kTW9kZSA9IE5vcm1hbEFuaW1hdGlvbkJsZW5kTW9kZSkgewogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLnRyYWNrcyA9IHRyYWNrczsKICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uOwogICAgICB0aGlzLmJsZW5kTW9kZSA9IGJsZW5kTW9kZTsKICAgICAgdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CiAgICAgIGlmICh0aGlzLmR1cmF0aW9uIDwgMCkgewogICAgICAgIHRoaXMucmVzZXREdXJhdGlvbigpOwogICAgICB9CiAgICB9CiAgICBzdGF0aWMgcGFyc2UoanNvbikgewogICAgICBjb25zdCB0cmFja3MgPSBbXSwganNvblRyYWNrcyA9IGpzb24udHJhY2tzLCBmcmFtZVRpbWUgPSAxIC8gKGpzb24uZnBzIHx8IDEpOwogICAgICBmb3IgKGxldCBpID0gMCwgbiA9IGpzb25UcmFja3MubGVuZ3RoOyBpICE9PSBuOyArK2kpIHsKICAgICAgICB0cmFja3MucHVzaChwYXJzZUtleWZyYW1lVHJhY2soanNvblRyYWNrc1tpXSkuc2NhbGUoZnJhbWVUaW1lKSk7CiAgICAgIH0KICAgICAgY29uc3QgY2xpcCA9IG5ldyB0aGlzKGpzb24ubmFtZSwganNvbi5kdXJhdGlvbiwgdHJhY2tzLCBqc29uLmJsZW5kTW9kZSk7CiAgICAgIGNsaXAudXVpZCA9IGpzb24udXVpZDsKICAgICAgcmV0dXJuIGNsaXA7CiAgICB9CiAgICBzdGF0aWMgdG9KU09OKGNsaXApIHsKICAgICAgY29uc3QgdHJhY2tzID0gW10sIGNsaXBUcmFja3MgPSBjbGlwLnRyYWNrczsKICAgICAgY29uc3QganNvbiA9IHsKICAgICAgICAibmFtZSI6IGNsaXAubmFtZSwKICAgICAgICAiZHVyYXRpb24iOiBjbGlwLmR1cmF0aW9uLAogICAgICAgICJ0cmFja3MiOiB0cmFja3MsCiAgICAgICAgInV1aWQiOiBjbGlwLnV1aWQsCiAgICAgICAgImJsZW5kTW9kZSI6IGNsaXAuYmxlbmRNb2RlCiAgICAgIH07CiAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gY2xpcFRyYWNrcy5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIHRyYWNrcy5wdXNoKEtleWZyYW1lVHJhY2sudG9KU09OKGNsaXBUcmFja3NbaV0pKTsKICAgICAgfQogICAgICByZXR1cm4ganNvbjsKICAgIH0KICAgIHN0YXRpYyBDcmVhdGVGcm9tTW9ycGhUYXJnZXRTZXF1ZW5jZShuYW1lLCBtb3JwaFRhcmdldFNlcXVlbmNlLCBmcHMsIG5vTG9vcCkgewogICAgICBjb25zdCBudW1Nb3JwaFRhcmdldHMgPSBtb3JwaFRhcmdldFNlcXVlbmNlLmxlbmd0aDsKICAgICAgY29uc3QgdHJhY2tzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtTW9ycGhUYXJnZXRzOyBpKyspIHsKICAgICAgICBsZXQgdGltZXMgPSBbXTsKICAgICAgICBsZXQgdmFsdWVzID0gW107CiAgICAgICAgdGltZXMucHVzaCgoaSArIG51bU1vcnBoVGFyZ2V0cyAtIDEpICUgbnVtTW9ycGhUYXJnZXRzLCBpLCAoaSArIDEpICUgbnVtTW9ycGhUYXJnZXRzKTsKICAgICAgICB2YWx1ZXMucHVzaCgwLCAxLCAwKTsKICAgICAgICBjb25zdCBvcmRlciA9IEFuaW1hdGlvblV0aWxzLmdldEtleWZyYW1lT3JkZXIodGltZXMpOwogICAgICAgIHRpbWVzID0gQW5pbWF0aW9uVXRpbHMuc29ydGVkQXJyYXkodGltZXMsIDEsIG9yZGVyKTsKICAgICAgICB2YWx1ZXMgPSBBbmltYXRpb25VdGlscy5zb3J0ZWRBcnJheSh2YWx1ZXMsIDEsIG9yZGVyKTsKICAgICAgICBpZiAoIW5vTG9vcCAmJiB0aW1lc1swXSA9PT0gMCkgewogICAgICAgICAgdGltZXMucHVzaChudW1Nb3JwaFRhcmdldHMpOwogICAgICAgICAgdmFsdWVzLnB1c2godmFsdWVzWzBdKTsKICAgICAgICB9CiAgICAgICAgdHJhY2tzLnB1c2gobmV3IE51bWJlcktleWZyYW1lVHJhY2soIi5tb3JwaFRhcmdldEluZmx1ZW5jZXNbIiArIG1vcnBoVGFyZ2V0U2VxdWVuY2VbaV0ubmFtZSArICJdIiwgdGltZXMsIHZhbHVlcykuc2NhbGUoMSAvIGZwcykpOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgdGhpcyhuYW1lLCAtMSwgdHJhY2tzKTsKICAgIH0KICAgIHN0YXRpYyBmaW5kQnlOYW1lKG9iamVjdE9yQ2xpcEFycmF5LCBuYW1lKSB7CiAgICAgIGxldCBjbGlwQXJyYXkgPSBvYmplY3RPckNsaXBBcnJheTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG9iamVjdE9yQ2xpcEFycmF5KSkgewogICAgICAgIGNvbnN0IG8gPSBvYmplY3RPckNsaXBBcnJheTsKICAgICAgICBjbGlwQXJyYXkgPSBvLmdlb21ldHJ5ICYmIG8uZ2VvbWV0cnkuYW5pbWF0aW9ucyB8fCBvLmFuaW1hdGlvbnM7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjbGlwQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoY2xpcEFycmF5W2ldLm5hbWUgPT09IG5hbWUpIHsKICAgICAgICAgIHJldHVybiBjbGlwQXJyYXlbaV07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgc3RhdGljIENyZWF0ZUNsaXBzRnJvbU1vcnBoVGFyZ2V0U2VxdWVuY2VzKG1vcnBoVGFyZ2V0cywgZnBzLCBub0xvb3ApIHsKICAgICAgY29uc3QgYW5pbWF0aW9uVG9Nb3JwaFRhcmdldHMgPSB7fTsKICAgICAgY29uc3QgcGF0dGVybiA9IC9eKFtcdy1dKj8pKFtcZF0rKSQvOwogICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBtb3JwaFRhcmdldHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgIGNvbnN0IG1vcnBoVGFyZ2V0ID0gbW9ycGhUYXJnZXRzW2ldOwogICAgICAgIGNvbnN0IHBhcnRzID0gbW9ycGhUYXJnZXQubmFtZS5tYXRjaChwYXR0ZXJuKTsKICAgICAgICBpZiAocGFydHMgJiYgcGFydHMubGVuZ3RoID4gMSkgewogICAgICAgICAgY29uc3QgbmFtZSA9IHBhcnRzWzFdOwogICAgICAgICAgbGV0IGFuaW1hdGlvbk1vcnBoVGFyZ2V0cyA9IGFuaW1hdGlvblRvTW9ycGhUYXJnZXRzW25hbWVdOwogICAgICAgICAgaWYgKCFhbmltYXRpb25Nb3JwaFRhcmdldHMpIHsKICAgICAgICAgICAgYW5pbWF0aW9uVG9Nb3JwaFRhcmdldHNbbmFtZV0gPSBhbmltYXRpb25Nb3JwaFRhcmdldHMgPSBbXTsKICAgICAgICAgIH0KICAgICAgICAgIGFuaW1hdGlvbk1vcnBoVGFyZ2V0cy5wdXNoKG1vcnBoVGFyZ2V0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgY2xpcHMgPSBbXTsKICAgICAgZm9yIChjb25zdCBuYW1lIGluIGFuaW1hdGlvblRvTW9ycGhUYXJnZXRzKSB7CiAgICAgICAgY2xpcHMucHVzaCh0aGlzLkNyZWF0ZUZyb21Nb3JwaFRhcmdldFNlcXVlbmNlKG5hbWUsIGFuaW1hdGlvblRvTW9ycGhUYXJnZXRzW25hbWVdLCBmcHMsIG5vTG9vcCkpOwogICAgICB9CiAgICAgIHJldHVybiBjbGlwczsKICAgIH0KICAgIHN0YXRpYyBwYXJzZUFuaW1hdGlvbihhbmltYXRpb24sIGJvbmVzKSB7CiAgICAgIGlmICghYW5pbWF0aW9uKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuQW5pbWF0aW9uQ2xpcDogTm8gYW5pbWF0aW9uIGluIEpTT05Mb2FkZXIgZGF0YS4iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBhZGROb25lbXB0eVRyYWNrID0gZnVuY3Rpb24odHJhY2tUeXBlLCB0cmFja05hbWUsIGFuaW1hdGlvbktleXMsIHByb3BlcnR5TmFtZSwgZGVzdFRyYWNrcykgewogICAgICAgIGlmIChhbmltYXRpb25LZXlzLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgY29uc3QgdGltZXMgPSBbXTsKICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IFtdOwogICAgICAgICAgQW5pbWF0aW9uVXRpbHMuZmxhdHRlbkpTT04oYW5pbWF0aW9uS2V5cywgdGltZXMsIHZhbHVlcywgcHJvcGVydHlOYW1lKTsKICAgICAgICAgIGlmICh0aW1lcy5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgZGVzdFRyYWNrcy5wdXNoKG5ldyB0cmFja1R5cGUodHJhY2tOYW1lLCB0aW1lcywgdmFsdWVzKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICBjb25zdCB0cmFja3MgPSBbXTsKICAgICAgY29uc3QgY2xpcE5hbWUgPSBhbmltYXRpb24ubmFtZSB8fCAiZGVmYXVsdCI7CiAgICAgIGNvbnN0IGZwcyA9IGFuaW1hdGlvbi5mcHMgfHwgMzA7CiAgICAgIGNvbnN0IGJsZW5kTW9kZSA9IGFuaW1hdGlvbi5ibGVuZE1vZGU7CiAgICAgIGxldCBkdXJhdGlvbiA9IGFuaW1hdGlvbi5sZW5ndGggfHwgLTE7CiAgICAgIGNvbnN0IGhpZXJhcmNoeVRyYWNrcyA9IGFuaW1hdGlvbi5oaWVyYXJjaHkgfHwgW107CiAgICAgIGZvciAobGV0IGggPSAwOyBoIDwgaGllcmFyY2h5VHJhY2tzLmxlbmd0aDsgaCsrKSB7CiAgICAgICAgY29uc3QgYW5pbWF0aW9uS2V5cyA9IGhpZXJhcmNoeVRyYWNrc1toXS5rZXlzOwogICAgICAgIGlmICghYW5pbWF0aW9uS2V5cyB8fCBhbmltYXRpb25LZXlzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGlmIChhbmltYXRpb25LZXlzWzBdLm1vcnBoVGFyZ2V0cykgewogICAgICAgICAgY29uc3QgbW9ycGhUYXJnZXROYW1lcyA9IHt9OwogICAgICAgICAgbGV0IGs7CiAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgYW5pbWF0aW9uS2V5cy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICBpZiAoYW5pbWF0aW9uS2V5c1trXS5tb3JwaFRhcmdldHMpIHsKICAgICAgICAgICAgICBmb3IgKGxldCBtID0gMDsgbSA8IGFuaW1hdGlvbktleXNba10ubW9ycGhUYXJnZXRzLmxlbmd0aDsgbSsrKSB7CiAgICAgICAgICAgICAgICBtb3JwaFRhcmdldE5hbWVzW2FuaW1hdGlvbktleXNba10ubW9ycGhUYXJnZXRzW21dXSA9IC0xOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZm9yIChjb25zdCBtb3JwaFRhcmdldE5hbWUgaW4gbW9ycGhUYXJnZXROYW1lcykgewogICAgICAgICAgICBjb25zdCB0aW1lcyA9IFtdOwogICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgbSA9IDA7IG0gIT09IGFuaW1hdGlvbktleXNba10ubW9ycGhUYXJnZXRzLmxlbmd0aDsgKyttKSB7CiAgICAgICAgICAgICAgY29uc3QgYW5pbWF0aW9uS2V5ID0gYW5pbWF0aW9uS2V5c1trXTsKICAgICAgICAgICAgICB0aW1lcy5wdXNoKGFuaW1hdGlvbktleS50aW1lKTsKICAgICAgICAgICAgICB2YWx1ZXMucHVzaChhbmltYXRpb25LZXkubW9ycGhUYXJnZXQgPT09IG1vcnBoVGFyZ2V0TmFtZSA/IDEgOiAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cmFja3MucHVzaChuZXcgTnVtYmVyS2V5ZnJhbWVUcmFjaygiLm1vcnBoVGFyZ2V0SW5mbHVlbmNlWyIgKyBtb3JwaFRhcmdldE5hbWUgKyAiXSIsIHRpbWVzLCB2YWx1ZXMpKTsKICAgICAgICAgIH0KICAgICAgICAgIGR1cmF0aW9uID0gbW9ycGhUYXJnZXROYW1lcy5sZW5ndGggKiAoZnBzIHx8IDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBib25lTmFtZSA9ICIuYm9uZXNbIiArIGJvbmVzW2hdLm5hbWUgKyAiXSI7CiAgICAgICAgICBhZGROb25lbXB0eVRyYWNrKFZlY3RvcktleWZyYW1lVHJhY2ssIGJvbmVOYW1lICsgIi5wb3NpdGlvbiIsIGFuaW1hdGlvbktleXMsICJwb3MiLCB0cmFja3MpOwogICAgICAgICAgYWRkTm9uZW1wdHlUcmFjayhRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjaywgYm9uZU5hbWUgKyAiLnF1YXRlcm5pb24iLCBhbmltYXRpb25LZXlzLCAicm90IiwgdHJhY2tzKTsKICAgICAgICAgIGFkZE5vbmVtcHR5VHJhY2soVmVjdG9yS2V5ZnJhbWVUcmFjaywgYm9uZU5hbWUgKyAiLnNjYWxlIiwgYW5pbWF0aW9uS2V5cywgInNjbCIsIHRyYWNrcyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0cmFja3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgY2xpcCA9IG5ldyB0aGlzKGNsaXBOYW1lLCBkdXJhdGlvbiwgdHJhY2tzLCBibGVuZE1vZGUpOwogICAgICByZXR1cm4gY2xpcDsKICAgIH0KICAgIHJlc2V0RHVyYXRpb24oKSB7CiAgICAgIGNvbnN0IHRyYWNrcyA9IHRoaXMudHJhY2tzOwogICAgICBsZXQgZHVyYXRpb24gPSAwOwogICAgICBmb3IgKGxldCBpID0gMCwgbiA9IHRyYWNrcy5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIGNvbnN0IHRyYWNrID0gdGhpcy50cmFja3NbaV07CiAgICAgICAgZHVyYXRpb24gPSBNYXRoLm1heChkdXJhdGlvbiwgdHJhY2sudGltZXNbdHJhY2sudGltZXMubGVuZ3RoIC0gMV0pOwogICAgICB9CiAgICAgIHRoaXMuZHVyYXRpb24gPSBkdXJhdGlvbjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0cmltKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy50cmFja3NbaV0udHJpbSgwLCB0aGlzLmR1cmF0aW9uKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHZhbGlkYXRlKCkgewogICAgICBsZXQgdmFsaWQgPSB0cnVlOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFsaWQgPSB2YWxpZCAmJiB0aGlzLnRyYWNrc1tpXS52YWxpZGF0ZSgpOwogICAgICB9CiAgICAgIHJldHVybiB2YWxpZDsKICAgIH0KICAgIG9wdGltaXplKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy50cmFja3NbaV0ub3B0aW1pemUoKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsb25lKCkgewogICAgICBjb25zdCB0cmFja3MgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRyYWNrcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRyYWNrcy5wdXNoKHRoaXMudHJhY2tzW2ldLmNsb25lKCkpOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLm5hbWUsIHRoaXMuZHVyYXRpb24sIHRyYWNrcywgdGhpcy5ibGVuZE1vZGUpOwogICAgfQogICAgdG9KU09OKCkgewogICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b0pTT04odGhpcyk7CiAgICB9CiAgfTsKICBmdW5jdGlvbiBnZXRUcmFja1R5cGVGb3JWYWx1ZVR5cGVOYW1lKHR5cGVOYW1lKSB7CiAgICBzd2l0Y2ggKHR5cGVOYW1lLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgY2FzZSAic2NhbGFyIjoKICAgICAgY2FzZSAiZG91YmxlIjoKICAgICAgY2FzZSAiZmxvYXQiOgogICAgICBjYXNlICJudW1iZXIiOgogICAgICBjYXNlICJpbnRlZ2VyIjoKICAgICAgICByZXR1cm4gTnVtYmVyS2V5ZnJhbWVUcmFjazsKICAgICAgY2FzZSAidmVjdG9yIjoKICAgICAgY2FzZSAidmVjdG9yMiI6CiAgICAgIGNhc2UgInZlY3RvcjMiOgogICAgICBjYXNlICJ2ZWN0b3I0IjoKICAgICAgICByZXR1cm4gVmVjdG9yS2V5ZnJhbWVUcmFjazsKICAgICAgY2FzZSAiY29sb3IiOgogICAgICAgIHJldHVybiBDb2xvcktleWZyYW1lVHJhY2s7CiAgICAgIGNhc2UgInF1YXRlcm5pb24iOgogICAgICAgIHJldHVybiBRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjazsKICAgICAgY2FzZSAiYm9vbCI6CiAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgIHJldHVybiBCb29sZWFuS2V5ZnJhbWVUcmFjazsKICAgICAgY2FzZSAic3RyaW5nIjoKICAgICAgICByZXR1cm4gU3RyaW5nS2V5ZnJhbWVUcmFjazsKICAgIH0KICAgIHRocm93IG5ldyBFcnJvcigiVEhSRUUuS2V5ZnJhbWVUcmFjazogVW5zdXBwb3J0ZWQgdHlwZU5hbWU6ICIgKyB0eXBlTmFtZSk7CiAgfQogIGZ1bmN0aW9uIHBhcnNlS2V5ZnJhbWVUcmFjayhqc29uKSB7CiAgICBpZiAoanNvbi50eXBlID09PSB2b2lkIDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJUSFJFRS5LZXlmcmFtZVRyYWNrOiB0cmFjayB0eXBlIHVuZGVmaW5lZCwgY2FuIG5vdCBwYXJzZSIpOwogICAgfQogICAgY29uc3QgdHJhY2tUeXBlID0gZ2V0VHJhY2tUeXBlRm9yVmFsdWVUeXBlTmFtZShqc29uLnR5cGUpOwogICAgaWYgKGpzb24udGltZXMgPT09IHZvaWQgMCkgewogICAgICBjb25zdCB0aW1lcyA9IFtdLCB2YWx1ZXMgPSBbXTsKICAgICAgQW5pbWF0aW9uVXRpbHMuZmxhdHRlbkpTT04oanNvbi5rZXlzLCB0aW1lcywgdmFsdWVzLCAidmFsdWUiKTsKICAgICAganNvbi50aW1lcyA9IHRpbWVzOwogICAgICBqc29uLnZhbHVlcyA9IHZhbHVlczsKICAgIH0KICAgIGlmICh0cmFja1R5cGUucGFyc2UgIT09IHZvaWQgMCkgewogICAgICByZXR1cm4gdHJhY2tUeXBlLnBhcnNlKGpzb24pOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5ldyB0cmFja1R5cGUoanNvbi5uYW1lLCBqc29uLnRpbWVzLCBqc29uLnZhbHVlcywganNvbi5pbnRlcnBvbGF0aW9uKTsKICAgIH0KICB9CiAgdmFyIENhY2hlID0gewogICAgZW5hYmxlZDogZmFsc2UsCiAgICBmaWxlczoge30sCiAgICBhZGQ6IGZ1bmN0aW9uKGtleSwgZmlsZSkgewogICAgICBpZiAodGhpcy5lbmFibGVkID09PSBmYWxzZSkKICAgICAgICByZXR1cm47CiAgICAgIHRoaXMuZmlsZXNba2V5XSA9IGZpbGU7CiAgICB9LAogICAgZ2V0OiBmdW5jdGlvbihrZXkpIHsKICAgICAgaWYgKHRoaXMuZW5hYmxlZCA9PT0gZmFsc2UpCiAgICAgICAgcmV0dXJuOwogICAgICByZXR1cm4gdGhpcy5maWxlc1trZXldOwogICAgfSwKICAgIHJlbW92ZTogZnVuY3Rpb24oa2V5KSB7CiAgICAgIGRlbGV0ZSB0aGlzLmZpbGVzW2tleV07CiAgICB9LAogICAgY2xlYXI6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmZpbGVzID0ge307CiAgICB9CiAgfTsKICB2YXIgTG9hZGluZ01hbmFnZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpIHsKICAgICAgY29uc3Qgc2NvcGUgPSB0aGlzOwogICAgICBsZXQgaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIGxldCBpdGVtc0xvYWRlZCA9IDA7CiAgICAgIGxldCBpdGVtc1RvdGFsID0gMDsKICAgICAgbGV0IHVybE1vZGlmaWVyID0gdm9pZCAwOwogICAgICBjb25zdCBoYW5kbGVycyA9IFtdOwogICAgICB0aGlzLm9uU3RhcnQgPSB2b2lkIDA7CiAgICAgIHRoaXMub25Mb2FkID0gb25Mb2FkOwogICAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBvblByb2dyZXNzOwogICAgICB0aGlzLm9uRXJyb3IgPSBvbkVycm9yOwogICAgICB0aGlzLml0ZW1TdGFydCA9IGZ1bmN0aW9uKHVybCkgewogICAgICAgIGl0ZW1zVG90YWwrKzsKICAgICAgICBpZiAoaXNMb2FkaW5nID09PSBmYWxzZSkgewogICAgICAgICAgaWYgKHNjb3BlLm9uU3RhcnQgIT09IHZvaWQgMCkgewogICAgICAgICAgICBzY29wZS5vblN0YXJ0KHVybCwgaXRlbXNMb2FkZWQsIGl0ZW1zVG90YWwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpc0xvYWRpbmcgPSB0cnVlOwogICAgICB9OwogICAgICB0aGlzLml0ZW1FbmQgPSBmdW5jdGlvbih1cmwpIHsKICAgICAgICBpdGVtc0xvYWRlZCsrOwogICAgICAgIGlmIChzY29wZS5vblByb2dyZXNzICE9PSB2b2lkIDApIHsKICAgICAgICAgIHNjb3BlLm9uUHJvZ3Jlc3ModXJsLCBpdGVtc0xvYWRlZCwgaXRlbXNUb3RhbCk7CiAgICAgICAgfQogICAgICAgIGlmIChpdGVtc0xvYWRlZCA9PT0gaXRlbXNUb3RhbCkgewogICAgICAgICAgaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAoc2NvcGUub25Mb2FkICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgc2NvcGUub25Mb2FkKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICB0aGlzLml0ZW1FcnJvciA9IGZ1bmN0aW9uKHVybCkgewogICAgICAgIGlmIChzY29wZS5vbkVycm9yICE9PSB2b2lkIDApIHsKICAgICAgICAgIHNjb3BlLm9uRXJyb3IodXJsKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHRoaXMucmVzb2x2ZVVSTCA9IGZ1bmN0aW9uKHVybCkgewogICAgICAgIGlmICh1cmxNb2RpZmllcikgewogICAgICAgICAgcmV0dXJuIHVybE1vZGlmaWVyKHVybCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1cmw7CiAgICAgIH07CiAgICAgIHRoaXMuc2V0VVJMTW9kaWZpZXIgPSBmdW5jdGlvbih0cmFuc2Zvcm0pIHsKICAgICAgICB1cmxNb2RpZmllciA9IHRyYW5zZm9ybTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKICAgICAgdGhpcy5hZGRIYW5kbGVyID0gZnVuY3Rpb24ocmVnZXgsIGxvYWRlcikgewogICAgICAgIGhhbmRsZXJzLnB1c2gocmVnZXgsIGxvYWRlcik7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIHRoaXMucmVtb3ZlSGFuZGxlciA9IGZ1bmN0aW9uKHJlZ2V4KSB7CiAgICAgICAgY29uc3QgaW5kZXggPSBoYW5kbGVycy5pbmRleE9mKHJlZ2V4KTsKICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICBoYW5kbGVycy5zcGxpY2UoaW5kZXgsIDIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKICAgICAgdGhpcy5nZXRIYW5kbGVyID0gZnVuY3Rpb24oZmlsZSkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gaGFuZGxlcnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBjb25zdCByZWdleCA9IGhhbmRsZXJzW2ldOwogICAgICAgICAgY29uc3QgbG9hZGVyID0gaGFuZGxlcnNbaSArIDFdOwogICAgICAgICAgaWYgKHJlZ2V4Lmdsb2JhbCkKICAgICAgICAgICAgcmVnZXgubGFzdEluZGV4ID0gMDsKICAgICAgICAgIGlmIChyZWdleC50ZXN0KGZpbGUpKSB7CiAgICAgICAgICAgIHJldHVybiBsb2FkZXI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9OwogICAgfQogIH07CiAgdmFyIERlZmF1bHRMb2FkaW5nTWFuYWdlciA9IG5ldyBMb2FkaW5nTWFuYWdlcigpOwogIHZhciBMb2FkZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihtYW5hZ2VyKSB7CiAgICAgIHRoaXMubWFuYWdlciA9IG1hbmFnZXIgIT09IHZvaWQgMCA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CiAgICAgIHRoaXMuY3Jvc3NPcmlnaW4gPSAiYW5vbnltb3VzIjsKICAgICAgdGhpcy53aXRoQ3JlZGVudGlhbHMgPSBmYWxzZTsKICAgICAgdGhpcy5wYXRoID0gIiI7CiAgICAgIHRoaXMucmVzb3VyY2VQYXRoID0gIiI7CiAgICAgIHRoaXMucmVxdWVzdEhlYWRlciA9IHt9OwogICAgfQogICAgbG9hZCgpIHsKICAgIH0KICAgIGxvYWRBc3luYyh1cmwsIG9uUHJvZ3Jlc3MpIHsKICAgICAgY29uc3Qgc2NvcGUgPSB0aGlzOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgc2NvcGUubG9hZCh1cmwsIHJlc29sdmUsIG9uUHJvZ3Jlc3MsIHJlamVjdCk7CiAgICAgIH0pOwogICAgfQogICAgcGFyc2UoKSB7CiAgICB9CiAgICBzZXRDcm9zc09yaWdpbihjcm9zc09yaWdpbikgewogICAgICB0aGlzLmNyb3NzT3JpZ2luID0gY3Jvc3NPcmlnaW47CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0V2l0aENyZWRlbnRpYWxzKHZhbHVlKSB7CiAgICAgIHRoaXMud2l0aENyZWRlbnRpYWxzID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0UGF0aChwYXRoKSB7CiAgICAgIHRoaXMucGF0aCA9IHBhdGg7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0UmVzb3VyY2VQYXRoKHJlc291cmNlUGF0aCkgewogICAgICB0aGlzLnJlc291cmNlUGF0aCA9IHJlc291cmNlUGF0aDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRSZXF1ZXN0SGVhZGVyKHJlcXVlc3RIZWFkZXIpIHsKICAgICAgdGhpcy5yZXF1ZXN0SGVhZGVyID0gcmVxdWVzdEhlYWRlcjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICB2YXIgbG9hZGluZyA9IHt9OwogIHZhciBGaWxlTG9hZGVyID0gY2xhc3MgZXh0ZW5kcyBMb2FkZXIgewogICAgY29uc3RydWN0b3IobWFuYWdlcikgewogICAgICBzdXBlcihtYW5hZ2VyKTsKICAgIH0KICAgIGxvYWQodXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpIHsKICAgICAgaWYgKHVybCA9PT0gdm9pZCAwKQogICAgICAgIHVybCA9ICIiOwogICAgICBpZiAodGhpcy5wYXRoICE9PSB2b2lkIDApCiAgICAgICAgdXJsID0gdGhpcy5wYXRoICsgdXJsOwogICAgICB1cmwgPSB0aGlzLm1hbmFnZXIucmVzb2x2ZVVSTCh1cmwpOwogICAgICBjb25zdCBzY29wZSA9IHRoaXM7CiAgICAgIGNvbnN0IGNhY2hlZCA9IENhY2hlLmdldCh1cmwpOwogICAgICBpZiAoY2FjaGVkICE9PSB2b2lkIDApIHsKICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCh1cmwpOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAob25Mb2FkKQogICAgICAgICAgICBvbkxvYWQoY2FjaGVkKTsKICAgICAgICAgIHNjb3BlLm1hbmFnZXIuaXRlbUVuZCh1cmwpOwogICAgICAgIH0sIDApOwogICAgICAgIHJldHVybiBjYWNoZWQ7CiAgICAgIH0KICAgICAgaWYgKGxvYWRpbmdbdXJsXSAhPT0gdm9pZCAwKSB7CiAgICAgICAgbG9hZGluZ1t1cmxdLnB1c2goewogICAgICAgICAgb25Mb2FkLAogICAgICAgICAgb25Qcm9ncmVzcywKICAgICAgICAgIG9uRXJyb3IKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgZGF0YVVyaVJlZ2V4ID0gL15kYXRhOiguKj8pKDtiYXNlNjQpPywoLiopJC87CiAgICAgIGNvbnN0IGRhdGFVcmlSZWdleFJlc3VsdCA9IHVybC5tYXRjaChkYXRhVXJpUmVnZXgpOwogICAgICBsZXQgcmVxdWVzdDsKICAgICAgaWYgKGRhdGFVcmlSZWdleFJlc3VsdCkgewogICAgICAgIGNvbnN0IG1pbWVUeXBlID0gZGF0YVVyaVJlZ2V4UmVzdWx0WzFdOwogICAgICAgIGNvbnN0IGlzQmFzZTY0ID0gISFkYXRhVXJpUmVnZXhSZXN1bHRbMl07CiAgICAgICAgbGV0IGRhdGEgPSBkYXRhVXJpUmVnZXhSZXN1bHRbM107CiAgICAgICAgZGF0YSA9IGRlY29kZVVSSUNvbXBvbmVudChkYXRhKTsKICAgICAgICBpZiAoaXNCYXNlNjQpCiAgICAgICAgICBkYXRhID0gYXRvYihkYXRhKTsKICAgICAgICB0cnkgewogICAgICAgICAgbGV0IHJlc3BvbnNlOwogICAgICAgICAgY29uc3QgcmVzcG9uc2VUeXBlID0gKHRoaXMucmVzcG9uc2VUeXBlIHx8ICIiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgc3dpdGNoIChyZXNwb25zZVR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiYXJyYXlidWZmZXIiOgogICAgICAgICAgICBjYXNlICJibG9iIjoKICAgICAgICAgICAgICBjb25zdCB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoZGF0YS5sZW5ndGgpOwogICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmlld1tpXSA9IGRhdGEuY2hhckNvZGVBdChpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlVHlwZSA9PT0gImJsb2IiKSB7CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBCbG9iKFt2aWV3LmJ1ZmZlcl0sIHsgdHlwZTogbWltZVR5cGUgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdmlldy5idWZmZXI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJkb2N1bWVudCI6CiAgICAgICAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpOwogICAgICAgICAgICAgIHJlc3BvbnNlID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhkYXRhLCBtaW1lVHlwZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImpzb24iOgogICAgICAgICAgICAgIHJlc3BvbnNlID0gSlNPTi5wYXJzZShkYXRhKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXNwb25zZSA9IGRhdGE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAob25Mb2FkKQogICAgICAgICAgICAgIG9uTG9hZChyZXNwb25zZSk7CiAgICAgICAgICAgIHNjb3BlLm1hbmFnZXIuaXRlbUVuZCh1cmwpOwogICAgICAgICAgfSwgMCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChvbkVycm9yKQogICAgICAgICAgICAgIG9uRXJyb3IoZXJyb3IpOwogICAgICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1FcnJvcih1cmwpOwogICAgICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1FbmQodXJsKTsKICAgICAgICAgIH0sIDApOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBsb2FkaW5nW3VybF0gPSBbXTsKICAgICAgICBsb2FkaW5nW3VybF0ucHVzaCh7CiAgICAgICAgICBvbkxvYWQsCiAgICAgICAgICBvblByb2dyZXNzLAogICAgICAgICAgb25FcnJvcgogICAgICAgIH0pOwogICAgICAgIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICByZXF1ZXN0Lm9wZW4oIkdFVCIsIHVybCwgdHJ1ZSk7CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gdGhpcy5yZXNwb25zZTsKICAgICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IGxvYWRpbmdbdXJsXTsKICAgICAgICAgIGRlbGV0ZSBsb2FkaW5nW3VybF07CiAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IDIwMCB8fCB0aGlzLnN0YXR1cyA9PT0gMCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT09IDApCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5GaWxlTG9hZGVyOiBIVFRQIFN0YXR1cyAwIHJlY2VpdmVkLiIpOwogICAgICAgICAgICBDYWNoZS5hZGQodXJsLCByZXNwb25zZSk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgICAgICAgY29uc3QgY2FsbGJhY2sgPSBjYWxsYmFja3NbaV07CiAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrLm9uTG9hZCkKICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9uTG9hZChyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2NvcGUubWFuYWdlci5pdGVtRW5kKHVybCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBjYWxsYmFja3MubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzW2ldOwogICAgICAgICAgICAgIGlmIChjYWxsYmFjay5vbkVycm9yKQogICAgICAgICAgICAgICAgY2FsbGJhY2sub25FcnJvcihldmVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2NvcGUubWFuYWdlci5pdGVtRXJyb3IodXJsKTsKICAgICAgICAgICAgc2NvcGUubWFuYWdlci5pdGVtRW5kKHVybCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgZmFsc2UpOwogICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigicHJvZ3Jlc3MiLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gbG9hZGluZ1t1cmxdOwogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlsID0gY2FsbGJhY2tzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgY2FsbGJhY2sgPSBjYWxsYmFja3NbaV07CiAgICAgICAgICAgIGlmIChjYWxsYmFjay5vblByb2dyZXNzKQogICAgICAgICAgICAgIGNhbGxiYWNrLm9uUHJvZ3Jlc3MoZXZlbnQpOwogICAgICAgICAgfQogICAgICAgIH0sIGZhbHNlKTsKICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoImVycm9yIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IGxvYWRpbmdbdXJsXTsKICAgICAgICAgIGRlbGV0ZSBsb2FkaW5nW3VybF07CiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWwgPSBjYWxsYmFja3MubGVuZ3RoOyBpIDwgaWw7IGkrKykgewogICAgICAgICAgICBjb25zdCBjYWxsYmFjayA9IGNhbGxiYWNrc1tpXTsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrLm9uRXJyb3IpCiAgICAgICAgICAgICAgY2FsbGJhY2sub25FcnJvcihldmVudCk7CiAgICAgICAgICB9CiAgICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1FcnJvcih1cmwpOwogICAgICAgICAgc2NvcGUubWFuYWdlci5pdGVtRW5kKHVybCk7CiAgICAgICAgfSwgZmFsc2UpOwogICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gbG9hZGluZ1t1cmxdOwogICAgICAgICAgZGVsZXRlIGxvYWRpbmdbdXJsXTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzW2ldOwogICAgICAgICAgICBpZiAoY2FsbGJhY2sub25FcnJvcikKICAgICAgICAgICAgICBjYWxsYmFjay5vbkVycm9yKGV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICAgIHNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKHVybCk7CiAgICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1FbmQodXJsKTsKICAgICAgICB9LCBmYWxzZSk7CiAgICAgICAgaWYgKHRoaXMucmVzcG9uc2VUeXBlICE9PSB2b2lkIDApCiAgICAgICAgICByZXF1ZXN0LnJlc3BvbnNlVHlwZSA9IHRoaXMucmVzcG9uc2VUeXBlOwogICAgICAgIGlmICh0aGlzLndpdGhDcmVkZW50aWFscyAhPT0gdm9pZCAwKQogICAgICAgICAgcmVxdWVzdC53aXRoQ3JlZGVudGlhbHMgPSB0aGlzLndpdGhDcmVkZW50aWFsczsKICAgICAgICBpZiAocmVxdWVzdC5vdmVycmlkZU1pbWVUeXBlKQogICAgICAgICAgcmVxdWVzdC5vdmVycmlkZU1pbWVUeXBlKHRoaXMubWltZVR5cGUgIT09IHZvaWQgMCA/IHRoaXMubWltZVR5cGUgOiAidGV4dC9wbGFpbiIpOwogICAgICAgIGZvciAoY29uc3QgaGVhZGVyIGluIHRoaXMucmVxdWVzdEhlYWRlcikgewogICAgICAgICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlciwgdGhpcy5yZXF1ZXN0SGVhZGVyW2hlYWRlcl0pOwogICAgICAgIH0KICAgICAgICByZXF1ZXN0LnNlbmQobnVsbCk7CiAgICAgIH0KICAgICAgc2NvcGUubWFuYWdlci5pdGVtU3RhcnQodXJsKTsKICAgICAgcmV0dXJuIHJlcXVlc3Q7CiAgICB9CiAgICBzZXRSZXNwb25zZVR5cGUodmFsdWUpIHsKICAgICAgdGhpcy5yZXNwb25zZVR5cGUgPSB2YWx1ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRNaW1lVHlwZSh2YWx1ZSkgewogICAgICB0aGlzLm1pbWVUeXBlID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgdmFyIEltYWdlTG9hZGVyID0gY2xhc3MgZXh0ZW5kcyBMb2FkZXIgewogICAgY29uc3RydWN0b3IobWFuYWdlcikgewogICAgICBzdXBlcihtYW5hZ2VyKTsKICAgIH0KICAgIGxvYWQodXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpIHsKICAgICAgaWYgKHRoaXMucGF0aCAhPT0gdm9pZCAwKQogICAgICAgIHVybCA9IHRoaXMucGF0aCArIHVybDsKICAgICAgdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwodXJsKTsKICAgICAgY29uc3Qgc2NvcGUgPSB0aGlzOwogICAgICBjb25zdCBjYWNoZWQgPSBDYWNoZS5nZXQodXJsKTsKICAgICAgaWYgKGNhY2hlZCAhPT0gdm9pZCAwKSB7CiAgICAgICAgc2NvcGUubWFuYWdlci5pdGVtU3RhcnQodXJsKTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKG9uTG9hZCkKICAgICAgICAgICAgb25Mb2FkKGNhY2hlZCk7CiAgICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1FbmQodXJsKTsKICAgICAgICB9LCAwKTsKICAgICAgICByZXR1cm4gY2FjaGVkOwogICAgICB9CiAgICAgIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiwgImltZyIpOwogICAgICBmdW5jdGlvbiBvbkltYWdlTG9hZCgpIHsKICAgICAgICBpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkIiwgb25JbWFnZUxvYWQsIGZhbHNlKTsKICAgICAgICBpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCJlcnJvciIsIG9uSW1hZ2VFcnJvciwgZmFsc2UpOwogICAgICAgIENhY2hlLmFkZCh1cmwsIHRoaXMpOwogICAgICAgIGlmIChvbkxvYWQpCiAgICAgICAgICBvbkxvYWQodGhpcyk7CiAgICAgICAgc2NvcGUubWFuYWdlci5pdGVtRW5kKHVybCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gb25JbWFnZUVycm9yKGV2ZW50KSB7CiAgICAgICAgaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lcigibG9hZCIsIG9uSW1hZ2VMb2FkLCBmYWxzZSk7CiAgICAgICAgaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZXJyb3IiLCBvbkltYWdlRXJyb3IsIGZhbHNlKTsKICAgICAgICBpZiAob25FcnJvcikKICAgICAgICAgIG9uRXJyb3IoZXZlbnQpOwogICAgICAgIHNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKHVybCk7CiAgICAgICAgc2NvcGUubWFuYWdlci5pdGVtRW5kKHVybCk7CiAgICAgIH0KICAgICAgaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIG9uSW1hZ2VMb2FkLCBmYWxzZSk7CiAgICAgIGltYWdlLmFkZEV2ZW50TGlzdGVuZXIoImVycm9yIiwgb25JbWFnZUVycm9yLCBmYWxzZSk7CiAgICAgIGlmICh1cmwuc3Vic3RyKDAsIDUpICE9PSAiZGF0YToiKSB7CiAgICAgICAgaWYgKHRoaXMuY3Jvc3NPcmlnaW4gIT09IHZvaWQgMCkKICAgICAgICAgIGltYWdlLmNyb3NzT3JpZ2luID0gdGhpcy5jcm9zc09yaWdpbjsKICAgICAgfQogICAgICBzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCh1cmwpOwogICAgICBpbWFnZS5zcmMgPSB1cmw7CiAgICAgIHJldHVybiBpbWFnZTsKICAgIH0KICB9OwogIHZhciBDdWJlVGV4dHVyZUxvYWRlciA9IGNsYXNzIGV4dGVuZHMgTG9hZGVyIHsKICAgIGNvbnN0cnVjdG9yKG1hbmFnZXIpIHsKICAgICAgc3VwZXIobWFuYWdlcik7CiAgICB9CiAgICBsb2FkKHVybHMsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvcikgewogICAgICBjb25zdCB0ZXh0dXJlID0gbmV3IEN1YmVUZXh0dXJlKCk7CiAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBJbWFnZUxvYWRlcih0aGlzLm1hbmFnZXIpOwogICAgICBsb2FkZXIuc2V0Q3Jvc3NPcmlnaW4odGhpcy5jcm9zc09yaWdpbik7CiAgICAgIGxvYWRlci5zZXRQYXRoKHRoaXMucGF0aCk7CiAgICAgIGxldCBsb2FkZWQgPSAwOwogICAgICBmdW5jdGlvbiBsb2FkVGV4dHVyZShpKSB7CiAgICAgICAgbG9hZGVyLmxvYWQodXJsc1tpXSwgZnVuY3Rpb24oaW1hZ2UpIHsKICAgICAgICAgIHRleHR1cmUuaW1hZ2VzW2ldID0gaW1hZ2U7CiAgICAgICAgICBsb2FkZWQrKzsKICAgICAgICAgIGlmIChsb2FkZWQgPT09IDYpIHsKICAgICAgICAgICAgdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgIGlmIChvbkxvYWQpCiAgICAgICAgICAgICAgb25Mb2FkKHRleHR1cmUpOwogICAgICAgICAgfQogICAgICAgIH0sIHZvaWQgMCwgb25FcnJvcik7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1cmxzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgbG9hZFRleHR1cmUoaSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRleHR1cmU7CiAgICB9CiAgfTsKICB2YXIgVGV4dHVyZUxvYWRlciA9IGNsYXNzIGV4dGVuZHMgTG9hZGVyIHsKICAgIGNvbnN0cnVjdG9yKG1hbmFnZXIpIHsKICAgICAgc3VwZXIobWFuYWdlcik7CiAgICB9CiAgICBsb2FkKHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yKSB7CiAgICAgIGNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwogICAgICBjb25zdCBsb2FkZXIgPSBuZXcgSW1hZ2VMb2FkZXIodGhpcy5tYW5hZ2VyKTsKICAgICAgbG9hZGVyLnNldENyb3NzT3JpZ2luKHRoaXMuY3Jvc3NPcmlnaW4pOwogICAgICBsb2FkZXIuc2V0UGF0aCh0aGlzLnBhdGgpOwogICAgICBsb2FkZXIubG9hZCh1cmwsIGZ1bmN0aW9uKGltYWdlKSB7CiAgICAgICAgdGV4dHVyZS5pbWFnZSA9IGltYWdlOwogICAgICAgIGNvbnN0IGlzSlBFRyA9IHVybC5zZWFyY2goL1wuanBlP2coJHxcPykvaSkgPiAwIHx8IHVybC5zZWFyY2goL15kYXRhXDppbWFnZVwvanBlZy8pID09PSAwOwogICAgICAgIHRleHR1cmUuZm9ybWF0ID0gaXNKUEVHID8gUkdCRm9ybWF0IDogUkdCQUZvcm1hdDsKICAgICAgICB0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgICBpZiAob25Mb2FkICE9PSB2b2lkIDApIHsKICAgICAgICAgIG9uTG9hZCh0ZXh0dXJlKTsKICAgICAgICB9CiAgICAgIH0sIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpOwogICAgICByZXR1cm4gdGV4dHVyZTsKICAgIH0KICB9OwogIHZhciBDdXJ2ZVBhdGggPSBjbGFzcyBleHRlbmRzIEN1cnZlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiQ3VydmVQYXRoIjsKICAgICAgdGhpcy5jdXJ2ZXMgPSBbXTsKICAgICAgdGhpcy5hdXRvQ2xvc2UgPSBmYWxzZTsKICAgIH0KICAgIGFkZChjdXJ2ZSkgewogICAgICB0aGlzLmN1cnZlcy5wdXNoKGN1cnZlKTsKICAgIH0KICAgIGNsb3NlUGF0aCgpIHsKICAgICAgY29uc3Qgc3RhcnRQb2ludCA9IHRoaXMuY3VydmVzWzBdLmdldFBvaW50KDApOwogICAgICBjb25zdCBlbmRQb2ludCA9IHRoaXMuY3VydmVzW3RoaXMuY3VydmVzLmxlbmd0aCAtIDFdLmdldFBvaW50KDEpOwogICAgICBpZiAoIXN0YXJ0UG9pbnQuZXF1YWxzKGVuZFBvaW50KSkgewogICAgICAgIHRoaXMuY3VydmVzLnB1c2gobmV3IExpbmVDdXJ2ZShlbmRQb2ludCwgc3RhcnRQb2ludCkpOwogICAgICB9CiAgICB9CiAgICBnZXRQb2ludCh0KSB7CiAgICAgIGNvbnN0IGQgPSB0ICogdGhpcy5nZXRMZW5ndGgoKTsKICAgICAgY29uc3QgY3VydmVMZW5ndGhzID0gdGhpcy5nZXRDdXJ2ZUxlbmd0aHMoKTsKICAgICAgbGV0IGkgPSAwOwogICAgICB3aGlsZSAoaSA8IGN1cnZlTGVuZ3Rocy5sZW5ndGgpIHsKICAgICAgICBpZiAoY3VydmVMZW5ndGhzW2ldID49IGQpIHsKICAgICAgICAgIGNvbnN0IGRpZmYgPSBjdXJ2ZUxlbmd0aHNbaV0gLSBkOwogICAgICAgICAgY29uc3QgY3VydmUgPSB0aGlzLmN1cnZlc1tpXTsKICAgICAgICAgIGNvbnN0IHNlZ21lbnRMZW5ndGggPSBjdXJ2ZS5nZXRMZW5ndGgoKTsKICAgICAgICAgIGNvbnN0IHUgPSBzZWdtZW50TGVuZ3RoID09PSAwID8gMCA6IDEgLSBkaWZmIC8gc2VnbWVudExlbmd0aDsKICAgICAgICAgIHJldHVybiBjdXJ2ZS5nZXRQb2ludEF0KHUpOwogICAgICAgIH0KICAgICAgICBpKys7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBnZXRMZW5ndGgoKSB7CiAgICAgIGNvbnN0IGxlbnMgPSB0aGlzLmdldEN1cnZlTGVuZ3RocygpOwogICAgICByZXR1cm4gbGVuc1tsZW5zLmxlbmd0aCAtIDFdOwogICAgfQogICAgdXBkYXRlQXJjTGVuZ3RocygpIHsKICAgICAgdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuY2FjaGVMZW5ndGhzID0gbnVsbDsKICAgICAgdGhpcy5nZXRDdXJ2ZUxlbmd0aHMoKTsKICAgIH0KICAgIGdldEN1cnZlTGVuZ3RocygpIHsKICAgICAgaWYgKHRoaXMuY2FjaGVMZW5ndGhzICYmIHRoaXMuY2FjaGVMZW5ndGhzLmxlbmd0aCA9PT0gdGhpcy5jdXJ2ZXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGVMZW5ndGhzOwogICAgICB9CiAgICAgIGNvbnN0IGxlbmd0aHMgPSBbXTsKICAgICAgbGV0IHN1bXMgPSAwOwogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHRoaXMuY3VydmVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHN1bXMgKz0gdGhpcy5jdXJ2ZXNbaV0uZ2V0TGVuZ3RoKCk7CiAgICAgICAgbGVuZ3Rocy5wdXNoKHN1bXMpOwogICAgICB9CiAgICAgIHRoaXMuY2FjaGVMZW5ndGhzID0gbGVuZ3RoczsKICAgICAgcmV0dXJuIGxlbmd0aHM7CiAgICB9CiAgICBnZXRTcGFjZWRQb2ludHMoZGl2aXNpb25zID0gNDApIHsKICAgICAgY29uc3QgcG9pbnRzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGRpdmlzaW9uczsgaSsrKSB7CiAgICAgICAgcG9pbnRzLnB1c2godGhpcy5nZXRQb2ludChpIC8gZGl2aXNpb25zKSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYXV0b0Nsb3NlKSB7CiAgICAgICAgcG9pbnRzLnB1c2gocG9pbnRzWzBdKTsKICAgICAgfQogICAgICByZXR1cm4gcG9pbnRzOwogICAgfQogICAgZ2V0UG9pbnRzKGRpdmlzaW9ucyA9IDEyKSB7CiAgICAgIGNvbnN0IHBvaW50cyA9IFtdOwogICAgICBsZXQgbGFzdDsKICAgICAgZm9yIChsZXQgaSA9IDAsIGN1cnZlcyA9IHRoaXMuY3VydmVzOyBpIDwgY3VydmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgY3VydmUgPSBjdXJ2ZXNbaV07CiAgICAgICAgY29uc3QgcmVzb2x1dGlvbiA9IGN1cnZlICYmIGN1cnZlLmlzRWxsaXBzZUN1cnZlID8gZGl2aXNpb25zICogMiA6IGN1cnZlICYmIChjdXJ2ZS5pc0xpbmVDdXJ2ZSB8fCBjdXJ2ZS5pc0xpbmVDdXJ2ZTMpID8gMSA6IGN1cnZlICYmIGN1cnZlLmlzU3BsaW5lQ3VydmUgPyBkaXZpc2lvbnMgKiBjdXJ2ZS5wb2ludHMubGVuZ3RoIDogZGl2aXNpb25zOwogICAgICAgIGNvbnN0IHB0cyA9IGN1cnZlLmdldFBvaW50cyhyZXNvbHV0aW9uKTsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHB0cy5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgcG9pbnQgPSBwdHNbal07CiAgICAgICAgICBpZiAobGFzdCAmJiBsYXN0LmVxdWFscyhwb2ludCkpCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgcG9pbnRzLnB1c2gocG9pbnQpOwogICAgICAgICAgbGFzdCA9IHBvaW50OwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGhpcy5hdXRvQ2xvc2UgJiYgcG9pbnRzLmxlbmd0aCA+IDEgJiYgIXBvaW50c1twb2ludHMubGVuZ3RoIC0gMV0uZXF1YWxzKHBvaW50c1swXSkpIHsKICAgICAgICBwb2ludHMucHVzaChwb2ludHNbMF0pOwogICAgICB9CiAgICAgIHJldHVybiBwb2ludHM7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMuY3VydmVzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc291cmNlLmN1cnZlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCBjdXJ2ZSA9IHNvdXJjZS5jdXJ2ZXNbaV07CiAgICAgICAgdGhpcy5jdXJ2ZXMucHVzaChjdXJ2ZS5jbG9uZSgpKTsKICAgICAgfQogICAgICB0aGlzLmF1dG9DbG9zZSA9IHNvdXJjZS5hdXRvQ2xvc2U7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKCkgewogICAgICBjb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CiAgICAgIGRhdGEuYXV0b0Nsb3NlID0gdGhpcy5hdXRvQ2xvc2U7CiAgICAgIGRhdGEuY3VydmVzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5jdXJ2ZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgY3VydmUgPSB0aGlzLmN1cnZlc1tpXTsKICAgICAgICBkYXRhLmN1cnZlcy5wdXNoKGN1cnZlLnRvSlNPTigpKTsKICAgICAgfQogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICAgIGZyb21KU09OKGpzb24pIHsKICAgICAgc3VwZXIuZnJvbUpTT04oanNvbik7CiAgICAgIHRoaXMuYXV0b0Nsb3NlID0ganNvbi5hdXRvQ2xvc2U7CiAgICAgIHRoaXMuY3VydmVzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0ganNvbi5jdXJ2ZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgY3VydmUgPSBqc29uLmN1cnZlc1tpXTsKICAgICAgICB0aGlzLmN1cnZlcy5wdXNoKG5ldyBDdXJ2ZXNbY3VydmUudHlwZV0oKS5mcm9tSlNPTihjdXJ2ZSkpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgdmFyIFBhdGggPSBjbGFzcyBleHRlbmRzIEN1cnZlUGF0aCB7CiAgICBjb25zdHJ1Y3Rvcihwb2ludHMpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIlBhdGgiOwogICAgICB0aGlzLmN1cnJlbnRQb2ludCA9IG5ldyBWZWN0b3IyKCk7CiAgICAgIGlmIChwb2ludHMpIHsKICAgICAgICB0aGlzLnNldEZyb21Qb2ludHMocG9pbnRzKTsKICAgICAgfQogICAgfQogICAgc2V0RnJvbVBvaW50cyhwb2ludHMpIHsKICAgICAgdGhpcy5tb3ZlVG8ocG9pbnRzWzBdLngsIHBvaW50c1swXS55KTsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBwb2ludHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5saW5lVG8ocG9pbnRzW2ldLngsIHBvaW50c1tpXS55KTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG1vdmVUbyh4LCB5KSB7CiAgICAgIHRoaXMuY3VycmVudFBvaW50LnNldCh4LCB5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBsaW5lVG8oeCwgeSkgewogICAgICBjb25zdCBjdXJ2ZSA9IG5ldyBMaW5lQ3VydmUodGhpcy5jdXJyZW50UG9pbnQuY2xvbmUoKSwgbmV3IFZlY3RvcjIoeCwgeSkpOwogICAgICB0aGlzLmN1cnZlcy5wdXNoKGN1cnZlKTsKICAgICAgdGhpcy5jdXJyZW50UG9pbnQuc2V0KHgsIHkpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHF1YWRyYXRpY0N1cnZlVG8oYUNQeCwgYUNQeSwgYVgsIGFZKSB7CiAgICAgIGNvbnN0IGN1cnZlID0gbmV3IFF1YWRyYXRpY0JlemllckN1cnZlKHRoaXMuY3VycmVudFBvaW50LmNsb25lKCksIG5ldyBWZWN0b3IyKGFDUHgsIGFDUHkpLCBuZXcgVmVjdG9yMihhWCwgYVkpKTsKICAgICAgdGhpcy5jdXJ2ZXMucHVzaChjdXJ2ZSk7CiAgICAgIHRoaXMuY3VycmVudFBvaW50LnNldChhWCwgYVkpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGJlemllckN1cnZlVG8oYUNQMXgsIGFDUDF5LCBhQ1AyeCwgYUNQMnksIGFYLCBhWSkgewogICAgICBjb25zdCBjdXJ2ZSA9IG5ldyBDdWJpY0JlemllckN1cnZlKHRoaXMuY3VycmVudFBvaW50LmNsb25lKCksIG5ldyBWZWN0b3IyKGFDUDF4LCBhQ1AxeSksIG5ldyBWZWN0b3IyKGFDUDJ4LCBhQ1AyeSksIG5ldyBWZWN0b3IyKGFYLCBhWSkpOwogICAgICB0aGlzLmN1cnZlcy5wdXNoKGN1cnZlKTsKICAgICAgdGhpcy5jdXJyZW50UG9pbnQuc2V0KGFYLCBhWSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc3BsaW5lVGhydShwdHMpIHsKICAgICAgY29uc3QgbnB0cyA9IFt0aGlzLmN1cnJlbnRQb2ludC5jbG9uZSgpXS5jb25jYXQocHRzKTsKICAgICAgY29uc3QgY3VydmUgPSBuZXcgU3BsaW5lQ3VydmUobnB0cyk7CiAgICAgIHRoaXMuY3VydmVzLnB1c2goY3VydmUpOwogICAgICB0aGlzLmN1cnJlbnRQb2ludC5jb3B5KHB0c1twdHMubGVuZ3RoIC0gMV0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFyYyhhWCwgYVksIGFSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UpIHsKICAgICAgY29uc3QgeDAgPSB0aGlzLmN1cnJlbnRQb2ludC54OwogICAgICBjb25zdCB5MCA9IHRoaXMuY3VycmVudFBvaW50Lnk7CiAgICAgIHRoaXMuYWJzYXJjKGFYICsgeDAsIGFZICsgeTAsIGFSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGFic2FyYyhhWCwgYVksIGFSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UpIHsKICAgICAgdGhpcy5hYnNlbGxpcHNlKGFYLCBhWSwgYVJhZGl1cywgYVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZWxsaXBzZShhWCwgYVksIHhSYWRpdXMsIHlSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UsIGFSb3RhdGlvbikgewogICAgICBjb25zdCB4MCA9IHRoaXMuY3VycmVudFBvaW50Lng7CiAgICAgIGNvbnN0IHkwID0gdGhpcy5jdXJyZW50UG9pbnQueTsKICAgICAgdGhpcy5hYnNlbGxpcHNlKGFYICsgeDAsIGFZICsgeTAsIHhSYWRpdXMsIHlSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UsIGFSb3RhdGlvbik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWJzZWxsaXBzZShhWCwgYVksIHhSYWRpdXMsIHlSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UsIGFSb3RhdGlvbikgewogICAgICBjb25zdCBjdXJ2ZSA9IG5ldyBFbGxpcHNlQ3VydmUoYVgsIGFZLCB4UmFkaXVzLCB5UmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlLCBhUm90YXRpb24pOwogICAgICBpZiAodGhpcy5jdXJ2ZXMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IGZpcnN0UG9pbnQgPSBjdXJ2ZS5nZXRQb2ludCgwKTsKICAgICAgICBpZiAoIWZpcnN0UG9pbnQuZXF1YWxzKHRoaXMuY3VycmVudFBvaW50KSkgewogICAgICAgICAgdGhpcy5saW5lVG8oZmlyc3RQb2ludC54LCBmaXJzdFBvaW50LnkpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmN1cnZlcy5wdXNoKGN1cnZlKTsKICAgICAgY29uc3QgbGFzdFBvaW50ID0gY3VydmUuZ2V0UG9pbnQoMSk7CiAgICAgIHRoaXMuY3VycmVudFBvaW50LmNvcHkobGFzdFBvaW50KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMuY3VycmVudFBvaW50LmNvcHkoc291cmNlLmN1cnJlbnRQb2ludCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9KU09OKCkgewogICAgICBjb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CiAgICAgIGRhdGEuY3VycmVudFBvaW50ID0gdGhpcy5jdXJyZW50UG9pbnQudG9BcnJheSgpOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICAgIGZyb21KU09OKGpzb24pIHsKICAgICAgc3VwZXIuZnJvbUpTT04oanNvbik7CiAgICAgIHRoaXMuY3VycmVudFBvaW50LmZyb21BcnJheShqc29uLmN1cnJlbnRQb2ludCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgdmFyIFNoYXBlID0gY2xhc3MgZXh0ZW5kcyBQYXRoIHsKICAgIGNvbnN0cnVjdG9yKHBvaW50cykgewogICAgICBzdXBlcihwb2ludHMpOwogICAgICB0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKICAgICAgdGhpcy50eXBlID0gIlNoYXBlIjsKICAgICAgdGhpcy5ob2xlcyA9IFtdOwogICAgfQogICAgZ2V0UG9pbnRzSG9sZXMoZGl2aXNpb25zKSB7CiAgICAgIGNvbnN0IGhvbGVzUHRzID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5ob2xlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBob2xlc1B0c1tpXSA9IHRoaXMuaG9sZXNbaV0uZ2V0UG9pbnRzKGRpdmlzaW9ucyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGhvbGVzUHRzOwogICAgfQogICAgZXh0cmFjdFBvaW50cyhkaXZpc2lvbnMpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBzaGFwZTogdGhpcy5nZXRQb2ludHMoZGl2aXNpb25zKSwKICAgICAgICBob2xlczogdGhpcy5nZXRQb2ludHNIb2xlcyhkaXZpc2lvbnMpCiAgICAgIH07CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMuaG9sZXMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzb3VyY2UuaG9sZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgaG9sZSA9IHNvdXJjZS5ob2xlc1tpXTsKICAgICAgICB0aGlzLmhvbGVzLnB1c2goaG9sZS5jbG9uZSgpKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwogICAgICBkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CiAgICAgIGRhdGEuaG9sZXMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLmhvbGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IGhvbGUgPSB0aGlzLmhvbGVzW2ldOwogICAgICAgIGRhdGEuaG9sZXMucHVzaChob2xlLnRvSlNPTigpKTsKICAgICAgfQogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICAgIGZyb21KU09OKGpzb24pIHsKICAgICAgc3VwZXIuZnJvbUpTT04oanNvbik7CiAgICAgIHRoaXMudXVpZCA9IGpzb24udXVpZDsKICAgICAgdGhpcy5ob2xlcyA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGpzb24uaG9sZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgaG9sZSA9IGpzb24uaG9sZXNbaV07CiAgICAgICAgdGhpcy5ob2xlcy5wdXNoKG5ldyBQYXRoKCkuZnJvbUpTT04oaG9sZSkpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgdmFyIExpZ2h0ID0gY2xhc3MgZXh0ZW5kcyBPYmplY3QzRCB7CiAgICBjb25zdHJ1Y3Rvcihjb2xvciwgaW50ZW5zaXR5ID0gMSkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiTGlnaHQiOwogICAgICB0aGlzLmNvbG9yID0gbmV3IENvbG9yKGNvbG9yKTsKICAgICAgdGhpcy5pbnRlbnNpdHkgPSBpbnRlbnNpdHk7CiAgICB9CiAgICBkaXNwb3NlKCkgewogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLmNvbG9yLmNvcHkoc291cmNlLmNvbG9yKTsKICAgICAgdGhpcy5pbnRlbnNpdHkgPSBzb3VyY2UuaW50ZW5zaXR5OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvSlNPTihtZXRhKSB7CiAgICAgIGNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04obWV0YSk7CiAgICAgIGRhdGEub2JqZWN0LmNvbG9yID0gdGhpcy5jb2xvci5nZXRIZXgoKTsKICAgICAgZGF0YS5vYmplY3QuaW50ZW5zaXR5ID0gdGhpcy5pbnRlbnNpdHk7CiAgICAgIGlmICh0aGlzLmdyb3VuZENvbG9yICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5vYmplY3QuZ3JvdW5kQ29sb3IgPSB0aGlzLmdyb3VuZENvbG9yLmdldEhleCgpOwogICAgICBpZiAodGhpcy5kaXN0YW5jZSAhPT0gdm9pZCAwKQogICAgICAgIGRhdGEub2JqZWN0LmRpc3RhbmNlID0gdGhpcy5kaXN0YW5jZTsKICAgICAgaWYgKHRoaXMuYW5nbGUgIT09IHZvaWQgMCkKICAgICAgICBkYXRhLm9iamVjdC5hbmdsZSA9IHRoaXMuYW5nbGU7CiAgICAgIGlmICh0aGlzLmRlY2F5ICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5vYmplY3QuZGVjYXkgPSB0aGlzLmRlY2F5OwogICAgICBpZiAodGhpcy5wZW51bWJyYSAhPT0gdm9pZCAwKQogICAgICAgIGRhdGEub2JqZWN0LnBlbnVtYnJhID0gdGhpcy5wZW51bWJyYTsKICAgICAgaWYgKHRoaXMuc2hhZG93ICE9PSB2b2lkIDApCiAgICAgICAgZGF0YS5vYmplY3Quc2hhZG93ID0gdGhpcy5zaGFkb3cudG9KU09OKCk7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogIH07CiAgTGlnaHQucHJvdG90eXBlLmlzTGlnaHQgPSB0cnVlOwogIHZhciBIZW1pc3BoZXJlTGlnaHQgPSBjbGFzcyBleHRlbmRzIExpZ2h0IHsKICAgIGNvbnN0cnVjdG9yKHNreUNvbG9yLCBncm91bmRDb2xvciwgaW50ZW5zaXR5KSB7CiAgICAgIHN1cGVyKHNreUNvbG9yLCBpbnRlbnNpdHkpOwogICAgICB0aGlzLnR5cGUgPSAiSGVtaXNwaGVyZUxpZ2h0IjsKICAgICAgdGhpcy5wb3NpdGlvbi5jb3B5KE9iamVjdDNELkRlZmF1bHRVcCk7CiAgICAgIHRoaXMudXBkYXRlTWF0cml4KCk7CiAgICAgIHRoaXMuZ3JvdW5kQ29sb3IgPSBuZXcgQ29sb3IoZ3JvdW5kQ29sb3IpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgTGlnaHQucHJvdG90eXBlLmNvcHkuY2FsbCh0aGlzLCBzb3VyY2UpOwogICAgICB0aGlzLmdyb3VuZENvbG9yLmNvcHkoc291cmNlLmdyb3VuZENvbG9yKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBIZW1pc3BoZXJlTGlnaHQucHJvdG90eXBlLmlzSGVtaXNwaGVyZUxpZ2h0ID0gdHJ1ZTsKICB2YXIgX3Byb2pTY3JlZW5NYXRyaXgkMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWF0cml4NCgpOwogIHZhciBfbGlnaHRQb3NpdGlvbldvcmxkJDEgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX2xvb2tUYXJnZXQkMSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBMaWdodFNoYWRvdyA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGNhbWVyYSkgewogICAgICB0aGlzLmNhbWVyYSA9IGNhbWVyYTsKICAgICAgdGhpcy5iaWFzID0gMDsKICAgICAgdGhpcy5ub3JtYWxCaWFzID0gMDsKICAgICAgdGhpcy5yYWRpdXMgPSAxOwogICAgICB0aGlzLm1hcFNpemUgPSBuZXcgVmVjdG9yMig1MTIsIDUxMik7CiAgICAgIHRoaXMubWFwID0gbnVsbDsKICAgICAgdGhpcy5tYXBQYXNzID0gbnVsbDsKICAgICAgdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4NCgpOwogICAgICB0aGlzLmF1dG9VcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLm5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICAgIHRoaXMuX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwogICAgICB0aGlzLl9mcmFtZUV4dGVudHMgPSBuZXcgVmVjdG9yMigxLCAxKTsKICAgICAgdGhpcy5fdmlld3BvcnRDb3VudCA9IDE7CiAgICAgIHRoaXMuX3ZpZXdwb3J0cyA9IFsKICAgICAgICBuZXcgVmVjdG9yNCgwLCAwLCAxLCAxKQogICAgICBdOwogICAgfQogICAgZ2V0Vmlld3BvcnRDb3VudCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdwb3J0Q291bnQ7CiAgICB9CiAgICBnZXRGcnVzdHVtKCkgewogICAgICByZXR1cm4gdGhpcy5fZnJ1c3R1bTsKICAgIH0KICAgIHVwZGF0ZU1hdHJpY2VzKGxpZ2h0KSB7CiAgICAgIGNvbnN0IHNoYWRvd0NhbWVyYSA9IHRoaXMuY2FtZXJhOwogICAgICBjb25zdCBzaGFkb3dNYXRyaXggPSB0aGlzLm1hdHJpeDsKICAgICAgX2xpZ2h0UG9zaXRpb25Xb3JsZCQxLnNldEZyb21NYXRyaXhQb3NpdGlvbihsaWdodC5tYXRyaXhXb3JsZCk7CiAgICAgIHNoYWRvd0NhbWVyYS5wb3NpdGlvbi5jb3B5KF9saWdodFBvc2l0aW9uV29ybGQkMSk7CiAgICAgIF9sb29rVGFyZ2V0JDEuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKGxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCk7CiAgICAgIHNoYWRvd0NhbWVyYS5sb29rQXQoX2xvb2tUYXJnZXQkMSk7CiAgICAgIHNoYWRvd0NhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwogICAgICBfcHJvalNjcmVlbk1hdHJpeCQxLm11bHRpcGx5TWF0cmljZXMoc2hhZG93Q2FtZXJhLnByb2plY3Rpb25NYXRyaXgsIHNoYWRvd0NhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UpOwogICAgICB0aGlzLl9mcnVzdHVtLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KF9wcm9qU2NyZWVuTWF0cml4JDEpOwogICAgICBzaGFkb3dNYXRyaXguc2V0KDAuNSwgMCwgMCwgMC41LCAwLCAwLjUsIDAsIDAuNSwgMCwgMCwgMC41LCAwLjUsIDAsIDAsIDAsIDEpOwogICAgICBzaGFkb3dNYXRyaXgubXVsdGlwbHkoc2hhZG93Q2FtZXJhLnByb2plY3Rpb25NYXRyaXgpOwogICAgICBzaGFkb3dNYXRyaXgubXVsdGlwbHkoc2hhZG93Q2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSk7CiAgICB9CiAgICBnZXRWaWV3cG9ydCh2aWV3cG9ydEluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLl92aWV3cG9ydHNbdmlld3BvcnRJbmRleF07CiAgICB9CiAgICBnZXRGcmFtZUV4dGVudHMoKSB7CiAgICAgIHJldHVybiB0aGlzLl9mcmFtZUV4dGVudHM7CiAgICB9CiAgICBkaXNwb3NlKCkgewogICAgICBpZiAodGhpcy5tYXApIHsKICAgICAgICB0aGlzLm1hcC5kaXNwb3NlKCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMubWFwUGFzcykgewogICAgICAgIHRoaXMubWFwUGFzcy5kaXNwb3NlKCk7CiAgICAgIH0KICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHRoaXMuY2FtZXJhID0gc291cmNlLmNhbWVyYS5jbG9uZSgpOwogICAgICB0aGlzLmJpYXMgPSBzb3VyY2UuYmlhczsKICAgICAgdGhpcy5yYWRpdXMgPSBzb3VyY2UucmFkaXVzOwogICAgICB0aGlzLm1hcFNpemUuY29weShzb3VyY2UubWFwU2l6ZSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyk7CiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgIGNvbnN0IG9iamVjdCA9IHt9OwogICAgICBpZiAodGhpcy5iaWFzICE9PSAwKQogICAgICAgIG9iamVjdC5iaWFzID0gdGhpcy5iaWFzOwogICAgICBpZiAodGhpcy5ub3JtYWxCaWFzICE9PSAwKQogICAgICAgIG9iamVjdC5ub3JtYWxCaWFzID0gdGhpcy5ub3JtYWxCaWFzOwogICAgICBpZiAodGhpcy5yYWRpdXMgIT09IDEpCiAgICAgICAgb2JqZWN0LnJhZGl1cyA9IHRoaXMucmFkaXVzOwogICAgICBpZiAodGhpcy5tYXBTaXplLnggIT09IDUxMiB8fCB0aGlzLm1hcFNpemUueSAhPT0gNTEyKQogICAgICAgIG9iamVjdC5tYXBTaXplID0gdGhpcy5tYXBTaXplLnRvQXJyYXkoKTsKICAgICAgb2JqZWN0LmNhbWVyYSA9IHRoaXMuY2FtZXJhLnRvSlNPTihmYWxzZSkub2JqZWN0OwogICAgICBkZWxldGUgb2JqZWN0LmNhbWVyYS5tYXRyaXg7CiAgICAgIHJldHVybiBvYmplY3Q7CiAgICB9CiAgfTsKICB2YXIgU3BvdExpZ2h0U2hhZG93ID0gY2xhc3MgZXh0ZW5kcyBMaWdodFNoYWRvdyB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIobmV3IFBlcnNwZWN0aXZlQ2FtZXJhKDUwLCAxLCAwLjUsIDUwMCkpOwogICAgICB0aGlzLmZvY3VzID0gMTsKICAgIH0KICAgIHVwZGF0ZU1hdHJpY2VzKGxpZ2h0KSB7CiAgICAgIGNvbnN0IGNhbWVyYSA9IHRoaXMuY2FtZXJhOwogICAgICBjb25zdCBmb3YyID0gUkFEMkRFRyAqIDIgKiBsaWdodC5hbmdsZSAqIHRoaXMuZm9jdXM7CiAgICAgIGNvbnN0IGFzcGVjdDIgPSB0aGlzLm1hcFNpemUud2lkdGggLyB0aGlzLm1hcFNpemUuaGVpZ2h0OwogICAgICBjb25zdCBmYXIgPSBsaWdodC5kaXN0YW5jZSB8fCBjYW1lcmEuZmFyOwogICAgICBpZiAoZm92MiAhPT0gY2FtZXJhLmZvdiB8fCBhc3BlY3QyICE9PSBjYW1lcmEuYXNwZWN0IHx8IGZhciAhPT0gY2FtZXJhLmZhcikgewogICAgICAgIGNhbWVyYS5mb3YgPSBmb3YyOwogICAgICAgIGNhbWVyYS5hc3BlY3QgPSBhc3BlY3QyOwogICAgICAgIGNhbWVyYS5mYXIgPSBmYXI7CiAgICAgICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKICAgICAgfQogICAgICBzdXBlci51cGRhdGVNYXRyaWNlcyhsaWdodCk7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMuZm9jdXMgPSBzb3VyY2UuZm9jdXM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgU3BvdExpZ2h0U2hhZG93LnByb3RvdHlwZS5pc1Nwb3RMaWdodFNoYWRvdyA9IHRydWU7CiAgdmFyIFNwb3RMaWdodCA9IGNsYXNzIGV4dGVuZHMgTGlnaHQgewogICAgY29uc3RydWN0b3IoY29sb3IsIGludGVuc2l0eSwgZGlzdGFuY2UgPSAwLCBhbmdsZSA9IE1hdGguUEkgLyAzLCBwZW51bWJyYSA9IDAsIGRlY2F5ID0gMSkgewogICAgICBzdXBlcihjb2xvciwgaW50ZW5zaXR5KTsKICAgICAgdGhpcy50eXBlID0gIlNwb3RMaWdodCI7CiAgICAgIHRoaXMucG9zaXRpb24uY29weShPYmplY3QzRC5EZWZhdWx0VXApOwogICAgICB0aGlzLnVwZGF0ZU1hdHJpeCgpOwogICAgICB0aGlzLnRhcmdldCA9IG5ldyBPYmplY3QzRCgpOwogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICAgIHRoaXMuYW5nbGUgPSBhbmdsZTsKICAgICAgdGhpcy5wZW51bWJyYSA9IHBlbnVtYnJhOwogICAgICB0aGlzLmRlY2F5ID0gZGVjYXk7CiAgICAgIHRoaXMuc2hhZG93ID0gbmV3IFNwb3RMaWdodFNoYWRvdygpOwogICAgfQogICAgZ2V0IHBvd2VyKCkgewogICAgICByZXR1cm4gdGhpcy5pbnRlbnNpdHkgKiBNYXRoLlBJOwogICAgfQogICAgc2V0IHBvd2VyKHBvd2VyKSB7CiAgICAgIHRoaXMuaW50ZW5zaXR5ID0gcG93ZXIgLyBNYXRoLlBJOwogICAgfQogICAgZGlzcG9zZSgpIHsKICAgICAgdGhpcy5zaGFkb3cuZGlzcG9zZSgpOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLmRpc3RhbmNlID0gc291cmNlLmRpc3RhbmNlOwogICAgICB0aGlzLmFuZ2xlID0gc291cmNlLmFuZ2xlOwogICAgICB0aGlzLnBlbnVtYnJhID0gc291cmNlLnBlbnVtYnJhOwogICAgICB0aGlzLmRlY2F5ID0gc291cmNlLmRlY2F5OwogICAgICB0aGlzLnRhcmdldCA9IHNvdXJjZS50YXJnZXQuY2xvbmUoKTsKICAgICAgdGhpcy5zaGFkb3cgPSBzb3VyY2Uuc2hhZG93LmNsb25lKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgU3BvdExpZ2h0LnByb3RvdHlwZS5pc1Nwb3RMaWdodCA9IHRydWU7CiAgdmFyIF9wcm9qU2NyZWVuTWF0cml4ID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXRyaXg0KCk7CiAgdmFyIF9saWdodFBvc2l0aW9uV29ybGQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgX2xvb2tUYXJnZXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgUG9pbnRMaWdodFNoYWRvdyA9IGNsYXNzIGV4dGVuZHMgTGlnaHRTaGFkb3cgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSg5MCwgMSwgMC41LCA1MDApKTsKICAgICAgdGhpcy5fZnJhbWVFeHRlbnRzID0gbmV3IFZlY3RvcjIoNCwgMik7CiAgICAgIHRoaXMuX3ZpZXdwb3J0Q291bnQgPSA2OwogICAgICB0aGlzLl92aWV3cG9ydHMgPSBbCiAgICAgICAgbmV3IFZlY3RvcjQoMiwgMSwgMSwgMSksCiAgICAgICAgbmV3IFZlY3RvcjQoMCwgMSwgMSwgMSksCiAgICAgICAgbmV3IFZlY3RvcjQoMywgMSwgMSwgMSksCiAgICAgICAgbmV3IFZlY3RvcjQoMSwgMSwgMSwgMSksCiAgICAgICAgbmV3IFZlY3RvcjQoMywgMCwgMSwgMSksCiAgICAgICAgbmV3IFZlY3RvcjQoMSwgMCwgMSwgMSkKICAgICAgXTsKICAgICAgdGhpcy5fY3ViZURpcmVjdGlvbnMgPSBbCiAgICAgICAgbmV3IFZlY3RvcjMoMSwgMCwgMCksCiAgICAgICAgbmV3IFZlY3RvcjMoLTEsIDAsIDApLAogICAgICAgIG5ldyBWZWN0b3IzKDAsIDAsIDEpLAogICAgICAgIG5ldyBWZWN0b3IzKDAsIDAsIC0xKSwKICAgICAgICBuZXcgVmVjdG9yMygwLCAxLCAwKSwKICAgICAgICBuZXcgVmVjdG9yMygwLCAtMSwgMCkKICAgICAgXTsKICAgICAgdGhpcy5fY3ViZVVwcyA9IFsKICAgICAgICBuZXcgVmVjdG9yMygwLCAxLCAwKSwKICAgICAgICBuZXcgVmVjdG9yMygwLCAxLCAwKSwKICAgICAgICBuZXcgVmVjdG9yMygwLCAxLCAwKSwKICAgICAgICBuZXcgVmVjdG9yMygwLCAxLCAwKSwKICAgICAgICBuZXcgVmVjdG9yMygwLCAwLCAxKSwKICAgICAgICBuZXcgVmVjdG9yMygwLCAwLCAtMSkKICAgICAgXTsKICAgIH0KICAgIHVwZGF0ZU1hdHJpY2VzKGxpZ2h0LCB2aWV3cG9ydEluZGV4ID0gMCkgewogICAgICBjb25zdCBjYW1lcmEgPSB0aGlzLmNhbWVyYTsKICAgICAgY29uc3Qgc2hhZG93TWF0cml4ID0gdGhpcy5tYXRyaXg7CiAgICAgIGNvbnN0IGZhciA9IGxpZ2h0LmRpc3RhbmNlIHx8IGNhbWVyYS5mYXI7CiAgICAgIGlmIChmYXIgIT09IGNhbWVyYS5mYXIpIHsKICAgICAgICBjYW1lcmEuZmFyID0gZmFyOwogICAgICAgIGNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CiAgICAgIH0KICAgICAgX2xpZ2h0UG9zaXRpb25Xb3JsZC5zZXRGcm9tTWF0cml4UG9zaXRpb24obGlnaHQubWF0cml4V29ybGQpOwogICAgICBjYW1lcmEucG9zaXRpb24uY29weShfbGlnaHRQb3NpdGlvbldvcmxkKTsKICAgICAgX2xvb2tUYXJnZXQuY29weShjYW1lcmEucG9zaXRpb24pOwogICAgICBfbG9va1RhcmdldC5hZGQodGhpcy5fY3ViZURpcmVjdGlvbnNbdmlld3BvcnRJbmRleF0pOwogICAgICBjYW1lcmEudXAuY29weSh0aGlzLl9jdWJlVXBzW3ZpZXdwb3J0SW5kZXhdKTsKICAgICAgY2FtZXJhLmxvb2tBdChfbG9va1RhcmdldCk7CiAgICAgIGNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwogICAgICBzaGFkb3dNYXRyaXgubWFrZVRyYW5zbGF0aW9uKC1fbGlnaHRQb3NpdGlvbldvcmxkLngsIC1fbGlnaHRQb3NpdGlvbldvcmxkLnksIC1fbGlnaHRQb3NpdGlvbldvcmxkLnopOwogICAgICBfcHJvalNjcmVlbk1hdHJpeC5tdWx0aXBseU1hdHJpY2VzKGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlKTsKICAgICAgdGhpcy5fZnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeChfcHJvalNjcmVlbk1hdHJpeCk7CiAgICB9CiAgfTsKICBQb2ludExpZ2h0U2hhZG93LnByb3RvdHlwZS5pc1BvaW50TGlnaHRTaGFkb3cgPSB0cnVlOwogIHZhciBQb2ludExpZ2h0ID0gY2xhc3MgZXh0ZW5kcyBMaWdodCB7CiAgICBjb25zdHJ1Y3Rvcihjb2xvciwgaW50ZW5zaXR5LCBkaXN0YW5jZSA9IDAsIGRlY2F5ID0gMSkgewogICAgICBzdXBlcihjb2xvciwgaW50ZW5zaXR5KTsKICAgICAgdGhpcy50eXBlID0gIlBvaW50TGlnaHQiOwogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICAgIHRoaXMuZGVjYXkgPSBkZWNheTsKICAgICAgdGhpcy5zaGFkb3cgPSBuZXcgUG9pbnRMaWdodFNoYWRvdygpOwogICAgfQogICAgZ2V0IHBvd2VyKCkgewogICAgICByZXR1cm4gdGhpcy5pbnRlbnNpdHkgKiA0ICogTWF0aC5QSTsKICAgIH0KICAgIHNldCBwb3dlcihwb3dlcikgewogICAgICB0aGlzLmludGVuc2l0eSA9IHBvd2VyIC8gKDQgKiBNYXRoLlBJKTsKICAgIH0KICAgIGRpc3Bvc2UoKSB7CiAgICAgIHRoaXMuc2hhZG93LmRpc3Bvc2UoKTsKICAgIH0KICAgIGNvcHkoc291cmNlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlKTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IHNvdXJjZS5kaXN0YW5jZTsKICAgICAgdGhpcy5kZWNheSA9IHNvdXJjZS5kZWNheTsKICAgICAgdGhpcy5zaGFkb3cgPSBzb3VyY2Uuc2hhZG93LmNsb25lKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgUG9pbnRMaWdodC5wcm90b3R5cGUuaXNQb2ludExpZ2h0ID0gdHJ1ZTsKICB2YXIgT3J0aG9ncmFwaGljQ2FtZXJhID0gY2xhc3MgZXh0ZW5kcyBDYW1lcmEgewogICAgY29uc3RydWN0b3IobGVmdCA9IC0xLCByaWdodCA9IDEsIHRvcCA9IDEsIGJvdHRvbSA9IC0xLCBuZWFyID0gMC4xLCBmYXIgPSAyZTMpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy50eXBlID0gIk9ydGhvZ3JhcGhpY0NhbWVyYSI7CiAgICAgIHRoaXMuem9vbSA9IDE7CiAgICAgIHRoaXMudmlldyA9IG51bGw7CiAgICAgIHRoaXMubGVmdCA9IGxlZnQ7CiAgICAgIHRoaXMucmlnaHQgPSByaWdodDsKICAgICAgdGhpcy50b3AgPSB0b3A7CiAgICAgIHRoaXMuYm90dG9tID0gYm90dG9tOwogICAgICB0aGlzLm5lYXIgPSBuZWFyOwogICAgICB0aGlzLmZhciA9IGZhcjsKICAgICAgdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CiAgICB9CiAgICBjb3B5KHNvdXJjZSwgcmVjdXJzaXZlKSB7CiAgICAgIHN1cGVyLmNvcHkoc291cmNlLCByZWN1cnNpdmUpOwogICAgICB0aGlzLmxlZnQgPSBzb3VyY2UubGVmdDsKICAgICAgdGhpcy5yaWdodCA9IHNvdXJjZS5yaWdodDsKICAgICAgdGhpcy50b3AgPSBzb3VyY2UudG9wOwogICAgICB0aGlzLmJvdHRvbSA9IHNvdXJjZS5ib3R0b207CiAgICAgIHRoaXMubmVhciA9IHNvdXJjZS5uZWFyOwogICAgICB0aGlzLmZhciA9IHNvdXJjZS5mYXI7CiAgICAgIHRoaXMuem9vbSA9IHNvdXJjZS56b29tOwogICAgICB0aGlzLnZpZXcgPSBzb3VyY2UudmlldyA9PT0gbnVsbCA/IG51bGwgOiBPYmplY3QuYXNzaWduKHt9LCBzb3VyY2Uudmlldyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0Vmlld09mZnNldChmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgaWYgKHRoaXMudmlldyA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudmlldyA9IHsKICAgICAgICAgIGVuYWJsZWQ6IHRydWUsCiAgICAgICAgICBmdWxsV2lkdGg6IDEsCiAgICAgICAgICBmdWxsSGVpZ2h0OiAxLAogICAgICAgICAgb2Zmc2V0WDogMCwKICAgICAgICAgIG9mZnNldFk6IDAsCiAgICAgICAgICB3aWR0aDogMSwKICAgICAgICAgIGhlaWdodDogMQogICAgICAgIH07CiAgICAgIH0KICAgICAgdGhpcy52aWV3LmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnZpZXcuZnVsbFdpZHRoID0gZnVsbFdpZHRoOwogICAgICB0aGlzLnZpZXcuZnVsbEhlaWdodCA9IGZ1bGxIZWlnaHQ7CiAgICAgIHRoaXMudmlldy5vZmZzZXRYID0geDsKICAgICAgdGhpcy52aWV3Lm9mZnNldFkgPSB5OwogICAgICB0aGlzLnZpZXcud2lkdGggPSB3aWR0aDsKICAgICAgdGhpcy52aWV3LmhlaWdodCA9IGhlaWdodDsKICAgICAgdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CiAgICB9CiAgICBjbGVhclZpZXdPZmZzZXQoKSB7CiAgICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwpIHsKICAgICAgICB0aGlzLnZpZXcuZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICAgIHRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwogICAgfQogICAgdXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpIHsKICAgICAgY29uc3QgZHggPSAodGhpcy5yaWdodCAtIHRoaXMubGVmdCkgLyAoMiAqIHRoaXMuem9vbSk7CiAgICAgIGNvbnN0IGR5ID0gKHRoaXMudG9wIC0gdGhpcy5ib3R0b20pIC8gKDIgKiB0aGlzLnpvb20pOwogICAgICBjb25zdCBjeCA9ICh0aGlzLnJpZ2h0ICsgdGhpcy5sZWZ0KSAvIDI7CiAgICAgIGNvbnN0IGN5ID0gKHRoaXMudG9wICsgdGhpcy5ib3R0b20pIC8gMjsKICAgICAgbGV0IGxlZnQgPSBjeCAtIGR4OwogICAgICBsZXQgcmlnaHQgPSBjeCArIGR4OwogICAgICBsZXQgdG9wID0gY3kgKyBkeTsKICAgICAgbGV0IGJvdHRvbSA9IGN5IC0gZHk7CiAgICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwgJiYgdGhpcy52aWV3LmVuYWJsZWQpIHsKICAgICAgICBjb25zdCBzY2FsZVcgPSAodGhpcy5yaWdodCAtIHRoaXMubGVmdCkgLyB0aGlzLnZpZXcuZnVsbFdpZHRoIC8gdGhpcy56b29tOwogICAgICAgIGNvbnN0IHNjYWxlSCA9ICh0aGlzLnRvcCAtIHRoaXMuYm90dG9tKSAvIHRoaXMudmlldy5mdWxsSGVpZ2h0IC8gdGhpcy56b29tOwogICAgICAgIGxlZnQgKz0gc2NhbGVXICogdGhpcy52aWV3Lm9mZnNldFg7CiAgICAgICAgcmlnaHQgPSBsZWZ0ICsgc2NhbGVXICogdGhpcy52aWV3LndpZHRoOwogICAgICAgIHRvcCAtPSBzY2FsZUggKiB0aGlzLnZpZXcub2Zmc2V0WTsKICAgICAgICBib3R0b20gPSB0b3AgLSBzY2FsZUggKiB0aGlzLnZpZXcuaGVpZ2h0OwogICAgICB9CiAgICAgIHRoaXMucHJvamVjdGlvbk1hdHJpeC5tYWtlT3J0aG9ncmFwaGljKGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgdGhpcy5uZWFyLCB0aGlzLmZhcik7CiAgICAgIHRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSh0aGlzLnByb2plY3Rpb25NYXRyaXgpLmludmVydCgpOwogICAgfQogICAgdG9KU09OKG1ldGEpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTihtZXRhKTsKICAgICAgZGF0YS5vYmplY3Quem9vbSA9IHRoaXMuem9vbTsKICAgICAgZGF0YS5vYmplY3QubGVmdCA9IHRoaXMubGVmdDsKICAgICAgZGF0YS5vYmplY3QucmlnaHQgPSB0aGlzLnJpZ2h0OwogICAgICBkYXRhLm9iamVjdC50b3AgPSB0aGlzLnRvcDsKICAgICAgZGF0YS5vYmplY3QuYm90dG9tID0gdGhpcy5ib3R0b207CiAgICAgIGRhdGEub2JqZWN0Lm5lYXIgPSB0aGlzLm5lYXI7CiAgICAgIGRhdGEub2JqZWN0LmZhciA9IHRoaXMuZmFyOwogICAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKQogICAgICAgIGRhdGEub2JqZWN0LnZpZXcgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnZpZXcpOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICB9OwogIE9ydGhvZ3JhcGhpY0NhbWVyYS5wcm90b3R5cGUuaXNPcnRob2dyYXBoaWNDYW1lcmEgPSB0cnVlOwogIHZhciBEaXJlY3Rpb25hbExpZ2h0U2hhZG93ID0gY2xhc3MgZXh0ZW5kcyBMaWdodFNoYWRvdyB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIobmV3IE9ydGhvZ3JhcGhpY0NhbWVyYSgtNSwgNSwgNSwgLTUsIDAuNSwgNTAwKSk7CiAgICB9CiAgfTsKICBEaXJlY3Rpb25hbExpZ2h0U2hhZG93LnByb3RvdHlwZS5pc0RpcmVjdGlvbmFsTGlnaHRTaGFkb3cgPSB0cnVlOwogIHZhciBEaXJlY3Rpb25hbExpZ2h0ID0gY2xhc3MgZXh0ZW5kcyBMaWdodCB7CiAgICBjb25zdHJ1Y3Rvcihjb2xvciwgaW50ZW5zaXR5KSB7CiAgICAgIHN1cGVyKGNvbG9yLCBpbnRlbnNpdHkpOwogICAgICB0aGlzLnR5cGUgPSAiRGlyZWN0aW9uYWxMaWdodCI7CiAgICAgIHRoaXMucG9zaXRpb24uY29weShPYmplY3QzRC5EZWZhdWx0VXApOwogICAgICB0aGlzLnVwZGF0ZU1hdHJpeCgpOwogICAgICB0aGlzLnRhcmdldCA9IG5ldyBPYmplY3QzRCgpOwogICAgICB0aGlzLnNoYWRvdyA9IG5ldyBEaXJlY3Rpb25hbExpZ2h0U2hhZG93KCk7CiAgICB9CiAgICBkaXNwb3NlKCkgewogICAgICB0aGlzLnNoYWRvdy5kaXNwb3NlKCk7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMudGFyZ2V0ID0gc291cmNlLnRhcmdldC5jbG9uZSgpOwogICAgICB0aGlzLnNoYWRvdyA9IHNvdXJjZS5zaGFkb3cuY2xvbmUoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBEaXJlY3Rpb25hbExpZ2h0LnByb3RvdHlwZS5pc0RpcmVjdGlvbmFsTGlnaHQgPSB0cnVlOwogIHZhciBBbWJpZW50TGlnaHQgPSBjbGFzcyBleHRlbmRzIExpZ2h0IHsKICAgIGNvbnN0cnVjdG9yKGNvbG9yLCBpbnRlbnNpdHkpIHsKICAgICAgc3VwZXIoY29sb3IsIGludGVuc2l0eSk7CiAgICAgIHRoaXMudHlwZSA9ICJBbWJpZW50TGlnaHQiOwogICAgfQogIH07CiAgQW1iaWVudExpZ2h0LnByb3RvdHlwZS5pc0FtYmllbnRMaWdodCA9IHRydWU7CiAgdmFyIFJlY3RBcmVhTGlnaHQgPSBjbGFzcyBleHRlbmRzIExpZ2h0IHsKICAgIGNvbnN0cnVjdG9yKGNvbG9yLCBpbnRlbnNpdHksIHdpZHRoID0gMTAsIGhlaWdodCA9IDEwKSB7CiAgICAgIHN1cGVyKGNvbG9yLCBpbnRlbnNpdHkpOwogICAgICB0aGlzLnR5cGUgPSAiUmVjdEFyZWFMaWdodCI7CiAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMud2lkdGggPSBzb3VyY2Uud2lkdGg7CiAgICAgIHRoaXMuaGVpZ2h0ID0gc291cmNlLmhlaWdodDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0b0pTT04obWV0YSkgewogICAgICBjb25zdCBkYXRhID0gc3VwZXIudG9KU09OKG1ldGEpOwogICAgICBkYXRhLm9iamVjdC53aWR0aCA9IHRoaXMud2lkdGg7CiAgICAgIGRhdGEub2JqZWN0LmhlaWdodCA9IHRoaXMuaGVpZ2h0OwogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICB9OwogIFJlY3RBcmVhTGlnaHQucHJvdG90eXBlLmlzUmVjdEFyZWFMaWdodCA9IHRydWU7CiAgdmFyIFNwaGVyaWNhbEhhcm1vbmljczMgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICB0aGlzLmNvZWZmaWNpZW50cy5wdXNoKG5ldyBWZWN0b3IzKCkpOwogICAgICB9CiAgICB9CiAgICBzZXQoY29lZmZpY2llbnRzKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgOTsgaSsrKSB7CiAgICAgICAgdGhpcy5jb2VmZmljaWVudHNbaV0uY29weShjb2VmZmljaWVudHNbaV0pOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgemVybygpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICB0aGlzLmNvZWZmaWNpZW50c1tpXS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXRBdChub3JtYWwyLCB0YXJnZXQpIHsKICAgICAgY29uc3QgeCA9IG5vcm1hbDIueCwgeSA9IG5vcm1hbDIueSwgeiA9IG5vcm1hbDIuejsKICAgICAgY29uc3QgY29lZmYgPSB0aGlzLmNvZWZmaWNpZW50czsKICAgICAgdGFyZ2V0LmNvcHkoY29lZmZbMF0pLm11bHRpcGx5U2NhbGFyKDAuMjgyMDk1KTsKICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3Rvcihjb2VmZlsxXSwgMC40ODg2MDMgKiB5KTsKICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3Rvcihjb2VmZlsyXSwgMC40ODg2MDMgKiB6KTsKICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3Rvcihjb2VmZlszXSwgMC40ODg2MDMgKiB4KTsKICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3Rvcihjb2VmZls0XSwgMS4wOTI1NDggKiAoeCAqIHkpKTsKICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3Rvcihjb2VmZls1XSwgMS4wOTI1NDggKiAoeSAqIHopKTsKICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3Rvcihjb2VmZls2XSwgMC4zMTUzOTIgKiAoMyAqIHogKiB6IC0gMSkpOwogICAgICB0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKGNvZWZmWzddLCAxLjA5MjU0OCAqICh4ICogeikpOwogICAgICB0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKGNvZWZmWzhdLCAwLjU0NjI3NCAqICh4ICogeCAtIHkgKiB5KSk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICBnZXRJcnJhZGlhbmNlQXQobm9ybWFsMiwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSBub3JtYWwyLngsIHkgPSBub3JtYWwyLnksIHogPSBub3JtYWwyLno7CiAgICAgIGNvbnN0IGNvZWZmID0gdGhpcy5jb2VmZmljaWVudHM7CiAgICAgIHRhcmdldC5jb3B5KGNvZWZmWzBdKS5tdWx0aXBseVNjYWxhcigwLjg4NjIyNyk7CiAgICAgIHRhcmdldC5hZGRTY2FsZWRWZWN0b3IoY29lZmZbMV0sIDIgKiAwLjUxMTY2NCAqIHkpOwogICAgICB0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKGNvZWZmWzJdLCAyICogMC41MTE2NjQgKiB6KTsKICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3Rvcihjb2VmZlszXSwgMiAqIDAuNTExNjY0ICogeCk7CiAgICAgIHRhcmdldC5hZGRTY2FsZWRWZWN0b3IoY29lZmZbNF0sIDIgKiAwLjQyOTA0MyAqIHggKiB5KTsKICAgICAgdGFyZ2V0LmFkZFNjYWxlZFZlY3Rvcihjb2VmZls1XSwgMiAqIDAuNDI5MDQzICogeSAqIHopOwogICAgICB0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKGNvZWZmWzZdLCAwLjc0MzEyNSAqIHogKiB6IC0gMC4yNDc3MDgpOwogICAgICB0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKGNvZWZmWzddLCAyICogMC40MjkwNDMgKiB4ICogeik7CiAgICAgIHRhcmdldC5hZGRTY2FsZWRWZWN0b3IoY29lZmZbOF0sIDAuNDI5MDQzICogKHggKiB4IC0geSAqIHkpKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGFkZChzaCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDk7IGkrKykgewogICAgICAgIHRoaXMuY29lZmZpY2llbnRzW2ldLmFkZChzaC5jb2VmZmljaWVudHNbaV0pOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgYWRkU2NhbGVkU0goc2gsIHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICB0aGlzLmNvZWZmaWNpZW50c1tpXS5hZGRTY2FsZWRWZWN0b3Ioc2guY29lZmZpY2llbnRzW2ldLCBzKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNjYWxlKHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICB0aGlzLmNvZWZmaWNpZW50c1tpXS5tdWx0aXBseVNjYWxhcihzKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGxlcnAoc2gsIGFscGhhKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgOTsgaSsrKSB7CiAgICAgICAgdGhpcy5jb2VmZmljaWVudHNbaV0ubGVycChzaC5jb2VmZmljaWVudHNbaV0sIGFscGhhKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGVxdWFscyhzaCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDk7IGkrKykgewogICAgICAgIGlmICghdGhpcy5jb2VmZmljaWVudHNbaV0uZXF1YWxzKHNoLmNvZWZmaWNpZW50c1tpXSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBjb3B5KHNoKSB7CiAgICAgIHJldHVybiB0aGlzLnNldChzaC5jb2VmZmljaWVudHMpOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyk7CiAgICB9CiAgICBmcm9tQXJyYXkoYXJyYXksIG9mZnNldCA9IDApIHsKICAgICAgY29uc3QgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgOTsgaSsrKSB7CiAgICAgICAgY29lZmZpY2llbnRzW2ldLmZyb21BcnJheShhcnJheSwgb2Zmc2V0ICsgaSAqIDMpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdG9BcnJheShhcnJheSA9IFtdLCBvZmZzZXQgPSAwKSB7CiAgICAgIGNvbnN0IGNvZWZmaWNpZW50cyA9IHRoaXMuY29lZmZpY2llbnRzOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDk7IGkrKykgewogICAgICAgIGNvZWZmaWNpZW50c1tpXS50b0FycmF5KGFycmF5LCBvZmZzZXQgKyBpICogMyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGFycmF5OwogICAgfQogICAgc3RhdGljIGdldEJhc2lzQXQobm9ybWFsMiwgc2hCYXNpcykgewogICAgICBjb25zdCB4ID0gbm9ybWFsMi54LCB5ID0gbm9ybWFsMi55LCB6ID0gbm9ybWFsMi56OwogICAgICBzaEJhc2lzWzBdID0gMC4yODIwOTU7CiAgICAgIHNoQmFzaXNbMV0gPSAwLjQ4ODYwMyAqIHk7CiAgICAgIHNoQmFzaXNbMl0gPSAwLjQ4ODYwMyAqIHo7CiAgICAgIHNoQmFzaXNbM10gPSAwLjQ4ODYwMyAqIHg7CiAgICAgIHNoQmFzaXNbNF0gPSAxLjA5MjU0OCAqIHggKiB5OwogICAgICBzaEJhc2lzWzVdID0gMS4wOTI1NDggKiB5ICogejsKICAgICAgc2hCYXNpc1s2XSA9IDAuMzE1MzkyICogKDMgKiB6ICogeiAtIDEpOwogICAgICBzaEJhc2lzWzddID0gMS4wOTI1NDggKiB4ICogejsKICAgICAgc2hCYXNpc1s4XSA9IDAuNTQ2Mjc0ICogKHggKiB4IC0geSAqIHkpOwogICAgfQogIH07CiAgU3BoZXJpY2FsSGFybW9uaWNzMy5wcm90b3R5cGUuaXNTcGhlcmljYWxIYXJtb25pY3MzID0gdHJ1ZTsKICB2YXIgTGlnaHRQcm9iZSA9IGNsYXNzIGV4dGVuZHMgTGlnaHQgewogICAgY29uc3RydWN0b3Ioc2ggPSBuZXcgU3BoZXJpY2FsSGFybW9uaWNzMygpLCBpbnRlbnNpdHkgPSAxKSB7CiAgICAgIHN1cGVyKHZvaWQgMCwgaW50ZW5zaXR5KTsKICAgICAgdGhpcy5zaCA9IHNoOwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLnNoLmNvcHkoc291cmNlLnNoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBmcm9tSlNPTihqc29uKSB7CiAgICAgIHRoaXMuaW50ZW5zaXR5ID0ganNvbi5pbnRlbnNpdHk7CiAgICAgIHRoaXMuc2guZnJvbUFycmF5KGpzb24uc2gpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvSlNPTihtZXRhKSB7CiAgICAgIGNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04obWV0YSk7CiAgICAgIGRhdGEub2JqZWN0LnNoID0gdGhpcy5zaC50b0FycmF5KCk7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogIH07CiAgTGlnaHRQcm9iZS5wcm90b3R5cGUuaXNMaWdodFByb2JlID0gdHJ1ZTsKICB2YXIgTG9hZGVyVXRpbHMgPSBjbGFzcyB7CiAgICBzdGF0aWMgZGVjb2RlVGV4dChhcnJheSkgewogICAgICBpZiAodHlwZW9mIFRleHREZWNvZGVyICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoYXJyYXkpOwogICAgICB9CiAgICAgIGxldCBzID0gIiI7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICBzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYXJyYXlbaV0pOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUocykpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIHM7CiAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBleHRyYWN0VXJsQmFzZSh1cmwpIHsKICAgICAgY29uc3QgaW5kZXggPSB1cmwubGFzdEluZGV4T2YoIi8iKTsKICAgICAgaWYgKGluZGV4ID09PSAtMSkKICAgICAgICByZXR1cm4gIi4vIjsKICAgICAgcmV0dXJuIHVybC5zdWJzdHIoMCwgaW5kZXggKyAxKTsKICAgIH0KICB9OwogIHZhciBJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSA9IGNsYXNzIGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudHlwZSA9ICJJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSI7CiAgICAgIHRoaXMuaW5zdGFuY2VDb3VudCA9IEluZmluaXR5OwogICAgfQogICAgY29weShzb3VyY2UpIHsKICAgICAgc3VwZXIuY29weShzb3VyY2UpOwogICAgICB0aGlzLmluc3RhbmNlQ291bnQgPSBzb3VyY2UuaW5zdGFuY2VDb3VudDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKTsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTih0aGlzKTsKICAgICAgZGF0YS5pbnN0YW5jZUNvdW50ID0gdGhpcy5pbnN0YW5jZUNvdW50OwogICAgICBkYXRhLmlzSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgPSB0cnVlOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICB9OwogIEluc3RhbmNlZEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5pc0luc3RhbmNlZEJ1ZmZlckdlb21ldHJ5ID0gdHJ1ZTsKICB2YXIgSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlID0gY2xhc3MgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewogICAgY29uc3RydWN0b3IoYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkLCBtZXNoUGVyQXR0cmlidXRlID0gMSkgewogICAgICBpZiAodHlwZW9mIG5vcm1hbGl6ZWQgPT09ICJudW1iZXIiKSB7CiAgICAgICAgbWVzaFBlckF0dHJpYnV0ZSA9IG5vcm1hbGl6ZWQ7CiAgICAgICAgbm9ybWFsaXplZCA9IGZhbHNlOwogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLkluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZTogVGhlIGNvbnN0cnVjdG9yIG5vdyBleHBlY3RzIG5vcm1hbGl6ZWQgYXMgdGhlIHRoaXJkIGFyZ3VtZW50LiIpOwogICAgICB9CiAgICAgIHN1cGVyKGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCk7CiAgICAgIHRoaXMubWVzaFBlckF0dHJpYnV0ZSA9IG1lc2hQZXJBdHRyaWJ1dGU7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMubWVzaFBlckF0dHJpYnV0ZSA9IHNvdXJjZS5tZXNoUGVyQXR0cmlidXRlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwogICAgICBkYXRhLm1lc2hQZXJBdHRyaWJ1dGUgPSB0aGlzLm1lc2hQZXJBdHRyaWJ1dGU7CiAgICAgIGRhdGEuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUgPSB0cnVlOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICB9OwogIEluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUgPSB0cnVlOwogIHZhciBJbWFnZUJpdG1hcExvYWRlciA9IGNsYXNzIGV4dGVuZHMgTG9hZGVyIHsKICAgIGNvbnN0cnVjdG9yKG1hbmFnZXIpIHsKICAgICAgc3VwZXIobWFuYWdlcik7CiAgICAgIGlmICh0eXBlb2YgY3JlYXRlSW1hZ2VCaXRtYXAgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5JbWFnZUJpdG1hcExvYWRlcjogY3JlYXRlSW1hZ2VCaXRtYXAoKSBub3Qgc3VwcG9ydGVkLiIpOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgZmV0Y2ggPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5JbWFnZUJpdG1hcExvYWRlcjogZmV0Y2goKSBub3Qgc3VwcG9ydGVkLiIpOwogICAgICB9CiAgICAgIHRoaXMub3B0aW9ucyA9IHsgcHJlbXVsdGlwbHlBbHBoYTogIm5vbmUiIH07CiAgICB9CiAgICBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBsb2FkKHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yKSB7CiAgICAgIGlmICh1cmwgPT09IHZvaWQgMCkKICAgICAgICB1cmwgPSAiIjsKICAgICAgaWYgKHRoaXMucGF0aCAhPT0gdm9pZCAwKQogICAgICAgIHVybCA9IHRoaXMucGF0aCArIHVybDsKICAgICAgdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwodXJsKTsKICAgICAgY29uc3Qgc2NvcGUgPSB0aGlzOwogICAgICBjb25zdCBjYWNoZWQgPSBDYWNoZS5nZXQodXJsKTsKICAgICAgaWYgKGNhY2hlZCAhPT0gdm9pZCAwKSB7CiAgICAgICAgc2NvcGUubWFuYWdlci5pdGVtU3RhcnQodXJsKTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKG9uTG9hZCkKICAgICAgICAgICAgb25Mb2FkKGNhY2hlZCk7CiAgICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1FbmQodXJsKTsKICAgICAgICB9LCAwKTsKICAgICAgICByZXR1cm4gY2FjaGVkOwogICAgICB9CiAgICAgIGNvbnN0IGZldGNoT3B0aW9ucyA9IHt9OwogICAgICBmZXRjaE9wdGlvbnMuY3JlZGVudGlhbHMgPSB0aGlzLmNyb3NzT3JpZ2luID09PSAiYW5vbnltb3VzIiA/ICJzYW1lLW9yaWdpbiIgOiAiaW5jbHVkZSI7CiAgICAgIGZldGNoT3B0aW9ucy5oZWFkZXJzID0gdGhpcy5yZXF1ZXN0SGVhZGVyOwogICAgICBmZXRjaCh1cmwsIGZldGNoT3B0aW9ucykudGhlbihmdW5jdGlvbihyZXMpIHsKICAgICAgICByZXR1cm4gcmVzLmJsb2IoKTsKICAgICAgfSkudGhlbihmdW5jdGlvbihibG9iKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUltYWdlQml0bWFwKGJsb2IsIE9iamVjdC5hc3NpZ24oc2NvcGUub3B0aW9ucywgeyBjb2xvclNwYWNlQ29udmVyc2lvbjogIm5vbmUiIH0pKTsKICAgICAgfSkudGhlbihmdW5jdGlvbihpbWFnZUJpdG1hcCkgewogICAgICAgIENhY2hlLmFkZCh1cmwsIGltYWdlQml0bWFwKTsKICAgICAgICBpZiAob25Mb2FkKQogICAgICAgICAgb25Mb2FkKGltYWdlQml0bWFwKTsKICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1FbmQodXJsKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZSkgewogICAgICAgIGlmIChvbkVycm9yKQogICAgICAgICAgb25FcnJvcihlKTsKICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1FcnJvcih1cmwpOwogICAgICAgIHNjb3BlLm1hbmFnZXIuaXRlbUVuZCh1cmwpOwogICAgICB9KTsKICAgICAgc2NvcGUubWFuYWdlci5pdGVtU3RhcnQodXJsKTsKICAgIH0KICB9OwogIEltYWdlQml0bWFwTG9hZGVyLnByb3RvdHlwZS5pc0ltYWdlQml0bWFwTG9hZGVyID0gdHJ1ZTsKICB2YXIgU2hhcGVQYXRoID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMudHlwZSA9ICJTaGFwZVBhdGgiOwogICAgICB0aGlzLmNvbG9yID0gbmV3IENvbG9yKCk7CiAgICAgIHRoaXMuc3ViUGF0aHMgPSBbXTsKICAgICAgdGhpcy5jdXJyZW50UGF0aCA9IG51bGw7CiAgICB9CiAgICBtb3ZlVG8oeCwgeSkgewogICAgICB0aGlzLmN1cnJlbnRQYXRoID0gbmV3IFBhdGgoKTsKICAgICAgdGhpcy5zdWJQYXRocy5wdXNoKHRoaXMuY3VycmVudFBhdGgpOwogICAgICB0aGlzLmN1cnJlbnRQYXRoLm1vdmVUbyh4LCB5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBsaW5lVG8oeCwgeSkgewogICAgICB0aGlzLmN1cnJlbnRQYXRoLmxpbmVUbyh4LCB5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBxdWFkcmF0aWNDdXJ2ZVRvKGFDUHgsIGFDUHksIGFYLCBhWSkgewogICAgICB0aGlzLmN1cnJlbnRQYXRoLnF1YWRyYXRpY0N1cnZlVG8oYUNQeCwgYUNQeSwgYVgsIGFZKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBiZXppZXJDdXJ2ZVRvKGFDUDF4LCBhQ1AxeSwgYUNQMngsIGFDUDJ5LCBhWCwgYVkpIHsKICAgICAgdGhpcy5jdXJyZW50UGF0aC5iZXppZXJDdXJ2ZVRvKGFDUDF4LCBhQ1AxeSwgYUNQMngsIGFDUDJ5LCBhWCwgYVkpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNwbGluZVRocnUocHRzKSB7CiAgICAgIHRoaXMuY3VycmVudFBhdGguc3BsaW5lVGhydShwdHMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvU2hhcGVzKGlzQ0NXLCBub0hvbGVzKSB7CiAgICAgIGZ1bmN0aW9uIHRvU2hhcGVzTm9Ib2xlcyhpblN1YnBhdGhzKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzMiA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gaW5TdWJwYXRocy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHRtcFBhdGgyID0gaW5TdWJwYXRoc1tpXTsKICAgICAgICAgIGNvbnN0IHRtcFNoYXBlMiA9IG5ldyBTaGFwZSgpOwogICAgICAgICAgdG1wU2hhcGUyLmN1cnZlcyA9IHRtcFBhdGgyLmN1cnZlczsKICAgICAgICAgIHNoYXBlczIucHVzaCh0bXBTaGFwZTIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2hhcGVzMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBpc1BvaW50SW5zaWRlUG9seWdvbihpblB0LCBpblBvbHlnb24pIHsKICAgICAgICBjb25zdCBwb2x5TGVuID0gaW5Qb2x5Z29uLmxlbmd0aDsKICAgICAgICBsZXQgaW5zaWRlID0gZmFsc2U7CiAgICAgICAgZm9yIChsZXQgcCA9IHBvbHlMZW4gLSAxLCBxID0gMDsgcSA8IHBvbHlMZW47IHAgPSBxKyspIHsKICAgICAgICAgIGxldCBlZGdlTG93UHQgPSBpblBvbHlnb25bcF07CiAgICAgICAgICBsZXQgZWRnZUhpZ2hQdCA9IGluUG9seWdvbltxXTsKICAgICAgICAgIGxldCBlZGdlRHggPSBlZGdlSGlnaFB0LnggLSBlZGdlTG93UHQueDsKICAgICAgICAgIGxldCBlZGdlRHkgPSBlZGdlSGlnaFB0LnkgLSBlZGdlTG93UHQueTsKICAgICAgICAgIGlmIChNYXRoLmFicyhlZGdlRHkpID4gTnVtYmVyLkVQU0lMT04pIHsKICAgICAgICAgICAgaWYgKGVkZ2VEeSA8IDApIHsKICAgICAgICAgICAgICBlZGdlTG93UHQgPSBpblBvbHlnb25bcV07CiAgICAgICAgICAgICAgZWRnZUR4ID0gLWVkZ2VEeDsKICAgICAgICAgICAgICBlZGdlSGlnaFB0ID0gaW5Qb2x5Z29uW3BdOwogICAgICAgICAgICAgIGVkZ2VEeSA9IC1lZGdlRHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGluUHQueSA8IGVkZ2VMb3dQdC55IHx8IGluUHQueSA+IGVkZ2VIaWdoUHQueSkKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKGluUHQueSA9PT0gZWRnZUxvd1B0LnkpIHsKICAgICAgICAgICAgICBpZiAoaW5QdC54ID09PSBlZGdlTG93UHQueCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnN0IHBlcnBFZGdlID0gZWRnZUR5ICogKGluUHQueCAtIGVkZ2VMb3dQdC54KSAtIGVkZ2VEeCAqIChpblB0LnkgLSBlZGdlTG93UHQueSk7CiAgICAgICAgICAgICAgaWYgKHBlcnBFZGdlID09PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgaWYgKHBlcnBFZGdlIDwgMCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIGluc2lkZSA9ICFpbnNpZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChpblB0LnkgIT09IGVkZ2VMb3dQdC55KQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoZWRnZUhpZ2hQdC54IDw9IGluUHQueCAmJiBpblB0LnggPD0gZWRnZUxvd1B0LnggfHwgZWRnZUxvd1B0LnggPD0gaW5QdC54ICYmIGluUHQueCA8PSBlZGdlSGlnaFB0LngpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnNpZGU7CiAgICAgIH0KICAgICAgY29uc3QgaXNDbG9ja1dpc2UgPSBTaGFwZVV0aWxzLmlzQ2xvY2tXaXNlOwogICAgICBjb25zdCBzdWJQYXRocyA9IHRoaXMuc3ViUGF0aHM7CiAgICAgIGlmIChzdWJQYXRocy5sZW5ndGggPT09IDApCiAgICAgICAgcmV0dXJuIFtdOwogICAgICBpZiAobm9Ib2xlcyA9PT0gdHJ1ZSkKICAgICAgICByZXR1cm4gdG9TaGFwZXNOb0hvbGVzKHN1YlBhdGhzKTsKICAgICAgbGV0IHNvbGlkLCB0bXBQYXRoLCB0bXBTaGFwZTsKICAgICAgY29uc3Qgc2hhcGVzID0gW107CiAgICAgIGlmIChzdWJQYXRocy5sZW5ndGggPT09IDEpIHsKICAgICAgICB0bXBQYXRoID0gc3ViUGF0aHNbMF07CiAgICAgICAgdG1wU2hhcGUgPSBuZXcgU2hhcGUoKTsKICAgICAgICB0bXBTaGFwZS5jdXJ2ZXMgPSB0bXBQYXRoLmN1cnZlczsKICAgICAgICBzaGFwZXMucHVzaCh0bXBTaGFwZSk7CiAgICAgICAgcmV0dXJuIHNoYXBlczsKICAgICAgfQogICAgICBsZXQgaG9sZXNGaXJzdCA9ICFpc0Nsb2NrV2lzZShzdWJQYXRoc1swXS5nZXRQb2ludHMoKSk7CiAgICAgIGhvbGVzRmlyc3QgPSBpc0NDVyA/ICFob2xlc0ZpcnN0IDogaG9sZXNGaXJzdDsKICAgICAgY29uc3QgYmV0dGVyU2hhcGVIb2xlcyA9IFtdOwogICAgICBjb25zdCBuZXdTaGFwZXMgPSBbXTsKICAgICAgbGV0IG5ld1NoYXBlSG9sZXMgPSBbXTsKICAgICAgbGV0IG1haW5JZHggPSAwOwogICAgICBsZXQgdG1wUG9pbnRzOwogICAgICBuZXdTaGFwZXNbbWFpbklkeF0gPSB2b2lkIDA7CiAgICAgIG5ld1NoYXBlSG9sZXNbbWFpbklkeF0gPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzdWJQYXRocy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0bXBQYXRoID0gc3ViUGF0aHNbaV07CiAgICAgICAgdG1wUG9pbnRzID0gdG1wUGF0aC5nZXRQb2ludHMoKTsKICAgICAgICBzb2xpZCA9IGlzQ2xvY2tXaXNlKHRtcFBvaW50cyk7CiAgICAgICAgc29saWQgPSBpc0NDVyA/ICFzb2xpZCA6IHNvbGlkOwogICAgICAgIGlmIChzb2xpZCkgewogICAgICAgICAgaWYgKCFob2xlc0ZpcnN0ICYmIG5ld1NoYXBlc1ttYWluSWR4XSkKICAgICAgICAgICAgbWFpbklkeCsrOwogICAgICAgICAgbmV3U2hhcGVzW21haW5JZHhdID0geyBzOiBuZXcgU2hhcGUoKSwgcDogdG1wUG9pbnRzIH07CiAgICAgICAgICBuZXdTaGFwZXNbbWFpbklkeF0ucy5jdXJ2ZXMgPSB0bXBQYXRoLmN1cnZlczsKICAgICAgICAgIGlmIChob2xlc0ZpcnN0KQogICAgICAgICAgICBtYWluSWR4Kys7CiAgICAgICAgICBuZXdTaGFwZUhvbGVzW21haW5JZHhdID0gW107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5ld1NoYXBlSG9sZXNbbWFpbklkeF0ucHVzaCh7IGg6IHRtcFBhdGgsIHA6IHRtcFBvaW50c1swXSB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCFuZXdTaGFwZXNbMF0pCiAgICAgICAgcmV0dXJuIHRvU2hhcGVzTm9Ib2xlcyhzdWJQYXRocyk7CiAgICAgIGlmIChuZXdTaGFwZXMubGVuZ3RoID4gMSkgewogICAgICAgIGxldCBhbWJpZ3VvdXMgPSBmYWxzZTsKICAgICAgICBjb25zdCB0b0NoYW5nZSA9IFtdOwogICAgICAgIGZvciAobGV0IHNJZHggPSAwLCBzTGVuID0gbmV3U2hhcGVzLmxlbmd0aDsgc0lkeCA8IHNMZW47IHNJZHgrKykgewogICAgICAgICAgYmV0dGVyU2hhcGVIb2xlc1tzSWR4XSA9IFtdOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBzSWR4ID0gMCwgc0xlbiA9IG5ld1NoYXBlcy5sZW5ndGg7IHNJZHggPCBzTGVuOyBzSWR4KyspIHsKICAgICAgICAgIGNvbnN0IHNobyA9IG5ld1NoYXBlSG9sZXNbc0lkeF07CiAgICAgICAgICBmb3IgKGxldCBoSWR4ID0gMDsgaElkeCA8IHNoby5sZW5ndGg7IGhJZHgrKykgewogICAgICAgICAgICBjb25zdCBobyA9IHNob1toSWR4XTsKICAgICAgICAgICAgbGV0IGhvbGVfdW5hc3NpZ25lZCA9IHRydWU7CiAgICAgICAgICAgIGZvciAobGV0IHMySWR4ID0gMDsgczJJZHggPCBuZXdTaGFwZXMubGVuZ3RoOyBzMklkeCsrKSB7CiAgICAgICAgICAgICAgaWYgKGlzUG9pbnRJbnNpZGVQb2x5Z29uKGhvLnAsIG5ld1NoYXBlc1tzMklkeF0ucCkpIHsKICAgICAgICAgICAgICAgIGlmIChzSWR4ICE9PSBzMklkeCkKICAgICAgICAgICAgICAgICAgdG9DaGFuZ2UucHVzaCh7IGZyb21zOiBzSWR4LCB0b3M6IHMySWR4LCBob2xlOiBoSWR4IH0pOwogICAgICAgICAgICAgICAgaWYgKGhvbGVfdW5hc3NpZ25lZCkgewogICAgICAgICAgICAgICAgICBob2xlX3VuYXNzaWduZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgYmV0dGVyU2hhcGVIb2xlc1tzMklkeF0ucHVzaChobyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhbWJpZ3VvdXMgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaG9sZV91bmFzc2lnbmVkKSB7CiAgICAgICAgICAgICAgYmV0dGVyU2hhcGVIb2xlc1tzSWR4XS5wdXNoKGhvKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodG9DaGFuZ2UubGVuZ3RoID4gMCkgewogICAgICAgICAgaWYgKCFhbWJpZ3VvdXMpCiAgICAgICAgICAgIG5ld1NoYXBlSG9sZXMgPSBiZXR0ZXJTaGFwZUhvbGVzOwogICAgICAgIH0KICAgICAgfQogICAgICBsZXQgdG1wSG9sZXM7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IG5ld1NoYXBlcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgdG1wU2hhcGUgPSBuZXdTaGFwZXNbaV0uczsKICAgICAgICBzaGFwZXMucHVzaCh0bXBTaGFwZSk7CiAgICAgICAgdG1wSG9sZXMgPSBuZXdTaGFwZUhvbGVzW2ldOwogICAgICAgIGZvciAobGV0IGogPSAwLCBqbCA9IHRtcEhvbGVzLmxlbmd0aDsgaiA8IGpsOyBqKyspIHsKICAgICAgICAgIHRtcFNoYXBlLmhvbGVzLnB1c2godG1wSG9sZXNbal0uaCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBzaGFwZXM7CiAgICB9CiAgfTsKICB2YXIgRm9udCA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGRhdGEpIHsKICAgICAgdGhpcy50eXBlID0gIkZvbnQiOwogICAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgfQogICAgZ2VuZXJhdGVTaGFwZXModGV4dCwgc2l6ZSA9IDEwMCkgewogICAgICBjb25zdCBzaGFwZXMgPSBbXTsKICAgICAgY29uc3QgcGF0aHMgPSBjcmVhdGVQYXRocyh0ZXh0LCBzaXplLCB0aGlzLmRhdGEpOwogICAgICBmb3IgKGxldCBwID0gMCwgcGwgPSBwYXRocy5sZW5ndGg7IHAgPCBwbDsgcCsrKSB7CiAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoc2hhcGVzLCBwYXRoc1twXS50b1NoYXBlcygpKTsKICAgICAgfQogICAgICByZXR1cm4gc2hhcGVzOwogICAgfQogIH07CiAgZnVuY3Rpb24gY3JlYXRlUGF0aHModGV4dCwgc2l6ZSwgZGF0YSkgewogICAgY29uc3QgY2hhcnMgPSBBcnJheS5mcm9tKHRleHQpOwogICAgY29uc3Qgc2NhbGUgPSBzaXplIC8gZGF0YS5yZXNvbHV0aW9uOwogICAgY29uc3QgbGluZV9oZWlnaHQgPSAoZGF0YS5ib3VuZGluZ0JveC55TWF4IC0gZGF0YS5ib3VuZGluZ0JveC55TWluICsgZGF0YS51bmRlcmxpbmVUaGlja25lc3MpICogc2NhbGU7CiAgICBjb25zdCBwYXRocyA9IFtdOwogICAgbGV0IG9mZnNldFggPSAwLCBvZmZzZXRZID0gMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hhcnMubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgY2hhciA9IGNoYXJzW2ldOwogICAgICBpZiAoY2hhciA9PT0gIlxuIikgewogICAgICAgIG9mZnNldFggPSAwOwogICAgICAgIG9mZnNldFkgLT0gbGluZV9oZWlnaHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgcmV0ID0gY3JlYXRlUGF0aChjaGFyLCBzY2FsZSwgb2Zmc2V0WCwgb2Zmc2V0WSwgZGF0YSk7CiAgICAgICAgb2Zmc2V0WCArPSByZXQub2Zmc2V0WDsKICAgICAgICBwYXRocy5wdXNoKHJldC5wYXRoKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBhdGhzOwogIH0KICBmdW5jdGlvbiBjcmVhdGVQYXRoKGNoYXIsIHNjYWxlLCBvZmZzZXRYLCBvZmZzZXRZLCBkYXRhKSB7CiAgICBjb25zdCBnbHlwaCA9IGRhdGEuZ2x5cGhzW2NoYXJdIHx8IGRhdGEuZ2x5cGhzWyI/Il07CiAgICBpZiAoIWdseXBoKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ1RIUkVFLkZvbnQ6IGNoYXJhY3RlciAiJyArIGNoYXIgKyAnIiBkb2VzIG5vdCBleGlzdHMgaW4gZm9udCBmYW1pbHkgJyArIGRhdGEuZmFtaWx5TmFtZSArICIuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBhdGggPSBuZXcgU2hhcGVQYXRoKCk7CiAgICBsZXQgeCwgeSwgY3B4LCBjcHksIGNweDEsIGNweTEsIGNweDIsIGNweTI7CiAgICBpZiAoZ2x5cGgubykgewogICAgICBjb25zdCBvdXRsaW5lID0gZ2x5cGguX2NhY2hlZE91dGxpbmUgfHwgKGdseXBoLl9jYWNoZWRPdXRsaW5lID0gZ2x5cGguby5zcGxpdCgiICIpKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBvdXRsaW5lLmxlbmd0aDsgaSA8IGw7ICkgewogICAgICAgIGNvbnN0IGFjdGlvbiA9IG91dGxpbmVbaSsrXTsKICAgICAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgY2FzZSAibSI6CiAgICAgICAgICAgIHggPSBvdXRsaW5lW2krK10gKiBzY2FsZSArIG9mZnNldFg7CiAgICAgICAgICAgIHkgPSBvdXRsaW5lW2krK10gKiBzY2FsZSArIG9mZnNldFk7CiAgICAgICAgICAgIHBhdGgubW92ZVRvKHgsIHkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImwiOgogICAgICAgICAgICB4ID0gb3V0bGluZVtpKytdICogc2NhbGUgKyBvZmZzZXRYOwogICAgICAgICAgICB5ID0gb3V0bGluZVtpKytdICogc2NhbGUgKyBvZmZzZXRZOwogICAgICAgICAgICBwYXRoLmxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJxIjoKICAgICAgICAgICAgY3B4ID0gb3V0bGluZVtpKytdICogc2NhbGUgKyBvZmZzZXRYOwogICAgICAgICAgICBjcHkgPSBvdXRsaW5lW2krK10gKiBzY2FsZSArIG9mZnNldFk7CiAgICAgICAgICAgIGNweDEgPSBvdXRsaW5lW2krK10gKiBzY2FsZSArIG9mZnNldFg7CiAgICAgICAgICAgIGNweTEgPSBvdXRsaW5lW2krK10gKiBzY2FsZSArIG9mZnNldFk7CiAgICAgICAgICAgIHBhdGgucXVhZHJhdGljQ3VydmVUbyhjcHgxLCBjcHkxLCBjcHgsIGNweSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYiI6CiAgICAgICAgICAgIGNweCA9IG91dGxpbmVbaSsrXSAqIHNjYWxlICsgb2Zmc2V0WDsKICAgICAgICAgICAgY3B5ID0gb3V0bGluZVtpKytdICogc2NhbGUgKyBvZmZzZXRZOwogICAgICAgICAgICBjcHgxID0gb3V0bGluZVtpKytdICogc2NhbGUgKyBvZmZzZXRYOwogICAgICAgICAgICBjcHkxID0gb3V0bGluZVtpKytdICogc2NhbGUgKyBvZmZzZXRZOwogICAgICAgICAgICBjcHgyID0gb3V0bGluZVtpKytdICogc2NhbGUgKyBvZmZzZXRYOwogICAgICAgICAgICBjcHkyID0gb3V0bGluZVtpKytdICogc2NhbGUgKyBvZmZzZXRZOwogICAgICAgICAgICBwYXRoLmJlemllckN1cnZlVG8oY3B4MSwgY3B5MSwgY3B4MiwgY3B5MiwgY3B4LCBjcHkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IG9mZnNldFg6IGdseXBoLmhhICogc2NhbGUsIHBhdGggfTsKICB9CiAgRm9udC5wcm90b3R5cGUuaXNGb250ID0gdHJ1ZTsKICB2YXIgX2NvbnRleHQ7CiAgdmFyIEF1ZGlvQ29udGV4dCA9IHsKICAgIGdldENvbnRleHQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoX2NvbnRleHQgPT09IHZvaWQgMCkgewogICAgICAgIF9jb250ZXh0ID0gbmV3ICh3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQpKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9jb250ZXh0OwogICAgfSwKICAgIHNldENvbnRleHQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIF9jb250ZXh0ID0gdmFsdWU7CiAgICB9CiAgfTsKICB2YXIgQXVkaW9Mb2FkZXIgPSBjbGFzcyBleHRlbmRzIExvYWRlciB7CiAgICBjb25zdHJ1Y3RvcihtYW5hZ2VyKSB7CiAgICAgIHN1cGVyKG1hbmFnZXIpOwogICAgfQogICAgbG9hZCh1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvcikgewogICAgICBjb25zdCBzY29wZSA9IHRoaXM7CiAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBGaWxlTG9hZGVyKHRoaXMubWFuYWdlcik7CiAgICAgIGxvYWRlci5zZXRSZXNwb25zZVR5cGUoImFycmF5YnVmZmVyIik7CiAgICAgIGxvYWRlci5zZXRQYXRoKHRoaXMucGF0aCk7CiAgICAgIGxvYWRlci5zZXRSZXF1ZXN0SGVhZGVyKHRoaXMucmVxdWVzdEhlYWRlcik7CiAgICAgIGxvYWRlci5zZXRXaXRoQ3JlZGVudGlhbHModGhpcy53aXRoQ3JlZGVudGlhbHMpOwogICAgICBsb2FkZXIubG9hZCh1cmwsIGZ1bmN0aW9uKGJ1ZmZlcikgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCBidWZmZXJDb3B5ID0gYnVmZmVyLnNsaWNlKDApOwogICAgICAgICAgY29uc3QgY29udGV4dCA9IEF1ZGlvQ29udGV4dC5nZXRDb250ZXh0KCk7CiAgICAgICAgICBjb250ZXh0LmRlY29kZUF1ZGlvRGF0YShidWZmZXJDb3B5LCBmdW5jdGlvbihhdWRpb0J1ZmZlcikgewogICAgICAgICAgICBvbkxvYWQoYXVkaW9CdWZmZXIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgaWYgKG9uRXJyb3IpIHsKICAgICAgICAgICAgb25FcnJvcihlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICB9CiAgICAgICAgICBzY29wZS5tYW5hZ2VyLml0ZW1FcnJvcih1cmwpOwogICAgICAgIH0KICAgICAgfSwgb25Qcm9ncmVzcywgb25FcnJvcik7CiAgICB9CiAgfTsKICB2YXIgSGVtaXNwaGVyZUxpZ2h0UHJvYmUgPSBjbGFzcyBleHRlbmRzIExpZ2h0UHJvYmUgewogICAgY29uc3RydWN0b3Ioc2t5Q29sb3IsIGdyb3VuZENvbG9yLCBpbnRlbnNpdHkgPSAxKSB7CiAgICAgIHN1cGVyKHZvaWQgMCwgaW50ZW5zaXR5KTsKICAgICAgY29uc3QgY29sb3IxID0gbmV3IENvbG9yKCkuc2V0KHNreUNvbG9yKTsKICAgICAgY29uc3QgY29sb3IyID0gbmV3IENvbG9yKCkuc2V0KGdyb3VuZENvbG9yKTsKICAgICAgY29uc3Qgc2t5ID0gbmV3IFZlY3RvcjMoY29sb3IxLnIsIGNvbG9yMS5nLCBjb2xvcjEuYik7CiAgICAgIGNvbnN0IGdyb3VuZCA9IG5ldyBWZWN0b3IzKGNvbG9yMi5yLCBjb2xvcjIuZywgY29sb3IyLmIpOwogICAgICBjb25zdCBjMCA9IE1hdGguc3FydChNYXRoLlBJKTsKICAgICAgY29uc3QgYzEgPSBjMCAqIE1hdGguc3FydCgwLjc1KTsKICAgICAgdGhpcy5zaC5jb2VmZmljaWVudHNbMF0uY29weShza3kpLmFkZChncm91bmQpLm11bHRpcGx5U2NhbGFyKGMwKTsKICAgICAgdGhpcy5zaC5jb2VmZmljaWVudHNbMV0uY29weShza3kpLnN1Yihncm91bmQpLm11bHRpcGx5U2NhbGFyKGMxKTsKICAgIH0KICB9OwogIEhlbWlzcGhlcmVMaWdodFByb2JlLnByb3RvdHlwZS5pc0hlbWlzcGhlcmVMaWdodFByb2JlID0gdHJ1ZTsKICB2YXIgQW1iaWVudExpZ2h0UHJvYmUgPSBjbGFzcyBleHRlbmRzIExpZ2h0UHJvYmUgewogICAgY29uc3RydWN0b3IoY29sb3IsIGludGVuc2l0eSA9IDEpIHsKICAgICAgc3VwZXIodm9pZCAwLCBpbnRlbnNpdHkpOwogICAgICBjb25zdCBjb2xvcjEgPSBuZXcgQ29sb3IoKS5zZXQoY29sb3IpOwogICAgICB0aGlzLnNoLmNvZWZmaWNpZW50c1swXS5zZXQoY29sb3IxLnIsIGNvbG9yMS5nLCBjb2xvcjEuYikubXVsdGlwbHlTY2FsYXIoMiAqIE1hdGguc3FydChNYXRoLlBJKSk7CiAgICB9CiAgfTsKICBBbWJpZW50TGlnaHRQcm9iZS5wcm90b3R5cGUuaXNBbWJpZW50TGlnaHRQcm9iZSA9IHRydWU7CiAgdmFyIEF1ZGlvID0gY2xhc3MgZXh0ZW5kcyBPYmplY3QzRCB7CiAgICBjb25zdHJ1Y3RvcihsaXN0ZW5lcikgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnR5cGUgPSAiQXVkaW8iOwogICAgICB0aGlzLmxpc3RlbmVyID0gbGlzdGVuZXI7CiAgICAgIHRoaXMuY29udGV4dCA9IGxpc3RlbmVyLmNvbnRleHQ7CiAgICAgIHRoaXMuZ2FpbiA9IHRoaXMuY29udGV4dC5jcmVhdGVHYWluKCk7CiAgICAgIHRoaXMuZ2Fpbi5jb25uZWN0KGxpc3RlbmVyLmdldElucHV0KCkpOwogICAgICB0aGlzLmF1dG9wbGF5ID0gZmFsc2U7CiAgICAgIHRoaXMuYnVmZmVyID0gbnVsbDsKICAgICAgdGhpcy5kZXR1bmUgPSAwOwogICAgICB0aGlzLmxvb3AgPSBmYWxzZTsKICAgICAgdGhpcy5sb29wU3RhcnQgPSAwOwogICAgICB0aGlzLmxvb3BFbmQgPSAwOwogICAgICB0aGlzLm9mZnNldCA9IDA7CiAgICAgIHRoaXMuZHVyYXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucGxheWJhY2tSYXRlID0gMTsKICAgICAgdGhpcy5pc1BsYXlpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPSB0cnVlOwogICAgICB0aGlzLnNvdXJjZSA9IG51bGw7CiAgICAgIHRoaXMuc291cmNlVHlwZSA9ICJlbXB0eSI7CiAgICAgIHRoaXMuX3N0YXJ0ZWRBdCA9IDA7CiAgICAgIHRoaXMuX3Byb2dyZXNzID0gMDsKICAgICAgdGhpcy5fY29ubmVjdGVkID0gZmFsc2U7CiAgICAgIHRoaXMuZmlsdGVycyA9IFtdOwogICAgfQogICAgZ2V0T3V0cHV0KCkgewogICAgICByZXR1cm4gdGhpcy5nYWluOwogICAgfQogICAgc2V0Tm9kZVNvdXJjZShhdWRpb05vZGUpIHsKICAgICAgdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPSBmYWxzZTsKICAgICAgdGhpcy5zb3VyY2VUeXBlID0gImF1ZGlvTm9kZSI7CiAgICAgIHRoaXMuc291cmNlID0gYXVkaW9Ob2RlOwogICAgICB0aGlzLmNvbm5lY3QoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRNZWRpYUVsZW1lbnRTb3VyY2UobWVkaWFFbGVtZW50KSB7CiAgICAgIHRoaXMuaGFzUGxheWJhY2tDb250cm9sID0gZmFsc2U7CiAgICAgIHRoaXMuc291cmNlVHlwZSA9ICJtZWRpYU5vZGUiOwogICAgICB0aGlzLnNvdXJjZSA9IHRoaXMuY29udGV4dC5jcmVhdGVNZWRpYUVsZW1lbnRTb3VyY2UobWVkaWFFbGVtZW50KTsKICAgICAgdGhpcy5jb25uZWN0KCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0TWVkaWFTdHJlYW1Tb3VyY2UobWVkaWFTdHJlYW0pIHsKICAgICAgdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPSBmYWxzZTsKICAgICAgdGhpcy5zb3VyY2VUeXBlID0gIm1lZGlhU3RyZWFtTm9kZSI7CiAgICAgIHRoaXMuc291cmNlID0gdGhpcy5jb250ZXh0LmNyZWF0ZU1lZGlhU3RyZWFtU291cmNlKG1lZGlhU3RyZWFtKTsKICAgICAgdGhpcy5jb25uZWN0KCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0QnVmZmVyKGF1ZGlvQnVmZmVyKSB7CiAgICAgIHRoaXMuYnVmZmVyID0gYXVkaW9CdWZmZXI7CiAgICAgIHRoaXMuc291cmNlVHlwZSA9ICJidWZmZXIiOwogICAgICBpZiAodGhpcy5hdXRvcGxheSkKICAgICAgICB0aGlzLnBsYXkoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBwbGF5KGRlbGF5ID0gMCkgewogICAgICBpZiAodGhpcy5pc1BsYXlpbmcgPT09IHRydWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkF1ZGlvOiBBdWRpbyBpcyBhbHJlYWR5IHBsYXlpbmcuIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkF1ZGlvOiB0aGlzIEF1ZGlvIGhhcyBubyBwbGF5YmFjayBjb250cm9sLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLl9zdGFydGVkQXQgPSB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUgKyBkZWxheTsKICAgICAgY29uc3Qgc291cmNlID0gdGhpcy5jb250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpOwogICAgICBzb3VyY2UuYnVmZmVyID0gdGhpcy5idWZmZXI7CiAgICAgIHNvdXJjZS5sb29wID0gdGhpcy5sb29wOwogICAgICBzb3VyY2UubG9vcFN0YXJ0ID0gdGhpcy5sb29wU3RhcnQ7CiAgICAgIHNvdXJjZS5sb29wRW5kID0gdGhpcy5sb29wRW5kOwogICAgICBzb3VyY2Uub25lbmRlZCA9IHRoaXMub25FbmRlZC5iaW5kKHRoaXMpOwogICAgICBzb3VyY2Uuc3RhcnQodGhpcy5fc3RhcnRlZEF0LCB0aGlzLl9wcm9ncmVzcyArIHRoaXMub2Zmc2V0LCB0aGlzLmR1cmF0aW9uKTsKICAgICAgdGhpcy5pc1BsYXlpbmcgPSB0cnVlOwogICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgdGhpcy5zZXREZXR1bmUodGhpcy5kZXR1bmUpOwogICAgICB0aGlzLnNldFBsYXliYWNrUmF0ZSh0aGlzLnBsYXliYWNrUmF0ZSk7CiAgICAgIHJldHVybiB0aGlzLmNvbm5lY3QoKTsKICAgIH0KICAgIHBhdXNlKCkgewogICAgICBpZiAodGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPT09IGZhbHNlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5BdWRpbzogdGhpcyBBdWRpbyBoYXMgbm8gcGxheWJhY2sgY29udHJvbC4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMuaXNQbGF5aW5nID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy5fcHJvZ3Jlc3MgKz0gTWF0aC5tYXgodGhpcy5jb250ZXh0LmN1cnJlbnRUaW1lIC0gdGhpcy5fc3RhcnRlZEF0LCAwKSAqIHRoaXMucGxheWJhY2tSYXRlOwogICAgICAgIGlmICh0aGlzLmxvb3AgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuX3Byb2dyZXNzID0gdGhpcy5fcHJvZ3Jlc3MgJSAodGhpcy5kdXJhdGlvbiB8fCB0aGlzLmJ1ZmZlci5kdXJhdGlvbik7CiAgICAgICAgfQogICAgICAgIHRoaXMuc291cmNlLnN0b3AoKTsKICAgICAgICB0aGlzLnNvdXJjZS5vbmVuZGVkID0gbnVsbDsKICAgICAgICB0aGlzLmlzUGxheWluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc3RvcCgpIHsKICAgICAgaWYgKHRoaXMuaGFzUGxheWJhY2tDb250cm9sID09PSBmYWxzZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuX3Byb2dyZXNzID0gMDsKICAgICAgdGhpcy5zb3VyY2Uuc3RvcCgpOwogICAgICB0aGlzLnNvdXJjZS5vbmVuZGVkID0gbnVsbDsKICAgICAgdGhpcy5pc1BsYXlpbmcgPSBmYWxzZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb25uZWN0KCkgewogICAgICBpZiAodGhpcy5maWx0ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLnNvdXJjZS5jb25uZWN0KHRoaXMuZmlsdGVyc1swXSk7CiAgICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSB0aGlzLmZpbHRlcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB0aGlzLmZpbHRlcnNbaSAtIDFdLmNvbm5lY3QodGhpcy5maWx0ZXJzW2ldKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5maWx0ZXJzW3RoaXMuZmlsdGVycy5sZW5ndGggLSAxXS5jb25uZWN0KHRoaXMuZ2V0T3V0cHV0KCkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc291cmNlLmNvbm5lY3QodGhpcy5nZXRPdXRwdXQoKSk7CiAgICAgIH0KICAgICAgdGhpcy5fY29ubmVjdGVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBkaXNjb25uZWN0KCkgewogICAgICBpZiAodGhpcy5maWx0ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLnNvdXJjZS5kaXNjb25uZWN0KHRoaXMuZmlsdGVyc1swXSk7CiAgICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSB0aGlzLmZpbHRlcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB0aGlzLmZpbHRlcnNbaSAtIDFdLmRpc2Nvbm5lY3QodGhpcy5maWx0ZXJzW2ldKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5maWx0ZXJzW3RoaXMuZmlsdGVycy5sZW5ndGggLSAxXS5kaXNjb25uZWN0KHRoaXMuZ2V0T3V0cHV0KCkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc291cmNlLmRpc2Nvbm5lY3QodGhpcy5nZXRPdXRwdXQoKSk7CiAgICAgIH0KICAgICAgdGhpcy5fY29ubmVjdGVkID0gZmFsc2U7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0RmlsdGVycygpIHsKICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyczsKICAgIH0KICAgIHNldEZpbHRlcnModmFsdWUpIHsKICAgICAgaWYgKCF2YWx1ZSkKICAgICAgICB2YWx1ZSA9IFtdOwogICAgICBpZiAodGhpcy5fY29ubmVjdGVkID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy5kaXNjb25uZWN0KCk7CiAgICAgICAgdGhpcy5maWx0ZXJzID0gdmFsdWUuc2xpY2UoKTsKICAgICAgICB0aGlzLmNvbm5lY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbHRlcnMgPSB2YWx1ZS5zbGljZSgpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0RGV0dW5lKHZhbHVlKSB7CiAgICAgIHRoaXMuZGV0dW5lID0gdmFsdWU7CiAgICAgIGlmICh0aGlzLnNvdXJjZS5kZXR1bmUgPT09IHZvaWQgMCkKICAgICAgICByZXR1cm47CiAgICAgIGlmICh0aGlzLmlzUGxheWluZyA9PT0gdHJ1ZSkgewogICAgICAgIHRoaXMuc291cmNlLmRldHVuZS5zZXRUYXJnZXRBdFRpbWUodGhpcy5kZXR1bmUsIHRoaXMuY29udGV4dC5jdXJyZW50VGltZSwgMC4wMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXREZXR1bmUoKSB7CiAgICAgIHJldHVybiB0aGlzLmRldHVuZTsKICAgIH0KICAgIGdldEZpbHRlcigpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0RmlsdGVycygpWzBdOwogICAgfQogICAgc2V0RmlsdGVyKGZpbHRlcikgewogICAgICByZXR1cm4gdGhpcy5zZXRGaWx0ZXJzKGZpbHRlciA/IFtmaWx0ZXJdIDogW10pOwogICAgfQogICAgc2V0UGxheWJhY2tSYXRlKHZhbHVlKSB7CiAgICAgIGlmICh0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkF1ZGlvOiB0aGlzIEF1ZGlvIGhhcyBubyBwbGF5YmFjayBjb250cm9sLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLnBsYXliYWNrUmF0ZSA9IHZhbHVlOwogICAgICBpZiAodGhpcy5pc1BsYXlpbmcgPT09IHRydWUpIHsKICAgICAgICB0aGlzLnNvdXJjZS5wbGF5YmFja1JhdGUuc2V0VGFyZ2V0QXRUaW1lKHRoaXMucGxheWJhY2tSYXRlLCB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUsIDAuMDEpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0UGxheWJhY2tSYXRlKCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5YmFja1JhdGU7CiAgICB9CiAgICBvbkVuZGVkKCkgewogICAgICB0aGlzLmlzUGxheWluZyA9IGZhbHNlOwogICAgfQogICAgZ2V0TG9vcCgpIHsKICAgICAgaWYgKHRoaXMuaGFzUGxheWJhY2tDb250cm9sID09PSBmYWxzZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmxvb3A7CiAgICB9CiAgICBzZXRMb29wKHZhbHVlKSB7CiAgICAgIGlmICh0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkF1ZGlvOiB0aGlzIEF1ZGlvIGhhcyBubyBwbGF5YmFjayBjb250cm9sLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmxvb3AgPSB2YWx1ZTsKICAgICAgaWYgKHRoaXMuaXNQbGF5aW5nID09PSB0cnVlKSB7CiAgICAgICAgdGhpcy5zb3VyY2UubG9vcCA9IHRoaXMubG9vcDsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldExvb3BTdGFydCh2YWx1ZSkgewogICAgICB0aGlzLmxvb3BTdGFydCA9IHZhbHVlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldExvb3BFbmQodmFsdWUpIHsKICAgICAgdGhpcy5sb29wRW5kID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0Vm9sdW1lKCkgewogICAgICByZXR1cm4gdGhpcy5nYWluLmdhaW4udmFsdWU7CiAgICB9CiAgICBzZXRWb2x1bWUodmFsdWUpIHsKICAgICAgdGhpcy5nYWluLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKHZhbHVlLCB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUsIDAuMDEpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIHZhciBBdWRpb0FuYWx5c2VyID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYXVkaW8sIGZmdFNpemUgPSAyMDQ4KSB7CiAgICAgIHRoaXMuYW5hbHlzZXIgPSBhdWRpby5jb250ZXh0LmNyZWF0ZUFuYWx5c2VyKCk7CiAgICAgIHRoaXMuYW5hbHlzZXIuZmZ0U2l6ZSA9IGZmdFNpemU7CiAgICAgIHRoaXMuZGF0YSA9IG5ldyBVaW50OEFycmF5KHRoaXMuYW5hbHlzZXIuZnJlcXVlbmN5QmluQ291bnQpOwogICAgICBhdWRpby5nZXRPdXRwdXQoKS5jb25uZWN0KHRoaXMuYW5hbHlzZXIpOwogICAgfQogICAgZ2V0RnJlcXVlbmN5RGF0YSgpIHsKICAgICAgdGhpcy5hbmFseXNlci5nZXRCeXRlRnJlcXVlbmN5RGF0YSh0aGlzLmRhdGEpOwogICAgICByZXR1cm4gdGhpcy5kYXRhOwogICAgfQogICAgZ2V0QXZlcmFnZUZyZXF1ZW5jeSgpIHsKICAgICAgbGV0IHZhbHVlID0gMDsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2V0RnJlcXVlbmN5RGF0YSgpOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YWx1ZSArPSBkYXRhW2ldOwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZSAvIGRhdGEubGVuZ3RoOwogICAgfQogIH07CiAgdmFyIFByb3BlcnR5TWl4ZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihiaW5kaW5nLCB0eXBlTmFtZSwgdmFsdWVTaXplKSB7CiAgICAgIHRoaXMuYmluZGluZyA9IGJpbmRpbmc7CiAgICAgIHRoaXMudmFsdWVTaXplID0gdmFsdWVTaXplOwogICAgICBsZXQgbWl4RnVuY3Rpb24sIG1peEZ1bmN0aW9uQWRkaXRpdmUsIHNldElkZW50aXR5OwogICAgICBzd2l0Y2ggKHR5cGVOYW1lKSB7CiAgICAgICAgY2FzZSAicXVhdGVybmlvbiI6CiAgICAgICAgICBtaXhGdW5jdGlvbiA9IHRoaXMuX3NsZXJwOwogICAgICAgICAgbWl4RnVuY3Rpb25BZGRpdGl2ZSA9IHRoaXMuX3NsZXJwQWRkaXRpdmU7CiAgICAgICAgICBzZXRJZGVudGl0eSA9IHRoaXMuX3NldEFkZGl0aXZlSWRlbnRpdHlRdWF0ZXJuaW9uOwogICAgICAgICAgdGhpcy5idWZmZXIgPSBuZXcgRmxvYXQ2NEFycmF5KHZhbHVlU2l6ZSAqIDYpOwogICAgICAgICAgdGhpcy5fd29ya0luZGV4ID0gNTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgY2FzZSAiYm9vbCI6CiAgICAgICAgICBtaXhGdW5jdGlvbiA9IHRoaXMuX3NlbGVjdDsKICAgICAgICAgIG1peEZ1bmN0aW9uQWRkaXRpdmUgPSB0aGlzLl9zZWxlY3Q7CiAgICAgICAgICBzZXRJZGVudGl0eSA9IHRoaXMuX3NldEFkZGl0aXZlSWRlbnRpdHlPdGhlcjsKICAgICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IEFycmF5KHZhbHVlU2l6ZSAqIDUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIG1peEZ1bmN0aW9uID0gdGhpcy5fbGVycDsKICAgICAgICAgIG1peEZ1bmN0aW9uQWRkaXRpdmUgPSB0aGlzLl9sZXJwQWRkaXRpdmU7CiAgICAgICAgICBzZXRJZGVudGl0eSA9IHRoaXMuX3NldEFkZGl0aXZlSWRlbnRpdHlOdW1lcmljOwogICAgICAgICAgdGhpcy5idWZmZXIgPSBuZXcgRmxvYXQ2NEFycmF5KHZhbHVlU2l6ZSAqIDUpOwogICAgICB9CiAgICAgIHRoaXMuX21peEJ1ZmZlclJlZ2lvbiA9IG1peEZ1bmN0aW9uOwogICAgICB0aGlzLl9taXhCdWZmZXJSZWdpb25BZGRpdGl2ZSA9IG1peEZ1bmN0aW9uQWRkaXRpdmU7CiAgICAgIHRoaXMuX3NldElkZW50aXR5ID0gc2V0SWRlbnRpdHk7CiAgICAgIHRoaXMuX29yaWdJbmRleCA9IDM7CiAgICAgIHRoaXMuX2FkZEluZGV4ID0gNDsKICAgICAgdGhpcy5jdW11bGF0aXZlV2VpZ2h0ID0gMDsKICAgICAgdGhpcy5jdW11bGF0aXZlV2VpZ2h0QWRkaXRpdmUgPSAwOwogICAgICB0aGlzLnVzZUNvdW50ID0gMDsKICAgICAgdGhpcy5yZWZlcmVuY2VDb3VudCA9IDA7CiAgICB9CiAgICBhY2N1bXVsYXRlKGFjY3VJbmRleCwgd2VpZ2h0KSB7CiAgICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyLCBzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwgb2Zmc2V0ID0gYWNjdUluZGV4ICogc3RyaWRlICsgc3RyaWRlOwogICAgICBsZXQgY3VycmVudFdlaWdodCA9IHRoaXMuY3VtdWxhdGl2ZVdlaWdodDsKICAgICAgaWYgKGN1cnJlbnRXZWlnaHQgPT09IDApIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gc3RyaWRlOyArK2kpIHsKICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyBpXSA9IGJ1ZmZlcltpXTsKICAgICAgICB9CiAgICAgICAgY3VycmVudFdlaWdodCA9IHdlaWdodDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjdXJyZW50V2VpZ2h0ICs9IHdlaWdodDsKICAgICAgICBjb25zdCBtaXggPSB3ZWlnaHQgLyBjdXJyZW50V2VpZ2h0OwogICAgICAgIHRoaXMuX21peEJ1ZmZlclJlZ2lvbihidWZmZXIsIG9mZnNldCwgMCwgbWl4LCBzdHJpZGUpOwogICAgICB9CiAgICAgIHRoaXMuY3VtdWxhdGl2ZVdlaWdodCA9IGN1cnJlbnRXZWlnaHQ7CiAgICB9CiAgICBhY2N1bXVsYXRlQWRkaXRpdmUod2VpZ2h0KSB7CiAgICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyLCBzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwgb2Zmc2V0ID0gc3RyaWRlICogdGhpcy5fYWRkSW5kZXg7CiAgICAgIGlmICh0aGlzLmN1bXVsYXRpdmVXZWlnaHRBZGRpdGl2ZSA9PT0gMCkgewogICAgICAgIHRoaXMuX3NldElkZW50aXR5KCk7CiAgICAgIH0KICAgICAgdGhpcy5fbWl4QnVmZmVyUmVnaW9uQWRkaXRpdmUoYnVmZmVyLCBvZmZzZXQsIDAsIHdlaWdodCwgc3RyaWRlKTsKICAgICAgdGhpcy5jdW11bGF0aXZlV2VpZ2h0QWRkaXRpdmUgKz0gd2VpZ2h0OwogICAgfQogICAgYXBwbHkoYWNjdUluZGV4KSB7CiAgICAgIGNvbnN0IHN0cmlkZSA9IHRoaXMudmFsdWVTaXplLCBidWZmZXIgPSB0aGlzLmJ1ZmZlciwgb2Zmc2V0ID0gYWNjdUluZGV4ICogc3RyaWRlICsgc3RyaWRlLCB3ZWlnaHQgPSB0aGlzLmN1bXVsYXRpdmVXZWlnaHQsIHdlaWdodEFkZGl0aXZlID0gdGhpcy5jdW11bGF0aXZlV2VpZ2h0QWRkaXRpdmUsIGJpbmRpbmcgPSB0aGlzLmJpbmRpbmc7CiAgICAgIHRoaXMuY3VtdWxhdGl2ZVdlaWdodCA9IDA7CiAgICAgIHRoaXMuY3VtdWxhdGl2ZVdlaWdodEFkZGl0aXZlID0gMDsKICAgICAgaWYgKHdlaWdodCA8IDEpIHsKICAgICAgICBjb25zdCBvcmlnaW5hbFZhbHVlT2Zmc2V0ID0gc3RyaWRlICogdGhpcy5fb3JpZ0luZGV4OwogICAgICAgIHRoaXMuX21peEJ1ZmZlclJlZ2lvbihidWZmZXIsIG9mZnNldCwgb3JpZ2luYWxWYWx1ZU9mZnNldCwgMSAtIHdlaWdodCwgc3RyaWRlKTsKICAgICAgfQogICAgICBpZiAod2VpZ2h0QWRkaXRpdmUgPiAwKSB7CiAgICAgICAgdGhpcy5fbWl4QnVmZmVyUmVnaW9uQWRkaXRpdmUoYnVmZmVyLCBvZmZzZXQsIHRoaXMuX2FkZEluZGV4ICogc3RyaWRlLCAxLCBzdHJpZGUpOwogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSBzdHJpZGUsIGUgPSBzdHJpZGUgKyBzdHJpZGU7IGkgIT09IGU7ICsraSkgewogICAgICAgIGlmIChidWZmZXJbaV0gIT09IGJ1ZmZlcltpICsgc3RyaWRlXSkgewogICAgICAgICAgYmluZGluZy5zZXRWYWx1ZShidWZmZXIsIG9mZnNldCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHNhdmVPcmlnaW5hbFN0YXRlKCkgewogICAgICBjb25zdCBiaW5kaW5nID0gdGhpcy5iaW5kaW5nOwogICAgICBjb25zdCBidWZmZXIgPSB0aGlzLmJ1ZmZlciwgc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsIG9yaWdpbmFsVmFsdWVPZmZzZXQgPSBzdHJpZGUgKiB0aGlzLl9vcmlnSW5kZXg7CiAgICAgIGJpbmRpbmcuZ2V0VmFsdWUoYnVmZmVyLCBvcmlnaW5hbFZhbHVlT2Zmc2V0KTsKICAgICAgZm9yIChsZXQgaSA9IHN0cmlkZSwgZSA9IG9yaWdpbmFsVmFsdWVPZmZzZXQ7IGkgIT09IGU7ICsraSkgewogICAgICAgIGJ1ZmZlcltpXSA9IGJ1ZmZlcltvcmlnaW5hbFZhbHVlT2Zmc2V0ICsgaSAlIHN0cmlkZV07CiAgICAgIH0KICAgICAgdGhpcy5fc2V0SWRlbnRpdHkoKTsKICAgICAgdGhpcy5jdW11bGF0aXZlV2VpZ2h0ID0gMDsKICAgICAgdGhpcy5jdW11bGF0aXZlV2VpZ2h0QWRkaXRpdmUgPSAwOwogICAgfQogICAgcmVzdG9yZU9yaWdpbmFsU3RhdGUoKSB7CiAgICAgIGNvbnN0IG9yaWdpbmFsVmFsdWVPZmZzZXQgPSB0aGlzLnZhbHVlU2l6ZSAqIDM7CiAgICAgIHRoaXMuYmluZGluZy5zZXRWYWx1ZSh0aGlzLmJ1ZmZlciwgb3JpZ2luYWxWYWx1ZU9mZnNldCk7CiAgICB9CiAgICBfc2V0QWRkaXRpdmVJZGVudGl0eU51bWVyaWMoKSB7CiAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSB0aGlzLl9hZGRJbmRleCAqIHRoaXMudmFsdWVTaXplOwogICAgICBjb25zdCBlbmRJbmRleCA9IHN0YXJ0SW5kZXggKyB0aGlzLnZhbHVlU2l6ZTsKICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0SW5kZXg7IGkgPCBlbmRJbmRleDsgaSsrKSB7CiAgICAgICAgdGhpcy5idWZmZXJbaV0gPSAwOwogICAgICB9CiAgICB9CiAgICBfc2V0QWRkaXRpdmVJZGVudGl0eVF1YXRlcm5pb24oKSB7CiAgICAgIHRoaXMuX3NldEFkZGl0aXZlSWRlbnRpdHlOdW1lcmljKCk7CiAgICAgIHRoaXMuYnVmZmVyW3RoaXMuX2FkZEluZGV4ICogdGhpcy52YWx1ZVNpemUgKyAzXSA9IDE7CiAgICB9CiAgICBfc2V0QWRkaXRpdmVJZGVudGl0eU90aGVyKCkgewogICAgICBjb25zdCBzdGFydEluZGV4ID0gdGhpcy5fb3JpZ0luZGV4ICogdGhpcy52YWx1ZVNpemU7CiAgICAgIGNvbnN0IHRhcmdldEluZGV4ID0gdGhpcy5fYWRkSW5kZXggKiB0aGlzLnZhbHVlU2l6ZTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnZhbHVlU2l6ZTsgaSsrKSB7CiAgICAgICAgdGhpcy5idWZmZXJbdGFyZ2V0SW5kZXggKyBpXSA9IHRoaXMuYnVmZmVyW3N0YXJ0SW5kZXggKyBpXTsKICAgICAgfQogICAgfQogICAgX3NlbGVjdChidWZmZXIsIGRzdE9mZnNldCwgc3JjT2Zmc2V0LCB0LCBzdHJpZGUpIHsKICAgICAgaWYgKHQgPj0gMC41KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHN0cmlkZTsgKytpKSB7CiAgICAgICAgICBidWZmZXJbZHN0T2Zmc2V0ICsgaV0gPSBidWZmZXJbc3JjT2Zmc2V0ICsgaV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBfc2xlcnAoYnVmZmVyLCBkc3RPZmZzZXQsIHNyY09mZnNldCwgdCkgewogICAgICBRdWF0ZXJuaW9uLnNsZXJwRmxhdChidWZmZXIsIGRzdE9mZnNldCwgYnVmZmVyLCBkc3RPZmZzZXQsIGJ1ZmZlciwgc3JjT2Zmc2V0LCB0KTsKICAgIH0KICAgIF9zbGVycEFkZGl0aXZlKGJ1ZmZlciwgZHN0T2Zmc2V0LCBzcmNPZmZzZXQsIHQsIHN0cmlkZSkgewogICAgICBjb25zdCB3b3JrT2Zmc2V0ID0gdGhpcy5fd29ya0luZGV4ICogc3RyaWRlOwogICAgICBRdWF0ZXJuaW9uLm11bHRpcGx5UXVhdGVybmlvbnNGbGF0KGJ1ZmZlciwgd29ya09mZnNldCwgYnVmZmVyLCBkc3RPZmZzZXQsIGJ1ZmZlciwgc3JjT2Zmc2V0KTsKICAgICAgUXVhdGVybmlvbi5zbGVycEZsYXQoYnVmZmVyLCBkc3RPZmZzZXQsIGJ1ZmZlciwgZHN0T2Zmc2V0LCBidWZmZXIsIHdvcmtPZmZzZXQsIHQpOwogICAgfQogICAgX2xlcnAoYnVmZmVyLCBkc3RPZmZzZXQsIHNyY09mZnNldCwgdCwgc3RyaWRlKSB7CiAgICAgIGNvbnN0IHMgPSAxIC0gdDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHN0cmlkZTsgKytpKSB7CiAgICAgICAgY29uc3QgaiA9IGRzdE9mZnNldCArIGk7CiAgICAgICAgYnVmZmVyW2pdID0gYnVmZmVyW2pdICogcyArIGJ1ZmZlcltzcmNPZmZzZXQgKyBpXSAqIHQ7CiAgICAgIH0KICAgIH0KICAgIF9sZXJwQWRkaXRpdmUoYnVmZmVyLCBkc3RPZmZzZXQsIHNyY09mZnNldCwgdCwgc3RyaWRlKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzdHJpZGU7ICsraSkgewogICAgICAgIGNvbnN0IGogPSBkc3RPZmZzZXQgKyBpOwogICAgICAgIGJ1ZmZlcltqXSA9IGJ1ZmZlcltqXSArIGJ1ZmZlcltzcmNPZmZzZXQgKyBpXSAqIHQ7CiAgICAgIH0KICAgIH0KICB9OwogIHZhciBfUkVTRVJWRURfQ0hBUlNfUkUgPSAiXFxbXFxdXFwuOlxcLyI7CiAgdmFyIF9yZXNlcnZlZFJlID0gbmV3IFJlZ0V4cCgiWyIgKyBfUkVTRVJWRURfQ0hBUlNfUkUgKyAiXSIsICJnIik7CiAgdmFyIF93b3JkQ2hhciA9ICJbXiIgKyBfUkVTRVJWRURfQ0hBUlNfUkUgKyAiXSI7CiAgdmFyIF93b3JkQ2hhck9yRG90ID0gIlteIiArIF9SRVNFUlZFRF9DSEFSU19SRS5yZXBsYWNlKCJcXC4iLCAiIikgKyAiXSI7CiAgdmFyIF9kaXJlY3RvcnlSZSA9IC8oKD86V0MrW1wvOl0pKikvLnNvdXJjZS5yZXBsYWNlKCJXQyIsIF93b3JkQ2hhcik7CiAgdmFyIF9ub2RlUmUgPSAvKFdDT0QrKT8vLnNvdXJjZS5yZXBsYWNlKCJXQ09EIiwgX3dvcmRDaGFyT3JEb3QpOwogIHZhciBfb2JqZWN0UmUgPSAvKD86XC4oV0MrKSg/OlxbKC4rKVxdKT8pPy8uc291cmNlLnJlcGxhY2UoIldDIiwgX3dvcmRDaGFyKTsKICB2YXIgX3Byb3BlcnR5UmUgPSAvXC4oV0MrKSg/OlxbKC4rKVxdKT8vLnNvdXJjZS5yZXBsYWNlKCJXQyIsIF93b3JkQ2hhcik7CiAgdmFyIF90cmFja1JlID0gbmV3IFJlZ0V4cCgiXiIgKyBfZGlyZWN0b3J5UmUgKyBfbm9kZVJlICsgX29iamVjdFJlICsgX3Byb3BlcnR5UmUgKyAiJCIpOwogIHZhciBfc3VwcG9ydGVkT2JqZWN0TmFtZXMgPSBbIm1hdGVyaWFsIiwgIm1hdGVyaWFscyIsICJib25lcyJdOwogIHZhciBDb21wb3NpdGUgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3Rvcih0YXJnZXRHcm91cCwgcGF0aCwgb3B0aW9uYWxQYXJzZWRQYXRoKSB7CiAgICAgIGNvbnN0IHBhcnNlZFBhdGggPSBvcHRpb25hbFBhcnNlZFBhdGggfHwgUHJvcGVydHlCaW5kaW5nLnBhcnNlVHJhY2tOYW1lKHBhdGgpOwogICAgICB0aGlzLl90YXJnZXRHcm91cCA9IHRhcmdldEdyb3VwOwogICAgICB0aGlzLl9iaW5kaW5ncyA9IHRhcmdldEdyb3VwLnN1YnNjcmliZV8ocGF0aCwgcGFyc2VkUGF0aCk7CiAgICB9CiAgICBnZXRWYWx1ZShhcnJheSwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuYmluZCgpOwogICAgICBjb25zdCBmaXJzdFZhbGlkSW5kZXggPSB0aGlzLl90YXJnZXRHcm91cC5uQ2FjaGVkT2JqZWN0c18sIGJpbmRpbmcgPSB0aGlzLl9iaW5kaW5nc1tmaXJzdFZhbGlkSW5kZXhdOwogICAgICBpZiAoYmluZGluZyAhPT0gdm9pZCAwKQogICAgICAgIGJpbmRpbmcuZ2V0VmFsdWUoYXJyYXksIG9mZnNldCk7CiAgICB9CiAgICBzZXRWYWx1ZShhcnJheSwgb2Zmc2V0KSB7CiAgICAgIGNvbnN0IGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3M7CiAgICAgIGZvciAobGV0IGkgPSB0aGlzLl90YXJnZXRHcm91cC5uQ2FjaGVkT2JqZWN0c18sIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIGJpbmRpbmdzW2ldLnNldFZhbHVlKGFycmF5LCBvZmZzZXQpOwogICAgICB9CiAgICB9CiAgICBiaW5kKCkgewogICAgICBjb25zdCBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzOwogICAgICBmb3IgKGxldCBpID0gdGhpcy5fdGFyZ2V0R3JvdXAubkNhY2hlZE9iamVjdHNfLCBuID0gYmluZGluZ3MubGVuZ3RoOyBpICE9PSBuOyArK2kpIHsKICAgICAgICBiaW5kaW5nc1tpXS5iaW5kKCk7CiAgICAgIH0KICAgIH0KICAgIHVuYmluZCgpIHsKICAgICAgY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5nczsKICAgICAgZm9yIChsZXQgaSA9IHRoaXMuX3RhcmdldEdyb3VwLm5DYWNoZWRPYmplY3RzXywgbiA9IGJpbmRpbmdzLmxlbmd0aDsgaSAhPT0gbjsgKytpKSB7CiAgICAgICAgYmluZGluZ3NbaV0udW5iaW5kKCk7CiAgICAgIH0KICAgIH0KICB9OwogIHZhciBQcm9wZXJ0eUJpbmRpbmcgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3Rvcihyb290Tm9kZSwgcGF0aCwgcGFyc2VkUGF0aCkgewogICAgICB0aGlzLnBhdGggPSBwYXRoOwogICAgICB0aGlzLnBhcnNlZFBhdGggPSBwYXJzZWRQYXRoIHx8IFByb3BlcnR5QmluZGluZy5wYXJzZVRyYWNrTmFtZShwYXRoKTsKICAgICAgdGhpcy5ub2RlID0gUHJvcGVydHlCaW5kaW5nLmZpbmROb2RlKHJvb3ROb2RlLCB0aGlzLnBhcnNlZFBhdGgubm9kZU5hbWUpIHx8IHJvb3ROb2RlOwogICAgICB0aGlzLnJvb3ROb2RlID0gcm9vdE5vZGU7CiAgICAgIHRoaXMuZ2V0VmFsdWUgPSB0aGlzLl9nZXRWYWx1ZV91bmJvdW5kOwogICAgICB0aGlzLnNldFZhbHVlID0gdGhpcy5fc2V0VmFsdWVfdW5ib3VuZDsKICAgIH0KICAgIHN0YXRpYyBjcmVhdGUocm9vdCwgcGF0aCwgcGFyc2VkUGF0aCkgewogICAgICBpZiAoIShyb290ICYmIHJvb3QuaXNBbmltYXRpb25PYmplY3RHcm91cCkpIHsKICAgICAgICByZXR1cm4gbmV3IFByb3BlcnR5QmluZGluZyhyb290LCBwYXRoLCBwYXJzZWRQYXRoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFByb3BlcnR5QmluZGluZy5Db21wb3NpdGUocm9vdCwgcGF0aCwgcGFyc2VkUGF0aCk7CiAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBzYW5pdGl6ZU5vZGVOYW1lKG5hbWUpIHsKICAgICAgcmV0dXJuIG5hbWUucmVwbGFjZSgvXHMvZywgIl8iKS5yZXBsYWNlKF9yZXNlcnZlZFJlLCAiIik7CiAgICB9CiAgICBzdGF0aWMgcGFyc2VUcmFja05hbWUodHJhY2tOYW1lKSB7CiAgICAgIGNvbnN0IG1hdGNoZXMgPSBfdHJhY2tSZS5leGVjKHRyYWNrTmFtZSk7CiAgICAgIGlmICghbWF0Y2hlcykgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiUHJvcGVydHlCaW5kaW5nOiBDYW5ub3QgcGFyc2UgdHJhY2tOYW1lOiAiICsgdHJhY2tOYW1lKTsKICAgICAgfQogICAgICBjb25zdCByZXN1bHRzID0gewogICAgICAgIG5vZGVOYW1lOiBtYXRjaGVzWzJdLAogICAgICAgIG9iamVjdE5hbWU6IG1hdGNoZXNbM10sCiAgICAgICAgb2JqZWN0SW5kZXg6IG1hdGNoZXNbNF0sCiAgICAgICAgcHJvcGVydHlOYW1lOiBtYXRjaGVzWzVdLAogICAgICAgIHByb3BlcnR5SW5kZXg6IG1hdGNoZXNbNl0KICAgICAgfTsKICAgICAgY29uc3QgbGFzdERvdCA9IHJlc3VsdHMubm9kZU5hbWUgJiYgcmVzdWx0cy5ub2RlTmFtZS5sYXN0SW5kZXhPZigiLiIpOwogICAgICBpZiAobGFzdERvdCAhPT0gdm9pZCAwICYmIGxhc3REb3QgIT09IC0xKSB7CiAgICAgICAgY29uc3Qgb2JqZWN0TmFtZSA9IHJlc3VsdHMubm9kZU5hbWUuc3Vic3RyaW5nKGxhc3REb3QgKyAxKTsKICAgICAgICBpZiAoX3N1cHBvcnRlZE9iamVjdE5hbWVzLmluZGV4T2Yob2JqZWN0TmFtZSkgIT09IC0xKSB7CiAgICAgICAgICByZXN1bHRzLm5vZGVOYW1lID0gcmVzdWx0cy5ub2RlTmFtZS5zdWJzdHJpbmcoMCwgbGFzdERvdCk7CiAgICAgICAgICByZXN1bHRzLm9iamVjdE5hbWUgPSBvYmplY3ROYW1lOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocmVzdWx0cy5wcm9wZXJ0eU5hbWUgPT09IG51bGwgfHwgcmVzdWx0cy5wcm9wZXJ0eU5hbWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQcm9wZXJ0eUJpbmRpbmc6IGNhbiBub3QgcGFyc2UgcHJvcGVydHlOYW1lIGZyb20gdHJhY2tOYW1lOiAiICsgdHJhY2tOYW1lKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0KICAgIHN0YXRpYyBmaW5kTm9kZShyb290LCBub2RlTmFtZSkgewogICAgICBpZiAoIW5vZGVOYW1lIHx8IG5vZGVOYW1lID09PSAiIiB8fCBub2RlTmFtZSA9PT0gIi4iIHx8IG5vZGVOYW1lID09PSAtMSB8fCBub2RlTmFtZSA9PT0gcm9vdC5uYW1lIHx8IG5vZGVOYW1lID09PSByb290LnV1aWQpIHsKICAgICAgICByZXR1cm4gcm9vdDsKICAgICAgfQogICAgICBpZiAocm9vdC5za2VsZXRvbikgewogICAgICAgIGNvbnN0IGJvbmUgPSByb290LnNrZWxldG9uLmdldEJvbmVCeU5hbWUobm9kZU5hbWUpOwogICAgICAgIGlmIChib25lICE9PSB2b2lkIDApIHsKICAgICAgICAgIHJldHVybiBib25lOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocm9vdC5jaGlsZHJlbikgewogICAgICAgIGNvbnN0IHNlYXJjaE5vZGVTdWJ0cmVlID0gZnVuY3Rpb24oY2hpbGRyZW4pIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gY2hpbGRyZW5baV07CiAgICAgICAgICAgIGlmIChjaGlsZE5vZGUubmFtZSA9PT0gbm9kZU5hbWUgfHwgY2hpbGROb2RlLnV1aWQgPT09IG5vZGVOYW1lKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkTm9kZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBzZWFyY2hOb2RlU3VidHJlZShjaGlsZE5vZGUuY2hpbGRyZW4pOwogICAgICAgICAgICBpZiAocmVzdWx0KQogICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwogICAgICAgIGNvbnN0IHN1YlRyZWVOb2RlID0gc2VhcmNoTm9kZVN1YnRyZWUocm9vdC5jaGlsZHJlbik7CiAgICAgICAgaWYgKHN1YlRyZWVOb2RlKSB7CiAgICAgICAgICByZXR1cm4gc3ViVHJlZU5vZGU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgX2dldFZhbHVlX3VuYXZhaWxhYmxlKCkgewogICAgfQogICAgX3NldFZhbHVlX3VuYXZhaWxhYmxlKCkgewogICAgfQogICAgX2dldFZhbHVlX2RpcmVjdChidWZmZXIsIG9mZnNldCkgewogICAgICBidWZmZXJbb2Zmc2V0XSA9IHRoaXMubm9kZVt0aGlzLnByb3BlcnR5TmFtZV07CiAgICB9CiAgICBfZ2V0VmFsdWVfYXJyYXkoYnVmZmVyLCBvZmZzZXQpIHsKICAgICAgY29uc3Qgc291cmNlID0gdGhpcy5yZXNvbHZlZFByb3BlcnR5OwogICAgICBmb3IgKGxldCBpID0gMCwgbiA9IHNvdXJjZS5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIGJ1ZmZlcltvZmZzZXQrK10gPSBzb3VyY2VbaV07CiAgICAgIH0KICAgIH0KICAgIF9nZXRWYWx1ZV9hcnJheUVsZW1lbnQoYnVmZmVyLCBvZmZzZXQpIHsKICAgICAgYnVmZmVyW29mZnNldF0gPSB0aGlzLnJlc29sdmVkUHJvcGVydHlbdGhpcy5wcm9wZXJ0eUluZGV4XTsKICAgIH0KICAgIF9nZXRWYWx1ZV90b0FycmF5KGJ1ZmZlciwgb2Zmc2V0KSB7CiAgICAgIHRoaXMucmVzb2x2ZWRQcm9wZXJ0eS50b0FycmF5KGJ1ZmZlciwgb2Zmc2V0KTsKICAgIH0KICAgIF9zZXRWYWx1ZV9kaXJlY3QoYnVmZmVyLCBvZmZzZXQpIHsKICAgICAgdGhpcy50YXJnZXRPYmplY3RbdGhpcy5wcm9wZXJ0eU5hbWVdID0gYnVmZmVyW29mZnNldF07CiAgICB9CiAgICBfc2V0VmFsdWVfZGlyZWN0X3NldE5lZWRzVXBkYXRlKGJ1ZmZlciwgb2Zmc2V0KSB7CiAgICAgIHRoaXMudGFyZ2V0T2JqZWN0W3RoaXMucHJvcGVydHlOYW1lXSA9IGJ1ZmZlcltvZmZzZXRdOwogICAgICB0aGlzLnRhcmdldE9iamVjdC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICB9CiAgICBfc2V0VmFsdWVfZGlyZWN0X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUoYnVmZmVyLCBvZmZzZXQpIHsKICAgICAgdGhpcy50YXJnZXRPYmplY3RbdGhpcy5wcm9wZXJ0eU5hbWVdID0gYnVmZmVyW29mZnNldF07CiAgICAgIHRoaXMudGFyZ2V0T2JqZWN0Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgfQogICAgX3NldFZhbHVlX2FycmF5KGJ1ZmZlciwgb2Zmc2V0KSB7CiAgICAgIGNvbnN0IGRlc3QgPSB0aGlzLnJlc29sdmVkUHJvcGVydHk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gZGVzdC5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIGRlc3RbaV0gPSBidWZmZXJbb2Zmc2V0KytdOwogICAgICB9CiAgICB9CiAgICBfc2V0VmFsdWVfYXJyYXlfc2V0TmVlZHNVcGRhdGUoYnVmZmVyLCBvZmZzZXQpIHsKICAgICAgY29uc3QgZGVzdCA9IHRoaXMucmVzb2x2ZWRQcm9wZXJ0eTsKICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSBkZXN0Lmxlbmd0aDsgaSAhPT0gbjsgKytpKSB7CiAgICAgICAgZGVzdFtpXSA9IGJ1ZmZlcltvZmZzZXQrK107CiAgICAgIH0KICAgICAgdGhpcy50YXJnZXRPYmplY3QubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgfQogICAgX3NldFZhbHVlX2FycmF5X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUoYnVmZmVyLCBvZmZzZXQpIHsKICAgICAgY29uc3QgZGVzdCA9IHRoaXMucmVzb2x2ZWRQcm9wZXJ0eTsKICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSBkZXN0Lmxlbmd0aDsgaSAhPT0gbjsgKytpKSB7CiAgICAgICAgZGVzdFtpXSA9IGJ1ZmZlcltvZmZzZXQrK107CiAgICAgIH0KICAgICAgdGhpcy50YXJnZXRPYmplY3QubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CiAgICB9CiAgICBfc2V0VmFsdWVfYXJyYXlFbGVtZW50KGJ1ZmZlciwgb2Zmc2V0KSB7CiAgICAgIHRoaXMucmVzb2x2ZWRQcm9wZXJ0eVt0aGlzLnByb3BlcnR5SW5kZXhdID0gYnVmZmVyW29mZnNldF07CiAgICB9CiAgICBfc2V0VmFsdWVfYXJyYXlFbGVtZW50X3NldE5lZWRzVXBkYXRlKGJ1ZmZlciwgb2Zmc2V0KSB7CiAgICAgIHRoaXMucmVzb2x2ZWRQcm9wZXJ0eVt0aGlzLnByb3BlcnR5SW5kZXhdID0gYnVmZmVyW29mZnNldF07CiAgICAgIHRoaXMudGFyZ2V0T2JqZWN0Lm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIH0KICAgIF9zZXRWYWx1ZV9hcnJheUVsZW1lbnRfc2V0TWF0cml4V29ybGROZWVkc1VwZGF0ZShidWZmZXIsIG9mZnNldCkgewogICAgICB0aGlzLnJlc29sdmVkUHJvcGVydHlbdGhpcy5wcm9wZXJ0eUluZGV4XSA9IGJ1ZmZlcltvZmZzZXRdOwogICAgICB0aGlzLnRhcmdldE9iamVjdC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIH0KICAgIF9zZXRWYWx1ZV9mcm9tQXJyYXkoYnVmZmVyLCBvZmZzZXQpIHsKICAgICAgdGhpcy5yZXNvbHZlZFByb3BlcnR5LmZyb21BcnJheShidWZmZXIsIG9mZnNldCk7CiAgICB9CiAgICBfc2V0VmFsdWVfZnJvbUFycmF5X3NldE5lZWRzVXBkYXRlKGJ1ZmZlciwgb2Zmc2V0KSB7CiAgICAgIHRoaXMucmVzb2x2ZWRQcm9wZXJ0eS5mcm9tQXJyYXkoYnVmZmVyLCBvZmZzZXQpOwogICAgICB0aGlzLnRhcmdldE9iamVjdC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICB9CiAgICBfc2V0VmFsdWVfZnJvbUFycmF5X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUoYnVmZmVyLCBvZmZzZXQpIHsKICAgICAgdGhpcy5yZXNvbHZlZFByb3BlcnR5LmZyb21BcnJheShidWZmZXIsIG9mZnNldCk7CiAgICAgIHRoaXMudGFyZ2V0T2JqZWN0Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgfQogICAgX2dldFZhbHVlX3VuYm91bmQodGFyZ2V0QXJyYXksIG9mZnNldCkgewogICAgICB0aGlzLmJpbmQoKTsKICAgICAgdGhpcy5nZXRWYWx1ZSh0YXJnZXRBcnJheSwgb2Zmc2V0KTsKICAgIH0KICAgIF9zZXRWYWx1ZV91bmJvdW5kKHNvdXJjZUFycmF5LCBvZmZzZXQpIHsKICAgICAgdGhpcy5iaW5kKCk7CiAgICAgIHRoaXMuc2V0VmFsdWUoc291cmNlQXJyYXksIG9mZnNldCk7CiAgICB9CiAgICBiaW5kKCkgewogICAgICBsZXQgdGFyZ2V0T2JqZWN0ID0gdGhpcy5ub2RlOwogICAgICBjb25zdCBwYXJzZWRQYXRoID0gdGhpcy5wYXJzZWRQYXRoOwogICAgICBjb25zdCBvYmplY3ROYW1lID0gcGFyc2VkUGF0aC5vYmplY3ROYW1lOwogICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwYXJzZWRQYXRoLnByb3BlcnR5TmFtZTsKICAgICAgbGV0IHByb3BlcnR5SW5kZXggPSBwYXJzZWRQYXRoLnByb3BlcnR5SW5kZXg7CiAgICAgIGlmICghdGFyZ2V0T2JqZWN0KSB7CiAgICAgICAgdGFyZ2V0T2JqZWN0ID0gUHJvcGVydHlCaW5kaW5nLmZpbmROb2RlKHRoaXMucm9vdE5vZGUsIHBhcnNlZFBhdGgubm9kZU5hbWUpIHx8IHRoaXMucm9vdE5vZGU7CiAgICAgICAgdGhpcy5ub2RlID0gdGFyZ2V0T2JqZWN0OwogICAgICB9CiAgICAgIHRoaXMuZ2V0VmFsdWUgPSB0aGlzLl9nZXRWYWx1ZV91bmF2YWlsYWJsZTsKICAgICAgdGhpcy5zZXRWYWx1ZSA9IHRoaXMuX3NldFZhbHVlX3VuYXZhaWxhYmxlOwogICAgICBpZiAoIXRhcmdldE9iamVjdCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLlByb3BlcnR5QmluZGluZzogVHJ5aW5nIHRvIHVwZGF0ZSBub2RlIGZvciB0cmFjazogIiArIHRoaXMucGF0aCArICIgYnV0IGl0IHdhc24ndCBmb3VuZC4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKG9iamVjdE5hbWUpIHsKICAgICAgICBsZXQgb2JqZWN0SW5kZXggPSBwYXJzZWRQYXRoLm9iamVjdEluZGV4OwogICAgICAgIHN3aXRjaCAob2JqZWN0TmFtZSkgewogICAgICAgICAgY2FzZSAibWF0ZXJpYWxzIjoKICAgICAgICAgICAgaWYgKCF0YXJnZXRPYmplY3QubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IENhbiBub3QgYmluZCB0byBtYXRlcmlhbCBhcyBub2RlIGRvZXMgbm90IGhhdmUgYSBtYXRlcmlhbC4iLCB0aGlzKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0YXJnZXRPYmplY3QubWF0ZXJpYWwubWF0ZXJpYWxzKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gbWF0ZXJpYWwubWF0ZXJpYWxzIGFzIG5vZGUubWF0ZXJpYWwgZG9lcyBub3QgaGF2ZSBhIG1hdGVyaWFscyBhcnJheS4iLCB0aGlzKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFyZ2V0T2JqZWN0ID0gdGFyZ2V0T2JqZWN0Lm1hdGVyaWFsLm1hdGVyaWFsczsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJib25lcyI6CiAgICAgICAgICAgIGlmICghdGFyZ2V0T2JqZWN0LnNrZWxldG9uKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gYm9uZXMgYXMgbm9kZSBkb2VzIG5vdCBoYXZlIGEgc2tlbGV0b24uIiwgdGhpcyk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRhcmdldE9iamVjdCA9IHRhcmdldE9iamVjdC5za2VsZXRvbi5ib25lczsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXRPYmplY3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAodGFyZ2V0T2JqZWN0W2ldLm5hbWUgPT09IG9iamVjdEluZGV4KSB7CiAgICAgICAgICAgICAgICBvYmplY3RJbmRleCA9IGk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiAodGFyZ2V0T2JqZWN0W29iamVjdE5hbWVdID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IENhbiBub3QgYmluZCB0byBvYmplY3ROYW1lIG9mIG5vZGUgdW5kZWZpbmVkLiIsIHRoaXMpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YXJnZXRPYmplY3QgPSB0YXJnZXRPYmplY3Rbb2JqZWN0TmFtZV07CiAgICAgICAgfQogICAgICAgIGlmIChvYmplY3RJbmRleCAhPT0gdm9pZCAwKSB7CiAgICAgICAgICBpZiAodGFyZ2V0T2JqZWN0W29iamVjdEluZGV4XSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLlByb3BlcnR5QmluZGluZzogVHJ5aW5nIHRvIGJpbmQgdG8gb2JqZWN0SW5kZXggb2Ygb2JqZWN0TmFtZSwgYnV0IGlzIHVuZGVmaW5lZC4iLCB0aGlzLCB0YXJnZXRPYmplY3QpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB0YXJnZXRPYmplY3QgPSB0YXJnZXRPYmplY3Rbb2JqZWN0SW5kZXhdOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBub2RlUHJvcGVydHkgPSB0YXJnZXRPYmplY3RbcHJvcGVydHlOYW1lXTsKICAgICAgaWYgKG5vZGVQcm9wZXJ0eSA9PT0gdm9pZCAwKSB7CiAgICAgICAgY29uc3Qgbm9kZU5hbWUgPSBwYXJzZWRQYXRoLm5vZGVOYW1lOwogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLlByb3BlcnR5QmluZGluZzogVHJ5aW5nIHRvIHVwZGF0ZSBwcm9wZXJ0eSBmb3IgdHJhY2s6ICIgKyBub2RlTmFtZSArICIuIiArIHByb3BlcnR5TmFtZSArICIgYnV0IGl0IHdhc24ndCBmb3VuZC4iLCB0YXJnZXRPYmplY3QpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgdmVyc2lvbmluZyA9IHRoaXMuVmVyc2lvbmluZy5Ob25lOwogICAgICB0aGlzLnRhcmdldE9iamVjdCA9IHRhcmdldE9iamVjdDsKICAgICAgaWYgKHRhcmdldE9iamVjdC5uZWVkc1VwZGF0ZSAhPT0gdm9pZCAwKSB7CiAgICAgICAgdmVyc2lvbmluZyA9IHRoaXMuVmVyc2lvbmluZy5OZWVkc1VwZGF0ZTsKICAgICAgfSBlbHNlIGlmICh0YXJnZXRPYmplY3QubWF0cml4V29ybGROZWVkc1VwZGF0ZSAhPT0gdm9pZCAwKSB7CiAgICAgICAgdmVyc2lvbmluZyA9IHRoaXMuVmVyc2lvbmluZy5NYXRyaXhXb3JsZE5lZWRzVXBkYXRlOwogICAgICB9CiAgICAgIGxldCBiaW5kaW5nVHlwZSA9IHRoaXMuQmluZGluZ1R5cGUuRGlyZWN0OwogICAgICBpZiAocHJvcGVydHlJbmRleCAhPT0gdm9pZCAwKSB7CiAgICAgICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gIm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyIpIHsKICAgICAgICAgIGlmICghdGFyZ2V0T2JqZWN0Lmdlb21ldHJ5KSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG1vcnBoVGFyZ2V0SW5mbHVlbmNlcyBiZWNhdXNlIG5vZGUgZG9lcyBub3QgaGF2ZSBhIGdlb21ldHJ5LiIsIHRoaXMpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGFyZ2V0T2JqZWN0Lmdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkpIHsKICAgICAgICAgICAgaWYgKCF0YXJnZXRPYmplY3QuZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gbW9ycGhUYXJnZXRJbmZsdWVuY2VzIGJlY2F1c2Ugbm9kZSBkb2VzIG5vdCBoYXZlIGEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLiIsIHRoaXMpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGFyZ2V0T2JqZWN0Lm1vcnBoVGFyZ2V0RGljdGlvbmFyeVtwcm9wZXJ0eUluZGV4XSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcHJvcGVydHlJbmRleCA9IHRhcmdldE9iamVjdC5tb3JwaFRhcmdldERpY3Rpb25hcnlbcHJvcGVydHlJbmRleF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG1vcnBoVGFyZ2V0SW5mbHVlbmNlcyBvbiBUSFJFRS5HZW9tZXRyeS4gVXNlIFRIUkVFLkJ1ZmZlckdlb21ldHJ5IGluc3RlYWQuIiwgdGhpcyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYmluZGluZ1R5cGUgPSB0aGlzLkJpbmRpbmdUeXBlLkFycmF5RWxlbWVudDsKICAgICAgICB0aGlzLnJlc29sdmVkUHJvcGVydHkgPSBub2RlUHJvcGVydHk7CiAgICAgICAgdGhpcy5wcm9wZXJ0eUluZGV4ID0gcHJvcGVydHlJbmRleDsKICAgICAgfSBlbHNlIGlmIChub2RlUHJvcGVydHkuZnJvbUFycmF5ICE9PSB2b2lkIDAgJiYgbm9kZVByb3BlcnR5LnRvQXJyYXkgIT09IHZvaWQgMCkgewogICAgICAgIGJpbmRpbmdUeXBlID0gdGhpcy5CaW5kaW5nVHlwZS5IYXNGcm9tVG9BcnJheTsKICAgICAgICB0aGlzLnJlc29sdmVkUHJvcGVydHkgPSBub2RlUHJvcGVydHk7CiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShub2RlUHJvcGVydHkpKSB7CiAgICAgICAgYmluZGluZ1R5cGUgPSB0aGlzLkJpbmRpbmdUeXBlLkVudGlyZUFycmF5OwogICAgICAgIHRoaXMucmVzb2x2ZWRQcm9wZXJ0eSA9IG5vZGVQcm9wZXJ0eTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTsKICAgICAgfQogICAgICB0aGlzLmdldFZhbHVlID0gdGhpcy5HZXR0ZXJCeUJpbmRpbmdUeXBlW2JpbmRpbmdUeXBlXTsKICAgICAgdGhpcy5zZXRWYWx1ZSA9IHRoaXMuU2V0dGVyQnlCaW5kaW5nVHlwZUFuZFZlcnNpb25pbmdbYmluZGluZ1R5cGVdW3ZlcnNpb25pbmddOwogICAgfQogICAgdW5iaW5kKCkgewogICAgICB0aGlzLm5vZGUgPSBudWxsOwogICAgICB0aGlzLmdldFZhbHVlID0gdGhpcy5fZ2V0VmFsdWVfdW5ib3VuZDsKICAgICAgdGhpcy5zZXRWYWx1ZSA9IHRoaXMuX3NldFZhbHVlX3VuYm91bmQ7CiAgICB9CiAgfTsKICBQcm9wZXJ0eUJpbmRpbmcuQ29tcG9zaXRlID0gQ29tcG9zaXRlOwogIFByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuQmluZGluZ1R5cGUgPSB7CiAgICBEaXJlY3Q6IDAsCiAgICBFbnRpcmVBcnJheTogMSwKICAgIEFycmF5RWxlbWVudDogMiwKICAgIEhhc0Zyb21Ub0FycmF5OiAzCiAgfTsKICBQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLlZlcnNpb25pbmcgPSB7CiAgICBOb25lOiAwLAogICAgTmVlZHNVcGRhdGU6IDEsCiAgICBNYXRyaXhXb3JsZE5lZWRzVXBkYXRlOiAyCiAgfTsKICBQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLkdldHRlckJ5QmluZGluZ1R5cGUgPSBbCiAgICBQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9nZXRWYWx1ZV9kaXJlY3QsCiAgICBQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9nZXRWYWx1ZV9hcnJheSwKICAgIFByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX2dldFZhbHVlX2FycmF5RWxlbWVudCwKICAgIFByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX2dldFZhbHVlX3RvQXJyYXkKICBdOwogIFByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuU2V0dGVyQnlCaW5kaW5nVHlwZUFuZFZlcnNpb25pbmcgPSBbCiAgICBbCiAgICAgIFByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2RpcmVjdCwKICAgICAgUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfZGlyZWN0X3NldE5lZWRzVXBkYXRlLAogICAgICBQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9kaXJlY3Rfc2V0TWF0cml4V29ybGROZWVkc1VwZGF0ZQogICAgXSwKICAgIFsKICAgICAgUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfYXJyYXksCiAgICAgIFByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2FycmF5X3NldE5lZWRzVXBkYXRlLAogICAgICBQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9hcnJheV9zZXRNYXRyaXhXb3JsZE5lZWRzVXBkYXRlCiAgICBdLAogICAgWwogICAgICBQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9hcnJheUVsZW1lbnQsCiAgICAgIFByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2FycmF5RWxlbWVudF9zZXROZWVkc1VwZGF0ZSwKICAgICAgUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfYXJyYXlFbGVtZW50X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUKICAgIF0sCiAgICBbCiAgICAgIFByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2Zyb21BcnJheSwKICAgICAgUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfZnJvbUFycmF5X3NldE5lZWRzVXBkYXRlLAogICAgICBQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9mcm9tQXJyYXlfc2V0TWF0cml4V29ybGROZWVkc1VwZGF0ZQogICAgXQogIF07CiAgdmFyIEFuaW1hdGlvbk9iamVjdEdyb3VwID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwogICAgICB0aGlzLl9vYmplY3RzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgICAgdGhpcy5uQ2FjaGVkT2JqZWN0c18gPSAwOwogICAgICBjb25zdCBpbmRpY2VzID0ge307CiAgICAgIHRoaXMuX2luZGljZXNCeVVVSUQgPSBpbmRpY2VzOwogICAgICBmb3IgKGxldCBpID0gMCwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIGluZGljZXNbYXJndW1lbnRzW2ldLnV1aWRdID0gaTsKICAgICAgfQogICAgICB0aGlzLl9wYXRocyA9IFtdOwogICAgICB0aGlzLl9wYXJzZWRQYXRocyA9IFtdOwogICAgICB0aGlzLl9iaW5kaW5ncyA9IFtdOwogICAgICB0aGlzLl9iaW5kaW5nc0luZGljZXNCeVBhdGggPSB7fTsKICAgICAgY29uc3Qgc2NvcGUgPSB0aGlzOwogICAgICB0aGlzLnN0YXRzID0gewogICAgICAgIG9iamVjdHM6IHsKICAgICAgICAgIGdldCB0b3RhbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHNjb3BlLl9vYmplY3RzLmxlbmd0aDsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXQgaW5Vc2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRvdGFsIC0gc2NvcGUubkNhY2hlZE9iamVjdHNfOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZ2V0IGJpbmRpbmdzUGVyT2JqZWN0KCkgewogICAgICAgICAgcmV0dXJuIHNjb3BlLl9iaW5kaW5ncy5sZW5ndGg7CiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgYWRkKCkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5fb2JqZWN0cywgaW5kaWNlc0J5VVVJRCA9IHRoaXMuX2luZGljZXNCeVVVSUQsIHBhdGhzID0gdGhpcy5fcGF0aHMsIHBhcnNlZFBhdGhzID0gdGhpcy5fcGFyc2VkUGF0aHMsIGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsIG5CaW5kaW5ncyA9IGJpbmRpbmdzLmxlbmd0aDsKICAgICAgbGV0IGtub3duT2JqZWN0ID0gdm9pZCAwLCBuT2JqZWN0cyA9IG9iamVjdHMubGVuZ3RoLCBuQ2FjaGVkT2JqZWN0cyA9IHRoaXMubkNhY2hlZE9iamVjdHNfOwogICAgICBmb3IgKGxldCBpID0gMCwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIGNvbnN0IG9iamVjdCA9IGFyZ3VtZW50c1tpXSwgdXVpZCA9IG9iamVjdC51dWlkOwogICAgICAgIGxldCBpbmRleCA9IGluZGljZXNCeVVVSURbdXVpZF07CiAgICAgICAgaWYgKGluZGV4ID09PSB2b2lkIDApIHsKICAgICAgICAgIGluZGV4ID0gbk9iamVjdHMrKzsKICAgICAgICAgIGluZGljZXNCeVVVSURbdXVpZF0gPSBpbmRleDsKICAgICAgICAgIG9iamVjdHMucHVzaChvYmplY3QpOwogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIG0gPSBuQmluZGluZ3M7IGogIT09IG07ICsraikgewogICAgICAgICAgICBiaW5kaW5nc1tqXS5wdXNoKG5ldyBQcm9wZXJ0eUJpbmRpbmcob2JqZWN0LCBwYXRoc1tqXSwgcGFyc2VkUGF0aHNbal0pKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGluZGV4IDwgbkNhY2hlZE9iamVjdHMpIHsKICAgICAgICAgIGtub3duT2JqZWN0ID0gb2JqZWN0c1tpbmRleF07CiAgICAgICAgICBjb25zdCBmaXJzdEFjdGl2ZUluZGV4ID0gLS1uQ2FjaGVkT2JqZWN0cywgbGFzdENhY2hlZE9iamVjdCA9IG9iamVjdHNbZmlyc3RBY3RpdmVJbmRleF07CiAgICAgICAgICBpbmRpY2VzQnlVVUlEW2xhc3RDYWNoZWRPYmplY3QudXVpZF0gPSBpbmRleDsKICAgICAgICAgIG9iamVjdHNbaW5kZXhdID0gbGFzdENhY2hlZE9iamVjdDsKICAgICAgICAgIGluZGljZXNCeVVVSURbdXVpZF0gPSBmaXJzdEFjdGl2ZUluZGV4OwogICAgICAgICAgb2JqZWN0c1tmaXJzdEFjdGl2ZUluZGV4XSA9IG9iamVjdDsKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBtID0gbkJpbmRpbmdzOyBqICE9PSBtOyArK2opIHsKICAgICAgICAgICAgY29uc3QgYmluZGluZ3NGb3JQYXRoID0gYmluZGluZ3Nbal0sIGxhc3RDYWNoZWQgPSBiaW5kaW5nc0ZvclBhdGhbZmlyc3RBY3RpdmVJbmRleF07CiAgICAgICAgICAgIGxldCBiaW5kaW5nID0gYmluZGluZ3NGb3JQYXRoW2luZGV4XTsKICAgICAgICAgICAgYmluZGluZ3NGb3JQYXRoW2luZGV4XSA9IGxhc3RDYWNoZWQ7CiAgICAgICAgICAgIGlmIChiaW5kaW5nID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBiaW5kaW5nID0gbmV3IFByb3BlcnR5QmluZGluZyhvYmplY3QsIHBhdGhzW2pdLCBwYXJzZWRQYXRoc1tqXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmluZGluZ3NGb3JQYXRoW2ZpcnN0QWN0aXZlSW5kZXhdID0gYmluZGluZzsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG9iamVjdHNbaW5kZXhdICE9PSBrbm93bk9iamVjdCkgewogICAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuQW5pbWF0aW9uT2JqZWN0R3JvdXA6IERpZmZlcmVudCBvYmplY3RzIHdpdGggdGhlIHNhbWUgVVVJRCBkZXRlY3RlZC4gQ2xlYW4gdGhlIGNhY2hlcyBvciByZWNyZWF0ZSB5b3VyIGluZnJhc3RydWN0dXJlIHdoZW4gcmVsb2FkaW5nIHNjZW5lcy4iKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5uQ2FjaGVkT2JqZWN0c18gPSBuQ2FjaGVkT2JqZWN0czsKICAgIH0KICAgIHJlbW92ZSgpIHsKICAgICAgY29uc3Qgb2JqZWN0cyA9IHRoaXMuX29iamVjdHMsIGluZGljZXNCeVVVSUQgPSB0aGlzLl9pbmRpY2VzQnlVVUlELCBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLCBuQmluZGluZ3MgPSBiaW5kaW5ncy5sZW5ndGg7CiAgICAgIGxldCBuQ2FjaGVkT2JqZWN0cyA9IHRoaXMubkNhY2hlZE9iamVjdHNfOwogICAgICBmb3IgKGxldCBpID0gMCwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIGNvbnN0IG9iamVjdCA9IGFyZ3VtZW50c1tpXSwgdXVpZCA9IG9iamVjdC51dWlkLCBpbmRleCA9IGluZGljZXNCeVVVSURbdXVpZF07CiAgICAgICAgaWYgKGluZGV4ICE9PSB2b2lkIDAgJiYgaW5kZXggPj0gbkNhY2hlZE9iamVjdHMpIHsKICAgICAgICAgIGNvbnN0IGxhc3RDYWNoZWRJbmRleCA9IG5DYWNoZWRPYmplY3RzKyssIGZpcnN0QWN0aXZlT2JqZWN0ID0gb2JqZWN0c1tsYXN0Q2FjaGVkSW5kZXhdOwogICAgICAgICAgaW5kaWNlc0J5VVVJRFtmaXJzdEFjdGl2ZU9iamVjdC51dWlkXSA9IGluZGV4OwogICAgICAgICAgb2JqZWN0c1tpbmRleF0gPSBmaXJzdEFjdGl2ZU9iamVjdDsKICAgICAgICAgIGluZGljZXNCeVVVSURbdXVpZF0gPSBsYXN0Q2FjaGVkSW5kZXg7CiAgICAgICAgICBvYmplY3RzW2xhc3RDYWNoZWRJbmRleF0gPSBvYmplY3Q7CiAgICAgICAgICBmb3IgKGxldCBqID0gMCwgbSA9IG5CaW5kaW5nczsgaiAhPT0gbTsgKytqKSB7CiAgICAgICAgICAgIGNvbnN0IGJpbmRpbmdzRm9yUGF0aCA9IGJpbmRpbmdzW2pdLCBmaXJzdEFjdGl2ZSA9IGJpbmRpbmdzRm9yUGF0aFtsYXN0Q2FjaGVkSW5kZXhdLCBiaW5kaW5nID0gYmluZGluZ3NGb3JQYXRoW2luZGV4XTsKICAgICAgICAgICAgYmluZGluZ3NGb3JQYXRoW2luZGV4XSA9IGZpcnN0QWN0aXZlOwogICAgICAgICAgICBiaW5kaW5nc0ZvclBhdGhbbGFzdENhY2hlZEluZGV4XSA9IGJpbmRpbmc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMubkNhY2hlZE9iamVjdHNfID0gbkNhY2hlZE9iamVjdHM7CiAgICB9CiAgICB1bmNhY2hlKCkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5fb2JqZWN0cywgaW5kaWNlc0J5VVVJRCA9IHRoaXMuX2luZGljZXNCeVVVSUQsIGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsIG5CaW5kaW5ncyA9IGJpbmRpbmdzLmxlbmd0aDsKICAgICAgbGV0IG5DYWNoZWRPYmplY3RzID0gdGhpcy5uQ2FjaGVkT2JqZWN0c18sIG5PYmplY3RzID0gb2JqZWN0cy5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSAhPT0gbjsgKytpKSB7CiAgICAgICAgY29uc3Qgb2JqZWN0ID0gYXJndW1lbnRzW2ldLCB1dWlkID0gb2JqZWN0LnV1aWQsIGluZGV4ID0gaW5kaWNlc0J5VVVJRFt1dWlkXTsKICAgICAgICBpZiAoaW5kZXggIT09IHZvaWQgMCkgewogICAgICAgICAgZGVsZXRlIGluZGljZXNCeVVVSURbdXVpZF07CiAgICAgICAgICBpZiAoaW5kZXggPCBuQ2FjaGVkT2JqZWN0cykgewogICAgICAgICAgICBjb25zdCBmaXJzdEFjdGl2ZUluZGV4ID0gLS1uQ2FjaGVkT2JqZWN0cywgbGFzdENhY2hlZE9iamVjdCA9IG9iamVjdHNbZmlyc3RBY3RpdmVJbmRleF0sIGxhc3RJbmRleCA9IC0tbk9iamVjdHMsIGxhc3RPYmplY3QgPSBvYmplY3RzW2xhc3RJbmRleF07CiAgICAgICAgICAgIGluZGljZXNCeVVVSURbbGFzdENhY2hlZE9iamVjdC51dWlkXSA9IGluZGV4OwogICAgICAgICAgICBvYmplY3RzW2luZGV4XSA9IGxhc3RDYWNoZWRPYmplY3Q7CiAgICAgICAgICAgIGluZGljZXNCeVVVSURbbGFzdE9iamVjdC51dWlkXSA9IGZpcnN0QWN0aXZlSW5kZXg7CiAgICAgICAgICAgIG9iamVjdHNbZmlyc3RBY3RpdmVJbmRleF0gPSBsYXN0T2JqZWN0OwogICAgICAgICAgICBvYmplY3RzLnBvcCgpOwogICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgbSA9IG5CaW5kaW5nczsgaiAhPT0gbTsgKytqKSB7CiAgICAgICAgICAgICAgY29uc3QgYmluZGluZ3NGb3JQYXRoID0gYmluZGluZ3Nbal0sIGxhc3RDYWNoZWQgPSBiaW5kaW5nc0ZvclBhdGhbZmlyc3RBY3RpdmVJbmRleF0sIGxhc3QgPSBiaW5kaW5nc0ZvclBhdGhbbGFzdEluZGV4XTsKICAgICAgICAgICAgICBiaW5kaW5nc0ZvclBhdGhbaW5kZXhdID0gbGFzdENhY2hlZDsKICAgICAgICAgICAgICBiaW5kaW5nc0ZvclBhdGhbZmlyc3RBY3RpdmVJbmRleF0gPSBsYXN0OwogICAgICAgICAgICAgIGJpbmRpbmdzRm9yUGF0aC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgbGFzdEluZGV4ID0gLS1uT2JqZWN0cywgbGFzdE9iamVjdCA9IG9iamVjdHNbbGFzdEluZGV4XTsKICAgICAgICAgICAgaWYgKGxhc3RJbmRleCA+IDApIHsKICAgICAgICAgICAgICBpbmRpY2VzQnlVVUlEW2xhc3RPYmplY3QudXVpZF0gPSBpbmRleDsKICAgICAgICAgICAgfQogICAgICAgICAgICBvYmplY3RzW2luZGV4XSA9IGxhc3RPYmplY3Q7CiAgICAgICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBtID0gbkJpbmRpbmdzOyBqICE9PSBtOyArK2opIHsKICAgICAgICAgICAgICBjb25zdCBiaW5kaW5nc0ZvclBhdGggPSBiaW5kaW5nc1tqXTsKICAgICAgICAgICAgICBiaW5kaW5nc0ZvclBhdGhbaW5kZXhdID0gYmluZGluZ3NGb3JQYXRoW2xhc3RJbmRleF07CiAgICAgICAgICAgICAgYmluZGluZ3NGb3JQYXRoLnBvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMubkNhY2hlZE9iamVjdHNfID0gbkNhY2hlZE9iamVjdHM7CiAgICB9CiAgICBzdWJzY3JpYmVfKHBhdGgsIHBhcnNlZFBhdGgpIHsKICAgICAgY29uc3QgaW5kaWNlc0J5UGF0aCA9IHRoaXMuX2JpbmRpbmdzSW5kaWNlc0J5UGF0aDsKICAgICAgbGV0IGluZGV4ID0gaW5kaWNlc0J5UGF0aFtwYXRoXTsKICAgICAgY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5nczsKICAgICAgaWYgKGluZGV4ICE9PSB2b2lkIDApCiAgICAgICAgcmV0dXJuIGJpbmRpbmdzW2luZGV4XTsKICAgICAgY29uc3QgcGF0aHMgPSB0aGlzLl9wYXRocywgcGFyc2VkUGF0aHMgPSB0aGlzLl9wYXJzZWRQYXRocywgb2JqZWN0cyA9IHRoaXMuX29iamVjdHMsIG5PYmplY3RzID0gb2JqZWN0cy5sZW5ndGgsIG5DYWNoZWRPYmplY3RzID0gdGhpcy5uQ2FjaGVkT2JqZWN0c18sIGJpbmRpbmdzRm9yUGF0aCA9IG5ldyBBcnJheShuT2JqZWN0cyk7CiAgICAgIGluZGV4ID0gYmluZGluZ3MubGVuZ3RoOwogICAgICBpbmRpY2VzQnlQYXRoW3BhdGhdID0gaW5kZXg7CiAgICAgIHBhdGhzLnB1c2gocGF0aCk7CiAgICAgIHBhcnNlZFBhdGhzLnB1c2gocGFyc2VkUGF0aCk7CiAgICAgIGJpbmRpbmdzLnB1c2goYmluZGluZ3NGb3JQYXRoKTsKICAgICAgZm9yIChsZXQgaSA9IG5DYWNoZWRPYmplY3RzLCBuID0gb2JqZWN0cy5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIGNvbnN0IG9iamVjdCA9IG9iamVjdHNbaV07CiAgICAgICAgYmluZGluZ3NGb3JQYXRoW2ldID0gbmV3IFByb3BlcnR5QmluZGluZyhvYmplY3QsIHBhdGgsIHBhcnNlZFBhdGgpOwogICAgICB9CiAgICAgIHJldHVybiBiaW5kaW5nc0ZvclBhdGg7CiAgICB9CiAgICB1bnN1YnNjcmliZV8ocGF0aCkgewogICAgICBjb25zdCBpbmRpY2VzQnlQYXRoID0gdGhpcy5fYmluZGluZ3NJbmRpY2VzQnlQYXRoLCBpbmRleCA9IGluZGljZXNCeVBhdGhbcGF0aF07CiAgICAgIGlmIChpbmRleCAhPT0gdm9pZCAwKSB7CiAgICAgICAgY29uc3QgcGF0aHMgPSB0aGlzLl9wYXRocywgcGFyc2VkUGF0aHMgPSB0aGlzLl9wYXJzZWRQYXRocywgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywgbGFzdEJpbmRpbmdzSW5kZXggPSBiaW5kaW5ncy5sZW5ndGggLSAxLCBsYXN0QmluZGluZ3MgPSBiaW5kaW5nc1tsYXN0QmluZGluZ3NJbmRleF0sIGxhc3RCaW5kaW5nc1BhdGggPSBwYXRoW2xhc3RCaW5kaW5nc0luZGV4XTsKICAgICAgICBpbmRpY2VzQnlQYXRoW2xhc3RCaW5kaW5nc1BhdGhdID0gaW5kZXg7CiAgICAgICAgYmluZGluZ3NbaW5kZXhdID0gbGFzdEJpbmRpbmdzOwogICAgICAgIGJpbmRpbmdzLnBvcCgpOwogICAgICAgIHBhcnNlZFBhdGhzW2luZGV4XSA9IHBhcnNlZFBhdGhzW2xhc3RCaW5kaW5nc0luZGV4XTsKICAgICAgICBwYXJzZWRQYXRocy5wb3AoKTsKICAgICAgICBwYXRoc1tpbmRleF0gPSBwYXRoc1tsYXN0QmluZGluZ3NJbmRleF07CiAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgIH0KICAgIH0KICB9OwogIEFuaW1hdGlvbk9iamVjdEdyb3VwLnByb3RvdHlwZS5pc0FuaW1hdGlvbk9iamVjdEdyb3VwID0gdHJ1ZTsKICB2YXIgQW5pbWF0aW9uQWN0aW9uID0gY2xhc3MgewogICAgY29uc3RydWN0b3IobWl4ZXIsIGNsaXAsIGxvY2FsUm9vdCA9IG51bGwsIGJsZW5kTW9kZSA9IGNsaXAuYmxlbmRNb2RlKSB7CiAgICAgIHRoaXMuX21peGVyID0gbWl4ZXI7CiAgICAgIHRoaXMuX2NsaXAgPSBjbGlwOwogICAgICB0aGlzLl9sb2NhbFJvb3QgPSBsb2NhbFJvb3Q7CiAgICAgIHRoaXMuYmxlbmRNb2RlID0gYmxlbmRNb2RlOwogICAgICBjb25zdCB0cmFja3MgPSBjbGlwLnRyYWNrcywgblRyYWNrcyA9IHRyYWNrcy5sZW5ndGgsIGludGVycG9sYW50cyA9IG5ldyBBcnJheShuVHJhY2tzKTsKICAgICAgY29uc3QgaW50ZXJwb2xhbnRTZXR0aW5ncyA9IHsKICAgICAgICBlbmRpbmdTdGFydDogWmVyb0N1cnZhdHVyZUVuZGluZywKICAgICAgICBlbmRpbmdFbmQ6IFplcm9DdXJ2YXR1cmVFbmRpbmcKICAgICAgfTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG5UcmFja3M7ICsraSkgewogICAgICAgIGNvbnN0IGludGVycG9sYW50ID0gdHJhY2tzW2ldLmNyZWF0ZUludGVycG9sYW50KG51bGwpOwogICAgICAgIGludGVycG9sYW50c1tpXSA9IGludGVycG9sYW50OwogICAgICAgIGludGVycG9sYW50LnNldHRpbmdzID0gaW50ZXJwb2xhbnRTZXR0aW5nczsKICAgICAgfQogICAgICB0aGlzLl9pbnRlcnBvbGFudFNldHRpbmdzID0gaW50ZXJwb2xhbnRTZXR0aW5nczsKICAgICAgdGhpcy5faW50ZXJwb2xhbnRzID0gaW50ZXJwb2xhbnRzOwogICAgICB0aGlzLl9wcm9wZXJ0eUJpbmRpbmdzID0gbmV3IEFycmF5KG5UcmFja3MpOwogICAgICB0aGlzLl9jYWNoZUluZGV4ID0gbnVsbDsKICAgICAgdGhpcy5fYnlDbGlwQ2FjaGVJbmRleCA9IG51bGw7CiAgICAgIHRoaXMuX3RpbWVTY2FsZUludGVycG9sYW50ID0gbnVsbDsKICAgICAgdGhpcy5fd2VpZ2h0SW50ZXJwb2xhbnQgPSBudWxsOwogICAgICB0aGlzLmxvb3AgPSBMb29wUmVwZWF0OwogICAgICB0aGlzLl9sb29wQ291bnQgPSAtMTsKICAgICAgdGhpcy5fc3RhcnRUaW1lID0gbnVsbDsKICAgICAgdGhpcy50aW1lID0gMDsKICAgICAgdGhpcy50aW1lU2NhbGUgPSAxOwogICAgICB0aGlzLl9lZmZlY3RpdmVUaW1lU2NhbGUgPSAxOwogICAgICB0aGlzLndlaWdodCA9IDE7CiAgICAgIHRoaXMuX2VmZmVjdGl2ZVdlaWdodCA9IDE7CiAgICAgIHRoaXMucmVwZXRpdGlvbnMgPSBJbmZpbml0eTsKICAgICAgdGhpcy5wYXVzZWQgPSBmYWxzZTsKICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5jbGFtcFdoZW5GaW5pc2hlZCA9IGZhbHNlOwogICAgICB0aGlzLnplcm9TbG9wZUF0U3RhcnQgPSB0cnVlOwogICAgICB0aGlzLnplcm9TbG9wZUF0RW5kID0gdHJ1ZTsKICAgIH0KICAgIHBsYXkoKSB7CiAgICAgIHRoaXMuX21peGVyLl9hY3RpdmF0ZUFjdGlvbih0aGlzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzdG9wKCkgewogICAgICB0aGlzLl9taXhlci5fZGVhY3RpdmF0ZUFjdGlvbih0aGlzKTsKICAgICAgcmV0dXJuIHRoaXMucmVzZXQoKTsKICAgIH0KICAgIHJlc2V0KCkgewogICAgICB0aGlzLnBhdXNlZCA9IGZhbHNlOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnRpbWUgPSAwOwogICAgICB0aGlzLl9sb29wQ291bnQgPSAtMTsKICAgICAgdGhpcy5fc3RhcnRUaW1lID0gbnVsbDsKICAgICAgcmV0dXJuIHRoaXMuc3RvcEZhZGluZygpLnN0b3BXYXJwaW5nKCk7CiAgICB9CiAgICBpc1J1bm5pbmcoKSB7CiAgICAgIHJldHVybiB0aGlzLmVuYWJsZWQgJiYgIXRoaXMucGF1c2VkICYmIHRoaXMudGltZVNjYWxlICE9PSAwICYmIHRoaXMuX3N0YXJ0VGltZSA9PT0gbnVsbCAmJiB0aGlzLl9taXhlci5faXNBY3RpdmVBY3Rpb24odGhpcyk7CiAgICB9CiAgICBpc1NjaGVkdWxlZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX21peGVyLl9pc0FjdGl2ZUFjdGlvbih0aGlzKTsKICAgIH0KICAgIHN0YXJ0QXQodGltZSkgewogICAgICB0aGlzLl9zdGFydFRpbWUgPSB0aW1lOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldExvb3AobW9kZSwgcmVwZXRpdGlvbnMpIHsKICAgICAgdGhpcy5sb29wID0gbW9kZTsKICAgICAgdGhpcy5yZXBldGl0aW9ucyA9IHJlcGV0aXRpb25zOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEVmZmVjdGl2ZVdlaWdodCh3ZWlnaHQpIHsKICAgICAgdGhpcy53ZWlnaHQgPSB3ZWlnaHQ7CiAgICAgIHRoaXMuX2VmZmVjdGl2ZVdlaWdodCA9IHRoaXMuZW5hYmxlZCA/IHdlaWdodCA6IDA7CiAgICAgIHJldHVybiB0aGlzLnN0b3BGYWRpbmcoKTsKICAgIH0KICAgIGdldEVmZmVjdGl2ZVdlaWdodCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdGl2ZVdlaWdodDsKICAgIH0KICAgIGZhZGVJbihkdXJhdGlvbikgewogICAgICByZXR1cm4gdGhpcy5fc2NoZWR1bGVGYWRpbmcoZHVyYXRpb24sIDAsIDEpOwogICAgfQogICAgZmFkZU91dChkdXJhdGlvbikgewogICAgICByZXR1cm4gdGhpcy5fc2NoZWR1bGVGYWRpbmcoZHVyYXRpb24sIDEsIDApOwogICAgfQogICAgY3Jvc3NGYWRlRnJvbShmYWRlT3V0QWN0aW9uLCBkdXJhdGlvbiwgd2FycCkgewogICAgICBmYWRlT3V0QWN0aW9uLmZhZGVPdXQoZHVyYXRpb24pOwogICAgICB0aGlzLmZhZGVJbihkdXJhdGlvbik7CiAgICAgIGlmICh3YXJwKSB7CiAgICAgICAgY29uc3QgZmFkZUluRHVyYXRpb24gPSB0aGlzLl9jbGlwLmR1cmF0aW9uLCBmYWRlT3V0RHVyYXRpb24gPSBmYWRlT3V0QWN0aW9uLl9jbGlwLmR1cmF0aW9uLCBzdGFydEVuZFJhdGlvID0gZmFkZU91dER1cmF0aW9uIC8gZmFkZUluRHVyYXRpb24sIGVuZFN0YXJ0UmF0aW8gPSBmYWRlSW5EdXJhdGlvbiAvIGZhZGVPdXREdXJhdGlvbjsKICAgICAgICBmYWRlT3V0QWN0aW9uLndhcnAoMSwgc3RhcnRFbmRSYXRpbywgZHVyYXRpb24pOwogICAgICAgIHRoaXMud2FycChlbmRTdGFydFJhdGlvLCAxLCBkdXJhdGlvbik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjcm9zc0ZhZGVUbyhmYWRlSW5BY3Rpb24sIGR1cmF0aW9uLCB3YXJwKSB7CiAgICAgIHJldHVybiBmYWRlSW5BY3Rpb24uY3Jvc3NGYWRlRnJvbSh0aGlzLCBkdXJhdGlvbiwgd2FycCk7CiAgICB9CiAgICBzdG9wRmFkaW5nKCkgewogICAgICBjb25zdCB3ZWlnaHRJbnRlcnBvbGFudCA9IHRoaXMuX3dlaWdodEludGVycG9sYW50OwogICAgICBpZiAod2VpZ2h0SW50ZXJwb2xhbnQgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl93ZWlnaHRJbnRlcnBvbGFudCA9IG51bGw7CiAgICAgICAgdGhpcy5fbWl4ZXIuX3Rha2VCYWNrQ29udHJvbEludGVycG9sYW50KHdlaWdodEludGVycG9sYW50KTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEVmZmVjdGl2ZVRpbWVTY2FsZSh0aW1lU2NhbGUpIHsKICAgICAgdGhpcy50aW1lU2NhbGUgPSB0aW1lU2NhbGU7CiAgICAgIHRoaXMuX2VmZmVjdGl2ZVRpbWVTY2FsZSA9IHRoaXMucGF1c2VkID8gMCA6IHRpbWVTY2FsZTsKICAgICAgcmV0dXJuIHRoaXMuc3RvcFdhcnBpbmcoKTsKICAgIH0KICAgIGdldEVmZmVjdGl2ZVRpbWVTY2FsZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdGl2ZVRpbWVTY2FsZTsKICAgIH0KICAgIHNldER1cmF0aW9uKGR1cmF0aW9uKSB7CiAgICAgIHRoaXMudGltZVNjYWxlID0gdGhpcy5fY2xpcC5kdXJhdGlvbiAvIGR1cmF0aW9uOwogICAgICByZXR1cm4gdGhpcy5zdG9wV2FycGluZygpOwogICAgfQogICAgc3luY1dpdGgoYWN0aW9uKSB7CiAgICAgIHRoaXMudGltZSA9IGFjdGlvbi50aW1lOwogICAgICB0aGlzLnRpbWVTY2FsZSA9IGFjdGlvbi50aW1lU2NhbGU7CiAgICAgIHJldHVybiB0aGlzLnN0b3BXYXJwaW5nKCk7CiAgICB9CiAgICBoYWx0KGR1cmF0aW9uKSB7CiAgICAgIHJldHVybiB0aGlzLndhcnAodGhpcy5fZWZmZWN0aXZlVGltZVNjYWxlLCAwLCBkdXJhdGlvbik7CiAgICB9CiAgICB3YXJwKHN0YXJ0VGltZVNjYWxlLCBlbmRUaW1lU2NhbGUsIGR1cmF0aW9uKSB7CiAgICAgIGNvbnN0IG1peGVyID0gdGhpcy5fbWl4ZXIsIG5vdyA9IG1peGVyLnRpbWUsIHRpbWVTY2FsZSA9IHRoaXMudGltZVNjYWxlOwogICAgICBsZXQgaW50ZXJwb2xhbnQgPSB0aGlzLl90aW1lU2NhbGVJbnRlcnBvbGFudDsKICAgICAgaWYgKGludGVycG9sYW50ID09PSBudWxsKSB7CiAgICAgICAgaW50ZXJwb2xhbnQgPSBtaXhlci5fbGVuZENvbnRyb2xJbnRlcnBvbGFudCgpOwogICAgICAgIHRoaXMuX3RpbWVTY2FsZUludGVycG9sYW50ID0gaW50ZXJwb2xhbnQ7CiAgICAgIH0KICAgICAgY29uc3QgdGltZXMgPSBpbnRlcnBvbGFudC5wYXJhbWV0ZXJQb3NpdGlvbnMsIHZhbHVlcyA9IGludGVycG9sYW50LnNhbXBsZVZhbHVlczsKICAgICAgdGltZXNbMF0gPSBub3c7CiAgICAgIHRpbWVzWzFdID0gbm93ICsgZHVyYXRpb247CiAgICAgIHZhbHVlc1swXSA9IHN0YXJ0VGltZVNjYWxlIC8gdGltZVNjYWxlOwogICAgICB2YWx1ZXNbMV0gPSBlbmRUaW1lU2NhbGUgLyB0aW1lU2NhbGU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc3RvcFdhcnBpbmcoKSB7CiAgICAgIGNvbnN0IHRpbWVTY2FsZUludGVycG9sYW50ID0gdGhpcy5fdGltZVNjYWxlSW50ZXJwb2xhbnQ7CiAgICAgIGlmICh0aW1lU2NhbGVJbnRlcnBvbGFudCAhPT0gbnVsbCkgewogICAgICAgIHRoaXMuX3RpbWVTY2FsZUludGVycG9sYW50ID0gbnVsbDsKICAgICAgICB0aGlzLl9taXhlci5fdGFrZUJhY2tDb250cm9sSW50ZXJwb2xhbnQodGltZVNjYWxlSW50ZXJwb2xhbnQpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZ2V0TWl4ZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLl9taXhlcjsKICAgIH0KICAgIGdldENsaXAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9jbGlwOwogICAgfQogICAgZ2V0Um9vdCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2xvY2FsUm9vdCB8fCB0aGlzLl9taXhlci5fcm9vdDsKICAgIH0KICAgIF91cGRhdGUodGltZSwgZGVsdGFUaW1lLCB0aW1lRGlyZWN0aW9uLCBhY2N1SW5kZXgpIHsKICAgICAgaWYgKCF0aGlzLmVuYWJsZWQpIHsKICAgICAgICB0aGlzLl91cGRhdGVXZWlnaHQodGltZSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHRoaXMuX3N0YXJ0VGltZTsKICAgICAgaWYgKHN0YXJ0VGltZSAhPT0gbnVsbCkgewogICAgICAgIGNvbnN0IHRpbWVSdW5uaW5nID0gKHRpbWUgLSBzdGFydFRpbWUpICogdGltZURpcmVjdGlvbjsKICAgICAgICBpZiAodGltZVJ1bm5pbmcgPCAwIHx8IHRpbWVEaXJlY3Rpb24gPT09IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5fc3RhcnRUaW1lID0gbnVsbDsKICAgICAgICBkZWx0YVRpbWUgPSB0aW1lRGlyZWN0aW9uICogdGltZVJ1bm5pbmc7CiAgICAgIH0KICAgICAgZGVsdGFUaW1lICo9IHRoaXMuX3VwZGF0ZVRpbWVTY2FsZSh0aW1lKTsKICAgICAgY29uc3QgY2xpcFRpbWUgPSB0aGlzLl91cGRhdGVUaW1lKGRlbHRhVGltZSk7CiAgICAgIGNvbnN0IHdlaWdodCA9IHRoaXMuX3VwZGF0ZVdlaWdodCh0aW1lKTsKICAgICAgaWYgKHdlaWdodCA+IDApIHsKICAgICAgICBjb25zdCBpbnRlcnBvbGFudHMgPSB0aGlzLl9pbnRlcnBvbGFudHM7CiAgICAgICAgY29uc3QgcHJvcGVydHlNaXhlcnMgPSB0aGlzLl9wcm9wZXJ0eUJpbmRpbmdzOwogICAgICAgIHN3aXRjaCAodGhpcy5ibGVuZE1vZGUpIHsKICAgICAgICAgIGNhc2UgQWRkaXRpdmVBbmltYXRpb25CbGVuZE1vZGU6CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBtID0gaW50ZXJwb2xhbnRzLmxlbmd0aDsgaiAhPT0gbTsgKytqKSB7CiAgICAgICAgICAgICAgaW50ZXJwb2xhbnRzW2pdLmV2YWx1YXRlKGNsaXBUaW1lKTsKICAgICAgICAgICAgICBwcm9wZXJ0eU1peGVyc1tqXS5hY2N1bXVsYXRlQWRkaXRpdmUod2VpZ2h0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgTm9ybWFsQW5pbWF0aW9uQmxlbmRNb2RlOgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIG0gPSBpbnRlcnBvbGFudHMubGVuZ3RoOyBqICE9PSBtOyArK2opIHsKICAgICAgICAgICAgICBpbnRlcnBvbGFudHNbal0uZXZhbHVhdGUoY2xpcFRpbWUpOwogICAgICAgICAgICAgIHByb3BlcnR5TWl4ZXJzW2pdLmFjY3VtdWxhdGUoYWNjdUluZGV4LCB3ZWlnaHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBfdXBkYXRlV2VpZ2h0KHRpbWUpIHsKICAgICAgbGV0IHdlaWdodCA9IDA7CiAgICAgIGlmICh0aGlzLmVuYWJsZWQpIHsKICAgICAgICB3ZWlnaHQgPSB0aGlzLndlaWdodDsKICAgICAgICBjb25zdCBpbnRlcnBvbGFudCA9IHRoaXMuX3dlaWdodEludGVycG9sYW50OwogICAgICAgIGlmIChpbnRlcnBvbGFudCAhPT0gbnVsbCkgewogICAgICAgICAgY29uc3QgaW50ZXJwb2xhbnRWYWx1ZSA9IGludGVycG9sYW50LmV2YWx1YXRlKHRpbWUpWzBdOwogICAgICAgICAgd2VpZ2h0ICo9IGludGVycG9sYW50VmFsdWU7CiAgICAgICAgICBpZiAodGltZSA+IGludGVycG9sYW50LnBhcmFtZXRlclBvc2l0aW9uc1sxXSkgewogICAgICAgICAgICB0aGlzLnN0b3BGYWRpbmcoKTsKICAgICAgICAgICAgaWYgKGludGVycG9sYW50VmFsdWUgPT09IDApIHsKICAgICAgICAgICAgICB0aGlzLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLl9lZmZlY3RpdmVXZWlnaHQgPSB3ZWlnaHQ7CiAgICAgIHJldHVybiB3ZWlnaHQ7CiAgICB9CiAgICBfdXBkYXRlVGltZVNjYWxlKHRpbWUpIHsKICAgICAgbGV0IHRpbWVTY2FsZSA9IDA7CiAgICAgIGlmICghdGhpcy5wYXVzZWQpIHsKICAgICAgICB0aW1lU2NhbGUgPSB0aGlzLnRpbWVTY2FsZTsKICAgICAgICBjb25zdCBpbnRlcnBvbGFudCA9IHRoaXMuX3RpbWVTY2FsZUludGVycG9sYW50OwogICAgICAgIGlmIChpbnRlcnBvbGFudCAhPT0gbnVsbCkgewogICAgICAgICAgY29uc3QgaW50ZXJwb2xhbnRWYWx1ZSA9IGludGVycG9sYW50LmV2YWx1YXRlKHRpbWUpWzBdOwogICAgICAgICAgdGltZVNjYWxlICo9IGludGVycG9sYW50VmFsdWU7CiAgICAgICAgICBpZiAodGltZSA+IGludGVycG9sYW50LnBhcmFtZXRlclBvc2l0aW9uc1sxXSkgewogICAgICAgICAgICB0aGlzLnN0b3BXYXJwaW5nKCk7CiAgICAgICAgICAgIGlmICh0aW1lU2NhbGUgPT09IDApIHsKICAgICAgICAgICAgICB0aGlzLnBhdXNlZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy50aW1lU2NhbGUgPSB0aW1lU2NhbGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5fZWZmZWN0aXZlVGltZVNjYWxlID0gdGltZVNjYWxlOwogICAgICByZXR1cm4gdGltZVNjYWxlOwogICAgfQogICAgX3VwZGF0ZVRpbWUoZGVsdGFUaW1lKSB7CiAgICAgIGNvbnN0IGR1cmF0aW9uID0gdGhpcy5fY2xpcC5kdXJhdGlvbjsKICAgICAgY29uc3QgbG9vcCA9IHRoaXMubG9vcDsKICAgICAgbGV0IHRpbWUgPSB0aGlzLnRpbWUgKyBkZWx0YVRpbWU7CiAgICAgIGxldCBsb29wQ291bnQgPSB0aGlzLl9sb29wQ291bnQ7CiAgICAgIGNvbnN0IHBpbmdQb25nID0gbG9vcCA9PT0gTG9vcFBpbmdQb25nOwogICAgICBpZiAoZGVsdGFUaW1lID09PSAwKSB7CiAgICAgICAgaWYgKGxvb3BDb3VudCA9PT0gLTEpCiAgICAgICAgICByZXR1cm4gdGltZTsKICAgICAgICByZXR1cm4gcGluZ1BvbmcgJiYgKGxvb3BDb3VudCAmIDEpID09PSAxID8gZHVyYXRpb24gLSB0aW1lIDogdGltZTsKICAgICAgfQogICAgICBpZiAobG9vcCA9PT0gTG9vcE9uY2UpIHsKICAgICAgICBpZiAobG9vcENvdW50ID09PSAtMSkgewogICAgICAgICAgdGhpcy5fbG9vcENvdW50ID0gMDsKICAgICAgICAgIHRoaXMuX3NldEVuZGluZ3ModHJ1ZSwgdHJ1ZSwgZmFsc2UpOwogICAgICAgIH0KICAgICAgICBoYW5kbGVfc3RvcDogewogICAgICAgICAgaWYgKHRpbWUgPj0gZHVyYXRpb24pIHsKICAgICAgICAgICAgdGltZSA9IGR1cmF0aW9uOwogICAgICAgICAgfSBlbHNlIGlmICh0aW1lIDwgMCkgewogICAgICAgICAgICB0aW1lID0gMDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudGltZSA9IHRpbWU7CiAgICAgICAgICAgIGJyZWFrIGhhbmRsZV9zdG9wOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuY2xhbXBXaGVuRmluaXNoZWQpCiAgICAgICAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTsKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnRpbWUgPSB0aW1lOwogICAgICAgICAgdGhpcy5fbWl4ZXIuZGlzcGF0Y2hFdmVudCh7CiAgICAgICAgICAgIHR5cGU6ICJmaW5pc2hlZCIsCiAgICAgICAgICAgIGFjdGlvbjogdGhpcywKICAgICAgICAgICAgZGlyZWN0aW9uOiBkZWx0YVRpbWUgPCAwID8gLTEgOiAxCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGxvb3BDb3VudCA9PT0gLTEpIHsKICAgICAgICAgIGlmIChkZWx0YVRpbWUgPj0gMCkgewogICAgICAgICAgICBsb29wQ291bnQgPSAwOwogICAgICAgICAgICB0aGlzLl9zZXRFbmRpbmdzKHRydWUsIHRoaXMucmVwZXRpdGlvbnMgPT09IDAsIHBpbmdQb25nKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3NldEVuZGluZ3ModGhpcy5yZXBldGl0aW9ucyA9PT0gMCwgdHJ1ZSwgcGluZ1BvbmcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGltZSA+PSBkdXJhdGlvbiB8fCB0aW1lIDwgMCkgewogICAgICAgICAgY29uc3QgbG9vcERlbHRhID0gTWF0aC5mbG9vcih0aW1lIC8gZHVyYXRpb24pOwogICAgICAgICAgdGltZSAtPSBkdXJhdGlvbiAqIGxvb3BEZWx0YTsKICAgICAgICAgIGxvb3BDb3VudCArPSBNYXRoLmFicyhsb29wRGVsdGEpOwogICAgICAgICAgY29uc3QgcGVuZGluZyA9IHRoaXMucmVwZXRpdGlvbnMgLSBsb29wQ291bnQ7CiAgICAgICAgICBpZiAocGVuZGluZyA8PSAwKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmNsYW1wV2hlbkZpbmlzaGVkKQogICAgICAgICAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICB0aW1lID0gZGVsdGFUaW1lID4gMCA/IGR1cmF0aW9uIDogMDsKICAgICAgICAgICAgdGhpcy50aW1lID0gdGltZTsKICAgICAgICAgICAgdGhpcy5fbWl4ZXIuZGlzcGF0Y2hFdmVudCh7CiAgICAgICAgICAgICAgdHlwZTogImZpbmlzaGVkIiwKICAgICAgICAgICAgICBhY3Rpb246IHRoaXMsCiAgICAgICAgICAgICAgZGlyZWN0aW9uOiBkZWx0YVRpbWUgPiAwID8gMSA6IC0xCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHBlbmRpbmcgPT09IDEpIHsKICAgICAgICAgICAgICBjb25zdCBhdFN0YXJ0ID0gZGVsdGFUaW1lIDwgMDsKICAgICAgICAgICAgICB0aGlzLl9zZXRFbmRpbmdzKGF0U3RhcnQsICFhdFN0YXJ0LCBwaW5nUG9uZyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5fc2V0RW5kaW5ncyhmYWxzZSwgZmFsc2UsIHBpbmdQb25nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9sb29wQ291bnQgPSBsb29wQ291bnQ7CiAgICAgICAgICAgIHRoaXMudGltZSA9IHRpbWU7CiAgICAgICAgICAgIHRoaXMuX21peGVyLmRpc3BhdGNoRXZlbnQoewogICAgICAgICAgICAgIHR5cGU6ICJsb29wIiwKICAgICAgICAgICAgICBhY3Rpb246IHRoaXMsCiAgICAgICAgICAgICAgbG9vcERlbHRhCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnRpbWUgPSB0aW1lOwogICAgICAgIH0KICAgICAgICBpZiAocGluZ1BvbmcgJiYgKGxvb3BDb3VudCAmIDEpID09PSAxKSB7CiAgICAgICAgICByZXR1cm4gZHVyYXRpb24gLSB0aW1lOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdGltZTsKICAgIH0KICAgIF9zZXRFbmRpbmdzKGF0U3RhcnQsIGF0RW5kLCBwaW5nUG9uZykgewogICAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMuX2ludGVycG9sYW50U2V0dGluZ3M7CiAgICAgIGlmIChwaW5nUG9uZykgewogICAgICAgIHNldHRpbmdzLmVuZGluZ1N0YXJ0ID0gWmVyb1Nsb3BlRW5kaW5nOwogICAgICAgIHNldHRpbmdzLmVuZGluZ0VuZCA9IFplcm9TbG9wZUVuZGluZzsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoYXRTdGFydCkgewogICAgICAgICAgc2V0dGluZ3MuZW5kaW5nU3RhcnQgPSB0aGlzLnplcm9TbG9wZUF0U3RhcnQgPyBaZXJvU2xvcGVFbmRpbmcgOiBaZXJvQ3VydmF0dXJlRW5kaW5nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZXR0aW5ncy5lbmRpbmdTdGFydCA9IFdyYXBBcm91bmRFbmRpbmc7CiAgICAgICAgfQogICAgICAgIGlmIChhdEVuZCkgewogICAgICAgICAgc2V0dGluZ3MuZW5kaW5nRW5kID0gdGhpcy56ZXJvU2xvcGVBdEVuZCA/IFplcm9TbG9wZUVuZGluZyA6IFplcm9DdXJ2YXR1cmVFbmRpbmc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNldHRpbmdzLmVuZGluZ0VuZCA9IFdyYXBBcm91bmRFbmRpbmc7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBfc2NoZWR1bGVGYWRpbmcoZHVyYXRpb24sIHdlaWdodE5vdywgd2VpZ2h0VGhlbikgewogICAgICBjb25zdCBtaXhlciA9IHRoaXMuX21peGVyLCBub3cgPSBtaXhlci50aW1lOwogICAgICBsZXQgaW50ZXJwb2xhbnQgPSB0aGlzLl93ZWlnaHRJbnRlcnBvbGFudDsKICAgICAgaWYgKGludGVycG9sYW50ID09PSBudWxsKSB7CiAgICAgICAgaW50ZXJwb2xhbnQgPSBtaXhlci5fbGVuZENvbnRyb2xJbnRlcnBvbGFudCgpOwogICAgICAgIHRoaXMuX3dlaWdodEludGVycG9sYW50ID0gaW50ZXJwb2xhbnQ7CiAgICAgIH0KICAgICAgY29uc3QgdGltZXMgPSBpbnRlcnBvbGFudC5wYXJhbWV0ZXJQb3NpdGlvbnMsIHZhbHVlcyA9IGludGVycG9sYW50LnNhbXBsZVZhbHVlczsKICAgICAgdGltZXNbMF0gPSBub3c7CiAgICAgIHZhbHVlc1swXSA9IHdlaWdodE5vdzsKICAgICAgdGltZXNbMV0gPSBub3cgKyBkdXJhdGlvbjsKICAgICAgdmFsdWVzWzFdID0gd2VpZ2h0VGhlbjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICB2YXIgQW5pbWF0aW9uTWl4ZXIgPSBjbGFzcyBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CiAgICBjb25zdHJ1Y3Rvcihyb290KSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuX3Jvb3QgPSByb290OwogICAgICB0aGlzLl9pbml0TWVtb3J5TWFuYWdlcigpOwogICAgICB0aGlzLl9hY2N1SW5kZXggPSAwOwogICAgICB0aGlzLnRpbWUgPSAwOwogICAgICB0aGlzLnRpbWVTY2FsZSA9IDE7CiAgICB9CiAgICBfYmluZEFjdGlvbihhY3Rpb24sIHByb3RvdHlwZUFjdGlvbikgewogICAgICBjb25zdCByb290ID0gYWN0aW9uLl9sb2NhbFJvb3QgfHwgdGhpcy5fcm9vdCwgdHJhY2tzID0gYWN0aW9uLl9jbGlwLnRyYWNrcywgblRyYWNrcyA9IHRyYWNrcy5sZW5ndGgsIGJpbmRpbmdzID0gYWN0aW9uLl9wcm9wZXJ0eUJpbmRpbmdzLCBpbnRlcnBvbGFudHMgPSBhY3Rpb24uX2ludGVycG9sYW50cywgcm9vdFV1aWQgPSByb290LnV1aWQsIGJpbmRpbmdzQnlSb290ID0gdGhpcy5fYmluZGluZ3NCeVJvb3RBbmROYW1lOwogICAgICBsZXQgYmluZGluZ3NCeU5hbWUgPSBiaW5kaW5nc0J5Um9vdFtyb290VXVpZF07CiAgICAgIGlmIChiaW5kaW5nc0J5TmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgYmluZGluZ3NCeU5hbWUgPSB7fTsKICAgICAgICBiaW5kaW5nc0J5Um9vdFtyb290VXVpZF0gPSBiaW5kaW5nc0J5TmFtZTsKICAgICAgfQogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gblRyYWNrczsgKytpKSB7CiAgICAgICAgY29uc3QgdHJhY2sgPSB0cmFja3NbaV0sIHRyYWNrTmFtZSA9IHRyYWNrLm5hbWU7CiAgICAgICAgbGV0IGJpbmRpbmcgPSBiaW5kaW5nc0J5TmFtZVt0cmFja05hbWVdOwogICAgICAgIGlmIChiaW5kaW5nICE9PSB2b2lkIDApIHsKICAgICAgICAgIGJpbmRpbmdzW2ldID0gYmluZGluZzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYmluZGluZyA9IGJpbmRpbmdzW2ldOwogICAgICAgICAgaWYgKGJpbmRpbmcgIT09IHZvaWQgMCkgewogICAgICAgICAgICBpZiAoYmluZGluZy5fY2FjaGVJbmRleCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICsrYmluZGluZy5yZWZlcmVuY2VDb3VudDsKICAgICAgICAgICAgICB0aGlzLl9hZGRJbmFjdGl2ZUJpbmRpbmcoYmluZGluZywgcm9vdFV1aWQsIHRyYWNrTmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBwYXRoID0gcHJvdG90eXBlQWN0aW9uICYmIHByb3RvdHlwZUFjdGlvbi5fcHJvcGVydHlCaW5kaW5nc1tpXS5iaW5kaW5nLnBhcnNlZFBhdGg7CiAgICAgICAgICBiaW5kaW5nID0gbmV3IFByb3BlcnR5TWl4ZXIoUHJvcGVydHlCaW5kaW5nLmNyZWF0ZShyb290LCB0cmFja05hbWUsIHBhdGgpLCB0cmFjay5WYWx1ZVR5cGVOYW1lLCB0cmFjay5nZXRWYWx1ZVNpemUoKSk7CiAgICAgICAgICArK2JpbmRpbmcucmVmZXJlbmNlQ291bnQ7CiAgICAgICAgICB0aGlzLl9hZGRJbmFjdGl2ZUJpbmRpbmcoYmluZGluZywgcm9vdFV1aWQsIHRyYWNrTmFtZSk7CiAgICAgICAgICBiaW5kaW5nc1tpXSA9IGJpbmRpbmc7CiAgICAgICAgfQogICAgICAgIGludGVycG9sYW50c1tpXS5yZXN1bHRCdWZmZXIgPSBiaW5kaW5nLmJ1ZmZlcjsKICAgICAgfQogICAgfQogICAgX2FjdGl2YXRlQWN0aW9uKGFjdGlvbikgewogICAgICBpZiAoIXRoaXMuX2lzQWN0aXZlQWN0aW9uKGFjdGlvbikpIHsKICAgICAgICBpZiAoYWN0aW9uLl9jYWNoZUluZGV4ID09PSBudWxsKSB7CiAgICAgICAgICBjb25zdCByb290VXVpZCA9IChhY3Rpb24uX2xvY2FsUm9vdCB8fCB0aGlzLl9yb290KS51dWlkLCBjbGlwVXVpZCA9IGFjdGlvbi5fY2xpcC51dWlkLCBhY3Rpb25zRm9yQ2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXBbY2xpcFV1aWRdOwogICAgICAgICAgdGhpcy5fYmluZEFjdGlvbihhY3Rpb24sIGFjdGlvbnNGb3JDbGlwICYmIGFjdGlvbnNGb3JDbGlwLmtub3duQWN0aW9uc1swXSk7CiAgICAgICAgICB0aGlzLl9hZGRJbmFjdGl2ZUFjdGlvbihhY3Rpb24sIGNsaXBVdWlkLCByb290VXVpZCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGJpbmRpbmdzID0gYWN0aW9uLl9wcm9wZXJ0eUJpbmRpbmdzOwogICAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gYmluZGluZ3MubGVuZ3RoOyBpICE9PSBuOyArK2kpIHsKICAgICAgICAgIGNvbnN0IGJpbmRpbmcgPSBiaW5kaW5nc1tpXTsKICAgICAgICAgIGlmIChiaW5kaW5nLnVzZUNvdW50KysgPT09IDApIHsKICAgICAgICAgICAgdGhpcy5fbGVuZEJpbmRpbmcoYmluZGluZyk7CiAgICAgICAgICAgIGJpbmRpbmcuc2F2ZU9yaWdpbmFsU3RhdGUoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5fbGVuZEFjdGlvbihhY3Rpb24pOwogICAgICB9CiAgICB9CiAgICBfZGVhY3RpdmF0ZUFjdGlvbihhY3Rpb24pIHsKICAgICAgaWYgKHRoaXMuX2lzQWN0aXZlQWN0aW9uKGFjdGlvbikpIHsKICAgICAgICBjb25zdCBiaW5kaW5ncyA9IGFjdGlvbi5fcHJvcGVydHlCaW5kaW5nczsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IGJpbmRpbmdzLmxlbmd0aDsgaSAhPT0gbjsgKytpKSB7CiAgICAgICAgICBjb25zdCBiaW5kaW5nID0gYmluZGluZ3NbaV07CiAgICAgICAgICBpZiAoLS1iaW5kaW5nLnVzZUNvdW50ID09PSAwKSB7CiAgICAgICAgICAgIGJpbmRpbmcucmVzdG9yZU9yaWdpbmFsU3RhdGUoKTsKICAgICAgICAgICAgdGhpcy5fdGFrZUJhY2tCaW5kaW5nKGJpbmRpbmcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLl90YWtlQmFja0FjdGlvbihhY3Rpb24pOwogICAgICB9CiAgICB9CiAgICBfaW5pdE1lbW9yeU1hbmFnZXIoKSB7CiAgICAgIHRoaXMuX2FjdGlvbnMgPSBbXTsKICAgICAgdGhpcy5fbkFjdGl2ZUFjdGlvbnMgPSAwOwogICAgICB0aGlzLl9hY3Rpb25zQnlDbGlwID0ge307CiAgICAgIHRoaXMuX2JpbmRpbmdzID0gW107CiAgICAgIHRoaXMuX25BY3RpdmVCaW5kaW5ncyA9IDA7CiAgICAgIHRoaXMuX2JpbmRpbmdzQnlSb290QW5kTmFtZSA9IHt9OwogICAgICB0aGlzLl9jb250cm9sSW50ZXJwb2xhbnRzID0gW107CiAgICAgIHRoaXMuX25BY3RpdmVDb250cm9sSW50ZXJwb2xhbnRzID0gMDsKICAgICAgY29uc3Qgc2NvcGUgPSB0aGlzOwogICAgICB0aGlzLnN0YXRzID0gewogICAgICAgIGFjdGlvbnM6IHsKICAgICAgICAgIGdldCB0b3RhbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHNjb3BlLl9hY3Rpb25zLmxlbmd0aDsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXQgaW5Vc2UoKSB7CiAgICAgICAgICAgIHJldHVybiBzY29wZS5fbkFjdGl2ZUFjdGlvbnM7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBiaW5kaW5nczogewogICAgICAgICAgZ2V0IHRvdGFsKCkgewogICAgICAgICAgICByZXR1cm4gc2NvcGUuX2JpbmRpbmdzLmxlbmd0aDsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXQgaW5Vc2UoKSB7CiAgICAgICAgICAgIHJldHVybiBzY29wZS5fbkFjdGl2ZUJpbmRpbmdzOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY29udHJvbEludGVycG9sYW50czogewogICAgICAgICAgZ2V0IHRvdGFsKCkgewogICAgICAgICAgICByZXR1cm4gc2NvcGUuX2NvbnRyb2xJbnRlcnBvbGFudHMubGVuZ3RoOwogICAgICAgICAgfSwKICAgICAgICAgIGdldCBpblVzZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHNjb3BlLl9uQWN0aXZlQ29udHJvbEludGVycG9sYW50czsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICBfaXNBY3RpdmVBY3Rpb24oYWN0aW9uKSB7CiAgICAgIGNvbnN0IGluZGV4ID0gYWN0aW9uLl9jYWNoZUluZGV4OwogICAgICByZXR1cm4gaW5kZXggIT09IG51bGwgJiYgaW5kZXggPCB0aGlzLl9uQWN0aXZlQWN0aW9uczsKICAgIH0KICAgIF9hZGRJbmFjdGl2ZUFjdGlvbihhY3Rpb24sIGNsaXBVdWlkLCByb290VXVpZCkgewogICAgICBjb25zdCBhY3Rpb25zID0gdGhpcy5fYWN0aW9ucywgYWN0aW9uc0J5Q2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXA7CiAgICAgIGxldCBhY3Rpb25zRm9yQ2xpcCA9IGFjdGlvbnNCeUNsaXBbY2xpcFV1aWRdOwogICAgICBpZiAoYWN0aW9uc0ZvckNsaXAgPT09IHZvaWQgMCkgewogICAgICAgIGFjdGlvbnNGb3JDbGlwID0gewogICAgICAgICAga25vd25BY3Rpb25zOiBbYWN0aW9uXSwKICAgICAgICAgIGFjdGlvbkJ5Um9vdDoge30KICAgICAgICB9OwogICAgICAgIGFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IDA7CiAgICAgICAgYWN0aW9uc0J5Q2xpcFtjbGlwVXVpZF0gPSBhY3Rpb25zRm9yQ2xpcDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBrbm93bkFjdGlvbnMgPSBhY3Rpb25zRm9yQ2xpcC5rbm93bkFjdGlvbnM7CiAgICAgICAgYWN0aW9uLl9ieUNsaXBDYWNoZUluZGV4ID0ga25vd25BY3Rpb25zLmxlbmd0aDsKICAgICAgICBrbm93bkFjdGlvbnMucHVzaChhY3Rpb24pOwogICAgICB9CiAgICAgIGFjdGlvbi5fY2FjaGVJbmRleCA9IGFjdGlvbnMubGVuZ3RoOwogICAgICBhY3Rpb25zLnB1c2goYWN0aW9uKTsKICAgICAgYWN0aW9uc0ZvckNsaXAuYWN0aW9uQnlSb290W3Jvb3RVdWlkXSA9IGFjdGlvbjsKICAgIH0KICAgIF9yZW1vdmVJbmFjdGl2ZUFjdGlvbihhY3Rpb24pIHsKICAgICAgY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsIGxhc3RJbmFjdGl2ZUFjdGlvbiA9IGFjdGlvbnNbYWN0aW9ucy5sZW5ndGggLSAxXSwgY2FjaGVJbmRleCA9IGFjdGlvbi5fY2FjaGVJbmRleDsKICAgICAgbGFzdEluYWN0aXZlQWN0aW9uLl9jYWNoZUluZGV4ID0gY2FjaGVJbmRleDsKICAgICAgYWN0aW9uc1tjYWNoZUluZGV4XSA9IGxhc3RJbmFjdGl2ZUFjdGlvbjsKICAgICAgYWN0aW9ucy5wb3AoKTsKICAgICAgYWN0aW9uLl9jYWNoZUluZGV4ID0gbnVsbDsKICAgICAgY29uc3QgY2xpcFV1aWQgPSBhY3Rpb24uX2NsaXAudXVpZCwgYWN0aW9uc0J5Q2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXAsIGFjdGlvbnNGb3JDbGlwID0gYWN0aW9uc0J5Q2xpcFtjbGlwVXVpZF0sIGtub3duQWN0aW9uc0ZvckNsaXAgPSBhY3Rpb25zRm9yQ2xpcC5rbm93bkFjdGlvbnMsIGxhc3RLbm93bkFjdGlvbiA9IGtub3duQWN0aW9uc0ZvckNsaXBba25vd25BY3Rpb25zRm9yQ2xpcC5sZW5ndGggLSAxXSwgYnlDbGlwQ2FjaGVJbmRleCA9IGFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleDsKICAgICAgbGFzdEtub3duQWN0aW9uLl9ieUNsaXBDYWNoZUluZGV4ID0gYnlDbGlwQ2FjaGVJbmRleDsKICAgICAga25vd25BY3Rpb25zRm9yQ2xpcFtieUNsaXBDYWNoZUluZGV4XSA9IGxhc3RLbm93bkFjdGlvbjsKICAgICAga25vd25BY3Rpb25zRm9yQ2xpcC5wb3AoKTsKICAgICAgYWN0aW9uLl9ieUNsaXBDYWNoZUluZGV4ID0gbnVsbDsKICAgICAgY29uc3QgYWN0aW9uQnlSb290ID0gYWN0aW9uc0ZvckNsaXAuYWN0aW9uQnlSb290LCByb290VXVpZCA9IChhY3Rpb24uX2xvY2FsUm9vdCB8fCB0aGlzLl9yb290KS51dWlkOwogICAgICBkZWxldGUgYWN0aW9uQnlSb290W3Jvb3RVdWlkXTsKICAgICAgaWYgKGtub3duQWN0aW9uc0ZvckNsaXAubGVuZ3RoID09PSAwKSB7CiAgICAgICAgZGVsZXRlIGFjdGlvbnNCeUNsaXBbY2xpcFV1aWRdOwogICAgICB9CiAgICAgIHRoaXMuX3JlbW92ZUluYWN0aXZlQmluZGluZ3NGb3JBY3Rpb24oYWN0aW9uKTsKICAgIH0KICAgIF9yZW1vdmVJbmFjdGl2ZUJpbmRpbmdzRm9yQWN0aW9uKGFjdGlvbikgewogICAgICBjb25zdCBiaW5kaW5ncyA9IGFjdGlvbi5fcHJvcGVydHlCaW5kaW5nczsKICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgIGNvbnN0IGJpbmRpbmcgPSBiaW5kaW5nc1tpXTsKICAgICAgICBpZiAoLS1iaW5kaW5nLnJlZmVyZW5jZUNvdW50ID09PSAwKSB7CiAgICAgICAgICB0aGlzLl9yZW1vdmVJbmFjdGl2ZUJpbmRpbmcoYmluZGluZyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBfbGVuZEFjdGlvbihhY3Rpb24pIHsKICAgICAgY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsIHByZXZJbmRleCA9IGFjdGlvbi5fY2FjaGVJbmRleCwgbGFzdEFjdGl2ZUluZGV4ID0gdGhpcy5fbkFjdGl2ZUFjdGlvbnMrKywgZmlyc3RJbmFjdGl2ZUFjdGlvbiA9IGFjdGlvbnNbbGFzdEFjdGl2ZUluZGV4XTsKICAgICAgYWN0aW9uLl9jYWNoZUluZGV4ID0gbGFzdEFjdGl2ZUluZGV4OwogICAgICBhY3Rpb25zW2xhc3RBY3RpdmVJbmRleF0gPSBhY3Rpb247CiAgICAgIGZpcnN0SW5hY3RpdmVBY3Rpb24uX2NhY2hlSW5kZXggPSBwcmV2SW5kZXg7CiAgICAgIGFjdGlvbnNbcHJldkluZGV4XSA9IGZpcnN0SW5hY3RpdmVBY3Rpb247CiAgICB9CiAgICBfdGFrZUJhY2tBY3Rpb24oYWN0aW9uKSB7CiAgICAgIGNvbnN0IGFjdGlvbnMgPSB0aGlzLl9hY3Rpb25zLCBwcmV2SW5kZXggPSBhY3Rpb24uX2NhY2hlSW5kZXgsIGZpcnN0SW5hY3RpdmVJbmRleCA9IC0tdGhpcy5fbkFjdGl2ZUFjdGlvbnMsIGxhc3RBY3RpdmVBY3Rpb24gPSBhY3Rpb25zW2ZpcnN0SW5hY3RpdmVJbmRleF07CiAgICAgIGFjdGlvbi5fY2FjaGVJbmRleCA9IGZpcnN0SW5hY3RpdmVJbmRleDsKICAgICAgYWN0aW9uc1tmaXJzdEluYWN0aXZlSW5kZXhdID0gYWN0aW9uOwogICAgICBsYXN0QWN0aXZlQWN0aW9uLl9jYWNoZUluZGV4ID0gcHJldkluZGV4OwogICAgICBhY3Rpb25zW3ByZXZJbmRleF0gPSBsYXN0QWN0aXZlQWN0aW9uOwogICAgfQogICAgX2FkZEluYWN0aXZlQmluZGluZyhiaW5kaW5nLCByb290VXVpZCwgdHJhY2tOYW1lKSB7CiAgICAgIGNvbnN0IGJpbmRpbmdzQnlSb290ID0gdGhpcy5fYmluZGluZ3NCeVJvb3RBbmROYW1lLCBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzOwogICAgICBsZXQgYmluZGluZ0J5TmFtZSA9IGJpbmRpbmdzQnlSb290W3Jvb3RVdWlkXTsKICAgICAgaWYgKGJpbmRpbmdCeU5hbWUgPT09IHZvaWQgMCkgewogICAgICAgIGJpbmRpbmdCeU5hbWUgPSB7fTsKICAgICAgICBiaW5kaW5nc0J5Um9vdFtyb290VXVpZF0gPSBiaW5kaW5nQnlOYW1lOwogICAgICB9CiAgICAgIGJpbmRpbmdCeU5hbWVbdHJhY2tOYW1lXSA9IGJpbmRpbmc7CiAgICAgIGJpbmRpbmcuX2NhY2hlSW5kZXggPSBiaW5kaW5ncy5sZW5ndGg7CiAgICAgIGJpbmRpbmdzLnB1c2goYmluZGluZyk7CiAgICB9CiAgICBfcmVtb3ZlSW5hY3RpdmVCaW5kaW5nKGJpbmRpbmcpIHsKICAgICAgY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywgcHJvcEJpbmRpbmcgPSBiaW5kaW5nLmJpbmRpbmcsIHJvb3RVdWlkID0gcHJvcEJpbmRpbmcucm9vdE5vZGUudXVpZCwgdHJhY2tOYW1lID0gcHJvcEJpbmRpbmcucGF0aCwgYmluZGluZ3NCeVJvb3QgPSB0aGlzLl9iaW5kaW5nc0J5Um9vdEFuZE5hbWUsIGJpbmRpbmdCeU5hbWUgPSBiaW5kaW5nc0J5Um9vdFtyb290VXVpZF0sIGxhc3RJbmFjdGl2ZUJpbmRpbmcgPSBiaW5kaW5nc1tiaW5kaW5ncy5sZW5ndGggLSAxXSwgY2FjaGVJbmRleCA9IGJpbmRpbmcuX2NhY2hlSW5kZXg7CiAgICAgIGxhc3RJbmFjdGl2ZUJpbmRpbmcuX2NhY2hlSW5kZXggPSBjYWNoZUluZGV4OwogICAgICBiaW5kaW5nc1tjYWNoZUluZGV4XSA9IGxhc3RJbmFjdGl2ZUJpbmRpbmc7CiAgICAgIGJpbmRpbmdzLnBvcCgpOwogICAgICBkZWxldGUgYmluZGluZ0J5TmFtZVt0cmFja05hbWVdOwogICAgICBpZiAoT2JqZWN0LmtleXMoYmluZGluZ0J5TmFtZSkubGVuZ3RoID09PSAwKSB7CiAgICAgICAgZGVsZXRlIGJpbmRpbmdzQnlSb290W3Jvb3RVdWlkXTsKICAgICAgfQogICAgfQogICAgX2xlbmRCaW5kaW5nKGJpbmRpbmcpIHsKICAgICAgY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywgcHJldkluZGV4ID0gYmluZGluZy5fY2FjaGVJbmRleCwgbGFzdEFjdGl2ZUluZGV4ID0gdGhpcy5fbkFjdGl2ZUJpbmRpbmdzKyssIGZpcnN0SW5hY3RpdmVCaW5kaW5nID0gYmluZGluZ3NbbGFzdEFjdGl2ZUluZGV4XTsKICAgICAgYmluZGluZy5fY2FjaGVJbmRleCA9IGxhc3RBY3RpdmVJbmRleDsKICAgICAgYmluZGluZ3NbbGFzdEFjdGl2ZUluZGV4XSA9IGJpbmRpbmc7CiAgICAgIGZpcnN0SW5hY3RpdmVCaW5kaW5nLl9jYWNoZUluZGV4ID0gcHJldkluZGV4OwogICAgICBiaW5kaW5nc1twcmV2SW5kZXhdID0gZmlyc3RJbmFjdGl2ZUJpbmRpbmc7CiAgICB9CiAgICBfdGFrZUJhY2tCaW5kaW5nKGJpbmRpbmcpIHsKICAgICAgY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywgcHJldkluZGV4ID0gYmluZGluZy5fY2FjaGVJbmRleCwgZmlyc3RJbmFjdGl2ZUluZGV4ID0gLS10aGlzLl9uQWN0aXZlQmluZGluZ3MsIGxhc3RBY3RpdmVCaW5kaW5nID0gYmluZGluZ3NbZmlyc3RJbmFjdGl2ZUluZGV4XTsKICAgICAgYmluZGluZy5fY2FjaGVJbmRleCA9IGZpcnN0SW5hY3RpdmVJbmRleDsKICAgICAgYmluZGluZ3NbZmlyc3RJbmFjdGl2ZUluZGV4XSA9IGJpbmRpbmc7CiAgICAgIGxhc3RBY3RpdmVCaW5kaW5nLl9jYWNoZUluZGV4ID0gcHJldkluZGV4OwogICAgICBiaW5kaW5nc1twcmV2SW5kZXhdID0gbGFzdEFjdGl2ZUJpbmRpbmc7CiAgICB9CiAgICBfbGVuZENvbnRyb2xJbnRlcnBvbGFudCgpIHsKICAgICAgY29uc3QgaW50ZXJwb2xhbnRzID0gdGhpcy5fY29udHJvbEludGVycG9sYW50cywgbGFzdEFjdGl2ZUluZGV4ID0gdGhpcy5fbkFjdGl2ZUNvbnRyb2xJbnRlcnBvbGFudHMrKzsKICAgICAgbGV0IGludGVycG9sYW50ID0gaW50ZXJwb2xhbnRzW2xhc3RBY3RpdmVJbmRleF07CiAgICAgIGlmIChpbnRlcnBvbGFudCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaW50ZXJwb2xhbnQgPSBuZXcgTGluZWFySW50ZXJwb2xhbnQobmV3IEZsb2F0MzJBcnJheSgyKSwgbmV3IEZsb2F0MzJBcnJheSgyKSwgMSwgdGhpcy5fY29udHJvbEludGVycG9sYW50c1Jlc3VsdEJ1ZmZlcik7CiAgICAgICAgaW50ZXJwb2xhbnQuX19jYWNoZUluZGV4ID0gbGFzdEFjdGl2ZUluZGV4OwogICAgICAgIGludGVycG9sYW50c1tsYXN0QWN0aXZlSW5kZXhdID0gaW50ZXJwb2xhbnQ7CiAgICAgIH0KICAgICAgcmV0dXJuIGludGVycG9sYW50OwogICAgfQogICAgX3Rha2VCYWNrQ29udHJvbEludGVycG9sYW50KGludGVycG9sYW50KSB7CiAgICAgIGNvbnN0IGludGVycG9sYW50cyA9IHRoaXMuX2NvbnRyb2xJbnRlcnBvbGFudHMsIHByZXZJbmRleCA9IGludGVycG9sYW50Ll9fY2FjaGVJbmRleCwgZmlyc3RJbmFjdGl2ZUluZGV4ID0gLS10aGlzLl9uQWN0aXZlQ29udHJvbEludGVycG9sYW50cywgbGFzdEFjdGl2ZUludGVycG9sYW50ID0gaW50ZXJwb2xhbnRzW2ZpcnN0SW5hY3RpdmVJbmRleF07CiAgICAgIGludGVycG9sYW50Ll9fY2FjaGVJbmRleCA9IGZpcnN0SW5hY3RpdmVJbmRleDsKICAgICAgaW50ZXJwb2xhbnRzW2ZpcnN0SW5hY3RpdmVJbmRleF0gPSBpbnRlcnBvbGFudDsKICAgICAgbGFzdEFjdGl2ZUludGVycG9sYW50Ll9fY2FjaGVJbmRleCA9IHByZXZJbmRleDsKICAgICAgaW50ZXJwb2xhbnRzW3ByZXZJbmRleF0gPSBsYXN0QWN0aXZlSW50ZXJwb2xhbnQ7CiAgICB9CiAgICBjbGlwQWN0aW9uKGNsaXAsIG9wdGlvbmFsUm9vdCwgYmxlbmRNb2RlKSB7CiAgICAgIGNvbnN0IHJvb3QgPSBvcHRpb25hbFJvb3QgfHwgdGhpcy5fcm9vdCwgcm9vdFV1aWQgPSByb290LnV1aWQ7CiAgICAgIGxldCBjbGlwT2JqZWN0ID0gdHlwZW9mIGNsaXAgPT09ICJzdHJpbmciID8gQW5pbWF0aW9uQ2xpcC5maW5kQnlOYW1lKHJvb3QsIGNsaXApIDogY2xpcDsKICAgICAgY29uc3QgY2xpcFV1aWQgPSBjbGlwT2JqZWN0ICE9PSBudWxsID8gY2xpcE9iamVjdC51dWlkIDogY2xpcDsKICAgICAgY29uc3QgYWN0aW9uc0ZvckNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwW2NsaXBVdWlkXTsKICAgICAgbGV0IHByb3RvdHlwZUFjdGlvbiA9IG51bGw7CiAgICAgIGlmIChibGVuZE1vZGUgPT09IHZvaWQgMCkgewogICAgICAgIGlmIChjbGlwT2JqZWN0ICE9PSBudWxsKSB7CiAgICAgICAgICBibGVuZE1vZGUgPSBjbGlwT2JqZWN0LmJsZW5kTW9kZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYmxlbmRNb2RlID0gTm9ybWFsQW5pbWF0aW9uQmxlbmRNb2RlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoYWN0aW9uc0ZvckNsaXAgIT09IHZvaWQgMCkgewogICAgICAgIGNvbnN0IGV4aXN0aW5nQWN0aW9uID0gYWN0aW9uc0ZvckNsaXAuYWN0aW9uQnlSb290W3Jvb3RVdWlkXTsKICAgICAgICBpZiAoZXhpc3RpbmdBY3Rpb24gIT09IHZvaWQgMCAmJiBleGlzdGluZ0FjdGlvbi5ibGVuZE1vZGUgPT09IGJsZW5kTW9kZSkgewogICAgICAgICAgcmV0dXJuIGV4aXN0aW5nQWN0aW9uOwogICAgICAgIH0KICAgICAgICBwcm90b3R5cGVBY3Rpb24gPSBhY3Rpb25zRm9yQ2xpcC5rbm93bkFjdGlvbnNbMF07CiAgICAgICAgaWYgKGNsaXBPYmplY3QgPT09IG51bGwpCiAgICAgICAgICBjbGlwT2JqZWN0ID0gcHJvdG90eXBlQWN0aW9uLl9jbGlwOwogICAgICB9CiAgICAgIGlmIChjbGlwT2JqZWN0ID09PSBudWxsKQogICAgICAgIHJldHVybiBudWxsOwogICAgICBjb25zdCBuZXdBY3Rpb24gPSBuZXcgQW5pbWF0aW9uQWN0aW9uKHRoaXMsIGNsaXBPYmplY3QsIG9wdGlvbmFsUm9vdCwgYmxlbmRNb2RlKTsKICAgICAgdGhpcy5fYmluZEFjdGlvbihuZXdBY3Rpb24sIHByb3RvdHlwZUFjdGlvbik7CiAgICAgIHRoaXMuX2FkZEluYWN0aXZlQWN0aW9uKG5ld0FjdGlvbiwgY2xpcFV1aWQsIHJvb3RVdWlkKTsKICAgICAgcmV0dXJuIG5ld0FjdGlvbjsKICAgIH0KICAgIGV4aXN0aW5nQWN0aW9uKGNsaXAsIG9wdGlvbmFsUm9vdCkgewogICAgICBjb25zdCByb290ID0gb3B0aW9uYWxSb290IHx8IHRoaXMuX3Jvb3QsIHJvb3RVdWlkID0gcm9vdC51dWlkLCBjbGlwT2JqZWN0ID0gdHlwZW9mIGNsaXAgPT09ICJzdHJpbmciID8gQW5pbWF0aW9uQ2xpcC5maW5kQnlOYW1lKHJvb3QsIGNsaXApIDogY2xpcCwgY2xpcFV1aWQgPSBjbGlwT2JqZWN0ID8gY2xpcE9iamVjdC51dWlkIDogY2xpcCwgYWN0aW9uc0ZvckNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwW2NsaXBVdWlkXTsKICAgICAgaWYgKGFjdGlvbnNGb3JDbGlwICE9PSB2b2lkIDApIHsKICAgICAgICByZXR1cm4gYWN0aW9uc0ZvckNsaXAuYWN0aW9uQnlSb290W3Jvb3RVdWlkXSB8fCBudWxsOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgc3RvcEFsbEFjdGlvbigpIHsKICAgICAgY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsIG5BY3Rpb25zID0gdGhpcy5fbkFjdGl2ZUFjdGlvbnM7CiAgICAgIGZvciAobGV0IGkgPSBuQWN0aW9ucyAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgYWN0aW9uc1tpXS5zdG9wKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB1cGRhdGUoZGVsdGFUaW1lKSB7CiAgICAgIGRlbHRhVGltZSAqPSB0aGlzLnRpbWVTY2FsZTsKICAgICAgY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsIG5BY3Rpb25zID0gdGhpcy5fbkFjdGl2ZUFjdGlvbnMsIHRpbWUgPSB0aGlzLnRpbWUgKz0gZGVsdGFUaW1lLCB0aW1lRGlyZWN0aW9uID0gTWF0aC5zaWduKGRlbHRhVGltZSksIGFjY3VJbmRleCA9IHRoaXMuX2FjY3VJbmRleCBePSAxOwogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbkFjdGlvbnM7ICsraSkgewogICAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbnNbaV07CiAgICAgICAgYWN0aW9uLl91cGRhdGUodGltZSwgZGVsdGFUaW1lLCB0aW1lRGlyZWN0aW9uLCBhY2N1SW5kZXgpOwogICAgICB9CiAgICAgIGNvbnN0IGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsIG5CaW5kaW5ncyA9IHRoaXMuX25BY3RpdmVCaW5kaW5nczsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG5CaW5kaW5nczsgKytpKSB7CiAgICAgICAgYmluZGluZ3NbaV0uYXBwbHkoYWNjdUluZGV4KTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldFRpbWUodGltZUluU2Vjb25kcykgewogICAgICB0aGlzLnRpbWUgPSAwOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2FjdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLl9hY3Rpb25zW2ldLnRpbWUgPSAwOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLnVwZGF0ZSh0aW1lSW5TZWNvbmRzKTsKICAgIH0KICAgIGdldFJvb3QoKSB7CiAgICAgIHJldHVybiB0aGlzLl9yb290OwogICAgfQogICAgdW5jYWNoZUNsaXAoY2xpcCkgewogICAgICBjb25zdCBhY3Rpb25zID0gdGhpcy5fYWN0aW9ucywgY2xpcFV1aWQgPSBjbGlwLnV1aWQsIGFjdGlvbnNCeUNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwLCBhY3Rpb25zRm9yQ2xpcCA9IGFjdGlvbnNCeUNsaXBbY2xpcFV1aWRdOwogICAgICBpZiAoYWN0aW9uc0ZvckNsaXAgIT09IHZvaWQgMCkgewogICAgICAgIGNvbnN0IGFjdGlvbnNUb1JlbW92ZSA9IGFjdGlvbnNGb3JDbGlwLmtub3duQWN0aW9uczsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IGFjdGlvbnNUb1JlbW92ZS5sZW5ndGg7IGkgIT09IG47ICsraSkgewogICAgICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uc1RvUmVtb3ZlW2ldOwogICAgICAgICAgdGhpcy5fZGVhY3RpdmF0ZUFjdGlvbihhY3Rpb24pOwogICAgICAgICAgY29uc3QgY2FjaGVJbmRleCA9IGFjdGlvbi5fY2FjaGVJbmRleCwgbGFzdEluYWN0aXZlQWN0aW9uID0gYWN0aW9uc1thY3Rpb25zLmxlbmd0aCAtIDFdOwogICAgICAgICAgYWN0aW9uLl9jYWNoZUluZGV4ID0gbnVsbDsKICAgICAgICAgIGFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IG51bGw7CiAgICAgICAgICBsYXN0SW5hY3RpdmVBY3Rpb24uX2NhY2hlSW5kZXggPSBjYWNoZUluZGV4OwogICAgICAgICAgYWN0aW9uc1tjYWNoZUluZGV4XSA9IGxhc3RJbmFjdGl2ZUFjdGlvbjsKICAgICAgICAgIGFjdGlvbnMucG9wKCk7CiAgICAgICAgICB0aGlzLl9yZW1vdmVJbmFjdGl2ZUJpbmRpbmdzRm9yQWN0aW9uKGFjdGlvbik7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBhY3Rpb25zQnlDbGlwW2NsaXBVdWlkXTsKICAgICAgfQogICAgfQogICAgdW5jYWNoZVJvb3Qocm9vdCkgewogICAgICBjb25zdCByb290VXVpZCA9IHJvb3QudXVpZCwgYWN0aW9uc0J5Q2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXA7CiAgICAgIGZvciAoY29uc3QgY2xpcFV1aWQgaW4gYWN0aW9uc0J5Q2xpcCkgewogICAgICAgIGNvbnN0IGFjdGlvbkJ5Um9vdCA9IGFjdGlvbnNCeUNsaXBbY2xpcFV1aWRdLmFjdGlvbkJ5Um9vdCwgYWN0aW9uID0gYWN0aW9uQnlSb290W3Jvb3RVdWlkXTsKICAgICAgICBpZiAoYWN0aW9uICE9PSB2b2lkIDApIHsKICAgICAgICAgIHRoaXMuX2RlYWN0aXZhdGVBY3Rpb24oYWN0aW9uKTsKICAgICAgICAgIHRoaXMuX3JlbW92ZUluYWN0aXZlQWN0aW9uKGFjdGlvbik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IGJpbmRpbmdzQnlSb290ID0gdGhpcy5fYmluZGluZ3NCeVJvb3RBbmROYW1lLCBiaW5kaW5nQnlOYW1lID0gYmluZGluZ3NCeVJvb3Rbcm9vdFV1aWRdOwogICAgICBpZiAoYmluZGluZ0J5TmFtZSAhPT0gdm9pZCAwKSB7CiAgICAgICAgZm9yIChjb25zdCB0cmFja05hbWUgaW4gYmluZGluZ0J5TmFtZSkgewogICAgICAgICAgY29uc3QgYmluZGluZyA9IGJpbmRpbmdCeU5hbWVbdHJhY2tOYW1lXTsKICAgICAgICAgIGJpbmRpbmcucmVzdG9yZU9yaWdpbmFsU3RhdGUoKTsKICAgICAgICAgIHRoaXMuX3JlbW92ZUluYWN0aXZlQmluZGluZyhiaW5kaW5nKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHVuY2FjaGVBY3Rpb24oY2xpcCwgb3B0aW9uYWxSb290KSB7CiAgICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuZXhpc3RpbmdBY3Rpb24oY2xpcCwgb3B0aW9uYWxSb290KTsKICAgICAgaWYgKGFjdGlvbiAhPT0gbnVsbCkgewogICAgICAgIHRoaXMuX2RlYWN0aXZhdGVBY3Rpb24oYWN0aW9uKTsKICAgICAgICB0aGlzLl9yZW1vdmVJbmFjdGl2ZUFjdGlvbihhY3Rpb24pOwogICAgICB9CiAgICB9CiAgfTsKICBBbmltYXRpb25NaXhlci5wcm90b3R5cGUuX2NvbnRyb2xJbnRlcnBvbGFudHNSZXN1bHRCdWZmZXIgPSBuZXcgRmxvYXQzMkFycmF5KDEpOwogIHZhciBVbmlmb3JtID0gY2xhc3MgewogICAgY29uc3RydWN0b3IodmFsdWUpIHsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLlVuaWZvcm06IFR5cGUgcGFyYW1ldGVyIGlzIG5vIGxvbmdlciBuZWVkZWQuIik7CiAgICAgICAgdmFsdWUgPSBhcmd1bWVudHNbMV07CiAgICAgIH0KICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgVW5pZm9ybSh0aGlzLnZhbHVlLmNsb25lID09PSB2b2lkIDAgPyB0aGlzLnZhbHVlIDogdGhpcy52YWx1ZS5jbG9uZSgpKTsKICAgIH0KICB9OwogIHZhciBJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciA9IGNsYXNzIGV4dGVuZHMgSW50ZXJsZWF2ZWRCdWZmZXIgewogICAgY29uc3RydWN0b3IoYXJyYXksIHN0cmlkZSwgbWVzaFBlckF0dHJpYnV0ZSA9IDEpIHsKICAgICAgc3VwZXIoYXJyYXksIHN0cmlkZSk7CiAgICAgIHRoaXMubWVzaFBlckF0dHJpYnV0ZSA9IG1lc2hQZXJBdHRyaWJ1dGU7CiAgICB9CiAgICBjb3B5KHNvdXJjZSkgewogICAgICBzdXBlci5jb3B5KHNvdXJjZSk7CiAgICAgIHRoaXMubWVzaFBlckF0dHJpYnV0ZSA9IHNvdXJjZS5tZXNoUGVyQXR0cmlidXRlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNsb25lKGRhdGEpIHsKICAgICAgY29uc3QgaWIgPSBzdXBlci5jbG9uZShkYXRhKTsKICAgICAgaWIubWVzaFBlckF0dHJpYnV0ZSA9IHRoaXMubWVzaFBlckF0dHJpYnV0ZTsKICAgICAgcmV0dXJuIGliOwogICAgfQogICAgdG9KU09OKGRhdGEpIHsKICAgICAgY29uc3QganNvbiA9IHN1cGVyLnRvSlNPTihkYXRhKTsKICAgICAganNvbi5pc0luc3RhbmNlZEludGVybGVhdmVkQnVmZmVyID0gdHJ1ZTsKICAgICAganNvbi5tZXNoUGVyQXR0cmlidXRlID0gdGhpcy5tZXNoUGVyQXR0cmlidXRlOwogICAgICByZXR1cm4ganNvbjsKICAgIH0KICB9OwogIEluc3RhbmNlZEludGVybGVhdmVkQnVmZmVyLnByb3RvdHlwZS5pc0luc3RhbmNlZEludGVybGVhdmVkQnVmZmVyID0gdHJ1ZTsKICB2YXIgR0xCdWZmZXJBdHRyaWJ1dGUgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihidWZmZXIsIHR5cGUsIGl0ZW1TaXplLCBlbGVtZW50U2l6ZSwgY291bnQpIHsKICAgICAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuaXRlbVNpemUgPSBpdGVtU2l6ZTsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IGVsZW1lbnRTaXplOwogICAgICB0aGlzLmNvdW50ID0gY291bnQ7CiAgICAgIHRoaXMudmVyc2lvbiA9IDA7CiAgICB9CiAgICBzZXQgbmVlZHNVcGRhdGUodmFsdWUpIHsKICAgICAgaWYgKHZhbHVlID09PSB0cnVlKQogICAgICAgIHRoaXMudmVyc2lvbisrOwogICAgfQogICAgc2V0QnVmZmVyKGJ1ZmZlcikgewogICAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRUeXBlKHR5cGUsIGVsZW1lbnRTaXplKSB7CiAgICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuZWxlbWVudFNpemUgPSBlbGVtZW50U2l6ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRJdGVtU2l6ZShpdGVtU2l6ZSkgewogICAgICB0aGlzLml0ZW1TaXplID0gaXRlbVNpemU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgc2V0Q291bnQoY291bnQpIHsKICAgICAgdGhpcy5jb3VudCA9IGNvdW50OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9OwogIEdMQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZS5pc0dMQnVmZmVyQXR0cmlidXRlID0gdHJ1ZTsKICB2YXIgX3ZlY3RvciQ0ID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IyKCk7CiAgdmFyIEJveDIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihtaW4gPSBuZXcgVmVjdG9yMihJbmZpbml0eSwgSW5maW5pdHkpLCBtYXggPSBuZXcgVmVjdG9yMigtSW5maW5pdHksIC1JbmZpbml0eSkpIHsKICAgICAgdGhpcy5taW4gPSBtaW47CiAgICAgIHRoaXMubWF4ID0gbWF4OwogICAgfQogICAgc2V0KG1pbiwgbWF4KSB7CiAgICAgIHRoaXMubWluLmNvcHkobWluKTsKICAgICAgdGhpcy5tYXguY29weShtYXgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHNldEZyb21Qb2ludHMocG9pbnRzKSB7CiAgICAgIHRoaXMubWFrZUVtcHR5KCk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgdGhpcy5leHBhbmRCeVBvaW50KHBvaW50c1tpXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBzZXRGcm9tQ2VudGVyQW5kU2l6ZShjZW50ZXIsIHNpemUpIHsKICAgICAgY29uc3QgaGFsZlNpemUgPSBfdmVjdG9yJDQuY29weShzaXplKS5tdWx0aXBseVNjYWxhcigwLjUpOwogICAgICB0aGlzLm1pbi5jb3B5KGNlbnRlcikuc3ViKGhhbGZTaXplKTsKICAgICAgdGhpcy5tYXguY29weShjZW50ZXIpLmFkZChoYWxmU2l6ZSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyk7CiAgICB9CiAgICBjb3B5KGJveCkgewogICAgICB0aGlzLm1pbi5jb3B5KGJveC5taW4pOwogICAgICB0aGlzLm1heC5jb3B5KGJveC5tYXgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIG1ha2VFbXB0eSgpIHsKICAgICAgdGhpcy5taW4ueCA9IHRoaXMubWluLnkgPSBJbmZpbml0eTsKICAgICAgdGhpcy5tYXgueCA9IHRoaXMubWF4LnkgPSAtSW5maW5pdHk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgaXNFbXB0eSgpIHsKICAgICAgcmV0dXJuIHRoaXMubWF4LnggPCB0aGlzLm1pbi54IHx8IHRoaXMubWF4LnkgPCB0aGlzLm1pbi55OwogICAgfQogICAgZ2V0Q2VudGVyKHRhcmdldCkgewogICAgICByZXR1cm4gdGhpcy5pc0VtcHR5KCkgPyB0YXJnZXQuc2V0KDAsIDApIDogdGFyZ2V0LmFkZFZlY3RvcnModGhpcy5taW4sIHRoaXMubWF4KS5tdWx0aXBseVNjYWxhcigwLjUpOwogICAgfQogICAgZ2V0U2l6ZSh0YXJnZXQpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNFbXB0eSgpID8gdGFyZ2V0LnNldCgwLCAwKSA6IHRhcmdldC5zdWJWZWN0b3JzKHRoaXMubWF4LCB0aGlzLm1pbik7CiAgICB9CiAgICBleHBhbmRCeVBvaW50KHBvaW50KSB7CiAgICAgIHRoaXMubWluLm1pbihwb2ludCk7CiAgICAgIHRoaXMubWF4Lm1heChwb2ludCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgZXhwYW5kQnlWZWN0b3IodmVjdG9yKSB7CiAgICAgIHRoaXMubWluLnN1Yih2ZWN0b3IpOwogICAgICB0aGlzLm1heC5hZGQodmVjdG9yKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBleHBhbmRCeVNjYWxhcihzY2FsYXIpIHsKICAgICAgdGhpcy5taW4uYWRkU2NhbGFyKC1zY2FsYXIpOwogICAgICB0aGlzLm1heC5hZGRTY2FsYXIoc2NhbGFyKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb250YWluc1BvaW50KHBvaW50KSB7CiAgICAgIHJldHVybiBwb2ludC54IDwgdGhpcy5taW4ueCB8fCBwb2ludC54ID4gdGhpcy5tYXgueCB8fCBwb2ludC55IDwgdGhpcy5taW4ueSB8fCBwb2ludC55ID4gdGhpcy5tYXgueSA/IGZhbHNlIDogdHJ1ZTsKICAgIH0KICAgIGNvbnRhaW5zQm94KGJveCkgewogICAgICByZXR1cm4gdGhpcy5taW4ueCA8PSBib3gubWluLnggJiYgYm94Lm1heC54IDw9IHRoaXMubWF4LnggJiYgdGhpcy5taW4ueSA8PSBib3gubWluLnkgJiYgYm94Lm1heC55IDw9IHRoaXMubWF4Lnk7CiAgICB9CiAgICBnZXRQYXJhbWV0ZXIocG9pbnQsIHRhcmdldCkgewogICAgICByZXR1cm4gdGFyZ2V0LnNldCgocG9pbnQueCAtIHRoaXMubWluLngpIC8gKHRoaXMubWF4LnggLSB0aGlzLm1pbi54KSwgKHBvaW50LnkgLSB0aGlzLm1pbi55KSAvICh0aGlzLm1heC55IC0gdGhpcy5taW4ueSkpOwogICAgfQogICAgaW50ZXJzZWN0c0JveChib3gpIHsKICAgICAgcmV0dXJuIGJveC5tYXgueCA8IHRoaXMubWluLnggfHwgYm94Lm1pbi54ID4gdGhpcy5tYXgueCB8fCBib3gubWF4LnkgPCB0aGlzLm1pbi55IHx8IGJveC5taW4ueSA+IHRoaXMubWF4LnkgPyBmYWxzZSA6IHRydWU7CiAgICB9CiAgICBjbGFtcFBvaW50KHBvaW50LCB0YXJnZXQpIHsKICAgICAgcmV0dXJuIHRhcmdldC5jb3B5KHBvaW50KS5jbGFtcCh0aGlzLm1pbiwgdGhpcy5tYXgpOwogICAgfQogICAgZGlzdGFuY2VUb1BvaW50KHBvaW50KSB7CiAgICAgIGNvbnN0IGNsYW1wZWRQb2ludCA9IF92ZWN0b3IkNC5jb3B5KHBvaW50KS5jbGFtcCh0aGlzLm1pbiwgdGhpcy5tYXgpOwogICAgICByZXR1cm4gY2xhbXBlZFBvaW50LnN1Yihwb2ludCkubGVuZ3RoKCk7CiAgICB9CiAgICBpbnRlcnNlY3QoYm94KSB7CiAgICAgIHRoaXMubWluLm1heChib3gubWluKTsKICAgICAgdGhpcy5tYXgubWluKGJveC5tYXgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHVuaW9uKGJveCkgewogICAgICB0aGlzLm1pbi5taW4oYm94Lm1pbik7CiAgICAgIHRoaXMubWF4Lm1heChib3gubWF4KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICB0cmFuc2xhdGUob2Zmc2V0KSB7CiAgICAgIHRoaXMubWluLmFkZChvZmZzZXQpOwogICAgICB0aGlzLm1heC5hZGQob2Zmc2V0KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBlcXVhbHMoYm94KSB7CiAgICAgIHJldHVybiBib3gubWluLmVxdWFscyh0aGlzLm1pbikgJiYgYm94Lm1heC5lcXVhbHModGhpcy5tYXgpOwogICAgfQogIH07CiAgQm94Mi5wcm90b3R5cGUuaXNCb3gyID0gdHJ1ZTsKICB2YXIgX3N0YXJ0UCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygpOwogIHZhciBfc3RhcnRFbmQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoKTsKICB2YXIgTGluZTMgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihzdGFydCA9IG5ldyBWZWN0b3IzKCksIGVuZCA9IG5ldyBWZWN0b3IzKCkpIHsKICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0OwogICAgICB0aGlzLmVuZCA9IGVuZDsKICAgIH0KICAgIHNldChzdGFydCwgZW5kKSB7CiAgICAgIHRoaXMuc3RhcnQuY29weShzdGFydCk7CiAgICAgIHRoaXMuZW5kLmNvcHkoZW5kKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb3B5KGxpbmUpIHsKICAgICAgdGhpcy5zdGFydC5jb3B5KGxpbmUuc3RhcnQpOwogICAgICB0aGlzLmVuZC5jb3B5KGxpbmUuZW5kKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBnZXRDZW50ZXIodGFyZ2V0KSB7CiAgICAgIHJldHVybiB0YXJnZXQuYWRkVmVjdG9ycyh0aGlzLnN0YXJ0LCB0aGlzLmVuZCkubXVsdGlwbHlTY2FsYXIoMC41KTsKICAgIH0KICAgIGRlbHRhKHRhcmdldCkgewogICAgICByZXR1cm4gdGFyZ2V0LnN1YlZlY3RvcnModGhpcy5lbmQsIHRoaXMuc3RhcnQpOwogICAgfQogICAgZGlzdGFuY2VTcSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUb1NxdWFyZWQodGhpcy5lbmQpOwogICAgfQogICAgZGlzdGFuY2UoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0YXJ0LmRpc3RhbmNlVG8odGhpcy5lbmQpOwogICAgfQogICAgYXQodCwgdGFyZ2V0KSB7CiAgICAgIHJldHVybiB0aGlzLmRlbHRhKHRhcmdldCkubXVsdGlwbHlTY2FsYXIodCkuYWRkKHRoaXMuc3RhcnQpOwogICAgfQogICAgY2xvc2VzdFBvaW50VG9Qb2ludFBhcmFtZXRlcihwb2ludCwgY2xhbXBUb0xpbmUpIHsKICAgICAgX3N0YXJ0UC5zdWJWZWN0b3JzKHBvaW50LCB0aGlzLnN0YXJ0KTsKICAgICAgX3N0YXJ0RW5kLnN1YlZlY3RvcnModGhpcy5lbmQsIHRoaXMuc3RhcnQpOwogICAgICBjb25zdCBzdGFydEVuZDIgPSBfc3RhcnRFbmQuZG90KF9zdGFydEVuZCk7CiAgICAgIGNvbnN0IHN0YXJ0RW5kX3N0YXJ0UCA9IF9zdGFydEVuZC5kb3QoX3N0YXJ0UCk7CiAgICAgIGxldCB0ID0gc3RhcnRFbmRfc3RhcnRQIC8gc3RhcnRFbmQyOwogICAgICBpZiAoY2xhbXBUb0xpbmUpIHsKICAgICAgICB0ID0gY2xhbXAodCwgMCwgMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHQ7CiAgICB9CiAgICBjbG9zZXN0UG9pbnRUb1BvaW50KHBvaW50LCBjbGFtcFRvTGluZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHQgPSB0aGlzLmNsb3Nlc3RQb2ludFRvUG9pbnRQYXJhbWV0ZXIocG9pbnQsIGNsYW1wVG9MaW5lKTsKICAgICAgcmV0dXJuIHRoaXMuZGVsdGEodGFyZ2V0KS5tdWx0aXBseVNjYWxhcih0KS5hZGQodGhpcy5zdGFydCk7CiAgICB9CiAgICBhcHBseU1hdHJpeDQobWF0cml4KSB7CiAgICAgIHRoaXMuc3RhcnQuYXBwbHlNYXRyaXg0KG1hdHJpeCk7CiAgICAgIHRoaXMuZW5kLmFwcGx5TWF0cml4NChtYXRyaXgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGVxdWFscyhsaW5lKSB7CiAgICAgIHJldHVybiBsaW5lLnN0YXJ0LmVxdWFscyh0aGlzLnN0YXJ0KSAmJiBsaW5lLmVuZC5lcXVhbHModGhpcy5lbmQpOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyk7CiAgICB9CiAgfTsKICB2YXIgSW1tZWRpYXRlUmVuZGVyT2JqZWN0ID0gY2xhc3MgZXh0ZW5kcyBPYmplY3QzRCB7CiAgICBjb25zdHJ1Y3RvcihtYXRlcmlhbCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7CiAgICAgIHRoaXMucmVuZGVyID0gZnVuY3Rpb24oKSB7CiAgICAgIH07CiAgICAgIHRoaXMuaGFzUG9zaXRpb25zID0gZmFsc2U7CiAgICAgIHRoaXMuaGFzTm9ybWFscyA9IGZhbHNlOwogICAgICB0aGlzLmhhc0NvbG9ycyA9IGZhbHNlOwogICAgICB0aGlzLmhhc1V2cyA9IGZhbHNlOwogICAgICB0aGlzLnBvc2l0aW9uQXJyYXkgPSBudWxsOwogICAgICB0aGlzLm5vcm1hbEFycmF5ID0gbnVsbDsKICAgICAgdGhpcy5jb2xvckFycmF5ID0gbnVsbDsKICAgICAgdGhpcy51dkFycmF5ID0gbnVsbDsKICAgICAgdGhpcy5jb3VudCA9IDA7CiAgICB9CiAgfTsKICBJbW1lZGlhdGVSZW5kZXJPYmplY3QucHJvdG90eXBlLmlzSW1tZWRpYXRlUmVuZGVyT2JqZWN0ID0gdHJ1ZTsKICB2YXIgX3ZlY3RvciQyID0gLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKCk7CiAgdmFyIF9ib25lTWF0cml4ID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXRyaXg0KCk7CiAgdmFyIF9tYXRyaXhXb3JsZEludiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWF0cml4NCgpOwogIHZhciBTa2VsZXRvbkhlbHBlciA9IGNsYXNzIGV4dGVuZHMgTGluZVNlZ21lbnRzIHsKICAgIGNvbnN0cnVjdG9yKG9iamVjdCkgewogICAgICBjb25zdCBib25lcyA9IGdldEJvbmVMaXN0KG9iamVjdCk7CiAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGNvbG9ycyA9IFtdOwogICAgICBjb25zdCBjb2xvcjEgPSBuZXcgQ29sb3IoMCwgMCwgMSk7CiAgICAgIGNvbnN0IGNvbG9yMiA9IG5ldyBDb2xvcigwLCAxLCAwKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib25lcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGJvbmUgPSBib25lc1tpXTsKICAgICAgICBpZiAoYm9uZS5wYXJlbnQgJiYgYm9uZS5wYXJlbnQuaXNCb25lKSB7CiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKDAsIDAsIDApOwogICAgICAgICAgdmVydGljZXMucHVzaCgwLCAwLCAwKTsKICAgICAgICAgIGNvbG9ycy5wdXNoKGNvbG9yMS5yLCBjb2xvcjEuZywgY29sb3IxLmIpOwogICAgICAgICAgY29sb3JzLnB1c2goY29sb3IyLnIsIGNvbG9yMi5nLCBjb2xvcjIuYik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGdlb21ldHJ5LnNldEF0dHJpYnV0ZSgicG9zaXRpb24iLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSh2ZXJ0aWNlcywgMykpOwogICAgICBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoImNvbG9yIiwgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoY29sb3JzLCAzKSk7CiAgICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKHsgdmVydGV4Q29sb3JzOiB0cnVlLCBkZXB0aFRlc3Q6IGZhbHNlLCBkZXB0aFdyaXRlOiBmYWxzZSwgdG9uZU1hcHBlZDogZmFsc2UsIHRyYW5zcGFyZW50OiB0cnVlIH0pOwogICAgICBzdXBlcihnZW9tZXRyeSwgbWF0ZXJpYWwpOwogICAgICB0aGlzLnR5cGUgPSAiU2tlbGV0b25IZWxwZXIiOwogICAgICB0aGlzLmlzU2tlbGV0b25IZWxwZXIgPSB0cnVlOwogICAgICB0aGlzLnJvb3QgPSBvYmplY3Q7CiAgICAgIHRoaXMuYm9uZXMgPSBib25lczsKICAgICAgdGhpcy5tYXRyaXggPSBvYmplY3QubWF0cml4V29ybGQ7CiAgICAgIHRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgdXBkYXRlTWF0cml4V29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgYm9uZXMgPSB0aGlzLmJvbmVzOwogICAgICBjb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CiAgICAgIGNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCJwb3NpdGlvbiIpOwogICAgICBfbWF0cml4V29ybGRJbnYuY29weSh0aGlzLnJvb3QubWF0cml4V29ybGQpLmludmVydCgpOwogICAgICBmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPCBib25lcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGJvbmUgPSBib25lc1tpXTsKICAgICAgICBpZiAoYm9uZS5wYXJlbnQgJiYgYm9uZS5wYXJlbnQuaXNCb25lKSB7CiAgICAgICAgICBfYm9uZU1hdHJpeC5tdWx0aXBseU1hdHJpY2VzKF9tYXRyaXhXb3JsZEludiwgYm9uZS5tYXRyaXhXb3JsZCk7CiAgICAgICAgICBfdmVjdG9yJDIuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKF9ib25lTWF0cml4KTsKICAgICAgICAgIHBvc2l0aW9uLnNldFhZWihqLCBfdmVjdG9yJDIueCwgX3ZlY3RvciQyLnksIF92ZWN0b3IkMi56KTsKICAgICAgICAgIF9ib25lTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoX21hdHJpeFdvcmxkSW52LCBib25lLnBhcmVudC5tYXRyaXhXb3JsZCk7CiAgICAgICAgICBfdmVjdG9yJDIuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKF9ib25lTWF0cml4KTsKICAgICAgICAgIHBvc2l0aW9uLnNldFhZWihqICsgMSwgX3ZlY3RvciQyLngsIF92ZWN0b3IkMi55LCBfdmVjdG9yJDIueik7CiAgICAgICAgICBqICs9IDI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGdlb21ldHJ5LmdldEF0dHJpYnV0ZSgicG9zaXRpb24iKS5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHN1cGVyLnVwZGF0ZU1hdHJpeFdvcmxkKGZvcmNlKTsKICAgIH0KICB9OwogIGZ1bmN0aW9uIGdldEJvbmVMaXN0KG9iamVjdCkgewogICAgY29uc3QgYm9uZUxpc3QgPSBbXTsKICAgIGlmIChvYmplY3QgJiYgb2JqZWN0LmlzQm9uZSkgewogICAgICBib25lTGlzdC5wdXNoKG9iamVjdCk7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9iamVjdC5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICBib25lTGlzdC5wdXNoLmFwcGx5KGJvbmVMaXN0LCBnZXRCb25lTGlzdChvYmplY3QuY2hpbGRyZW5baV0pKTsKICAgIH0KICAgIHJldHVybiBib25lTGlzdDsKICB9CiAgdmFyIEdyaWRIZWxwZXIgPSBjbGFzcyBleHRlbmRzIExpbmVTZWdtZW50cyB7CiAgICBjb25zdHJ1Y3RvcihzaXplID0gMTAsIGRpdmlzaW9ucyA9IDEwLCBjb2xvcjEgPSA0NDczOTI0LCBjb2xvcjIgPSA4OTQ3ODQ4KSB7CiAgICAgIGNvbG9yMSA9IG5ldyBDb2xvcihjb2xvcjEpOwogICAgICBjb2xvcjIgPSBuZXcgQ29sb3IoY29sb3IyKTsKICAgICAgY29uc3QgY2VudGVyID0gZGl2aXNpb25zIC8gMjsKICAgICAgY29uc3Qgc3RlcCA9IHNpemUgLyBkaXZpc2lvbnM7CiAgICAgIGNvbnN0IGhhbGZTaXplID0gc2l6ZSAvIDI7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW10sIGNvbG9ycyA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGsgPSAtaGFsZlNpemU7IGkgPD0gZGl2aXNpb25zOyBpKyssIGsgKz0gc3RlcCkgewogICAgICAgIHZlcnRpY2VzLnB1c2goLWhhbGZTaXplLCAwLCBrLCBoYWxmU2l6ZSwgMCwgayk7CiAgICAgICAgdmVydGljZXMucHVzaChrLCAwLCAtaGFsZlNpemUsIGssIDAsIGhhbGZTaXplKTsKICAgICAgICBjb25zdCBjb2xvciA9IGkgPT09IGNlbnRlciA/IGNvbG9yMSA6IGNvbG9yMjsKICAgICAgICBjb2xvci50b0FycmF5KGNvbG9ycywgaik7CiAgICAgICAgaiArPSAzOwogICAgICAgIGNvbG9yLnRvQXJyYXkoY29sb3JzLCBqKTsKICAgICAgICBqICs9IDM7CiAgICAgICAgY29sb3IudG9BcnJheShjb2xvcnMsIGopOwogICAgICAgIGogKz0gMzsKICAgICAgICBjb2xvci50b0FycmF5KGNvbG9ycywgaik7CiAgICAgICAgaiArPSAzOwogICAgICB9CiAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CiAgICAgIGdlb21ldHJ5LnNldEF0dHJpYnV0ZSgicG9zaXRpb24iLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSh2ZXJ0aWNlcywgMykpOwogICAgICBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoImNvbG9yIiwgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoY29sb3JzLCAzKSk7CiAgICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKHsgdmVydGV4Q29sb3JzOiB0cnVlLCB0b25lTWFwcGVkOiBmYWxzZSB9KTsKICAgICAgc3VwZXIoZ2VvbWV0cnksIG1hdGVyaWFsKTsKICAgICAgdGhpcy50eXBlID0gIkdyaWRIZWxwZXIiOwogICAgfQogIH07CiAgdmFyIF9mbG9hdFZpZXcgPSBuZXcgRmxvYXQzMkFycmF5KDEpOwogIHZhciBfaW50MzJWaWV3ID0gbmV3IEludDMyQXJyYXkoX2Zsb2F0Vmlldy5idWZmZXIpOwogIHZhciBMT0RfTUlOID0gNDsKICB2YXIgTE9EX01BWCA9IDg7CiAgdmFyIFNJWkVfTUFYID0gTWF0aC5wb3coMiwgTE9EX01BWCk7CiAgdmFyIEVYVFJBX0xPRF9TSUdNQSA9IFswLjEyNSwgMC4yMTUsIDAuMzUsIDAuNDQ2LCAwLjUyNiwgMC41ODJdOwogIHZhciBUT1RBTF9MT0RTID0gTE9EX01BWCAtIExPRF9NSU4gKyAxICsgRVhUUkFfTE9EX1NJR01BLmxlbmd0aDsKICB2YXIgRU5DT0RJTkdTID0gewogICAgW0xpbmVhckVuY29kaW5nXTogMCwKICAgIFtzUkdCRW5jb2RpbmddOiAxLAogICAgW1JHQkVFbmNvZGluZ106IDIsCiAgICBbUkdCTTdFbmNvZGluZ106IDMsCiAgICBbUkdCTTE2RW5jb2RpbmddOiA0LAogICAgW1JHQkRFbmNvZGluZ106IDUsCiAgICBbR2FtbWFFbmNvZGluZ106IDYKICB9OwogIHZhciBiYWNrZ3JvdW5kTWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoewogICAgc2lkZTogQmFja1NpZGUsCiAgICBkZXB0aFdyaXRlOiBmYWxzZSwKICAgIGRlcHRoVGVzdDogZmFsc2UKICB9KTsKICB2YXIgYmFja2dyb3VuZEJveCA9IG5ldyBNZXNoKG5ldyBCb3hHZW9tZXRyeSgpLCBiYWNrZ3JvdW5kTWF0ZXJpYWwpOwogIHZhciB7IF9sb2RQbGFuZXMsIF9zaXplTG9kcywgX3NpZ21hcyB9ID0gLyogQF9fUFVSRV9fICovIF9jcmVhdGVQbGFuZXMoKTsKICB2YXIgUEhJID0gKDEgKyBNYXRoLnNxcnQoNSkpIC8gMjsKICB2YXIgSU5WX1BISSA9IDEgLyBQSEk7CiAgdmFyIF9heGlzRGlyZWN0aW9ucyA9IFsKICAgIC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygxLCAxLCAxKSwKICAgIC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygtMSwgMSwgMSksCiAgICAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoMSwgMSwgLTEpLAogICAgLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKC0xLCAxLCAtMSksCiAgICAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoMCwgUEhJLCBJTlZfUEhJKSwKICAgIC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMygwLCBQSEksIC1JTlZfUEhJKSwKICAgIC8qIEBfX1BVUkVfXyAqLyBuZXcgVmVjdG9yMyhJTlZfUEhJLCAwLCBQSEkpLAogICAgLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKC1JTlZfUEhJLCAwLCBQSEkpLAogICAgLyogQF9fUFVSRV9fICovIG5ldyBWZWN0b3IzKFBISSwgSU5WX1BISSwgMCksCiAgICAvKiBAX19QVVJFX18gKi8gbmV3IFZlY3RvcjMoLVBISSwgSU5WX1BISSwgMCkKICBdOwogIGZ1bmN0aW9uIF9jcmVhdGVQbGFuZXMoKSB7CiAgICBjb25zdCBfbG9kUGxhbmVzMiA9IFtdOwogICAgY29uc3QgX3NpemVMb2RzMiA9IFtdOwogICAgY29uc3QgX3NpZ21hczIgPSBbXTsKICAgIGxldCBsb2QgPSBMT0RfTUFYOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBUT1RBTF9MT0RTOyBpKyspIHsKICAgICAgY29uc3Qgc2l6ZUxvZCA9IE1hdGgucG93KDIsIGxvZCk7CiAgICAgIF9zaXplTG9kczIucHVzaChzaXplTG9kKTsKICAgICAgbGV0IHNpZ21hID0gMSAvIHNpemVMb2Q7CiAgICAgIGlmIChpID4gTE9EX01BWCAtIExPRF9NSU4pIHsKICAgICAgICBzaWdtYSA9IEVYVFJBX0xPRF9TSUdNQVtpIC0gTE9EX01BWCArIExPRF9NSU4gLSAxXTsKICAgICAgfSBlbHNlIGlmIChpID09IDApIHsKICAgICAgICBzaWdtYSA9IDA7CiAgICAgIH0KICAgICAgX3NpZ21hczIucHVzaChzaWdtYSk7CiAgICAgIGNvbnN0IHRleGVsU2l6ZSA9IDEgLyAoc2l6ZUxvZCAtIDEpOwogICAgICBjb25zdCBtaW4gPSAtdGV4ZWxTaXplIC8gMjsKICAgICAgY29uc3QgbWF4ID0gMSArIHRleGVsU2l6ZSAvIDI7CiAgICAgIGNvbnN0IHV2MSA9IFttaW4sIG1pbiwgbWF4LCBtaW4sIG1heCwgbWF4LCBtaW4sIG1pbiwgbWF4LCBtYXgsIG1pbiwgbWF4XTsKICAgICAgY29uc3QgY3ViZUZhY2VzID0gNjsKICAgICAgY29uc3QgdmVydGljZXMgPSA2OwogICAgICBjb25zdCBwb3NpdGlvblNpemUgPSAzOwogICAgICBjb25zdCB1dlNpemUgPSAyOwogICAgICBjb25zdCBmYWNlSW5kZXhTaXplID0gMTsKICAgICAgY29uc3QgcG9zaXRpb24gPSBuZXcgRmxvYXQzMkFycmF5KHBvc2l0aW9uU2l6ZSAqIHZlcnRpY2VzICogY3ViZUZhY2VzKTsKICAgICAgY29uc3QgdXYgPSBuZXcgRmxvYXQzMkFycmF5KHV2U2l6ZSAqIHZlcnRpY2VzICogY3ViZUZhY2VzKTsKICAgICAgY29uc3QgZmFjZUluZGV4ID0gbmV3IEZsb2F0MzJBcnJheShmYWNlSW5kZXhTaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMpOwogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGN1YmVGYWNlczsgZmFjZSsrKSB7CiAgICAgICAgY29uc3QgeCA9IGZhY2UgJSAzICogMiAvIDMgLSAxOwogICAgICAgIGNvbnN0IHkgPSBmYWNlID4gMiA/IDAgOiAtMTsKICAgICAgICBjb25zdCBjb29yZGluYXRlcyA9IFsKICAgICAgICAgIHgsCiAgICAgICAgICB5LAogICAgICAgICAgMCwKICAgICAgICAgIHggKyAyIC8gMywKICAgICAgICAgIHksCiAgICAgICAgICAwLAogICAgICAgICAgeCArIDIgLyAzLAogICAgICAgICAgeSArIDEsCiAgICAgICAgICAwLAogICAgICAgICAgeCwKICAgICAgICAgIHksCiAgICAgICAgICAwLAogICAgICAgICAgeCArIDIgLyAzLAogICAgICAgICAgeSArIDEsCiAgICAgICAgICAwLAogICAgICAgICAgeCwKICAgICAgICAgIHkgKyAxLAogICAgICAgICAgMAogICAgICAgIF07CiAgICAgICAgcG9zaXRpb24uc2V0KGNvb3JkaW5hdGVzLCBwb3NpdGlvblNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UpOwogICAgICAgIHV2LnNldCh1djEsIHV2U2l6ZSAqIHZlcnRpY2VzICogZmFjZSk7CiAgICAgICAgY29uc3QgZmlsbCA9IFtmYWNlLCBmYWNlLCBmYWNlLCBmYWNlLCBmYWNlLCBmYWNlXTsKICAgICAgICBmYWNlSW5kZXguc2V0KGZpbGwsIGZhY2VJbmRleFNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UpOwogICAgICB9CiAgICAgIGNvbnN0IHBsYW5lcyA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwogICAgICBwbGFuZXMuc2V0QXR0cmlidXRlKCJwb3NpdGlvbiIsIG5ldyBCdWZmZXJBdHRyaWJ1dGUocG9zaXRpb24sIHBvc2l0aW9uU2l6ZSkpOwogICAgICBwbGFuZXMuc2V0QXR0cmlidXRlKCJ1diIsIG5ldyBCdWZmZXJBdHRyaWJ1dGUodXYsIHV2U2l6ZSkpOwogICAgICBwbGFuZXMuc2V0QXR0cmlidXRlKCJmYWNlSW5kZXgiLCBuZXcgQnVmZmVyQXR0cmlidXRlKGZhY2VJbmRleCwgZmFjZUluZGV4U2l6ZSkpOwogICAgICBfbG9kUGxhbmVzMi5wdXNoKHBsYW5lcyk7CiAgICAgIGlmIChsb2QgPiBMT0RfTUlOKSB7CiAgICAgICAgbG9kLS07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IF9sb2RQbGFuZXM6IF9sb2RQbGFuZXMyLCBfc2l6ZUxvZHM6IF9zaXplTG9kczIsIF9zaWdtYXM6IF9zaWdtYXMyIH07CiAgfQogIEN1cnZlLmNyZWF0ZSA9IGZ1bmN0aW9uKGNvbnN0cnVjdCwgZ2V0UG9pbnQpIHsKICAgIGNvbnNvbGUubG9nKCJUSFJFRS5DdXJ2ZS5jcmVhdGUoKSBoYXMgYmVlbiBkZXByZWNhdGVkIik7CiAgICBjb25zdHJ1Y3QucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDdXJ2ZS5wcm90b3R5cGUpOwogICAgY29uc3RydWN0LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGNvbnN0cnVjdDsKICAgIGNvbnN0cnVjdC5wcm90b3R5cGUuZ2V0UG9pbnQgPSBnZXRQb2ludDsKICAgIHJldHVybiBjb25zdHJ1Y3Q7CiAgfTsKICBQYXRoLnByb3RvdHlwZS5mcm9tUG9pbnRzID0gZnVuY3Rpb24ocG9pbnRzKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLlBhdGg6IC5mcm9tUG9pbnRzKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuc2V0RnJvbVBvaW50cygpLiIpOwogICAgcmV0dXJuIHRoaXMuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogIH07CiAgR3JpZEhlbHBlci5wcm90b3R5cGUuc2V0Q29sb3JzID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5HcmlkSGVscGVyOiBzZXRDb2xvcnMoKSBoYXMgYmVlbiBkZXByZWNhdGVkLCBwYXNzIHRoZW0gaW4gdGhlIGNvbnN0cnVjdG9yIGluc3RlYWQuIik7CiAgfTsKICBTa2VsZXRvbkhlbHBlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5Ta2VsZXRvbkhlbHBlcjogdXBkYXRlKCkgbm8gbG9uZ2VyIG5lZWRzIHRvIGJlIGNhbGxlZC4iKTsKICB9OwogIExvYWRlci5wcm90b3R5cGUuZXh0cmFjdFVybEJhc2UgPSBmdW5jdGlvbih1cmwpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuTG9hZGVyOiAuZXh0cmFjdFVybEJhc2UoKSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgVEhSRUUuTG9hZGVyVXRpbHMuZXh0cmFjdFVybEJhc2UoKSBpbnN0ZWFkLiIpOwogICAgcmV0dXJuIExvYWRlclV0aWxzLmV4dHJhY3RVcmxCYXNlKHVybCk7CiAgfTsKICBMb2FkZXIuSGFuZGxlcnMgPSB7CiAgICBhZGQ6IGZ1bmN0aW9uKCkgewogICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5Mb2FkZXI6IEhhbmRsZXJzLmFkZCgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBMb2FkaW5nTWFuYWdlci5hZGRIYW5kbGVyKCkgaW5zdGVhZC4iKTsKICAgIH0sCiAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5Mb2FkZXI6IEhhbmRsZXJzLmdldCgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBMb2FkaW5nTWFuYWdlci5nZXRIYW5kbGVyKCkgaW5zdGVhZC4iKTsKICAgIH0KICB9OwogIEJveDIucHJvdG90eXBlLmNlbnRlciA9IGZ1bmN0aW9uKG9wdGlvbmFsVGFyZ2V0KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJveDI6IC5jZW50ZXIoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRDZW50ZXIoKS4iKTsKICAgIHJldHVybiB0aGlzLmdldENlbnRlcihvcHRpb25hbFRhcmdldCk7CiAgfTsKICBCb3gyLnByb3RvdHlwZS5lbXB0eSA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5Cb3gyOiAuZW1wdHkoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pc0VtcHR5KCkuIik7CiAgICByZXR1cm4gdGhpcy5pc0VtcHR5KCk7CiAgfTsKICBCb3gyLnByb3RvdHlwZS5pc0ludGVyc2VjdGlvbkJveCA9IGZ1bmN0aW9uKGJveCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5Cb3gyOiAuaXNJbnRlcnNlY3Rpb25Cb3goKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pbnRlcnNlY3RzQm94KCkuIik7CiAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3RzQm94KGJveCk7CiAgfTsKICBCb3gyLnByb3RvdHlwZS5zaXplID0gZnVuY3Rpb24ob3B0aW9uYWxUYXJnZXQpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuQm94MjogLnNpemUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRTaXplKCkuIik7CiAgICByZXR1cm4gdGhpcy5nZXRTaXplKG9wdGlvbmFsVGFyZ2V0KTsKICB9OwogIEJveDMucHJvdG90eXBlLmNlbnRlciA9IGZ1bmN0aW9uKG9wdGlvbmFsVGFyZ2V0KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJveDM6IC5jZW50ZXIoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRDZW50ZXIoKS4iKTsKICAgIHJldHVybiB0aGlzLmdldENlbnRlcihvcHRpb25hbFRhcmdldCk7CiAgfTsKICBCb3gzLnByb3RvdHlwZS5lbXB0eSA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5Cb3gzOiAuZW1wdHkoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pc0VtcHR5KCkuIik7CiAgICByZXR1cm4gdGhpcy5pc0VtcHR5KCk7CiAgfTsKICBCb3gzLnByb3RvdHlwZS5pc0ludGVyc2VjdGlvbkJveCA9IGZ1bmN0aW9uKGJveCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5Cb3gzOiAuaXNJbnRlcnNlY3Rpb25Cb3goKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pbnRlcnNlY3RzQm94KCkuIik7CiAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3RzQm94KGJveCk7CiAgfTsKICBCb3gzLnByb3RvdHlwZS5pc0ludGVyc2VjdGlvblNwaGVyZSA9IGZ1bmN0aW9uKHNwaGVyZSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5Cb3gzOiAuaXNJbnRlcnNlY3Rpb25TcGhlcmUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pbnRlcnNlY3RzU3BoZXJlKCkuIik7CiAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3RzU3BoZXJlKHNwaGVyZSk7CiAgfTsKICBCb3gzLnByb3RvdHlwZS5zaXplID0gZnVuY3Rpb24ob3B0aW9uYWxUYXJnZXQpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuQm94MzogLnNpemUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRTaXplKCkuIik7CiAgICByZXR1cm4gdGhpcy5nZXRTaXplKG9wdGlvbmFsVGFyZ2V0KTsKICB9OwogIFNwaGVyZS5wcm90b3R5cGUuZW1wdHkgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuU3BoZXJlOiAuZW1wdHkoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pc0VtcHR5KCkuIik7CiAgICByZXR1cm4gdGhpcy5pc0VtcHR5KCk7CiAgfTsKICBGcnVzdHVtLnByb3RvdHlwZS5zZXRGcm9tTWF0cml4ID0gZnVuY3Rpb24obSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5GcnVzdHVtOiAuc2V0RnJvbU1hdHJpeCgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KCkuIik7CiAgICByZXR1cm4gdGhpcy5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeChtKTsKICB9OwogIExpbmUzLnByb3RvdHlwZS5jZW50ZXIgPSBmdW5jdGlvbihvcHRpb25hbFRhcmdldCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5MaW5lMzogLmNlbnRlcigpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmdldENlbnRlcigpLiIpOwogICAgcmV0dXJuIHRoaXMuZ2V0Q2VudGVyKG9wdGlvbmFsVGFyZ2V0KTsKICB9OwogIE1hdHJpeDMucHJvdG90eXBlLmZsYXR0ZW5Ub0FycmF5T2Zmc2V0ID0gZnVuY3Rpb24oYXJyYXksIG9mZnNldCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5NYXRyaXgzOiAuZmxhdHRlblRvQXJyYXlPZmZzZXQoKSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgLnRvQXJyYXkoKSBpbnN0ZWFkLiIpOwogICAgcmV0dXJuIHRoaXMudG9BcnJheShhcnJheSwgb2Zmc2V0KTsKICB9OwogIE1hdHJpeDMucHJvdG90eXBlLm11bHRpcGx5VmVjdG9yMyA9IGZ1bmN0aW9uKHZlY3RvcikgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5NYXRyaXgzOiAubXVsdGlwbHlWZWN0b3IzKCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIHZlY3Rvci5hcHBseU1hdHJpeDMoIG1hdHJpeCApIGluc3RlYWQuIik7CiAgICByZXR1cm4gdmVjdG9yLmFwcGx5TWF0cml4Myh0aGlzKTsKICB9OwogIE1hdHJpeDMucHJvdG90eXBlLm11bHRpcGx5VmVjdG9yM0FycmF5ID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5NYXRyaXgzOiAubXVsdGlwbHlWZWN0b3IzQXJyYXkoKSBoYXMgYmVlbiByZW1vdmVkLiIpOwogIH07CiAgTWF0cml4My5wcm90b3R5cGUuYXBwbHlUb0J1ZmZlckF0dHJpYnV0ZSA9IGZ1bmN0aW9uKGF0dHJpYnV0ZSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5NYXRyaXgzOiAuYXBwbHlUb0J1ZmZlckF0dHJpYnV0ZSgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBhdHRyaWJ1dGUuYXBwbHlNYXRyaXgzKCBtYXRyaXggKSBpbnN0ZWFkLiIpOwogICAgcmV0dXJuIGF0dHJpYnV0ZS5hcHBseU1hdHJpeDModGhpcyk7CiAgfTsKICBNYXRyaXgzLnByb3RvdHlwZS5hcHBseVRvVmVjdG9yM0FycmF5ID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5NYXRyaXgzOiAuYXBwbHlUb1ZlY3RvcjNBcnJheSgpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBNYXRyaXgzLnByb3RvdHlwZS5nZXRJbnZlcnNlID0gZnVuY3Rpb24obWF0cml4KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdHJpeDM6IC5nZXRJbnZlcnNlKCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIG1hdHJpeEludi5jb3B5KCBtYXRyaXggKS5pbnZlcnQoKTsgaW5zdGVhZC4iKTsKICAgIHJldHVybiB0aGlzLmNvcHkobWF0cml4KS5pbnZlcnQoKTsKICB9OwogIE1hdHJpeDQucHJvdG90eXBlLmV4dHJhY3RQb3NpdGlvbiA9IGZ1bmN0aW9uKG0pIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuTWF0cml4NDogLmV4dHJhY3RQb3NpdGlvbigpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmNvcHlQb3NpdGlvbigpLiIpOwogICAgcmV0dXJuIHRoaXMuY29weVBvc2l0aW9uKG0pOwogIH07CiAgTWF0cml4NC5wcm90b3R5cGUuZmxhdHRlblRvQXJyYXlPZmZzZXQgPSBmdW5jdGlvbihhcnJheSwgb2Zmc2V0KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdHJpeDQ6IC5mbGF0dGVuVG9BcnJheU9mZnNldCgpIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAudG9BcnJheSgpIGluc3RlYWQuIik7CiAgICByZXR1cm4gdGhpcy50b0FycmF5KGFycmF5LCBvZmZzZXQpOwogIH07CiAgTWF0cml4NC5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuTWF0cml4NDogLmdldFBvc2l0aW9uKCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIFZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBtYXRyaXggKSBpbnN0ZWFkLiIpOwogICAgcmV0dXJuIG5ldyBWZWN0b3IzKCkuc2V0RnJvbU1hdHJpeENvbHVtbih0aGlzLCAzKTsKICB9OwogIE1hdHJpeDQucHJvdG90eXBlLnNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24gPSBmdW5jdGlvbihxKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdHJpeDQ6IC5zZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24oKS4iKTsKICAgIHJldHVybiB0aGlzLm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHEpOwogIH07CiAgTWF0cml4NC5wcm90b3R5cGUubXVsdGlwbHlUb0FycmF5ID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdHJpeDQ6IC5tdWx0aXBseVRvQXJyYXkoKSBoYXMgYmVlbiByZW1vdmVkLiIpOwogIH07CiAgTWF0cml4NC5wcm90b3R5cGUubXVsdGlwbHlWZWN0b3IzID0gZnVuY3Rpb24odmVjdG9yKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdHJpeDQ6IC5tdWx0aXBseVZlY3RvcjMoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgdmVjdG9yLmFwcGx5TWF0cml4NCggbWF0cml4ICkgaW5zdGVhZC4iKTsKICAgIHJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KHRoaXMpOwogIH07CiAgTWF0cml4NC5wcm90b3R5cGUubXVsdGlwbHlWZWN0b3I0ID0gZnVuY3Rpb24odmVjdG9yKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdHJpeDQ6IC5tdWx0aXBseVZlY3RvcjQoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgdmVjdG9yLmFwcGx5TWF0cml4NCggbWF0cml4ICkgaW5zdGVhZC4iKTsKICAgIHJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KHRoaXMpOwogIH07CiAgTWF0cml4NC5wcm90b3R5cGUubXVsdGlwbHlWZWN0b3IzQXJyYXkgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLk1hdHJpeDQ6IC5tdWx0aXBseVZlY3RvcjNBcnJheSgpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBNYXRyaXg0LnByb3RvdHlwZS5yb3RhdGVBeGlzID0gZnVuY3Rpb24odikgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5NYXRyaXg0OiAucm90YXRlQXhpcygpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBWZWN0b3IzLnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4ICkgaW5zdGVhZC4iKTsKICAgIHYudHJhbnNmb3JtRGlyZWN0aW9uKHRoaXMpOwogIH07CiAgTWF0cml4NC5wcm90b3R5cGUuY3Jvc3NWZWN0b3IgPSBmdW5jdGlvbih2ZWN0b3IpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuTWF0cml4NDogLmNyb3NzVmVjdG9yKCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIHZlY3Rvci5hcHBseU1hdHJpeDQoIG1hdHJpeCApIGluc3RlYWQuIik7CiAgICByZXR1cm4gdmVjdG9yLmFwcGx5TWF0cml4NCh0aGlzKTsKICB9OwogIE1hdHJpeDQucHJvdG90eXBlLnRyYW5zbGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5lcnJvcigiVEhSRUUuTWF0cml4NDogLnRyYW5zbGF0ZSgpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBNYXRyaXg0LnByb3RvdHlwZS5yb3RhdGVYID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5NYXRyaXg0OiAucm90YXRlWCgpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBNYXRyaXg0LnByb3RvdHlwZS5yb3RhdGVZID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5NYXRyaXg0OiAucm90YXRlWSgpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBNYXRyaXg0LnByb3RvdHlwZS5yb3RhdGVaID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5NYXRyaXg0OiAucm90YXRlWigpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBNYXRyaXg0LnByb3RvdHlwZS5yb3RhdGVCeUF4aXMgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLk1hdHJpeDQ6IC5yb3RhdGVCeUF4aXMoKSBoYXMgYmVlbiByZW1vdmVkLiIpOwogIH07CiAgTWF0cml4NC5wcm90b3R5cGUuYXBwbHlUb0J1ZmZlckF0dHJpYnV0ZSA9IGZ1bmN0aW9uKGF0dHJpYnV0ZSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5NYXRyaXg0OiAuYXBwbHlUb0J1ZmZlckF0dHJpYnV0ZSgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBhdHRyaWJ1dGUuYXBwbHlNYXRyaXg0KCBtYXRyaXggKSBpbnN0ZWFkLiIpOwogICAgcmV0dXJuIGF0dHJpYnV0ZS5hcHBseU1hdHJpeDQodGhpcyk7CiAgfTsKICBNYXRyaXg0LnByb3RvdHlwZS5hcHBseVRvVmVjdG9yM0FycmF5ID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5NYXRyaXg0OiAuYXBwbHlUb1ZlY3RvcjNBcnJheSgpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBNYXRyaXg0LnByb3RvdHlwZS5tYWtlRnJ1c3R1bSA9IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0LCBib3R0b20sIHRvcCwgbmVhciwgZmFyKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdHJpeDQ6IC5tYWtlRnJ1c3R1bSgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSAubWFrZVBlcnNwZWN0aXZlKCBsZWZ0LCByaWdodCwgdG9wLCBib3R0b20sIG5lYXIsIGZhciApIGluc3RlYWQuIik7CiAgICByZXR1cm4gdGhpcy5tYWtlUGVyc3BlY3RpdmUobGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCBuZWFyLCBmYXIpOwogIH07CiAgTWF0cml4NC5wcm90b3R5cGUuZ2V0SW52ZXJzZSA9IGZ1bmN0aW9uKG1hdHJpeCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5NYXRyaXg0OiAuZ2V0SW52ZXJzZSgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBtYXRyaXhJbnYuY29weSggbWF0cml4ICkuaW52ZXJ0KCk7IGluc3RlYWQuIik7CiAgICByZXR1cm4gdGhpcy5jb3B5KG1hdHJpeCkuaW52ZXJ0KCk7CiAgfTsKICBQbGFuZS5wcm90b3R5cGUuaXNJbnRlcnNlY3Rpb25MaW5lID0gZnVuY3Rpb24obGluZSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5QbGFuZTogLmlzSW50ZXJzZWN0aW9uTGluZSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmludGVyc2VjdHNMaW5lKCkuIik7CiAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3RzTGluZShsaW5lKTsKICB9OwogIFF1YXRlcm5pb24ucHJvdG90eXBlLm11bHRpcGx5VmVjdG9yMyA9IGZ1bmN0aW9uKHZlY3RvcikgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5RdWF0ZXJuaW9uOiAubXVsdGlwbHlWZWN0b3IzKCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIGlzIG5vdyB2ZWN0b3IuYXBwbHlRdWF0ZXJuaW9uKCBxdWF0ZXJuaW9uICkgaW5zdGVhZC4iKTsKICAgIHJldHVybiB2ZWN0b3IuYXBwbHlRdWF0ZXJuaW9uKHRoaXMpOwogIH07CiAgUXVhdGVybmlvbi5wcm90b3R5cGUuaW52ZXJzZSA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5RdWF0ZXJuaW9uOiAuaW52ZXJzZSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gaW52ZXJ0KCkuIik7CiAgICByZXR1cm4gdGhpcy5pbnZlcnQoKTsKICB9OwogIFJheS5wcm90b3R5cGUuaXNJbnRlcnNlY3Rpb25Cb3ggPSBmdW5jdGlvbihib3gpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuUmF5OiAuaXNJbnRlcnNlY3Rpb25Cb3goKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pbnRlcnNlY3RzQm94KCkuIik7CiAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3RzQm94KGJveCk7CiAgfTsKICBSYXkucHJvdG90eXBlLmlzSW50ZXJzZWN0aW9uUGxhbmUgPSBmdW5jdGlvbihwbGFuZSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5SYXk6IC5pc0ludGVyc2VjdGlvblBsYW5lKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuaW50ZXJzZWN0c1BsYW5lKCkuIik7CiAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3RzUGxhbmUocGxhbmUpOwogIH07CiAgUmF5LnByb3RvdHlwZS5pc0ludGVyc2VjdGlvblNwaGVyZSA9IGZ1bmN0aW9uKHNwaGVyZSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5SYXk6IC5pc0ludGVyc2VjdGlvblNwaGVyZSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmludGVyc2VjdHNTcGhlcmUoKS4iKTsKICAgIHJldHVybiB0aGlzLmludGVyc2VjdHNTcGhlcmUoc3BoZXJlKTsKICB9OwogIFRyaWFuZ2xlLnByb3RvdHlwZS5hcmVhID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLlRyaWFuZ2xlOiAuYXJlYSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmdldEFyZWEoKS4iKTsKICAgIHJldHVybiB0aGlzLmdldEFyZWEoKTsKICB9OwogIFRyaWFuZ2xlLnByb3RvdHlwZS5iYXJ5Y29vcmRGcm9tUG9pbnQgPSBmdW5jdGlvbihwb2ludCwgdGFyZ2V0KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLlRyaWFuZ2xlOiAuYmFyeWNvb3JkRnJvbVBvaW50KCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ2V0QmFyeWNvb3JkKCkuIik7CiAgICByZXR1cm4gdGhpcy5nZXRCYXJ5Y29vcmQocG9pbnQsIHRhcmdldCk7CiAgfTsKICBUcmlhbmdsZS5wcm90b3R5cGUubWlkcG9pbnQgPSBmdW5jdGlvbih0YXJnZXQpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuVHJpYW5nbGU6IC5taWRwb2ludCgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmdldE1pZHBvaW50KCkuIik7CiAgICByZXR1cm4gdGhpcy5nZXRNaWRwb2ludCh0YXJnZXQpOwogIH07CiAgVHJpYW5nbGUucHJvdG90eXBlbm9ybWFsID0gZnVuY3Rpb24odGFyZ2V0KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLlRyaWFuZ2xlOiAubm9ybWFsKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ2V0Tm9ybWFsKCkuIik7CiAgICByZXR1cm4gdGhpcy5nZXROb3JtYWwodGFyZ2V0KTsKICB9OwogIFRyaWFuZ2xlLnByb3RvdHlwZS5wbGFuZSA9IGZ1bmN0aW9uKHRhcmdldCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5UcmlhbmdsZTogLnBsYW5lKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ2V0UGxhbmUoKS4iKTsKICAgIHJldHVybiB0aGlzLmdldFBsYW5lKHRhcmdldCk7CiAgfTsKICBUcmlhbmdsZS5iYXJ5Y29vcmRGcm9tUG9pbnQgPSBmdW5jdGlvbihwb2ludCwgYSwgYiwgYywgdGFyZ2V0KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLlRyaWFuZ2xlOiAuYmFyeWNvb3JkRnJvbVBvaW50KCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ2V0QmFyeWNvb3JkKCkuIik7CiAgICByZXR1cm4gVHJpYW5nbGUuZ2V0QmFyeWNvb3JkKHBvaW50LCBhLCBiLCBjLCB0YXJnZXQpOwogIH07CiAgVHJpYW5nbGUubm9ybWFsID0gZnVuY3Rpb24oYSwgYiwgYywgdGFyZ2V0KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLlRyaWFuZ2xlOiAubm9ybWFsKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ2V0Tm9ybWFsKCkuIik7CiAgICByZXR1cm4gVHJpYW5nbGUuZ2V0Tm9ybWFsKGEsIGIsIGMsIHRhcmdldCk7CiAgfTsKICBTaGFwZS5wcm90b3R5cGUuZXh0cmFjdEFsbFBvaW50cyA9IGZ1bmN0aW9uKGRpdmlzaW9ucykgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5TaGFwZTogLmV4dHJhY3RBbGxQb2ludHMoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgLmV4dHJhY3RQb2ludHMoKSBpbnN0ZWFkLiIpOwogICAgcmV0dXJuIHRoaXMuZXh0cmFjdFBvaW50cyhkaXZpc2lvbnMpOwogIH07CiAgU2hhcGUucHJvdG90eXBlLmV4dHJ1ZGUgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLlNoYXBlOiAuZXh0cnVkZSgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBFeHRydWRlR2VvbWV0cnkoKSBpbnN0ZWFkLiIpOwogICAgcmV0dXJuIG5ldyBFeHRydWRlR2VvbWV0cnkodGhpcywgb3B0aW9ucyk7CiAgfTsKICBTaGFwZS5wcm90b3R5cGUubWFrZUdlb21ldHJ5ID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5TaGFwZTogLm1ha2VHZW9tZXRyeSgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBTaGFwZUdlb21ldHJ5KCkgaW5zdGVhZC4iKTsKICAgIHJldHVybiBuZXcgU2hhcGVHZW9tZXRyeSh0aGlzLCBvcHRpb25zKTsKICB9OwogIFZlY3RvcjIucHJvdG90eXBlLmZyb21BdHRyaWJ1dGUgPSBmdW5jdGlvbihhdHRyaWJ1dGUsIGluZGV4LCBvZmZzZXQpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yMjogLmZyb21BdHRyaWJ1dGUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5mcm9tQnVmZmVyQXR0cmlidXRlKCkuIik7CiAgICByZXR1cm4gdGhpcy5mcm9tQnVmZmVyQXR0cmlidXRlKGF0dHJpYnV0ZSwgaW5kZXgsIG9mZnNldCk7CiAgfTsKICBWZWN0b3IyLnByb3RvdHlwZS5kaXN0YW5jZVRvTWFuaGF0dGFuID0gZnVuY3Rpb24odikgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5WZWN0b3IyOiAuZGlzdGFuY2VUb01hbmhhdHRhbigpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLm1hbmhhdHRhbkRpc3RhbmNlVG8oKS4iKTsKICAgIHJldHVybiB0aGlzLm1hbmhhdHRhbkRpc3RhbmNlVG8odik7CiAgfTsKICBWZWN0b3IyLnByb3RvdHlwZS5sZW5ndGhNYW5oYXR0YW4gPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yMjogLmxlbmd0aE1hbmhhdHRhbigpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLm1hbmhhdHRhbkxlbmd0aCgpLiIpOwogICAgcmV0dXJuIHRoaXMubWFuaGF0dGFuTGVuZ3RoKCk7CiAgfTsKICBWZWN0b3IzLnByb3RvdHlwZS5zZXRFdWxlckZyb21Sb3RhdGlvbk1hdHJpeCA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5lcnJvcigiVEhSRUUuVmVjdG9yMzogLnNldEV1bGVyRnJvbVJvdGF0aW9uTWF0cml4KCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIEV1bGVyLnNldEZyb21Sb3RhdGlvbk1hdHJpeCgpIGluc3RlYWQuIik7CiAgfTsKICBWZWN0b3IzLnByb3RvdHlwZS5zZXRFdWxlckZyb21RdWF0ZXJuaW9uID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5WZWN0b3IzOiAuc2V0RXVsZXJGcm9tUXVhdGVybmlvbigpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBFdWxlci5zZXRGcm9tUXVhdGVybmlvbigpIGluc3RlYWQuIik7CiAgfTsKICBWZWN0b3IzLnByb3RvdHlwZS5nZXRQb3NpdGlvbkZyb21NYXRyaXggPSBmdW5jdGlvbihtKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLlZlY3RvcjM6IC5nZXRQb3NpdGlvbkZyb21NYXRyaXgoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5zZXRGcm9tTWF0cml4UG9zaXRpb24oKS4iKTsKICAgIHJldHVybiB0aGlzLnNldEZyb21NYXRyaXhQb3NpdGlvbihtKTsKICB9OwogIFZlY3RvcjMucHJvdG90eXBlLmdldFNjYWxlRnJvbU1hdHJpeCA9IGZ1bmN0aW9uKG0pIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yMzogLmdldFNjYWxlRnJvbU1hdHJpeCgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLnNldEZyb21NYXRyaXhTY2FsZSgpLiIpOwogICAgcmV0dXJuIHRoaXMuc2V0RnJvbU1hdHJpeFNjYWxlKG0pOwogIH07CiAgVmVjdG9yMy5wcm90b3R5cGUuZ2V0Q29sdW1uRnJvbU1hdHJpeCA9IGZ1bmN0aW9uKGluZGV4LCBtYXRyaXgpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yMzogLmdldENvbHVtbkZyb21NYXRyaXgoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5zZXRGcm9tTWF0cml4Q29sdW1uKCkuIik7CiAgICByZXR1cm4gdGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKG1hdHJpeCwgaW5kZXgpOwogIH07CiAgVmVjdG9yMy5wcm90b3R5cGUuYXBwbHlQcm9qZWN0aW9uID0gZnVuY3Rpb24obSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5WZWN0b3IzOiAuYXBwbHlQcm9qZWN0aW9uKCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIC5hcHBseU1hdHJpeDQoIG0gKSBpbnN0ZWFkLiIpOwogICAgcmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KG0pOwogIH07CiAgVmVjdG9yMy5wcm90b3R5cGUuZnJvbUF0dHJpYnV0ZSA9IGZ1bmN0aW9uKGF0dHJpYnV0ZSwgaW5kZXgsIG9mZnNldCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5WZWN0b3IzOiAuZnJvbUF0dHJpYnV0ZSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmZyb21CdWZmZXJBdHRyaWJ1dGUoKS4iKTsKICAgIHJldHVybiB0aGlzLmZyb21CdWZmZXJBdHRyaWJ1dGUoYXR0cmlidXRlLCBpbmRleCwgb2Zmc2V0KTsKICB9OwogIFZlY3RvcjMucHJvdG90eXBlLmRpc3RhbmNlVG9NYW5oYXR0YW4gPSBmdW5jdGlvbih2KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLlZlY3RvcjM6IC5kaXN0YW5jZVRvTWFuaGF0dGFuKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAubWFuaGF0dGFuRGlzdGFuY2VUbygpLiIpOwogICAgcmV0dXJuIHRoaXMubWFuaGF0dGFuRGlzdGFuY2VUbyh2KTsKICB9OwogIFZlY3RvcjMucHJvdG90eXBlLmxlbmd0aE1hbmhhdHRhbiA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5WZWN0b3IzOiAubGVuZ3RoTWFuaGF0dGFuKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAubWFuaGF0dGFuTGVuZ3RoKCkuIik7CiAgICByZXR1cm4gdGhpcy5tYW5oYXR0YW5MZW5ndGgoKTsKICB9OwogIFZlY3RvcjQucHJvdG90eXBlLmZyb21BdHRyaWJ1dGUgPSBmdW5jdGlvbihhdHRyaWJ1dGUsIGluZGV4LCBvZmZzZXQpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yNDogLmZyb21BdHRyaWJ1dGUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5mcm9tQnVmZmVyQXR0cmlidXRlKCkuIik7CiAgICByZXR1cm4gdGhpcy5mcm9tQnVmZmVyQXR0cmlidXRlKGF0dHJpYnV0ZSwgaW5kZXgsIG9mZnNldCk7CiAgfTsKICBWZWN0b3I0LnByb3RvdHlwZS5sZW5ndGhNYW5oYXR0YW4gPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuVmVjdG9yNDogLmxlbmd0aE1hbmhhdHRhbigpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLm1hbmhhdHRhbkxlbmd0aCgpLiIpOwogICAgcmV0dXJuIHRoaXMubWFuaGF0dGFuTGVuZ3RoKCk7CiAgfTsKICBPYmplY3QzRC5wcm90b3R5cGUuZ2V0Q2hpbGRCeU5hbWUgPSBmdW5jdGlvbihuYW1lKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLk9iamVjdDNEOiAuZ2V0Q2hpbGRCeU5hbWUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRPYmplY3RCeU5hbWUoKS4iKTsKICAgIHJldHVybiB0aGlzLmdldE9iamVjdEJ5TmFtZShuYW1lKTsKICB9OwogIE9iamVjdDNELnByb3RvdHlwZS5yZW5kZXJEZXB0aCA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5PYmplY3QzRDogLnJlbmRlckRlcHRoIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSAucmVuZGVyT3JkZXIsIGluc3RlYWQuIik7CiAgfTsKICBPYmplY3QzRC5wcm90b3R5cGUudHJhbnNsYXRlID0gZnVuY3Rpb24oZGlzdGFuY2UsIGF4aXMpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuT2JqZWN0M0Q6IC50cmFuc2xhdGUoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgLnRyYW5zbGF0ZU9uQXhpcyggYXhpcywgZGlzdGFuY2UgKSBpbnN0ZWFkLiIpOwogICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKGF4aXMsIGRpc3RhbmNlKTsKICB9OwogIE9iamVjdDNELnByb3RvdHlwZS5nZXRXb3JsZFJvdGF0aW9uID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5PYmplY3QzRDogLmdldFdvcmxkUm90YXRpb24oKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgVEhSRUUuT2JqZWN0M0QuZ2V0V29ybGRRdWF0ZXJuaW9uKCB0YXJnZXQgKSBpbnN0ZWFkLiIpOwogIH07CiAgT2JqZWN0M0QucHJvdG90eXBlLmFwcGx5TWF0cml4ID0gZnVuY3Rpb24obWF0cml4KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLk9iamVjdDNEOiAuYXBwbHlNYXRyaXgoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5hcHBseU1hdHJpeDQoKS4iKTsKICAgIHJldHVybiB0aGlzLmFwcGx5TWF0cml4NChtYXRyaXgpOwogIH07CiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoT2JqZWN0M0QucHJvdG90eXBlLCB7CiAgICBldWxlck9yZGVyOiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5PYmplY3QzRDogLmV1bGVyT3JkZXIgaXMgbm93IC5yb3RhdGlvbi5vcmRlci4iKTsKICAgICAgICByZXR1cm4gdGhpcy5yb3RhdGlvbi5vcmRlcjsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuT2JqZWN0M0Q6IC5ldWxlck9yZGVyIGlzIG5vdyAucm90YXRpb24ub3JkZXIuIik7CiAgICAgICAgdGhpcy5yb3RhdGlvbi5vcmRlciA9IHZhbHVlOwogICAgICB9CiAgICB9LAogICAgdXNlUXVhdGVybmlvbjogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuT2JqZWN0M0Q6IC51c2VRdWF0ZXJuaW9uIGhhcyBiZWVuIHJlbW92ZWQuIFRoZSBsaWJyYXJ5IG5vdyB1c2VzIHF1YXRlcm5pb25zIGJ5IGRlZmF1bHQuIik7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5PYmplY3QzRDogLnVzZVF1YXRlcm5pb24gaGFzIGJlZW4gcmVtb3ZlZC4gVGhlIGxpYnJhcnkgbm93IHVzZXMgcXVhdGVybmlvbnMgYnkgZGVmYXVsdC4iKTsKICAgICAgfQogICAgfQogIH0pOwogIE1lc2gucHJvdG90eXBlLnNldERyYXdNb2RlID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5NZXNoOiAuc2V0RHJhd01vZGUoKSBoYXMgYmVlbiByZW1vdmVkLiBUaGUgcmVuZGVyZXIgbm93IGFsd2F5cyBhc3N1bWVzIFRIUkVFLlRyaWFuZ2xlc0RyYXdNb2RlLiBUcmFuc2Zvcm0geW91ciBnZW9tZXRyeSB2aWEgQnVmZmVyR2VvbWV0cnlVdGlscy50b1RyaWFuZ2xlc0RyYXdNb2RlKCkgaWYgbmVjZXNzYXJ5LiIpOwogIH07CiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoTWVzaC5wcm90b3R5cGUsIHsKICAgIGRyYXdNb2RlOiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuTWVzaDogLmRyYXdNb2RlIGhhcyBiZWVuIHJlbW92ZWQuIFRoZSByZW5kZXJlciBub3cgYWx3YXlzIGFzc3VtZXMgVEhSRUUuVHJpYW5nbGVzRHJhd01vZGUuIik7CiAgICAgICAgcmV0dXJuIFRyaWFuZ2xlc0RyYXdNb2RlOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLk1lc2g6IC5kcmF3TW9kZSBoYXMgYmVlbiByZW1vdmVkLiBUaGUgcmVuZGVyZXIgbm93IGFsd2F5cyBhc3N1bWVzIFRIUkVFLlRyaWFuZ2xlc0RyYXdNb2RlLiBUcmFuc2Zvcm0geW91ciBnZW9tZXRyeSB2aWEgQnVmZmVyR2VvbWV0cnlVdGlscy50b1RyaWFuZ2xlc0RyYXdNb2RlKCkgaWYgbmVjZXNzYXJ5LiIpOwogICAgICB9CiAgICB9CiAgfSk7CiAgU2tpbm5lZE1lc2gucHJvdG90eXBlLmluaXRCb25lcyA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5lcnJvcigiVEhSRUUuU2tpbm5lZE1lc2g6IGluaXRCb25lcygpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBQZXJzcGVjdGl2ZUNhbWVyYS5wcm90b3R5cGUuc2V0TGVucyA9IGZ1bmN0aW9uKGZvY2FsTGVuZ3RoLCBmaWxtR2F1Z2UpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEuc2V0TGVucyBpcyBkZXByZWNhdGVkLiBVc2UgLnNldEZvY2FsTGVuZ3RoIGFuZCAuZmlsbUdhdWdlIGZvciBhIHBob3RvZ3JhcGhpYyBzZXR1cC4iKTsKICAgIGlmIChmaWxtR2F1Z2UgIT09IHZvaWQgMCkKICAgICAgdGhpcy5maWxtR2F1Z2UgPSBmaWxtR2F1Z2U7CiAgICB0aGlzLnNldEZvY2FsTGVuZ3RoKGZvY2FsTGVuZ3RoKTsKICB9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKExpZ2h0LnByb3RvdHlwZSwgewogICAgb25seVNoYWRvdzogewogICAgICBzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuTGlnaHQ6IC5vbmx5U2hhZG93IGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgICAgIH0KICAgIH0sCiAgICBzaGFkb3dDYW1lcmFGb3Y6IHsKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuTGlnaHQ6IC5zaGFkb3dDYW1lcmFGb3YgaXMgbm93IC5zaGFkb3cuY2FtZXJhLmZvdi4iKTsKICAgICAgICB0aGlzLnNoYWRvdy5jYW1lcmEuZm92ID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBzaGFkb3dDYW1lcmFMZWZ0OiB7CiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkxpZ2h0OiAuc2hhZG93Q2FtZXJhTGVmdCBpcyBub3cgLnNoYWRvdy5jYW1lcmEubGVmdC4iKTsKICAgICAgICB0aGlzLnNoYWRvdy5jYW1lcmEubGVmdCA9IHZhbHVlOwogICAgICB9CiAgICB9LAogICAgc2hhZG93Q2FtZXJhUmlnaHQ6IHsKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuTGlnaHQ6IC5zaGFkb3dDYW1lcmFSaWdodCBpcyBub3cgLnNoYWRvdy5jYW1lcmEucmlnaHQuIik7CiAgICAgICAgdGhpcy5zaGFkb3cuY2FtZXJhLnJpZ2h0ID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBzaGFkb3dDYW1lcmFUb3A6IHsKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuTGlnaHQ6IC5zaGFkb3dDYW1lcmFUb3AgaXMgbm93IC5zaGFkb3cuY2FtZXJhLnRvcC4iKTsKICAgICAgICB0aGlzLnNoYWRvdy5jYW1lcmEudG9wID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBzaGFkb3dDYW1lcmFCb3R0b206IHsKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuTGlnaHQ6IC5zaGFkb3dDYW1lcmFCb3R0b20gaXMgbm93IC5zaGFkb3cuY2FtZXJhLmJvdHRvbS4iKTsKICAgICAgICB0aGlzLnNoYWRvdy5jYW1lcmEuYm90dG9tID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBzaGFkb3dDYW1lcmFOZWFyOiB7CiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkxpZ2h0OiAuc2hhZG93Q2FtZXJhTmVhciBpcyBub3cgLnNoYWRvdy5jYW1lcmEubmVhci4iKTsKICAgICAgICB0aGlzLnNoYWRvdy5jYW1lcmEubmVhciA9IHZhbHVlOwogICAgICB9CiAgICB9LAogICAgc2hhZG93Q2FtZXJhRmFyOiB7CiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkxpZ2h0OiAuc2hhZG93Q2FtZXJhRmFyIGlzIG5vdyAuc2hhZG93LmNhbWVyYS5mYXIuIik7CiAgICAgICAgdGhpcy5zaGFkb3cuY2FtZXJhLmZhciA9IHZhbHVlOwogICAgICB9CiAgICB9LAogICAgc2hhZG93Q2FtZXJhVmlzaWJsZTogewogICAgICBzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuTGlnaHQ6IC5zaGFkb3dDYW1lcmFWaXNpYmxlIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBuZXcgVEhSRUUuQ2FtZXJhSGVscGVyKCBsaWdodC5zaGFkb3cuY2FtZXJhICkgaW5zdGVhZC4iKTsKICAgICAgfQogICAgfSwKICAgIHNoYWRvd0JpYXM6IHsKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuTGlnaHQ6IC5zaGFkb3dCaWFzIGlzIG5vdyAuc2hhZG93LmJpYXMuIik7CiAgICAgICAgdGhpcy5zaGFkb3cuYmlhcyA9IHZhbHVlOwogICAgICB9CiAgICB9LAogICAgc2hhZG93RGFya25lc3M6IHsKICAgICAgc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkxpZ2h0OiAuc2hhZG93RGFya25lc3MgaGFzIGJlZW4gcmVtb3ZlZC4iKTsKICAgICAgfQogICAgfSwKICAgIHNoYWRvd01hcFdpZHRoOiB7CiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkxpZ2h0OiAuc2hhZG93TWFwV2lkdGggaXMgbm93IC5zaGFkb3cubWFwU2l6ZS53aWR0aC4iKTsKICAgICAgICB0aGlzLnNoYWRvdy5tYXBTaXplLndpZHRoID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBzaGFkb3dNYXBIZWlnaHQ6IHsKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuTGlnaHQ6IC5zaGFkb3dNYXBIZWlnaHQgaXMgbm93IC5zaGFkb3cubWFwU2l6ZS5oZWlnaHQuIik7CiAgICAgICAgdGhpcy5zaGFkb3cubWFwU2l6ZS5oZWlnaHQgPSB2YWx1ZTsKICAgICAgfQogICAgfQogIH0pOwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUsIHsKICAgIGxlbmd0aDogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuQnVmZmVyQXR0cmlidXRlOiAubGVuZ3RoIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAuY291bnQgaW5zdGVhZC4iKTsKICAgICAgICByZXR1cm4gdGhpcy5hcnJheS5sZW5ndGg7CiAgICAgIH0KICAgIH0sCiAgICBkeW5hbWljOiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5CdWZmZXJBdHRyaWJ1dGU6IC5keW5hbWljIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAudXNhZ2UgaW5zdGVhZC4iKTsKICAgICAgICByZXR1cm4gdGhpcy51c2FnZSA9PT0gRHluYW1pY0RyYXdVc2FnZTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJ1ZmZlckF0dHJpYnV0ZTogLmR5bmFtaWMgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIC51c2FnZSBpbnN0ZWFkLiIpOwogICAgICAgIHRoaXMuc2V0VXNhZ2UoRHluYW1pY0RyYXdVc2FnZSk7CiAgICAgIH0KICAgIH0KICB9KTsKICBCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlLnNldER5bmFtaWMgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5CdWZmZXJBdHRyaWJ1dGU6IC5zZXREeW5hbWljKCkgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIC5zZXRVc2FnZSgpIGluc3RlYWQuIik7CiAgICB0aGlzLnNldFVzYWdlKHZhbHVlID09PSB0cnVlID8gRHluYW1pY0RyYXdVc2FnZSA6IFN0YXRpY0RyYXdVc2FnZSk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUuY29weUluZGljZXNBcnJheSA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5lcnJvcigiVEhSRUUuQnVmZmVyQXR0cmlidXRlOiAuY29weUluZGljZXNBcnJheSgpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfSwgQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZS5zZXRBcnJheSA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5lcnJvcigiVEhSRUUuQnVmZmVyQXR0cmlidXRlOiAuc2V0QXJyYXkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIEJ1ZmZlckdlb21ldHJ5IC5zZXRBdHRyaWJ1dGUgdG8gcmVwbGFjZS9yZXNpemUgYXR0cmlidXRlIGJ1ZmZlcnMiKTsKICB9OwogIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5hZGRJbmRleCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuYWRkSW5kZXgoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5zZXRJbmRleCgpLiIpOwogICAgdGhpcy5zZXRJbmRleChpbmRleCk7CiAgfTsKICBCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUuYWRkQXR0cmlidXRlID0gZnVuY3Rpb24obmFtZSwgYXR0cmlidXRlKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuYWRkQXR0cmlidXRlKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuc2V0QXR0cmlidXRlKCkuIik7CiAgICBpZiAoIShhdHRyaWJ1dGUgJiYgYXR0cmlidXRlLmlzQnVmZmVyQXR0cmlidXRlKSAmJiAhKGF0dHJpYnV0ZSAmJiBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSkpIHsKICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5CdWZmZXJHZW9tZXRyeTogLmFkZEF0dHJpYnV0ZSgpIG5vdyBleHBlY3RzICggbmFtZSwgYXR0cmlidXRlICkuIik7CiAgICAgIHJldHVybiB0aGlzLnNldEF0dHJpYnV0ZShuYW1lLCBuZXcgQnVmZmVyQXR0cmlidXRlKGFyZ3VtZW50c1sxXSwgYXJndW1lbnRzWzJdKSk7CiAgICB9CiAgICBpZiAobmFtZSA9PT0gImluZGV4IikgewogICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJ1ZmZlckdlb21ldHJ5LmFkZEF0dHJpYnV0ZTogVXNlIC5zZXRJbmRleCgpIGZvciBpbmRleCBhdHRyaWJ1dGUuIik7CiAgICAgIHRoaXMuc2V0SW5kZXgoYXR0cmlidXRlKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByZXR1cm4gdGhpcy5zZXRBdHRyaWJ1dGUobmFtZSwgYXR0cmlidXRlKTsKICB9OwogIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5hZGREcmF3Q2FsbCA9IGZ1bmN0aW9uKHN0YXJ0LCBjb3VudCwgaW5kZXhPZmZzZXQpIHsKICAgIGlmIChpbmRleE9mZnNldCAhPT0gdm9pZCAwKSB7CiAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuQnVmZmVyR2VvbWV0cnk6IC5hZGREcmF3Q2FsbCgpIG5vIGxvbmdlciBzdXBwb3J0cyBpbmRleE9mZnNldC4iKTsKICAgIH0KICAgIGNvbnNvbGUud2FybigiVEhSRUUuQnVmZmVyR2VvbWV0cnk6IC5hZGREcmF3Q2FsbCgpIGlzIG5vdyAuYWRkR3JvdXAoKS4iKTsKICAgIHRoaXMuYWRkR3JvdXAoc3RhcnQsIGNvdW50KTsKICB9OwogIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5jbGVhckRyYXdDYWxscyA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5CdWZmZXJHZW9tZXRyeTogLmNsZWFyRHJhd0NhbGxzKCkgaXMgbm93IC5jbGVhckdyb3VwcygpLiIpOwogICAgdGhpcy5jbGVhckdyb3VwcygpOwogIH07CiAgQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbXB1dGVPZmZzZXRzID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuY29tcHV0ZU9mZnNldHMoKSBoYXMgYmVlbiByZW1vdmVkLiIpOwogIH07CiAgQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLnJlbW92ZUF0dHJpYnV0ZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuQnVmZmVyR2VvbWV0cnk6IC5yZW1vdmVBdHRyaWJ1dGUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5kZWxldGVBdHRyaWJ1dGUoKS4iKTsKICAgIHJldHVybiB0aGlzLmRlbGV0ZUF0dHJpYnV0ZShuYW1lKTsKICB9OwogIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5hcHBseU1hdHJpeCA9IGZ1bmN0aW9uKG1hdHJpeCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5CdWZmZXJHZW9tZXRyeTogLmFwcGx5TWF0cml4KCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuYXBwbHlNYXRyaXg0KCkuIik7CiAgICByZXR1cm4gdGhpcy5hcHBseU1hdHJpeDQobWF0cml4KTsKICB9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSwgewogICAgZHJhd2NhbGxzOiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVEhSRUUuQnVmZmVyR2VvbWV0cnk6IC5kcmF3Y2FsbHMgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ3JvdXBzLiIpOwogICAgICAgIHJldHVybiB0aGlzLmdyb3VwczsKICAgICAgfQogICAgfSwKICAgIG9mZnNldHM6IHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLkJ1ZmZlckdlb21ldHJ5OiAub2Zmc2V0cyBoYXMgYmVlbiByZW5hbWVkIHRvIC5ncm91cHMuIik7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBzOwogICAgICB9CiAgICB9CiAgfSk7CiAgSW50ZXJsZWF2ZWRCdWZmZXIucHJvdG90eXBlLnNldER5bmFtaWMgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5JbnRlcmxlYXZlZEJ1ZmZlcjogLnNldER5bmFtaWMoKSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgLnNldFVzYWdlKCkgaW5zdGVhZC4iKTsKICAgIHRoaXMuc2V0VXNhZ2UodmFsdWUgPT09IHRydWUgPyBEeW5hbWljRHJhd1VzYWdlIDogU3RhdGljRHJhd1VzYWdlKTsKICAgIHJldHVybiB0aGlzOwogIH07CiAgSW50ZXJsZWF2ZWRCdWZmZXIucHJvdG90eXBlLnNldEFycmF5ID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5JbnRlcmxlYXZlZEJ1ZmZlcjogLnNldEFycmF5IGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBCdWZmZXJHZW9tZXRyeSAuc2V0QXR0cmlidXRlIHRvIHJlcGxhY2UvcmVzaXplIGF0dHJpYnV0ZSBidWZmZXJzIik7CiAgfTsKICBFeHRydWRlR2VvbWV0cnkucHJvdG90eXBlLmdldEFycmF5cyA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5lcnJvcigiVEhSRUUuRXh0cnVkZUdlb21ldHJ5OiAuZ2V0QXJyYXlzKCkgaGFzIGJlZW4gcmVtb3ZlZC4iKTsKICB9OwogIEV4dHJ1ZGVHZW9tZXRyeS5wcm90b3R5cGUuYWRkU2hhcGVMaXN0ID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5FeHRydWRlR2VvbWV0cnk6IC5hZGRTaGFwZUxpc3QoKSBoYXMgYmVlbiByZW1vdmVkLiIpOwogIH07CiAgRXh0cnVkZUdlb21ldHJ5LnByb3RvdHlwZS5hZGRTaGFwZSA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5lcnJvcigiVEhSRUUuRXh0cnVkZUdlb21ldHJ5OiAuYWRkU2hhcGUoKSBoYXMgYmVlbiByZW1vdmVkLiIpOwogIH07CiAgU2NlbmUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLlNjZW5lOiAuZGlzcG9zZSgpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBVbmlmb3JtLnByb3RvdHlwZS5vblVwZGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5Vbmlmb3JtOiAub25VcGRhdGUoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2Ugb2JqZWN0Lm9uQmVmb3JlUmVuZGVyKCkgaW5zdGVhZC4iKTsKICAgIHJldHVybiB0aGlzOwogIH07CiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoTWF0ZXJpYWwucHJvdG90eXBlLCB7CiAgICB3cmFwQXJvdW5kOiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5NYXRlcmlhbDogLndyYXBBcm91bmQgaGFzIGJlZW4gcmVtb3ZlZC4iKTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdGVyaWFsOiAud3JhcEFyb3VuZCBoYXMgYmVlbiByZW1vdmVkLiIpOwogICAgICB9CiAgICB9LAogICAgb3ZlcmRyYXc6IHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdGVyaWFsOiAub3ZlcmRyYXcgaGFzIGJlZW4gcmVtb3ZlZC4iKTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdGVyaWFsOiAub3ZlcmRyYXcgaGFzIGJlZW4gcmVtb3ZlZC4iKTsKICAgICAgfQogICAgfSwKICAgIHdyYXBSR0I6IHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLk1hdGVyaWFsOiAud3JhcFJHQiBoYXMgYmVlbiByZW1vdmVkLiIpOwogICAgICAgIHJldHVybiBuZXcgQ29sb3IoKTsKICAgICAgfQogICAgfSwKICAgIHNoYWRpbmc6IHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJUSFJFRS4iICsgdGhpcy50eXBlICsgIjogLnNoYWRpbmcgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIHRoZSBib29sZWFuIC5mbGF0U2hhZGluZyBpbnN0ZWFkLiIpOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS4iICsgdGhpcy50eXBlICsgIjogLnNoYWRpbmcgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIHRoZSBib29sZWFuIC5mbGF0U2hhZGluZyBpbnN0ZWFkLiIpOwogICAgICAgIHRoaXMuZmxhdFNoYWRpbmcgPSB2YWx1ZSA9PT0gRmxhdFNoYWRpbmc7CiAgICAgIH0KICAgIH0sCiAgICBzdGVuY2lsTWFzazogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuIiArIHRoaXMudHlwZSArICI6IC5zdGVuY2lsTWFzayBoYXMgYmVlbiByZW1vdmVkLiBVc2UgLnN0ZW5jaWxGdW5jTWFzayBpbnN0ZWFkLiIpOwogICAgICAgIHJldHVybiB0aGlzLnN0ZW5jaWxGdW5jTWFzazsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuIiArIHRoaXMudHlwZSArICI6IC5zdGVuY2lsTWFzayBoYXMgYmVlbiByZW1vdmVkLiBVc2UgLnN0ZW5jaWxGdW5jTWFzayBpbnN0ZWFkLiIpOwogICAgICAgIHRoaXMuc3RlbmNpbEZ1bmNNYXNrID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICB9KTsKICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhTaGFkZXJNYXRlcmlhbC5wcm90b3R5cGUsIHsKICAgIGRlcml2YXRpdmVzOiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5TaGFkZXJNYXRlcmlhbDogLmRlcml2YXRpdmVzIGhhcyBiZWVuIG1vdmVkIHRvIC5leHRlbnNpb25zLmRlcml2YXRpdmVzLiIpOwogICAgICAgIHJldHVybiB0aGlzLmV4dGVuc2lvbnMuZGVyaXZhdGl2ZXM7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLiBTaGFkZXJNYXRlcmlhbDogLmRlcml2YXRpdmVzIGhhcyBiZWVuIG1vdmVkIHRvIC5leHRlbnNpb25zLmRlcml2YXRpdmVzLiIpOwogICAgICAgIHRoaXMuZXh0ZW5zaW9ucy5kZXJpdmF0aXZlcyA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgfSk7CiAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuY2xlYXJUYXJnZXQgPSBmdW5jdGlvbihyZW5kZXJUYXJnZXQsIGNvbG9yLCBkZXB0aCwgc3RlbmNpbCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuY2xlYXJUYXJnZXQoKSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgLnNldFJlbmRlclRhcmdldCgpIGFuZCAuY2xlYXIoKSBpbnN0ZWFkLiIpOwogICAgdGhpcy5zZXRSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0KTsKICAgIHRoaXMuY2xlYXIoY29sb3IsIGRlcHRoLCBzdGVuY2lsKTsKICB9OwogIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmFuaW1hdGUgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuYW5pbWF0ZSgpIGlzIG5vdyAuc2V0QW5pbWF0aW9uTG9vcCgpLiIpOwogICAgdGhpcy5zZXRBbmltYXRpb25Mb29wKGNhbGxiYWNrKTsKICB9OwogIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmdldEN1cnJlbnRSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLmdldEN1cnJlbnRSZW5kZXJUYXJnZXQoKSBpcyBub3cgLmdldFJlbmRlclRhcmdldCgpLiIpOwogICAgcmV0dXJuIHRoaXMuZ2V0UmVuZGVyVGFyZ2V0KCk7CiAgfTsKICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5nZXRNYXhBbmlzb3Ryb3B5ID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5nZXRNYXhBbmlzb3Ryb3B5KCkgaXMgbm93IC5jYXBhYmlsaXRpZXMuZ2V0TWF4QW5pc290cm9weSgpLiIpOwogICAgcmV0dXJuIHRoaXMuY2FwYWJpbGl0aWVzLmdldE1heEFuaXNvdHJvcHkoKTsKICB9OwogIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmdldFByZWNpc2lvbiA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuZ2V0UHJlY2lzaW9uKCkgaXMgbm93IC5jYXBhYmlsaXRpZXMucHJlY2lzaW9uLiIpOwogICAgcmV0dXJuIHRoaXMuY2FwYWJpbGl0aWVzLnByZWNpc2lvbjsKICB9OwogIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLnJlc2V0R0xTdGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAucmVzZXRHTFN0YXRlKCkgaXMgbm93IC5zdGF0ZS5yZXNldCgpLiIpOwogICAgcmV0dXJuIHRoaXMuc3RhdGUucmVzZXQoKTsKICB9OwogIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLnN1cHBvcnRzRmxvYXRUZXh0dXJlcyA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc3VwcG9ydHNGbG9hdFRleHR1cmVzKCkgaXMgbm93IC5leHRlbnNpb25zLmdldCggJ09FU190ZXh0dXJlX2Zsb2F0JyApLiIpOwogICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9ucy5nZXQoIk9FU190ZXh0dXJlX2Zsb2F0Iik7CiAgfTsKICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5zdXBwb3J0c0hhbGZGbG9hdFRleHR1cmVzID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5zdXBwb3J0c0hhbGZGbG9hdFRleHR1cmVzKCkgaXMgbm93IC5leHRlbnNpb25zLmdldCggJ09FU190ZXh0dXJlX2hhbGZfZmxvYXQnICkuIik7CiAgICByZXR1cm4gdGhpcy5leHRlbnNpb25zLmdldCgiT0VTX3RleHR1cmVfaGFsZl9mbG9hdCIpOwogIH07CiAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc3VwcG9ydHNTdGFuZGFyZERlcml2YXRpdmVzID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5zdXBwb3J0c1N0YW5kYXJkRGVyaXZhdGl2ZXMoKSBpcyBub3cgLmV4dGVuc2lvbnMuZ2V0KCAnT0VTX3N0YW5kYXJkX2Rlcml2YXRpdmVzJyApLiIpOwogICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9ucy5nZXQoIk9FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyIpOwogIH07CiAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc3VwcG9ydHNDb21wcmVzc2VkVGV4dHVyZVMzVEMgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnN1cHBvcnRzQ29tcHJlc3NlZFRleHR1cmVTM1RDKCkgaXMgbm93IC5leHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJyApLiIpOwogICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9ucy5nZXQoIldFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjIik7CiAgfTsKICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5zdXBwb3J0c0NvbXByZXNzZWRUZXh0dXJlUFZSVEMgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnN1cHBvcnRzQ29tcHJlc3NlZFRleHR1cmVQVlJUQygpIGlzIG5vdyAuZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnICkuIik7CiAgICByZXR1cm4gdGhpcy5leHRlbnNpb25zLmdldCgiV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjIik7CiAgfTsKICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5zdXBwb3J0c0JsZW5kTWluTWF4ID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5zdXBwb3J0c0JsZW5kTWluTWF4KCkgaXMgbm93IC5leHRlbnNpb25zLmdldCggJ0VYVF9ibGVuZF9taW5tYXgnICkuIik7CiAgICByZXR1cm4gdGhpcy5leHRlbnNpb25zLmdldCgiRVhUX2JsZW5kX21pbm1heCIpOwogIH07CiAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc3VwcG9ydHNWZXJ0ZXhUZXh0dXJlcyA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc3VwcG9ydHNWZXJ0ZXhUZXh0dXJlcygpIGlzIG5vdyAuY2FwYWJpbGl0aWVzLnZlcnRleFRleHR1cmVzLiIpOwogICAgcmV0dXJuIHRoaXMuY2FwYWJpbGl0aWVzLnZlcnRleFRleHR1cmVzOwogIH07CiAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc3VwcG9ydHNJbnN0YW5jZWRBcnJheXMgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnN1cHBvcnRzSW5zdGFuY2VkQXJyYXlzKCkgaXMgbm93IC5leHRlbnNpb25zLmdldCggJ0FOR0xFX2luc3RhbmNlZF9hcnJheXMnICkuIik7CiAgICByZXR1cm4gdGhpcy5leHRlbnNpb25zLmdldCgiQU5HTEVfaW5zdGFuY2VkX2FycmF5cyIpOwogIH07CiAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuZW5hYmxlU2Npc3NvclRlc3QgPSBmdW5jdGlvbihib29sZWFuKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5lbmFibGVTY2lzc29yVGVzdCgpIGlzIG5vdyAuc2V0U2Npc3NvclRlc3QoKS4iKTsKICAgIHRoaXMuc2V0U2Npc3NvclRlc3QoYm9vbGVhbik7CiAgfTsKICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5pbml0TWF0ZXJpYWwgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLmluaXRNYXRlcmlhbCgpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5hZGRQcmVQbHVnaW4gPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLmFkZFByZVBsdWdpbigpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5hZGRQb3N0UGx1Z2luID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5hZGRQb3N0UGx1Z2luKCkgaGFzIGJlZW4gcmVtb3ZlZC4iKTsKICB9OwogIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLnVwZGF0ZVNoYWRvd01hcCA9IGZ1bmN0aW9uKCkgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAudXBkYXRlU2hhZG93TWFwKCkgaGFzIGJlZW4gcmVtb3ZlZC4iKTsKICB9OwogIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLnNldEZhY2VDdWxsaW5nID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5zZXRGYWNlQ3VsbGluZygpIGhhcyBiZWVuIHJlbW92ZWQuIik7CiAgfTsKICBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5hbGxvY1RleHR1cmVVbml0ID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5hbGxvY1RleHR1cmVVbml0KCkgaGFzIGJlZW4gcmVtb3ZlZC4iKTsKICB9OwogIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLnNldFRleHR1cmUgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnNldFRleHR1cmUoKSBoYXMgYmVlbiByZW1vdmVkLiIpOwogIH07CiAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc2V0VGV4dHVyZTJEID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5zZXRUZXh0dXJlMkQoKSBoYXMgYmVlbiByZW1vdmVkLiIpOwogIH07CiAgV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc2V0VGV4dHVyZUN1YmUgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnNldFRleHR1cmVDdWJlKCkgaGFzIGJlZW4gcmVtb3ZlZC4iKTsKICB9OwogIFdlYkdMUmVuZGVyZXIucHJvdG90eXBlLmdldEFjdGl2ZU1pcE1hcExldmVsID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5nZXRBY3RpdmVNaXBNYXBMZXZlbCgpIGlzIG5vdyAuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKS4iKTsKICAgIHJldHVybiB0aGlzLmdldEFjdGl2ZU1pcG1hcExldmVsKCk7CiAgfTsKICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhXZWJHTFJlbmRlcmVyLnByb3RvdHlwZSwgewogICAgc2hhZG93TWFwRW5hYmxlZDogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnNoYWRvd01hcC5lbmFibGVkOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc2hhZG93TWFwRW5hYmxlZCBpcyBub3cgLnNoYWRvd01hcC5lbmFibGVkLiIpOwogICAgICAgIHRoaXMuc2hhZG93TWFwLmVuYWJsZWQgPSB2YWx1ZTsKICAgICAgfQogICAgfSwKICAgIHNoYWRvd01hcFR5cGU6IHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5zaGFkb3dNYXAudHlwZTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnNoYWRvd01hcFR5cGUgaXMgbm93IC5zaGFkb3dNYXAudHlwZS4iKTsKICAgICAgICB0aGlzLnNoYWRvd01hcC50eXBlID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBzaGFkb3dNYXBDdWxsRmFjZTogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnNoYWRvd01hcEN1bGxGYWNlIGhhcyBiZWVuIHJlbW92ZWQuIFNldCBNYXRlcmlhbC5zaGFkb3dTaWRlIGluc3RlYWQuIik7CiAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5zaGFkb3dNYXBDdWxsRmFjZSBoYXMgYmVlbiByZW1vdmVkLiBTZXQgTWF0ZXJpYWwuc2hhZG93U2lkZSBpbnN0ZWFkLiIpOwogICAgICB9CiAgICB9LAogICAgY29udGV4dDogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLmNvbnRleHQgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIC5nZXRDb250ZXh0KCkgaW5zdGVhZC4iKTsKICAgICAgICByZXR1cm4gdGhpcy5nZXRDb250ZXh0KCk7CiAgICAgIH0KICAgIH0sCiAgICB2cjogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnZyIGhhcyBiZWVuIHJlbmFtZWQgdG8gLnhyIik7CiAgICAgICAgcmV0dXJuIHRoaXMueHI7CiAgICAgIH0KICAgIH0sCiAgICBnYW1tYUlucHV0OiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuZ2FtbWFJbnB1dCBoYXMgYmVlbiByZW1vdmVkLiBTZXQgdGhlIGVuY29kaW5nIGZvciB0ZXh0dXJlcyB2aWEgVGV4dHVyZS5lbmNvZGluZyBpbnN0ZWFkLiIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5nYW1tYUlucHV0IGhhcyBiZWVuIHJlbW92ZWQuIFNldCB0aGUgZW5jb2RpbmcgZm9yIHRleHR1cmVzIHZpYSBUZXh0dXJlLmVuY29kaW5nIGluc3RlYWQuIik7CiAgICAgIH0KICAgIH0sCiAgICBnYW1tYU91dHB1dDogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLmdhbW1hT3V0cHV0IGhhcyBiZWVuIHJlbW92ZWQuIFNldCBXZWJHTFJlbmRlcmVyLm91dHB1dEVuY29kaW5nIGluc3RlYWQuIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuZ2FtbWFPdXRwdXQgaGFzIGJlZW4gcmVtb3ZlZC4gU2V0IFdlYkdMUmVuZGVyZXIub3V0cHV0RW5jb2RpbmcgaW5zdGVhZC4iKTsKICAgICAgICB0aGlzLm91dHB1dEVuY29kaW5nID0gdmFsdWUgPT09IHRydWUgPyBzUkdCRW5jb2RpbmcgOiBMaW5lYXJFbmNvZGluZzsKICAgICAgfQogICAgfSwKICAgIHRvbmVNYXBwaW5nV2hpdGVQb2ludDogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnRvbmVNYXBwaW5nV2hpdGVQb2ludCBoYXMgYmVlbiByZW1vdmVkLiIpOwogICAgICAgIHJldHVybiAxOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnRvbmVNYXBwaW5nV2hpdGVQb2ludCBoYXMgYmVlbiByZW1vdmVkLiIpOwogICAgICB9CiAgICB9CiAgfSk7CiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoV2ViR0xTaGFkb3dNYXAucHJvdG90eXBlLCB7CiAgICBjdWxsRmFjZTogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnNoYWRvd01hcC5jdWxsRmFjZSBoYXMgYmVlbiByZW1vdmVkLiBTZXQgTWF0ZXJpYWwuc2hhZG93U2lkZSBpbnN0ZWFkLiIpOwogICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc2hhZG93TWFwLmN1bGxGYWNlIGhhcyBiZWVuIHJlbW92ZWQuIFNldCBNYXRlcmlhbC5zaGFkb3dTaWRlIGluc3RlYWQuIik7CiAgICAgIH0KICAgIH0sCiAgICByZW5kZXJSZXZlcnNlU2lkZWQ6IHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5zaGFkb3dNYXAucmVuZGVyUmV2ZXJzZVNpZGVkIGhhcyBiZWVuIHJlbW92ZWQuIFNldCBNYXRlcmlhbC5zaGFkb3dTaWRlIGluc3RlYWQuIik7CiAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5zaGFkb3dNYXAucmVuZGVyUmV2ZXJzZVNpZGVkIGhhcyBiZWVuIHJlbW92ZWQuIFNldCBNYXRlcmlhbC5zaGFkb3dTaWRlIGluc3RlYWQuIik7CiAgICAgIH0KICAgIH0sCiAgICByZW5kZXJTaW5nbGVTaWRlZDogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJlcjogLnNoYWRvd01hcC5yZW5kZXJTaW5nbGVTaWRlZCBoYXMgYmVlbiByZW1vdmVkLiBTZXQgTWF0ZXJpYWwuc2hhZG93U2lkZSBpbnN0ZWFkLiIpOwogICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc2hhZG93TWFwLnJlbmRlclNpbmdsZVNpZGVkIGhhcyBiZWVuIHJlbW92ZWQuIFNldCBNYXRlcmlhbC5zaGFkb3dTaWRlIGluc3RlYWQuIik7CiAgICAgIH0KICAgIH0KICB9KTsKICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhXZWJHTFJlbmRlclRhcmdldC5wcm90b3R5cGUsIHsKICAgIHdyYXBTOiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLndyYXBTIGlzIG5vdyAudGV4dHVyZS53cmFwUy4iKTsKICAgICAgICByZXR1cm4gdGhpcy50ZXh0dXJlLndyYXBTOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLndyYXBTIGlzIG5vdyAudGV4dHVyZS53cmFwUy4iKTsKICAgICAgICB0aGlzLnRleHR1cmUud3JhcFMgPSB2YWx1ZTsKICAgICAgfQogICAgfSwKICAgIHdyYXBUOiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLndyYXBUIGlzIG5vdyAudGV4dHVyZS53cmFwVC4iKTsKICAgICAgICByZXR1cm4gdGhpcy50ZXh0dXJlLndyYXBUOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLndyYXBUIGlzIG5vdyAudGV4dHVyZS53cmFwVC4iKTsKICAgICAgICB0aGlzLnRleHR1cmUud3JhcFQgPSB2YWx1ZTsKICAgICAgfQogICAgfSwKICAgIG1hZ0ZpbHRlcjogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5tYWdGaWx0ZXIgaXMgbm93IC50ZXh0dXJlLm1hZ0ZpbHRlci4iKTsKICAgICAgICByZXR1cm4gdGhpcy50ZXh0dXJlLm1hZ0ZpbHRlcjsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5tYWdGaWx0ZXIgaXMgbm93IC50ZXh0dXJlLm1hZ0ZpbHRlci4iKTsKICAgICAgICB0aGlzLnRleHR1cmUubWFnRmlsdGVyID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBtaW5GaWx0ZXI6IHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAubWluRmlsdGVyIGlzIG5vdyAudGV4dHVyZS5taW5GaWx0ZXIuIik7CiAgICAgICAgcmV0dXJuIHRoaXMudGV4dHVyZS5taW5GaWx0ZXI7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAubWluRmlsdGVyIGlzIG5vdyAudGV4dHVyZS5taW5GaWx0ZXIuIik7CiAgICAgICAgdGhpcy50ZXh0dXJlLm1pbkZpbHRlciA9IHZhbHVlOwogICAgICB9CiAgICB9LAogICAgYW5pc290cm9weTogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5hbmlzb3Ryb3B5IGlzIG5vdyAudGV4dHVyZS5hbmlzb3Ryb3B5LiIpOwogICAgICAgIHJldHVybiB0aGlzLnRleHR1cmUuYW5pc290cm9weTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5hbmlzb3Ryb3B5IGlzIG5vdyAudGV4dHVyZS5hbmlzb3Ryb3B5LiIpOwogICAgICAgIHRoaXMudGV4dHVyZS5hbmlzb3Ryb3B5ID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBvZmZzZXQ6IHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAub2Zmc2V0IGlzIG5vdyAudGV4dHVyZS5vZmZzZXQuIik7CiAgICAgICAgcmV0dXJuIHRoaXMudGV4dHVyZS5vZmZzZXQ7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oIlRIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAub2Zmc2V0IGlzIG5vdyAudGV4dHVyZS5vZmZzZXQuIik7CiAgICAgICAgdGhpcy50ZXh0dXJlLm9mZnNldCA9IHZhbHVlOwogICAgICB9CiAgICB9LAogICAgcmVwZWF0OiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLnJlcGVhdCBpcyBub3cgLnRleHR1cmUucmVwZWF0LiIpOwogICAgICAgIHJldHVybiB0aGlzLnRleHR1cmUucmVwZWF0OwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLnJlcGVhdCBpcyBub3cgLnRleHR1cmUucmVwZWF0LiIpOwogICAgICAgIHRoaXMudGV4dHVyZS5yZXBlYXQgPSB2YWx1ZTsKICAgICAgfQogICAgfSwKICAgIGZvcm1hdDogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5mb3JtYXQgaXMgbm93IC50ZXh0dXJlLmZvcm1hdC4iKTsKICAgICAgICByZXR1cm4gdGhpcy50ZXh0dXJlLmZvcm1hdDsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5mb3JtYXQgaXMgbm93IC50ZXh0dXJlLmZvcm1hdC4iKTsKICAgICAgICB0aGlzLnRleHR1cmUuZm9ybWF0ID0gdmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICB0eXBlOiB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLnR5cGUgaXMgbm93IC50ZXh0dXJlLnR5cGUuIik7CiAgICAgICAgcmV0dXJuIHRoaXMudGV4dHVyZS50eXBlOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLnR5cGUgaXMgbm93IC50ZXh0dXJlLnR5cGUuIik7CiAgICAgICAgdGhpcy50ZXh0dXJlLnR5cGUgPSB2YWx1ZTsKICAgICAgfQogICAgfSwKICAgIGdlbmVyYXRlTWlwbWFwczogewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5nZW5lcmF0ZU1pcG1hcHMgaXMgbm93IC50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcy4iKTsKICAgICAgICByZXR1cm4gdGhpcy50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwczsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGNvbnNvbGUud2FybigiVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5nZW5lcmF0ZU1pcG1hcHMgaXMgbm93IC50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcy4iKTsKICAgICAgICB0aGlzLnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICB9KTsKICBBdWRpby5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uKGZpbGUpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuQXVkaW86IC5sb2FkIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSBUSFJFRS5BdWRpb0xvYWRlciBpbnN0ZWFkLiIpOwogICAgY29uc3Qgc2NvcGUgPSB0aGlzOwogICAgY29uc3QgYXVkaW9Mb2FkZXIgPSBuZXcgQXVkaW9Mb2FkZXIoKTsKICAgIGF1ZGlvTG9hZGVyLmxvYWQoZmlsZSwgZnVuY3Rpb24oYnVmZmVyKSB7CiAgICAgIHNjb3BlLnNldEJ1ZmZlcihidWZmZXIpOwogICAgfSk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIEF1ZGlvQW5hbHlzZXIucHJvdG90eXBlLmdldERhdGEgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuQXVkaW9BbmFseXNlcjogLmdldERhdGEoKSBpcyBub3cgLmdldEZyZXF1ZW5jeURhdGEoKS4iKTsKICAgIHJldHVybiB0aGlzLmdldEZyZXF1ZW5jeURhdGEoKTsKICB9OwogIEN1YmVDYW1lcmEucHJvdG90eXBlLnVwZGF0ZUN1YmVNYXAgPSBmdW5jdGlvbihyZW5kZXJlciwgc2NlbmUpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuQ3ViZUNhbWVyYTogLnVwZGF0ZUN1YmVNYXAoKSBpcyBub3cgLnVwZGF0ZSgpLiIpOwogICAgcmV0dXJuIHRoaXMudXBkYXRlKHJlbmRlcmVyLCBzY2VuZSk7CiAgfTsKICBDdWJlQ2FtZXJhLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKHJlbmRlcmVyLCBjb2xvciwgZGVwdGgsIHN0ZW5jaWwpIHsKICAgIGNvbnNvbGUud2FybigiVEhSRUUuQ3ViZUNhbWVyYTogLmNsZWFyKCkgaXMgbm93IC5yZW5kZXJUYXJnZXQuY2xlYXIoKS4iKTsKICAgIHJldHVybiB0aGlzLnJlbmRlclRhcmdldC5jbGVhcihyZW5kZXJlciwgY29sb3IsIGRlcHRoLCBzdGVuY2lsKTsKICB9OwogIEltYWdlVXRpbHMuY3Jvc3NPcmlnaW4gPSB2b2lkIDA7CiAgSW1hZ2VVdGlscy5sb2FkVGV4dHVyZSA9IGZ1bmN0aW9uKHVybCwgbWFwcGluZywgb25Mb2FkLCBvbkVycm9yKSB7CiAgICBjb25zb2xlLndhcm4oIlRIUkVFLkltYWdlVXRpbHMubG9hZFRleHR1cmUgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIFRIUkVFLlRleHR1cmVMb2FkZXIoKSBpbnN0ZWFkLiIpOwogICAgY29uc3QgbG9hZGVyID0gbmV3IFRleHR1cmVMb2FkZXIoKTsKICAgIGxvYWRlci5zZXRDcm9zc09yaWdpbih0aGlzLmNyb3NzT3JpZ2luKTsKICAgIGNvbnN0IHRleHR1cmUgPSBsb2FkZXIubG9hZCh1cmwsIG9uTG9hZCwgdm9pZCAwLCBvbkVycm9yKTsKICAgIGlmIChtYXBwaW5nKQogICAgICB0ZXh0dXJlLm1hcHBpbmcgPSBtYXBwaW5nOwogICAgcmV0dXJuIHRleHR1cmU7CiAgfTsKICBJbWFnZVV0aWxzLmxvYWRUZXh0dXJlQ3ViZSA9IGZ1bmN0aW9uKHVybHMsIG1hcHBpbmcsIG9uTG9hZCwgb25FcnJvcikgewogICAgY29uc29sZS53YXJuKCJUSFJFRS5JbWFnZVV0aWxzLmxvYWRUZXh0dXJlQ3ViZSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgVEhSRUUuQ3ViZVRleHR1cmVMb2FkZXIoKSBpbnN0ZWFkLiIpOwogICAgY29uc3QgbG9hZGVyID0gbmV3IEN1YmVUZXh0dXJlTG9hZGVyKCk7CiAgICBsb2FkZXIuc2V0Q3Jvc3NPcmlnaW4odGhpcy5jcm9zc09yaWdpbik7CiAgICBjb25zdCB0ZXh0dXJlID0gbG9hZGVyLmxvYWQodXJscywgb25Mb2FkLCB2b2lkIDAsIG9uRXJyb3IpOwogICAgaWYgKG1hcHBpbmcpCiAgICAgIHRleHR1cmUubWFwcGluZyA9IG1hcHBpbmc7CiAgICByZXR1cm4gdGV4dHVyZTsKICB9OwogIEltYWdlVXRpbHMubG9hZENvbXByZXNzZWRUZXh0dXJlID0gZnVuY3Rpb24oKSB7CiAgICBjb25zb2xlLmVycm9yKCJUSFJFRS5JbWFnZVV0aWxzLmxvYWRDb21wcmVzc2VkVGV4dHVyZSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgVEhSRUUuRERTTG9hZGVyIGluc3RlYWQuIik7CiAgfTsKICBJbWFnZVV0aWxzLmxvYWRDb21wcmVzc2VkVGV4dHVyZUN1YmUgPSBmdW5jdGlvbigpIHsKICAgIGNvbnNvbGUuZXJyb3IoIlRIUkVFLkltYWdlVXRpbHMubG9hZENvbXByZXNzZWRUZXh0dXJlQ3ViZSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgVEhSRUUuRERTTG9hZGVyIGluc3RlYWQuIik7CiAgfTsKICBpZiAodHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXyAhPT0gInVuZGVmaW5lZCIpIHsKICAgIF9fVEhSRUVfREVWVE9PTFNfXy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgicmVnaXN0ZXIiLCB7IGRldGFpbDogewogICAgICByZXZpc2lvbjogUkVWSVNJT04KICAgIH0gfSkpOwogIH0KICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIpIHsKICAgIGlmICh3aW5kb3cuX19USFJFRV9fKSB7CiAgICAgIGNvbnNvbGUud2FybigiV0FSTklORzogTXVsdGlwbGUgaW5zdGFuY2VzIG9mIFRocmVlLmpzIGJlaW5nIGltcG9ydGVkLiIpOwogICAgfSBlbHNlIHsKICAgICAgd2luZG93Ll9fVEhSRUVfXyA9IFJFVklTSU9OOwogICAgfQogIH0KCiAgLy8gc291cmNlL2NhbnZhcy9vYmplY3RzL3BsYXllcnMvVGVycml0b3J5Lndvcmtlci5qcwogIHN1YnRyYWN0ID0gZnVuY3Rpb24oZGF0YSkgewogICAgY29uc3QgeyBwb2ludHNBLCBwb2ludHNCIH0gPSBkYXRhOwogICAgcmV0dXJuIHBvbHlnb24uc3VidHJhY3QocG9pbnRzQSwgcG9pbnRzQik7CiAgfTsKICBleHRydWRlID0gZnVuY3Rpb24oZGF0YSkgewogICAgY29uc3QgeyBwb2ludHMsIGhlaWdodCB9ID0gZGF0YTsKICAgIGNvbnN0IHNoYXBlID0gbmV3IFNoYXBlKCk7CiAgICBjb25zdCBiZXZlbFRoaWNrbmVzcyA9IDAuNzU7CiAgICBmb3IgKGxldCBpID0gMCwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgY29uc3QgeyB4LCB6IH0gPSBwb2ludHNbaV07CiAgICAgIGNvbnN0IHkgPSB6ICogLTE7CiAgICAgIGlmIChpID09PSAwKQogICAgICAgIHNoYXBlLm1vdmVUbyh4LCB5KTsKICAgICAgZWxzZQogICAgICAgIHNoYXBlLmxpbmVUbyh4LCB5KTsKICAgIH0KICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IEV4dHJ1ZGVHZW9tZXRyeShzaGFwZSwgewogICAgICBkZXB0aDogaGVpZ2h0IC0gYmV2ZWxUaGlja25lc3MgKiAyLAogICAgICBiZXZlbEVuYWJsZWQ6IHRydWUsCiAgICAgIGJldmVsU2l6ZTogMC43NSwKICAgICAgYmV2ZWxUaGlja25lc3MKICAgIH0pOwogICAgZ2VvbWV0cnkucm90YXRlWCgtTWF0aC5QSSAqIDAuNSk7CiAgICBnZW9tZXRyeS50cmFuc2xhdGUoMCwgaGVpZ2h0LCAwKTsKICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShnZW9tZXRyeS5hdHRyaWJ1dGVzKTsKICB9OwogIG9ubWVzc2FnZSA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBjb25zdCB7IG1lc3NhZ2VJRCwgbWVzc2FnZSwgZXJyb3IgfSA9IGV2ZW50LmRhdGE7CiAgICBjb25zdCB7IHR5cGUgfSA9IG1lc3NhZ2U7CiAgICBpZiAodHlwZSA9PT0gInN1YnRyYWN0IikKICAgICAgcG9zdE1lc3NhZ2UoeyBtZXNzYWdlSUQsIGVycm9yLCBtZXNzYWdlOiBzdWJ0cmFjdChtZXNzYWdlKSB9KTsKICAgIGlmICh0eXBlID09PSAiZXh0cnVkZSIpCiAgICAgIHBvc3RNZXNzYWdlKHsgbWVzc2FnZUlELCBlcnJvciwgbWVzc2FnZTogZXh0cnVkZShtZXNzYWdlKSB9KTsKICB9OwogIHZhciBUZXJyaXRvcnlfd29ya2VyX2RlZmF1bHQgPSBzZWxmOwp9KSgpOwovKioKICogQGxpY2Vuc2UKICogQ29weXJpZ2h0IDIwMTAtMjAyMSBUaHJlZS5qcyBBdXRob3JzCiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKICovCg==")],{type:"text/javascript;charset=utf-8"});function jX(){const i=(window.URL||window.webkitURL).createObjectURL(QX);try{return new Worker(i)}finally{(window.URL||window.webkitURL).revokeObjectURL(i)}}class PX extends UV{constructor(){super(),this.geometry=new $V}reset(V){this.animation&&this.animation.remove(this.position),this.territory=V,this.height=V.height,this.bevelThickness=.75,this.bevelSize=.25,this.position.set(0,.001,0),!this.children.length&&(this.setOuterMesh(),this.setInnerMesh(),this.setStencilMesh())}setFromPoints(V){const g=new gn;for(let e=0,t=V.length;e<t;e++){const{x:C,z:A}=V[e],s=A*-1;e===0?g.moveTo(C,s):g.lineTo(C,s)}const I=new vt(g,{depth:this.height,bevelEnabled:!1});I.rotateX(-Math.PI*.5),I.translate(0,this.height*.5,0),I.dispose(),this.geometry.copy(I);for(const e of this.children)e.geometry=this.geometry}setOuterMesh(){const{materials:V}=XV.assets,{territoryID:g}=this.territory,I=V[g],e=new og(this.geometry,I);e.castShadow=!0,e.receiveShadow=!0,this.add(e)}setInnerMesh(){const{materials:V}=XV.assets,{territoryID:g}=this.territory,I=V[g],e=new og(this.geometry,I);e.renderOrder=XV.renderOrders.Trail,e.castShadow=!1,e.receiveShadow=!0,this.add(e),e.position.y=.001,e.scale.y=.001}setStencilMesh(){const{materials:V}=XV.assets,{stencilID:g}=this.territory,I=V[g],e=new og(this.geometry,I);e.renderOrder=XV.renderOrders.Stencil,this.add(e)}animate(){return SV(this,null,function*(){return this.position.y=-(this.height+1),this.animation&&this.animation.remove(this.position),this.animation=LV({targets:this.position,easing:"easeOutExpo",duration:1250,y:.001}),this.animation.finished})}}class OX extends UV{constructor(V){super(),autobind(this),this.player=V;const{playerID:g,stencilRef:I}=this.player;this.territoryID=`Territory_00${g}`,this.stencilID=`Stencil_00${g}`;const{materials:e}=XV.assets;e[this.territoryID]=e.Territory.clone(),e[this.stencilID]=e.Stencil.clone(),e[this.stencilID].stencilRef=I,this.points=[],this.path=[],this.height=1,this.opacity=1,this.offsetY=0,this.percentCoveredDelay=600,this.thread=new EX(new jX),this.boundingBox=new pg,this.center=new S,this.size=new S,this.shapes=new VI(PX,t=>t.reset(this)),q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){this.player.addEventListener("reset",this.onPlayerReset),this.player.addEventListener("return",this.onPlayerReturn),this.player.addEventListener("exit",this.onPlayerExit),this.player.addEventListener("die",this.onPlayerDie),this.player.addEventListener("revive",this.onPlayerRevive),q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(V){const{currentViewID:g}=V;this.isHidden=!g.match(/(Game|GameOver)/g)}onPlayerReset(){return SV(this,null,function*(){console.log("onPlayerReset (",this.player.name,")"),this.setPercentCoveredInterval&&clearInterval(this.setPercentCoveredInterval),this.setPercentCoveredInterval=setInterval(()=>{this.setPercentCovered()},this.percentCoveredDelay),this.animation&&this.animation.remove(this);const{arena:V}=XV.scene,{character:g,isUser:I,bonusID:e}=this.player;for(;this.children.length;){const n=this.children[0];this.remove(n),this.shapes.release(n)}this.shape=this.shapes.get(),this.add(this.shape),this.area=0,this.points=[];const t=5,C=Math.PI*2/t,A=I?e==="Bigger"?50:15:Math.randFloat(15,35),s=A*.25;for(let n=0;n<t;n++){const l=C*n,c=new S,d=A+Math.randFloat(-s,s);c.setX(Math.cos(l)).setZ(Math.sin(l)).multiplyScalar(d).add(g.position).clampLength(0,V.radius),this.points.push(c)}const a=q.settings.quality.territory,o=new bl(this.points,!0);this.points=o.getPoints(A*(a+1)),this.setBoundingBox(),this.enter()})}onPlayerExit(){const{character:V}=this.player;this.path=[V.position.clone()]}onPlayerReturn(){this.merge()}onPlayerDie(){console.log("onPlayerDie (",this.player.name,")"),this.setPercentCoveredInterval&&clearInterval(this.setPercentCoveredInterval),this.setPercentCovered(),this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"easeOutExpo",duration:2e3,delay:250,opacity:0,offsetY:-(this.height+1)})}onPlayerRevive(){console.log("onPlayerRevive (",this.player.name,")"),this.crop(),this.enter(),this.setPercentCoveredInterval&&clearInterval(this.setPercentCoveredInterval),this.setPercentCoveredInterval=setInterval(()=>{this.setPercentCovered()},this.percentCoveredDelay)}update(){this.path.length>3e3&&this.path.shift();const V=5-q.settings.quality.territory;if(q.inGame&&q.time.frame%V===0){const{character:I}=this.player;this.path.push(I.position.clone())}const{materials:g}=XV.assets;g[this.territoryID].opacity=this.opacity,this.position.y=this.offsetY,this.visible=!this.isHidden&&this.opacity>.01}enter(){this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"easeOutExpo",duration:1e3,opacity:1,offsetY:0})}contains(V){return this.boundingBox.containsPoint(V)?this.containsPoint(V,this.points):!1}merge(V=!1){return SV(this,null,function*(){if(!this.path.length)return;this.isClockwise(this.path)&&this.path.reverse(),this.isClockwise(this.points)&&this.points.reverse(),V&&this.path.reverse();const g=this.getArea(this.points);this.oldPoints=this.points;const I=this.path.getFirst(),e=this.path.getLast(),t=this.getNearestPointIDsFrom2Points(I,e),C=t.min,A=t.max,s=C<A?Array.from(this.points.slice(C,A)).reverse().concat(this.path):Array.from(this.points.slice(C)).concat(this.points.slice(0,A)).reverse().concat(this.path),a=C<A?Array.from(this.points.slice(0,C)).concat(this.path).concat(this.points.slice(A)):Array.from(this.path).concat(this.points.slice(A,C));if(this.getArea(a)-g<0)return V?void 0:this.merge(!0);if(this.points=a,this.setBoundingBox(),this.points.length<5){this.points=this.oldPoints,this.crop();return}yield this.crop(s)})}crop(V){return SV(this,null,function*(){const g=Array.from(q.players).shuffle();this.setBoundingBox(),yield Promise.all(g.map(I=>{const{territory:e}=I;if(I!==this.player)return I.bonusID==="Shield"?this.subtract(e.points,I):e.subtract(this.points,this.player)})),this.setShape(V)})}subtract(V,g){return SV(this,null,function*(){if(!this.points.length||!V.length)return;const I=pg.get().setFromPoints(V);if(pg.release(I),!this.boundingBox.intersectsBox(I))return;const e=new Array(this.points.length),t=new Array(V.length);for(let n=0,l=this.points.length;n<l;n++){const{x:c,z:d}=this.points[n];e[n]=[c,d]}for(let n=0,l=V.length;n<l;n++){const{x:c,z:d}=V[n];t[n]=[c,d]}const C=yield this.thread.send({type:"subtract",pointsA:e,pointsB:t});if(!C.length)return this.points=[],this.setShape();let A=1/0,s=null;const a=C.map((n,l)=>{const{character:c,inOwnTerritory:d}=this.player,{position:h}=c,{path:m}=this,r=new Array(n.length);for(let u=0,b=n.length;u<b;u++){const[Z,p]=n[u];r[u]=new S(Z,0,p)}if(d)this.containsPoint(h,r)&&(s=l);else{const u=m[0];for(let b=0,Z=r.length;b<Z;b++){const p=u.distanceTo(r[b]);p>A||(A=p,s=l)}}return r});(A!==1/0&&A>2||s===null)&&g.kill(this.player),this.points=a[s]||[],this.setShape()})}setShape(V){return SV(this,null,function*(){if(this.setBoundingBox(),V){const g=this.shapes.get();g.setFromPoints(V),this.add(g),yield g.animate(),this.shapes.release(g),this.remove(g)}this.shape.setFromPoints(this.points)})}setBoundingBox(){this.boundingBox.setFromPoints(this.points),this.boundingBox.getCenter(this.center),this.boundingBox.getSize(this.size),this.area=this.getArea(this.points)}setPercentCovered(){const{arena:V}=XV.scene,g=Math.round(this.area/V.area*100*100)/100;if(g===this.percentCovered)return;const I=Math.round((g-this.percentCovered)*100)/100;this.percentCovered=g,this.percentCovered=parseInt(this.percentCovered*q.scoreCoef),I>0&&this.player.overhead.set(`+${I}%`)}getArea(V){let g=0;for(let I=V.length-1,e=0;e<V.length;I=e++)g+=V[I].x*V[e].z-V[e].x*V[I].z;return Math.abs(g*.5)}getNearestPointID(V){let g=1/0,I=null;for(let e=0,t=this.points.length;e<t;e++){const C=this.points[e],A=V.distanceTo(C);A>g||(g=A,I=e)}return I}getNearestPointIDs(V,g=2){const e=Array.from(this.points).sort((t,C)=>{const A=V.distanceTo(t),s=V.distanceTo(C);return A-s}).slice(0,g).map(t=>this.points.indexOf(t));return g===1?e[0]:e}getNearestPointIDsFrom2Points(V,g){const I=[],e=[];for(let A=0,s=this.points.length;A<s;A++){const a=this.points[A];I[A]={index:A,distance:V.distanceTo(a)},e[A]={index:A,distance:g.distanceTo(a)}}I.sort((A,s)=>A.distance-s.distance),e.sort((A,s)=>A.distance-s.distance);let t=I[0].index,C=e[0].index;return t===C&&(I[1].distance<e[1].distance?t=I[1].index:C=e[1].index),{min:t,max:C}}containsPoint(V,g){let I=!1;const{x:e,z:t}=V;for(let C=0,A=g.length-1;C<g.length;A=C++){const s=g[C].x,a=g[C].z,o=g[A].x,n=g[A].z;a>t!=n>t&&e<(o-s)*(t-a)/(n-a)+s&&(I=!I)}return I}isClockwise(V){let g=0;for(let I=0,e=V.length;I<e;I++){const t=(I+1)%V.length;g+=V[I].x*V[t].z,g-=V[t].x*V[I].z}return g/2>0}}class _X extends og{constructor(V){const{objects:g,geometries:I,materials:e}=XV.assets;I["glb/Crown"];const t=e.Crown;super(),autobind(this);const C=new $I;this.add(C);const A=g["glb/Crown"].clone();A.material=t,C.add(A),this.player=V,this.visible=!1,this.castShadow=!0,this.receiveShadow=!0,this.scaleFactor=0,this.angle=0,q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(V){const{currentViewID:g}=V;this.isHidden=g!=="Game",this.isHidden&&this.exit()}enter(){this.isEntered||(this.isEntered=!0,this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"easeOutElastic(1, .6)",duration:1e3,scaleFactor:1}))}exit(){!this.isEntered||(this.isEntered=!1,this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"easeOutExpo",duration:250,scaleFactor:0}))}update(){if(!this.player.character.placeholder)return;const V=this.isHidden||this.player.isDead;this[this.player.isKing&&!V?"enter":"exit"]();const{character:g}=this.player,I=g.placeholder.getWorldPosition(S.get());this.position.copy(I),S.release(I);const{elapsedTime:e}=q.time,t=Math.sin(e*.01)*.1;this.rotation.y+=.05,this.position.y+=t,this.scale.setScalar(1+t).multiplyScalar(this.scaleFactor),this.visible=this.scaleFactor>.01}}const $X=new RegExp(/[\n\r]/,"g"),uc=new RegExp(/[ ]/,"g");class VR{constructor(V,g,I){this.data=V,this.fontHeight=this.data.common.lineHeight,this.fontBaseline=this.data.common.base,this.fontScaleH=this.data.common.scaleH,this.fontScaleW=this.data.common.scaleW,this.style={fontSize:1,letterSpacing:0,wordSpacing:0,lineHeight:1,maxWidth:1/0,wordBreak:!1,textAlign:"left"},this.leaveWhiteSpace=I.leaveWhiteSpace,this.getGlyphCount(g),this.getGlyphMap(),this.setStyle(I),this.getXHeight(I),this.compute()}getXHeight(){const V=this.map.e;this.xHeight=V.height*this.fontScale,this.xPosition=(V.height*.5+V.yoffset)*this.fontScale}getGlyphCount(V=""){V!==this.text&&(this.text=V,this.glyphCount=V.replace(/[ \n]/g,"").length)}getGlyphMap(){this.map||(this.map=this.data.chars.reduce((V,g)=>(V[g.char]=g,V),{}))}setStyle(V={}){this.style=Object.assign({},this.style,V),this.fontScale=this.style.fontSize/this.fontBaseline}getKerning(V,g){for(let I=0,e=this.data.kernings.length;I<e;I++){const t=this.data.kernings[I];if(t.first===V&&t.second===g||t.first===g&&t.second===V)return t.amount}return 0}addLine(){const V={width:0,characters:[]};return this.word=0,this.lines.push(V),V}cleanLine(V){if(this.leaveWhiteSpace)return;let g=V.characters.getLast();for(;g.glyph.char===" ";){const I=g.glyph,e=this.style.wordSpacing*this.style.fontSize+I.xadvance*this.fontScale;V.width-=e,V.characters.pop(),g=V.characters.getLast()}}compute(){this.lines=[];let V=0,g=this.addLine(V);for(;V<this.text.length;){let I=0;const e=this.text[V],t=this.map[e];if($X.test(e)){V++,this.cleanLine(g),g=this.addLine(V);continue}if(!this.leaveWhiteSpace&&g.width===0&&uc.test(e)){V++;continue}if(t===void 0){V++;continue}g.characters.push({glyph:t,x:g.width}),uc.test(e)?I+=this.style.wordSpacing*this.style.fontSize:I+=this.style.letterSpacing*this.style.fontSize,I+=t.xadvance*this.fontScale,g.width+=I,V++}g.width||this.lines.pop()}}var gR=`#define STANDARD\r
\r
varying vec3 vViewPosition;\r
\r
#ifndef FLAT_SHADED\r
\r
	varying vec3 vNormal;\r
\r
	#ifdef USE_TANGENT\r
\r
		varying vec3 vTangent;\r
		varying vec3 vBitangent;\r
\r
	#endif\r
\r
#endif\r
\r
#ifdef USE_TRANSMISSION\r
\r
	varying vec4 vWorldPosition;\r
\r
#endif\r
\r
#include <common>\r
#include <uv_pars_vertex>\r
#include <uv2_pars_vertex>\r
#include <displacementmap_pars_vertex>\r
#include <color_pars_vertex>\r
#include <fog_pars_vertex>\r
#include <morphtarget_pars_vertex>\r
#include <skinning_pars_vertex>\r
#include <shadowmap_pars_vertex>\r
#include <logdepthbuf_pars_vertex>\r
#include <clipping_planes_pars_vertex>\r
\r
attribute vec4 coordinates;\r
\r
uniform float elapsedTime;\r
varying vec2 vCoordinates;\r
\r
void main() {\r
\r
	vCoordinates = uv;\r
	vCoordinates *= coordinates.zw;\r
	vCoordinates += coordinates.xy;\r
\r
	#include <uv_vertex>\r
	#include <uv2_vertex>\r
	#include <color_vertex>\r
\r
	#include <beginnormal_vertex>\r
	#include <morphnormal_vertex>\r
	#include <skinbase_vertex>\r
	#include <skinnormal_vertex>\r
	#include <defaultnormal_vertex>\r
\r
#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\r
\r
	vNormal = normalize( transformedNormal );\r
\r
	#ifdef USE_TANGENT\r
\r
		vTangent = normalize( transformedTangent );\r
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\r
\r
	#endif\r
\r
#endif\r
\r
	#include <begin_vertex>\r
	#include <morphtarget_vertex>\r
	#include <skinning_vertex>\r
	#include <displacementmap_vertex>\r
	#include <project_vertex>\r
	#include <logdepthbuf_vertex>\r
	#include <clipping_planes_vertex>\r
\r
	vViewPosition = - mvPosition.xyz;\r
\r
	#include <worldpos_vertex>\r
	#include <shadowmap_vertex>\r
	#include <fog_vertex>\r
\r
#ifdef USE_TRANSMISSION\r
\r
	vWorldPosition = worldPosition;\r
\r
#endif\r
}\r
`,IR=`#define STANDARD\r
\r
#ifdef PHYSICAL\r
	#define REFLECTIVITY\r
	#define CLEARCOAT\r
#endif\r
\r
uniform vec3 diffuse;\r
uniform vec3 emissive;\r
uniform float roughness;\r
uniform float metalness;\r
uniform float opacity;\r
\r
#ifdef USE_TRANSMISSION\r
	uniform float transmission;\r
	uniform float thickness;\r
	uniform vec3 attenuationColor;\r
	uniform float attenuationDistance;\r
#endif\r
\r
#ifdef REFLECTIVITY\r
	uniform float reflectivity;\r
#endif\r
\r
#ifdef CLEARCOAT\r
	uniform float clearcoat;\r
	uniform float clearcoatRoughness;\r
#endif\r
\r
#ifdef USE_SHEEN\r
	uniform vec3 sheen;\r
#endif\r
\r
varying vec3 vViewPosition;\r
\r
#ifndef FLAT_SHADED\r
\r
	varying vec3 vNormal;\r
\r
	#ifdef USE_TANGENT\r
\r
		varying vec3 vTangent;\r
		varying vec3 vBitangent;\r
\r
	#endif\r
\r
#endif\r
\r
#include <common>\r
#include <packing>\r
#include <dithering_pars_fragment>\r
#include <color_pars_fragment>\r
#include <uv_pars_fragment>\r
#include <uv2_pars_fragment>\r
#include <map_pars_fragment>\r
#include <alphamap_pars_fragment>\r
#include <aomap_pars_fragment>\r
#include <lightmap_pars_fragment>\r
#include <emissivemap_pars_fragment>\r
#include <bsdfs>\r
#include <transmission_pars_fragment>\r
#include <cube_uv_reflection_fragment>\r
#include <envmap_common_pars_fragment>\r
#include <envmap_physical_pars_fragment>\r
#include <fog_pars_fragment>\r
#include <lights_pars_begin>\r
#include <lights_physical_pars_fragment>\r
#include <shadowmap_pars_fragment>\r
#include <bumpmap_pars_fragment>\r
#include <normalmap_pars_fragment>\r
#include <clearcoat_pars_fragment>\r
#include <roughnessmap_pars_fragment>\r
#include <metalnessmap_pars_fragment>\r
#include <logdepthbuf_pars_fragment>\r
#include <clipping_planes_pars_fragment>\r
\r
uniform sampler2D SDFMap;\r
uniform float elapsedTime;\r
uniform vec3 color;\r
uniform vec3 strokeColor;\r
uniform float strokeWidth;\r
\r
varying vec2 vCoordinates;\r
\r
float median( float r, float g, float b ) {\r
\r
	return max( min( r, g ), min( max( r, g ), b ) );\r
\r
}\r
\r
vec4 getDiffuse() {\r
\r
	vec3 texelColor = texture2D( SDFMap, vCoordinates ).rgb;\r
	float signedDistance = median( texelColor.r, texelColor.g, texelColor.b ) - .5;\r
	float smoothing = fwidth( signedDistance );\r
\r
	float alpha = smoothstep( -smoothing, smoothing, signedDistance );\r
	float stroke = smoothstep( -smoothing, smoothing, signedDistance - strokeWidth );\r
\r
	return vec4( strokeColor, ( alpha - stroke ) * opacity );\r
\r
}\r
\r
void main() {\r
\r
	#include <clipping_planes_fragment>\r
\r
	vec4 diffuseColor = getDiffuse();\r
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r
	vec3 totalEmissiveRadiance = emissive;\r
\r
	#include <logdepthbuf_fragment>\r
	#include <map_fragment>\r
	#include <color_fragment>\r
	#include <alphamap_fragment>\r
	#include <alphatest_fragment>\r
	#include <roughnessmap_fragment>\r
	#include <metalnessmap_fragment>\r
	#include <normal_fragment_begin>\r
	#include <normal_fragment_maps>\r
	#include <clearcoat_normal_fragment_begin>\r
	#include <clearcoat_normal_fragment_maps>\r
	#include <emissivemap_fragment>\r
\r
	// accumulation\r
	#include <lights_physical_fragment>\r
	#include <lights_fragment_begin>\r
	#include <lights_fragment_maps>\r
	#include <lights_fragment_end>\r
\r
	// modulation\r
	#include <aomap_fragment>\r
\r
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\r
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\r
\r
	#include <transmission_fragment>\r
\r
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\r
\r
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );\r
\r
	#include <tonemapping_fragment>\r
	#include <encodings_fragment>\r
	#include <fog_fragment>\r
	#include <premultiplied_alpha_fragment>\r
	#include <dithering_fragment>\r
\r
}\r
`;class Gt extends Hg{constructor(V={}){Gt.prototype.SDFMap=null,Gt.prototype.strokeColor=null,Gt.prototype.strokeWidth=null,Gt.prototype.onlyStroke=null,Gt.prototype.elapsedTime=null,super(V),autobind(this),this.type="StandardMaterial",this.vertexShader=gR,this.fragmentShader=IR,this.transparent=!0,this.uniforms=Object.assign({SDFMap:{value:V.SDFMap},strokeColor:{value:new NV},strokeWidth:{value:V.strokeWidth},onlyStroke:{value:V.onlyStroke},pixelRatio:{value:1},elapsedTime:{value:0}},St.clone(tI.standard.uniforms)),q.addEventListener("update",this.update)}update(){const{pixelRatio:V}=XV.renderer;this.uniforms.pixelRatio.value=V,this.uniforms.elapsedTime.value=q.time.elapsedTime}}class eR extends Ji{constructor(V,g){const e=new Ft,t=new Gt({SDFMap:g,transparent:!0,opacity:.35,roughness:1,metalness:.75});super(e,t,35),autobind(this),this.SDFData=V,this.SDFMap=g,this.objects=Array.from({length:35},()=>new UV);for(const C of this.objects)this.add(C);this.size=new S,this.boundingBox=new pg,this.boundingSphere=new XI,this.frustumCulled=!0,this.coordinates=new Nd(new Float32Array(35*4),4),this.geometry.setAttribute("coordinates",this.coordinates)}setParameters(V="Text",{fontSize:g=1,textAlign:I="center",strokeColor:e="#ffffff",color:t="#000000",strokeWidth:C=1,lineHeight:A=1,leaveWhiteSpace:s,wordLength:a}={}){this.content=V,this.material.color.set(t),this.material.uniforms.strokeColor.value.set(e),this.material.uniforms.strokeWidth.value=C,this.layout=new VR(this.SDFData,V,{fontSize:g,textAlign:I,lineHeight:A,wordLength:a,leaveWhiteSpace:s}),this.style=this.layout.style,this.fontScale=this.layout.fontScale,this.instanceMatrix.needsUpdate=!0,this.coordinates.needsUpdate=!0,this.setLines()}setLines(){this.boundingBox.makeEmpty();for(let V=0,g=this.objects.length;V<g;V++){const I=this.objects[V];I.scale.setScalar(0),I.position.setScalar(0),I.updateMatrixWorld(),this.setMatrixAt(V,I.matrix)}this.y=.07*this.style.fontSize,this.line=0,this.index=0;for(let V=0,g=this.layout.lines.length;V<g;V++)this.setLine(this.layout.lines[V],V);this.boundingBox.getSize(this.size),this.boundingBox.getBoundingSphere(this.boundingSphere),this.geometry.boundingSphere=this.boundingSphere}setLine(V){const g=dV.get(),I=eg.get(),e=new RegExp(/[ ]/,"g"),{scaleW:t,scaleH:C}=this.SDFData.common;for(let A=0;A<V.characters.length;A++){const a=V.characters[A].glyph,o=this.objects[this.index];if(g.x=V.characters[A].x,g.y=this.y,e.test(a.char))continue;this.style.textAlign==="center"?g.x-=V.width*.5:this.style.textAlign==="right"&&(g.x-=V.width),g.x+=a.xoffset*this.fontScale,g.x+=a.width*this.fontScale*.5;let n=a.yoffset*this.fontScale;n+=a.height*this.fontScale*.5,g.y-=n-.5;const l=a.width*this.fontScale,c=a.height*this.fontScale,d=a.x/t,h=a.width/t,m=a.height/C,r=1-a.y/C-m;o.scale.set(l,c,1),o.position.copy(g).setZ(this.index*.001),o.updateMatrixWorld(),I.set(d,r,h,m),I.toArray(this.coordinates.array,this.index*4),this.boundingBox.expandByPoint(g),this.setMatrixAt(this.index,o.matrix),this.index++}this.y-=this.style.lineHeight*1.2*this.style.fontSize,this.line++,dV.release(g),eg.release(I)}}class bc extends eR{constructor(V){const{jsons:g,textures:I}=XV.assets,e=g["fonts/AvenirNextRoundedBold"],t=I["fonts/AvenirNextRoundedBold"];t.flipY=!0,super(e,t),autobind(this),this.receiveShadow=!0,this.renderOrder=XV.renderOrders.Text,this.setParameters(V)}}class tR extends UV{constructor(V){super(),autobind(this),this.player=V,this.scaleFactor=0,XV.assets.loadFont("AvenirNextRoundedBold").then(()=>{this.name=new bc("Name"),this.name.scale.setScalar(1.5),this.add(this.name)}),this.texts=new VI(bc),q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}set(V="+1 Kill"){return SV(this,null,function*(){if(this.player.isBot)return;const g=(this.children.length-1)*500,I=this.texts.get();I.setParameters(V),I.visible=!1,this.add(I),yield q.time.wait(g);const{position:e,scale:t,material:C}=I,A="linear";t.setScalar(2.5),e.set(0,3.5,0),C.opacity=.35,I.visible=!0,yield Promise.all([LV({targets:e,easing:A,y:10}),LV({targets:C,easing:A,opacity:0})].map(s=>s.finished)),this.texts.release(I),this.remove(I)})}enter(){this.isEntered||(this.isEntered=!0,this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"spring(1, 75, 7.5, 0)",duration:1e3,delay:500,scaleFactor:1}))}exit(){!this.isEntered||(this.isEntered=!1,this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"easeOutExpo",duration:200,scaleFactor:0}))}onViewChange(V){const{currentViewID:g}=V;this.isHidden=!g.match(/(Game|GameOver)/g)}update(){if(!this.player.character.placeholder)return;const{character:V,name:g,isDead:I}=this.player;V.placeholder.getWorldPosition(this.position),this.name&&this.name.content!==g&&this.name.setParameters(g);const e=this.isHidden||I;this[e?"exit":"enter"]();const{elapsedTime:t}=q.time,C=Math.sin(t*.001)*.05;this.position.y+=5,this.quaternion.copy(XV.camera.quaternion),this.scale.setScalar(1-C).multiplyScalar(this.scaleFactor),this.visible=this.scaleFactor>.01}}class CR extends Ji{constructor(V){const g=new S,I=Array.from({length:20},()=>new UV),e=I.map(o=>{const n=new ZI.exports.Body({mass:.001});g.setScalar(o.scale.getComponent(0)).multiplyScalar(.5),n.addShape(new ZI.exports.Box(new ZI.exports.Vec3().copy(g))),n.position.copy(o.position),n.quaternion.copy(o.quaternion);const{settings:l,groups:c}=XV.physics;return n.material=l.Particles,n.collisionFilterGroup=c.Particles,n.collisionFilterMask=c.Arena,XV.physics.add(n),n}),{materials:t}=XV.assets,{playerID:C}=V,A=new ft,s=t.Particles.clone();super(A,s,I.length),autobind(this),this.player=V,this.objects=I,this.bodies=e,this.particlesID=`Particles_00${C}`,this.castShadow=!0,this.receiveShadow=!0,this.isAnimating=!1,this.boundingBox=new pg,this.boundingSphere=new XI;const a=new NV;for(let o=0,n=I.length;o<n;o++)this.setColorAt(o,a);t[this.particlesID]=s,q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){this.player.addEventListener("die",this.onPlayerDie),q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(V){const{currentViewID:g}=V;this.isHidden=!g.match(/(Game|GameOver)/)}update(){const{particles:V}=q.settings.quality;if(!V){for(const t of this.bodies)t.isDisabled=!0;return this.visible=!1}const{radius:g}=XV.scene.arena,I=S.get();for(const t of this.bodies){const{x:C,z:A}=t.position;I.set(C,0,A),this.boundingBox.expandByPoint(t.position),t.collisionResponse=I.length()<g,t.isDisabled=!this.isAnimating||this.isHidden}S.release(I),this.boundingBox.getBoundingSphere(this.boundingSphere);const e=XV.camera.intersects(this.boundingSphere);if(this.visible=!this.isHidden&&this.isAnimating&&e,!!this.visible){for(let t=0,C=this.objects.length;t<C;t++){const A=this.objects[t];if(A.scaleFactor<.01)continue;const s=this.bodies[t];A.scale.setScalar(A.scaleFactor),A.position.copy(s.position),A.quaternion.copy(s.quaternion),A.updateMatrixWorld(),this.setMatrixAt(t,A.matrixWorld)}this.instanceMatrix.needsUpdate=!0}}onPlayerDie(){this.isAnimating=!0;const{character:V}=this.player,g=S.get(),I=Rg.get(),e=S.get(),t=S.get(),C=S.get(),A=NV.get(),s=S.get().set(0,2,0);for(let a=0,o=this.bodies.length;a<o;a++){const n=this.bodies[a],l=this.objects[a],c=Math.randFloat(0,Math.PI*2);I.setFromAxisAngle(g.randomize(),c),e.randomize(Math.randFloat(0,2.5)).add(V.position).add(s),t.randomize(Math.randFloat(15,25)),t.y+=25,C.randomize(Math.randFloat(15,25)),n.position.copy(e),n.quaternion.copy(I),n.velocity.copy(t),n.angularVelocity.copy(C),l.scaleFactor=Math.randFloat(.5,1),A.set(this.getColor()),this.setColorAt(a,A)}this.animation&&this.animation.remove(this),this.animation=LV({targets:this.objects,easing:"easeInElastic(1, .6)",delay:LV.stagger(25,{start:2500}),duration:1e3,scaleFactor:0,complete:()=>this.isAnimating=!1}),this.instanceColor.needsUpdate=!0,S.release(s,g,e,t,C),Rg.release(I),NV.release(A)}getColor(){const{colors:V}=this.player.character,g=[8,2,2],I=g.reduce((t,C)=>t+C);let e=Math.random()*I;for(let t=0,C=g.length;t<C;t++){const A=g[t];if(e<A)return V[t];e-=A}}}class iR extends Ji{constructor(V){const g=Array.from({length:25},()=>{const C=new UV;return C.velocity=new S,C.angularVelocity=new S,C}),{textures:I}=XV.assets,e=new ft,t=new Hg({envMap:I.EnvMap,metalness:.05,roughness:.75});super(e,t,g.length),autobind(this),this.player=V,this.objects=g,this.castShadow=!0,this.receiveShadow=!0,this.side=1,this.index=0,this.velocity=new S,this.gravity=new S(0,-.5,0),this.color=new NV,this.boundingBox=new pg,this.boundingSphere=new XI;for(let C=0,A=g.length;C<A;C++)this.setColorAt(C,this.color);q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update)}update(){const{particles:V}=q.settings.quality;if(!V)return this.visible=!1;this.boundingBox.makeEmpty();for(let I=0,e=this.objects.length;I<e;I++){const t=this.objects[I],{position:C,velocity:A,rotation:s,angularVelocity:a}=t;C.add(A),C.add(this.gravity),A.multiplyScalar(.95),s.x+=a.x,s.y+=a.y,s.z+=a.z,t.isHidden=C.y<-1,!t.isHidden&&(t.updateMatrixWorld(),this.boundingBox.expandByPoint(C),this.setMatrixAt(I,t.matrixWorld))}this.visible=!1,this.boundingBox.getBoundingSphere(this.boundingSphere);const g=XV.camera.intersects(this.boundingSphere);for(const I of this.objects)g&&!I.isHidden&&(this.visible=!0);this.instanceMatrix.needsUpdate=!0}emit(V){return SV(this,null,function*(){this.side*=-1;const{position:g,scale:I,velocity:e,angularVelocity:t}=this.objects[this.index],{character:C}=this.player,A=S.get().setX(this.side*Math.randFloat(1,2)).setZ(2).applyQuaternion(C.quaternion);I.setScalar(Math.randFloat(.5,1)),t.randomize(.1),e.setX(this.side*Math.randFloat(.1,.25)).applyQuaternion(C.quaternion).setY(Math.randFloat(1,1.1)),g.randomize(.5).add(A).add(C.position);const s=Math.randFloat(-.01,.01),a=Math.randFloat(-.1,.1),o=Math.randFloat(-.1,.1);this.color.set(V).offsetHSL(s,a,.1+o),this.setColorAt(this.index,this.color),this.instanceColor.needsUpdate=!0,this.index++,this.index%=this.objects.length,S.release(A)})}}class sh extends UV{constructor(){super(),autobind(this),this.bonusIDs=["SpeedUp","EagleEye","Shield"].shuffle(),this.playerID=q.players.length,this.tint=q.getRandomTint(),this.stencilRef=this.playerID+1,this.input=new S,this.direction=new S,this.target=new S,this.textures={},this.materials={},this.overhead=new tR(this),this.add(this.overhead),XV.assets.loadGlb("glb/Crown").then(()=>{this.crown=new _X(this),this.add(this.crown),this.crown.initialize(),this.crown.update(),this.viewChangeTriggered&&(this.crown.onViewChange(this.viewChangeTriggered),this.viewChangeTriggered=null)}),this.territory=new OX(this),this.add(this.territory),this.trail=new DX(this),this.add(this.trail),this.particles=new CR(this),this.add(this.particles),this.crumbs=new iR(this),this.add(this.crumbs),q.players.push(this)}initialize(){this.addEventListeners(),this.reset({dispatchEvent:!1})}addEventListeners(){q.addEventListener("update",this.update),q.addEventListener("afterUpdate",this.afterUpdate),q.addEventListener("onViewChange",this.onViewChange)}reset({dispatchEvent:V=!0}={}){if(this.inOwnTerritory=!0,this.isDead=!1,this.isRevived=!1,this.exitTime=!1,this.killCount=0,this.kingKilled=!1,this.consecutiveKills=0,this.timeOutsideZone=0,this.percentCovered=0,this.percentCoveredWithoutKill=0,this.bonusID=null,this.speed=1,this.size=1,this.isUser){const{currentViewID:g}=q,I=document.body.getAttribute("data-pending-bonus");I&&g==="Game"&&this.setBonus(I)}V&&this.dispatchEvent({type:"reset"})}update(){const{inGame:V,settings:g,time:I}=q,{speed:e,friction:t}=g.gameplay,{deltaRatio:C}=I;XV.scene.arena;const A=S.get();if(V&&!this.isDead){this.direction.lerp(this.input,t),A.copy(this.direction).setLength(1).multiplyScalar(e).multiplyScalar(this.speed).multiplyScalar(C);const{x:s,z:a}=A;this.character.position.x+=s,this.character.position.z+=a}this.intersectsTrails(),this.intersectsTerritories(),this.setStats(),this.setBonusTimer(),S.release(A)}afterUpdate(){const{velocity:V,rotation:g}=this.character;if(V.length()<.1)return;const{x:I,z:e}=V;g.y=Math.atan2(e,-I)+Math.PI*.5}kill(V){if(V.isDead||!q.inGame||V.isUser&&V.bonusID==="Shield"||(V.die(this),this.dispatchEvent({type:"kill"}),V===this))return;const{elapsedTime:g}=q.time,e=g-this.lastKillTime<1e3;V.isKing&&(this.kingKilled=!0),e?this.consecutiveKills++:this.consecutiveKills=0;let t="+1 Kill";V.isKing&&(t="King Killed !"),e&&(t=`Combo x${this.consecutiveKills+1} `),this.killCount++,this.lastKillTime=g,this.overhead.set(t)}die(){this.isDead||!q.inGame||(this.isDead=!0,this.isRevived=!1,this.dispatchEvent({type:"die"}))}onViewChange(V){this.viewChangeTriggered=V;const{previousViewID:g}=V;g==="Game"&&this.setBonus()}setStats(){if(this.isDead||!q.inGame)return;this.percentCovered=this.territory.percentCovered,this.killCount||(this.percentCoveredWithoutKill=this.percentCovered);const{elapsedTime:V}=q.time;if(q.currentViewID.match(/Game/)&&!this.inOwnTerritory){const g=(V-this.exitTime)*.001;this.timeOutsideZone=Number(g.toFixed(1))}else this.exitTime=V}setSkin(V){this.skinID=V;const{character:g,territory:I}=this;this.color=V==="Cube"?this.tint:"#ffffff",g.colors=this.getCharacterColors(),I.colors=this.getTerritoryColors(),this.setCharacterGeometry(this.skinID)}setMaterials(V){const{territory:g,trail:I,particles:e,character:t}=this,{materials:C}=XV.assets,{territoryID:A}=g,{trailID:s}=I,{particlesID:a}=e,{characterID:o}=t,n=XV.assets.getPattern(V);C[a].color.set(this.color),C[o].color.set(this.color),C[A].color.set(this.color),C[s].color.set(this.color),C[A].map=n,C[A].map.wrapT=C[A].map.wrapS=Vt,C[A].map.repeat.setScalar(.03),C[s].hasWorldCoordinates=!XV.assets.trailExists(this.skinID),C[s].hasWorldCoordinates?C[s].map=n:(C[s].map=XV.assets.getTrail(this.skinID),C[s].map.wrapT=C[s].map.wrapS=Vt,C[s].map.repeat.set(200,1))}setCharacterGeometry(V){this.setMaterials(this.skinID),this.character.setGeometry(V)}setBonus(V){if(V&&this.bonusID||!q.inGame)return;this.bonusID=V,V==="EagleEye"&&XV.camera.setMode(V),V==="SpeedUp"&&this.setSpeed(1.5),V==="Bigger"&&this.setSize(1.5),V===void 0&&(this.setSpeed(1),this.setSize(1),XV.camera.setMode("Default"));const{body:g}=document;if(g.removeAttribute("data-pending-bonus"),V)g.setAttribute("data-bonus",V);else return g.removeAttribute("data-bonus");const{settings:I,data:e,banners:t}=q,{duration:C}=I.bonus;if(this.remainingBonusTime=C,V==="Bigger")return;const{title:A}=e.content.bonuses[V];t.set(this.bonusID,A)}setBonusTimer(){if(!this.bonusID||!q.inGame)return;const{deltaTime:V}=q.time;this.remainingBonusTime-=V*.001;const{duration:g}=q.settings.bonus,I=this.remainingBonusTime/g;q.bonusTimer.setProgress(I),!(this.remainingBonusTime>0)&&(this.setBonus(),this.remainingBonusTime=0)}setSpeed(V=1){LV({targets:this,easing:"easeOutExpo",speed:V})}setSize(V=1){LV({targets:this,easing:"spring(1, 75, 7.5, 0)",size:V})}intersectsTrails(){this.isDead||!q.inGame||q.players.forEach(V=>{if(V.isDead)return;const{inOwnTerritory:g,isDead:I}=V,{path:e}=V.territory;for(let t=0,C=e.length;t<C;t++){const A=e[t];if(g||I||V===this&&t>e.length-10)continue;const s=A.distanceTo(this.character.position);s<2&&!V.isDead&&this.kill(V);const{hunt:a}=q.settings.bots;this.isBot&&s<this.aggressivity&&a&&V.isUser&&V!==this&&this.setTarget(V,A)}})}intersectsTerritories(){if(!(this.isDead||!q.inGame))for(const V of q.players){const{territory:g,isDead:I}=V,e=g.contains(this.character.position);if(!I){if(V===this){const t=e;t!==this.inOwnTerritory&&(this.inOwnTerritory=t,this.dispatchEvent({type:this.inOwnTerritory?"return":"exit"}))}else if(e){const t=g.colors[Math.randInt(0,1)];this.crumbs.emit(t)}}}}getCharacterColors(){const{achievements:V}=q.data.content;return V.find(I=>I.skinID===this.skinID).colors}getTerritoryColors(){const V=NV.get();if(this.skinID!=="Cube")switch(this.skinID){case"Licorne":return["#DB4BC2","#DF3DC2"];case"Vache":return["#b8d543","#a7c52c"];case"Elephant":return["#948421","#7E742E"];case"Girafe":return["#EC7C29","#EA741D"];case"Hippo":return["#04c3d7","#03a1b1"];case"Burger":return["#FFC75F","#FFB326"];case"Bus":return["#928D8D","#817878"];case"Avion":return["#5fd2ff","#38c7ff"];case"Canard":return["#00c7c7","#00a0a0"];case"Cochon":return["#95705C","#8D6650"];case"Crotte":return["#4C2611","#401E0C"];case"Donut":return["#ffaecc","#fe87b3"];case"Wc":return["#05c3d7","#04a1b1"];case"Rhinoceros":return["#E7C496","#E1BF92"];case"Rouleau":return["#00e6ff","#00c3d8"];case"Souris":return["#fec730","#fdbc0a"];case"Voiture":return["#6d6d6d","#595959"];case"Mammouth":return["#7C533F","#764B36"];case"Police":return["#424040","#3E3A3A"];case"Pq":return["#fbc7c1","#f8a69d"]}else V.set(this.tint);const g=`#${V.getHexString()}`;V.offsetHSL(0,0,-.075);const I=`#${V.getHexString()}`;return NV.release(V),[g,I]}}class ln extends og{constructor(){super(),autobind(this),this.boundingBox=new pg,this.boundingSphere=new XI,this.size=new S,this.center=new S,q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update)}update(){this.propeller&&(this.propeller.rotation.z+=.1)}setBoundingBox(){this.updateMatrixWorld(),!this.isBonus&&(this.boundingBox.setFromObject(this),this.boundingBox.getSize(this.size),this.boundingBox.getCenter(this.center),this.boundingBox.getBoundingSphere(this.boundingSphere))}setGeometry(V){if(!V)return;this.objectID=V;const{materials:g}=XV.assets;this.isBonus=!!V.match(/EagleEye|Shield|SpeedUp/g),this.material=this.isBonus?g[V]:g.Character;const I=this.isBonus?"Bonus":V;XV.assets.loadGlb(`glb/${I}`).then(()=>{if(this.objectID!=V)return;const{objects:e}=XV.assets,t=e[`glb/${I}`].clone();this.remove(...this.children);const C=new $I;this.add(C),C.add(t);const A={receiveShadow:!0,castShadow:!0};A.material=this.material,this.traverse(s=>Object.assign(s,A)),this.propeller=this.getObjectByName("Avion__Propeller"),this.placeholder=this.getObjectByName(`${V}__Placeholder`),this.setBoundingBox()})}}class AR extends ln{constructor(V,g){super(),autobind(this),this.achievement=V,this.skinID=V.skinID,this.inverseSize=1;const I=g.querySelector(".skin-selector__text");this.DOMElement={Container:g,Text:I};const{materials:e}=XV.assets;e[this.skinID]=e.Character.clone()}initialize(){super.initialize(),this.setUnlocked(),this.rotation.y=Math.random()*Math.PI*2}load(){this.setGeometry(this.skinID)}addEventListeners(){super.addEventListeners(),q.addEventListener("onViewChange",this.onViewChange)}update(){super.update();const{materials:V}=XV.assets,{character:g,size:I,tint:e}=q.user,t=Math.mapLinear(this.inverseSize,0,1,I,1);this.rotation.y+=.005,this.scale.setScalar(I/t),this.isSelected=g.objectID===this.achievement.skinID,this.setUnlocked();const C=V[this.isUnlocked?this.skinID:"Locked"];this.isUnlocked&&this.skinID==="Cube"&&C.color.set(e),this.traverse(A=>A.material=C)}setUnlocked(){const{bestStats:V}=q.settings.user;if(this.achievement&&this.achievement.innerHMTL){const{type:g,target:I}=this.achievement,e=V[g],t=Math.clamp(e/I,0,1),C=t>=1||e===!0;if(this.achievement,this.isUnlocked!==C){if(this.isUnlocked!==void 0&&C){const{skinID:A,innerHMTL:s}=this.achievement;q.banners.set(A,s),q.popins.set(A,s)}this.isUnlocked=C}if(this.value!==e){this.value=e;const{Container:A,Text:s}=this.DOMElement;q.setStyleProperty(A,"--progress",t*100),q.setTextContent(s,e),q.setClass(A,"slide--unlocked",this.isUnlocked)}}else this.isUnlocked=!0}onViewChange(V){const{currentViewID:g,previousViewID:I}=V,e=g==="Home"||g==="EndScreen"?1:0,{character:t}=q.user,C=t.objectID===this.achievement.skinID,A=I&&I.match(/(Game|GameOver)/g);C&&A&&this.rotation.copy(t.rotation),LV({targets:this,easing:"spring(1, 75, 7.5, 0)",inverseSize:e})}}class nR extends og{constructor(V){const{geometries:g,materials:I}=XV.assets,e=g["glb/Check"],t=I.Check;super(e,t),autobind(this),this.skin=V,this.castShadow=!0,this.receiveShadow=!0,this.scaleFactor=0,this.position.set(0,.35,6.5),q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update)}update(){const{elapsedTime:V}=q.time,g=Math.sin(V*.01)*.05;this.scale.setScalar(this.scaleFactor+g),this.visible=this.scaleFactor>1e-5;const I=this.skin.isSelected&&q.currentViewID==="SkinSelector";this[I?"enter":"exit"]()}enter(){this.isEntered||(this.isEntered=!0,this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"easeOutElastic(1, .6)",delay:500,scaleFactor:1}))}exit(){!this.isEntered||(this.isEntered=!1,this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"easeOutExpo",duration:250,scaleFactor:0}))}}var fg=yI.registerPlugin(jl)||yI;fg.core.Tween;class sR extends UV{constructor(){super(),autobind(this),this.map=new Map,this.skins=[],this.slides=[],this.margin=10,this.offsetFactor=1,this.raycaster=new zB,this.ratio=new dV,this.slider=new UV,this.add(this.slider);const{achievements:V}=q.data.content;this.skinIDs=V.map((g,I)=>{const{Slides:e}=q.DOMElements,t=new UV;this.slides.push(t),this.slider.add(t);const C=new AR(g,e[I]);return this.skins.push(C),this.map.set(C.skinID,C),t.add(C),g.skinID}),XV.assets.loadGlb("glb/Check").then(()=>{this.slides.forEach((g,I)=>{const e=this.skins[I],t=new nR(e);g.add(t),t.initialize(),t.update()})}),this.scrollWidth=this.slides.length*this.margin,q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("resize",this.onResize),q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(V){const{currentViewID:g,previousViewID:I}=V,{inGame:e}=q,t=g.match(/SkinSelector/)?0:1,C=!g.match(/(Store|EndScreen)/g);this.visible=!e&&C;let A=document.getElementById("EndScreenCanvas"),s=document.getElementById("EndScreenTerritory");I=="GameOver"&&g=="EndScreen"&&(fg.to(A,{duration:0,alpha:1}),fg.to(s,{duration:0,alpha:1})),I=="SkinSelector"&&g=="EndScreen"&&(this.visible=!0,fg.to(A,{duration:0,alpha:0}),fg.to(s,{duration:0,alpha:0})),g.match(/SkinSelector/g)&&this.skins.forEach(a=>a.load()),LV({targets:this,easing:"easeOutExpo",duration:1e3,offsetFactor:t})}update(){const{progress:V}=q.skinSelector,{index:g}=q.skinSelector;if(V!==void 0){this.slider.position.x=V*this.scrollWidth;for(let I=0,e=this.slides.length;I<e;I++){const t=this.slides[I],C=I*this.margin,A=(I-g)*this.offsetFactor*15;t.position.set(C+A,0,0);const s=Math.clamp(Math.abs(C+this.slider.position.x)*.025,0,.5);t.scale.setScalar(1-s),t.visible=this.offsetFactor<.95||I===g}this.setRaycaster()}}setRaycaster(){const{camera:V,multiTouch:g,mouse:I}=XV,t=(g.getTouch()||I).getNormalizedPosition(dV.get()).multiply(this.ratio);this.raycaster.setFromCamera(t,V),this.hoveredSkin=this.raycaster.intersectObjects(this.skins).map(C=>C.object).getFirst(),dV.release(t)}onResize(){const{InputCapture:V}=q.DOMElements,{clientWidth:g,clientHeight:I}=V;this.ratio.set(g,I).divide(q.viewport.size)}}class lh extends ln{constructor(V){const{materials:g}=XV.assets,I=g.Character.clone();super(new $V,I),autobind(this),this.velocity=new S,this.lastPosition=new S;const{playerID:e}=V;this.player=V,this.characterID=`Character_00${e}`,g[this.characterID]=I,q.addEventListener("ready",this.initialize)}addEventListeners(){super.addEventListeners(),q.addEventListener("beforeUpdate",this.beforeUpdate),q.addEventListener("afterUpdate",this.afterUpdate),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(V){const{currentViewID:g}=V;this.isHidden=!g.match(/(Game|GameOver)/)}beforeUpdate(){this.lastPosition.copy(this.position)}update(){super.update();const{materials:V}=XV.assets,{isDead:g,size:I}=this.player;this.traverse(e=>e.material=V[this.characterID]),this.visible=!g&&!this.isHidden,this.scale.setScalar(I)}afterUpdate(){const{position:V,lastPosition:g,velocity:I}=this;I.copy(g).sub(V)}}class lR extends Ji{constructor(V){const e=Array.from({length:15},()=>new UV),t=new OA(.05*.5,.05,2.5),C=new Hg({transparent:!0,opacity:.5});t.translate(0,-2.5*.5,0),super(t,C,e.length),autobind(this),this.player=V,this.objects=e,this.depth=5,this.color=new NV,this.opacityFactor=0,this.castShadow=!0,this.receiveShadow=!0;for(let A=0,s=this.objects.length;A<s;A++){const a=this.objects[A];this.reset(a);const o=Math.randFloat(-.01,.01),n=Math.randFloat(-.1,.1),l=Math.randFloat(0,.5);this.color.set("#85afb4").offsetHSL(o,n,l),this.setColorAt(A,this.color)}q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}reset(V){const g=Math.randFloat(-2,2),I=Math.randFloat(.5,4);V.offset=V.offset||Math.randFloat(0,this.depth),V.offset%=this.depth,V.position.set(g,I,0),V.scale.setScalar(Math.randFloat(.5,1.5)),V.speed=Math.randFloat(1.5,2),V.scaleFactor=Math.randFloat(.5,1.5)}update(){const{skin:V,character:g,speed:I}=this.player;this.position.copy(g.position),this.quaternion.copy(V.quaternion);const e=Math.mapLinear(I,1,1.5,0,1)*.5;if(this.material.opacity=e*this.opacityFactor,this.visible=this.material.opacity>.01,!!this.visible){for(let t=0,C=this.objects.length;t<C;t++){const A=this.objects[t];A.offset>this.depth&&this.reset(A),A.offset+=.25*A.speed,A.position.z=-4.5-A.offset,A.rotation.x=Math.PI*-.5;const s=1-A.offset/this.depth;A.scale.setScalar(A.scaleFactor*s),A.updateMatrixWorld(),this.setMatrixAt(t,A.matrixWorld)}this.instanceMatrix.needsUpdate=!0}}onViewChange(V){const{currentViewID:g}=V;LV({targets:this,easing:"easeOutExpo",opacityFactor:g==="Home"?1:0})}}var aR="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAyCAMAAAAuj2TTAAAAflBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAADp6elCQkKcnJy4uLjR0dEmJibFxcX09PR9fX2NjY3d3d1YWFiqqqpra2sHHTiAAAAAGnRSTlMA3sO77jrLmiuykG5KIxp4oV0Jf6unVhKJZnC2vKMAAAWFSURBVGje7VjZlpswDAUCKVmaCZmlM1yWsCf//4NFllxNxnAyzTl96eG+JAhZ1rUky8ZbsGDBggULFixY8K+xD4AglodnetjJQ0QP0SM2ZWz8be3tGpCZFeqTfzx9EbnW9zBg6QoGbC+CwSNMZGx4+J72FhZr9+WrvlCRa/0Q4pKmHTZsMD+naQ0k9LRGkabFaOIBBDS2ZasuXFeLPh1RD9i6S1Kd02zATkXJKHKsv6EdLTQVRnonH8ZeicBYGOhheCQkv1CRVYTfi17Vp4zeXbYnFEQRLyo6onStf6AjCy3eKMuubI9oiYX0iv3fExFLFX559/GMQniov4ofxusMvop8ZKSc46eV6LpfKKZbXNheS4HcoBZnHiMiU93HCmcOPWH3KBEvRGNjukZvF2bz+cU/JKJ+1bptzRNR5q51XfgIFf2T9NNQUdyeAozwj1Ivp6NPk0ab0Mx+8ASHndELbonEHzraYLvGenugwUFCO6kpTDJEdtdS73FAhuaIuLmipcD/+oYrXORUPIcNdH/c8YZGCCAInyXbQwiUyEgaAvJbN3nVtUQAfrOS7ZSwd4kItxRQkRZJgSeOzaU0T9sXG6lDFAKFGZoVA/B68nYYMsqFqiDWdQsQk9Mr0JpBl0GJxD7QXXh0bhT3yPu0r9COg8sr7aSCukKepX2OvcmUlvJhPUtERVokXBb8Z2i5Mnxk/CeCmVInW3lMsm2t8Aya+xXqVGmJxCGuZEjExOQdxKvoZGNJFVdeSrybDZxTw/VakuhMkXOKhMoCg/mtOBCopERCGqbIcmx5VxD/WC2gNvVJYveVAOKpUuZlODciOevLCr318CdyEnUOkcnWomLiLq+NsRbsQIsj/8k6oCq5aYGiJZ0YXSqFF6C0ildxLkeCXEcLZapVRfG5RpDdI6K9r8QPb7JImEHHfC7AhR0MkXEcCAVrCpEahFL2Cg5hw4q9EGF2IixYZokUwFAUUCKBf4eInka4qr3pIpGckgxDzyWClg2uYi8RoSVSYTfKJHJPwnJUPG2RCxFULGQ0rMBESjAiIJUF/gYR7VIdPjy3SEhVqlxqXjzY2sjEtP/bRUUmxm08O7xbxcjj1sqKrTZtmHlqS6RFMvanp8j7WyL0ThrDZJFUFy5u5lWIBy/C0peYch65E5KinuSEfs7ppOBRtp9xH/07IppDcpp1i6Tl7W6/M6VUF+wWzyp2pGG3U0RUkddmjsiFNIXyo0Q2o+zsnp0kEaz1mPP6zM1lOiL3JnyfjcilUsrzRHh1Z4kkIDw7RCQR2HPLS9r9++caOUoSfiHi1kiA2q0Rwes3iMiauUTmb7+60Dxup7xMGr7d7FrS7adS4IMVC1LcoZrctVDRdjtP5E/SneIVinkiryD4zkX6wNPJwkslSKId3D7STRNhRWkZ9VQfwbUhUvNE5Hx3xYi8mSWSmNvvFZvJItGb5ilEo4mmnR25dPZpIkd0VnGotbMbh5qCaLCX80SktMhHdDTMIeJedd0ikbYhm4Im2hiSbuKs5RKJOQ6CXg4uKxNeRQl/nsge+aeJGiZy/4aosAZy3poTnrzhCo+BNnNOv84pNfJ2UCbFYFPTx0CkBB2Q8LrXeNF8sCeOAK2eIHtjd+KEKC3LvYQbAw1FNOD7nz/a0ySMQ6D7ch/J+3Gmm3uD5xGT68UkUo4/n4PiNdAWvAgFgMTbU4r3+oFnK7ebyEyVG92yNRVVYh0Z7Zy0BTT9TI2QAYIf6yN0Wzgcv94QV7yRfr7JmRl8CALoJ7Qta7A8nvjkttbPDrHeOtlWwtq3d4+Vdc8FXaBlZxZ7+jhz6w6eb+7WHMs96YWb6OaT6eEtYBZPkW0D9mauXwD0Oy3fiQ/kUpCo9kQfWbBgwYIFCxb8h/gNx7FmWcG7hzMAAAAASUVORK5CYII=",oR="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAyCAMAAAAuj2TTAAAAflBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAADR0dGcnJz09PTp6elCQkImJiZra2u4uLh9fX3FxcXd3d2qqqpYWFiNjY0eCnjWAAAAGnRSTlMAvN3D7juoeBmyfysjX5BuocnMmkwKCEWJVtP2VtEAAAUHSURBVGje7Vjt2powDEW+FJmgzrm9HkFAQLz/GxxJCgXLu819PJt7OH+swZz02CZpsWbMmDFjxowZM2b8UawCF87a+qtYO7C3n37KD06odNgg+NZfhA+Cffw5P3fFXwIU6emc42D9NRyQn0+XAtGTfhvyO5UI+JuL9HQ63fDF+mv4gls7hRr7J/22uLZ+KVz68gHZqcUZix/2/2eE2LjQ3DN8+EeEHJC1W6tB9OpCrAUIu+fdzlNCpA7Hx4ODFo5nWd7WplHMVeFT+8VZD2yMaI99RI5wNlx0wg2721uvj+cFLjMuPdMyLr+hw4E7aopncJpCcqxGQo42CDYUggAKbtz+cAeCtq2ZSsYQz7BVCwVSxtHi3cAUTlt8WZFQiDxL23zL4NT4yMl+AsbJHlEdroDiRoYkB5DQHqxKILZiNBeq0tq2+ESbuz7VOcq28F0LuKEN3Nn9kmQAaY2BJknJdE0A1zMtXflt4KBsA8PhRUNeUzzvkdMQcoE9FrJH3Q5KekZIm1aXoAI8HxXJ623nDL4qN8ldTCVcFCRTcKWoG5BfhxLwTAvRSJRctrzH7S0haixNzh5LJDL1sRCABjLR4Yj5ItmPZ2275IhF3TlV2oBSRv33w05WXxMFpqX/Z12kbNm2aYGcxnc4JueDkAr+hBB2RpOKlBIUgks8C6Fwd6DgYQVbjHpOWfeLnN1ucNDIALin0rxMi94i3efRWuNOD3NMcA46+51X6aMpRHQACQ8bGqpoNGdZB0JN4wKdkIS2fSKq0ww9QwYOVYPA/w4mLAMhmfDG1o6ZEzgTnH3tekMp229SSI5QlJ4q7FZqqoAa3OGHx0j9q53xCkEuogSpjEvJBEKR0sxMixbiMF8F5yARMpNT5i34jIKntDGECJ38QM5fD0JSgOrlHrVsOHlatlTecilTbCCoVP6mvEmTBALPtGghawmcI+D0v8IxOLuU0HMv8WYIkQELEe0jIfo85KOSyLojSeqNIKxU5wS3knpNYFi0kKMcOhKlv8A0p9WBq0OD8HkhwqI7ERk5X00hak1t5Ddd6Qq4K9Oi+8G2y6A7B7OnOXshQet4xs76HSsin9NCbjnkvFMml75vRKZFCwm7pah586+nOQdli7B+UojOkaOtc0QLeev3s4bvAiUYZSWF3LTsBx1aJUejYk1yGlfkZ4VI1VpQ1Sr6qqWFrMYVBjmnc8k7ZWurVE0nLO5AyAEZ2SppldOc3uMVefUTQi6Z7iPZWIg1qvmc0qq13MCQ25Np0SvCJNVJkMOb5lzqnSVX5OBpIbqzS3HUQoQ3S7mwUshKWpvqSE3XzpIJSzQUEnNsoX+H8/N3rrouUlOIpLVO9tFZa6OFMBbsp3GFzYs3cjIt3lDIkQqI5MXmHc6jeUMcvXzYo5YB70zRLqVIn7WS0jz96ha1stEMZnkHNhHySlvq1sm0jA9/qilW2L3HqVNEkkzamH4dFPGNg6ubQ8w30u6pq0KkhCDnq8RV3Ufoad0gtgThDiilYFYJOKYPNFJq00ScTIs3pDnabXCaR/weZ48YmeTIwwu6XTdomRkHfXmzOiHDG6J+2iNyv3UfdCPTMqbRwf13OTUWumrpV6bdrVzIHMA5DEp1L2QZuHzlJGd5uo+G3Ks3B483dC61cIO3lWkxaST4eprzl1+1aiHWi2MW8q/BR6XO/i+OmC6mFb3Cf3VIzYytlwdX6f9Ax4wZT+ErAINrCwI2RX8AAAAASUVORK5CYII=",cR="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAyCAMAAAAuj2TTAAAAe1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAADp6emcnJy4uLjR0dH09PRCQkJra2smJiaqqqrFxcXd3d19fX1YWFiNjY2OkkLRAAAAGXRSTlMA3cPuyxm8WyyajjuyoXh/bripTAoIZkUjeyKxqQAAA79JREFUaN7tmOtymzAQhYWA4gC+x0k5lrkbeP8nrNBKERhPO5NUmc6U7xfSJFhH0p7dha2srKysrKysrPxbbN62Hkb4LmFfIw7AD4+Tew7wDXPNmWMCP7MvcMTIg5ITRvyQOSVMAQzimo00AkDMPs0B5T1rgdnuR6jzLOuQMpdsPKDJJjTAkX2WE1r5igFv08ktbnKygM9cQTqqIptxL3Fin8TDVe1FvJzMSvxk7ghQ0eoFJKJQzzWSLwm54eW7hezRKx0CRHmlUfo3hfxA7lrIxUOu4yKWh5AcSVcBn4w0iMPUB3h0IZPmkHjbxDpFNPXt160RAr5fCKnhzrYOdLGuAHnuawBhNo+M1IfC28hVwiCV6aThw8I3R8AIAaySF9wyCcCckaLNJAO2jEhQX0dhHjujvI/R0hVyYRX80d2GRskWJS0zDIBO+3YranjqZhI5vMtUCL3UGT4KOvSN9c++bUopLFamLIZM0cFHdc0MN6XkiP6eWSpATEfvTLODUNJ+MFdsKCTuCGhMl0tyfNUZIS/MBqPLCDM+Ryjnxl1OTqTVJ2KFtDgxV7yjyuxeHTg0QUwRahEo1a0agPpG9sDpxpDh6TkTI/My5Q2DtjJH0C+YnzhgQvAhRAC9EKDkXEJi/CDAeLF6KO50sta1DtMSpVMv2pkJp0IuHtqP3N4j1kJuIGoSRRTqOR7XNyDgkDQUzss8Qge/qFtcXS16JmhvtZAOEUt2O4qQHkRLV96Hpha0B8BTIT9R6je5goKdjNGeCM3YLGbC1aLVbwIApVCevBCyMMceDhsSa782Rm5WCOX450IaxECvgvyPQlLcpPCALXCTEA/8QQg9PBfS1ODQSaYQohK/ExKBUv0CJyUK8fJUSDSLEeJEjpxX+E2w21bX276yBa6Kxst7+vxEwrlroRZCL76oAT/1zT38EBJG4WOr67lsdfc6OwsYhutCiIRP84hqxYTOgjVGuoyeSUgLiZ/MWt1r5bbVPc4aq0oUupbazoXocqQQAKp2WlnlpY35bkySJLjugOQ7W93QtrqWvEZkhVjBE27wSJumNU7W2Kpm940dov34YGk74KSr3xYnI3hW6g5ANNFWdKbAtepsxFP9WThsrOznIKHvVK6i2JdOeUadj7XKwQhWzQcpFQCiUVstCjOWuq899keUumkBIvuNyH2MLD/QgR9CazWUxRbtIN+M2uz/pWf91+ERhsgGonEt5yS71KcF7neJNX9Vz1vCiD98V01S34zPJlWcTWO/zCMrKysrKysr/y2/ADz4x6fUiYmDAAAAAElFTkSuQmCC",dR="./assets/word3.png";class rR extends UV{constructor(){super(),zd(this),this.wmap0=new Le().load(aR),this.wmap0.anisotropy=12,this.wmap1=new Le().load(oR),this.wmap1.anisotropy=12,this.wmap2=new Le().load(cR),this.wmap2.anisotropy=12,this.wmap3=new Le().load(dR),this.wmap3.anisotropy=12,this.material=new cl({map:this.wmap0,color:16777215,alphaTest:.1}),this.text=new hd(this.material),this.add(this.text),setTimeout(()=>{this.text.center.set(.5,.5),this.text.scale.set(60,15,1),this.scale.set(0,0,0)},200)}setTextId(V,g){let I=V==3,e=V==3?2:1;this.scale.set(0,0,0),this.material.color=new NV(g),this.material.map=this["wmap"+V],fg.to(this.scale,{duration:.5,x:.5,y:.5,z:.5,ease:"back.out(2)",onComplete:()=>{fg.delayedCall(e,()=>{I?fg.to(this.scale,{duration:.5,x:0,y:0,z:0,onComplete:()=>{window.H5SDK.getPlatform().notifyLevelEnd(0,parseInt(q.user.percentCovered),!1),q.restoreNames(),q.resume(),q.router.navigate("home"),q.trysNumber=0,q.reviveNumber=0}}):this.scale.set(0,0,0)})}})}}for(let i=0;i<256;i++)(i<16?"0":"")+i.toString(16);const hR=Math.PI/180;class sa extends sh{constructor(){super(),autobind(this),this.target=new S,this.targetA=0,this.isUser=!0,this.time=new Pl,this.character=new lh(this),this.add(this.character),this.skinList=new sR,this.add(this.skinList),this.wind=new lR(this),this.add(this.wind),q.encouragingText=this.text=new rR,this.add(this.text),q.user=this,q.addEventListener("ready",this.initialize)}initialize(){this.applySettings(),super.initialize(),this.rotationVal=90,this.oldRotationVal=90}addEventListeners(){super.addEventListeners();const{keyboard:V,joystick:g}=XV;V.addEventListener("keyDown",this.onKeyDown),V.addEventListener("keyUp",this.onkeyUp),g.addEventListener("move",this.onJoystickMove),q.addEventListener("applySettings",this.applySettings)}reset(){super.reset(),this.input.length()===0&&q.settings.user.controls&&(this.input.randomize().setY(0).setLength(1),this.direction.copy(this.input)),XV.camera.reset(),console.log("reset")}update(){const{inGame:V,settings:g,time:I}=q,{speed:e,friction:t,angleTurn:C}=g.gameplay,{deltaRatio:A}=I,{radius:s}=XV.scene.arena,a=S.get();if(V&&!this.isDead){const c=Math.atan2(this.direction.z,this.direction.x),d=this.angleLerp(c,this.targetA,C),h=Math.sin(d),m=Math.cos(d);if(a.set(m,0,h).setLength(1).multiplyScalar(e).multiplyScalar(this.speed).multiplyScalar(A),this.character.position.length()>=s-2*this.size){const r=this.character.position.clone(),u=new ee(0,Math.PI/2,0),b=r.applyEuler(u),Z=a.angleTo(b);var o=0;Z<=Math.PI/2?o=new ee(0,Z,0):o=new ee(0,Z+Math.PI,0),a.applyEuler(o)}this.character.position.x+=a.x,this.character.position.z+=a.z,this.direction.set(a.x,0,a.z)}this.character.position.clampLength(0,s-2*this.size),this.text.position.copy(this.character.position),this.text.position.y=15,this.intersectsTrails(),this.intersectsTerritories(),this.setStats(),this.setBonusTimer(),S.release(a);const{user:n}=q.settings,{name:l}=n;this.name=l,this.skinList.position.copy(this.character.position),this._isDown&&this.control()}kill(V){if(!(V.isDead||!q.inGame)&&(super.kill(V),V!==this)){q.settings.sound&&q.sounds.fx.play("enemykilled"),q.encouragingText.setTextId(2,V.getTerritoryColors()[0]),q.tuto.hide(1);const{kill:g}=q.settings.bonus;!this.bonusID&&this.killCount%g===0&&(this.bonusIDs.unshift(this.bonusIDs.pop()),this.setBonus(this.bonusIDs[0])),q.coins.add(10)}}die(V){return SV(this,null,function*(){if(this.isDead||!q.inGame)return;this.killer=V;const{elapsedTime:g}=q.time;if(!this.inOwnTerritory){const I=(g-this.exitTime)*.001;this.timeOutsideZone=Number(I.toFixed(1)),this.exitTime=g}xi(sa.prototype,this,"die").call(this,V),q.settings.camera.object==="User"&&(q.settings.sound&&q.sounds.fx.play("killed"),XV.camera.shake(),q.user.percentCovered<3*q.scoreCoef&&q.trysNumber<2?(q.pause(),yield this.time.wait(1e3),q.resume(),q.user.revive(),q.trysNumber++):q.reviveNumber<1?(window.H5SDK.getPlatform().notifyLevelEnd(0,parseInt(q.user.percentCovered),!1),q.restoreNames(),q.coins.value>=100?q.router.navigate("game-over"):(yield this.time.wait(1e3),q.router.navigate("end-screen")),q.trysNumber=0,q.reviveNumber++):(window.H5SDK.getPlatform().notifyLevelEnd(0,parseInt(q.user.percentCovered),!1),q.restoreNames(),yield this.time.wait(1e3),console.log("User requestInterstitialAd"),window.H5SDK.getAdsModule().requestInterstitialAd().then(I=>{console.log("User result:",I)}),q.router.navigate("home"),q.trysNumber=0,q.reviveNumber=0),q.save.saveData())})}revive(){this.killer&&(this.killer.die(),this.killer=null);const{bestStats:V}=q.settings.user;V.revive++;const{character:g,territory:I}=this,e=I.path[0];g.position.copy(e),this.input.set(-e.x,0,-e.z).setLength(1),this.targetA=Math.atan2(this.input.z,this.input.x),XV.camera.reset(),super.setBonus(),super.remainingBonusTime=0,this.isRevived=!0,this.inOwnTerritory=!0,this.isDead=!1,this.exitTime=q.time.elapsedTime,q.router.navigate("game"),this.dispatchEvent({type:"revive"})}applySettings(){const{skinID:V}=q.settings.user;this.setSkin(V)}afterUpdate(){super.afterUpdate(),this.setBestStats(),this.setTextContents()}setBestStats(){const{bestStats:V}=q.settings.user;for(const g in V)(this[g]>V[g]||this[g]===!0)&&(V[g]=this[g])}setTextContents(){const{bestStats:V,name:g}=q.settings.user,{KillCount:I,PercentCovered:e,Progress:t,BestStatsPercentCovered:C,BestStatsProgress:A}=q.DOMElements;for(const a of I)q.setTextContent(a,this.killCount,!0);for(const a of e)q.setTextContent(a,this.percentCovered);for(const a of t)q.setStyleProperty(a,"--progress",this.percentCovered/q.scoreCoef);if(this.percentCovered>0&&this.percentCovered!=this.currentPercentCovered){q.settings.sound&&q.sounds.fx.play("territory");let a=Math.abs(this.percentCovered-this.currentPercentCovered);console.log(a),a>1*q.scoreCoef&&a<2*q.scoreCoef?(q.encouragingText.setTextId(1,this.getTerritoryColors()[0]),q.coins.add(5)):a>2*q.scoreCoef&&(q.encouragingText.setTextId(0,this.getTerritoryColors()[0]),q.coins.add(15)),this.percentCovered>.5*q.scoreCoef&&(q.tuto.hide(0),q.tuto.showTuto(1)),this.percentCovered>=100*q.scoreCoef&&(super.die(),super.setBonus(),super.remainingBonusTime=0,q.pause(),q.encouragingText.setTextId(3,this.getTerritoryColors()[0]))}this.currentPercentCovered=this.percentCovered;const s=V.percentCovered;q.setStyleProperty(A,"--progress",V.percentCovered/q.scoreCoef);for(const a of C)q.setTextContent(a,s)}setSkin(V){V!==this.skinID&&(this.skin=this.skinList.map.get(V),this.skin.load(),super.setSkin(V),q.skinSelector.setScrollLeft())}setBonus(V){V&&this.bonusID||(super.setBonus(V),V&&V!=="Bigger"&&q.bonusTimer.set(V))}onViewChange(V){super.onViewChange(V);const{previousViewID:g}=V;if(!(!g||g.match(/(Game|GameOver)/g))&&q.settings.user.controls){const I=this.skin.rotation.y;this.direction.x=Math.sin(I),this.direction.z=Math.cos(I),this.input.copy(this.direction)}}onKeyDown(V){console.log("onKeyDown",V.key),!(!q.inGame||this.isDead)&&(this.key=V.key,this._isDown=!0)}onkeyUp(V){console.log("onkeyUp",V.key),this.key=null,this._isDown=!1}control(){this.input.setScalar(0),this.target.setScalar(0),console.log("control v2");let V=360/40;if(this.key=="ArrowRight"){this.rotationVal==360&&(this.rotationVal=0);let g=this.rotationVal>270?-1:1;this.setRotationAngleVal(90,V*g)}if(this.key=="ArrowLeft"){this.rotationVal==0&&(this.rotationVal=360);let g=this.rotationVal<90?-1:1;this.setRotationAngleVal(270,V*g)}if(this.key=="ArrowUp"){let g=0;this.rotationVal>180&&(g=360),this.setRotationAngleVal(g,V)}this.key=="ArrowDown"&&this.setRotationAngleVal(180,V),this.rotationVal>=360&&(this.rotationVal=0),this.targetA=(this.rotationVal-90)*hR}setRotationAngleVal(V,g){this.rotationVal!=V&&(this.rotationVal<=V?this.rotationVal+=g:this.rotationVal>V&&(this.rotationVal-=g))}shortAngleDist(V,g){const I=Math.PI*2,e=(g-V)%I;return 2*e%I-e}angleLerp(V,g,I){return V+this.shortAngleDist(V,g)*I}onJoystickMove(){if(!(!q.inGame||this.isDead)&&q.settings.user.controls){const{direction:V}=XV.joystick;this.input.set(V.x,0,V.y).setLength(1),this.targetA=Math.atan2(this.input.z,this.input.x)}}}class la extends sh{constructor(){super(),autobind(this),this.isBot=!0,this.character=new lh(this),this.add(this.character),q.addEventListener("ready",this.initialize),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(V){V.currentViewID==="Game"&&!q.user.isRevived&&this.forceSetCharacterGeometry(this.skinID)}initialize(){super.initialize()}addEventListeners(){super.addEventListeners(),this.addEventListener("return",this.onReturn)}onReturn(){this.setWaypoints()}reset(){super.reset(),this.shouldRevive=!0,this.target=null,this.opponent=null,this.waypoints=null;const{aggressivity:V}=q.settings.bots;this.aggressivity=Math.randFloat(V,V*1.5),this.nameObj=q.getRandomName();const{name:g,pic:I}=this.nameObj;this.name=g,this.pic=I,this.setSkin(q.getRandomSkinID())}setCharacterGeometry(V){}forceSetCharacterGeometry(V){this.setMaterials(V),XV.assets.loadGlb(`glb/${V}`).then(()=>{super.setCharacterGeometry(V)})}update(){if(q.isGameOver||!this.shouldRevive)return;super.update(),this.setInput();const{elapsedTime:V}=q.time;this.isDead&&V-this.deathTime>this.reviveDelay&&this.revive()}die(V){return SV(this,null,function*(){if(this.isDead)return;q.pushDeadName(this.nameObj),xi(la.prototype,this,"die").call(this,V);const{elapsedTime:g}=q.time;this.deathTime=g,this.reviveDelay=Math.randFloat(7,8)*1e3})}revive(){return SV(this,null,function*(){const V=q.settings.bots.count,g=q.user.territory.percentCovered,I=q.players.filter(s=>!s.isDead&&!s.isUser).length,e=Math.min(V,(100*q.scoreCoef-g)/V);if(I>=e){this.shouldRevive=!1;return}this.isRevived=!0,this.deathTime=null,this.reviveDelay=null;const t=q.ia.update(),{x:C,y:A}=t.getFirst();this.character.position.set(C,0,A),this.reset(),this.setWaypoints(),this.dispatchEvent({type:"revive"})})}setWaypoints(){if(this.isDead||!q.inGame)return;this.waypoints=Array.from({length:6},()=>new S);const{radius:V}=XV.scene.arena,{character:g,territory:I}=this,{center:e,points:t}=I,{position:C}=g,A=S.get(),s=50,a=Math.randInt(50,60),n=I.getNearestPointID(C)+s,l=Math.floor(a/(this.waypoints.length+1));let c=Math.euclideanModulo(n,t.length),d=t[c],h=0;for(;d.length()>V*.75&&h<25;)c+=10,c=Math.euclideanModulo(c,t.length),d=t[c],h++;for(let u=0,b=this.waypoints.length;u<b;u++){const Z=this.waypoints[u],p=c+l*u,G=Math.euclideanModulo(p,t.length);Z.copy(t[G])}for(let u=1,b=this.waypoints.length-1;u<b;u++){const Z=this.waypoints[u];A.copy(Z).sub(e).normalize().multiplyScalar(Math.randFloat(50,65)),Z.add(A).clampLength(0,V-2)}const m=this.waypoints.getFirst(),r=this.waypoints.getLast();m.distanceTo(C)>r.distanceTo(C)&&this.waypoints.reverse(),S.release(A)}setInput(){if(this.isDead||!this.waypoints||!q.inGame)return;const V=this.target||this.waypoints[0]||this.territory.center,g=this.character.position.distanceTo(V);if(this.opponent){const{isDead:e,inOwnTerritory:t}=this.opponent;(e||t)&&(this.target=null,this.opponent=null)}g<10&&(V===this.target?this.target=null:V===this.center?this.setWaypoints():this.waypoints.shift());const I=S.get().copy(V).sub(this.character.position).setLength(1);this.input.lerp(I,1),S.release(I)}setTarget(V,g){this.target||(this.opponent=V,this.target=g,this.waypoints&&(this.waypoints=this.waypoints.slice(-1)))}afterUpdate(){super.afterUpdate()}}class mR extends wC{constructor(){super(),autobind(this),this.fog=new QA,this.lerpWeight=1,this.lighting=new xX,this.add(this.lighting),this.sky=new MX,this.add(this.sky),this.arena=new kX,this.add(this.arena),this.ground=new zX,this.add(this.ground),q.user=this.user=new sa,this.add(this.user);const{count:V}=q.settings.bots;this.bots=Array.from({length:V},()=>new la),this.add(...this.bots),this.add(XV.camera),q.addEventListener("ready",this.initialize)}initialize(){return SV(this,null,function*(){this.reset(),this.addEventListeners(),yield q.time.wait(100),(yield q.facebook.isInTournament())&&q.banners.set("Tournament","You have join<br>a tournament")})}addEventListeners(){q.addEventListener("applySettings",this.applySettings),q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}applySettings(){const{density:V,color:g}=q.settings.fog;this.fog.color.set(g),this.fog.density=V}update(){const{object:V}=q.settings.camera,{position:g}=XV.camera.object,I=V!=="User"&&this.bots?this.bots[0]:q.user;I&&g.lerp(I.character.position,this.lerpWeight)}reset(){return SV(this,null,function*(){const{players:V}=q,g=q.ia.reset();for(let I=0,e=V.length;I<e;I++){const t=V[I],C=g[I],{character:A}=t,{x:s,y:a}=C;A.position.set(s,0,a),t.reset(),t.isBot&&t.forceSetCharacterGeometry(t.skinID)}for(const I of V)yield I.territory.crop();for(const I of V)I.isBot&&I.setWaypoints()})}onViewChange(V){const{currentViewID:g,inGame:I}=V,{isRevived:e,isDead:t}=q.user;g==="Game"&&!e&&this.reset(),g.match(/GameOver/)&&!t&&q.user.die(),this.animation&&this.animation.remove(this),this.animation=LV({targets:this,easing:"linear",duration:I?2e3:500,lerpWeight:I?.1:1})}}class uR extends BI{constructor(){super(),autobind(this),this.renderOrders={Text:2,Mask:-1,Stencil:-2,Trail:-3,Sky:-100}}initialize(){if(!this.initialized)return this.initialized=!0,this.renderer=new XX,this.physics=new RX,this.assets=new Jy,this.camera=new vX,this.audio=new YX,this.mouse=new SX,this.keyboard=new fX,this.multiTouch=new wX,this.joystick=new FX,this.assets.initialize().then(this.onReady).catch(console.error)}onReady(){this.isReady||(this.isReady=!0,this.scene=new mR,this.mouse.addEventListeners(),this.multiTouch.addEventListeners(),this.keyboard.addEventListeners(),this.joystick.addEventListeners())}}const bR=new uR;var XV=bR;class ZR{constructor({maxStep:V=25}={}){this.maxStep=V}reset(){return this.circles=[],this}set(V){return this.radius=V,this}populate(V,g=50){for(let I=0,e=V;I<e;I++)this.add(g);return this}add(V,g={}){const I=new GR(V,g);I.setActive(!0);const e=Math.randFloat(0,this.radius-V);g.position||I.position.randomize(e),g.velocity||I.velocity.randomize(),this.circles.push(I)}solve(V=this.maxStep){for(this.stepCount=0;this.isSolving()&&this.stepCount<V;)this.step();return this.circles}step(){this.stepCount++;const{circles:V,radius:g}=this;for(const I of V)I.setActive(!1);for(const I of V)I.applyCollisions(V,g);for(const I of V)I.update()}isSolving(){for(const V of this.circles)if(V.isActive)return!0;return!1}}class GR{constructor(V=50,{damping:g=.5,isStatic:I=!1,hasAdaptativeRadius:e=!1,position:t,acceleration:C,velocity:A}={}){this.radius=V,this.position=new dV,this.acceleration=new dV,this.velocity=new dV,this.damping=g,this.isStatic=I,this.hasAdaptativeRadius=e,t&&this.position.copy(t),C&&this.acceleration.copy(C),A&&this.velocity.copy(A)}setActive(V){this.isActive=V}applyCollisions(V,g){if(this.isStatic)return;const I=dV.get(),e=new dV;let t=0;for(const A of V){if(this===A)continue;const s=this.position.distanceTo(A.position),a=this.radius+A.radius-s;a>0&&(I.copy(this.position).sub(A.position).normalize().multiplyScalar(a),e.add(I),t++)}const C=this.position.length()+this.radius-g;C>0&&(I.copy(this.position).negate().normalize().multiplyScalar(C),e.add(I),t++),e.divideScalar(t||1),this.applyForce(e),this.isActive=t>0,this.hasAdaptativeRadius&&t&&(this.radius*=.9),dV.release(I)}applyForce(V){this.acceleration.add(V)}update(){this.isStatic||(this.velocity.add(this.acceleration),this.position.add(this.velocity),this.acceleration.multiplyScalar(0),this.velocity.multiplyScalar(this.damping))}}class pR{constructor(){this.packing=new ZR,this.resolution=25}update(){const{players:V}=q,{radius:g}=XV.scene.arena,I=Math.pow(this.resolution,2),e=dV.get(),t=S.get();this.packing.reset();for(let A=0,s=I;A<s;A++){const a=A%this.resolution/this.resolution,o=Math.floor(A/this.resolution)/this.resolution;if(e.set(a,o).multiplyScalar(g*2).subScalar(g),t.set(e.x,0,e.y),e.length()>g||!V.filter(c=>!c.isDead).map(c=>c.territory).find(c=>{const d=c.contains(t);if(d||!c.player.isUser)return d;const h=c.path;if(h.length<1)return d;const r=h[h.length-1].distanceTo(t)<g*.5;return d||r}))continue;const l={position:e,isStatic:!0};this.packing.add(g/this.resolution,l)}const C={isStatic:!1,hasAdaptativeRadius:!0};for(let A=0,s=25;A<s;A++)this.packing.add(100,C);return this.packing.solve(25),dV.release(e),S.release(t),this.packing.solve(100).sort((A,s)=>s.radius-A.radius).map(A=>A.position)}reset(){const{players:V}=q,{radius:g}=XV.scene.arena;return this.packing.reset().set(g).populate(V.length).solve().map(I=>I.position)}}const Os=window;Os.gaDataLayer=Os.gaDataLayer||[];function OC(){console.log("[Analytics] gtag push",arguments),Os.gaDataLayer.push(arguments)}class qR{constructor(){this.handler=null,this.lastUrl=""}init(){return SV(this,null,function*(){const V=q.data.configuration.analytics,g=yield q.facebook.getID(),I=V&&V.gaID||null;OC("js",new Date),OC("config",I,{debug_mode:!1,user_id:g,send_page_view:!1,anonymize_ip:!0,cookie_prefix:"analytics_ga4",cookie_update:!1,cookie_expires:6*30*24*60*60,cookie_flags:"SameSite=None;Secure"}),OC("set","allow_ad_personalization_signals",!1),OC("set","allow_google_signals",!1);const e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?l=gaDataLayer&id="+I,document.head.appendChild(e)})}pageview({url:V,title:g}={}){V=(V+"").split("?")[0],V!==this.lastUrl&&(this.lastUrl=V,V=V+document.location.search,this.event("page_view",{page_location:V,page_title:g}))}event(V,g){OC("event",V,g)}}var Gg={call:(i,V)=>{V||(i="FB > "+i),console.fb?console.fb(i):console.log(i)},success:(i,V)=>{V||(i="FB < "+i),console.success?console.success(i):console.log(i)},error:(i,V)=>{i&&i.message&&(i=i.code+" - "+i.message),V||(i="FB < "+i),console.error(i)},log:(i,V)=>{V||(i="FB - "+i),console.log(i)}};function BR({prototype:i}){i.getID=function(g=!0){return SV(this,null,function*(){if(this.cachedUserID&&g)return this.cachedUserID;Gg.call("player.getID()");const I=0;return this.cachedUserID=I,I})},i.getName=function(g=!0){return SV(this,null,function*(){if(this.cachedUserName&&g)return this.cachedUserName;Gg.call("player.getName()");const I="Player";return this.cachedUserName=I,I})}}function WR({prototype:i}){i._loadStats=function(){return SV(this,null,function*(){function g(e){return Number(e)===e&&e%1!==0}if(!this.active)return;let I;return yield window.H5SDK.getStoreModule().get(["bestStats","coins","name","skinID","streakStart","tournaments"]).then(e=>{g(e.bestStats.percentCovered)&&(e.bestStats.percentCovered=parseInt(e.bestStats.percentCovered*100)),I=e,e.bestStats&&window.H5SDK.getScoreModule().setBestScore(parseInt(e.bestStats.percentCovered))}),I||(I={}),I})},i.convertLoadedStats=function(g){return SV(this,null,function*(){const I=Te.user.name.value;if(g.name==null||name===I){const e=yield this.getName();e!=null?g.name=e:g.name=I}return g})},i.loadStats=function(){return SV(this,null,function*(){let g=yield this.retryWhenFailure(this._loadStats);return g||(g={}),g=yield this.convertLoadedStats(g),g})},i.saveStats=function(g){return SV(this,null,function*(){if(!!this.active)try{if(this.saveNotLoaded)return;const I=JSON.parse(JSON.stringify(g));window.H5SDK.getStoreModule().save("bestStats",g.bestStats),window.H5SDK.getStoreModule().save("coins",g.coins),window.H5SDK.getStoreModule().save("name",g.name),window.H5SDK.getStoreModule().save("skinID",g.skinID),window.H5SDK.getStoreModule().save("streakStart",g.streakStart),window.H5SDK.getStoreModule().save("tournaments",g.tournaments),console.log("saveProgression >> ",g)}catch(I){Gg.error(I,!0)}})}}var yR="./assets/fb_game_score_background_0_20.png",XR="./assets/fb_game_score_background_20_50.png",RR="./assets/fb_game_score_background_50_70.png",YR="./assets/fb_game_score_background_70_100.png";let gC=null,ue=null;const WA={},Zc={},wR=i=>Zc[i]=Zc[i]||new Promise(V=>{WA[i]=document.createElement("img"),WA[i].onload=V,WA[i].src=i}),HR=()=>Math.floor(q.user.percentCovered);function Gc(){return SV(this,null,function*(){const i=HR();let V=yR;i>=70?V=YR:i>=50?V=RR:i>=20&&(V=XR),yield wR(V),gC||(gC=document.createElement("canvas")),ue||(ue=gC.getContext("2d"));const g=WA[V],I=g.naturalWidth,e=g.naturalHeight;gC.width=I,gC.height=e,ue.drawImage(g,0,0,I,e);const t=Math.floor(e*.04);let C=Math.floor(e*.12);i>=100&&(C=Math.floor(e*.23)*.78);const A=i>=100?.1:.07,s=138/1080*I,a=500/1080*e;ue.font="400 "+t+"px Roboto, Arial, sans-serif",ue.fillStyle="#ffffff",ue.fillText("SCORE",s,a),ue.font="400 "+C+"px Roboto, Arial, sans-serif",ue.fillStyle="#ffffff";const o=parseInt(q.user.percentCovered);return ue.fillText(o,s-C*.04,a+C-t*.9+C*A*3),gC.toDataURL()})}function fR({prototype:i}){i.shareScore=function(){return SV(this,null,function*(){if(!this.active||!q.settings.general.share)return;Gg.call("Share score");const g=q.data.content["share-score"],I=g[Math.floor(Math.random()*g.length)],e=yield Gc(),t=parseInt(q.user.percentCovered);try{window.H5SDK.getPlatform().shareWithFriends(e,I)}catch(C){console.error(C)}finally{q.analytics.event("share_score_feed",{category:"share",score:t})}})},i.shareScoreMessenger=function(){return SV(this,null,function*(){if(!this.active||!q.settings.general.share)return;Gg.call("Share score");const g=yield Gc();parseInt(q.user.percentCovered);const e=`My score is ${parseInt(q.user.percentCovered)}\xA0\u{1F4AA}
Try to beat me!`;try{window.H5SDK.getPlatform().inviteFriends(g,e)}catch(t){console.error(t)}finally{}})}}function SR({prototype:i}){i.initBot=function(){return SV(this,null,function*(){try{Gg.call("player.canSubscribeBotAsync()"),(yield FBInstant.player.canSubscribeBotAsync())&&(Gg.call("player.subscribeBotAsync()"),yield FBInstant.player.subscribeBotAsync())}catch(g){}})}}const pc=Symbol("ad_loading");function FR({prototype:i}){i.initAds=function(){this.ads||(this.ads={rewarded:null,interstitial:null})},i.preloadAd=function(g,I=2){return SV(this,null,function*(){if(this.initAds(),!!this.active&&!this.ads[g])try{this.ads[g]=pc,Gg.log("Preload "+g+" ad");const e=g==="rewarded"?"getRewardedVideoAsync":"getInterstitialAdAsync";Gg.call(e+"()");const t=yield FBInstant[e](this.config[g+"Ad"]);Gg.call(g+".loadAsync()"),yield t.loadAsync(),this.ads[g]=t}catch(e){this.ads[g]=null,Gg.error("Failed to preload "+g+" ad"),Gg.error(JSON.stringify(e),!0),I>0&&window.setTimeout(()=>this.preloadAd(g,I-1),15e3)}})},i.showAd=function(g){return SV(this,null,function*(){if(this.initAds(),!this.active)return;const I=this.ads[g];!I||(Gg.call(g+".showAsync()"),this.ads[g]=null,document.body.removeAttribute("data-fb-spinner"),yield I.showAsync())})},i.playAd=function(g,I=3){return SV(this,null,function*(){if(this.initAds(),!!this.active)try{q.pause(),document.body.setAttribute("data-fb-spinner","");const e=this.ads[g];if(e||this.preloadAd(g),e&&!e!==pc)yield this.showAd(g);else{if(I>0)return yield q.time.wait(1e3),yield this.playAd(g,I-1);yield q.time.wait(2e3)}return document.body.removeAttribute("data-fb-spinner"),!0}catch(e){return Gg.error(e),!(e.code&&e.code==="USER_INPUT")}finally{q.resume(),this.preloadAd(g)}})}}const qc=()=>Math.ceil(Date.now()/1e3),Bc=()=>parseInt(q.user.percentCovered),vR=604800,NR=vR;function KR({prototype:i}){i.checkEndedTournaments=function(){return SV(this,null,function*(){const g=qc(),I=q.settings.user;Array.isArray(I.tournaments)||(I.tournaments=[]);const e=I.tournaments;Gg.log("Tournaments: "+JSON.stringify(e));for(let t=e.length-1;t>=0;t--)if(!(e[t][1]>=g)){q.popins.set("Tournament",void 0,this.tournamentPopinClosed),e.splice(t,1);break}})},i.tournamentPopinClosed=function(){return SV(this,null,function*(){q.coins.add(50),this.checkEndedTournaments()})},i.isInTournament=function(){return SV(this,null,function*(){return!1})},i.createOrUpdateTournament=function(){return SV(this,null,function*(){(yield this.isInTournament())?yield this.updateTournament():yield this.createTournament()})},i.createTournament=function(){return SV(this,null,function*(){const g=Bc(),I=yield this.getName();Gg.call("tournament.createAsync()");try{const e=yield FBInstant.tournament.createAsync({initialScore:g,config:{title:"Paper.io 2 \u2013 Tournament created by "+I,sortOrder:"HIGHER_IS_BETTER",scoreFormat:"NUMERIC",endTime:qc()+NR}});this.registerTournament(e),this.tournamentPlaySent=!0,q.analytics.event("tournament_create",{category:"share"})}catch(e){}})},i.registerTournament=function(g){return SV(this,null,function*(){const I=q.settings.user,e=g.getID(),t=g.getEndTime();Array.isArray(I.tournaments)||(I.tournaments=[]);const C=I.tournaments;C.reduce((s,a)=>s||a[0]===e,!1)?Gg.log("Already register to tournament "+e):(Gg.log("Register to tournament "+e),C.push([e,t]))})},i.updateTournament=function(){return SV(this,null,function*(){const g=Bc();try{Gg.call("tournament.postScoreAsync()"),yield FBInstant.tournament.postScoreAsync(g),Gg.call("tournament.shareAsync()"),yield FBInstant.tournament.shareAsync({score:g})}catch(I){}})}}const JR=[BR,WR,fR,SR,FR,KR];class ah{constructor(){autobind(this);const V=data.configuration.facebook;this.active=!!V,this.config=V,this.id=V&&V.appID,this.mock=V&&V.mock}initialize(V){this.callBack=V,this.onSdkReady(),window.H5SDK.getPlatform().init()}onSdkReady(){return SV(this,null,function*(){window.H5SDK.addEventListener("onLoadingStart",()=>SV(this,null,function*(){this.callBack&&this.callBack()})),console.log("sdk ready,",window.H5SDK.getPlatform().getName())})}setLoadingProgress(V=0){return SV(this,null,function*(){this.active})}startGame(){return SV(this,null,function*(){Gg.success("Game Started")})}payment(){return SV(this,null,function*(){const{body:V}=document;V.setAttribute("data-placeholder","Payment"),yield q.time.wait(2e3),V.removeAttribute("data-placeholder")})}askForShorcut(){return SV(this,null,function*(){})}initModals(){return SV(this,null,function*(){yield this.initBot()})}retryWhenFailure(e){return SV(this,arguments,function*(V,g=[],I=6){try{return yield V.call(void 0,g)}catch(t){return I--,t.code&&Gg.error("ERROR"),I<=0?void 0:(yield new Promise(C=>setTimeout(C,50)),yield this.retryWhenFailure(V,g,I))}})}}JR.forEach(i=>i(ah));class MR{constructor(){autobind(this),this.list=[];const{Spritesheets:V}=q.DOMElements;this.add(V),q.addEventListener("update",this.update)}add(V){for(const g of V){const I=Array.from(g.parentNode.children);g.frame=I.indexOf(g)*2,this.list.push(g)}}remove(V){for(const g of V)this.list.remove(g)}update(){if(!!q.settings.quality.spritesheets)for(const V of this.list){if(V.frame++,V.frame%=60,V.frame>59)continue;const g=V.frame%8/8*100,I=Math.floor(V.frame/8)/8*100;q.setStyleProperty(V,"--translate",`translate(${-g}%, ${-I}%)`)}}}class xR{constructor(){autobind(this),this.count=0,q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update),q.addEventListener("afterUpdate",this.afterUpdate)}add(V){const g=this.count+V,I=Math.max(V*.5,1e3);return LV({targets:q.settings.user,easing:"easeOutQuart",round:1,duration:I,coins:g}).finished}remove(V){const g=this.count-V,I=Math.max(V*.5,1e3);return LV({targets:q.settings.user,easing:"easeOutQuart",round:1,duration:I,coins:g}).finished}update(){const{coins:V}=q.settings.user;this.count=V}afterUpdate(){const{HeaderCoins:V}=q.DOMElements;q.setTextContent(V,this.count)}get value(){return this.count}}const Wc=i=>typeof i=="object"&&i!=null;function _s(i,V){if(i===V)return!0;if(Wc(i)&&Wc(V)){if(Object.keys(i).length!==Object.keys(V).length)return!1;for(const g in i)if(!_s(i[g],V[g]))return!1;return!0}return!1}class kR{constructor(){autobind(this)}getCurrentDay(){return Math.floor(Date.now()/1e3/60/60/24)}normalizeSaveData(V={}){const g={},e=isNaN(V.coins)||V.coins==null?0:V.coins;g.coins=Math.max(0,e),g.name=V.name!=null?V.name:Te.user.name.value,g.skinID=Te.user.skinID.options.includes(V.skinID)?V.skinID:Te.user.skinID.options[0];const t={},C=V.bestStats||{};for(const s in Te.user.bestStats){const a=C[s],o=Te.user.bestStats[s],n=o.min!=null;a==null?n?t[s]=o.min:t[s]=o.value:n?t[s]=Math.max(o.min,Math.min(o.max,a)):t[s]=a,s==="kingKilled"&&(t[s]=!!t[s])}g.bestStats=t;const A=this.getCurrentDay();return g.streakStart=V.streakStart==null||A-V.streakStart>1?A:V.streakStart,g.bestStats.consecutiveDays=Math.max(A-g.streakStart,g.bestStats.consecutiveDays),Array.isArray(g.tournaments)||(g.tournaments=[]),g}getSave(){return SV(this,null,function*(){let V={};V=yield q.facebook.loadStats(),V||(V={});const g=q.settings.user.name;return V.name==null&&(V.name=g),this.normalizeSaveData(V)})}setSave(){return SV(this,arguments,function*(V={}){yield q.facebook.saveStats(V)})}initialize(){return SV(this,null,function*(){yield new Promise(g=>setTimeout(g,150)),this.saving=!1,this.saveCheckInterval=500,this.lastCheck=0;const V=yield this.getSave();this.initialized=!0,Object.assign(q.settings.user,this.normalizeSaveData(V)),this.save(V),this.addEventListeners()})}addEventListeners(){q.addEventListener("afterRender",this.afterRender)}save(V){return SV(this,null,function*(){!this.initialized||this.saving||(this.saving=!0,this.currentSave=V,yield this.setSave(V),this.saving=!1)})}afterRender(){if(!this.initialized||this.saving)return;const V=Date.now();if(V-this.lastCheck<this.saveCheckInterval)return;this.lastCheck=V;const g=this.normalizeSaveData(q.settings.user);_s(g,this.currentSave)}saveData(){const V=this.normalizeSaveData(q.settings.user);!_s(V,this.currentSave)&&this.save(V)}}class aa extends wC{constructor(V,g=200,I){super(),autobind(this),this.size=g,this.isVisible=!1,this.parameters={canvas:V,antialias:I,alpha:!0},this.camera=new jg(45,1,1,50),this.boundingSphere=new XI,this.ambientLight=new wl,this.add(this.ambientLight),this.hemisphereLight=new Xl,this.hemisphereLight.position.set(0,50,0),this.add(this.hemisphereLight),this.directionalLight=new en,this.directionalLight.direction=new S,this.directionalLight.shadow.camera.far=100,this.add(this.directionalLight),this.add(this.directionalLight.target),q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("applySettings",this.applySettings),q.addEventListener("update",this.update),q.addEventListener("render",this.render),q.addEventListener("onViewChange",this.onViewChange)}removeEventListeners(){q.removeEventListener("applySettings",this.applySettings),q.removeEventListener("update",this.update),q.removeEventListener("render",this.render),q.removeEventListener("onViewChange",this.onViewChange)}applySettings(){const{ambientLight:V,hemisphereLight:g,directionalLight:I}=q.settings.lighting;this.ambientLight.intensity=V.intensity,this.ambientLight.color.set(V.color),this.hemisphereLight.intensity=g.intensity,this.hemisphereLight.color.set(g.skyColor),this.hemisphereLight.groundColor.set(g.groundColor),this.directionalLight.intensity=I.intensity,this.directionalLight.color.set(I.color),this.directionalLight.direction.copy(I.position),this.directionalLight.castShadow=!0}update(){const V=S.get();this.directionalLight.target.position.copy(V),this.directionalLight.position.copy(V).add(this.directionalLight.direction),S.release(V)}dispose(){this.isDisposed||(this.isDisposed=!0,this.isVisible=!1,this.renderer&&(this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderer=null),this.removeEventListeners(),this.dispatchEvent({type:"dispose"}))}render(){!this.isVisible||(this.renderer=this.renderer||new ig(this.parameters),this.renderer.setSize(this.size,this.size),this.renderer.setPixelRatio(2),this.camera.updateProjectionMatrix(),this.renderer.setClearAlpha(0),this.renderer.render(this,this.camera))}onViewChange(){}}class zR extends aa{constructor(V,g,I,e,t,C){const A=g.cloneNode(!0),s=A.querySelector("button");V.appendChild(A),super(A.querySelector("canvas"),I),this.onClose=C,this.objectID=e,this.isTournament=e==="Tournament";const a=A.querySelector(".banner__achievement");if(a&&(a.innerHTML=t),this.pivot=new UV,this.add(this.pivot),this.isTournament)this.spritesheets=A.querySelectorAll('[ data-element="Spritesheets" ]'),q.spritesheets.add(this.spritesheets),A.classList.add("notification--tournament");else{this.object=new ln,this.object.setGeometry(e),this.object.addEventListeners(),this.pivot.add(this.object);const{isBonus:o}=this.object,n=o?"bonus":"skin";A.classList.add(`notification--${n}`)}this.DOMElements={ParentNode:V,Container:A,Button:s},this.addEventListeners()}addEventListeners(){super.addEventListeners();const{Container:V,Button:g}=this.DOMElements;g&&g.addEventListener("click",this.onClick),V.addEventListener("transitionend",this.onTransitionEnd,!0)}dispose(){if(this.isDisposed)return;super.dispose();const{ParentNode:V,Container:g}=this.DOMElements;V.removeChild(g),this.spritesheets&&q.spritesheets.remove(this.spritesheets)}exit(){this.isHidden=!0;const{ParentNode:V,Container:g}=this.DOMElements;g.classList.remove("notification--visible"),g.classList.add("notification--hidden");const{nextSibling:I}=g;I?I.classList.add("notification--visible"):V.classList.remove("notifications--visible"),this.onClose&&this.onClose(),this.onClose=void 0}update(){if(super.update(),!this.object)return;const{isBonus:V,boundingSphere:g}=this.object,{center:I,radius:e}=g;this.object.position.copy(I).negate(),this.pivot.rotation.x=.5,this.pivot.rotation.y+=.025;const t=this.camera.fov*(Math.PI/180),C=Math.abs(e*2/Math.sin(t/2))*.5;this.camera.position.set(0,0,V?1.25:1).multiplyScalar(Math.max(C,8.5)),this.camera.lookAt(0,-.25,0);const{Container:A}=this.DOMElements;this.isVisible=A.classList.contains("notification--visible")}onTransitionEnd(V){const{target:g}=V,I=g.classList.contains("notification--visible");g.classList.contains("banner")&&I?q.time.setDelay(this.exit,1500):this.isHidden&&this.dispose()}onClick(){this.exit()}}class oh{constructor(V,g,I){autobind(this),this.size=I,this.objectIDs=new Set,this.DOMElements={ParentNode:V,Template:g},V.removeChild(g),g.removeAttribute("data-element"),q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){}set(V,g,I){return SV(this,null,function*(){if(V!=="Tournament"&&this.objectIDs.has(V))return;this.objectIDs.add(V);const{ParentNode:e,Template:t}=this.DOMElements,C=new zR(e,t,this.size,V,g,I);if(C.addEventListener("dispose",this.onDispose),this.objectIDs.size===1){yield q.time.wait(100);const{Container:A}=C.DOMElements;A.classList.add("notification--visible"),e.classList.add("notifications--visible")}})}onDispose(V){const{target:g}=V;this.objectIDs.delete(g.objectID)}}class TR extends oh{constructor(){const{Popins:V,PopinTemplate:g}=q.DOMElements;super(V,g),autobind(this)}addEventListeners(){super.addEventListeners(),q.addEventListener("onViewChange",this.onViewChange)}onViewChange(V){const{currentViewID:g}=V,{ButtonSkins:I,Popins:e}=q.DOMElements;g==="SkinSelector"?I.classList.remove("button--notification"):e.children.length&&(I.classList.add("button--notification"),q.changeSkinText(2))}}class LR extends oh{constructor(){const{Banners:V,BannerTemplate:g}=q.DOMElements;super(V,g,65),autobind(this)}}class UR{constructor(){autobind(this),q.addEventListener("ready",this.initialize);const{RankingPic:V}=q.DOMElements;let g=[0,6,12,18];for(let I=0;I<V.length;I++){let e=document.createElement("img");e.style.top="-19px",e.style.right=g[I]+"px",e.style.position="absolute",e.style["border-radius"]="15px",V[I].appendChild(e),V[I].img=e}}initialize(){this.addEventListeners()}addEventListeners(){q.addEventListener("update",this.update)}update(){if(q.currentViewID!=="Game")return;const{RankingRanks:V,RankingPercents:g,RankingNames:I,RankingPlaces:e,RankingPic:t}=q.DOMElements,C=[];for(const s of q.players)s.isDead||C.push(s);const A=C.sort((s,a)=>a.territory.percentCovered-s.territory.percentCovered);for(let s=0,a=A.length;s<a;s++){const o=A[s];o.isKing=s===0,o.rank=s,s<3?(q.setTextContent(g[s],o.percentCovered),q.setTextContent(I[s],o.name),this.setColors(V[s],o),t[s].img.src=o.isUser?q.photo:o.pic):o.isUser&&(q.setTextContent(e[3],s+1),q.setTextContent(g[3],o.percentCovered),q.setTextContent(I[3],o.name),this.setColors(V[3],o),t[3].img.src=q.photo)}for(let s=0,a=V.length;s<a;s++){const o=V[s];if(s<3){const n=s<C.length;q.setClass(o,"ranking__rank--visible",n)}else{const{rank:n,isDead:l}=q.user,c=!l&&n>2;q.setClass(o,"ranking__rank--visible",c)}}}setColors(V,g){const{colors:I}=g.territory;q.setStyleProperty(V,"--color-background",I[0]),q.setStyleProperty(V,"--color-border",I[1])}}class DR extends aa{constructor(){const{BonusTimer:V}=q.DOMElements;super(V.querySelector("canvas"),40),this.pivot=new UV,this.add(this.pivot),this.object=new ln,this.object.addEventListeners(),this.pivot.add(this.object),this.progress=0,this.isVisible=!0}set(V="EagleEye"){this.objectID=V,this.object.setGeometry(V)}update(){if(super.update(),!this.object)return;const{boundingSphere:V}=this.object,{center:g,radius:I}=V;this.object.position.copy(g).negate(),this.pivot.rotation.x=.5,this.pivot.rotation.y+=.035;const e=this.camera.fov*(Math.PI/180),t=Math.abs(I*2/Math.sin(e/2))*.5;this.camera.position.set(0,0,1).multiplyScalar(Math.max(t,8.5)),this.camera.lookAt(0,-.25,0)}setProgress(V){const{BonusTimerCircle:g}=q.DOMElements,e=g.r.baseVal.value*2*Math.PI;g.style.strokeDasharray=`${e} ${e}`;const t=V*e;g.style.strokeDashoffset=t}}class ER{constructor(){this.stiffness=.01,this.restLength=0,this.friction=.95,this.target=new dV,this.position=new dV,this.velocity=new dV}set(V=0,g=0){this.target.set(V,g)}update(){const V=dV.get().copy(this.target).sub(this.position);V.setLength(V.length()-this.restLength);const g=V.multiplyScalar(this.stiffness);this.velocity.add(g),this.velocity.multiplyScalar(this.friction),this.position.add(this.velocity),dV.release(V)}}class QR{constructor(){autobind(this),this.isScrollable=!1,this.isGrabbed=!1,this.spring=new ER,this.initial=new dV,this.velocity=new dV,this.position=new dV,this.initialPosition=new dV,this.deltaPosition=new dV,this.setSize(),q.addEventListener("ready",this.initialize)}initialize(){this.addEventListeners()}addEventListeners(){const{multiTouch:V,mouse:g,keyboard:I}=XV,{ButtonSelect:e,ButtonBack:t}=q.DOMElements;e.addEventListener("click",this.onClick),t.addEventListener("click",this.onBackClick),V.addEventListener("touchStart",this.onInputStart),V.addEventListener("touchMove",this.onInputMove),V.addEventListener("touchEnd",this.onInputEnd),g.addEventListener("down",this.onInputStart),g.addEventListener("move",this.onInputMove),g.addEventListener("up",this.onInputEnd),I.addEventListener("keyDown",this.onKeyDown),q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}update(){this.setSpring(),this.position.copy(this.spring.position).negate(),this.progress=this.position.x/this.scrollWidth;const{ButtonSelect:V,Slider:g}=q.DOMElements,{map:I,hoveredSkin:e}=q.user.skinList,t=I.get(this.getCenteredSkinID()),C=e&&(e.isUnlocked||e!==t),A=t?t.isUnlocked:!1,{body:s}=document;q.setClass(s,"grab",this.isScrollable),q.setClass(s,"grabbing",this.isScrollable&&this.isGrabbed),q.setClass(s,"pointer",this.isClickable&&C),q.setClass(V,"button--disabled",!A),q.setStyleProperty(g,"--translate",`${this.position.x}px`)}onClick(){return SV(this,null,function*(){q.settings.user.skinID=this.getCenteredSkinID(),yield q.time.wait(10);const{previousViewID:V}=q;V=="EndScreen"?q.router.navigate("end-screen"):q.router.navigate("")})}onBackClick(){return SV(this,null,function*(){const{previousViewID:V}=q;V=="EndScreen"?q.router.navigate("end-screen"):q.router.navigate("")})}getCenteredSkinID(){const{Slides:V}=q.DOMElements,{skinIDs:g}=q.user.skinList;return g[Math.round(-this.progress*V.length)]}setSpring(){const V=this.spring.velocity.length(),g=Math.clamp(V,0,50);if(this.spring.stiffness=Math.mapLinear(g,0,50,.05,.01),this.spring.friction=Math.mapLinear(g,0,50,.75,.85),this.isGrabbed){if(this.spring.target.x<0){const t=Math.clamp(this.spring.target.x,-500,0);this.spring.stiffness*=Math.mapLinear(t,-500,0,0,1)}if(this.spring.target.x>this.maxScroll){const I=this.maxScroll,e=this.maxScroll+500,t=Math.clamp(this.spring.target.x,I,e);this.spring.stiffness*=Math.mapLinear(t,I,e,1,0)}}if(this.isScrollable&&!this.isGrabbed){const{Slides:I}=q.DOMElements,e=Math.round(this.spring.target.x/this.scrollWidth*I.length),t=Math.clamp(e,0,I.length-1);this.spring.target.x=t*this.scrollStep}this.spring.update()}setScrollLeft(){const{skinID:V,skinList:g}=q.user;this.index=g.skinIDs.indexOf(V),this.spring.position.x=this.index*this.scrollStep,this.spring.target.x=this.index*this.scrollStep}onInputStart(){const{elapsedTime:V}=q.time;this.startTime=V,this.setDelta();const{multiTouch:g,mouse:I}=XV;(g.getTouch()||I).getPosition(this.initialPosition),this.initial.copy(this.spring.target),this.isGrabbed=!0}onInputMove(){if(this.setDelta(),!this.isScrollable)return;const{multiTouch:V,mouse:g}=XV,{speed:I}=q.settings.skinSelector;!V.isActive&&!g.isDown||this.spring.target.copy(this.deltaPosition).multiplyScalar(-I).add(this.initial)}onInputEnd(){if(this.setDelta(),this.isGrabbed=!1,this.deltaTime<250&&this.deltaPosition.length()<10){const{currentViewID:V,router:g}=q,{hoveredSkin:I,skinIDs:e}=q.user.skinList;if(!I)return;if(V==="SkinSelector"){const{skinID:t}=I;if(t!==this.getCenteredSkinID()){const C=e.indexOf(t);this.spring.target.x=C*this.scrollStep}else I.isUnlocked&&this.onClick()}else V==="Home"&&g.navigate("skin-selector")}}onKeyDown(){if(!this.isScrollable)return;const{isDown:V}=XV.keyboard;V("ArrowRight")&&(this.spring.target.x+=this.scrollStep),V("ArrowLeft")&&(this.spring.target.x-=this.scrollStep)}onViewChange(V){const{currentViewID:g}=V;this.isScrollable=g.match(/SkinSelector/g),this.isClickable=g.match(/(SkinSelector|Home)/g),g=="SkinSelector"&&(q.skinText.style.display="none")}setDelta(){const{elapsedTime:V}=q.time,{multiTouch:g,mouse:I}=XV;(g.getTouch()||I).getPosition(this.deltaPosition).sub(this.initialPosition),this.deltaTime=V-this.startTime,this.lastInteractionTime=V}exit(){return SV(this,null,function*(){const V=this.index*this.scrollStep,g=Math.clamp(Math.abs(this.spring.position.x-V),0,1500);yield LV({targets:[this.spring.position,this.spring.target],easing:"easeOutExpo",x:V,duration:g}),yield q.time.wait(g*.5)})}setSize(){const{Slides:g,Slider:I}=q.DOMElements;this.scrollWidth=g.length*320,this.maxScroll=this.scrollWidth-320,this.scrollStep=this.scrollWidth/g.length,q.setStyleProperty(I,"--width",`${320}px`)}}class oa extends aa{constructor(){const{textures:V}=XV.assets,{EndScreenCanvas:g}=q.DOMElements,I=window.innerHeight<=568?130:190;super(g,I,!0),autobind(this),this.time=new Pl,this.material=new Mr({envMap:V.EnvMap,transparent:!0,metalness:.05,roughness:.95}),this.pivot=new UV,this.add(this.pivot),this.mesh=new og(new $V,this.material),this.pivot.add(this.mesh)}addEventListeners(){super.addEventListeners();const{ButtonShareFeed:V,ButtonShareFriend:g,ButtonRetry:I}=q.DOMElements;I.addEventListener("click",this.onClick),V.addEventListener("click",this.onClick),g.addEventListener("click",this.onClick)}update(){super.update();const{shape:V,size:g,center:I,territoryID:e}=q.user.territory,{materials:t}=XV.assets;V&&(this.mesh.geometry=V.geometry,this.mesh.position.copy(I).negate()),this.material.map!==t[e].map&&(this.material.map=t[e].map,this.material.color.copy(t[e].color),this.material.needsUpdate=!0);const{elapsedTime:C}=q.time,A=C*.001;this.pivot.rotation.x=.15+Math.sin(A)*.06,this.pivot.rotation.z=Math.cos(A)*.06;const s=this.camera.fov*(Math.PI/180),a=Math.max(g.x,g.z),o=Math.abs(a/Math.sin(s/2))*.5;this.camera.far=o*1.5,this.camera.position.set(0,1.05,0).multiplyScalar(o),this.camera.lookAt(0,0,0),this.camera.updateProjectionMatrix()}onClick(V){return SV(this,null,function*(){const{ButtonShareFeed:g,ButtonShareFriend:I,ButtonRetry:e}=q.DOMElements,{currentTarget:t}=V;t===e?(fg.to(g,{duration:.3,scaleX:0,scaleY:0}),fg.to(I,{delay:.05,duration:.3,scaleX:0,scaleY:0}),fg.to(e,{delay:.1,duration:.3,opacity:1,onComplete:()=>{q.analytics.event("tryagain",{category:"gameplay"}),q.router.navigate("game")}})):t===g?yield q.facebook.shareScore():t===I&&(yield q.facebook.shareScoreMessenger())})}onViewChange(V){return SV(this,null,function*(){xi(oa.prototype,this,"onViewChange").call(this,V);const{currentViewID:g,previousViewID:I}=V;this.isVisible=g==="EndScreen";const{ButtonShareFeed:e,ButtonShareFriend:t,ButtonRetry:C}=q.DOMElements;e.style.display="none",t.style.display="none",this.isVisible&&(console.log("onViewChange:EndScreen"),console.log("EndScreen : requestInterstitialAd"),window.H5SDK.getAdsModule().requestInterstitialAd().then(A=>{console.log("EndScreen result:",A)}))})}}class jR{constructor(){autobind(this);const{GameOverProgress:V}=q.DOMElements;this.height=V.getAttribute("height"),this.duration=1e3*5,this.addEventListeners()}addEventListeners(){const{GameOverButtonCoins:V}=q.DOMElements;V.addEventListener("click",this.onClick),q.addEventListener("update",this.update),q.addEventListener("onViewChange",this.onViewChange)}start(){if(this.isStarted)return;this.isStarted=!0;const{settings:V,coins:g}=q;V.general;const{price:I}=V.bonus,{count:e}=g;this.currentTime=e<I?1500:this.duration}stop(){!this.isStarted||(this.isStarted=!1,this.currentTime<0&&q.router.navigate("end-screen"))}update(){const{settings:V,coins:g}=q;V.general;const{price:I}=V.bonus,{count:e}=g,{GameOver:t,GameOverCountdown:C,GameOverProgress:A,GameOverButtonCoins:s,CoinsPrices:a}=q.DOMElements;if(t.style.display=e<I?"none":null,s.style.display=e<I?"none":null,!!this.isStarted){if(this.currentTime>0){const{deltaTime:o}=q.time;this.currentTime-=o,this.progress=1-this.currentTime/this.duration}else this.stop();q.setTextContent(C,Math.ceil(this.currentTime*.001)),A.setAttribute("y",this.progress*this.height)}}onClick(V){return SV(this,null,function*(){this.stop();const{currentTarget:g}=V,{GameOverButtonCoins:I}=q.DOMElements,{price:e}=q.settings.bonus;q.coins.remove(e);const t="revive_"+(g===I?"coins":"monet");q.analytics.event(t,{category:"gameplay"}),q.user.revive()})}onViewChange(V){const{currentViewID:g}=V,I=g==="GameOver";this[I?"start":"stop"](),I?q.isGameOver=!0:q.isGameOver=!1}}var ch={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(i){(function(){var V=function(){this.init()};V.prototype={init:function(){var n=this||g;return n._counter=1e3,n._html5AudioPool=[],n.html5PoolSize=10,n._codecs={},n._howls=[],n._muted=!1,n._volume=1,n._canPlayEvent="canplaythrough",n._navigator=typeof window!="undefined"&&window.navigator?window.navigator:null,n.masterGain=null,n.noAudio=!1,n.usingWebAudio=!0,n.autoSuspend=!0,n.ctx=null,n.autoUnlock=!0,n._setup(),n},volume:function(n){var l=this||g;if(n=parseFloat(n),l.ctx||o(),typeof n!="undefined"&&n>=0&&n<=1){if(l._volume=n,l._muted)return l;l.usingWebAudio&&l.masterGain.gain.setValueAtTime(n,g.ctx.currentTime);for(var c=0;c<l._howls.length;c++)if(!l._howls[c]._webAudio)for(var d=l._howls[c]._getSoundIds(),h=0;h<d.length;h++){var m=l._howls[c]._soundById(d[h]);m&&m._node&&(m._node.volume=m._volume*n)}return l}return l._volume},mute:function(n){var l=this||g;l.ctx||o(),l._muted=n,l.usingWebAudio&&l.masterGain.gain.setValueAtTime(n?0:l._volume,g.ctx.currentTime);for(var c=0;c<l._howls.length;c++)if(!l._howls[c]._webAudio)for(var d=l._howls[c]._getSoundIds(),h=0;h<d.length;h++){var m=l._howls[c]._soundById(d[h]);m&&m._node&&(m._node.muted=n?!0:m._muted)}return l},stop:function(){for(var n=this||g,l=0;l<n._howls.length;l++)n._howls[l].stop();return n},unload:function(){for(var n=this||g,l=n._howls.length-1;l>=0;l--)n._howls[l].unload();return n.usingWebAudio&&n.ctx&&typeof n.ctx.close!="undefined"&&(n.ctx.close(),n.ctx=null,o()),n},codecs:function(n){return(this||g)._codecs[n.replace(/^x-/,"")]},_setup:function(){var n=this||g;if(n.state=n.ctx&&n.ctx.state||"suspended",n._autoSuspend(),!n.usingWebAudio)if(typeof Audio!="undefined")try{var l=new Audio;typeof l.oncanplaythrough=="undefined"&&(n._canPlayEvent="canplay")}catch(c){n.noAudio=!0}else n.noAudio=!0;try{var l=new Audio;l.muted&&(n.noAudio=!0)}catch(c){}return n.noAudio||n._setupCodecs(),n},_setupCodecs:function(){var n=this||g,l=null;try{l=typeof Audio!="undefined"?new Audio:null}catch(Z){return n}if(!l||typeof l.canPlayType!="function")return n;var c=l.canPlayType("audio/mpeg;").replace(/^no$/,""),d=n._navigator?n._navigator.userAgent:"",h=d.match(/OPR\/([0-6].)/g),m=h&&parseInt(h[0].split("/")[1],10)<33,r=d.indexOf("Safari")!==-1&&d.indexOf("Chrome")===-1,u=d.match(/Version\/(.*?) /),b=r&&u&&parseInt(u[1],10)<15;return n._codecs={mp3:!!(!m&&(c||l.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!c,opus:!!l.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(l.canPlayType('audio/wav; codecs="1"')||l.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!l.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!l.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(l.canPlayType("audio/x-m4a;")||l.canPlayType("audio/m4a;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(l.canPlayType("audio/x-m4b;")||l.canPlayType("audio/m4b;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(l.canPlayType("audio/x-mp4;")||l.canPlayType("audio/mp4;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!b&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!b&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!l.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(l.canPlayType("audio/x-flac;")||l.canPlayType("audio/flac;")).replace(/^no$/,"")},n},_unlockAudio:function(){var n=this||g;if(!(n._audioUnlocked||!n.ctx)){n._audioUnlocked=!1,n.autoUnlock=!1,!n._mobileUnloaded&&n.ctx.sampleRate!==44100&&(n._mobileUnloaded=!0,n.unload()),n._scratchBuffer=n.ctx.createBuffer(1,1,22050);var l=function(c){for(;n._html5AudioPool.length<n.html5PoolSize;)try{var d=new Audio;d._unlocked=!0,n._releaseHtml5Audio(d)}catch(Z){n.noAudio=!0;break}for(var h=0;h<n._howls.length;h++)if(!n._howls[h]._webAudio)for(var m=n._howls[h]._getSoundIds(),r=0;r<m.length;r++){var u=n._howls[h]._soundById(m[r]);u&&u._node&&!u._node._unlocked&&(u._node._unlocked=!0,u._node.load())}n._autoResume();var b=n.ctx.createBufferSource();b.buffer=n._scratchBuffer,b.connect(n.ctx.destination),typeof b.start=="undefined"?b.noteOn(0):b.start(0),typeof n.ctx.resume=="function"&&n.ctx.resume(),b.onended=function(){b.disconnect(0),n._audioUnlocked=!0,document.removeEventListener("touchstart",l,!0),document.removeEventListener("touchend",l,!0),document.removeEventListener("click",l,!0),document.removeEventListener("keydown",l,!0);for(var Z=0;Z<n._howls.length;Z++)n._howls[Z]._emit("unlock")}};return document.addEventListener("touchstart",l,!0),document.addEventListener("touchend",l,!0),document.addEventListener("click",l,!0),document.addEventListener("keydown",l,!0),n}},_obtainHtml5Audio:function(){var n=this||g;if(n._html5AudioPool.length)return n._html5AudioPool.pop();var l=new Audio().play();return l&&typeof Promise!="undefined"&&(l instanceof Promise||typeof l.then=="function")&&l.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(n){var l=this||g;return n._unlocked&&l._html5AudioPool.push(n),l},_autoSuspend:function(){var n=this;if(!(!n.autoSuspend||!n.ctx||typeof n.ctx.suspend=="undefined"||!g.usingWebAudio)){for(var l=0;l<n._howls.length;l++)if(n._howls[l]._webAudio){for(var c=0;c<n._howls[l]._sounds.length;c++)if(!n._howls[l]._sounds[c]._paused)return n}return n._suspendTimer&&clearTimeout(n._suspendTimer),n._suspendTimer=setTimeout(function(){if(!!n.autoSuspend){n._suspendTimer=null,n.state="suspending";var d=function(){n.state="suspended",n._resumeAfterSuspend&&(delete n._resumeAfterSuspend,n._autoResume())};n.ctx.suspend().then(d,d)}},3e4),n}},_autoResume:function(){var n=this;if(!(!n.ctx||typeof n.ctx.resume=="undefined"||!g.usingWebAudio))return n.state==="running"&&n.ctx.state!=="interrupted"&&n._suspendTimer?(clearTimeout(n._suspendTimer),n._suspendTimer=null):n.state==="suspended"||n.state==="running"&&n.ctx.state==="interrupted"?(n.ctx.resume().then(function(){n.state="running";for(var l=0;l<n._howls.length;l++)n._howls[l]._emit("resume")}),n._suspendTimer&&(clearTimeout(n._suspendTimer),n._suspendTimer=null)):n.state==="suspending"&&(n._resumeAfterSuspend=!0),n}};var g=new V,I=function(n){var l=this;if(!n.src||n.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}l.init(n)};I.prototype={init:function(n){var l=this;return g.ctx||o(),l._autoplay=n.autoplay||!1,l._format=typeof n.format!="string"?n.format:[n.format],l._html5=n.html5||!1,l._muted=n.mute||!1,l._loop=n.loop||!1,l._pool=n.pool||5,l._preload=typeof n.preload=="boolean"||n.preload==="metadata"?n.preload:!0,l._rate=n.rate||1,l._sprite=n.sprite||{},l._src=typeof n.src!="string"?n.src:[n.src],l._volume=n.volume!==void 0?n.volume:1,l._xhr={method:n.xhr&&n.xhr.method?n.xhr.method:"GET",headers:n.xhr&&n.xhr.headers?n.xhr.headers:null,withCredentials:n.xhr&&n.xhr.withCredentials?n.xhr.withCredentials:!1},l._duration=0,l._state="unloaded",l._sounds=[],l._endTimers={},l._queue=[],l._playLock=!1,l._onend=n.onend?[{fn:n.onend}]:[],l._onfade=n.onfade?[{fn:n.onfade}]:[],l._onload=n.onload?[{fn:n.onload}]:[],l._onloaderror=n.onloaderror?[{fn:n.onloaderror}]:[],l._onplayerror=n.onplayerror?[{fn:n.onplayerror}]:[],l._onpause=n.onpause?[{fn:n.onpause}]:[],l._onplay=n.onplay?[{fn:n.onplay}]:[],l._onstop=n.onstop?[{fn:n.onstop}]:[],l._onmute=n.onmute?[{fn:n.onmute}]:[],l._onvolume=n.onvolume?[{fn:n.onvolume}]:[],l._onrate=n.onrate?[{fn:n.onrate}]:[],l._onseek=n.onseek?[{fn:n.onseek}]:[],l._onunlock=n.onunlock?[{fn:n.onunlock}]:[],l._onresume=[],l._webAudio=g.usingWebAudio&&!l._html5,typeof g.ctx!="undefined"&&g.ctx&&g.autoUnlock&&g._unlockAudio(),g._howls.push(l),l._autoplay&&l._queue.push({event:"play",action:function(){l.play()}}),l._preload&&l._preload!=="none"&&l.load(),l},load:function(){var n=this,l=null;if(g.noAudio){n._emit("loaderror",null,"No audio support.");return}typeof n._src=="string"&&(n._src=[n._src]);for(var c=0;c<n._src.length;c++){var d,h;if(n._format&&n._format[c])d=n._format[c];else{if(h=n._src[c],typeof h!="string"){n._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}d=/^data:audio\/([^;,]+);/i.exec(h),d||(d=/\.([^.]+)$/.exec(h.split("?",1)[0])),d&&(d=d[1].toLowerCase())}if(d||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),d&&g.codecs(d)){l=n._src[c];break}}if(!l){n._emit("loaderror",null,"No codec support for selected audio sources.");return}return n._src=l,n._state="loading",window.location.protocol==="https:"&&l.slice(0,5)==="http:"&&(n._html5=!0,n._webAudio=!1),new e(n),n._webAudio&&C(n),n},play:function(n,l){var c=this,d=null;if(typeof n=="number")d=n,n=null;else{if(typeof n=="string"&&c._state==="loaded"&&!c._sprite[n])return null;if(typeof n=="undefined"&&(n="__default",!c._playLock)){for(var h=0,m=0;m<c._sounds.length;m++)c._sounds[m]._paused&&!c._sounds[m]._ended&&(h++,d=c._sounds[m]._id);h===1?n=null:d=null}}var r=d?c._soundById(d):c._inactiveSound();if(!r)return null;if(d&&!n&&(n=r._sprite||"__default"),c._state!=="loaded"){r._sprite=n,r._ended=!1;var u=r._id;return c._queue.push({event:"play",action:function(){c.play(u)}}),u}if(d&&!r._paused)return l||c._loadQueue("play"),r._id;c._webAudio&&g._autoResume();var b=Math.max(0,r._seek>0?r._seek:c._sprite[n][0]/1e3),Z=Math.max(0,(c._sprite[n][0]+c._sprite[n][1])/1e3-b),p=Z*1e3/Math.abs(r._rate),G=c._sprite[n][0]/1e3,X=(c._sprite[n][0]+c._sprite[n][1])/1e3;r._sprite=n,r._ended=!1;var W=function(){r._paused=!1,r._seek=b,r._start=G,r._stop=X,r._loop=!!(r._loop||c._sprite[n][2])};if(b>=X){c._ended(r);return}var y=r._node;if(c._webAudio){var Y=function(){c._playLock=!1,W(),c._refreshBuffer(r);var J=r._muted||c._muted?0:r._volume;y.gain.setValueAtTime(J,g.ctx.currentTime),r._playStart=g.ctx.currentTime,typeof y.bufferSource.start=="undefined"?r._loop?y.bufferSource.noteGrainOn(0,b,86400):y.bufferSource.noteGrainOn(0,b,Z):r._loop?y.bufferSource.start(0,b,86400):y.bufferSource.start(0,b,Z),p!==1/0&&(c._endTimers[r._id]=setTimeout(c._ended.bind(c,r),p)),l||setTimeout(function(){c._emit("play",r._id),c._loadQueue()},0)};g.state==="running"&&g.ctx.state!=="interrupted"?Y():(c._playLock=!0,c.once("resume",Y),c._clearTimer(r._id))}else{var f=function(){y.currentTime=b,y.muted=r._muted||c._muted||g._muted||y.muted,y.volume=r._volume*g.volume(),y.playbackRate=r._rate;try{var J=y.play();if(J&&typeof Promise!="undefined"&&(J instanceof Promise||typeof J.then=="function")?(c._playLock=!0,W(),J.then(function(){c._playLock=!1,y._unlocked=!0,l?c._loadQueue():c._emit("play",r._id)}).catch(function(){c._playLock=!1,c._emit("playerror",r._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),r._ended=!0,r._paused=!0})):l||(c._playLock=!1,W(),c._emit("play",r._id)),y.playbackRate=r._rate,y.paused){c._emit("playerror",r._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}n!=="__default"||r._loop?c._endTimers[r._id]=setTimeout(c._ended.bind(c,r),p):(c._endTimers[r._id]=function(){c._ended(r),y.removeEventListener("ended",c._endTimers[r._id],!1)},y.addEventListener("ended",c._endTimers[r._id],!1))}catch(H){c._emit("playerror",r._id,H)}};y.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(y.src=c._src,y.load());var L=window&&window.ejecta||!y.readyState&&g._navigator.isCocoonJS;if(y.readyState>=3||L)f();else{c._playLock=!0,c._state="loading";var R=function(){c._state="loaded",f(),y.removeEventListener(g._canPlayEvent,R,!1)};y.addEventListener(g._canPlayEvent,R,!1),c._clearTimer(r._id)}}return r._id},pause:function(n){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"pause",action:function(){l.pause(n)}}),l;for(var c=l._getSoundIds(n),d=0;d<c.length;d++){l._clearTimer(c[d]);var h=l._soundById(c[d]);if(h&&!h._paused&&(h._seek=l.seek(c[d]),h._rateSeek=0,h._paused=!0,l._stopFade(c[d]),h._node))if(l._webAudio){if(!h._node.bufferSource)continue;typeof h._node.bufferSource.stop=="undefined"?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),l._cleanBuffer(h._node)}else(!isNaN(h._node.duration)||h._node.duration===1/0)&&h._node.pause();arguments[1]||l._emit("pause",h?h._id:null)}return l},stop:function(n,l){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"stop",action:function(){c.stop(n)}}),c;for(var d=c._getSoundIds(n),h=0;h<d.length;h++){c._clearTimer(d[h]);var m=c._soundById(d[h]);m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,c._stopFade(d[h]),m._node&&(c._webAudio?m._node.bufferSource&&(typeof m._node.bufferSource.stop=="undefined"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),c._cleanBuffer(m._node)):(!isNaN(m._node.duration)||m._node.duration===1/0)&&(m._node.currentTime=m._start||0,m._node.pause(),m._node.duration===1/0&&c._clearSound(m._node))),l||c._emit("stop",m._id))}return c},mute:function(n,l){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"mute",action:function(){c.mute(n,l)}}),c;if(typeof l=="undefined")if(typeof n=="boolean")c._muted=n;else return c._muted;for(var d=c._getSoundIds(l),h=0;h<d.length;h++){var m=c._soundById(d[h]);m&&(m._muted=n,m._interval&&c._stopFade(m._id),c._webAudio&&m._node?m._node.gain.setValueAtTime(n?0:m._volume,g.ctx.currentTime):m._node&&(m._node.muted=g._muted?!0:n),c._emit("mute",m._id))}return c},volume:function(){var n=this,l=arguments,c,d;if(l.length===0)return n._volume;if(l.length===1||l.length===2&&typeof l[1]=="undefined"){var h=n._getSoundIds(),m=h.indexOf(l[0]);m>=0?d=parseInt(l[0],10):c=parseFloat(l[0])}else l.length>=2&&(c=parseFloat(l[0]),d=parseInt(l[1],10));var r;if(typeof c!="undefined"&&c>=0&&c<=1){if(n._state!=="loaded"||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,l)}}),n;typeof d=="undefined"&&(n._volume=c),d=n._getSoundIds(d);for(var u=0;u<d.length;u++)r=n._soundById(d[u]),r&&(r._volume=c,l[2]||n._stopFade(d[u]),n._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(c,g.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=c*g.volume()),n._emit("volume",r._id))}else return r=d?n._soundById(d):n._sounds[0],r?r._volume:0;return n},fade:function(n,l,c,d){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"fade",action:function(){h.fade(n,l,c,d)}}),h;n=Math.min(Math.max(0,parseFloat(n)),1),l=Math.min(Math.max(0,parseFloat(l)),1),c=parseFloat(c),h.volume(n,d);for(var m=h._getSoundIds(d),r=0;r<m.length;r++){var u=h._soundById(m[r]);if(u){if(d||h._stopFade(m[r]),h._webAudio&&!u._muted){var b=g.ctx.currentTime,Z=b+c/1e3;u._volume=n,u._node.gain.setValueAtTime(n,b),u._node.gain.linearRampToValueAtTime(l,Z)}h._startFadeInterval(u,n,l,c,m[r],typeof d=="undefined")}}return h},_startFadeInterval:function(n,l,c,d,h,m){var r=this,u=l,b=c-l,Z=Math.abs(b/.01),p=Math.max(4,Z>0?d/Z:d),G=Date.now();n._fadeTo=c,n._interval=setInterval(function(){var X=(Date.now()-G)/d;G=Date.now(),u+=b*X,u=Math.round(u*100)/100,b<0?u=Math.max(c,u):u=Math.min(c,u),r._webAudio?n._volume=u:r.volume(u,n._id,!0),m&&(r._volume=u),(c<l&&u<=c||c>l&&u>=c)&&(clearInterval(n._interval),n._interval=null,n._fadeTo=null,r.volume(c,n._id),r._emit("fade",n._id))},p)},_stopFade:function(n){var l=this,c=l._soundById(n);return c&&c._interval&&(l._webAudio&&c._node.gain.cancelScheduledValues(g.ctx.currentTime),clearInterval(c._interval),c._interval=null,l.volume(c._fadeTo,n),c._fadeTo=null,l._emit("fade",n)),l},loop:function(){var n=this,l=arguments,c,d,h;if(l.length===0)return n._loop;if(l.length===1)if(typeof l[0]=="boolean")c=l[0],n._loop=c;else return h=n._soundById(parseInt(l[0],10)),h?h._loop:!1;else l.length===2&&(c=l[0],d=parseInt(l[1],10));for(var m=n._getSoundIds(d),r=0;r<m.length;r++)h=n._soundById(m[r]),h&&(h._loop=c,n._webAudio&&h._node&&h._node.bufferSource&&(h._node.bufferSource.loop=c,c&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop,n.playing(m[r])&&(n.pause(m[r],!0),n.play(m[r],!0)))));return n},rate:function(){var n=this,l=arguments,c,d;if(l.length===0)d=n._sounds[0]._id;else if(l.length===1){var h=n._getSoundIds(),m=h.indexOf(l[0]);m>=0?d=parseInt(l[0],10):c=parseFloat(l[0])}else l.length===2&&(c=parseFloat(l[0]),d=parseInt(l[1],10));var r;if(typeof c=="number"){if(n._state!=="loaded"||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,l)}}),n;typeof d=="undefined"&&(n._rate=c),d=n._getSoundIds(d);for(var u=0;u<d.length;u++)if(r=n._soundById(d[u]),r){n.playing(d[u])&&(r._rateSeek=n.seek(d[u]),r._playStart=n._webAudio?g.ctx.currentTime:r._playStart),r._rate=c,n._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(c,g.ctx.currentTime):r._node&&(r._node.playbackRate=c);var b=n.seek(d[u]),Z=(n._sprite[r._sprite][0]+n._sprite[r._sprite][1])/1e3-b,p=Z*1e3/Math.abs(r._rate);(n._endTimers[d[u]]||!r._paused)&&(n._clearTimer(d[u]),n._endTimers[d[u]]=setTimeout(n._ended.bind(n,r),p)),n._emit("rate",r._id)}}else return r=n._soundById(d),r?r._rate:n._rate;return n},seek:function(){var n=this,l=arguments,c,d;if(l.length===0)n._sounds.length&&(d=n._sounds[0]._id);else if(l.length===1){var h=n._getSoundIds(),m=h.indexOf(l[0]);m>=0?d=parseInt(l[0],10):n._sounds.length&&(d=n._sounds[0]._id,c=parseFloat(l[0]))}else l.length===2&&(c=parseFloat(l[0]),d=parseInt(l[1],10));if(typeof d=="undefined")return 0;if(typeof c=="number"&&(n._state!=="loaded"||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,l)}}),n;var r=n._soundById(d);if(r)if(typeof c=="number"&&c>=0){var u=n.playing(d);u&&n.pause(d,!0),r._seek=c,r._ended=!1,n._clearTimer(d),!n._webAudio&&r._node&&!isNaN(r._node.duration)&&(r._node.currentTime=c);var b=function(){u&&n.play(d,!0),n._emit("seek",d)};if(u&&!n._webAudio){var Z=function(){n._playLock?setTimeout(Z,0):b()};setTimeout(Z,0)}else b()}else if(n._webAudio){var p=n.playing(d)?g.ctx.currentTime-r._playStart:0,G=r._rateSeek?r._rateSeek-r._seek:0;return r._seek+(G+p*Math.abs(r._rate))}else return r._node.currentTime;return n},playing:function(n){var l=this;if(typeof n=="number"){var c=l._soundById(n);return c?!c._paused:!1}for(var d=0;d<l._sounds.length;d++)if(!l._sounds[d]._paused)return!0;return!1},duration:function(n){var l=this,c=l._duration,d=l._soundById(n);return d&&(c=l._sprite[d._sprite][1]/1e3),c},state:function(){return this._state},unload:function(){for(var n=this,l=n._sounds,c=0;c<l.length;c++)l[c]._paused||n.stop(l[c]._id),n._webAudio||(n._clearSound(l[c]._node),l[c]._node.removeEventListener("error",l[c]._errorFn,!1),l[c]._node.removeEventListener(g._canPlayEvent,l[c]._loadFn,!1),l[c]._node.removeEventListener("ended",l[c]._endFn,!1),g._releaseHtml5Audio(l[c]._node)),delete l[c]._node,n._clearTimer(l[c]._id);var d=g._howls.indexOf(n);d>=0&&g._howls.splice(d,1);var h=!0;for(c=0;c<g._howls.length;c++)if(g._howls[c]._src===n._src||n._src.indexOf(g._howls[c]._src)>=0){h=!1;break}return t&&h&&delete t[n._src],g.noAudio=!1,n._state="unloaded",n._sounds=[],n=null,null},on:function(n,l,c,d){var h=this,m=h["_on"+n];return typeof l=="function"&&m.push(d?{id:c,fn:l,once:d}:{id:c,fn:l}),h},off:function(n,l,c){var d=this,h=d["_on"+n],m=0;if(typeof l=="number"&&(c=l,l=null),l||c)for(m=0;m<h.length;m++){var r=c===h[m].id;if(l===h[m].fn&&r||!l&&r){h.splice(m,1);break}}else if(n)d["_on"+n]=[];else{var u=Object.keys(d);for(m=0;m<u.length;m++)u[m].indexOf("_on")===0&&Array.isArray(d[u[m]])&&(d[u[m]]=[])}return d},once:function(n,l,c){var d=this;return d.on(n,l,c,1),d},_emit:function(n,l,c){for(var d=this,h=d["_on"+n],m=h.length-1;m>=0;m--)(!h[m].id||h[m].id===l||n==="load")&&(setTimeout(function(r){r.call(this,l,c)}.bind(d,h[m].fn),0),h[m].once&&d.off(n,h[m].fn,h[m].id));return d._loadQueue(n),d},_loadQueue:function(n){var l=this;if(l._queue.length>0){var c=l._queue[0];c.event===n&&(l._queue.shift(),l._loadQueue()),n||c.action()}return l},_ended:function(n){var l=this,c=n._sprite;if(!l._webAudio&&n._node&&!n._node.paused&&!n._node.ended&&n._node.currentTime<n._stop)return setTimeout(l._ended.bind(l,n),100),l;var d=!!(n._loop||l._sprite[c][2]);if(l._emit("end",n._id),!l._webAudio&&d&&l.stop(n._id,!0).play(n._id),l._webAudio&&d){l._emit("play",n._id),n._seek=n._start||0,n._rateSeek=0,n._playStart=g.ctx.currentTime;var h=(n._stop-n._start)*1e3/Math.abs(n._rate);l._endTimers[n._id]=setTimeout(l._ended.bind(l,n),h)}return l._webAudio&&!d&&(n._paused=!0,n._ended=!0,n._seek=n._start||0,n._rateSeek=0,l._clearTimer(n._id),l._cleanBuffer(n._node),g._autoSuspend()),!l._webAudio&&!d&&l.stop(n._id,!0),l},_clearTimer:function(n){var l=this;if(l._endTimers[n]){if(typeof l._endTimers[n]!="function")clearTimeout(l._endTimers[n]);else{var c=l._soundById(n);c&&c._node&&c._node.removeEventListener("ended",l._endTimers[n],!1)}delete l._endTimers[n]}return l},_soundById:function(n){for(var l=this,c=0;c<l._sounds.length;c++)if(n===l._sounds[c]._id)return l._sounds[c];return null},_inactiveSound:function(){var n=this;n._drain();for(var l=0;l<n._sounds.length;l++)if(n._sounds[l]._ended)return n._sounds[l].reset();return new e(n)},_drain:function(){var n=this,l=n._pool,c=0,d=0;if(!(n._sounds.length<l)){for(d=0;d<n._sounds.length;d++)n._sounds[d]._ended&&c++;for(d=n._sounds.length-1;d>=0;d--){if(c<=l)return;n._sounds[d]._ended&&(n._webAudio&&n._sounds[d]._node&&n._sounds[d]._node.disconnect(0),n._sounds.splice(d,1),c--)}}},_getSoundIds:function(n){var l=this;if(typeof n=="undefined"){for(var c=[],d=0;d<l._sounds.length;d++)c.push(l._sounds[d]._id);return c}else return[n]},_refreshBuffer:function(n){var l=this;return n._node.bufferSource=g.ctx.createBufferSource(),n._node.bufferSource.buffer=t[l._src],n._panner?n._node.bufferSource.connect(n._panner):n._node.bufferSource.connect(n._node),n._node.bufferSource.loop=n._loop,n._loop&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop||0),n._node.bufferSource.playbackRate.setValueAtTime(n._rate,g.ctx.currentTime),l},_cleanBuffer:function(n){var l=this,c=g._navigator&&g._navigator.vendor.indexOf("Apple")>=0;if(g._scratchBuffer&&n.bufferSource&&(n.bufferSource.onended=null,n.bufferSource.disconnect(0),c))try{n.bufferSource.buffer=g._scratchBuffer}catch(d){}return n.bufferSource=null,l},_clearSound:function(n){var l=/MSIE |Trident\//.test(g._navigator&&g._navigator.userAgent);l||(n.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var e=function(n){this._parent=n,this.init()};e.prototype={init:function(){var n=this,l=n._parent;return n._muted=l._muted,n._loop=l._loop,n._volume=l._volume,n._rate=l._rate,n._seek=0,n._paused=!0,n._ended=!0,n._sprite="__default",n._id=++g._counter,l._sounds.push(n),n.create(),n},create:function(){var n=this,l=n._parent,c=g._muted||n._muted||n._parent._muted?0:n._volume;return l._webAudio?(n._node=typeof g.ctx.createGain=="undefined"?g.ctx.createGainNode():g.ctx.createGain(),n._node.gain.setValueAtTime(c,g.ctx.currentTime),n._node.paused=!0,n._node.connect(g.masterGain)):g.noAudio||(n._node=g._obtainHtml5Audio(),n._errorFn=n._errorListener.bind(n),n._node.addEventListener("error",n._errorFn,!1),n._loadFn=n._loadListener.bind(n),n._node.addEventListener(g._canPlayEvent,n._loadFn,!1),n._endFn=n._endListener.bind(n),n._node.addEventListener("ended",n._endFn,!1),n._node.src=l._src,n._node.preload=l._preload===!0?"auto":l._preload,n._node.volume=c*g.volume(),n._node.load()),n},reset:function(){var n=this,l=n._parent;return n._muted=l._muted,n._loop=l._loop,n._volume=l._volume,n._rate=l._rate,n._seek=0,n._rateSeek=0,n._paused=!0,n._ended=!0,n._sprite="__default",n._id=++g._counter,n},_errorListener:function(){var n=this;n._parent._emit("loaderror",n._id,n._node.error?n._node.error.code:0),n._node.removeEventListener("error",n._errorFn,!1)},_loadListener:function(){var n=this,l=n._parent;l._duration=Math.ceil(n._node.duration*10)/10,Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue()),n._node.removeEventListener(g._canPlayEvent,n._loadFn,!1)},_endListener:function(){var n=this,l=n._parent;l._duration===1/0&&(l._duration=Math.ceil(n._node.duration*10)/10,l._sprite.__default[1]===1/0&&(l._sprite.__default[1]=l._duration*1e3),l._ended(n)),n._node.removeEventListener("ended",n._endFn,!1)}};var t={},C=function(n){var l=n._src;if(t[l]){n._duration=t[l].duration,a(n);return}if(/^data:[^;]+;base64,/.test(l)){for(var c=atob(l.split(",")[1]),d=new Uint8Array(c.length),h=0;h<c.length;++h)d[h]=c.charCodeAt(h);s(d.buffer,n)}else{var m=new XMLHttpRequest;m.open(n._xhr.method,l,!0),m.withCredentials=n._xhr.withCredentials,m.responseType="arraybuffer",n._xhr.headers&&Object.keys(n._xhr.headers).forEach(function(r){m.setRequestHeader(r,n._xhr.headers[r])}),m.onload=function(){var r=(m.status+"")[0];if(r!=="0"&&r!=="2"&&r!=="3"){n._emit("loaderror",null,"Failed loading audio file with status: "+m.status+".");return}s(m.response,n)},m.onerror=function(){n._webAudio&&(n._html5=!0,n._webAudio=!1,n._sounds=[],delete t[l],n.load())},A(m)}},A=function(n){try{n.send()}catch(l){n.onerror()}},s=function(n,l){var c=function(){l._emit("loaderror",null,"Decoding audio data failed.")},d=function(h){h&&l._sounds.length>0?(t[l._src]=h,a(l,h)):c()};typeof Promise!="undefined"&&g.ctx.decodeAudioData.length===1?g.ctx.decodeAudioData(n).then(d).catch(c):g.ctx.decodeAudioData(n,d,c)},a=function(n,l){l&&!n._duration&&(n._duration=l.duration),Object.keys(n._sprite).length===0&&(n._sprite={__default:[0,n._duration*1e3]}),n._state!=="loaded"&&(n._state="loaded",n._emit("load"),n._loadQueue())},o=function(){if(!!g.usingWebAudio){try{typeof AudioContext!="undefined"?g.ctx=new AudioContext:typeof webkitAudioContext!="undefined"?g.ctx=new webkitAudioContext:g.usingWebAudio=!1}catch(h){g.usingWebAudio=!1}g.ctx||(g.usingWebAudio=!1);var n=/iP(hone|od|ad)/.test(g._navigator&&g._navigator.platform),l=g._navigator&&g._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),c=l?parseInt(l[1],10):null;if(n&&c&&c<9){var d=/safari/.test(g._navigator&&g._navigator.userAgent.toLowerCase());g._navigator&&!d&&(g.usingWebAudio=!1)}g.usingWebAudio&&(g.masterGain=typeof g.ctx.createGain=="undefined"?g.ctx.createGainNode():g.ctx.createGain(),g.masterGain.gain.setValueAtTime(g._muted?0:g._volume,g.ctx.currentTime),g.masterGain.connect(g.ctx.destination)),g._setup()}};i.Howler=g,i.Howl=I,typeof OI!="undefined"?(OI.HowlerGlobal=V,OI.Howler=g,OI.Howl=I,OI.Sound=e):typeof window!="undefined"&&(window.HowlerGlobal=V,window.Howler=g,window.Howl=I,window.Sound=e)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(g){var I=this;if(!I.ctx||!I.ctx.listener)return I;for(var e=I._howls.length-1;e>=0;e--)I._howls[e].stereo(g);return I},HowlerGlobal.prototype.pos=function(g,I,e){var t=this;if(!t.ctx||!t.ctx.listener)return t;if(I=typeof I!="number"?t._pos[1]:I,e=typeof e!="number"?t._pos[2]:e,typeof g=="number")t._pos=[g,I,e],typeof t.ctx.listener.positionX!="undefined"?(t.ctx.listener.positionX.setTargetAtTime(t._pos[0],Howler.ctx.currentTime,.1),t.ctx.listener.positionY.setTargetAtTime(t._pos[1],Howler.ctx.currentTime,.1),t.ctx.listener.positionZ.setTargetAtTime(t._pos[2],Howler.ctx.currentTime,.1)):t.ctx.listener.setPosition(t._pos[0],t._pos[1],t._pos[2]);else return t._pos;return t},HowlerGlobal.prototype.orientation=function(g,I,e,t,C,A){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;if(I=typeof I!="number"?a[1]:I,e=typeof e!="number"?a[2]:e,t=typeof t!="number"?a[3]:t,C=typeof C!="number"?a[4]:C,A=typeof A!="number"?a[5]:A,typeof g=="number")s._orientation=[g,I,e,t,C,A],typeof s.ctx.listener.forwardX!="undefined"?(s.ctx.listener.forwardX.setTargetAtTime(g,Howler.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(I,Howler.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(e,Howler.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(t,Howler.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(C,Howler.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(A,Howler.ctx.currentTime,.1)):s.ctx.listener.setOrientation(g,I,e,t,C,A);else return a;return s},Howl.prototype.init=function(g){return function(I){var e=this;return e._orientation=I.orientation||[1,0,0],e._stereo=I.stereo||null,e._pos=I.pos||null,e._pannerAttr={coneInnerAngle:typeof I.coneInnerAngle!="undefined"?I.coneInnerAngle:360,coneOuterAngle:typeof I.coneOuterAngle!="undefined"?I.coneOuterAngle:360,coneOuterGain:typeof I.coneOuterGain!="undefined"?I.coneOuterGain:0,distanceModel:typeof I.distanceModel!="undefined"?I.distanceModel:"inverse",maxDistance:typeof I.maxDistance!="undefined"?I.maxDistance:1e4,panningModel:typeof I.panningModel!="undefined"?I.panningModel:"HRTF",refDistance:typeof I.refDistance!="undefined"?I.refDistance:1,rolloffFactor:typeof I.rolloffFactor!="undefined"?I.rolloffFactor:1},e._onstereo=I.onstereo?[{fn:I.onstereo}]:[],e._onpos=I.onpos?[{fn:I.onpos}]:[],e._onorientation=I.onorientation?[{fn:I.onorientation}]:[],g.call(this,I)}}(Howl.prototype.init),Howl.prototype.stereo=function(g,I){var e=this;if(!e._webAudio)return e;if(e._state!=="loaded")return e._queue.push({event:"stereo",action:function(){e.stereo(g,I)}}),e;var t=typeof Howler.ctx.createStereoPanner=="undefined"?"spatial":"stereo";if(typeof I=="undefined")if(typeof g=="number")e._stereo=g,e._pos=[g,0,0];else return e._stereo;for(var C=e._getSoundIds(I),A=0;A<C.length;A++){var s=e._soundById(C[A]);if(s)if(typeof g=="number")s._stereo=g,s._pos=[g,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",(!s._panner||!s._panner.pan)&&V(s,t),t==="spatial"?typeof s._panner.positionX!="undefined"?(s._panner.positionX.setValueAtTime(g,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(g,0,0):s._panner.pan.setValueAtTime(g,Howler.ctx.currentTime)),e._emit("stereo",s._id);else return s._stereo}return e},Howl.prototype.pos=function(g,I,e,t){var C=this;if(!C._webAudio)return C;if(C._state!=="loaded")return C._queue.push({event:"pos",action:function(){C.pos(g,I,e,t)}}),C;if(I=typeof I!="number"?0:I,e=typeof e!="number"?-.5:e,typeof t=="undefined")if(typeof g=="number")C._pos=[g,I,e];else return C._pos;for(var A=C._getSoundIds(t),s=0;s<A.length;s++){var a=C._soundById(A[s]);if(a)if(typeof g=="number")a._pos=[g,I,e],a._node&&((!a._panner||a._panner.pan)&&V(a,"spatial"),typeof a._panner.positionX!="undefined"?(a._panner.positionX.setValueAtTime(g,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(I,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(e,Howler.ctx.currentTime)):a._panner.setPosition(g,I,e)),C._emit("pos",a._id);else return a._pos}return C},Howl.prototype.orientation=function(g,I,e,t){var C=this;if(!C._webAudio)return C;if(C._state!=="loaded")return C._queue.push({event:"orientation",action:function(){C.orientation(g,I,e,t)}}),C;if(I=typeof I!="number"?C._orientation[1]:I,e=typeof e!="number"?C._orientation[2]:e,typeof t=="undefined")if(typeof g=="number")C._orientation=[g,I,e];else return C._orientation;for(var A=C._getSoundIds(t),s=0;s<A.length;s++){var a=C._soundById(A[s]);if(a)if(typeof g=="number")a._orientation=[g,I,e],a._node&&(a._panner||(a._pos||(a._pos=C._pos||[0,0,-.5]),V(a,"spatial")),typeof a._panner.orientationX!="undefined"?(a._panner.orientationX.setValueAtTime(g,Howler.ctx.currentTime),a._panner.orientationY.setValueAtTime(I,Howler.ctx.currentTime),a._panner.orientationZ.setValueAtTime(e,Howler.ctx.currentTime)):a._panner.setOrientation(g,I,e)),C._emit("orientation",a._id);else return a._orientation}return C},Howl.prototype.pannerAttr=function(){var g=this,I=arguments,e,t,C;if(!g._webAudio)return g;if(I.length===0)return g._pannerAttr;if(I.length===1)if(typeof I[0]=="object")e=I[0],typeof t=="undefined"&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),g._pannerAttr={coneInnerAngle:typeof e.pannerAttr.coneInnerAngle!="undefined"?e.pannerAttr.coneInnerAngle:g._coneInnerAngle,coneOuterAngle:typeof e.pannerAttr.coneOuterAngle!="undefined"?e.pannerAttr.coneOuterAngle:g._coneOuterAngle,coneOuterGain:typeof e.pannerAttr.coneOuterGain!="undefined"?e.pannerAttr.coneOuterGain:g._coneOuterGain,distanceModel:typeof e.pannerAttr.distanceModel!="undefined"?e.pannerAttr.distanceModel:g._distanceModel,maxDistance:typeof e.pannerAttr.maxDistance!="undefined"?e.pannerAttr.maxDistance:g._maxDistance,refDistance:typeof e.pannerAttr.refDistance!="undefined"?e.pannerAttr.refDistance:g._refDistance,rolloffFactor:typeof e.pannerAttr.rolloffFactor!="undefined"?e.pannerAttr.rolloffFactor:g._rolloffFactor,panningModel:typeof e.pannerAttr.panningModel!="undefined"?e.pannerAttr.panningModel:g._panningModel});else return C=g._soundById(parseInt(I[0],10)),C?C._pannerAttr:g._pannerAttr;else I.length===2&&(e=I[0],t=parseInt(I[1],10));for(var A=g._getSoundIds(t),s=0;s<A.length;s++)if(C=g._soundById(A[s]),C){var a=C._pannerAttr;a={coneInnerAngle:typeof e.coneInnerAngle!="undefined"?e.coneInnerAngle:a.coneInnerAngle,coneOuterAngle:typeof e.coneOuterAngle!="undefined"?e.coneOuterAngle:a.coneOuterAngle,coneOuterGain:typeof e.coneOuterGain!="undefined"?e.coneOuterGain:a.coneOuterGain,distanceModel:typeof e.distanceModel!="undefined"?e.distanceModel:a.distanceModel,maxDistance:typeof e.maxDistance!="undefined"?e.maxDistance:a.maxDistance,refDistance:typeof e.refDistance!="undefined"?e.refDistance:a.refDistance,rolloffFactor:typeof e.rolloffFactor!="undefined"?e.rolloffFactor:a.rolloffFactor,panningModel:typeof e.panningModel!="undefined"?e.panningModel:a.panningModel};var o=C._panner;o?(o.coneInnerAngle=a.coneInnerAngle,o.coneOuterAngle=a.coneOuterAngle,o.coneOuterGain=a.coneOuterGain,o.distanceModel=a.distanceModel,o.maxDistance=a.maxDistance,o.refDistance=a.refDistance,o.rolloffFactor=a.rolloffFactor,o.panningModel=a.panningModel):(C._pos||(C._pos=g._pos||[0,0,-.5]),V(C,"spatial"))}return g},Sound.prototype.init=function(g){return function(){var I=this,e=I._parent;I._orientation=e._orientation,I._stereo=e._stereo,I._pos=e._pos,I._pannerAttr=e._pannerAttr,g.call(this),I._stereo?e.stereo(I._stereo):I._pos&&e.pos(I._pos[0],I._pos[1],I._pos[2],I._id)}}(Sound.prototype.init),Sound.prototype.reset=function(g){return function(){var I=this,e=I._parent;return I._orientation=e._orientation,I._stereo=e._stereo,I._pos=e._pos,I._pannerAttr=e._pannerAttr,I._stereo?e.stereo(I._stereo):I._pos?e.pos(I._pos[0],I._pos[1],I._pos[2],I._id):I._panner&&(I._panner.disconnect(0),I._panner=void 0,e._refreshBuffer(I)),g.call(this)}}(Sound.prototype.reset);var V=function(g,I){I=I||"spatial",I==="spatial"?(g._panner=Howler.ctx.createPanner(),g._panner.coneInnerAngle=g._pannerAttr.coneInnerAngle,g._panner.coneOuterAngle=g._pannerAttr.coneOuterAngle,g._panner.coneOuterGain=g._pannerAttr.coneOuterGain,g._panner.distanceModel=g._pannerAttr.distanceModel,g._panner.maxDistance=g._pannerAttr.maxDistance,g._panner.refDistance=g._pannerAttr.refDistance,g._panner.rolloffFactor=g._pannerAttr.rolloffFactor,g._panner.panningModel=g._pannerAttr.panningModel,typeof g._panner.positionX!="undefined"?(g._panner.positionX.setValueAtTime(g._pos[0],Howler.ctx.currentTime),g._panner.positionY.setValueAtTime(g._pos[1],Howler.ctx.currentTime),g._panner.positionZ.setValueAtTime(g._pos[2],Howler.ctx.currentTime)):g._panner.setPosition(g._pos[0],g._pos[1],g._pos[2]),typeof g._panner.orientationX!="undefined"?(g._panner.orientationX.setValueAtTime(g._orientation[0],Howler.ctx.currentTime),g._panner.orientationY.setValueAtTime(g._orientation[1],Howler.ctx.currentTime),g._panner.orientationZ.setValueAtTime(g._orientation[2],Howler.ctx.currentTime)):g._panner.setOrientation(g._orientation[0],g._orientation[1],g._orientation[2])):(g._panner=Howler.ctx.createStereoPanner(),g._panner.pan.setValueAtTime(g._stereo,Howler.ctx.currentTime)),g._panner.connect(g._node),g._paused||g._parent.pause(g._id,!0).play(g._id,!0)}})()})(ch);class PR{constructor(){autobind(this),this.sound="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQyLjEwMAAAAAAAAAAAAAAA//uQwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAENAAG40AADBgkLDhESFRgaHSAiJCcqLC8yNDY5Oz5BQ0ZJS01QU1VYW1xfYmRnamxucXR2eXx+gIOFiIuNkJKVl5qdn6KkpqmsrrG0tri7vsDDxsjKzc/S1dfa3N/h5Ofp7O7w8/b4+/4AAAAATGF2YzU4Ljc3AAAAAAAAAAAAAAAAJAJkAAAAAAABuNC0OGsrAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQxAAAE+CE9BWNgANJMmf3NZADfx/H8fx/HIchyHcctnaw6gaQ6EsChMpS34ECDIDY0hQNIMDABs1F9OZoTk20DKxqbabixmooJmpaZKQmOjJi4mYeFgYLLsIqIqJEKCLEYg1x3H/f9/4fjcbp6enpKSkpKSkpLGFvOnB8Hw+CAY8Tg+oH/8EAQBDKAgCDigIO+UB8HwfE4OAgCGCDsoGP//KBj8uDgIAgCHrBwEAQdygYt112dSIFk2VxlUqkQaXQ/AOGA0OZxOeB7S1h5GAgRrIyHzkQEi8NDEUFYXJLhVUtGbp/mUIGDy4KlDR3QLSGETkYu1arTHcqWFbC97C1lW5PWlfloAYAjgXQjDWIcvTUp/8+7zqKsa3cL4NAi85SU9FL/7hhrDlitM33WkMP5yCH561E5/WH6w//9kEIh9sEIduOR1r8N6zl89Sc7/P5/////0m886/X/jd+3u/hX/Kkxl+U/Kf/////////88KljDD6fXP73/+N0FLbwpLmXO2F1YZUeGYwGz3a2ZIKGOnTvJezwzJFlBBAAwWB//uSxA0AGXmjXfz2ACLoPOothJqJZjQG9ji6fmaiem6K9DkttCATBLM8MJjcq8SjmwliYTR/MDsEFh+SzMnn52+iP9aQDc9EMcEEdLoISAMiJ5XIgcOiQpJA4EwO1qs0XwcyrjAHOy0TEyBXkJGnHegdhGSB8Xrojh2oE0Gh4fq0kmCAfqPESSQYDyI9hAQDgSD32zO11i+Suj7Y1lPlXzDkwQomKJ0bpLJ/nBMWXMOhJZbXj2B9cIB4sbP9SEzzgQESQwMx3KdbkQCAXElVdwprMCFqS9TJJVDLgrJARQKIIhLHSZ32ll/KHbRRoFTVi/Jhly7w8TCshEQjLDaIWmUYY5NJzn77MnSRpZZiaK1qJspMOUgmsOmnTEZctBIuTgVqLMNqEyRkkES3TW5pSlHHvUoIHocafhHVlcs+GXZndK0dPUelZJ0rpiFknLUQ0f1ycUpryYRQLVfuW64Nwrwe5ml/VXWwkpkcuXa2nezGsU71j58Sei5KzBIY85EhkRBBOGAQAAAArN0YNGH6bk+zto2qXlsGl4Oi2kSZ03ycy//7ksQQgNdWC1HMJNTLVUFp+PwmCQKEtddHY06BGiaxwzu8TiqtewcSsNQPmUJ4lFLIqQC5k2KExW3tKIO/ppaOqqsjL5uEjlooImHoBZR9DGIe0z03t1nM5ZrnnVhZGKsj8SljWZa/AeTOdqqM6R22udqzzXX3N/a87VrofadcTfvEEEE72tZotrTna9oZmFlZdOhadRaZ/PtO/mW+IGbKc0i0HnIp5yqQuvazFSIAmIQYACcI0AH35XuBfW0hJ+k9LgBzNyM3m+qqRlK8TmWSv8gQJlhqJum64wSbaRAAQSRXRtpoWUBd+v1OSuJFylhcuISITCsFTh8GCdLwQMpweRpQX1MVitHPYKcnko+pfak3Ca1M4tiknbCk5oEEy826zYt1Fe72e39fLwggYPQpqBxtM5qomcKWmDajJuQomkSEGSx9b01VclNXXHEUkR1lkqoto4i4Um9gV2Rlj0yBopEjNrIEBiacYrrsoU1JJoVbRNqyVQSi4+hRFF0lSidGGyynaptgEBg4bTVQolrFiLW2cxBwo40pW9oDivE5FPL/+5LEDwBWzf1XbCTWy2dBqhGHpojanNWqWVX7j1EZIKgZ+WX0kViCqEQihmFTp5U4XaJCBjMy4wtyjMYHYILISQESQuUZXXx7TbFMzfXIoAIDIBYIBKAZPY56b1TteOz933Xmar/t/jf///Wc7fJeZ2xErVUCySlMhIPwQW9fU7Sh6i9jLuP/8ZtZq+Ns5NOyTPiPevlmnaeq0DzHWZSDk9MIIQndnn2xnVIYqvQIAAALTusKLfIswqR1Y0yS5AT90MAuq/9O1pdEU3rdq1hSrBH+MPTLR2jdBSj1gqBPww1tOP07IlURQQIWUxlEKSISJo0nf1G8lLVUScFTVEpKhxCkRkjZMljS7the+ui1CFQqCIZGAMg8FwQAODgkAcDYYFAoJFZ5GmYNIWmWkEUDGeUIR9/+v8qP2W74xtlZdg1E66ZKKRCISGBEJhEfBERDYoIxghJBWaKECXuNxW6rWSv7W1C5zhWKKQu5zq/831iz4xQsPOGSrkLQ0iRjKMQrCdCKi8l51ZAFISITAAAAd1l/ryaWqNnj8vsypid+VyaI//uSxA0A13oJWcwk2UsIOKqRl6aYS2XQNG5U2FwHEiNuE5dTLATobv15R+NLTS59mBNzlUgzUZeTkDnGyQo4Bw2BYnHlSBLLk7rvgjUYjrvPNd9nUGIV6T/hd3tUnLMnCM7plZsoGihRCMnydhHaN7H2snmyWls4pcm5PX3P/sPbR72Iu2j4eFgMBg6cKZ/9/9Ns56ptmmyTrlaSK0D9h39VXmWptyp3LbcfYfWz/s+s2N+7oK4ygAEAENaTUqsbZBK2+S2WpMOyvTTxpVlrHEs/GrNLAMGSmh+1BxT4yBYgY3fGNatGVsXcWFutYTlGu+aoy5LahgN4MEG+XhDFA9ksiUIjAhPNcu2vcrheMxiQpntUtdG39271WH3Pn3+3K4s0kaSem1S/YYjsvvnX957jGBE2StIkOkHIyMnmuvDNjHNqWxikFgSGw0AUHgfB4MgWCgYaFAoQYvOs2P8t1aUa37Go309QMTRo0bi/QeQwwgcTCFgwOj3wAQAAGh5h0wM/44ArCIxjwHLk6bDJ09nvhkwQkX0WvikYpX1tbxj8av/7ksQUgVjF31SNvTULIUErOZeuoMykhADExmNMSig4rab4vr48S+Xs2b/OMWzNeAnlOSoQ4t4lAVaqdK93fcDvt2XOF7+Pr+/51/giHw0Ogm3Oc9+745Xns7+ZlbeyWl47Wstqw33Odf///P7hJFJEFhScHiUmZR/ro278P//V+SbJYhFJCKQqSljTMWkBdECDhWGwQFCBNHWb4eOLImkSyFDlf2kmq0KEydIQ68y9PP2TCQ2SAwCTgsFR0WBbhBy1y/zTFZFbqs6HBtWWWgylxLeymQX+RGZjDCzbIn4mvWyXVcN7HTelQmT9OuPJmE8zBeZxT/z7+62byUi2n0YxY4Gb4pT6v4D4CZzDN/DKvqJNS07DoOPeSye//cPYE5fdU6otO5YeNTUvNDQ0NKmdQkFkb38Ghyv/6/jlsOc53NWb3L3296Y7K/7+K5bBsec1Edo6TAhh2kokk0daA6DRo8AcGhazkn7/uodLTp2p4v1V5auclMbx12oAEQAAARKDCUDjXuyppSqqB6ti1R5c3heL+7elCh2lLIZn9S6lmZ7/+5LEE4EYmgdbbDV/GzLBKsWGPhiVMxJwzty38O36WMw9LL1rkP4arPtFY3fVus91lW+vL5drePP5jha+rdjMtuXnTjd/DeTgy33umtqa1MkX7rqTRElOGRJkxEwNDEGw639EkzdD1mqkkjE8bFpIF49ZlLQCCXU3k8pfqfqQQYxNFVotPhKuyaDLy8Wfq//lFeTsGxsSgGxAua6E2HTEdaBw0pp9SbTuGV6XzF2BUdgKNECVAiodA5TFeHAD1qZLGWkwe/g+zKpO0gTDVtJmVOoVhLRwat1z5F3/56SRaJbQ/R7+mKNcGTFg2tPKfqUCfDUHBAz/4Xk3amsYmjEqKNOmnH05kT/XfprKb3vOPvz4/19YhpXV/ubKcP3Nq78P4LA+x/9+e//t86eOGLajbgS61Wut/nysY+/jcKSFZ8+fSqlOrpYvf4qbjTv/WLYsfsX/21Dj4pT//ryq///Fze519/UJukjPtsLK3R2RXqfbIyRKQ1F94+W4O4pZopWAALkRvExMzbRTh0qBNym4IUxhaVIvhVFqLpJbKb3Y00SH//uSxBEA1k4NWow9s4qoQew49KKYW2ct22Npt4yv5YL+6y//z2I0iD2xH8Sn5AJ76zm3sjYpuucSel6a3vOL70xUzh8zG8b6TVjJ97/33ecMp6m1sqy/qj8PE2ukkgmYDzr30H/YYxR66QRCDe8xKLfWp+pdMeLOp0jo0B4LiavRHe/7XoqXpv3rCqlNH3QKlvZamdBdFFTyaPepazh4KuFXNjRWZgQAUAAmfowwgoHpRm4O4BuElCUEsVIMAeBMsJ4hWzMLgxRmNSHqU06y7Q+cJXKqU1hG5DBIFBZuB8rSsnoNZa0gZ8P4+np4kdP8zVjsQTHpqyrincUGAsq/42JUz/ygFj6/5Sej6uhg2IJFhM6UpsTF6C09N/sLLFOjvUstso/ciWNaQmE1rE2n//V18cw9Wz1uRjYAIKVfxdNHMft8p9WuoyYGCChIci1qICAwAEdRUR3B2o8G8c80pEtI0bEAS5kjBBCJVSAXM3IQE3eU0pgrjFlCtkxabUiOrwtdeT7qeyyT5UR4PQysLfzBvWoOX5ntjcXv8udvrOL4+f/7ksQpAFZyB1aMvbHC0sDqlZZCIN5i41vxufxQo9jj0wjSJIBFq1K3cQ5BdbaS6k33pVGImJm6zVkFokwC0ZuvRnFm5JNZVPZ6nrRSxGTbWt0ScHKBwvXX4+jY1T9K3+seJvVZJNAvgFezrVvJw5P9BH+8azVhAQxLCDDwaIfJIsGslnj5OwmEYZg+Wahw8A7dBuRzRnBQ6wMxQvjTKdCwMmeYjtjukIou258OzC3YQ8juzoGJdTAUj6zR3QNTpqQYT+m2co2S1LnHpClxAUPdEbB8hED50wI0MgJt6a4zpUZqW04qtmWyqjEl+iyUjAX0kl9Gw+RNEaqtRxBuqrFzPfW6ZkApJ6j6alMRo56V/nWfoooOgMebP9E4HJJ+pTThimpf3R/XlAgjVQCDAoAAAAssnBS1YGOO8w191K25olRdn6pTEZMXI5hEhZQ6Bijz/0Mhi9iYu1lGgcL5wUxyHTOuXD6nU4OezsOsnnWgpSIBFTapb6zEWxHNEPnHvoV1jIWomjhCejiHOfcFdR+2YEjspVdaLII26QdlUO6xJB//+5LEOwBUkgdXTLG0gqrAq22GNjgOrRX3lY8d/oL+vUJgb/rFQS1rdsij0++7ftlEpv1KYIETX/nCCbet1pX/rL5GYAQBAAQwIAoS4mXOLhqOpLu65bgNLdOAHZR5BBTQJnkMoCJhtMgCCW150oQRYveUVhP7USI605Y7Gwyf/FesZwYLOKQ/lK8G/2/JXR1qsi29N7cnund3P3MppImRJHwvCH9Q0EdSGgtdJSFCtNSDDTdSakMkgd5oqnupAfxu/ziTq+tx5KstNaaYuBrd9k9RiT3/o/3qJNJ21uoOolX9mSdNSFO61ofQaskFqswUWAAKENBgQYJhVRDxh8HulStdXihEqg1jc68S5UrXOWph+aRiYky5y6cYen3TaYUeX7ctNe/cw6HkSG21hG1dd3vWRTC9Noe6C6gB5V/rtULVjByx89Gf/wxzTXq0qH6Sy9FTVCxwhtfOxVc00x1//8/MXVyi/E0WZfUB0PNapGigdtGzf+0jFvv//+65hig5HNzHvKql6kPuDQvJnYsfTAiiGACAAqmSOTpYiyBN571X//uSxFmAFDXvY2wxEYKkweuxhjaYPu8T9vCDGgJ9p5Z2WWp9spf0MSHHgOH7o8Wp3K7xwui0+VcKxdaa/BSZszurHlprtZa+8romHGm111d0AYyj9VV6loqXz0dp91rVrV69SI9loM/orSRB2lP7UqFICnKKRkkpG+t5s2t/pF8fRPzM7WcZbIJGIPIEwRqbr50lhGjBjbb/9b/WTzykevSZMSUU3/1qQMx7l96ABMEAMpYGUcDBUDbCim2Uthxi8qUdNmHchMXoMKWcnIsghMjTIQ27XouiV8JyEgHF02Oo2xK4RRs+pt3gieVZudmfcqosCFFKU9lJNRWECSF6GplmrGRHjbWi1VBEgJMNKrrMzSzpWRUL8Z9d7psqp1g28XvOLdWofx8leq2rtdv9Tl0pkGPrQZmVbGuDbUr7f0R+FAFVX9tFvt6h9DRLul6mWTYcIPWR/3QIcOlFRsyIpoIrqqESyhMWS6GXM0VulTkZ4hVhtmEboIvlNROl5VuQ1fAJBRowozACsUt3WNn6BkKC0q0X1MsrKzxfNzB77rRUDf/7ksR6gJYeEVaMJhTCfUIrIYe2gLUkvZ7VnAwi8iy2V31DGFt6nd6J82SU7HmfZVjUwKV2+midDhT+/dzonhMnGb/NfbvoBbSafvW1eskQpBfv/yTJUoUv31N/8vF4W3/WajCAGCU/9kSIO4ehcPNVCBAgAKhKAiuDn4Lb5bxMilO6De4V9hQMjffd5p+5UpcfpZRIwdqyFyR0AcdAyiCdwnMjEpnvoFCdbwYUekuLJDgdAmqUKXicDwOPqbh4+w7cV0PXQOzzMtOusNTEy+fVrLqZPp1dak0lxyAUKiirUlc2OAlQq0V63+OsXYeFkjLpdnRe/fsRxmIKH66OkqiR4AXDaW57/E8CyCHrf/nU+tb+iP47Bc5LN/UoR0AMBPL/0UBRiBF0xjAARVxL8HCQcYbBxKloLSPe7DCGn1AGVbmCRfPGxqzR5TZQujq5ZzE9d1hPcqyNqHM80FN/vZJ46bFtN2w/rMRJczW+biqovgL5vTqrXas0LzPuvrWgaPutabKNFuS44fXqSSognxanqZXx9JMZLKQb9aF9X3WZiXH/+5LEmIBW+g9TDKJYgq7B6yGFtxCbGjdVBBzUBKFB/60zMjj4OrU06kGVout1IMh6h2j6PyKv1oIAngwRZ1J1ppzg7x9KRuoMEDKMACoSFVRQ50y6SBrbvdfgbDTMIan0qWA00/DN3kxXpogoBZtYWLPICz7RZXYyyTtnU9OSTFIt86PCrl2Eo610K0PFNnqm8NOloaQuTJjFF/pLrMSVJ6KOi10ulSSSTsikoRDoDWU2RNaCnpoqCYimqlW1kWnRNRO5OOlm+3XpPutnmol7LZSR9kj5QISAXMWj1aktFmHeXtFHWi1SSKi8mSRGQVoqSMyo2a2k9SQcoBnvZSSSzE85oJ2psMAACIlRdw0QCrl7wyjQTbRNnXlq2Sz8OVIfKF6YC7NkGLHZkPAIVDakz6qNi3QUbKmDJboUKFFx/kGXP2pZfqxriQHkaJSBfJjxL33fH97UWQkgsGpeF6JMtjTRrGsHneySK06amWbrshQesahMHjYL1G9bstTpnS8TQbID5kmdaNk9ItCpOkHtDAXvUpRs6traScjxzEXZKqyI//uSxK0AV9IJVywtuIsqwanlh8H4ug2AgILwtqk61L+4s01o/vqXWRgYhIRL6imLlNGT633BvIFrxJofzAWUOQxASeRVDBAQCAAoAasaCJtHs1T0FOErh0SJNdik8BAVruaQhsolUtbjDtXlJLGYiR3Ks3LKWYnv3haoaBm96zWwuZZZ3AsK1hF2rTU9c1ypVt8jlJ1W2f/P/y+tdwmqQhWRVllxrEPY/rLe94RxQrPLDPcv5zPeHIpnhdpMsec5Ek257iZNXWtX971jcxzCtmhfha3btmK2SdQpwzSJTDkxAtbLTTmR420LKPIqpoCtB4S2TnVhwhHY5AB/TFS1WW9bUBuCSIMr6nsivBMJLrfscUHSFWrm59FZQBAoBS5srVdpmGQw0FhPQ7VAhAgAIAQBEVVxoAPc9y3AqxEhKuaT6wmhx1NLpSRQTzxHy3lb2NkC7i6eQpcO4HjerWY2/+3VzvQpcXaZL4cRzxXJuOuFHip3ShDJVp63sbqCaj+goQIPHU1kjIOJNJTMbmq11HNNaNajREngGpnC9jfQWjTdjP/7ksSugBzODUss4nXC8kGp6Ye18OcAtFx16OvXE+ClY6FwF59d5z9lsvkwYprfepw6BygkwBKFx0er8vkG//Ml1D+J0HGm3zjJepnx2AOoEsmr+oKwOeolDBIINORMADawg2smY6C9RGdULkVU6rVExZT1WIKUrUi7K4vSRmIT7YF4TdjNZaKpGMA0WGs38febFL4bJtoinWuEQfjJu+caY9f//G/4exkFf8sZkx/ev1D22RN6gPJZd41rHjaxXPtr3XZNXCGTzd7/Wd5vA1QOaL4bPtgVkffz8qd1ir88bav/87xf53T6vjN8Nj7EPDxWQNX2bCtJARub5395/+P05BzumbQNYeb+Y+8q9gS0eJn+/6Ez/7/3T5fifhu0p8ap/TR1Iq6eZVgABgQhMF9mng57dIbHLw+319CRAkpHDv/ZrsupnCGg35bVsu5TlGf5zFBZyFdkEoMH8DHvk08WsWQUpRkXgF9F1a2e7+uZnwFYIeiipKi7vYXC6iapEkJcC0Gi0FbKUklRXZFFRkIO1JJ02zrOAWJip0VCfAnd68n/+5LEo4BZ2g1TLCH0SvVBqhGENpAS6ylKSQem+nbRRUtGiiYi2LpecyHUpGtaB0D8EmZX+1EcR9a0WbqRmZqykR3DuA8jR+tQ4Db/jhBPAjIJPSRotMWclDAFAAVQbM2oBCIERLCiSL6QsQXTLbQYBJqUN3kcmxD/YzlWNxdAsyhh69lJUUWykKtEIm12gqdfT48klQ2PuojwRAszPIussldjZOp2axXCUBQk1puja5os6J6N60zEwCxNJa0nmyFfmjpMkgRYk0boqRepSQaGKkyS0zQNXFFJSlqGoJlWWaVFFWZIM76HXUWSdPqeQwEaopn1lMWgLLTTb/L4+RU3/r07TM6K2Do0V9jAclDe73UR4aUMuhV+paDD0UUdCioEPGD4+PFCiQ00i8+DE5XSCsUOPXDbBJmuRoWK1LKI7GDTAldFMogvJMfXbVQtgO9hhS9vtodmTmJ04x4ZwTQ0PJPUH6O2o49EzY+CcCTJ1GLdJRw8KwLeZWQHWDaxXZkdE1OJGi01uowSURwXOEktF1Vouix0BZlUFHifAmZq26hT//uSxKQDWFoNSqwuVIMcwekFlMqQBtPKCtt1IWS116qzonQraIe0KmfOH3LwJIFixuh+rmpgPSLP+9FJlpmo5gDdH/UUCWJF/XzoYUBQ00f6mPGA5pPNABEgAgAphEMZywFKVXZ0VZHiSrpmPxqMmGirC1qYahnNBo8q7ROHMOgJaUOWNmqWCzTt19tpH7dV3rO89VR7QWGOgL3I0G2t5n9qGmlfd5GxqNrbBHG+ck1bz5vmaNrGF5PUUtAjwYw7De6UmWWmuzscUyShtqWgpRm60DjEwILjAPonVCug3oRNGyaQ6BZDMY7umrctVXY/rWmtEtsgkdF2AyhILMmUQYLIRxn7fXUZkSFga+1Va9C5YETE+kXSapZkLKN0vuzkAC5QWyIIydfqSSRL5vAMABBNoVwDKEZRJYAkxWLKtSECcB1QcOq3OfISlFOlYf6KGWdMD4G2rXd2YBYCyvXHC8prm0ClU8Zyrf0xFjH7I9c2xdsUyIX1o71UK+T+B5vn5v9fbY9rbd1IYzRXdPu33rf3rVIM+YBy3htdstj2PKztjf/7ksSlgFrODUksvlVDKD5qJPQ+kMT0ZmqZxAEdPvX1+3KnX1/n/+/zrebatJB3eBXavYI14EqORrPiHMX8ZxrRP9/5//zmbf//zjWcatm00i5YT71TOJbuV53neNceVnb3JUA2DUo2+gLqAACHQEpZCkYJOiq3VV1CGZU0O/TDKnvl6jTcIQ7q7aWkiUiiKmIubU59lHDKxjwND0TP2RE2NWbl2cY9PfP4wbzEUqMWHoCoNQgTMfUk9NfxaElsyLn0H2mtFB3VXnjUsFU+i5iaoJJGxiTJSE7DtVolI+tFqmJs0c4pu3MEKtSTOtGkXyqarLs6ibHSZLpNGwEgBwZ5/+ogC/+27rUk6SzXScuk7W1Rs6jEyNgzoMhCPDdD/WmQ4nXABDBFxKgBriykBMRJDWarTqP3E4JYW0h3rSUM415paTcgylsPtIDCJ2TYuSKnrOVZTw3U1Jg4hTVK6M1D9Wog2eqgmsa1jXs6ecDUGjxICZUdNHWijPvFeKp2yEqHns6ls6kk6VBAzNTISaeWxhfoEyEhgHbKy0mSLbI06hT/+5LEm4BXKg9MjCJ1AunBqSGVzqCCLKTR98wK79TM+pMlSmnVOn5hRKY6A+xeJ37daREjT1/nDRWdUtL1Fgd2+pLUwm4A+YIildL6KNA1IATlgBqAAI4PDGsAa7KmpoYqfSQir9X6iEEP0abiT71DxFoMtmJhOsKCtOMsSZus37vudfLXETN3V940+capB9qLa92PX1emTjzbNLfPzJK4h8IIqhLJFw1VTqPzBIzUynTKjGqDvSY6yTqz5wvrMxkEWW6Jc1lVcIAYBzYk6FiwnpPFJFR3kt1dMyfrdST2WRopRVCiZo6SR0T0LWfXrb7EoTu3+cLdS1lN29AvFA2b1I3QOgKAAtMN31vqUYl0ipefMkiBTGQjsJdJ+Pev6jZZXjrO7cBUw0KZtV7hERLKkE6LIpm+eFGcGJzg5zsgZXZx6wsyY5P3VUk2UhQ/ZIbvFz6D8r5fnclb7YloIAADg6R02TdkFqRQRKY2951HSNTFzM8izV8wHSkifWik7KZkSdKBkF+QsoLrmqJfPstknkySFBMmdV3RkUZJF6Va1qlk//uSxKgA1/oPRww+j8MVwaiBh9H4WTVQLhtTdi6TQYABEiJJl6P1EVdW+tb6jFNTFBI8m6uPkhH+pnUx0Bg2ANNKVW2py+iLhIEqBCSQwMm9ORUQ5tZ6j0YaTEH5lsrcyVSiJyizSujP2cZdP2FnVLeftNl980L1Gq01Uyc2yaZvhDObYNZqH7B13zNfLuDMIIC4SRQUrshojfTroNTqnX2/MEzAXkVfqZSAScE/PvqSb47ijUZmH9lIde/lZSfpLbWpIBtAAUFjdXzg+pX/6jXqPN+TDH/1DOAFeBBz61frWskDQgAAAZoZUgQEdFh3GYm5qHass+5DbB5dKYi3Hj9si/CHaWS2wV2tbx70OCzjs3FIbXpBZTtH2FRRqXnMWQrucv9JmEkTfpnd7nWlwrAB0yQOnCqtGmgdSjOD0kgmgYnUmomyRgtkVJKSUo6kmShP70+XCqtwhqByAWziKKRqVzcwM1GAIAkIfNhnxmUFJJqpIF0kDi2Pq0DrsWSeWpkygzLRSLZHhqwAoI2WepS28iz191213TQWX39lk8X2S//7ksSrgBMyDUsMLbUDNsGomYZOoNnrSGuGQALaHd13Z5ixFS9VSBAgAAMvLuKhwAXazGMzrS5t5rfXkuUE25mVllmPZ6clMsA3qW/aUc4yEeZJBGkXOHzuYLUeJhQT3El3/oNjX+9WNk4ISHVII1ugpKgRxbtooaaVaTtevUs0cyKDVprZdzFmD2QJqVKl0jBA4paBfKEwQMzZbroIMM2eRRWy7dzQpobprPqW6mDFYb2fZ/9EsI//WZJaaDm/yiXkf+soihhAAn/92WWjlBIIBIfdEgxQhaKOr9fV52mRFbkzkw6K1pRJbNxp9rsojcxGhcmTT2P27sjzxVvcMltabpesSeiOdJ30Td5FUP3fnz42amLQHGoOXitdetbE2S6CKa1EPWigipSD1u19RxjpB7aWpT0R1hqt16yYRu2Q1Gul+1vV25kbX0DxsupEvgO0WFBX+tRFf/1m7XRkybepSTt79FQDWBaQZP7CSgBQYAEDKVDibQj6W0bRRKRvfTOTT209X9yjsPVeq2xrUqi0rekB7ga3TUUyct93Uk2+pTn/+5LEvgCVDg1JLCJVAnw+aNGTSthl8w+CyDkSqGGxyvYs275l873OG4DZtbS6rmOWyH0jxc9oP+O3dVNfEmBipEiz2UplKUjWKeMc6ltJI4ktAvGgxw71mpPGjMis4xw1IY7KN29ssHGeigbPuXjQSwcBd/6zhMm3/1qZ7Hy+b+5TJF/+sjgJkH1JH+p0zEnS84AaCABBTETU4DrTCgFI51FMZDI3fp3aY9SwIqypOlurNWaj0RVsMVqW3AJCqHTzN5tH5r1MeCOaeVTM4XllMQhdI2dUi5UayS2WikYuISBc5dA9QRSUiuTI209IxPpaSaa1sk9K6lm6jMop6FkE1orNxjRsHtAzM3prUmQ8hVpOm/ppLb0lepRQJmlUkM4kqpiHghkLMoVfrRcmk02+tbZ9qCLIP6ZdM2+z0UhEwuqBwIL79kUCCFyeIQAYGYCxfRa6w7FVDpXDVDUa8xVpzhL5dpoZhFx9xY1ZlqTQMnmK1xjUi08VTjWzkfhwS6gN6RiXkbU3AqULC+iwXS+XJmb4t9YaK78264hQazuYNMDE//uSxOCAFiYPRSwuVYLfwaghg0qQJaMiJpOt3RZSRiNpNVFYwC0g6mSMXMDp6lZSKdQsgvIl5aSpkXFpHAssDwOjSJsgpbUnSRHANqUjlLU1OpvW7IqacJowc4cmqKjySIocV0aJWX/WtZFS3dX9jhxFkJcHYf61lgaTVLqZNFZYCBwCLGqXkUlK13OlwyUf0s+G4gxVp6cZYLkS2Ym+UWZA1NTBUD9oxRmJgEaX0sHwt+1IHm1D+EwkBxcRDiyysIdBSn9TQrL9xeeraqS0Wz7KjyJS2tGbwC6ZtTeyCVq8fgQiAmsrIjmGKjNVmpGhJOsvHCPGTKtlKWUJ42mTqQLiJHJFIYaqaKlLcmjI3HwQIMy6SjpRM3XaUB9O8n19aqLH1upu55JaZeLpqqkWCfMkUjRZiCWRgkujq+iZjnJfq84Xdy6XSBH+swSTdPXW6KBSGqBNoEjHknq2RTMDUcRMqggABHy9AuMaJiUT9uyq91XlfL6NR2QyqSkRU9DACBu1XRjbxM6J9YTL7izTUwy9dz2ghF+XSV0qjyxppHiGYf/7ksTyg9pKCzwMvlULTkHnQZZOoPAy9afk4yNzV3m7KYqOVwL8fQJ/6kZgM8bbqTIqlst2rPsitqCjNAdRBlsaM2tGo4KTFsWmqo0SooTAf0lGpxS1OynXur69ZigV16jQnVoudTWJ3Flmy3/oFExb/bd7mCllo386RZD91Uj4bgLQCSZS/dSRwrtDIjI60AXQ91TtdAoUq5yoAUtlLTlmvlMKGtclMEAIKXU8viUyIwz9ZU/doYp0OBpXfyd9BVLhDxY95PE0lWvc7IfKApBaz7c7ZkrEWvEjb+NbrasUyR2S0X8e+d7rhuP9xx96XDFfGd5xL6R6Sa1/ZeixBmTf6xndIbt/CC0C20rPSPc/Z2LxAk0C+bmqr6stsq6C3WcSUcGoRJJ2kOK5+Uy8Xy4AhKFjySKrP6Un/9nzpVufTOF5XllzX9XGNDHgDkQuY3Uk/ZSzYgpVOJUAB4AAAABlUCjnC4cIKsDTBUKiWysp400ZamvIasOo015Q2GiqwS+8rTQALGc9YMrrRTFlKXXxwInblLKXWgNjxtWvItbieJ3/+5LE5gHWwgs8rKZU2zbB5xWX0rgU12WrbkX0n5vuyIDiCK5QLbtRUbsZENe0+Q8ihop2qKSBx01Jc6XWHwVXWaVKeYmRgdCNAtxs1iCGCCTG6RcEfmqBodLddkUFFMnE0FKPvW6q2K1bLUXFoonTEZpYgbZ/3QMn/v1rdjc2SMPpki/9dTHQ5cWyv9lyfPQwCQU4UhLDZmJNonCkW3rGYdTZ7NqtfhkXEi8HbUFicchqRRZNIGDwLMQVUfGxznccs2Nz0us7uvo/y4Dz7riG7EXNiG3MPTmiP2R+zSC+TfhCgmzYwOGy2QdVFQc8tpzpwS8oskky1tSrU6DmpixPJilVIOjZz5ABwAciOpA4Mz0lpUxsNzhENv65grs9fYnF/pkx1KMi+dSALMci3/0Zdv+vrU6JiSpww9kSQPrXqrorGY6BOjCn2+zIl08SpeUqQIAAAGxF/DWoEMKRy8RgGProdF2tPoNFtyh+NMKkrXIhEuQbuqvsuQ/FFK4xVtRiz8DT15jLzUWdk75/X5FLrqTkC2RFQOfedvMA6fiWZvfu//uQxOqBmHILO4yyVQr+wechljcQeuiDiwLKWogC0q2XpkFG2ybS+WEHstA1ZE8yVdpuodJCKZNRxBA8ZMdImHvBgBswKZEnO1OZDQQcvk+eWrdrmZ7Z9ubkkbPlEnCIsznSOHQGqRP6am7dMyQTZX/WmkkmdKhnfrIsql1XrLhEACdh6BfX2XWgbnC2daAYBFOlOTUnCqzTUYy+q/rDMVwYu0kKutlTgwbjMJVRWflNh+3rAUc/KZz8JdejOXM7DMbU5vFAWShJQHFtG2wWCeWWhasKiWEfqTrg6U6wwCuAkBKnEjyKL2rRHYR16yVJtV3Ubu6TIpLTcvmqJfNXZmW1bJx6CAgBaWLUblA2dDXG9FArPJ/6f+pkUTUpah/WgtSzxMWMsCYGlrv61FH/9ZzoHzZPqYfLt6tZkXx6igg7e6buZqVqHAAEAqPn5hyypm+CdxQOSMKLWvXcC4Hme6G1dR+HgomHatFEYcQ6GMEvlsTlN5RPl1eZmof54wGbGaRZMrhki+kY/2K71JKRwxfWUWqp5pYt57Xj7jxzOARY//uSxO6A2UoPNwyyeILgQWbhlLcRt1LXXzbbrdI8fPxlVpCP9fX1uG919+l09EunzUjVmxCj11A1c5FFDx8Q1C+qbJs8fYxK7vq1Jqspl7MgovOS6TS6Zmp+XHLBgBXhayav/qMnb9f15fMDNavOGB5v7JpkGEYh7pp9VbGZoWjgVCFiD1VO0pMptSwFD0DITkh6PgwC1xSxmcoiHQCQ691u0kuEIgsBBOozthgMDgsuG3pnjwjP56Hg8xJAJ7XaQZj3PPL1REc81G9VSsYhea+GveaNTGJ4MjS7bcaxjT3e45vu8X91SjN619/e2+XesVtBs34vXH+6Uj4j/JpnwWPHvD3CN0WZMkSQqL5ohqs9Ziz6aq0VprMXTsTS6Uml46XRpACcCqm//MkCx/9KtbosgSpm7tukPdST9q5mOMLYDbGEKHqeT3Ok5MdVEgAEdC4BYAH5UBkAo6KeceJl8pt73IoGYKWv5I3ZU1uV4AgWC2VAQOf+dhGg8D0wZT5I0hsZzLIjlm+2IE+fKScdFfISrWsH3EwsTp32/fq8uhFBBv/7ksTzgdi2DTSsPjXDLkFmVZe2uwFZTJ8vqRrexgTJfZJ0yAFRJutJlmutSkTpkkm7L1KSTTdiODoALzUDEhx9jNKtMc9i+paf6nUq3WnTSSNTfcmjEwZJ0zMkxCESQrN/qPq/qV1LRROnTMwS6KKa1/rUanSaD0hyTV/XM02MXnFGR08JeDfy+THGBq0qwIeq6cVR1ZzAXeqrRhtsIsG4UNRuLzoMAEbFWPw0xrhS7bmeDSAfpaSvInZbvtwbuG370sl6barGJNiDE0kDntBpTck2MOO9jvPTa7UDlXWq0jakJGgs0x0ecNv/jP7VEn99Xvdb0i3Gal5tZ23ttcSBxA074+5XhoXVugSpCSNSUNkklVLtNW0WXOnVE4zL6qRmcIhmxismEoNYYBLC4vq9BE1qQ91PqSU6Z843udMElN6lok88oA3gt5Db7rSNSkfiqoRAAAAAAgiQgKERO2kMlYmPM1cNJUSBgwsqjTYTxgF75VSpEWpuQxl/lgjBWg3DNBH5i5u25Q5C7tDBX7cNzUkOlznixXKWsehcYnzvUJf/+5LE8QCYMgs0rLIVC0LBZgWXtrkX3W3t5c1htYRgk8WVtn/+586kgrU1pb6atff384vTP+a9zd1jTYtT/eK5q/ZSRhlOesSsO5myFtmYjyezrlcJrNvmLlmiT6+O83WhTWyVaakGUxcPj8JaAslwePV+TR4P/+aKNkWRR+tOtvrQMUCTEwJQpt9F3mDogMFKF8lUgKwg4Bl6OsUW4noNGyCRt3UWZ06bQpycTLxlsBxuC4MM0R76mL8J2lUvufIpYOa0gIzuSPBa1v3U5eaiYDPvt7diLWzzc5FXLcnATBJnOkcV9azEwdMiQ9a6ydapqk1sqzKTMykRJjhrWpNSO5w8MkGOi6d2Mz5mzIueJwqpKLJX6XOIm/UvdbzdI2UlLp/c4oxFICvCimvb6Zx2//sYIon0+pN0WV76imTBICgRbS2h6p1NIvn56oQAEABqjtnAeZdClqnKd8Pq3JvI5xp0RQ5QaBl1oEpa9KAaip5RKIo7QmTWpoMmorajU1fv4+z+kpO+wEJliJkf9wllwsuvrFcEf1+Uy+bfNLQNRZJe//uSxO4BmQILM0w9t8L1QWZhlkahIgELQLbW6fZvkAkR5t8C2l/mZyfZhp8/zMC2qJZ2zlu6UvRlUQRFm10MsWUy1OUjRzdN1qf2v6ugo4aEw2XWdNDNpLj0IYmAOEEhZ++p2Mi/9dBXWzTVE6f6jiSCH6rEmaj4HPGIaN7oqNlmRtMACAAKIMS0Cxx4SoXpFR5+klZgWmkcjBqaE1y2wslfqKhhDFZQ+Lcmnr5B08jjtJKPp2l38fDLpEng7ntBNt7BzDL/uIuWkwEo4YP1yo9rE0bh5X08+6SWid8rxDCf+zPSb/GaZu/f0+bQb/X//pAf//H0+WG2jPN9YrDzZqla1ehRNN/LiytsNdvBEZRo5dsf8S3+vjiI4fd2qtJ6atwVj8V9/HXzKRuy//44+ah70yb/3KaMx/HegqO0cjci2/99qSildUgRAACIEIwsHTkhAEGa0wiLiIAoayCMzRENXU3qvFB8CqABx2gtO1IXfeoDHJuL6ewDxQ9omiOL9RIRhbpKqXtGIwxMo0VsY1M4TzmEV9LZmgOar9WmLTv62//7ksTxgNiGCzEMsblLEkEl0ZeuuHhfHcfceGPOLiuqRb5grOtVkoiiSVzf+lttz++9731yyrlZf39sx81p6zEvPgxM+d4/iNbdIEAS4MDrZnmPp9X1/M09rh7fe9NFuyDcB6A2CCN8XfM/OpMf/7Zn6uLJa75rlU+25mfnn1lwQwAi13P3a2pguwMAAgt7wCQHwCXDK1hpagvHU4JTYTWR6vtLa/VTuGncD0D7uTAtOiHTe7WWQ3KPlawO+iD6g4sxR9y6U7g40U0Zkc/CKh3FxfGFK894ngS6k+25WhcldHlcc0142N5blFH3uBtzQ3Ov9e3mtb21fD1QQXOFemryU+YmYA4RDC863SAuo7ugpBAsc+maO7etkaq+rQMzFJGkZkqijMiVE+LAsCSdXfZSZmzbenvUial9E2a1etm/WdJ5cJo6EBK2ynnTYo1KAhBAAEqBQBrjnOi6TeLHii4JxyaSTqAts7S4VrWWiGAFL6K08cDw8iFKr9FFamd6qpXbllXHhXzSKODTtQ6dYUMeMxfLeyO4Ncau9xmeJbN9y/T/+5LE84DZ4gctDT11yxHBZaGntrhggO4Kz9VXzm3jY8F3q9MwjPrvWvjebbct5/8RnZWtqnxv5vnNozA/RBhEnvApLh9WpE2JYlT6ZWX9XUp/tVqTYlTVTGo9zqCbLLokxdBXxEL/1pGjVfZ23dRis8SaTZw+pNN/a6zc3MA2SVQV6VBZhBa6Y6JVAAmiWrP1hXxX8z5X91J0qIJPo+ppoxv7GzXH5chEvZozJEXeFyVRaYl1qU4U1PM1bs5TbfKht8Uecetj2HXFkU7hLHUq1sqvK1Tecvs85V5hfn4iFhrVsfPX8MeXd42rrw188OQ1DM5h/e6zy/Otjl/e2r9uO7o9b3n3WqtW5ZaGg7EO9rU89FD0/mg+PJhobPm/4njmaj0PaiZLXDmHT7kySqaIBWIF0stv/TVz///H3xw5qK1fwm63d/w6XkwdI0xLZ/iZZ6d9pwpiNBmtSk0rtRNvi6tIyZ9obBJaKsGF00SmxuyayDuQ82CHGXTkNT03k6VqmZflCbQjkhvIbVKx6vaMOrbpVwGNjTjYWTLGpPjK6Uvl//uSxPAB2JIHLIy9tcs0wSVBnC64ta++91aI9CilnhvMV3r4vuO3s2KPbOCax8/49p3Kmc6ph6tUbnf+PEve3mSSoJGgNRrJ9RsLELYcL0GLDvv/+Ya1n9WyqfZUkc5QJI7z1KuwLpBs+5v7+HxE//8//EtqWLf9OY/j+YzpvRDjv//iWN0xIKQgIjZiHGgAe8CFruNgV+VBIwxiHXbMoFpbB1hW4PE+RnEtmmG7QNClBICiV+nbnNzQ/tTlfBrLMzFAjuWn7YzsL9kd1gPpYL9LX3b5bFA+65t9UjPt7TBBU5aA369dXiRqt7dG+oUqKa9Z/+753Er/857+x1P9Xx71iTP5pFgpFL7UUaGvD56kQ4MiAiFkzv2PX0PQpnERMrsxANibccFcNxIMdn/U4sPv8zqtiEXDYvop5CcpvqzIF8WAPFQW29blFJ9qBCAAAJAASRgAJXYShQXKhJ/hCLhhNeAWnEKZ7nXZ6UFZEmUrHKLToQY2pAIVxu+yGdCFI8xgv2XZyx2aHGfaUDy5Rl8niR51dO9khtjTE9qxnv7qHv/7ksTtgFgOByoMvXXLFEBlYZequbDPd7hsgFIZO4553zr6nm6+Xu231YII7ptkxTIXRY32lA+j8gSSGvYq2ac6CCVeAw85SK7ava4Mx2sVuq6/q4rqmVedbCix6OHFr2whaQEQIZBnJi6mv6e9////1ts+xZ8N5mUuI6/+R8HwTAjOX/5ndKQ8EVKQNjVB7ouSg8QEJMAQjBU1M7JCm9ipYCKBG6PgXql7tv209uS+h+C9WmnyEHHVoYkMZbRn7e5VeMU8OOkzhs+bLk9aNR13JDZo3lXKVtW31C6libyiwlDBhrYvr/DjjKRTN65pyBKG+8fNa6q6r7esJ5DXTY5agV9cYo86ITRbQ863c7ncRE6tlmJipimind7n003oMYO6lorSLyjRBaZ8yZJMzGWJ4SoTNTf1KST6/f6lkgkYp30nN0EvvpJj1Gsd5Bq61GrFFSoEQAARkiYBxm7i2VqioUmQUemafNSYvg70NrBNdftra/7sGvtxroXOGZvRHGMPjUsslw5d4rplhu2ycmnM8L7LqFNI+e7Qjz00qz+Z2zb/+5LE8QGZGgcpDT11SypApRWXtrl7ZpJBBHleaGyCWkfzQnT61qNyRUujs6k0W9y+YFItG7LqMWdz5mZDZC+KNJEoFo3KhKlYpEqMmMsQ4ZA8RhSSsiyydMD6KSBgmgguta0UFrcol05RUWS2WCHE2r/Wed//84xsbP6nVV9s1NiULR06/atFZiHbBrg4QY3YsSlaIE3LCBJ1j0faoAmnJb8cCHh4dR1LRYyalUnKSwek1LqSnhn0rjFTy6L2+eQ4yhhX0kmaWCRoy6vllgMR8yrzKtzZhQqKVpz6UrqI1XrdFgjBGykTJuyTnTdzQ6ShugixFDhBUK61mSidVVaUyOKJHFQ+ihekpAm2UILB+xJ3cmzpWNTJSJwuHXKxwk9Xr9mQWo1SSPGBfdlyKl6syWeELm5MEkbN+pZlN6/+vmDKMPXMkq/upMzLhPkRMrV7G5mYF9UEAAMLBIoOXOd5rydKIEiRLdsWHnnbEKLPHhdUOOlMAj1ryzUcyjYyLyHr9K3HkvpNagn9aEO+NFhuMitWIEEzCbwe8gIyJElUy3Fv//uSxO2AmG4FKswyFRsuQSTBl8ag/8OVdKyJfHjxsuBVlyKbEJPaxW9f6PHC2DrCOajif/bZseuK7KR5I2fPTEVV0bpNHYaBoIJ0NLT9zrZSQZKQXNncf/3PO7tjenppPnOHybEyikQI9EpCrn/4hjWX/+znndRPX997u+qZX/PNFwiDYgtGDJcuQyEUTZkL8oKQImnE0UVHVbqj/qCQA0JwpJXd4BFyuVO+/Ldx0cIPdavPKUvrAusQTg3Y3WJX4kXBtvLPlGqrXUR8LDCurjkZsx8XsYbT4VsZ+3HyPTBAYCH0eF93emo8k1HNdxt1ykVPm1cazrWlZNr78u0JhL6vj+HeS986rAax+i6V+NQIl9FrESSbtVBJnn+Zm6+2zFrc1SfUuLiX6o8jpAeFYFUzv//Fpmt//zH9e+DRhnF+63VF/7IVkwKw2J5TWLoVCAIAApUDBE2zysVU26YqjJeZu5ECQKrCFEBI+KiUFZk7YqiNxqC4lWQEhBo3RSxkUqfgTN2oUIompsltCKRllyr0Mq3Qj0iY08LKFh5m+Uia1f/7ksTsgdgd9SasvXVDFb3k1ZeuuMwtY0/tBrc/wAoh2HzE5f4u1/nzNPulJjuab1/ltTEmdWz81KPJCjW8ul9wwSgLAIi7KPiVUfFiOIINy0YRK//ouP5iUq7UWekpwaGjeUIBkFIkJRP/9Wqf/+b/qCRxB8VcdSXXH/8jg6EgVQ+tQeJh0gAIJLvA9wzHmmOAMINeCgMQJra0mCpKaishdJ/I27AKxcCH4q1l3mCtLjcy60VRWNp66S8eYT+qOV0FyH+3PkTYUiBCZWcyWN6qyiZ30t8aE7PPVIud90wudHqsGoXrTex5/vJHc8q4ppK5jrY/T6/3m3vHb9bz/p+kHN6p5vvTa/3qR/ZjDrDQPLE9mRif6lsD6TB+ZBmWv/4tj7/f+y7gmuLXSTy40PqniUPAbAKBu29v17HVLp/4r/52Ulmk1+9S3//ulU8CEVF1D/5HaEp0SrFLcLXeRJNAFLEASUyFMccVDuqRKlIqLPKqgsNDmMBwRTv4PbyqPy4MBfqii7oinh7Xy+IxNU8Ooloo3zQqCUh6ByPbV25yg0j/+5LE74CYcfMnDD0Vg0C+JFWXrrk9vpbrONBwBejbRKYzB+1RicSICTqJ10hXSoSOy1qcoqdN1sdMR0Jk6QN1Ls55jpoUi+H0FKIIucLpGGx52pEANnPlUxV6lpL2o3oJsec1bYwJFJy6mdIeRYjnT/1pIt/f10ifPE+ZPe6lJv+pBCXzIgZU1BEeHycQAlkAMiZBlQuwWGVYuujyrMNPiReYL6cZf8PyKqOCRJuKqVVjkE6MCFHnexWRxgPHj2bTVEjNfVs0aRmEbnzlFinTwnKTMK17eEeVcuU+7+Z1tSJ4XQ6JbKq2P8xo9GRE50meIICikN/jao6fhpSiTErORG6nWkowQx1lpC3GTx9PpJvlyTYhBk3X2mxnf9b+mJXEss6Ylr6onlQgQ/EuG/f8zSCa3///3bGSuW07+Yqf/n2rPDyKjR3/xcxpyVFB2Q3SROWgCAzGSSaBJUuDHnTFQDbHLwp0K1us7Bbo8x5U/r8TTlQ+0upKYdhl5Gludvb9U9yDG9sxakm3zosZa7bbS6chzCAqGfokZoHo+WM9QxKa//uSxOwBmF3xJAwyNQL8QOShh6459iU6ws5VatNXlQBSxXUzAnMKmFa19luzsX8ateuq6m3l+t5Ut6ml3dc/HCWYTlul1red3+UNmvTrDJHzmu8guxLoVpo+vHYoWmy7uPrzld9TLYpjzj3znh7M7iURmCENY7Gs5/n7NoZ/8U7/juli+Y5iLtt/P8ZRZPJpxzPuM6+UHTAieoeDEARZeBUbgbEuAcBdmAJpfKtrEGUQO5GSiYFEm8Ys7c+qgLFy7HluisVZXH7GOcGvZytjSvLXvYOzCbVNN0EtpLVRmNT6uu6KttTFtptHngUJY63PLWdbjq9nCFuthJLC2t+yqTh3D7kxVWLHEx3NdUueYsSASft1vVfQVR9x8R0/v/5kdKFCUwcYozsJgDwJDQdb/VUb/XuiGmFjprVRH/qcecNQdCMJJXaSPKWuIZz1NC5CGZaMxYyZEUAe1VkAF1QuIUFq6QQiwEaJASkCBH6lEUeEqDDZz90kidliVLOuk6ytlVy0UanJjP2NlTQHbUulUtMLxmcxcjpqxP9QMi1z427pJP/7ksTxgNsWByAM4XXKw73klZWfmGhwMzhtAwxEtqxD8/WIO27BvJ2ee+j8MhqvelIVqRW+sL68OszYpkbFxnFoEWLW8FqCCl8UmvBP5ZoYjwBwSWNKYju/i3j6i9cYNgWl28SBwJloSKIISgTDwg96/veZHT/1//xo9nnrf+63/fzNHhELDD+v5UlToK0eT0OAYWRQkjwBiEv2hLY0vG1EQ4Zc7RVdo+uC+itr8ylo8vhgkMVsns5WlYtVlUdLuFiem+u5oEMuTJq5cjeYWpYiQ6Kg3aQY01NUSKGfS6nvHiamm2nlDGhK6Z36+ksSCzsb68bcjCsZ+fi2LSTUpqtaz1RThLvXrq+51ZjIhz1X1xlqexjnPkhMLROMqIevlSGvpOuRnkOo+IzSBxkgzBfKgXjV0/ZCp537V0VGYsSIS/c1U+8sRjIfFS/6UUsqTABAAnYDChYMDToyiAkhWfwtJFkWmwQyKQoZv877jxh1lApBPwc98rGTkBsHRd2FJBKQvxaSkS4LmU90Pih64qrgppRWfkEbFUpDibQ3v2DggUj/+5LE8wPaPgMeDL0VywNBJAGXqrhtk01lfvAocAY5Dct+ZeKWTEGXYsnmROCwZJTMmpAzTs1zqJeUXkHZaTqW50+O4TgN8Pd7os5lcqIo8DYkR9M2Wq7NX/nFrMUUj2mmplolMcJUNQyh5Otn+oxVfV7p11I0FuzbMc/3RMjAly6SZLEcuFH3TdH7DMIW6HKGGalyBk33V86DAzWqTqYOoCklAdYHAvbBUnd11xQoMAuVVb2sbhcy8r0rlXD5EMbky0W1NG00I5+wIpKWLBHck22x54z2Q5kZqO4wfPEkcptFEDWA46byuh3zTV6yK+Pal29Eqs6cZ+/9xo8Cu8V7yq1KeDFrWsa+K/tgrjg/3lhU7ImzdCkO4pGhgX1l5L1Pv3Tuks6cTQMXdMlS+ZLQPkAPgLdJRC2l1nE7//2U5OLzntGfQf7aZ0kzEZJ5F+p2TY3eBAADdUVAdGZj7gJEhaVe4sg8KxG6rnOVEeFRGTRTrvShY1uluwdOJKD0t+UM4WluEgmOZq1GL+4LE79jgQ/ZdlbCkcZChcH0UKVLuTuf//uSxPAAmJnxIQyxtUM0QSPBl7a4eT/UNJX9v4+3CWFCBihMdjVsL1+KWyfp/0r95RGda1m9NUy9runy3RJI7jqX53/S97KpbIMIFT4qwNLzViLHDzi5Kt9Jhxn6HMYaYVPPShZmOHpMMBIAIFSzfSpqHP+v0Y8hHpAe/s1/48KC8Gkaj9+gRE4BlhKoEilZohKKCwYQTFEQ7cnJdlYU4oX7KBVtxaWNUJgGCQQ12H2ZMqBWkvh9/lSnohrw104xH6dMZ/K4PVxVxhoshjlFVieMRheZNE8p9T5qpU5W8H1xm2okKUIsVkB6nG/X948Gq8rMxZfAhqC2/jW8NlHuN3/ir2ap34t923iuZcFAxMc2L5b51z0SmkS3mBgPhf/9VLf5fbklpMFUFoXcPQfUDJpaIoprloSb+3j2G7U///+fbnz6ip6u3VDr//faRwkSSSN/8LrkdAhCA6wKpQkIVozL+SRqDwcVdAQXNZVgUVUsjVAAp3PtQp/niaWCxYOlvFIXxldvZLwaxl6PK1NqmgNTenR0OENzLYRlh8g30dF25//7ksTtgxg58R6svVXTNT3jhZeuuR7pNHzXe4h91Bs3TnIK+UmHM9Ut/aD64X3CTOatsJvpT/zR8b1G/1iA5YgwY28U+f/PHsT5bZb4ley5NEXRdimmeNzE3etqToqZemupalzc9RQJxJIrMJiRg/iIMFO2rqRpIK//aiYnzJHU+/98iF86Yvd8x5dhkAMafDic0xEzgIFkyomjrjd4vuZxluYUxkaDDLCRGiHJ5/F4u4I/gfLBo1Dx5KtZdHW0TRlKW1SqO8GKpE6vK8/gFujKwHUtKJnijVYnBif1itApd5cws4mpN37MBhBXrKdOb/X1mbBhnQ5XiQzOSLuDn4zNjDhBc9ZxiE7RitcU9PeWlpqUcXFihBTDp3NXTK83Mtw9F1vLC0hvr4i/rmGQ5mnlBatEQWGmVQQyY9A7Jcsv/v3y1tf/8xPEIvL6O/7XKW2f6uUETUbi42PRHcVpUm7MUOUwwEED0+xEtRtJbKyzNDMShWspe/TQY1KUKcazkO3NFR4c59pTBErlUCxjdyXV8275z3cMn1sZ1ZuCp7KKylr/+5LE7IPYWfEcDL21y0w+YwGHrrmsMVLkBO/jdtduSpr2e5TvHDOeq2c3xGUMHzypdY/vOnwr3YrYuaZeYDpf/7EkWH497ySsdD+O69iXLockiIwEw6DlSW0enqkVEnn4Lj/1/VP/nn91NQT7tU8ave4gSCPlY7lrZ//5/v////7oxQce+t0f/8TqwdJabtQo0MJhCokSChFcVMbmrvjBaRUT2JlUZMGMvynUsZKxlqvYCdhvaaMYw3DLqqgp70dtNvMwTP2oPzzXzaiGdNhcStr9WJTE8CGyw9RSBqqNL93h1vnG/rTy9/LglE91Pfd73xu898Xlb06ritZ9fGM4s1Vm+v62m7y2f8/Ps/rBUpfrTbzWSIo4cGGxx1I0OLOc7Nv7+PuO4f5+4uPW+cyzxvBixX7NeJZXQSKTtcZ+v//6bv//9LNf6Iv/QpSC78sI6n8YkYYBWymMhBi21IE3la5WkA27KVdOOiLYRkUQpJ91ngacKnOY41L4eSpsnqS5lj7brRTxRTlZXIhCN4ORZxGRMH0bX6oeM0GuLJM/KX1J//uSxOgAGBXxHAzhccL6vmQph4s4ukB5FedxI2HK8PVbpLulIW+uXKO89nj9KRr/OY+tRo+fjHg2nbmZKO85zPCxBpdMkhQkNBYxrT9+bW7KTUpWLDo7yln3ETEX/zfdyfWLjmnSZkuxjiUBwBMru2cf9QVvf//Dep+4bSqd3/ycv5/9hikSiO4nvHgQAghAQAOuuKZLjdV7GpQWBKCAlpkmM2QmS3kaq3y2ChJ837qPC7bTQParaltkc1J1lqsLOC+q6Hu9le+ctn8qNbhLzVEu+Rb3et/bxvmw2RYOotL3mgCEDz3K0Zt4u6+aZi1NENCkd8V19tTiq+KaggQZpdXwz1ZVE4E5AmUwxpJM8/BJBMA6dRSeHp7pq96EV91EZzpA3KTtyiuS10SgexFHwEQQJnT4ZHxD1EGQ3/4//1kJY/+5j//9k5adr3itWDCwI2rY2oseCJKsWIgIJHtUJhFgtWJA0aXNIBipajJ5Y0KeTsbZ5RkMcgNFa0TYXRplseSTrECGSxU7clOrWZiskDDvOb6SUaHozb411S2u4sBXD//7ksTugBjV8RgMPXXDBD4jsYeuqPrWBJqBu6XgzK0AFgODNMbb/63iTbyIItEmvexfW6L6+0u8qWO7zTeKwY8bSy+t42Ism2tvlN0Q42nGkCTCnqK3mgJp91Ewkr9fVWt9U3iHUg+WrzJ4hD0SbD60HQCo2l31/xD0UY7//4/mEkl0V9sTd///2m1AQBPL5X+FdEQITgtGHbzGGREdYUbgUvAyhQORIewwqxhhcyflMoQAQxJ29fyQBcE0h79OvOhuOzy9bjWFncpmO76+1yrYqOTnqWwzKJXQZzKkMMsc8ohH+ZVd3LfKCvl10BEdnO5uS03M8sq1nKljEvyqZ24xG5N+ee7ONmzFs+Ydw5vG1DcCdz/uF/8cv+4w5Rfm9XbejtRaJKJU0UkU2uu540/iISlkcw+TuogaGZ3KyIoOwUARjbn/+FZ4j//f/sqjA2Vn47iP42TMtJFjsH4+P4XNKgEAIgAAJaMhg2gwKRkxhqrVXKvg4mLnlb13NPk6PBENSRctPD0CZygv6VGxO+ApYwBUsCPXKwklS9qStxewcwD/+5LE8QCabfUUDT11yzc+YtWcLri+u2/DGbjTZxZVQbc8FDSO3usDTNXdFfuurSS0rEBuHNCirEfVqZbtxncVy/uxq6JNT5/p7Q/nWMXU7nAlZaX3T1zmaraUZfzLWt4g1kZaMcKhKSMOE7N1rZvpZtnPMaIYox7isIkBUTH7+qyY3/t2POMPKG+cq/tQs4XRKPbU685cAoAL+jEYucXWa8vZtE+WQtwswyAB1tTb2KFZrbFRs5x6XFaGukDbQ3SQO6N9DVWrmVC5rKVc7jw2w7q40uVxHrdsVxXKKegsLniNnbKeG61zmSI/VcSJVLn89bmNYrSlaV1ltk/tRcb18YxX1zHxj/3YcRIttYzuv1bUz1DhDVLrwMMtjruNxFF5YwbjgoU9+Yit3V7Ihg4c6FTzh0iaVFbC0NDJrK30aq/9ufLnlZuupv/PIlCxchi9IRET1DgRsKDcIcITBkJ73g0aGkYLJZlE5aT9rAMAjCHqS/1J5e7WSoAHBS6fZ6TZjgLpyV7lt0xq16+0+YbzxFIV1YMVTVd1mTpxQJ4E9VMY//uSxOaAGDnxFyy9VcrnviLFl564bN73y1wn887uCPSGLG2Z26b39R7xYDuX6gn6emsf1zLeVwiV/vmPBtOqNU17b+p6sSnJift64kZ1MMtKGgtFpM5Q4Fpf5RTu/ZUPMQitx00oOOg6KCoPBASMdfqio//801VMI01aPKmmp9VCIXIbLJUCAEMJSCConsVCnEEIGhkkV5IT2RIzAYgtZiyRhFWXs5I0U0ThyBpQVTMNh+XrEj0d65ExMxYz9FoKK1wmEn6FyyR0nA3O/WEArVhlIhUw5PiKPVa0f7au1NkJqagbQpzm34a6694W4uFCqqaiQEqf9MfO5c1fRcfX3JRsgMF41sY+oedWak0uxHmmXE8FRsWq1atGTdmXTGrraz9feMax9Z2kVzlHvNDVErwUMEIF4NlFZ0b/hjqT/+4/r1Z6O7+J7n/44JUmAhN32WpVIIATuJnFQw3lhU0tsIcEAgMAhsSSfFDgW+acTFPALCu6qkDg3Ps/AkNRhDg7j7tSoGsRKmpK7LLEy9i4q1zOhbpbtS+ebm90o3bcB9JuVf/7ksTvAFhF8RSsvPXDM76iVYei+W1LaWWVt7yjvNz8sy/tuXzFaXBYxcHOlmJRW5vC5q9qBb35ZZuHK5fl/93y9Yllv/1ldnpDUklBU19bvOYZ2LL3S9bsL79izUOneSANRMHuUVySdfXszvHHHtbTZ4Pwmb0Q76SURD4aE8mMv+PZJxtR/1HFdXUqtP9TbN0Sz//dcmNGYxdrAzUeoFjLrrta6CYqRUm3OfmXBLUoQt0VuXLlBVNMWbj/kHwSVjgpFXqNjSb6Q/7WKg4okXSmht+pF0PQ7xNdHTQlLCLnPXdMNhy7zFzSu8+C2Kc0iQRqmnF1/6Yn2upYj1GAiCZjUmnoYQOvPGimEAmvmqajs5MMRVADB+6nDE0s6m0EpVMQ5//25rLnulTG3IzCAfEBv/9f/55Y4ubfvvX6qh5QVFfqaaUgAANFboOjDKogEEAAkwlMoHhCUv6LIG6iEAPA0k1nkoYeJPk8CPz+v27iGzJkQDkMVkiSd0ugNpUoa3HWiRfBKaXO9JpHVapAc1UuvRc98H2Yiqx/IuuVmGdu5b7/+5DE7gCazfEQrOF1wqC+YoGHqjjJ1QSOWwfrLPCrFqC7UHVVVdQ3Ary1db/mNulaRK7z6j1WskK1IP9LZhTUz74XmOxjvc/F5dw6QptNIbIZw/tZuo4DJjH3ETLZDdw6z2xv03fVPvWMYzveYESVxxElzDdz4hMR/FELnBvbWKb/vbwo1t7/1q28b+P3bc+Zomr/H1LuuP95z9QnJFxZ9a87gFJCItxU7LgpIsoCjCISq2kRX5dl2nfaZA6ouylWOWWKknfRzgwsHVX3QQJ5akexYiJoVi5Cw/SNjMb0sgTeNAQzt/uAl9Ms+3ZdzwB4DDMQGpuUWTmEj1iSMz20VEclTsxEXj0iJ0TOe7IoficPTVNRzjNJU9TfX/+q1npbmWsRGnl3P37H+zCatot4woDwR9JrqihthwCjKLIkGNoNmMCHGQyRtwYChceMF0JqR5MOcFP8cBNtdcSD5QSjSK8rE8bpLw+iQkkbFYa02zkKVCWeAh52o93VvFyRtTaOVYZjuN06z/meXl7EdS1BOZUuVOhLjJCSwS8AzfvkPLH/+5LE9ILdpfUKrWXxyj8wopWEqqBvGPda0szImDBiqQcytVXxj428fOqbzvE+WHKcK1VZxuusWrIpl2IaAVIV6Q4ip6s2YhH1SYsHCr5maXh975mnbmevo/Kxc7ZRDfq0Ml5oLClCits7PZarBjF9t++wVtPfbKMUbjfmt9r1pvnZn9CuyNHExugmgQNnf1dyt6uQwzimHKaiXLwDUnGQUWFRyFUMDYpKpMJodXN4npdmMAkEdo3q2z2AlfQJKonzB0pTEJPbqUFT5dHVFbecPxiC4Or5qyuvR0N3KqkUP+7WWota9OnB8eDdkUPz234+6xln/1bH7s7mzNH75+9tDs2dhM2p7J+s9RoUFoHGb89CYn8zY4TlTKFHTffql89zEPEK9fjHM3swtRKCRLpV/7Tb1N8cVdcxU3KwIF1/EKr98PcxCCrhoAaQanybItQEDtNaQBpULwuU1cuU+75myghAPEzaQMDK4AsbXo1BUKZA3YOtgSPQ9OR6A6eiiMSitx07cZrVpJyFT1+06DnfcgleNx1b0flFn8PqUzxVtzF///uSxPyD3KH1Bg09lcr3PiFBhiOY92u4/hcEBhcULsOzLNbufytj9PIOXOYtLh2QVsd9y5WqYWeWeb+U/9uzb7lzWt5U+OpA1l+lYLfZXTX85oGjwbDB9MpV1N3ESq1U3P7Qsdn2KoIpQhn0YFihHKu/vmaKeHv+re45uKxdTXue7R4elve4mpG1k0nC8Sg+FhkKqBQPWBdhtxSI5BUFtZaZxspgAL+oxv0u3lQwASFrBUmoVJRgPLK9bW2zfO1uRw7wfLi1ufZozPtr0PVJDoxOpILSpyS6r96bUm42c75jWlntVRlerY1l2w6xvUDMkDTqBTIKRrRi+0WU50P7hjJNTjbmt3McWuRVgcxzJ99vq6NSbb3O+afxO79+67nY22N36eyWkonQPiR+J6q2TFsjdF38dRd1Ft3LxPLVIq6+OW27s0O0fyKQ3QgaZAS4gEcu9q4K2JwBAFAosZHYZQAAooSQbHDb6MigGMS1/3jjiKIS090RhyWxOtIZ+pcr1KGvK8qsbwkkpw40WiqVXSuWXV5BDJylsgKYlVokxhPPX//7ksTxgto+CwYM4RXC5z6hFaeuOGE5BQAyORQs68HQH9jp4delauXq11vtH0tRLf+m/Kha0dLttOez+SwsZDw0UrqroKpVePJZ5Pt6lRt6a3el3R63ZzkLUyNikPcFoUElxUqzP7pFt1u9rU1MwPlERq56gfCPNx3MO4ckwJ2a1pBmdYkEIgDqMLV8/MgRzHPxZFM9mTt4vAJRNJTWaKl9lICZK/GX1dJ31OiimWymbRKimFUbB/dfRAGZoWpL+s+rFXTCwFZkjiTon165b5VIvMN5fqzE9sIEwDOQLD5nO+z/UXh76LYoKpX1TDB7t22kjqGjqlfW4QeYQAiI3DU2qXK0HDJW00vbQO9E7rinbuCa3aRsoU4qaJke5V12+VXfH3VxEUg52Rvpj+4ue7eum45WiuiPiWHyqtAV6pqViMoGIqiOHUsw5KhgvO8/EsokfEOpQCTrZLUZx+tqEvRez+axdTlMk6CHGqyn9ZiOyCuWtdvBlLc0BdGza1E8omxkbYALTVYcN43u00+eWltW1Hj1SmCp3GJW0keHlqpiNKn/+5LE8gIYxgkELLEbAthAoKWWIqlHLIzGyo6sjUhJqfR6nUG0FJRe2xA23RpTCOBEgAEHULNo5rOmzFUQuQolGVovhCTdIYY3B057DbbieUJZLGeiakk4uXErTSasE+qQwxqSvnOT6mxByk0mJde2mqmvG/JI5SWsvuG1GE0KxKhQJrShSKkSXL+Nybo9bsCMiZyJ0ZV0+sFKZuS70yxGJN1LUvbFakvwlqIz8zcgjagNGmTNICgqUI5SFQaUs6EZasXejOUyBkMGVpitUFTutYsFSWZCQPIgqFSSUzyMswQvcsuYcfnJVpCTSnP2eQ4Hk5u1mok2RlLV2I0iWN3GyEEU2UmZMsaUdUAyRDCKfqjjrY44nAuDqS9oW/zUow1jwCfFyiaq3JF9+dsxVCzC5g1OFmgSSzJTxzTNlFus7FXiBZDcw4/mH6RzHqu5lJTVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxPoDWyIE+iw9McskwZ8FhJq4VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVYquoRH0KTxScPhVslSFUwqAEMskQJGlYSVISUKiUhJaoiJtj/1liJq0xSKWNQw1VEimQilChyWIhU1TRCKRS0sRIpK5K9VdsVlxS7qsytIEjVy2hU0sKmuQs2KWCa0mqRNKs3GKHVkSJEKkW/ylaHFkQqQkIpJUKFCyti1oUKFn+lhUTItQ5JamGmmgk1rVVDkFt0Ucx0iqlHcNcWpJusN/9rTTU8MzM3/0zMzV6w3DeqqSq0xBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksSTA9aCBvBEpRfAAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5DEOYPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kMQ5g8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQAEMIECBQEAgGAAOZmDwrmU5DnWVLnII/d8eEowhBswWJw1OH7nmCYGiQBmGIZjAcNE5iOAM0KAaPWcWAAYQMAGNA2kFHlrEHAyAgMKEXAxAMDGiQGtIGOOt4GgFB6gpQDQBgIgwg2gZkyBiYYHIlgY4P/7ksQ5A8AAAaQAAAAgAAA0goAABG7oM0LNhdWbLIYOYBlxwBRIAkWAcPAwAIEwfd2c8LPEEysBjwokwpQYYWzAwSICo4KSwGoYGzM/7FULEwsfEdiDyCBxgagAwAChwDHEwCTwBWEISACSoGyPgZ0sADNZ/+AEYIKfZb9BADVGRHhIjNlAuGh5kkP/+1Tf9OWScMEUS+XDUyPOkoyMP/////oNoN//0S0ymOFVMzQJpEzLalldRTeAhweAdwaAaA/G5uFxcYAMcZLezPQTos08RxrOJDzqzAGASwwKICSNItIZzTLDCI8LddDNE+FdTAnwHUwF0AAMKKBFzBSwHc2IQlEMIbFFTAJAA0QgARhzBYmIKGAe0wPptVkqGA8Akl4YkwWQGCYMEUBc5f7YzUoHNNFB1QwCQAm8TcMAIAIwLAEhUBkBAbmS4K2ZWIMRqxIOGNcEM7kPthrGCABoYBgB5gigWmC2A2YAQBhkxgFGO4G4YowqxjZhHGCYD4wGHYawvF3zAPAFTqRUToXSYqwhxhKgSgAPYDC2mAqCeYKwNlP/+5LE/4Aiki75WdoAFQil6D8/4ALylsXZbHcIcfdz6NyhoAAwOQCiYEEHAEBQAIUAETB1jzL/yq35NDkprx6WRUmABMBgAoHAFjACQQBwKAACMBgeAYUt+tlr9bx/Df/////7j1b//////v7yAAAAAwM/evM17p6TBNC4MqIxAzbxhzNCVqNK+As0rTADMNIVM1Ack6WVGTaMY9MUMocw4AljDFDIMhYe02XybjawSEMDsG4wgQoBIzsxCQ2DnxZXM9UGwxURKDBDAvMBoIcwvQuDA9BjMBgDMxDBPDExG1MqUl8KAMmAUBwBgGDAIAJDAFhCAeAQC0AJjuhUmCIDkYUgfBhfAlGAGBEVgIl5nVUyAQBRe4KgBL5ekwdwNTAxATAQJZglAXIKlymuwzGJXIWCue88HxmShAB5gXARCwDicZgNAbGCQCBKIc7EOVYrK4Ir23/ypgcB4YD4DIQAEYCAAwNAOMCACIwHABJXHZ2KyPkspMpXdp+4W6O/GTAjALS+R8IAAjASAcAQGBgJgDl63AnpN3/////m6HL///////uSxJqAJ6EvHFnvAAS4JiTLPdAASDj0UP/f/+gAAAACE2AptzNTNZPOseY3mygj7UJsPfLasxWwkTCjMyMZYzI1GjfDCZibMB8tgz8w+DAMN7MNwjYwkwEjWaEtMlUHc2bbE6wv83ELUwiOg8uTw1OLk9Cn0wPOYzjHAz3EMw5BoSFE2TMUyGAQy8YAypEIwiFcxqFExCAcwNAQvAAQLMCgONRhoMLCHMCisMEA7BAIGB4CGBoBAQBVKEE0OoBxIC1NDPcYRoMDG4bBJfyEKXBSmMBwaMIwYgYDAioy1eRKDtvKDA4KCYJzCsOQSBhbAwrBV4HMaeVQKUBawpn2JdfBl7RmITwkFIkB7SAUAhfYv6uVpr25M1U2S1TBRNfiQ1ow78P1bWC/EzH9YSWwednaRSW67pyb5///79/MJ7/////aK7c9l1f/6wCNcsP01QlqDJLfiMapIAyYEYjFGU9NDgu0yo0TTHdB3Mw8MkwKS3zC+KSNK4r4xgR9zGTGJMGUXAcAbMjkCY0g2DyVHPMMQ7sHDChbFmGYEd5wYgmEi//7ksQrg+BxDSY97gATAKAmQe5oqeYOLwgAhi0lmoxOYyLBuwxGgAyZHUpnUNmNBGXrCoPMRF0ykIzCAEMABEgHZh8BmGCmYGCpiQRApaExZFgognLzmBBERDYwSBmBlUBocSoATAQFIhyPAVMJe6Pab6oEmEHWBwGzZfy9wgDF4meQJLWerSUyXM6Una+6zRG9ZwtSWS6JWl7JnvdEfiEko551qOnopmVxVq0g3YqYRjCJxOrRUUtjUNVtXKSpl/6TEIQLNFU6gxSQnzA9QgBStJgjAoDUxOc+MypfzASyODKk1oMTMJ6OnmUz0TTNRpOCRExg4DKqrOxSE1YEQSKTMoDEjiISYSCKkjTPzRABYmYYWDTRxBIBCAkYYIalclS7BCPNklSIgZxhQGAiRkxyQ7EUxVaHdWUYcA2r7PNfiLmpVNtQVn2nqrsurWnt1o1boo1f/GU2n1fmzVpZTGYznS0tnlNdf2W9xpcb+qbv//51bOPcsZVax/eNa1WpjjUtAACDNiMFMeBKg0nWNDQNWDNfAMYyFjQjOgDmM5Eikwv/+5LEEAPXyQEmT20vkymhZIHuaVGxSDCNCmMHEjIxuQojGhEvMM0BowlwPzCIIEMMETsw8hdjN6YR/5vS4F1wwAdMnBTDBEx8KMLYwuJDQeZWPAkVBIeDi0DB40JAIEamhckMpYGB7V0tHWgUFBQCBAuEs4ljvL0e9bjHV7SKjoqKGaWzVq36yEVEuoIZBgc7ragZJ3axiBWMez81HOMopWS+EraYbMep5yWDF7lRoxUa+00RzuDLDn9PUcv0z/X+DJnY9NXJ5A4rxWTRCGMMJA7cwfxmDC3OkMgsZQ2jEjFKcOBTExYFzVxkOtfg2UdQOJzGAOMUIU3uI4ZY1w4DSy+wQxFRoEEgYWaoeCgpvFYBBl4SqAQpGAEmDiyQNtPhf7c4PSDQGxqieWmW5CYvEa0Nui90MO+7L6WYnRTsEbpp+blMiX4507P8poElUtjcQoZRK9zsKjMekrxW5jO1UlN+3do6WQzEpudqdqU92JUlyUWZVZnotzm8q+SqAADDImiwg0/sGaMX/F0jDeRIgwCkVEMGTDmjDTRCYwI0EsM+//uSxBIDmZ0LIE/3JwLuoeQN7bGop0PXk3N1qNNfH/MEEtMIgjN9EZMaBLMuAcMOwTN6XYMNSnElJMNgXSTOZI1llhzTsDpS7wQUX9ELDcnpCAV2s2LtpcFug4ppMNRKVNeRuQHXVbnKZVTwNfUpeWUxlaLTYZcKHe2mkwh86kOzsSvyR1nelNJT1sJXOzMsv500xzuE9atw1PS25hhVnM4rjNXr+deW1bl2drbvUdNT0tWxNZau01NXDfr/3gAw4CeIjWJ/0PGhSwygyqzMMRiME0M8zBwwTGUGCMUYu8wbSdzKAG5M9QDIwVBATD6ErMNcAg6ZxNUoDjfM0TpMoNTEjoykaMFFDMAIWIwSDGEiQsAKnQJJjMqBIOoyzh6Weq5UHXwl45NC/L9FYcBAusXFwPAbikM6upAbkAWn93HYC+WmCva9Dg9TnBxnL+cgZrJ2mLah++pKltiixZArYTvRc2/q7r2y0E2vZs7wpUO2Ly4///v///6KMYaOITmCGro0lAsTNH/AbzDvx4wwEwJnMSRCAzDjghc4U2swQnQ4sf/7ksQUA5n9DxYP92aCv6Bjze2ZsGwwYTI2ZWQzPLAzIEo9bLPuOjd3Mcwj4xwaNDCksGBJjZ8YoPigmAQQt8lfHAMDkhAPFa8Uv5Kp0j8mQwEtYok7SlyDSs6mLEYflT/Rh6G1S6kTDZMyWWtdYtD11you1eXR6Ey9sMMwDB0xFOwA/UH3oe3E8Ii6L+va8UiprUpjmLU39nr9P2YgiMU0c5PSx+34p5NnSS2ih65DU/hE4hFpydp7EgqVtgB4ygdhT+ke3NMVUc4G2/jFvK/OCVjEx4yxjA8FXMNYH8xvg/zGdDNMbMJYxUgHgMDKYBIN4hPzti4x0mMGNTdwMyMLMHEJMKhIFCRYGBgQyhYFnbBBgDKAKDludchqDZIDgWHZc0+WM3hTsv/Dkbf/CjmHRFhZhALdBWHKMtbHNp4HqTkikVHLe2JnQXMSfjtFMtrJmrO0g5CoMyCeakkgQdaAwc//1/7ZRxG3ZqcqAEy6FvPMJugNDFGxGI1Ls8UMuVLSDLlQzo3+h84ZIE0pPE8+sQzJKAGwKb0DqYkGcCQ2MGz/+5LEGoMa/Q8UL/clUlohpg3tJHJHMZArEhbMTzuMJAhHlHMPwmKqoBpOyMJnFLDHLY+SNBBYZMBdEPFgS6C7S7ghAQxUWXY3MwxmZlxlkqebkhOYa+6o4BeeA2xrRgRZTo7bgvRxoHut3U4gKAorPP7H31hM3AcvgjC3Vg7CO2MMMJLKYvSw/Xuw7Ask7SyW7EYFpoelcPQBamaGZicfbvLIfx5dh6ngLdNJspdGe3w1To///+zQACkXcYlD05j+qOGQ2E0YuIHRk7hxzAiDBdMBDxlCZlCYCgmIGKquIho4LaoVBcUkkyEEgeBoeGBUhEcRGVgeYx5TYRLoBCpF0y+3SrquMZpItuaJUQDz0Rxljwr3kLucV4bcmWrnbVpbsYbfzL3x37XycjS/2yFqQqQ5LG3obxOKZYDhexjNLjoaCouOEShaMLCrLw2llQAAALjdSq6Oijjk2witznZC3NTgWgoPqMMsJEwPwTzBQCqMHQPYwxQJTA9B4AlwzekijmUNB0U2tIDIDdsiKQLRREOEKArABgNkrJ19tYAQMCiF//uSxCmD1ekHHm9pi4LmIKMB/mihWtdSiXo4LfVqZqbZn5ToT3C45Cg1NDqI6JZFLh6mT7Dc6s6kRrypGxymsb6l3OX4uWqmnX3aP72MMYn29FrXRT2dfKZk9bva2+R5lH4XqET33orm1TbK/d8v1rqMGLUMDIOwqkxfAWgMPRCaTBkADAwpQKUO6M87aHzUcENHlgzugzEIjGg6btLRjsGmFh6BjKYMWpydR0bZlABji5ghBlV4CBGgAgZSULVhwUCMcSGpA6NU8vqkZOwRuCmcNp6KhGQbQ2Urtgp3E+oQ6EZQoai8MPY1voJiJSSJymGLFJlf1lbituxT025i1DcnpqfGrurXwlNN9LhO5YWJXc1WvXZ+S1LlvlvtbOtar51+4VY9zdflVO0gAgGQyB2ajPzOGMoY1kyayOTJ5DfMHQGMHAjmBsAyZCMY8OYocYF+bFAak0HARQGTBghwZAInAEJiIk2FcEgRWTOlmUAytG1oEUXNBDlkCww8JQiB0ThOFxAEhNiMLqcRMrSqybWQ2Hmac9vNrPzVvpz2vk97e//7kMQ7gxJdByZvaQfR+x+lzdwY+lcc/E3xcL6fA6dskVI/CwpYkFEpH/jHijmdNdYAKSdpm03APEk+WIAzbLcxKCQHC6TDmNBCdVHVAkBuqb6Et0WlMaR2TGSvjxEaw/TlNwj/anwU40uocMOHogJRYNWl0S3diUbJ1tO0rxy9qv2i+hsf61PH8NeY+U6Nb4XXOePn/rP/2kAp1+YOeYFveOCKa0qfElVS2I2+6i5yABKKcMz0vk0ND0TDjBJDCyjARBzHghQwCIwEgAAYBODgHD8Q0OExjQ3XFXzKRzL1PQWyimbG7lC1azRS9uLsNOgfU3yzdmtVbsZ3mrsNRwMCA1OHBRHdRmPxyzNPaRFoOkOGJFRGT//1M7w3pZkpYhhArEsDoCI0b70f+tP7fU7IKAABItNKB304GRkjH8JBM0cvQxawaTB2B9MHMFkwNQIyEGAdBDOeFHg8DyGQ3lzVAGQDPBMVALxFRUedEIEkVMRHJjOw7UhcZp6KzJolDc/RKjAYiBpGcEDhpIG4iSaFJraySpimEmVnvvU59+zvKv/7ksR4gxA5AyZvYGnSZR+jTeylMJLUPzI3LY59ra//2cpf5DxlcpbsMrfcEgDEor8Rsaqr7zvQu1I/kFNi6jIXoVNw8Jo2a3SDQZJgMZcDEw/xHDD/DIAIS4VB/MFcIwyk043cCuDkHzIplLhpUFooAYgYomg0VW5YFVxEMT3Y8kMjE4KAkBDC/TxRFsA7F4Rw4BADXAAriqKIQakkSQVDZg/MVMKWhjzNrJjZrKobVIeidlxrG89jGIZQmoNtDK2K1bqH6O2vHC+xm5sbDx1kTPllfKHM/WKw8DhYCE13/+n/0AChRusp5xC3ZwtSJsuVhk0BxjCLwsK6AcwFBgwmBlUr6rqZykcnUyZQJCcpyqor6lhiB1clcDzzT4iiKpxHRpeSYGLQPaTYaX2/N8HzwyCTnT3CKCYLgxNN+bU1xfwqSyKmbmc9ZVu7efDRTtyti6db4nGvR6Ms97PKfwvg2/+Pk1vm6SnX/A/1p8qVOf3dXYdBAKMmUI8GyTG00NImc0YQTH5GMLhYBBJUTdlMWzvVNQyBRENEIZDJkZRIEQv/+5LEsYMUnQ0MD2mJgkQgYgnWGlv0SNAAYmFyI8pqpCKYs10ljakriqs+FSmmUIU4D7Dqf49x7lAtnuL6JSYpPDxF2iyzIUeyLkZRWg+mouRk3HzZOZMkJiTeK011HlT3py0fhbNs50gYPxZw6H6gbrK7RUQsCrxVKG+O/7PYAJtPbRuicpu0iZkGdhjaEph8D5gkBIFCAeCZiQBAhBOCgNUeLtN3U1lD+ztZwousK/jEonD1qIw6XgbFcKRUoPrW1bRpdATimWTqPGyaXTU6XXJKwSjsSimWTp7e85LqIyfMWD661mjy2i5KiMisdmolIah6qZSSj8moT3snpVPDKF225ttdaeZdOm1zZihFoqqTp7jpeetPbXOkGcTs0FUSCFXWqzVY1bq7Gv1QxqsAkAnExmoC4CQEOFEhgKAWpM1EhSK+Sf/7xxRdYfKKlNpJJTRiTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxN0DEt05Bk4kzcNTNp0F1g67qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uQxDmDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uQxDmDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5LEOQPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uSxDkDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7ksQ5A8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqAIEAIAAAAAAIAAI/2fLVMiLIrDMnBVP/L5qwHOTtCp83NHn/sjbcxpcXUMdODwv8vmkoZgr/+5LEOQPAAAGkAAAAIAAANIAAAASUcMLN/+GAIHAwpuY+maeDOQZYAH//7kWK8+Y2iGbKE0Zfo6Zmh7///vPSv2+cVMsSTMkR/IhuM7SLMJQk////cd57MPxekMbhKNTzLMFxgMiBIMnQPMZiM/////cvmJZvPzG4IjJgfDEwIiIADNgkDBoMzEkG//////6K/YwwwsdwMMgQLeJfhUBzCEMTC8DzFUWTEEEZd///////5Yy+f5bvZ/FKcw1C0FB+YGAUNDEYOAknwsQlB8w/BswaAIeAT/////////+/q7L5/lufw5zKxYzRzcpmr/NeY29yI89eisFS2qzj///////////////////w339595+euf/Ob//////+J0bLJfC5mal0NyiH5FIITRyult5VYEAACAYCAgQAAAAMUDT3zuK8xswHQ1DNUY/fwqDBGL2SNJncLHQYz6aDGuLkp5hJAx4db6KmmFNBpxhjIGkYJQBwmAXBbxgq4K8YrgBNGBkAkZl9glGL4TMYeoqhjUhgGBmHoYRQQBrFD5GVeEeY3QWR//uSxOEAAAABpBQAACU9xd4zP9AAgLlEmMiRoCRfzCKE8MLoSswggZAEA6Y0gEJhoAumDiCgYdQh4hCLFAWiYAswWAcTFqDRMDAK9UZgNABgwBgwMwYC0JgGgcDwACWEBJqIKBQAuoPAGxlG0wDQCTANAuMDECYwCQIzAdAwHgLlH4RSt/E4feOPNi+vCTACAPZyCAATACALGABQUAag0yulbu/UAOQ5EpZI1WpS1ZGFgCQcAKAQBi/rJQuAFCVKlNn7tQbLWsU0NP3A8Srx5/sJmxLoaaUXeWHR6VEgJuQhxIS+tBXfyQU1NWq1oeh67EnAdyPy/CMPBfjtHz/+hfqLf/9/X0er//VjN3//D97o5mUPaJ5M8UdUTQ3+q2kJDFJ/dYXtH3mAOAShgoIQwYNSE4GC1hf5i6BQCZ4Uq/m0IEsx9aq4qamGVMmNpB5ph5gc2YT8EhmAHAQBgugeWYOoE1GDIAJpgpQGWYEsA9meQadngRhAYmLFwaLGhnlvmVyya1WZtMWGgSUYRKRk8am0HSZ8MxrIDmkAaZKWBqJ6GP/7ksT/gDCVgQ2Z/wAEq6ogw7/AAOi2aEBZi0CGFxKRlMHEkw2BEklyJCL1mFOFXuFJYPcd0m+e1+nAhlmtt/Xybu/K6X0Zzg565oGdOWq2vzBs47z/QQ98OZOLAMMX48/LovLnVo41DbtVpfUn5qhmo3DVujoKuPzFep+4lQwLaxr7sfAsZjcZot0j625bZltNXj2H44TUr1NQ9QUGWUSszMOxWM2cX1k3YlizHrG0mQMu9ROTSt1wj2wIGJF7qTDVSKdJ1QBIAQowOMGGMCzBIjBYwTYwT8CsMElFGjI3RcwziB4FN8Yejjlao1Y3IgjmMICDVTCsQtUw1wHfMBmBoTBWQlowZ8JAMEiBezdYJOsukw8TzKxbM2BghOxx+SGfxsYAB4BB4gCxh0Mm/RqZcWghCRjM7mi1cZaVZjskmAxKZvNpngAgQkG3REYqAEPAkCNfC4HUNagpdqyzike9pU7ROTB78xK9Djov1qBW7uTfarIocjMFvND7+2NJBcLlhdK4erDF9K8djlAcri40uJ0jkU0jyWSycnx0tRroUJL/+5LEbgMl4aMCL/GP3CG0YQ39pfiVENywksNnPDdSjvUuGyrUIjEk4NiaXufs1aceXQ7ta1q0uz7Whnr51Irdu78VOpA3VvrV7u8+2crXLWyr65qVh98FyUYPTxZ453gBLwEV6pkrOgACQpDAKwI4wGkBYMAVAEjAIQHYwDcAdMBWAEjBXQNowsYJMMWPHbDHoggsxLBKlNIIRRDLThZ4xGQRMMFSCDzB/wI8wLIAMEABSdrUG1qA6VhCoOACr04zIxACA7VZeYKBmDq4CgTK0o1cLNUTTPw0AMpl5KTKQBDjAjQmS2Gxl0U4lwwdKO8pZmBZPWl1FSV609LrlExSGn7dNiUfpHov0URkcogeijsV7aRGYpI8QRMoWkww3b6QOinMm5dlvZS+7OMWNmzFp7MJ7fTry8ch6khz9KLTXRNr66SlKxfcIQuzDkMlMhlKY2szlLIZuJ91KaKp005uJpZteCEslUDDcYaok3X+rWoSBcMB8AkwKwBzAhArMAkCcwJwCSIN8wSgiTDrAXMH4KExYi2TIAKINJtlYysUiTS+//uSxBiDmSk3EA9ob8MqpWKJnaV5TKMeYOQwtARjAQADPe9N7TPm9M6XSDdGJtla81AYCGqYAQkYwOmAYEIAqwYBWeXDXMMD0nB4UkQgEUsbd8I/eyllbKvdu2+zWOVHap7XYFjE/ZqOxau4Vc6ems5ACKo7IuM44JOmgMU1r3Q+uPESiNzibnQ4G/XOPAAR6Ihv/5OIIPxOXD6IgCwYJlCiwfV676e+U691f/qeAwITwvN4deBcpMIEnHTsdqysAKOHYjb3YZmTui86P8PhlDZVwygPVwYSMGKhQQBReKwE168+ywzzlzQUAvInMBQJAKoLCXCWGUGcaSqYqma9Lsqa1Vlt6lZWRPQoUkTKwqRSWRNKiomtDi0rQ6hQwRaQksELNNTQsrEyQWDS4pcRE05JilxEGmxSSlQRJYStC4shgRE02aIibFpXGkWkMrVZoqKisNkgnJtgqFYmnC4qI4VFybcdCxc8bF/3TZdcbv///y//3//+uQBKq0wBECChcwwkqmGTiIgjOOGFUCiRVBAckMKlEAAuEvok4rOo0wtVRf/7ksQVA9i5hKzMMNMAAAA0gAAABIddjLx0PEZ6ZCCHQWhYD4WjUKRMGseCWSDM7WPurlqZKmKxdLxTSHaxescjdXERQGBAYkUJAhZhNBNaNGnGlFgQoso8y41SKRE4SBAYgWWUfF5U0cacJFAYgWIAizD4XNSacacaBHmHls8blTVScWUXFw15s07OacaUWYeZdxuVLFlFFnFlCQHDICCQsJRUV6xUVFG+LCws36xUVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5DEOYPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5DEOYPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kMQ5g8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSxDkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksQ5A8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5LEOQPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.blank="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjIwLjEwMAAAAAAAAAAAAAAA//uQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAArAABH1QALCxERFxcdHR0iIigoLi4uNDQ6Oj8/P0VFS0tRUVFXV11dYmJiaGhubnR0dHp6f3+FhYWLi5GRl5eXnZ2ioqioqK6utLS6urq/v8XFy8vL0dHX193d3eLi6Oju7u709Pr6//8AAAAATEFNRTMuOTcgAAAAAAAAIf4AAAAAJAAAAAAAAAAAR9UKPX9FAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQZAAP8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAETEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZL6P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uQZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Jk/4/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTdVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uSZP+P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk3VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kmT/j/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45N1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",this.init()}init(){this.fx=new ch.Howl({src:[this.sound],sprite:{enemykilled:[0,1424.1043083900227],killed:[3e3,288.5260770975058],territory:[5e3,70.31746031745989]},onload:()=>{let V=document.createElement("audio");V.src=this.blank,V.setAttribute("loop",!0),document.body.appendChild(V),window.H5SDK.addEventListener("mute",this.soundOff),window.H5SDK.addEventListener("unmute",this.soundOn),window.H5SDK.addEventListener("resume",this._resumeGameHandler),window.document.addEventListener("visibilitychange",this._visibilityHandler),console.log("** Sounds ready  **")}})}soundOff(){q.settings.sound=!1}soundOn(){q.settings.sound=!0,Howler.mute(!1);const{ctx:V}=Howler;V&&setTimeout(()=>{V.resume(),Howler.mute(!1)},100)}_resumeGameHandler(){window.H5SDK.getPlatform().isAudioEnabled()&&(console.log("UNMUTE RESUME CALL ------------"),this.soundOn())}_visibilityHandler(){document.visibilityState==="visible"&&window.H5SDK.getPlatform().isAudioEnabled()&&(console.log("UNMUTE VISIBILITYCHANGE CALL ------------"),this.soundOn())}}class OR{constructor(){autobind(this),q.tutoShowsNbr=0,this.firstTime0=!0,this.firstTime1=!0,this.tuto0=document.getElementById("tuto0"),this.tuto1=document.getElementById("tuto1"),this.init()}init(){this.tuto0.style.display="none",fg.to(this.tuto0,{duration:0,alpha:0,x:100}),this.tuto1.style.display="none",fg.to(this.tuto1,{duration:0,alpha:0,x:100})}showTuto(V){if(console.log("Application.tutoShowsNbr >> ",q.tutoShowsNbr),!(q.tutoShowsNbr>=2))switch(V){case 0:this.firstTime0?this.showIn(this.tuto0,.5):this.firstTime1&&this.showIn(this.tuto1,.5);break;case 1:this.firstTime1&&this.showIn(this.tuto1,.5),this.firstTime1=!1;break}}showIn(V,g){V.style.display="block",this.showInTween&&this.showInTween.kill(),this.showInTween=fg.to(V,{duration:g,alpha:1,x:0}),this.showInDelayTween&&this.showInDelayTween.kill(),this.showInDelayTween=fg.delayedCall(8,()=>{this.showOut(V,g)})}showOut(V,g){this.showOutTween&&this.showOutTween.kill(),this.showOutTween=fg.to(V,{duration:g,alpha:0,x:-100,onComplete:()=>{V.style.display="none"}})}hide(V){if(!this["firstTime"+V])return;let g=this["tuto"+V];this["firstTime"+V]=!1,this.showOut(g,.5)}}class _R extends OB{constructor(){super(),autobind(this),this.players=[],this.isPaused=!1,this.i=0,this.trysNumber=0,this.scoreCoef=100,this.reviveNumber=0,this.skinText=document.getElementById("skin-text")}initialize(){return SV(this,null,function*(){new Date(data.configuration.timestamp).toLocaleString(),this.facebook=new ah,this.facebook.initialize(this.next),this._noclick=document.getElementById("noclick"),this._noclick.style.display="none",window.H5SDK.addEventListener("pause",this.pause),window.H5SDK.addEventListener("resume",this.resume)})}next(){return SV(this,null,function*(){window.H5SDK.getPlatform().notifyLoadingProgress(0),this.gameDuration=0,this.gameDurationPrevDate=Date.now(),this.DOMElements=this.getDOMElements();const{Splashscreen:V}=this.DOMElements;V.classList.add("splashscreen--enter"),this.configuration=new Ay,this.sounds=new PR,this.tuto=new OR,this.viewport=new iy,this.ia=new pR,this.time=new Pl,this.save=new kR,this.quality=new ny,this.analytics=new qR,this.router=new PB,this.router.add(jB),this.router.addEventListener("change",this.onRouteChange),this.time.addEventListener("update",this.update),yield XV.initialize(),window.H5SDK.getPlatform().notifyLoadingProgress(10),yield this.time.wait(200),this.skinSelector=new QR,this.endScreen=new oa,this.gameOver=new jR,this.ranking=new UR,this.banners=new LR,this.spritesheets=new MR,this.coins=new xR,this.popins=new TR,this.bonusTimer=new DR,window.H5SDK.getPlatform().notifyLoadingProgress(20),yield this.time.wait(200),yield this.time.wait(200),window.H5SDK.getPlatform().notifyLoadingProgress(100),window.H5SDK.getPlatform().notifyLoadingComplete().then(()=>SV(this,null,function*(){this.photo=window.H5SDK.getPlatform().getPlayerInfo()?window.H5SDK.getPlatform().getPlayerInfo().playerPic:null,yield this.time.wait(100),yield this.facebook.startGame(),yield this.save.initialize(),window.H5SDK.getAdsModule().requestBannerAd(),this.ready=!0,this.dispatchEvent({type:"applySettings"}),this.dispatchEvent({type:"ready"}),this.dispatchEvent({type:"resize"}),this.router.initialize();const{usernames:g}=this.data.content;this.usernames=Array.from(g).shuffle(),this.facebook.initModals(),yield this.analytics.init(),ytgame.game.firstFrameReady(),ytgame.game.gameReady(),console.log("firstFrameReady"),console.log("gameReady")}))})}update(){return SV(this,null,function*(){if(!this.ready)return;const V=Date.now();this.currentViewID==="Game"?this.gameDuration+=V-this.gameDurationPrevDate:this.currentViewID!=="GameOver"&&(this.gameDuration=0),this.gameDurationPrevDate=V,this.dispatchEvent({type:"applySettings"}),this.isPaused||(this.dispatchEvent({type:"beforePhysics"}),this.dispatchEvent({type:"physics"}),this.dispatchEvent({type:"afterPhysics"}),this.dispatchEvent({type:"beforeUpdate"}),this.dispatchEvent({type:"update"}),this.dispatchEvent({type:"afterUpdate"})),this.dispatchEvent({type:"beforeRender"}),this.dispatchEvent({type:"render"}),this.dispatchEvent({type:"afterRender"});const{body:g}=document,{store:I,advertisment:e,share:t}=this.settings.general;g.setAttribute("data-store",I),g.setAttribute("data-advertisment",e),g.setAttribute("data-share",t);const{transitions:C,animations:A}=this.settings.quality;g.setAttribute("data-transitions",C),g.setAttribute("data-animations",A)})}pause(){this.isPaused=!0,this._noclick.style.display="block"}resume(){this.isPaused=!1,this._noclick.style.display="none"}changeSkinText(V=null){let g=V||parseInt(Math.random()*1.9);fg.to(this.skinText,{duration:0,scale:0}),this.skinText.innerText=this.data.content.incentiveText[g],fg.to(this.skinText,{delay:1,duration:1,scale:1,ease:"back.out(2)"})}onRouteChange(V){return SV(this,null,function*(){const{Splashscreen:g}=this.DOMElements;g.classList.add("splashscreen--hidden"),yield this.skinSelector.exit(),console.log(">>>>>>>>>>> onRouteChange:",V.routeID),this.currentViewID!=V.routeID&&this.currentViewID==="Game"&&this.tutoShowsNbr++,this.previousViewID=this.currentViewID,this.currentViewID=V.routeID,this.inGame=!!this.currentViewID.match(/(Game|GameOver)/),this.currentViewID==="Game"&&this.previousViewID==="Home"&&this.analytics.event("play",{category:"gameplay"});let I=document.getElementById("buttonStart");if(this.currentViewID==="Home"?(this.changeSkinText(),fg.to(I,{duration:.3,alpha:1})):fg.to(I,{duration:.3,alpha:0}),this.currentViewID==="Game"&&(this.skinText.style.display="none",this.tuto.showTuto(0),window.H5SDK.getPlatform().notifyLevelStart(0)),this.currentViewID==="Home"||this.currentViewID==="EndScreen"){this.skinText.style.display="block";let t=document.getElementById("skinsButton");t.style["pointer-events"]="all",t.style["z-index"]="2";let C=document.getElementById("home");C.style.display="flex"}yield this.time.wait(10),this.dispatchEvent(an({type:"onViewChange",previousViewID:this.previousViewID,currentViewID:this.currentViewID,inGame:this.inGame},V.query)),this.previousViewID||(yield this.time.wait(1e3)),this.DOMElements[this.currentViewID].classList.add("view--visible"),yield this.time.wait(100);const{body:e}=document;e.setAttribute("data-current-view",this.currentViewID||""),e.setAttribute("data-previous-view",this.previousViewID||""),this.previousViewID&&(yield this.time.wait(350),this.DOMElements[this.previousViewID].classList.remove("view--visible"))})}}const $R=new _R;var q=$R;addEventListener("DOMContentLoaded",()=>SV(dh,null,function*(){try{yield q.initialize()}catch(i){console.error(i)}}))});export default V2();
